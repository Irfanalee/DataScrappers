{
  "scraped_at": "2026-02-06T21:38:41.334214",
  "min_date": "2021-01-01",
  "total": 190,
  "stats": {
    "by_tech": {
      "kubernetes": 0,
      "docker": 0,
      "terraform": 0,
      "nodejs": 107,
      "azure": 0,
      "nginx": 83
    },
    "by_repo": {
      "kubernetes/kubernetes": 0,
      "kubernetes/minikube": 0,
      "docker/compose": 0,
      "hashicorp/terraform": 0,
      "vercel/next.js": 107,
      "nodejs/node": 0,
      "Azure/azure-cli": 0,
      "nginxinc/kubernetes-ingress": 83
    }
  },
  "examples": [
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89552,
      "title": "Turbopack Error: Failed to write app endpoint /negocio/[id]/page",
      "question": "Turbopack version: `0c06f068`\r\nNext.js version: `16.1.6`\r\n\r\nError message:\r\n```\r\nFailed to write app endpoint /negocio/[id]/page\r\n\r\nCaused by:\r\n- Next.js package not found\r\n\r\nDebug info:\r\n- Execution of Project::hmr_version_state failed\r\n- Execution of Project::hmr_version failed\r\n- Execution of VersionedContentMap::get failed\r\n- Execution of VersionedContentMap::get_asset failed\r\n- Execution of VersionedContentMap::compute_entry failed\r\n- Execution of *emit_assets failed\r\n- Execution of all_assets_from_entries_operation failed\r\n- Execution of *all_assets_from_entries failed\r\n- Execution of endpoint_output_assets_operation failed\r\n- Execution of <AppEndpoint as Endpoint>::output failed\r\n- Failed to write app endpoint /negocio/[id]/page\r\n- Execution of AppEndpoint::output failed\r\n- Execution of AppEndpoint::app_page_entry failed\r\n- Execution of *get_app_page_entry failed\r\n- Execution of AppProject::rsc_module_context failed\r\n- Execution of *ModuleAssetContext::new failed\r\n- Execution of *AppProject::get_rsc_transitions failed\r\n- Execution of AppProject::ecmascript_client_reference_transition failed\r\n- Execution of *NextEcmascriptClientReferenceTransition::new failed\r\n- Execution of AppProject::ssr_transition failed\r\n- Execution of *FullContextTransition::new failed\r\n- Execution of AppProject::ssr_module_context failed\r\n- Execution of AppProject::shared_transition failed\r\n- Execution of *FullContextTransition::new failed\r\n- Execution of AppProject::shared_module_context failed\r\n- Execution of *ModuleAssetContext::new failed\r\n- Execution of get_server_resolve_options_context failed\r\n- Execution of get_next_server_import_map failed\r\n- Next.js package not found\r\n```",
      "answer": "Most of the time its corrupted node modules\r\nHave you tried deleting `.next` and `node_modules` and running npm (or yarn or pnpm) install again",
      "category": "Turbopack Error Report",
      "created_at": "2026-02-05T19:38:12Z",
      "url": "https://github.com/vercel/next.js/discussions/89552",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 86118,
      "title": "Turbopack Error: NftJsonAsset: cannot handle filepath worker_threads",
      "question": "Turbopack version: `de6bc159`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nNftJsonAsset: cannot handle filepath worker_threads\r\n\r\nDebug info:\r\n- Execution of get_all_written_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of all_entrypoints_write_to_disk_operation failed\r\n- Execution of Project::emit_all_output_assets failed\r\n- Execution of emit_assets failed\r\n- Execution of emit failed\r\n- Execution of <NftJsonAsset as Asset>::content failed\r\n- NftJsonAsset: cannot handle filepath worker_threads\r\n```",
      "answer": "Also seeing this issue:\r\n\r\nhttps://github.com/scalar/scalar/issues/8076\r\n\r\n```\r\n#17 9.242 - Execution of get_all_written_entrypoints_with_issues_operation failed\r\n#17 9.242 - Execution of EntrypointsOperation::new failed\r\n#17 9.242 - Execution of all_entrypoints_write_to_disk_operation failed\r\n#17 9.242 - Execution of Project::emit_all_output_assets failed\r\n#17 9.242 - Execution of emit_assets failed\r\n#17 9.242 - Execution of emit failed\r\n#17 9.242 - Execution of <NftJsonAsset as Asset>::content failed\r\n#17 9.242 - NftJsonAsset: cannot handle filepath url\r\n#17 9.242     at <unknown> (TurbopackInternalError: NftJsonAsset: cannot handle filepath url) {\r\n#17 9.242   type: 'TurbopackInternalError',\r\n#17 9.242   location: undefined\r\n#17 9.242 }\r\n```",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-14T09:23:54Z",
      "url": "https://github.com/vercel/next.js/discussions/86118",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89511,
      "title": "Turbopack Error: Failed to write app endpoint /dashboard/page",
      "question": "Turbopack version: `23c46498`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nFailed to write app endpoint /dashboard/page\r\n\r\nCaused by:\r\n- Next.js package not found\r\n\r\nDebug info:\r\n- Execution of Project::hmr_version_state failed\r\n- Execution of Project::hmr_version failed\r\n- Execution of VersionedContentMap::get failed\r\n- Execution of VersionedContentMap::get_asset failed\r\n- Execution of VersionedContentMap::compute_entry failed\r\n- Execution of *emit_assets failed\r\n- Execution of all_assets_from_entries_operation failed\r\n- Execution of *all_assets_from_entries failed\r\n- Execution of endpoint_output_assets_operation failed\r\n- Execution of <AppEndpoint as Endpoint>::output failed\r\n- Failed to write app endpoint /dashboard/page\r\n- Execution of AppEndpoint::output failed\r\n- Execution of AppEndpoint::app_page_entry failed\r\n- Execution of *get_app_page_entry failed\r\n- Execution of AppProject::rsc_module_context failed\r\n- Execution of *ModuleAssetContext::new failed\r\n- Execution of *AppProject::get_rsc_transitions failed\r\n- Execution of AppProject::ecmascript_client_reference_transition failed\r\n- Execution of *NextEcmascriptClientReferenceTransition::new failed\r\n- Execution of AppProject::ssr_transition failed\r\n- Execution of *FullContextTransition::new failed\r\n- Execution of AppProject::ssr_module_context failed\r\n- Execution of AppProject::shared_transition failed\r\n- Execution of *FullContextTransition::new failed\r\n- Execution of AppProject::shared_module_context failed\r\n- Execution of *ModuleAssetContext::new failed\r\n- Execution of get_server_resolve_options_context failed\r\n- Execution of get_next_server_import_map failed\r\n- Next.js package not found\r\n```",
      "answer": "Most of the time its corrupted node modules\r\nHave you tried deleting `.next` and `node_modules` and running npm (or yarn or pnpm) install again\r\n\r\nreference: https://github.com/vercel/next.js/discussions/89369#discussioncomment-15694539",
      "category": "Turbopack Error Report",
      "created_at": "2026-02-05T02:57:55Z",
      "url": "https://github.com/vercel/next.js/discussions/89511",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 52006,
      "title": "How can I access the HTTP request from a server component?",
      "question": "Hi, \r\n\r\nHow can I access the http request from my server component (using app router)?\r\n\r\nMy goal is to be able to get the JWT token from next auth.\r\n\r\nThe util method to get the JWT token in next auth requires the request passed in as parameter.\r\n\r\n`await getToken({ req });`\r\n\r\nBut how to get that request (\"req\"), from the server component?\r\n\r\nI appreciate any help with this.\r\n\r\nThanks\r\n",
      "answer": "That is because `getServerSession()` calls the `session()` callback which calls the `jwt()` callback with the decoded token.\r\nWhile `getToken()` simply returns the decoded token.\r\n\r\nThat means that `getServerSession()` is able to return a value based on a call to `jwt()` *within the same request*, although you have to go through `session()`.\r\n\r\nHowever, this should not be a concern at all. Ask yourself what should happen if the browser initiates 2 API requests in parallel, but one of them refreshes the token? Or if the second request starts later but before the response to the first one was received? \r\n\r\nThe answer is that you refresh tokens a bit ahead of time. There will be a short window when two tokens are valid at the same time, but one of them will expire very soon anyways. \r\n\r\nThere is only one session cookie here. If you see the old token after refresh it only means that the request was made before a refreshed token was received by the browser. It also means that any subsequent request will necessarily have the new token.\r\n\r\nAfter all, if you make a decision to refresh the token, the request is by definition sufficiently authenticated and the refresh is authorized. Otherwise you would simply log out the user. That means that you don't really need to worry about *reading* the new token within the same request as long as you have successfully set it (via `jwt()` callback).\r\n\r\nIf it's for any reason not possible in your case to have tokens with overlapping lifetimes (such as when you refresh the token the old one becomes invalid immediately so it's unusable within the same request for API requests), then it indeed becomes a bit more tricky and I would too wish for a better request-local storage to exist in App Router to synchonize such changes. ",
      "category": "App Router",
      "created_at": "2023-06-29T21:52:58Z",
      "url": "https://github.com/vercel/next.js/discussions/52006",
      "has_official_answer": true
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 87282,
      "title": "An unexpected Turbopack error occurred. A panic log has been written to /var/folders/0y/x90jhr_15jl2z20gltt_p_dw0000gp/T/next-panic-de26d9ef7a7796701f2896029a71e34a.log.",
      "question": "Turbopack version: `911504000`\r\nNext.js version: `15.5.9`\r\n\r\nError message:\r\n```\r\nFailed to write app endpoint /(main)/....\r\n\r\nCaused by:\r\n- [project]/src/styles/_variables.scss.css [app-client] (css)\r\n- assertion `left == right` failed: Validation on the CLOEXEC pipe failed: [34, 117, 115, 101, 32, 99, 108, 105]\r\n\r\nDebug info:\r\n- Execution of TaskId { id: 2147483654 } transient failed\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk failed\r\n- Execution of <AppEndpoint as Endpoint>::output failed\r\n- Failed to write app endpoint /(main)/contracts/teams-permissions/page\r\n- Execution of AppEndpoint::output failed\r\n- Execution of AppProject::app_module_graphs failed\r\n- Execution of *<AppEndpoint as Endpoint>::additional_entries failed\r\n- Execution of *ModuleGraph::from_graphs failed\r\n- Execution of SingleModuleGraph::new_with_entries_visited_intern failed\r\n- [project]/src/styles/_variables.scss.css [app-client] (css)\r\n- Execution of primary_chunkable_referenced_modules failed\r\n- Execution of <CssModuleAsset as Module>::references failed\r\n- Execution of parse_css failed\r\n- Execution of <PostCssTransformedAsset as Asset>::content failed\r\n- Execution of PostCssTransformedAsset::process failed\r\n- Execution of <WebpackLoadersProcessedAsset as Asset>::content failed\r\n- Execution of WebpackLoadersProcessedAsset::process failed\r\n- Execution of evaluate_webpack_loader failed\r\n- Execution of compute_webpack_loader_evaluation failed\r\n- assertion `left == right` failed: Validation on the CLOEXEC pipe failed: [34, 117, 115, 101, 32, 99, 108, 105]\r\n    left: [78, 79, 69, 88]\r\n   right: [32, 99, 108, 105]\r\n```",
      "answer": "Disable Turbopack and use Webpack\r\n\r\nIn package.json, change your dev script:\r\n\r\n```\r\n\"scripts\": {\r\n  \"dev\": \"next dev --no-turbo\",\r\n  \"build\": \"next build\",\r\n  \"start\": \"next start\"\r\n}\r\n```\r\n\r\n\r\nThen run:\r\n\r\n`npm run dev`\r\n\r\n\r\n\u2705 This fixes the issue in 99% of cases",
      "category": "Turbopack Error Report",
      "created_at": "2025-12-17T16:31:47Z",
      "url": "https://github.com/vercel/next.js/discussions/87282",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 81967,
      "title": "Extremely High CPU Usage from next-server in Production (Next.js 15.4.3)",
      "question": "### Summary\n\nHi,\r\n\r\nI\u2019m experiencing very high CPU usage in production when running my Next.js app with next start. The issue began recently.\r\n\r\n**Environment**\r\n\r\n- Next.js Version: 15.4.3\r\n- Node.js Version: 18.18.2\r\n- PM2 Version: 5.3.0\r\n- OS: Ubuntu 22.04\r\n- Deployment Target: Self-hosted VPS\r\n- Start Command: next start (managed by PM2)\r\n- Package Manager: Yarn (berry)\r\n- Build Command: NODE_ENV=production yarn build\r\n- App Type: Custom app (not using Vercel)\r\n\r\n**Symptoms**\r\n\r\nAfter deployment, CPU usage spikes significantly:\r\n\r\n```\r\nPID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND\r\n855183 appuser   20   0   31.7g 639880  61068 R 103.3   1.9   5:01.09 next-server\r\n```\r\n\r\n- No specific page or route causes this.\r\n- No infinite loops or abnormal API polling detected.\r\n- Behavior persists even when traffic is low.\r\n\r\n**CI/CD Context**\r\n\r\nDeployment is fully automated using GitHub Actions. Here\u2019s a summary of what happens after a commit:\r\n\r\n```\r\n- name: Build\r\n  run: NODE_ENV=production yarn build\r\n\r\n- name: Deploy\r\n  run: |\r\n    rsync ./ to server\r\n    ssh server '\r\n      cd project &&\r\n      yarn install --production &&\r\n      pm2 restart \"my-app\"\r\n```\r\n    '\r\n\r\n **Question**\r\n\r\n- What could cause next-server to consume 100%+ CPU in a typical production next start run?\r\n- Are there any known regressions or debug flags I should use to trace this more deeply?\r\n- Thanks for your help! Happy to share a minimal reproduction if needed.\r\n\r\n\r\n\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_",
      "answer": "Thanks to everyone for responding and taking the time to help me solve the issue.\r\n\r\nI made some code adjustments that improved things a bit, but after extensive research, it turned out that the main cause of the high load was bots performing a full site scan at high speed, especially the \u201cClaude AI\u201d bot.\r\n\r\nThe problem was solved by adding protection measures such as Cloudflare, which reduced the load by more than 90%.\r\n\r\nI\u2019m sharing this here in case it helps someone else.",
      "category": "Help",
      "created_at": "2025-07-23T11:30:19Z",
      "url": "https://github.com/vercel/next.js/discussions/81967",
      "has_official_answer": true
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 77102,
      "title": "Next.js v15.2.2 Turbopack Dev server stuck in compiling + extreme CPU/memory usage",
      "question": "### Summary\r\n\r\nHi!\r\n\r\nWe're currently running smoothly with Next.js v15.2.0 and recently tried upgrading to 15.2.2 but noticed the Turbopack dev server stopped working. We didn't update any other of our packages. Here's what happens:\r\n\r\nAfter running `next dev --turbopack` it's basically just stuck in compiling the page:\r\n\r\n![CleanShot 2025-03-14 at 00 44 28@2x](https://github.com/user-attachments/assets/5641f8bb-21d7-4481-a99e-3b68a66bf4d4)\r\n\r\nThe Webpack warnings were also present in v15.2.0 (where it works) and are coming from Sentry afaik.\r\n\r\nMeanwhile CPU and memory are through the roof:\r\n\r\n![CleanShot 2025-03-14 at 00 43 59@2x](https://github.com/user-attachments/assets/15eede5a-8269-47fc-a2a5-43ccebf59680)\r\n\r\n![CleanShot 2025-03-14 at 00 41 54@2x](https://github.com/user-attachments/assets/e93d3c51-3207-4a4e-8d46-4e454575b3a7)\r\n\r\nEven after waiting 10min, nothing happened. It's just stuck in some sort of loop somehow. No error message or anything. Memory just keeps piling up and it still says \"compiling...\"\r\n\r\nHere's what I already tried to resolve the issue:\r\n\r\n- `rm -rf node_modules` + `package-lock.json`\r\n- `rm -rf .next`\r\n- fresh `npm install`\r\n- Upgrading to latest `15.3.0-canary.6`\r\n\r\nAll of those result in the same endless compile loop.\r\n\r\nNow, unfortunately this happens in our private company repo which I cannot share publicly, but I'm happy to provide more info or even invite a Vercel/Nextjs/Turbopack engineer to the repo to debug this if needed.\r\n\r\nAny hints on what is going on here?\r\n\r\nCheers!\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_",
      "answer": "I'm getting a variant of this of 15.2.3. It's absolutely insane. Everything will run fine for a little bit, then, randomly, it wall just hang and peg all of my cpu cores indefinitely. Restarted machine, cleared cache, etc. Nothing helps.",
      "category": "Turbopack Error Report",
      "created_at": "2025-03-13T23:54:15Z",
      "url": "https://github.com/vercel/next.js/discussions/77102",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89590,
      "title": "Turbopack Error: Failed to write app endpoint /page",
      "question": "Turbopack version: `v16.1.0-canary.22-59-g3aa53984e`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nFailed to write app endpoint /page\r\n\r\nCaused by:\r\n- Next.js package not found\r\n\r\nDebug info:\r\n- Execution of Project::hmr_version_state failed\r\n- Execution of Project::hmr_version failed\r\n- Execution of VersionedContentMap::get failed\r\n- Execution of VersionedContentMap::get_asset failed\r\n- Execution of VersionedContentMap::compute_entry failed\r\n- Execution of *emit_assets failed\r\n- Execution of all_assets_from_entries_operation failed\r\n- Execution of *all_assets_from_entries failed\r\n- Execution of endpoint_output_assets_operation failed\r\n- Execution of <AppEndpoint as Endpoint>::output failed\r\n- Failed to write app endpoint /page\r\n- Execution of AppEndpoint::output failed\r\n- Execution of AppEndpoint::app_page_entry failed\r\n- Execution of *get_app_page_entry failed\r\n- Execution of AppProject::rsc_module_context failed\r\n- Execution of *ModuleAssetContext::new failed\r\n- Execution of *AppProject::get_rsc_transitions failed\r\n- Execution of AppProject::ecmascript_client_reference_transition failed\r\n- Execution of *NextEcmascriptClientReferenceTransition::new failed\r\n- Execution of AppProject::ssr_transition failed\r\n- Execution of *FullContextTransition::new failed\r\n- Execution of AppProject::ssr_module_context failed\r\n- Execution of AppProject::shared_transition failed\r\n- Execution of *FullContextTransition::new failed\r\n- Execution of AppProject::shared_module_context failed\r\n- Execution of *ModuleAssetContext::new failed\r\n- Execution of get_server_resolve_options_context failed\r\n- Execution of get_next_server_import_map failed\r\n- Next.js package not found\r\n```",
      "answer": "Most of the time its corrupted node modules\r\nHave you tried deleting .next and node_modules and running npm (or yarn or pnpm) install again",
      "category": "Turbopack Error Report",
      "created_at": "2026-02-06T08:24:47Z",
      "url": "https://github.com/vercel/next.js/discussions/89590",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89580,
      "title": "Unexpected high serverless function usage on Vercel with Next.js App Router",
      "question": "Hi everyone \ud83d\udc4b\r\n\r\nI\u2019m running a Next.js (App Router) project on Vercel and noticed that my **Serverless Function usage is much higher than expected**, even though most of my pages should be cached.\r\n\r\nI\u2019m trying to understand what might be causing this.\r\n\r\n### Setup\r\n\r\n* Next.js App Router\r\n* Deployed on Vercel\r\n* Using `fetch` with `revalidate`\r\n* No obvious API routes being hit frequently\r\n* Traffic is moderate, but function invocations are surprisingly high\r\n\r\n### What confuses me\r\n\r\nI assumed that after the first request, pages would be served from cache and wouldn\u2019t keep invoking serverless functions.\r\n\r\nBut Vercel analytics show functions running far more often than expected.\r\n\r\n### Questions\r\n\r\n* What patterns in App Router cause functions to run on every request?\r\n* Does using cookies, headers, or dynamic data force SSR every time?\r\n* How can I verify whether a route is truly cached vs dynamically rendered?\r\n* What\u2019s the best way to reduce unnecessary function executions?\r\n\r\nIf anyone has insights into this or debugging tips, I\u2019d really appreciate the help.\r\n\r\nThanks!\r\n",
      "answer": "Hi! This is a very common confusion with the App Router on Vercel.\r\n\r\nWhat usually happens is that something in the route is silently forcing it to be **dynamic**, so Vercel can\u2019t serve it from the cache and has to run the Serverless Function on every request.\r\n\r\nThe most common triggers are:\r\n\r\n* Using `cookies()` or `headers()` anywhere in the tree\r\n* Reading request-specific data\r\n* `fetch` without proper caching config\r\n* Setting `cache: 'no-store'`\r\n* Using Server Actions in the same route\r\n* Having `export const dynamic = 'force-dynamic'` (even indirectly)\r\n\r\nAny of these make the route **SSR on every hit**.\r\n\r\n### How to verify\r\n\r\nCheck the response headers in the browser:\r\n\r\n* If you see: `x-vercel-cache: HIT` \u2192 served from cache\r\n* If you see: `MISS` or `BYPASS` \u2192 function executed\r\n\r\n### How to fix\r\n\r\nMake sure your data fetching looks like this:\r\n\r\n```ts\r\nawait fetch(url, {\r\n  next: { revalidate: 60 },\r\n});\r\n```\r\n\r\nAvoid using `cookies()` / `headers()` in pages that should be cached. If you need them, move that logic to a separate dynamic route or API route.\r\n\r\nYou can also explicitly force static behavior:\r\n\r\n```ts\r\nexport const dynamic = 'force-static';\r\n```\r\n\r\nOnce the route becomes truly static/ISR, you\u2019ll see function usage drop and `x-vercel-cache` start returning `HIT`.\r\n\r\nHope this saves you some function invocations ",
      "category": "App Router",
      "created_at": "2026-02-06T05:00:01Z",
      "url": "https://github.com/vercel/next.js/discussions/89580",
      "has_official_answer": true
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89532,
      "title": "Turbopack Error: failed to create junction point to ../../../node_modules/pg",
      "question": "Turbopack version: `23c46498`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nfailed to create junction point to ../../../node_modules/pg\r\n\r\nCaused by:\r\n- The file exists. (os error 80)\r\n```",
      "answer": "@MoniDSparkAI have you tried `npm cache clean --force`? When does this error happen so I can replicate this on my machine?",
      "category": "Turbopack Error Report",
      "created_at": "2026-02-05T13:07:09Z",
      "url": "https://github.com/vercel/next.js/discussions/89532",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89535,
      "title": "Intermittent Hydration Error After Page Reload with Better Auth getSession()",
      "question": "### Summary\n\n## Issue:\r\nIntermittent Hydration failed error that appears only after one or multiple 'F5' or 'Crlt + Shift + r' reloads (non-deterministic timing - sometimes 2 reloads, sometimes 10+). \r\nError occurs exclusively in (auth)/... route, never in (routes)/....\r\n\r\n### Environment:\r\n\r\nNext.js 16.1.6 (Turbopack)\r\nReact 19\r\nBetter Auth for authentication\r\n\r\n### Tests Performed (all unsuccessful):\r\n\r\n\u2705 Removed [ThemeProvider](vscode-file://vscode-app/c:/Users/adm-vitor/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) completely \u2192 error persists\r\n\u2705 Removed [Toaster](vscode-file://vscode-app/c:/Users/adm-vitor/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) \u2192 error persists\r\n\u2705 Removed [DynamicThemeToggle](vscode-file://vscode-app/c:/Users/adm-vitor/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) \u2192 error persists\r\n\u2705 Added [suppressHydrationWarning](vscode-file://vscode-app/c:/Users/adm-vitor/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) to all elements \u2192 error persists\r\n\u2705 Tested in Incognito mode (no extensions) \u2192 error persists\r\n\u2705 Removed [enableSystem](vscode-file://vscode-app/c:/Users/adm-vitor/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) from theme \u2192 error persists\r\n\u2705 Commented out redirect logic \u2192 error persists\r\n\u2705 Added AuthProvider wrapper \u2192 error persists\r\n\r\n### Specific Observations:\r\n\r\nIntermittent nature suggests non-deterministic factor\r\nTested in Incognito mode (no extensions)\r\nOnly happens after one or multiple (10+) page reloads\r\nOnly in (auth), never in (routes)\r\nTrace indicates server-side Suspense boundary mismatch\r\n\r\n### Question: \r\nIs this a known Next.js 16 issue with Turbopack and server components, or a subtle hydration timing issue I'm missing?\r\n\r\n### Component with error:\r\n`src/app/(pages)/(auth)/layout.tsx`\r\n\r\n```tsx\r\nimport { headers } from \"next/headers\";\r\nimport { redirect } from \"next/navigation\";\r\n\r\nimport { auth } from \"@/app/lib/auth\";\r\n\r\nexport default async function AuthLayout({\r\n  children\r\n}: Readonly<{\r\n  children: React.ReactNode;\r\n}>) {\r\n  const session = await auth.api.getSession({\r\n    headers: await headers()\r\n  });\r\n\r\n  if (session) {\r\n    redirect(\"/\");\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex h-full w-full items-center justify-center\"> // <--- Error \u274c\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n\r\n```\r\n\r\n<br />\r\n<br />\r\n\r\nhttps://github.com/user-attachments/assets/118dac69-7b4a-4ae6-be3a-89354ff7a8c4\r\n\r\n<img width=\"1919\" height=\"1021\" alt=\"image\" src=\"https://github.com/user-attachments/assets/b20a0197-41f8-42ea-a482-7caad8d85a95\" />\r\n\r\n\n\n### Additional information\n\n```js\nFolder Structure:\r\n\r\n\r\nmy-project/\r\n\u251c\u2500\u2500 src/\r\n\u2502   \u2514\u2500\u2500 app/\r\n\u2502       \u251c\u2500\u2500 (pages)/\r\n\u2502       \u2502   \u251c\u2500\u2500 layout.tsx                    (Root Layout - ThemeProvider commented)\r\n\u2502       \u2502   \u251c\u2500\u2500 (auth)/\r\n\u2502       \u2502   \u2502   \u251c\u2500\u2500 layout.tsx               (AuthLayout with getSession + redirect)\r\n\u2502       \u2502   \u2502   \u251c\u2500\u2500 sign-in/\r\n\u2502       \u2502   \u2502   \u2502   \u2514\u2500\u2500 page.tsx             (Client component with useForm)\r\n\u2502       \u2502   \u2502   \u2514\u2500\u2500 sign-up/\r\n\u2502       \u2502   \u2502       \u2514\u2500\u2500 page.tsx             (Client component with useForm)\r\n\u2502       \u2502   \u2514\u2500\u2500 (routes)/\r\n\u2502       \u2502       \u251c\u2500\u2500 layout.tsx               (Routes Layout - never fails)\r\n\u2502       \u2502       \u2514\u2500\u2500 ...\r\n\u2502       \u2514\u2500\u2500 components/\r\n\u2502           \u251c\u2500\u2500 providers/\r\n\u2502           \u2502   \u251c\u2500\u2500 theme-provider.tsx       (ThemeProvider with next-themes)\r\n\u2502           \u251c\u2500\u2500 shadcn/\r\n\u2502           \u2514\u2500\u2500 ui/\r\n\u2502               \u251c\u2500\u2500 theme-toggle.tsx\r\n\u2502               \u2514\u2500\u2500 dynamic-theme-toogle.tsx (Comentado)\r\n```\r\n\r\n\r\nError Trace Shows:\r\n```\r\nRecoverable Error\r\n\r\n\r\nHydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\r\n- A server/client branch `if (typeof window !== 'undefined')`.\r\n- Variable input such as `Date.now()` or `Math.random()` which changes each time it's called.\r\n- Date formatting in a user's locale which doesn't match the server.\r\n- External changing data without sending a snapshot of it along with the HTML.\r\n- Invalid HTML tag nesting.\r\n\r\nIt can also happen if the client has a browser extension installed which messes with the HTML before React loaded.\r\n```\r\n\r\n\r\n  ...\r\n    <RenderFromTemplateContext>\r\n      <ScrollAndFocusHandler segmentPath={[...]}>\r\n        <InnerScrollAndFocusHandler segmentPath={[...]} focusAndScrollRef={{apply:false, ...}}>\r\n          <ErrorBoundary errorComponent={undefined} errorStyles={undefined} errorScripts={undefined}>\r\n            <LoadingBoundary name=\"(pages)/\" loading={null}>\r\n              <HTTPAccessFallbackBoundary notFound={<SegmentViewNode>} forbidden={undefined} unauthorized={undefined}>\r\n                <HTTPAccessFallbackErrorBoundary pathname=\"/sign-in\" notFound={<SegmentViewNode>} forbidden={undefined} ...>\r\n                  <RedirectBoundary>\r\n                    <RedirectErrorBoundary router={{...}}>\r\n                      <InnerLayoutRouter url=\"/sign-in\" tree={[...]} params={{}} cacheNode={{...}} segmentPath={[...]} ...>\r\n                        <SegmentViewNode type=\"layout\" pagePath=\"(pages)/(a...\">\r\n                          <SegmentTrieNode>\r\n                          <AuthLayout>\r\n+                           <div className=\"flex h-full w-full items-center justify-center\">\r\n-                           <Suspense>\r\n                      ...\r\n          ...\r\n```\r\nCall Stack (12):\r\n```\r\n<unknown>\r\nhttps://react.dev/link/hydration-mismatch\r\nthrowOnHydrationMismatch\r\nnode_modules/next/dist/compiled/react-dom/cjs/react-dom-client.development.js (5530:11)\r\nbeginWork\r\nnode_modules/next/dist/compiled/react-dom/cjs/react-dom-client.development.js (12385:17)\r\nreplayBeginWork\r\nnode_modules/next/dist/compiled/react-dom/cjs/react-dom-client.development.js (19054:24)\r\nrunWithFiberInDEV\r\nnode_modules/next/dist/compiled/react-dom/cjs/react-dom-client.development.js (986:30)\r\nreplaySuspendedUnitOfWork\r\nnode_modules/next/dist/compiled/react-dom/cjs/react-dom-client.development.js (19018:18)\r\nrenderRootConcurrent\r\nnode_modules/next/dist/compiled/react-dom/cjs/react-dom-client.development.js (18901:21)\r\nperformWorkOnRoot\r\nnode_modules/next/dist/compiled/react-dom/cjs/react-dom-client.development.js (17834:11)\r\nperformWorkOnRootViaSchedulerTask\r\nnode_modules/next/dist/compiled/react-dom/cjs/react-dom-client.development.js (20384:7)\r\nMessagePort.performWorkUntilDeadline\r\nnode_modules/next/dist/compiled/scheduler/cjs/scheduler.development.js (45:48)\r\ndiv\r\n<anonymous>\r\nAuthLayout\r\nsrc\\app\\(pages)\\(auth)\\layout.tsx (20:5)\r\n```\n```\n\n\n### Example\n\n_No response_",
      "answer": "I'd move the authentication check to Middleware (`src/middleware.ts`). This prevents the request from ever reaching the Layout/React rendering phase if a redirect is needed, eliminating the race condition. \r\n\r\n```tsx\r\nimport { NextResponse, type NextRequest } from \"next/server\";\r\nimport { getSessionCookie } from \"better-auth/cookies\"; // you said you were using better-auth\r\n\r\nexport async function middleware(request: NextRequest) {\r\n  const { pathname } = request.nextUrl;\r\n  const isAuthRoute = pathname.startsWith(\"/sign-in\") || pathname.startsWith(\"/sign-up\");\r\n\r\n  const sessionCookie = getSessionCookie(request); \r\n\r\n  // If user is logged in and trying to access auth pages -> redirect to home page\r\n  if (sessionCookie && isAuthRoute) {\r\n    return NextResponse.redirect(new URL(\"/\", request.url));\r\n  }\r\n\r\n  return NextResponse.next();\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\r\n    // Apply to your auth routes\r\n    \"/sign-in\", \r\n    \"/sign-up\",\r\n  ],\r\n};\r\n```\r\n\r\nthan update `src/app/(pages)/(auth)/layout.tsx` : remove the async, the headers and the redirect logic from there",
      "category": "Help",
      "created_at": "2026-02-05T14:36:21Z",
      "url": "https://github.com/vercel/next.js/discussions/89535",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89477,
      "title": "Turbopack Error: Failed to write app endpoint /page",
      "question": "Turbopack version: `23c46498`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nTurbopack Error: Failed to write app endpoint /page\r\n```",
      "answer": "Will try it out today\r\n\r\nOn Wed, 4 Feb 2026, 14:45 Tim Pangersic, ***@***.***> wrote:\r\n\r\n> Have you tried deleting .next and node_modules and running npm (or yarn\r\n> or pnpm) install again\r\n>\r\n> \u2014\r\n> Reply to this email directly, view it on GitHub\r\n> <https://github.com/vercel/next.js/discussions/89477#discussioncomment-15693909>,\r\n> or unsubscribe\r\n> <https://github.com/notifications/unsubscribe-auth/BCIQNLYVJOM57HYTZWYXBXL4KHSXXAVCNFSM6AAAAACT5X73JCVHI2DSMVQWIX3LMV43URDJONRXK43TNFXW4Q3PNVWWK3TUHMYTKNRZGM4TAOI>\r\n> .\r\n> You are receiving this because you authored the thread.Message ID:\r\n> ***@***.***>\r\n>\r\n",
      "category": "Turbopack Error Report",
      "created_at": "2026-02-04T09:11:41Z",
      "url": "https://github.com/vercel/next.js/discussions/89477",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 71099,
      "title": "How to fix or disable this error in production mode \"An error occurred in the Server Components render...\"",
      "question": "An error occurred in the Server Components render. The specific message is omitted in production builds to avoid leaking sensitive details. A digest property is included on this error instance which may provide additional details about the nature of the error.\r\n\r\nThis error happends in production mode\r\n\r\nThis is how what i want to see\r\n![Screenshot (114)](https://github.com/user-attachments/assets/74d90e23-d517-4d78-a144-51f60f1a29ec)\r\n\r\nand this what I get\r\n![Screenshot (115)](https://github.com/user-attachments/assets/7b46a165-8a81-4ed2-9796-43380079440b)\r\n\r\nIn my actions fold for the login code (Server Side)\r\n![serverside](https://github.com/user-attachments/assets/d3d52b65-dd7b-4b5f-94a9-ce20c1fe48e9)\r\n\r\nIn my login page function (Client Side)\r\n![loginpage](https://github.com/user-attachments/assets/9415b2f9-503f-41c8-bac7-df34967dec04)\r\n",
      "answer": "I have gotten a solution to it. So, the issue comes from the error logging to the terminal. In production nextjs try to protect the app from releasing sensitive information to client because it cannot tell if the error is internal or external.\r\nFor example: \r\nIf the error is coming from a third-party service, you are using it might contain sensitive info like api-key, user ids, etc.\r\n\r\nSo, the solution was to find a different method to log the error to the user.\r\n\r\n\"client side code (login page function)\"\r\n\r\n![solution_code1](https://github.com/user-attachments/assets/5b030418-7052-4078-af0f-9d508ddf059e)\r\n\r\n\"Server side code (Action)\"\r\n\r\n![solution_code2](https://github.com/user-attachments/assets/b76c4f1e-1767-484f-88c5-a40524eec79a)\r\n",
      "category": "App Router",
      "created_at": "2024-10-10T15:15:03Z",
      "url": "https://github.com/vercel/next.js/discussions/71099",
      "has_official_answer": true
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89506,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `911504000`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nTurbopack Error: Next.js package not found\r\n```",
      "answer": "Most of the time its corrupted node modules\r\nHave you tried deleting `.next` and `node_modules` and running npm (or yarn or pnpm) install again\r\n",
      "category": "Turbopack Error Report",
      "created_at": "2026-02-04T23:56:25Z",
      "url": "https://github.com/vercel/next.js/discussions/89506",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89510,
      "title": "Turbopack Error: Failed to write app endpoint /page",
      "question": "Turbopack version: `d1bd5b58`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nTurbopack Error: Failed to write app endpoint /page\r\n```",
      "answer": "Most of the time its corrupted node modules\r\nHave you tried deleting `.next` and `node_modules` and running npm (or yarn or pnpm) install again\r\n\r\nreference: https://github.com/vercel/next.js/discussions/89369#discussioncomment-15694539",
      "category": "Turbopack Error Report",
      "created_at": "2026-02-05T01:41:20Z",
      "url": "https://github.com/vercel/next.js/discussions/89510",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89509,
      "title": "Turbopack Error: Failed to write app endpoint /page",
      "question": "Turbopack version: `23c46498`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nTurbopack Error: Failed to write app endpoint /page\r\n```",
      "answer": "Most of the time its corrupted node modules\r\nHave you tried deleting `.next` and `node_modules` and running npm (or yarn or pnpm) install again\r\n\r\nreference: https://github.com/vercel/next.js/discussions/89369#discussioncomment-15694539",
      "category": "Turbopack Error Report",
      "created_at": "2026-02-05T00:39:47Z",
      "url": "https://github.com/vercel/next.js/discussions/89509",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89369,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `v16.1.0-canary.19-84-g3aa53984e`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of subscribe_issues_and_diags_operation failed\r\n- Execution of endpoint_server_changed_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of directory_tree_to_loader_tree failed\r\n- Next.js package not found\r\n```",
      "answer": "Most common issue is corrupted `node_modules`\r\nAlso you are using a canary version of nextjs...\r\n\r\ntry the following in generally fixes the the problem\r\n```\r\n# npm or yarn or pnpm\r\nrm -rf node_modules package-lock.json .next\r\nnpm install\r\nnpm run dev\r\n```",
      "category": "Turbopack Error Report",
      "created_at": "2026-02-02T05:47:00Z",
      "url": "https://github.com/vercel/next.js/discussions/89369",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89528,
      "title": "Turbopack Error: Failed to write app endpoint /page",
      "question": "Turbopack version: `v16.1.0-canary.22-76-gacba4a6b9`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nFailed to write app endpoint /page\r\n\r\nCaused by:\r\n- Next.js package not found\r\n\r\nDebug info:\r\n- Execution of Project::hmr_version_state failed\r\n- Execution of Project::hmr_version failed\r\n- Execution of VersionedContentMap::get failed\r\n- Execution of VersionedContentMap::get_asset failed\r\n- Execution of VersionedContentMap::compute_entry failed\r\n- Execution of *emit_assets failed\r\n- Execution of all_assets_from_entries_operation failed\r\n- Execution of *all_assets_from_entries failed\r\n- Execution of endpoint_output_assets_operation failed\r\n- Execution of <AppEndpoint as Endpoint>::output failed\r\n- Failed to write app endpoint /page\r\n- Execution of AppEndpoint::output failed\r\n- Execution of AppEndpoint::app_page_entry failed\r\n- Execution of *get_app_page_entry failed\r\n- Execution of AppProject::rsc_module_context failed\r\n- Execution of *ModuleAssetContext::new failed\r\n- Execution of *AppProject::get_rsc_transitions failed\r\n- Execution of AppProject::ecmascript_client_reference_transition failed\r\n- Execution of *NextEcmascriptClientReferenceTransition::new failed\r\n- Execution of AppProject::ssr_transition failed\r\n- Execution of *FullContextTransition::new failed\r\n- Execution of AppProject::ssr_module_context failed\r\n- Execution of AppProject::shared_transition failed\r\n- Execution of *FullContextTransition::new failed\r\n- Execution of AppProject::shared_module_context failed\r\n- Execution of *ModuleAssetContext::new failed\r\n- Execution of get_server_resolve_options_context failed\r\n- Execution of get_next_server_import_map failed\r\n- Next.js package not found\r\n```",
      "answer": "Most of the time its corrupted node modules\r\nHave you tried deleting `.next` and `node_modules` and running npm (or yarn or pnpm) install again\r\n\r\nreference: https://github.com/vercel/next.js/discussions/89369#discussioncomment-15694539",
      "category": "Turbopack Error Report",
      "created_at": "2026-02-05T10:24:26Z",
      "url": "https://github.com/vercel/next.js/discussions/89528",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 32665,
      "title": "ENAMETOOLONG on long slug",
      "question": "I'm facing this issue when slug is too long, any way to fix this other than trimming slug?\r\nWhat is the maximum limit for slug in this case?\r\n\r\nHappening in production only, works fine in dev environment.\r\n\r\n```\r\nFailed to update prerender files for /en-IN/product/nakpro-perform-whey-protein-concentrate-24g-protein-5-7g-bcaa-4-7g-glutamine-helps-build-your-muscle-size-added-digestive-enzymes-easy-mixing-low-carbs-easy-digesting-fast-absorbing-raw-whey-protein-supplement-powder-for-men-women-athletes-1-kg-unflavoured-30-servings \r\n[Error: ENAMETOOLONG: name too long, open '/Users/sukh/Documents/Next/phnew/.next/server/pages/en-IN/product/nakpro-perform-whey-protein-concentrate-24g-protein-5-7g-bcaa-4-7g-glutamine-helps-build-your-muscle-size-added-digestive-enzymes-easy-mixing-low-carbs-easy-digesting-fast-absorbing-raw-whey-protein-supplement-powder-for-men-women-athletes-1-kg-unflavoured-30-servings.html'] \r\n{\r\n  errno: -63,\r\n  code: 'ENAMETOOLONG',\r\n  syscall: 'open',\r\n  path: '/Users/sukh/Documents/Next/phnew/.next/server/pages/en-IN/product/nakpro-perform-whey-protein-concentrate-24g-protein-5-7g-bcaa-4-7g-glutamine-helps-build-your-muscle-size-added-digestive-enzymes-easy-mixing-low-carbs-easy-digesting-fast-absorbing-raw-whey-protein-supplement-powder-for-men-women-athletes-1-kg-unflavoured-30-servings.html'\r\n}\r\n```",
      "answer": "This is still a problem. I think Next.js definitely should validate that the path is not too long before trying write the files. While it probably doesn't cause any harm if you limited the amount of logs, it is still quite annoying.\r\n\r\nIn my case some bot crawlers started trying to crawl paths like: `/fyysikkokilta.fi%25252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252520%252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525281%25252525252525252525252525252525252525252525252525252525252525252525252525252525252525252525252529.gz` which are obviously too long. While I can block the bots by matching the user agent, I would not like to block something like BingBot. And that doesn't block some attacker from maliciously spamming requests with long paths.\r\n\r\nAs said above, this only happens in production with ISR enabled dynamic routes. Also it seems like the error happens only once for each path.\r\n\r\nThis is not a Linux specific problem. I think pretty much all operating systems have some sort of limit for the filename or path.\r\n\r\nThere is actually more info about this in [Turbopack code](https://github.com/vercel/next.js/blob/ca1e1c7d7b2cf6ac040a4f2bda4b5315ab6b439c/turbopack/crates/turbo-tasks-fs/src/lib.rs#L90-L127). ",
      "category": "Help",
      "created_at": "2021-12-20T07:02:35Z",
      "url": "https://github.com/vercel/next.js/discussions/32665",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89464,
      "title": "Turbopack Error: Failed to write app endpoint /page",
      "question": "Turbopack version: `23c46498`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nTurbopack Error: Failed to write app endpoint /page\r\n```",
      "answer": "Most of the time its corrupted node modules\r\nHave you tried deleting `.next` and `node_modules` and running npm (or yarn or pnpm) install again\r\n\r\nreference: https://github.com/vercel/next.js/discussions/89369#discussioncomment-15694539",
      "category": "Turbopack Error Report",
      "created_at": "2026-02-04T02:59:28Z",
      "url": "https://github.com/vercel/next.js/discussions/89464",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 84856,
      "title": "Turbopack Error: Permission denied (os error 13)",
      "question": "Turbopack version: `ff756b2c`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nPermission denied (os error 13)\r\n\r\nDebug info:\r\n- Execution of TaskId { id: 2147483648 } transient failed\r\n- Permission denied (os error 13)\r\n```",
      "answer": "I am using ubuntu.\r\n\r\ndev@dev-virtual-machine:~/Documents/nomiss-admin$ rm -rf .next .turbo && npm run dev\r\n\r\n> nomiss-admin@0.1.0 dev\r\n> next dev --turbopack\r\n\r\n   \u25b2 Next.js 15.5.0 (Turbopack)\r\n   - Local:        http://localhost:3000\r\n   - Network:      http://192.168.111.129:3000\r\n   - Environments: .env.local\r\n\r\n \u2713 Starting...\r\n\r\n-----\r\nFATAL: An unexpected Turbopack error occurred. A panic log has been written to /tmp/next-panic-4eb74cad627bab61c15b4b578468ef9c.log.\r\n\r\nTo help make Turbopack better, report this error by clicking here.\r\n-----\r\n\r\nError [TurbopackInternalError]: Permission denied (os error 13)\r\n\r\nDebug info:\r\n- Execution of TaskId { id: 2147483648 } transient failed\r\n- Permission denied (os error 13)\r\n    at <unknown> (TurbopackInternalError: Permission denied (os error 13)) {\r\n  location: undefined\r\n}\r\n\r\n\r\nLike the above error is happening.",
      "category": "Turbopack Error Report",
      "created_at": "2025-10-14T08:14:08Z",
      "url": "https://github.com/vercel/next.js/discussions/84856",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89520,
      "title": "Turbopack Error: Next build stopped running on Github actions and Local",
      "question": "Turbopack version: `23c46498`\r\nNext.js version: `16.1.6`\r\n\r\nError message:\r\n```\r\nDependency tracking is disabled so invalidation is not allowed at C:\\actions-runner\\_work\\next.js\\next.js\\turbopack\\crates\\turbo-tasks-backend\\src\\backend\\mod.rs:1526:13\r\n```",
      "answer": "Found resolution - \"duplicate\" metadata files in the /app directory. Because Next.js automatically treats files named icon as special metadata, having both icon.png and icon.ico creates a conflict in the compiler's dependency graph.\r\n\r\nI had 2 files in the /app - icon.png and icon.ico from which I deleted the latter and it worked.",
      "category": "Turbopack Error Report",
      "created_at": "2026-02-05T08:01:08Z",
      "url": "https://github.com/vercel/next.js/discussions/89520",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 80997,
      "title": "Next.js 15: CSP headers not applied in production unless await headers() is called",
      "question": "### **Summary**\r\nI've encountered an issue with Next.js 15 where Content Security Policy (CSP) headers don't seem to be properly applied in production builds unless `await headers()` is called in the page component **AND the CSP includes a nonce**. I'm wondering if this is a known issue or if I'm missing something in my implementation.\r\n\r\n### **The Problem I'm Experiencing**\r\n\r\n#### **Development Mode (`npm run dev`)**\r\n- \u2705 CSP works correctly without any special code\r\n- \u2705 Middleware sets CSP headers properly\r\n- \u2705 No additional `await headers()` call needed\r\n\r\n#### **Production Mode (`npm run build -> npm run start`)**\r\n- \u274c **Simple CSP like `script-src 'self'` causes errors**\r\n- \u274c **Nonce-based CSP without `await headers()` still causes errors**\r\n- \u2705 **Nonce-based CSP + `await headers()` works correctly**\r\n\r\n### **My Reproduction Steps**\r\n\r\n1. **Created a Next.js 15 app with simple CSP middleware:**\r\n```typescript\r\n// middleware.ts\r\nexport function middleware() {\r\n  const response = NextResponse.next();\r\n  // This simple CSP causes errors in production\r\n  response.headers.set(\"Content-Security-Policy\", \"script-src 'self'\");\r\n  return response;\r\n}\r\n```\r\n\r\n2. **Created a simple page without `await headers()`:**\r\n```typescript\r\n// app/page.tsx\r\nexport default async function Home() {\r\n  return <h1>Hello World</h1>;\r\n}\r\n```\r\n\r\n3. **Built and started in production:**\r\n```bash\r\nnpm run build\r\nnpm run start\r\n```\r\n\r\n4. **Result:** CSP violations and blocked scripts\r\n\r\n5. **My workaround:** Added `await headers()` to the page:\r\n```typescript\r\nimport { headers } from \"next/headers\";\r\n\r\nexport default async function Home() {\r\n  await headers(); // This \"fixes\" the CSP only when nonce added\r\n  return <h1>Hello World</h1>;\r\n}\r\n```\r\n\r\n### **What I've Tested**\r\n\r\n#### **\u274c Doesn't work in production without `await headers()`:**\r\n```typescript\r\n// Simple CSP - causes errors\r\nresponse.headers.set(\"Content-Security-Policy\", \"script-src 'self'\");\r\n```\r\n\r\n#### **\u274c Doesn't work in production without `await headers()`:**\r\n```typescript\r\n// Nonce-based CSP - still causes errors\r\nresponse.headers.set(\"Content-Security-Policy\", \"script-src 'self' 'nonce-\" + nonce + \"'\");\r\n```\r\n\r\n#### **\u2705 Works in production with `await headers()`:**\r\n```typescript\r\n// Nonce-based CSP + await headers() - works correctly\r\nresponse.headers.set(\"Content-Security-Policy\", \"script-src 'self' 'nonce-\" + nonce + \"'\");\r\n// AND in page component:\r\nawait headers();\r\n```\r\n\r\n### **Error Messages I'm Seeing Without the Workaround**\r\n```\r\nRefused to execute inline script because it violates the following Content Security Policy directive:\r\n```\r\n\r\n### **My Questions**\r\n\r\n1. **Is this a known issue** in Next.js 15, or am I missing something in my implementation?\r\n2. **Is my workaround appropriate** or is there a better way to handle this?\r\n3. **Should I be calling `await headers()`** in my pages/layouts, or is this unintended behavior?\r\n4. **Why does this only affect production builds** and not development mode?\r\n5. **Is there a way to make CSP work** without requiring `await headers()` in every page?\r\n\r\n### **My Current Workaround**\r\nI'm currently adding `await headers()` to my root layout:\r\n```typescript\r\n// app/layout.tsx\r\nimport { headers } from \"next/headers\";\r\n\r\nexport default async function RootLayout({\r\n  children,\r\n}: {\r\n  children: React.ReactNode;\r\n}) {\r\n  await headers(); // This seems to fix the CSP issue\r\n  return (\r\n    <html lang=\"en\">\r\n      <body>{children}</body>\r\n    </html>\r\n  );\r\n}\r\n\r\n\r\n// app/middleware.ts\r\n```\r\n\r\n### **Environment**\r\n- **Next.js Version:** 15.x\r\n- **Node.js Version:** 18+\r\n- **Reproduces:** Only in production builds (`next start`)\r\n- **Does not reproduce:** In development mode (`next dev`)\r\n\r\n### **What I'm Looking For**\r\n- Confirmation if this is a real issue or if I'm doing something wrong\r\n- Guidance on whether my workaround is appropriate\r\n- Information about whether this is documented somewhere I missed\r\n- Any better solutions or approaches I should consider\r\n\r\nI'd really appreciate any insights from the community on whether this is expected behavior or if there's something I should be doing differently. Thank you for your help!",
      "answer": "HI,\r\n\r\nWhat you need is to make your page dynamic ~ https://nextjs.org/docs/app/guides/content-security-policy#adding-a-nonce-with-middleware\r\n\r\nTry with `export const dynamic = 'force-dynamic'`\r\n\r\n> Every time a page is viewed, a fresh nonce should be generated. This means that you must use dynamic rendering to add nonces.\r\n\r\nI have merged a documentation update pointing to dynamic rendering, but it hasn't deployed to the docs site yet.\r\n\r\nOtherwise, a page gets opted-in to static rendering, and then the nonce is not applied to the scripts in the HTML send to the browser, cuz it ws already made during build time. \r\n\r\nAlso I was testing out with `use client` components, and found an issue too. ",
      "category": "App Router",
      "created_at": "2025-06-27T12:52:17Z",
      "url": "https://github.com/vercel/next.js/discussions/80997",
      "has_official_answer": true
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89502,
      "title": "Where / How do I apply rate limiting?",
      "question": "### Summary\n\nSo I have a contact form getting lots of spam. \r\n\r\nWhere do I go to apply rate limiting in Vercel? \n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_",
      "answer": "You can set limits on the endpoint getting spammed, let me fetch some docs for ya\r\n\r\n- https://vercel.com/docs/vercel-firewall/vercel-waf/rate-limiting#get-started\r\n\r\nYou can set it immediately there. For example if your contact form submits to `/api/contact` you'd put that endpoint there and chose which options you think are best.\r\n\r\n<img width=\"928\" height=\"740\" alt=\"Screenshot 2026-02-04 at 20 27 25\" src=\"https://github.com/user-attachments/assets/886bedb5-66e6-4775-a83a-08e4dffeb990\" />\r\n\r\n\r\n",
      "category": "Help",
      "created_at": "2026-02-04T19:19:14Z",
      "url": "https://github.com/vercel/next.js/discussions/89502",
      "has_official_answer": true
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 82651,
      "title": "Turbopack throwing Failed to load chunk /_next/static/chunks/xxx.js from module yyy in production",
      "question": "We've been getting a lot of sentry errors saying Failed to load chunk from module xxx in production. We're building the app with turbopack build. These errors dont block the ui. They are only console errors. They seem to only come during prefetching of the next page(nextjs automatically prefetching links on the page) and never come on current page(at least I haven't noticed them there). I haven't been able to reproduce locally personally on our project so I can't create a reproduction. \r\n\r\nFurthermore, when I look at our vercel logs, the chunks that threw error seem to be actually successfully requested by the user. Tried to look at turbopack source and It looks like that error would only be thrown if script.onerror gets invoked which makes no sense since the request for the chunk seemed to be successful. Also the error is intermittent and I personally haven't been able to repro myself but we do get several errors per day about this and it is reported/captured in sentry and posthog\r\n\r\nThis issue isn't really turbopack specific. We recently switched from webpack build to turbopack build. Before the switch we were facing issues like TypeError: can't access property \"call\", e[a] is undefined. This felt like a more cryptic error message but suggests that webpack was unable to find a module/chunk that should've been there. It also happened during prefetching of chunks related to other routes. This error keeps creating new issues in sentry since the chunk names, etc are different\r\n\r\nI was wondering if we should ignore this error in sentry since it doesn't cause the ui to break or if there's something else to do to fix it. Or maybe I should provide more info?\r\n\r\nOne example of the error in posthog\r\n<img width=\"839\" height=\"775\" alt=\"Screenshot 2025-08-14 at 3 40 11\u202fPM\" src=\"https://github.com/user-attachments/assets/d4227a54-abcc-496e-8054-62e678ce9566\" />\r\n\r\nActual request to get the chunk for the example\r\n<img width=\"957\" height=\"365\" alt=\"Screenshot 2025-08-14 at 3 27 40\u202fPM\" src=\"https://github.com/user-attachments/assets/6bd3aa34-5021-4904-84f4-1f264aeeb304\" />",
      "answer": "Also happening to us after upgrade to next16:\r\n\"Application error: a client-side exception has occurred while loading ui.staging1.abillify.dev (see the browser console for more information).\"\r\n->\r\n```\r\nUncaught Error: Failed to load chunk /_next/static/chunks/950e6aaa75.js from module 12321\r\n    at turbopack-c48596aea1a3b96b.js:1:5745",
      "category": "Turbopack Error Report",
      "created_at": "2025-08-14T14:41:14Z",
      "url": "https://github.com/vercel/next.js/discussions/82651",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 54840,
      "title": "Problem getting cookie in API route",
      "question": "### Summary\r\n\r\n\r\nI'm implementing an authentication flow where I can save a cookie, see it in storage and manipulate it through a server component.\r\nHowever, I'm having trouble getting this cookie in a route API, all my attempts return an undefined or null.\r\n\r\n### The code to set cookie \r\n(Using cookies from next/headers)\r\n\r\n![set cookie](https://github.com/vercel/next.js/assets/20816564/a0b8e9a7-8001-48c3-ba7f-65a8192820c1)\r\n\r\n### Showing stored cookie\r\n\r\n![Cookie Storage](https://github.com/vercel/next.js/assets/20816564/33ff7209-a8e7-45cf-9aaf-da5d34964fca)\r\n\r\n### The result in API Route\r\n\r\n![Console log](https://github.com/vercel/next.js/assets/20816564/97fd5386-dd43-4cec-99ca-e679ec0debc0)\r\n\r\n### Working in server component\r\n\r\n![SSR](https://github.com/vercel/next.js/assets/20816564/c75ca62b-a40d-443d-9d31-a9d29fbc2653)\r\n\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_",
      "answer": "I found one hacky solution which is works for me\r\nThough cookie is working on the server component I grave cookie and than pass it to the request headers\r\n\r\n Server action\r\n```\r\n const cookieStore = await cookies()\r\n  const sessionId = cookieStore.get('cart_session')?.value\r\n  const response = await fetch(`/api/cart`, {\r\n    headers: {\r\n      'Cookie': sessionId ?? ''\r\n    }\r\n  })\r\n```\r\n\r\nnow route handler I can get from header\r\n\r\n```\r\nexport const GET = async (request: NextRequest) => {\r\n  const headerList = request.headers\r\n  const sessionId= headerList.get('cookie')\r\n}\r\n```",
      "category": "Help",
      "created_at": "2023-08-31T14:14:50Z",
      "url": "https://github.com/vercel/next.js/discussions/54840",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 88981,
      "title": "Turbopack Error: Failed to write app endpoint /page",
      "question": "Turbopack version: `da605e0c`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nFailed to write app endpoint /page\r\n\r\nCaused by:\r\n- app_dir must be a directory\r\n\r\nDebug info:\r\n- Execution of Project::hmr_version_state failed\r\n- Execution of Project::hmr_version failed\r\n- Execution of VersionedContentMap::get failed\r\n- Execution of VersionedContentMap::get_asset failed\r\n- Execution of VersionedContentMap::compute_entry failed\r\n- Execution of *emit_assets failed\r\n- Execution of all_assets_from_entries_operation failed\r\n- Execution of *all_assets_from_entries failed\r\n- Execution of endpoint_output_assets_operation failed\r\n- Execution of <AppEndpoint as Endpoint>::output failed\r\n- Failed to write app endpoint /page\r\n- Execution of AppEndpoint::output failed\r\n- Execution of AppEndpoint::app_page_entry failed\r\n- Execution of *get_app_page_entry failed\r\n- Execution of AppProject::rsc_module_context failed\r\n- Execution of *ModuleAssetContext::new failed\r\n- Execution of AppProject::rsc_resolve_options_context failed\r\n- Execution of *get_server_resolve_options_context failed\r\n- Execution of AppProject::collected_root_params failed\r\n- Execution of *collect_root_params failed\r\n- Execution of get_entrypoints failed\r\n- Execution of *directory_tree_to_entrypoints failed\r\n- Execution of get_global_metadata failed\r\n- app_dir must be a directory\r\n```",
      "answer": "This discussion appears to be a duplicate of #87816.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/87816\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2026-01-24T08:57:31Z",
      "url": "https://github.com/vercel/next.js/discussions/88981",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89327,
      "title": "Turbopack Error: Failed to write app endpoint /(main)/dashboard/page",
      "question": "Turbopack version: `v16.1.0-canary.19-84-g3aa53984e`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nFailed to write app endpoint /(main)/dashboard/page\r\n\r\nCaused by:\r\n- Next.js package not found\r\n\r\nDebug info:\r\n- Execution of Project::hmr_version_state failed\r\n- Execution of Project::hmr_version failed\r\n- Execution of VersionedContentMap::get failed\r\n- Execution of VersionedContentMap::get_asset failed\r\n- Execution of VersionedContentMap::compute_entry failed\r\n- Execution of *emit_assets failed\r\n- Execution of all_assets_from_entries_operation failed\r\n- Execution of *all_assets_from_entries failed\r\n- Execution of endpoint_output_assets_operation failed\r\n- Execution of <AppEndpoint as Endpoint>::output failed\r\n- Failed to write app endpoint /(main)/dashboard/page\r\n- Execution of AppEndpoint::output failed\r\n- Execution of AppEndpoint::app_page_entry failed\r\n- Execution of *get_app_page_entry failed\r\n- Execution of AppProject::rsc_module_context failed\r\n- Execution of *ModuleAssetContext::new failed\r\n- Execution of *AppProject::get_rsc_transitions failed\r\n- Execution of AppProject::ecmascript_client_reference_transition failed\r\n- Execution of *NextEcmascriptClientReferenceTransition::new failed\r\n- Execution of AppProject::ssr_transition failed\r\n- Execution of *FullContextTransition::new failed\r\n- Execution of AppProject::ssr_module_context failed\r\n- Execution of AppProject::shared_transition failed\r\n- Execution of *FullContextTransition::new failed\r\n- Execution of AppProject::shared_module_context failed\r\n- Execution of *ModuleAssetContext::new failed\r\n- Execution of get_server_resolve_options_context failed\r\n- Execution of get_next_server_import_map failed\r\n- Next.js package not found\r\n```",
      "answer": "This discussion appears to be a duplicate of #87816.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/87816\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2026-01-31T05:54:51Z",
      "url": "https://github.com/vercel/next.js/discussions/89327",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89382,
      "title": "Turbopack Error: Failed to write app endpoint /login/page",
      "question": "Turbopack version: `23c46498`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nFailed to write app endpoint /login/page\r\n\r\nCaused by:\r\n- Next.js package not found\r\n\r\nDebug info:\r\n- Execution of Project::hmr_version_state failed\r\n- Execution of Project::hmr_version failed\r\n- Execution of VersionedContentMap::get failed\r\n- Execution of VersionedContentMap::get_asset failed\r\n- Execution of VersionedContentMap::compute_entry failed\r\n- Execution of *emit_assets failed\r\n- Execution of all_assets_from_entries_operation failed\r\n- Execution of *all_assets_from_entries failed\r\n- Execution of endpoint_output_assets_operation failed\r\n- Execution of <AppEndpoint as Endpoint>::output failed\r\n- Failed to write app endpoint /login/page\r\n- Execution of AppEndpoint::output failed\r\n- Execution of AppEndpoint::app_page_entry failed\r\n- Execution of *get_app_page_entry failed\r\n- Execution of AppProject::rsc_module_context failed\r\n- Execution of *ModuleAssetContext::new failed\r\n- Execution of *AppProject::get_rsc_transitions failed\r\n- Execution of AppProject::ecmascript_client_reference_transition failed\r\n- Execution of *NextEcmascriptClientReferenceTransition::new failed\r\n- Execution of AppProject::ssr_transition failed\r\n- Execution of *FullContextTransition::new failed\r\n- Execution of AppProject::ssr_module_context failed\r\n- Execution of AppProject::shared_transition failed\r\n- Execution of *FullContextTransition::new failed\r\n- Execution of AppProject::shared_module_context failed\r\n- Execution of *ModuleAssetContext::new failed\r\n- Execution of get_server_resolve_options_context failed\r\n- Execution of get_next_server_import_map failed\r\n- Next.js package not found\r\n```",
      "answer": "This discussion appears to be a duplicate of #87816.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/87816\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2026-02-02T10:21:25Z",
      "url": "https://github.com/vercel/next.js/discussions/89382",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89397,
      "title": "Turbopack Error: Failed to write app endpoint /[lng]/example/page",
      "question": "Turbopack version: `d1bd5b58`\r\nNext.js version: \"^16.1.1\"\r\n\r\nError message:\r\n```\r\nFailed to write app endpoint /[lng]/example/page\r\n\r\nCaused by:\r\n- Next.js package not found\r\n\r\nDebug info:\r\n- Execution of Project::hmr_version_state failed\r\n- Execution of Project::hmr_version failed\r\n- Execution of VersionedContentMap::get failed\r\n- Execution of VersionedContentMap::get_asset failed\r\n- Execution of VersionedContentMap::compute_entry failed\r\n- Execution of *emit_assets failed\r\n- Execution of all_assets_from_entries_operation failed\r\n- Execution of *all_assets_from_entries failed\r\n- Execution of endpoint_output_assets_operation failed\r\n- Execution of <AppEndpoint as Endpoint>::output failed\r\n- Failed to write app endpoint /[lng]/my-account/trade-history/page\r\n- Execution of AppEndpoint::output failed\r\n- Execution of AppEndpoint::app_page_entry failed\r\n- Execution of *get_app_page_entry failed\r\n- Execution of AppProject::rsc_module_context failed\r\n- Execution of *ModuleAssetContext::new failed\r\n- Execution of *AppProject::get_rsc_transitions failed\r\n- Execution of AppProject::ecmascript_client_reference_transition failed\r\n- Execution of *NextEcmascriptClientReferenceTransition::new failed\r\n- Execution of AppProject::ssr_transition failed\r\n- Execution of *FullContextTransition::new failed\r\n- Execution of AppProject::ssr_module_context failed\r\n- Execution of AppProject::shared_transition failed\r\n- Execution of *FullContextTransition::new failed\r\n- Execution of AppProject::shared_module_context failed\r\n- Execution of *ModuleAssetContext::new failed\r\n- Execution of get_server_resolve_options_context failed\r\n- Execution of get_next_server_import_map failed\r\n- Next.js package not found\r\n```\r\nwhenever I run app with Turbopack, in a page I get stuck in infinite refresh loop",
      "answer": "This discussion appears to be a duplicate of #87816.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/87816\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2026-02-02T14:20:50Z",
      "url": "https://github.com/vercel/next.js/discussions/89397",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89475,
      "title": "Turbopack Error: Failed to write app endpoint /page",
      "question": "Turbopack version: `da605e0c`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nFailed to write app endpoint /page\r\n\r\nCaused by:\r\n- Next.js package not found\r\n\r\nDebug info:\r\n- Execution of Project::hmr_version_state failed\r\n- Execution of Project::hmr_version failed\r\n- Execution of VersionedContentMap::get failed\r\n- Execution of VersionedContentMap::get_asset failed\r\n- Execution of VersionedContentMap::compute_entry failed\r\n- Execution of *emit_assets failed\r\n- Execution of all_assets_from_entries_operation failed\r\n- Execution of *all_assets_from_entries failed\r\n- Execution of endpoint_output_assets_operation failed\r\n- Execution of <AppEndpoint as Endpoint>::output failed\r\n- Failed to write app endpoint /page\r\n- Execution of AppEndpoint::output failed\r\n- Execution of AppEndpoint::app_page_entry failed\r\n- Execution of *get_app_page_entry failed\r\n- Execution of AppProject::rsc_module_context failed\r\n- Execution of *ModuleAssetContext::new failed\r\n- Execution of *AppProject::get_rsc_transitions failed\r\n- Execution of AppProject::ecmascript_client_reference_transition failed\r\n- Execution of *NextEcmascriptClientReferenceTransition::new failed\r\n- Execution of AppProject::ssr_transition failed\r\n- Execution of *FullContextTransition::new failed\r\n- Execution of AppProject::ssr_module_context failed\r\n- Execution of AppProject::shared_transition failed\r\n- Execution of *FullContextTransition::new failed\r\n- Execution of AppProject::shared_module_context failed\r\n- Execution of *ModuleAssetContext::new failed\r\n- Execution of get_server_resolve_options_context failed\r\n- Execution of get_next_server_import_map failed\r\n- Next.js package not found\r\n```",
      "answer": "This discussion appears to be a duplicate of #87816.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/87816\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2026-02-04T08:53:27Z",
      "url": "https://github.com/vercel/next.js/discussions/89475",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89496,
      "title": "Turbopack Error: Failed to write app endpoint /page",
      "question": "Turbopack version: `d1bd5b58`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nFailed to write app endpoint /page\r\n\r\nCaused by:\r\n- Next.js package not found\r\n\r\nDebug info:\r\n- Execution of Project::hmr_version_state failed\r\n- Execution of Project::hmr_version failed\r\n- Execution of VersionedContentMap::get failed\r\n- Execution of VersionedContentMap::get_asset failed\r\n- Execution of VersionedContentMap::compute_entry failed\r\n- Execution of *emit_assets failed\r\n- Execution of all_assets_from_entries_operation failed\r\n- Execution of *all_assets_from_entries failed\r\n- Execution of endpoint_output_assets_operation failed\r\n- Execution of <AppEndpoint as Endpoint>::output failed\r\n- Failed to write app endpoint /page\r\n- Execution of AppEndpoint::output failed\r\n- Execution of AppEndpoint::app_page_entry failed\r\n- Execution of *get_app_page_entry failed\r\n- Execution of AppProject::rsc_module_context failed\r\n- Execution of *ModuleAssetContext::new failed\r\n- Execution of *AppProject::get_rsc_transitions failed\r\n- Execution of AppProject::ecmascript_client_reference_transition failed\r\n- Execution of *NextEcmascriptClientReferenceTransition::new failed\r\n- Execution of AppProject::ssr_transition failed\r\n- Execution of *FullContextTransition::new failed\r\n- Execution of AppProject::ssr_module_context failed\r\n- Execution of AppProject::shared_transition failed\r\n- Execution of *FullContextTransition::new failed\r\n- Execution of AppProject::shared_module_context failed\r\n- Execution of *ModuleAssetContext::new failed\r\n- Execution of get_server_resolve_options_context failed\r\n- Execution of get_next_server_import_map failed\r\n- Next.js package not found\r\n```",
      "answer": "Most of the time its corrupted node modules\r\nHave you tried deleting `.next` and `node_modules` and running npm (or yarn or pnpm) install again\r\n\r\nreference: https://github.com/vercel/next.js/discussions/89369#discussioncomment-15694539",
      "category": "Turbopack Error Report",
      "created_at": "2026-02-04T16:23:03Z",
      "url": "https://github.com/vercel/next.js/discussions/89496",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 85605,
      "title": "What is the correct way to support older browsers in Next.js applications?",
      "question": "### Summary\r\n\r\nHello. I created an application with Next.js 16 and tested whether polyfills work properly in older browsers. I understood that Next.js injects polyfill scripts according to the `browserslist` in package.json, and I expected all features to work normally in Chrome 64 and above when specifying the `browserslist` as shown below.\r\n\r\n```\r\n\"browserslist\": [\r\n  \"chrome 64\",\r\n  \"safari 12\"\r\n],\r\n```\r\n\r\nI tested my polyfill features page ([repository](https://github.com/parksb/vercel-nextjs-issue), [live](https://vercel-nextjs-issue.vercel.app/)) on BrowserStack using Chrome versions 64 and 90. And I got the following results.\r\n\r\n| expected result |\r\n|----|\r\n| <img width=\"500\" height=\"634\" alt=\"image\" src=\"https://github.com/user-attachments/assets/2bb38728-1420-4029-a192-bd24be278bd4\" /> |\r\n\r\n### The polyfill script injected by Next.js does not load\r\n\r\nIt appears that the `<script src=\"/_next/static/chunks/<hash>.js\" nomodule=\"\"></script>` tag that Next.js inserts in the HTML head tag is the polyfill script, but the script did not actually load in either Chrome 64 or 90. Since the script tag has the \"nomodule\" attribute, it seems that the script not loading from Chrome 61 onwards (which supports ESM) is the normal behavior. Does this mean we cannot expect polyfills in Chrome 64?\r\n\r\n### A \"globalThis is not defined\" error occurs in Chrome 64\r\n\r\nIn Chrome version 64, a \"globalThis is not defined\" error occurred. This seems to be because globalThis has been supported since Chrome 71. Is there a way to polyfill it?\r\n\r\n| actual result in Chrome 64 |\r\n|---|\r\n| <img width=\"500\" height=\"279\" alt=\"image\" src=\"https://github.com/user-attachments/assets/32053c0a-4f14-419a-ab9b-09f7ff32b418\" /> |\r\n\r\n### Some features do not work in Chrome 90\r\n\r\nIn Chrome version 90, features that should have succeeded if polyfilled failed. However, some features like `Array.at` (supported in Chrome 92) and `Object.hasOwn` (supported in Chrome 93) worked as expected.\r\n\r\n| actual result in Chrome 90 |\r\n|---|\r\n| <img width=\"500\" height=\"444\" alt=\"image\" src=\"https://github.com/user-attachments/assets/9c0fcc5c-38a4-4fbf-940b-bd716cabb840\" /> |\r\n\r\nThe above issue was reproduced in a Next.js 15 application as well. What is the correct way to support older browsers when building Next.js applications? Is specifying `browserslist` not an appropriate way?\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\nhttps://github.com/parksb/vercel-nextjs-issue",
      "answer": "Based on your findings and the current Next.js behavior, here's a practical approach that works:\r\n\r\n## Summary\r\n\r\nThe `browserslist` config in Next.js primarily affects the **transpilation target** (which JS features get compiled down), but the built-in polyfill injection has limitations\u2014especially the `nomodule` script not loading in ESM-capable browsers (Chrome 61+), and missing polyfills like `globalThis`.\r\n\r\n## Recommended solution: manual polyfills with `beforeInteractive`\r\n\r\nYour workaround is the right direction. Use Next.js's `Script` component with `strategy=\"beforeInteractive\"` to load polyfills before any app code runs:\r\n\r\n```jsx\r\n// app/layout.jsx or pages/_app.jsx\r\nimport Script from 'next/script'\r\n\r\nexport default function RootLayout({ children }) {\r\n  return (\r\n    <html>\r\n      <head>\r\n        <Script\r\n          src=\"https://cdn.jsdelivr.net/npm/globalthis-polyfill@1.0.0/index.min.js\"\r\n          strategy=\"beforeInteractive\"\r\n        />\r\n        <Script\r\n          src=\"https://cdn.jsdelivr.net/npm/core-js-bundle@3/minified.js\"\r\n          strategy=\"beforeInteractive\"\r\n        />\r\n      </head>\r\n      <body>{children}</body>\r\n    </html>\r\n  )\r\n}\r\n```\r\n\r\n**Note:** Load the `globalThis` polyfill first (before core-js), since many libraries depend on it.\r\n\r\n**Why `beforeInteractive` instead of `instrumentation-client`?**\r\n- `instrumentation-client` runs after the initial page load and is better for client-side monitoring/setup.\r\n- `beforeInteractive` runs in the `<head>` before React hydrates\u2014exactly when polyfills must be available.\r\n- If you need to load from a CDN (as you mentioned), `beforeInteractive` gives you full control over the script URL.\r\n\r\n## For `globalThis` specifically\r\n\r\nThe `globalThis` polyfill will fix the Chrome 64 error. The `globalthis-polyfill` package provides a minimal, browser-ready script.\r\n\r\n## Alternative: bundle polyfills locally\r\n\r\nIf you prefer not to rely on a CDN, you can create a local polyfill file and load it:\r\n\r\n```jsx\r\n<Script src=\"/polyfills.js\" strategy=\"beforeInteractive\" />\r\n```\r\n\r\nWhere `polyfills.js` lives in `public/` and includes what you need (e.g. from `core-js` or `@babel/polyfill`).\r\n\r\n---\r\n\r\nUntil Next.js improves its built-in polyfill story for older browsers, this manual approach is the most reliable way to support Chrome 64 and similar targets.",
      "category": "Help",
      "created_at": "2025-10-31T08:05:17Z",
      "url": "https://github.com/vercel/next.js/discussions/85605",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 87486,
      "title": "Turbopack Error: An unexpected Turbopack error occurred",
      "question": "FATAL: An unexpected Turbopack error occurred. A panic log has been written to \r\nAppData\\Local\\Temp\\next-panic-328ff02a19f6a8d43d60d35fc9c147e.log.\r\n\r\n---------------------------\r\ncreate symlink to ../../../node_modules/mongodb\r\n\r\nCaused by:\r\n- A required privilege is not held by the client. (os error 1314)\r\n---------------------------\r\ncreate symlink to ../../../node_modules/mongodb\r\n\r\nCaused by:\r\n- A required privilege is not held by the client. (os error 1314)\r\n---------------------------\r\ncreate symlink to ../../../node_modules/mongodb\r\n\r\nCaused by:\r\n- A required privilege is not held by the client. (os error 1314)\r\n---------------------------\r\ncreate symlink to ../../../node_modules/mongodb\r\n\r\nCaused by:\r\n- A required privilege is not held by the client. (os error 1314)\r\n\r\n",
      "answer": "This discussion appears to be a duplicate of #87402.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/87402\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-12-20T11:10:53Z",
      "url": "https://github.com/vercel/next.js/discussions/87486",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89489,
      "title": "Turbopack Error: failed to receive message",
      "question": "Turbopack version: `d1bd5b58`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nfailed to receive message\r\n\r\nCaused by:\r\n- reading packet length\r\n- timeout while receiving message from process\r\n- deadline has elapsed\r\n\r\nDebug info:\r\n- Execution of get_all_written_entrypoints_with_issues_operation failed\r\n- Execution of PlainIssue::from_issue failed\r\n- Execution of PlainSource::from_source failed\r\n- Execution of <WebpackLoadersProcessedAsset as Asset>::content failed\r\n- Execution of WebpackLoadersProcessedAsset::process failed\r\n- Execution of evaluate_webpack_loader failed\r\n- failed to receive message\r\n- reading packet length\r\n- timeout while receiving message from process\r\n- deadline has elapsed\r\n```\r\n\r\nNot sure if this is useful, but console told me I can report this. Running build second time without changing anything resulted in proper build failure due to typescript error I had. Not sure why first time may have failed.\r\n\r\n```\r\n> next build\r\n\r\n\u25b2 Next.js 16.1.1 (Turbopack)\r\n- Environments: .env.local, .env.production\r\n\r\n  Creating an optimized production build ...\r\n\u2713 Compiled successfully in 16.3s\r\n  Running TypeScript  ..Failed to compile.\r\n```",
      "answer": "Had a similar error.\r\n\r\nTurbopack version: `0c06f068`\r\nNext.js version: `16.1.6`\r\n\r\nError message:\r\n```\r\nfailed to receive message\r\n\r\nCaused by:\r\n- reading packet length\r\n- unexpected end of file\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of PlainIssue::from_issue failed\r\n- Execution of PlainSource::from_source failed\r\n- Execution of <WebpackLoadersProcessedAsset as Asset>::content failed\r\n- Execution of WebpackLoadersProcessedAsset::process failed\r\n- Execution of evaluate_webpack_loader failed\r\n- failed to receive message\r\n- reading packet length\r\n- unexpected end of file\r\n```\r\n\r\nAdditional info:\r\nI'm using Next.js with Bun. (dev script: `bun --bun next dev -p 3020`)\r\nThis issue doesn't occur all the time. I reported it because the CLI told me to. \ud83d\ude04\r\n\r\nPS: Just deleted the `.next` folder, and now the issue seems to be gone.",
      "category": "Turbopack Error Report",
      "created_at": "2026-02-04T13:41:36Z",
      "url": "https://github.com/vercel/next.js/discussions/89489",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89476,
      "title": "Turbopack Error: Invalid segment Static(\"cart\"), catch all segment must be the last segment modifying the path (segments: [OptionalCatchAll(\"lang\"), Group(\"cart\")])",
      "question": "Turbopack version: `23c46498`\r\nNext.js version: `16.1.6`\r\n\r\nError message:\r\n```\r\nTurbopack Error: Invalid segment Static(\"cart\"), catch all segment must be the last segment modifying the path (segments: [OptionalCatchAll(\"lang\"), Group(\"cart\")])\r\n```",
      "answer": "That error is suggesting you have something like:\r\n\r\n```text\r\nsrc/app\r\n\u251c\u2500\u2500 [[...lang]]\r\n\u2502   \u2514\u2500\u2500 (cart)\r\n\u2502       \u2514\u2500\u2500 cart\r\n\u2502           \u2514\u2500\u2500 route.ts\r\n```\r\n\r\nDo you? If I do that and run it with Turbopack/Webpack, it fails \u2014 and Turbopack reports essentially the same error:\r\n\r\n```console\r\nInvalid segment Static(\"cart\"), catch all segment must be the last segment modifying the path\r\n(segments: [OptionalCatchAll(\"lang\"), Group(\"cart\")])\r\n```\r\n\r\nThere can be multiple ways to trigger this, but the root cause is the same.\r\n\r\n`[[...lang]]` **must be the last element in the path**, and nothing (static or dynamic) can come after it.\r\n",
      "category": "Turbopack Error Report",
      "created_at": "2026-02-04T08:59:18Z",
      "url": "https://github.com/vercel/next.js/discussions/89476",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 70198,
      "title": "Image unknown errors.",
      "question": "### Link to the code that reproduces this issue\r\n\r\nhttps://github.com/omerman/next13-unmounts-reproduction/\r\n\r\n### To Reproduce\r\n\r\nNot sure.\r\n\r\nMaybe related to #22329 \r\n\r\n### Current vs. Expected behavior\r\n\r\n\r\n[15.09.2024 18:44.03.821] [ERROR] Error: Invalid accept header\r\n    at s.parse ([path_to_next_modules]/@hapi/accept/index.js:1:3083)\r\n    at t.selections ([path_to_next_modules]/@hapi/accept/index.js:1:2564)\r\n    at t.selection ([path_to_next_modules]/@hapi/accept/index.js:1:2425)\r\n    at t.mediaType ([path_to_next_modules]/@hapi/accept/index.js:1:2085)\r\n    at getSupportedMimeType ([path_to_next_modules]/image-optimizer.js:179:44)\r\n    at ImageOptimizerCache.validateParams ([path_to_next_modules]/image-optimizer.js:436:26)\r\n    at NextNodeServer.handleNextImageRequest ([path_to_next_modules]/next-server.js:167:58)\r\n    at Server.normalizeAndAttachMetadata ([path_to_next_modules]/base-server.js:292:39)\r\n    at NextNodeServer.handleRequestImpl ([path_to_next_modules]/base-server.js:848:39)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n    at async invokeRender ([path_to_next_modules]/router-server.js:183:21)\r\n    at async handleRequest ([path_to_next_modules]/router-server.js:360:24)\r\n    at async requestHandlerImpl ([path_to_next_modules]/router-server.js:384:13)\r\n    at async Server.requestListener ([path_to_next_modules]/start-server.js:142:13) {\r\n  data: null,\r\n  isBoom: true,\r\n  isServer: false,\r\n  output: {\r\n    statusCode: 400,\r\n    payload: {\r\n      statusCode: 400,\r\n      error: 'Bad Request',\r\n      message: 'Invalid accept header'\r\n    },\r\n    headers: {}\r\n  }\r\n}\r\n\r\n\r\n### Provide environment information\r\n\r\n```bash\r\nOperating System:\r\n  Platform: darwin\r\n  Arch: arm64\r\n  Version: Darwin Kernel Version 23.5.0: Wed May  1 20:12:58 PDT 2024; root:xnu-10063.121.3~5/RELEASE_ARM64_T6000\r\n  Available memory (MB): 16384\r\n  Available CPU cores: 8\r\nBinaries:\r\n  Node: 20.9.0\r\n  npm: 10.1.0\r\n  Yarn: 1.22.19\r\n  pnpm: 8.14.1\r\nRelevant Packages:\r\n  next: 15.0.0-canary.155 // There is a newer canary version (15.0.0-canary.156) available, please upgrade! \r\n  eslint-config-next: 14.2.3\r\n  react: 19.0.0-rc-206df66e-20240912\r\n  react-dom: 19.0.0-rc-206df66e-20240912\r\n  typescript: 5.2.2\r\nNext.js Config:\r\n  output: N/A\r\n \u26a0 There is a newer canary version (15.0.0-canary.156) available, please upgrade! \r\n   Please try the latest canary version (`npm install next@canary`) to confirm the issue still exists before creating a new issue.\r\n   Read more - https://nextjs.org/docs/messages/opening-an-issue\r\n```\r\n\r\n\r\n### Which area(s) are affected? (Select all that apply)\r\n\r\nNot sure\r\n\r\n### Which stage(s) are affected? (Select all that apply)\r\n\r\nOther (Deployed)\r\n\r\n### Additional context\r\n\r\n_No response_",
      "answer": "@samcx\r\nI'm seeing Error: Invalid accept header on v15, mainly with next/image.\r\n\r\nThe Accept header causing this is:\u3000text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/apng,*/*;q=0.8;application/signed-exchange;v=b3\r\nEven if the header is malformed, Next.js should handle it gracefully (e.g., falling back to a 400 error) instead of returning a 500 error.\r\n\r\nPlease let me know if you need any further information to reproduce this issue.",
      "category": "Help",
      "created_at": "2024-09-15T17:27:31Z",
      "url": "https://github.com/vercel/next.js/discussions/70198",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89367,
      "title": "Turbopack Error: Failed to write app endpoint /(dashboard)/projects/[id]/flows/[flowId]/page",
      "question": "Turbopack version: `v16.1.0-canary.19-88-gda605e0c4`\r\nNext.js version: `16.1.4 or 6`\r\n\r\nError message:\r\n```RUST_BACKTRACE=full bun run build\r\n$ next build\r\n\u25b2 Next.js 16.1.6 (Turbopack)\r\n- Environments: .env\r\n\r\n  Creating an optimized production build ...\r\n\r\nthread 'tokio-runtime-worker' (104244) panicked at /Users/geist/dev/actions-runner/_work/next.js/next.js/turbopack/crates/turbopack-core/src/chunk/chunk_group.rs:269:25:\r\ninternal error: entered unreachable code\r\nstack backtrace:\r\n   0:        0xa8a566254 - _napi_register_module_v1\r\n   1:        0xa8a577cfc - _napi_register_module_v1\r\n   2:        0xa8a53ac80 - _napi_register_module_v1\r\n   3:        0xa8a545394 - _napi_register_module_v1\r\n   4:        0xa8a54a394 - _napi_register_module_v1\r\n   5:        0xa8a54a248 - _napi_register_module_v1\r\n   6:        0xa8a54ab10 - _napi_register_module_v1\r\n   7:        0xa8a54a794 - _napi_register_module_v1\r\n   8:        0xa8a5454a0 - _napi_register_module_v1\r\n   9:        0xa8a532e28 - _napi_register_module_v1\r\n  10:        0xa8a6a56d0 - _napi_register_module_v1\r\n  11:        0xa8a6a56b0 - _napi_register_module_v1\r\n  12:        0xa875690ac - <unknown>\r\n  13:        0xa8751b73c - <unknown>\r\n  14:        0xa87502a6c - <unknown>\r\n  15:        0xa86684d7c - <unknown>\r\n  16:        0xa86578f50 - <unknown>\r\n  17:        0xa8665ec70 - <unknown>\r\n  18:        0xa8665aa70 - <unknown>\r\n  19:        0xa86577a10 - <unknown>\r\n  20:        0xa865b4594 - <unknown>\r\n  21:        0xa8646c318 - <unknown>\r\n  22:        0xa8647da50 - <unknown>\r\n  23:        0xa8647ddf0 - <unknown>\r\n  24:        0xa8a503068 - _napi_register_module_v1\r\n  25:        0xa8a502728 - _napi_register_module_v1\r\n  26:        0xa8a4f0ff0 - _napi_register_module_v1\r\n  27:        0xa8a507fc4 - _napi_register_module_v1\r\n  28:        0xa8a503504 - _napi_register_module_v1\r\n  29:        0xa8a4f783c - _napi_register_module_v1\r\n  30:        0xa8a4ee7b4 - _napi_register_module_v1\r\n  31:        0xa8a4e4a18 - _napi_register_module_v1\r\n  32:        0xa8a4e57f4 - _napi_register_module_v1\r\n  33:        0xa8a4f63b4 - _napi_register_module_v1\r\n  34:        0xa8a4fc670 - _napi_register_module_v1\r\n  35:        0xa8a4ed6d0 - _napi_register_module_v1\r\n  36:        0xa8a519454 - _napi_register_module_v1\r\n  37:        0xa8a542868 - _napi_register_module_v1\r\n  38:        0x196221c08 - __pthread_cond_wait\r\n\r\n-----\r\nFATAL: An unexpected Turbopack error occurred. A panic log has been written to /var/folders/74/0qv1zg594zjcykbj8_jhd2600000gn/T/next-panic-f126e646dcfcca3ce2c83a74d4666aeb.log.\r\n\r\nTo help make Turbopack better, report this error by clicking here: https://github.com/vercel/next.js/discussions/new?category=turbopack-error-report&title=Turbopack%20Error%3A%20Failed%20to%20write%20app%20endpoint%20%2F%28dashboard%29%2Fprojects%2F%5Bid%5D%2Fflows%2F%5BflowId%5D%2Fpage&body=Turbopack%20version%3A%20%6023c464985%60%0ANext.js%20version%3A%20%600.0.0%60%0A%0AError%20message%3A%0A%60%60%60%0ATurbopack%20Error%3A%20Failed%20to%20write%20app%20endpoint%20%2F%28dashboard%29%2Fprojects%2F%5Bid%5D%2Fflows%2F%5BflowId%5D%2Fpage%0A%60%60%60&labels=Turbopack,Turbopack%20Panic%20Backtrace\r\n-----\r\n\r\n\r\n> Build error occurred\r\nError [TurbopackInternalError]: Failed to write app endpoint /(dashboard)/projects/[id]/flows/[flowId]/page\r\n\r\nCaused by:\r\n- internal error: entered unreachable code\r\n\r\nDebug info:\r\n- Execution of get_all_written_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of all_entrypoints_write_to_disk_operation failed\r\n- Execution of Project::emit_all_output_assets failed\r\n- Execution of *emit_assets failed\r\n- Execution of all_assets_from_entries_operation failed\r\n- Execution of *all_assets_from_entries failed\r\n- Execution of output_assets_operation failed\r\n- Execution of <AppEndpoint as Endpoint>::output failed\r\n- Failed to write app endpoint /(dashboard)/projects/[id]/flows/[flowId]/page\r\n- Execution of AppEndpoint::output failed\r\n- Execution of get_app_client_references_chunks failed\r\n- Execution of *ChunkGroupResult::concatenate failed\r\n- Execution of <NodeJsChunkingContext as ChunkingContext>::chunk_group failed\r\n- internal error: entered unreachable code\r\n    at <unknown> (TurbopackInternalError: Failed to write app endpoint /(dashboard)/projects/[id]/flows/[flowId]/page) {\r\n  type: 'TurbopackInternalError',\r\n  location: '/Users/geist/dev/actions-runner/_work/next.js/next.js/turbopack/crates/turbopack-core/src/chunk/chunk_group.rs:269:25'\r\n}\r\nerror: script \"build\" exited with code 1\r\n```\r\n\r\n",
      "answer": "We're experiencing the same issue on **Next.js 16.1.6** with Turbopack production builds.\n\n**Environment:**\n- Next.js: 16.1.6\n- Build command: `next build --turbo`\n- Platform: GitHub Actions (Linux runner)\n- Previously working on: 16.0.10\n\n**Error:**\n```\nthread 'tokio-runtime-worker' panicked at /build/turbopack/crates/turbopack-core/src/chunk/chunk_group.rs:269:25:\ninternal error: entered unreachable code\n\nTurbopackInternalError: Failed to write app endpoint /(main)/(home)/page\n```\n\n**Example next.config.mjs:**\n```js\nconst nextConfig = {\n  output: 'standalone',\n  reactCompiler: true,\n  turbopack: {\n    resolveAlias: {\n      'some-package': './lib/bundled/some-package.mjs',\n    },\n    rules: {\n      '*.svg': {\n        loaders: ['@svgr/webpack'],\n        as: '*.js',\n      },\n    },\n  },\n  experimental: {\n    memoryBasedWorkersCount: true,\n  },\n};\n```\n\n**Notes:**\n- Build was working fine on 16.0.10\n- Upgraded to 16.1.6 and the build started failing\n- Error occurs consistently on retry (not flaky)\n\nThis appears to be a regression introduced between 16.0.10 and 16.1.x.",
      "category": "Turbopack Error Report",
      "created_at": "2026-02-02T02:03:44Z",
      "url": "https://github.com/vercel/next.js/discussions/89367",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 51135,
      "title": "Cross-Origin-Opener-Policy policy would block the window.closed call error while using google auth",
      "question": "### Summary\r\n\r\nI am using next, firebase and its google auth tool, everything works fine the user data is getting saved in the database but i get a error every time the popup window appears (Cross-Origin-Opener-Policy policy would block the window.closed call)\r\n![IMG_20230630_213720](https://github.com/vercel/next.js/assets/106821717/0e529df1-0f66-45c2-9aa6-6585f1228198)\r\n![RXon9](https://github.com/vercel/next.js/assets/106821717/70ef5c26-ec51-4bac-a65a-44ad94889bda)\r\n\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_",
      "answer": "I have also encountered this issue, followed by another one, also appearing twice:\r\n\r\n> Cross-Origin-Opener-Policy policy would block the window.postMessage call.    client:256 \r\n\r\nFrom what I was able to debug, it originates from the pop-up's iframe, \r\n\r\n> Cross-Origin-Opener-Policy policy would block the window[i] call.    m=credential_page_library:203\r\n\r\nApparently the iframe is trying to make contact with the parent window for some reason I was unable to determine. \r\nIt doesn't break my login flow, only thing it does is reporting the behaviour to the console.\r\n\r\nIn my case, errors are beeing thrown exactly after the execution of this line, with a.i set to true.\r\n`\"picker_popup\" === a.i ? window.opener.postMessage(b, a.da) : window.parent.postMessage(b, a.da)`\r\n\r\nOnly suggested solutions i have come across suggested adding appropriate headers on my side, but including them in my nginx server configuration didn't help at all. I don't quite understand how would it be possibble for the OAuth iframe to communicate with its parent window while it most likely implements server-wide \"same-origin\" header for COOP (at least with all the other requests I was able to notice).\r\n\r\n",
      "category": "Help",
      "created_at": "2023-06-11T17:17:58Z",
      "url": "https://github.com/vercel/next.js/discussions/51135",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 86943,
      "title": "Next 16.0.7 - Turbopack Error: Dependency tracking is disabled so invalidation is not allowed at C:\\actions-runner\\_work\\next.js\\next.js\\turbopack\\crates\\turbo-tasks-backend\\src\\.......",
      "question": "Hi\r\nI got this, after first 'npm run build\", after last updae to Next \"16.0.7\". The previous version worked fine\r\nSo now I don't know what's going on :?\r\n\r\n\r\nTurbopack version: `b1a04a84`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nDependency tracking is disabled so invalidation is not allowed at C:\\actions-runner\\_work\\next.js\\next.js\\turbopack\\crates\\turbo-tasks-backend\\src\\backend\\mod.rs:1523:13\r\n```\r\n\r\n \r\n > next build\r\n\r\n   \u25b2 Next.js 16.0.7 (Turbopack)\r\n   - Environments: .env.local\r\n\r\n   Creating an optimized production build ...\r\n\r\nthread 'tokio-runtime-worker' (39256) panicked at C:\\actions-runner\\_work\\next.js\\next.js\\turbopack\\crates\\turbo-tasks-backend\\src\\backend\\mod.rs:1523:13:\r\nDependency tracking is disabled so invalidation is not allowed\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n\r\nthread 'tokio-runtime-worker' (39432) panicked at C:\\actions-runner\\_work\\next.js\\next.js\\turbopack\\crates\\turbo-tasks-backend\\src\\backend\\mod.rs:1523:13:\r\nDependency tracking is disabled so invalidation is not allowed\r\n\r\n-----\r\nFATAL: An unexpected Turbopack error occurred. A panic log has been written to C:\\Users..AppData\\Local\\Temp\\next-panic-35cbf91fd4898bece90fe64ef59d17ee.log.\r\n\r\nTo help make Turbopack better, report this error by clicking here.\r\n-----\r\n\r\n\r\n> Build error occurred\r\nError [TurbopackInternalError]: Dependency tracking is disabled so invalidation is not allowed at C:\\actions-runner\\_work\\next.js\\next.js\\turbopack\\crates\\turbo-tasks-backend\\src\\backend\\mod.rs:1523:13\r\n    at <unknown> (TurbopackInternalError: Dependency tracking is disabled so invalidation is not allowed at C:\\actions-runner\\_work\\next.js\\next.js\\turbopack\\crates\\turbo-tasks-backend\\src\\backend\\mod.rs:1523:13) {\r\n  type: 'TurbopackInternalError',\r\n  location: 'C:\\\\actions-runner\\\\_work\\\\next.js\\\\next.js\\\\turbopack\\\\crates\\\\turbo-tasks-backend\\\\src\\\\backend\\\\mod.rs:1523:13'\r\n}\r\n\r\n",
      "answer": "For me:\r\n \"next\": \"16.1.1\"\r\n And I wish I was making this up, I was getting the same error because I had a icon.png file in the app directory. \r\n \r\n \r\n full error:\r\n \u25b2 Next.js 16.1.1 (Turbopack)\r\n- Environments: .env.local\r\n\r\n  Creating an optimized production build ...\r\n\r\nthread 'tokio-runtime-worker' (45840) panicked at C:\\actions-runner\\_work\\next.js\\next.js\\turbopack\\crates\\turbo-tasks-backend\\src\\backend\\mod.rs:1526:13:\r\nDependency tracking is disabled so invalidation is not allowed\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n\r\n-----\r\nFATAL: An unexpected Turbopack error occurred. A panic log has been written to C:\\Users\\<omitted>\\AppData\\Local\\Temp\\next-panic-11ca13d99e04db767257911e14de7277.log.\r\n\r\nTo help make Turbopack better, report this error by clicking here.\r\n-----\r\n\r\n\r\nthread 'tokio-runtime-worker' (45840) panicked at C:\\actions-runner\\_work\\next.js\\next.js\\turbopack\\crates\\turbo-tasks-backend\\src\\backend\\mod.rs:1526:13:\r\nDependency tracking is disabled so invalidation is not allowed\r\n\r\n> Build error occurred\r\nError [TurbopackInternalError]: Dependency tracking is disabled so invalidation is not allowed at C:\\actions-runner\\_work\\next.js\\next.js\\turbopack\\crates\\turbo-tasks-backend\\src\\backend\\mod.rs:1526:13\r\n    at <unknown> (TurbopackInternalError: Dependency tracking is disabled so invalidation is not allowed at C:\\actions-runner\\_work\\next.js\\next.js\\turbopack\\crates\\turbo-tasks-backend\\src\\backend\\mod.rs:1526:13) {\r\n  type: 'TurbopackInternalError',\r\n  location: 'C:\\\\actions-runner\\\\_work\\\\next.js\\\\next.js\\\\turbopack\\\\crates\\\\turbo-tasks-backend\\\\src\\\\backend\\\\mod.rs:1526:13'\r\n}\r\n ",
      "category": "Turbopack Error Report",
      "created_at": "2025-12-08T15:12:33Z",
      "url": "https://github.com/vercel/next.js/discussions/86943",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 68774,
      "title": "next/image is failing with Docker Compose",
      "question": "### Summary\r\n\r\n**In Short:** \r\nI've `api` & `web` services in the `docker-compose.yaml` file. Currently everything works perfectly except Next Image(`next/image`) failing on a client component. \r\nAs the component is a client component it should fetch the image. Following is the error in cli (so it runs in server).\r\n```log\r\nTypeError: fetch failed\r\nweb  |     at node:internal/deps/undici/undici:13178:13\r\nweb  |     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\nweb  |     at async fetchExternalImage (/usr/src/app/node_modules/.pnpm/next@14.2.5_react-dom@18.3.1_react@18.3.1__react@18.3.1_sass@1.77.8/node_modules/next/dist/server/image-optimizer.js:580:17)\r\nweb  |     at async DevServer.imageOptimizer (/usr/src/app/node_modules/.pnpm/next@14.2.5_react-dom@18.3.1_react@18.3.1__react@18.3.1_sass@1.77.8/node_modules/next/dist/server/next-server.js:650:48)\r\nweb  |     at async cacheEntry.imageResponseCache.get.incrementalCache (/usr/src/app/node_modules/.pnpm/next@14.2.5_react-dom@18.3.1_react@18.3.1__react@18.3.1_sass@1.77.8/node_modules/next/dist/server/next-server.js:182:65)\r\nweb  |     at async /usr/src/app/node_modules/.pnpm/next@14.2.5_react-dom@18.3.1_react@18.3.1__react@18.3.1_sass@1.77.8/node_modules/next/dist/server/response-cache/index.js:90:36\r\nweb  |     at async /usr/src/app/node_modules/.pnpm/next@14.2.5_react-dom@18.3.1_react@18.3.1__react@18.3.1_sass@1.77.8/node_modules/next/dist/lib/batcher.js:45:32 {\r\nweb  |   [cause]: AggregateError [ECONNREFUSED]:\r\nweb  |       at internalConnectMultiple (node:net:1118:18)\r\nweb  |       at afterConnectMultiple (node:net:1685:7)\r\nweb  |       at TCPConnectWrap.callbackTrampoline (node:internal/async_hooks:130:17) {\r\nweb  |     code: 'ECONNREFUSED',\r\nweb  |     [errors]: [ [Error], [Error] ]\r\nweb  |   }\r\nweb  | }\r\nweb  |  GET /_next/image?url=http%3A%2F%2Flocalhost%3A3000%2Fuploads%2Fsample%2F9.png&w=1200&q=75 500 in 41ms\r\nweb  |  GET /_next/image?url=http%3A%2F%2Flocalhost%3A3000%2Fuploads%2Fsample%2F9.png&w=1200&q=75 500 in 29ms\r\n```\r\nNote: The images this failed to fetch are available with the API URL (`http://localhost:3000/uploads/sample/9.png`) from host.\r\nFollowing is the component\r\n```ts\r\n'use client'\r\nimport Image from \"next/image\";\r\n\r\ntype PostImgProps = {\r\n  imgUrl: string;\r\n};\r\n\r\nconst PostImg = (p: PostImgProps) => {\r\n  // if I comment out the \"Image\" below there's no error remains\r\n  return (\r\n    <Image\r\n      className=\"object-cover\"\r\n      src={p.imgUrl}\r\n      alt=\"post image\"\r\n      width={1200}\r\n      height={1000}\r\n    />\r\n  );\r\n};\r\n\r\nexport default PostImg;\r\n```\r\nI know that Next.js tries to render client components in the server too. So I've imported it like\r\n```ts\r\nconst PostImg = dynamic(\r\n  () => import('@/path/to/postImg'),\r\n  {\r\n    ssr: false, // completely disable server side rendering\r\n    loading: () => (\r\n      <div className=\"...\">\r\n        <!-- loader code -->\r\n      </div>\r\n    )\r\n  }\r\n);\r\n```\r\nto disable server rendering. But I am still facing the error. As far as I can tell. As the component is still being rendered on the server. It fails to pull the image because the URL (`p.imgUrl` in `PostImg` component) is unavailable on the server. btw, it's `http://localhost:3xxx/path/to/img.ext`. In the server instead of `localhost` we need *docker service name* there which is `api` in my case. but how do I configure that?\r\n\r\nThank you in advance for the help :)\r\n\r\n\r\n\r\n### Additional information\r\n\r\n```js\r\nNode: 20\r\nNext: 14.2.5\r\n```\r\n\r\n### Example\r\n\r\n_No response_",
      "answer": "**Context**\r\n- Next.js 14.2.x in Docker Compose (`web` + `api`)\r\n- `next/image` fails with `ECONNREFUSED` when the `src` points to `http://localhost:3000/...`\r\n\r\n**Why**\r\n`next/image` optimization happens **server-side**. Inside the `web` container, `localhost` is the `web` container itself, not your `api`. So the optimizer tries to fetch `http://localhost:3000/...` from the wrong place and gets `ECONNREFUSED`.\r\n\r\n**Fix (minimum viable)**\r\n1) Use the **Compose service name** (DNS on the bridge network) in the image URL:\r\n   ```tsx\r\n   // good: hits the api container from inside web\r\n   <Image src=\"http://api:3000/uploads/sample.png\" width={1200} height={675} alt=\"...\" />\r\n   // bad: localhost points to the web container, not api\r\n   // <Image src=\"http://localhost:3000/uploads/sample.png\" ... />\r\n   ```\r\n\r\n2) Allow that host in `next.config.js` with `remotePatterns` **including port**:\r\n   ```js\r\n   /** @type {import('next').NextConfig} */\r\n   const nextConfig = {\r\n     images: {\r\n       remotePatterns: [\r\n         { protocol: 'http', hostname: 'api', port: '3000', pathname: '/uploads/**' },\r\n       ],\r\n     },\r\n   };\r\n   module.exports = nextConfig;\r\n   ```\r\n\r\n3) Compose example (names matter):\r\n   ```yaml\r\n   services:\r\n     api:\r\n       image: node:20\r\n       # expose your API on 3000\r\n     web:\r\n       image: node:20\r\n       depends_on: [api]\r\n       # both on the default bridge network so \"api\" is resolvable\r\n   ```\r\n\r\n4) If you need a single source for both server and browser:\r\n   - Server (optimizer) can use `http://api:3000`.\r\n   - Browser must use a public host. Provide both via env:\r\n     ```ts\r\n     const serverBase = process.env.INTERNAL_API_URL ?? 'http://api:3000';\r\n     const publicBase = process.env.NEXT_PUBLIC_API_URL ?? 'http://localhost:3000';\r\n     ```\r\n     And build the `src` accordingly on server/client.\r\n\r\n5) Quick diagnostic\r\n   - From the `web` container: `curl -I http://api:3000/uploads/sample.png` should be 200.\r\n   - If you\u2019re behind a proxy (nginx/traefik), forward `X-Forwarded-Host/Proto`.\r\n\r\n6) Temporary bypass to confirm root cause:\r\n   ```js\r\n   // next.config.js\r\n   module.exports = { images: { unoptimized: true } }\r\n   ```\r\n   If this works, the issue was the internal URL/host allowlist, not your component.\r\n\r\n**Notes**\r\n- Remote images config: https://nextjs.org/docs/app/api-reference/components/image#remote-images\r\n- `remotePatterns` fields (`protocol` | `hostname` | `port` | `pathname`) are supported.\r\n\r\nIf this solves it, please **Mark as answer** so others can find it.\r\n",
      "category": "Help",
      "created_at": "2024-08-11T18:18:26Z",
      "url": "https://github.com/vercel/next.js/discussions/68774",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 64435,
      "title": "Clicking a Link does't scroll to top on the next page",
      "question": "### Verify canary release\r\n\r\n- [X] I verified that the issue exists in the latest Next.js canary release\r\n\r\n### Provide environment information\r\n\r\n```\r\n$ next info\r\n\r\n    Operating System:\r\n      Platform: linux\r\n      Arch: x64\r\n      Version: Ubuntu 20.04.0 LTS Mon Jan 23 2023 17:53:48 GMT+0200 (Eastern European Standard Time)\r\n    Binaries:\r\n      Node: 16.14.2\r\n      npm: 7.17.0\r\n      Yarn: 1.22.19\r\n      pnpm: 7.13.6\r\n    Relevant packages:\r\n      next: 13.1.4\r\n      eslint-config-next: 13.1.4\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n\r\nwarn  - Latest canary version not detected, detected: \"13.1.4\", newest: \"13.1.5-canary.2\".\r\n        Please try the latest canary version (`npm install next@canary`) to confirm the issue still exists before creating a new issue.\r\n        Read more - https://nextjs.org/docs/messages/opening-an-issue\r\n\r\n```\r\n\r\n### Which area(s) of Next.js are affected? (leave empty if unsure)\r\n\r\nApp directory (appDir: true), Routing (next/router, next/navigation, next/link)\r\n\r\n### Link to the code that reproduces this issue\r\n\r\nhttps://stackblitz.com/edit/vercel-next-js-x6badq?file=package.json\r\n\r\n### To Reproduce\r\n\r\n- create a new Next 13 app\r\n- add 2 large pages (both need to have a scroll bar)\r\n- add a link at the end of the first page that redirects to the 2nd page\r\n- very important (idk why), create an instance of the font on the second page:\r\n```\r\nimport { Inter } from '@next/font/google';\r\n\r\nconst inter = Inter({ subsets: ['latin'] });\r\n```\r\n- run the app\r\n- on the home page, scroll down and click on the link\r\n- notice the scroll position on the 2nd page is not at the top\r\n\r\n**2nd related issue**\r\nNow, remove the font instance (`const inter = Inter({ subsets: ['latin'] });`) from the second page. Test the app again and notice the scroll bar being at the top but still has a small scroll. It's not `top: 0`. ([Reproduction link](https://stackblitz.com/edit/vercel-next-js-z4r2hd?file=app/test/page.tsx))\r\n\r\n#### Temporary workaround\r\nIn order to fix this issue, for now, I added this in my main layout.tsx file. I had to convert it to a client component:\r\n```\r\nconst pathname = usePathname()\r\n    useEffect(() => {\r\n        window.scroll(0, 0)\r\n    }, [pathname])\r\n```\r\n\r\n### Describe the Bug\r\n\r\nClicking on a link that redirects to a page makes the scroll bar be scrolled instead of having it at the top of the page. Requirements of the bug are described above\r\n\r\n### Expected Behavior\r\n\r\nExpecting the scroll bar to be at the top without removing the font instance from the 2nd page.\r\n\r\nTo note that, on my real app, I don't have this font instance. Si the bug is probably introduced by some other package.\r\n\r\n### Which browser are you using? (if relevant)\r\n\r\nChrome 109\r\n\r\n### How are you deploying your application? (if relevant)\r\n\r\nnext start",
      "answer": "The issue happens when you have a sticky header.\r\n\r\nhere's a fix:\r\n\r\n```javascript\r\n'use client'\r\nexport default function Scroll() {\r\n\t// when clicking a link, user will not scroll to the top of the page if the header is sticky.\r\n\t// their current scroll position will persist to the next page.\r\n\t// this useEffect is a workaround to 'fix' that behavior.\r\n\r\n\tconst pathname = usePathname();\r\n\tuseEffect(() => {\r\n\t\twindow.scroll(0, 0);\r\n\t}, [pathname]);\r\n\treturn <></>;\r\n}\r\n\r\n```\r\nPut the component in your `layout.jsx` file\r\n```javascript\r\nexport default function RootLayout({ children }: { children: React.ReactNode }) {\r\n\treturn (\r\n\t\t<html lang=\"en\">\r\n\t\t\t<Scroll />\r\n\t\t\t<body>{children}</body>\r\n\t\t</html>\r\n\t);\r\n}\r\n```\r\n\r\nproblem solved until they fix it.",
      "category": "App Router",
      "created_at": "2023-01-23T16:04:15Z",
      "url": "https://github.com/vercel/next.js/discussions/64435",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 61850,
      "title": "Google Search Console and Next.js caching - \"_rsc=\" issue",
      "question": "### Summary\n\nI have noticed an increasing number of errors in my Google Search Console related to caching in Next.js. Specifically, the error is 'Alternative page with proper canonical tag' and 98% of occurrences are related to the caching issue. I would like to know how to prevent Google from indexing pages with a URL query '_rsc='. \r\n\r\nI tried excluding these pages from indexing by adding them to the robots.txt file, but as they are necessary pages, that approach did not work. Can someone please advise me on what I should do?\r\n\r\n<img width=\"879\" alt=\"image\" src=\"https://github.com/vercel/next.js/assets/29264726/eb371e1b-c6b9-4af1-9599-8f4194cf139f\">\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_",
      "answer": "I came across a similar issue regarding Google and Google Search Console. For some reason, Google is massively crawling pages with \"_rsc\" parameters in the URL, which leads to errors in identifying canonical pages, despite the fact that they are set for each one. It can also cause incorrect indexing of pages. As a result, our site has stopped being indexed in Google, although everything is fine in other search engines. \r\n\r\nWe tried to solve this problem using a file ```robots.txt``` but it had no effect. \r\n\r\nWe also tried to fix this by checking the URL parameters and using a redirect in ```middleware.ts```, but the ```NextRequest``` does not have such a parameter, since Next removes it from the fields. For example, if the URL states ```\"http://localhost:3000 /?__rsc=1ld0r\"```, then in middleware the ```request: Next Request``` parameters are as follows:\r\n```\r\n{\r\n  href: 'http://localhost:3000/',\r\n  origin: 'http://localhost:3000',\r\n  protocol: 'http:',\r\n  username: ''password: '',\r\n  host: 'localhost:3000',\r\n  hostname: 'localhost',\r\n  port: '3000',\r\n  pathname: '/',\r\n  search: '',\r\n  searchParams: URLSearchParams {  },\r\n  hash: ''\r\n}\r\n```\r\nThus, Next.for some reason, js clears these parameters. Perhaps someone has encountered a similar situation?",
      "category": "Help",
      "created_at": "2024-02-09T12:40:59Z",
      "url": "https://github.com/vercel/next.js/discussions/61850",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 63078,
      "title": "Unstable Next 14 Migration: Error: Invariant: Expected to replace at least one import",
      "question": "TLDR; Unable to work with nextjs-14 project locally after migrating to app dir from next-12, keeps running into `Invariant import` exception, however build and deployments works fine. The error is easily reproducible on our local machines. If anyone could share their experience on similar problem or help me decrypt the error message, i will be very grateful!\r\n\r\n\r\nOur team has been in a process of migrating from next-12 to latest next-14 release with app dir (no pages dir) and unfortunately we have hit a wall in the process and are unable to make any progress.\r\n\r\nNextjs keeps throwing `Error: Invariant: Expected to replace at least one import` on catch-all segment routes like `[...path]` and we have been unsuccessful in isolating the cause of this problem.\r\n\r\nThe full error message:\r\n\r\n![unstable-next-14-migration-error-invariant-expected-to-v0-a16vtmmqtvlc1](https://github.com/vercel/next.js/assets/45026575/62847e7c-4c74-46e4-930e-f3c11e452c63)\r\ndifficult to create a reproduction.\r\n\r\n```\r\n./node\\_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES&page=%2F\\_error&preferredRegion=&absolutePagePath=.%2Fnode\\_modules%2Fnext%2Fdist%2Fpages%2F\\_error.js&absoluteAppPath=next%2Fdist%2Fpages%2F\\_app&absoluteDocumentPath=next%2Fdist%2Fpages%2F\\_document&middlewareConfigBase64=e30%3D!\r\nError: Invariant: Expected to replace at least one import\r\n```\r\n\r\nThe error logs doesn't point to any specific file or full stack trace, either in server console logs and runtime red screen. However, surprisingly, the local build as well as preview deployments work fine. \r\n\r\nI am on, \"next\": \"^14.1.0\", and in a monorepo project setup with turbo and complete app-dir without `/pages` directory . **Unfortunately, i am unable to create a reproduction on a fresh nextjs project.** The project is huge and without proper error messages its \r\n\r\nI have tried all general workarounds like:\r\n- removing `node_modules` from all projects\r\n- removing `package-lock.json`, building from scratch. No noticeable change was found. \r\n- removing all dynamic imports\r\n\r\nI attempted to take a deep dive into the code execution through debugger, i managed to trace the exception to a file called `load-entrypoint.js`, it's precisely at this file the program throws the exception.\r\n\r\n![unstable-next-14-migration-error-invariant-expected-to-v0-kx1h8wcptvlc1](https://github.com/vercel/next.js/assets/45026575/af63b303-fd50-4ccb-b52a-7f48a0232779)\r\n",
      "answer": "Try redeploying your branch on Vercel without \"Use existing build cache\".\r\nFrom https://vercel.com/docs/deployments/troubleshoot-a-build#understanding-build-cache:\r\n\r\n> If you create a new Git branch in MyCode and make a commit to it, there is no cache for that specific branch. In this case, the last [production Deployment](https://vercel.com/docs/deployments/environments#production) cache is used to create a preview deployment and a new branch cache is created for subsequent commits to the new branch.",
      "category": "App Router",
      "created_at": "2024-03-09T08:25:43Z",
      "url": "https://github.com/vercel/next.js/discussions/63078",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 76638,
      "title": "Invariant: Expected to replace at least one import",
      "question": "### Summary\n\nPretty much every time I add a new file like loader.tsx or page.tsx to my app router, I get this error:\r\n`Invariant: Expected to replace at least one import`\r\n\r\nI'm not sure what it means, but the only way to make it go away, is to restart my dev server, however:\r\nThe other issue here is, if I reload it and initially go to the root path `/` the error is there again, but if I restart and initially go to a subpath `/123` then it goes away and I can use the dev server normally again. \r\n\r\nThis seems to be related to using a `[...slug]` folder at the root of the project...\r\n\r\nSo regardless of if I change anything after the error occurs, it's what I do after I restart the dev server that determines whether an error shows up, and keeps showing up...\r\n\r\nI can't be the only one getting this same error?\n\n### Additional information\n\n```js\n\"next\": \"^15.2.0\",\n```\n\n\n### Example\n\n_No response_",
      "answer": "Closing:\r\n- This issue is likely fixed in newer versions of Next.js. Please open a new issue if it is not.\r\n- This sort of thing can sometimes happen if you're running a different version of next.js than the one installed in your repository. See my comment here: https://github.com/vercel/next.js/discussions/89081#discussioncomment-15676666",
      "category": "Help",
      "created_at": "2025-02-27T22:04:54Z",
      "url": "https://github.com/vercel/next.js/discussions/76638",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89081,
      "title": "Turbopack Error: Invariant: Expected to replace all template variables, missing VAR_MODULE_GLOBAL_ERROR in template",
      "question": "Turbopack version: `v16.1.0-canary.19-84-g3aa53984e`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nInvariant: Expected to replace all template variables, missing VAR_MODULE_GLOBAL_ERROR in template\r\n\r\nDebug info:\r\n- Execution of subscribe_issues_and_diags_operation failed\r\n- Execution of <AppEndpoint as Endpoint>::server_changed failed\r\n- Execution of *Project::server_changed failed\r\n- Execution of *AppEndpointOutput::server_assets failed\r\n- Execution of AppEndpoint::output failed\r\n- Execution of get_app_page_entry failed\r\n- Invariant: Expected to replace all template variables, missing VAR_MODULE_GLOBAL_ERROR in template\r\n```",
      "answer": "Make sure you're using the version of next.js installed in your repository, and not a different version.\r\n\r\nThis can sometimes happen if your run a command like `pnpx`, which installs and uses a different version of next.js.",
      "category": "Turbopack Error Report",
      "created_at": "2026-01-27T06:14:14Z",
      "url": "https://github.com/vercel/next.js/discussions/89081",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 85252,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `9b25f18e`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-10-23T04:09:49Z",
      "url": "https://github.com/vercel/next.js/discussions/85252",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 85341,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `c0b086c6`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-10-25T11:44:52Z",
      "url": "https://github.com/vercel/next.js/discussions/85341",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 85442,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `c0b086c6`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nTurbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-10-28T09:50:36Z",
      "url": "https://github.com/vercel/next.js/discussions/85442",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 85545,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `c0b086c6`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-10-30T04:53:46Z",
      "url": "https://github.com/vercel/next.js/discussions/85545",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 85745,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `40672141`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-03T18:34:58Z",
      "url": "https://github.com/vercel/next.js/discussions/85745",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 85769,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `40672141`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nTurbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "<html>\r\n<body>\r\n<!--StartFragment--><html><head></head><body><p>Yep \u2014 that\u2019s another <strong>internal Turbopack runtime bug</strong>, not your code\u2019s fault.<br>\r\nThe message:</p>\r\n<pre><code>Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId ...\r\n</code></pre>\r\n<p>basically means the <strong>Turbopack task graph got out of sync</strong> \u2014 the build dependency tracker is trying to clean up a task (or \u201cfollower\u201d) that no longer exists.</p>\r\n<p>This usually happens when:</p>\r\n<ul>\r\n<li>\r\n<p>You start/stop <code inline=\"\">next dev</code> repeatedly very quickly</p>\r\n</li>\r\n<li>\r\n<p>The <code inline=\"\">.next/</code> cache is corrupted</p>\r\n</li>\r\n<li>\r\n<p>Turbopack hits an internal race condition while watching files (common in canary or nightly builds)</p>\r\n</li>\r\n</ul>\r\n<hr>\r\n<h3>\u2705 <strong>Quick Fix Steps</strong></h3>\r\n<h4>1. Stop your dev server</h4>\r\n<p>Press <strong>Ctrl + C</strong> in your terminal.</p>\r\n<h4>2. Clear Next.js and Turbopack caches</h4>\r\n<pre><code class=\"language-bash\">rm -rf .next\r\n</code></pre>\r\n<p>or on Windows:</p>\r\n<pre><code class=\"language-bash\">rmdir /s /q .next\r\n</code></pre>\r\n<p>Then also remove lockfiles if needed:</p>\r\n<pre><code class=\"language-bash\">npm ci\r\n</code></pre>\r\n<p>(or <code inline=\"\">yarn install --force</code>)</p>\r\n<h4>3. Restart cleanly</h4>\r\n<pre><code class=\"language-bash\">npm run dev\r\n</code></pre>\r\n<hr>\r\n<h3>\u2705 <strong>If it persists</strong></h3>\r\n<p>Try <strong>disabling Turbopack temporarily</strong>:</p>\r\n<pre><code class=\"language-bash\">next dev --no-turbo\r\n</code></pre>\r\n<p>If your app runs fine afterward, that confirms it\u2019s a Turbopack bug \u2014 not your code.</p>\r\n<hr>\r\n<h3>\u2705 <strong>Long-term Fix / Tracking</strong></h3>\r\n<p>This specific internal error (<code inline=\"\">inner_of_uppers_lost_follower</code>) is a <strong>known bug in experimental Turbopack versions</strong>, tracked in the Next.js repo:<br>\r\n\ud83d\udc49 <a href=\"https://github.com/vercel/next.js/issues\">vercel/next.js/issues</a></p>\r\n<p>You\u2019re using a <strong>canary build</strong> (<code inline=\"\">v16.0.1-canary.5-10-g406721415</code>), so it\u2019s cutting-edge but unstable.<br>\r\nYou can roll back to a stable release:</p>\r\n<pre><code class=\"language-bash\">npm install next@16.0.1\r\n</code></pre>\r\n<p>and then rebuild.</p>\r\n<hr>\r\n<h3>\u2699\ufe0f <strong>Summary</strong></h3>\r\n\r\nCause | Fix\r\n-- | --\r\nTurbopack task graph corruption | Delete .next and restart\r\nCache corruption | npm ci\r\nCanary instability | Downgrade to stable next@16.0.1\r\nJust want it working | Run next dev --no-turbo\r\n\r\n\r\n<hr>\r\n<p>Would you like me to give you a <strong>one-liner PowerShell command</strong> that clears all caches and restarts your app cleanly on Windows?</p></body></html><!--EndFragment-->\r\n</body>\r\n</html>Yep \u2014 that\u2019s another **internal Turbopack runtime bug**, not your code\u2019s fault.\r\nThe message:\r\n\r\n```\r\nTurbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId ...\r\n```\r\n\r\nbasically means the **Turbopack task graph got out of sync** \u2014 the build dependency tracker is trying to clean up a task (or \u201cfollower\u201d) that no longer exists.\r\n\r\nThis usually happens when:\r\n\r\n* You start/stop `next dev` repeatedly very quickly\r\n* The `.next/` cache is corrupted\r\n* Turbopack hits an internal race condition while watching files (common in canary or nightly builds)\r\n\r\n---\r\n\r\n### \u2705 **Quick Fix Steps**\r\n\r\n#### 1. Stop your dev server\r\n\r\nPress **Ctrl + C** in your terminal.\r\n\r\n#### 2. Clear Next.js and Turbopack caches\r\n\r\n```bash\r\nrm -rf .next\r\n```\r\n\r\nor on Windows:\r\n\r\n```bash\r\nrmdir /s /q .next\r\n```\r\n\r\nThen also remove lockfiles if needed:\r\n\r\n```bash\r\nnpm ci\r\n```\r\n\r\n(or `yarn install --force`)\r\n\r\n#### 3. Restart cleanly\r\n\r\n```bash\r\nnpm run dev\r\n```\r\n\r\n---\r\n\r\n### \u2705 **If it persists**\r\n\r\nTry **disabling Turbopack temporarily**:\r\n\r\n```bash\r\nnext dev --no-turbo\r\n```\r\n\r\nIf your app runs fine afterward, that confirms it\u2019s a Turbopack bug \u2014 not your code.\r\n\r\n---\r\n\r\n### \u2705 **Long-term Fix / Tracking**\r\n\r\nThis specific internal error (`inner_of_uppers_lost_follower`) is a **known bug in experimental Turbopack versions**, tracked in the Next.js repo:\r\n\ud83d\udc49 [[vercel/next.js/issues](https://github.com/vercel/next.js/issues)](https://github.com/vercel/next.js/issues)\r\n\r\nYou\u2019re using a **canary build** (`v16.0.1-canary.5-10-g406721415`), so it\u2019s cutting-edge but unstable.\r\nYou can roll back to a stable release:\r\n\r\n```bash\r\nnpm install next@16.0.1\r\n```\r\n\r\nand then rebuild.\r\n\r\n---\r\n\r\n### \u2699\ufe0f **Summary**\r\n\r\n| Cause                           | Fix                               |\r\n| ------------------------------- | --------------------------------- |\r\n| Turbopack task graph corruption | Delete `.next` and restart        |\r\n| Cache corruption                | `npm ci`                          |\r\n| Canary instability              | Downgrade to stable `next@16.0.1` |\r\n| Just want it working            | Run `next dev --no-turbo`         |\r\n\r\n---\r\n\r\n",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-04T14:50:52Z",
      "url": "https://github.com/vercel/next.js/discussions/85769",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 85933,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `v16.0.1-canary.5-10-g406721415`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nTurbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-08T14:14:15Z",
      "url": "https://github.com/vercel/next.js/discussions/85933",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 85945,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `40672141`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This type of error usually comes from Turbopack\u2019s internal task graph losing synchronization between tasks (in this case between EntrypointsOperation::new and ProjectContainer::entrypoints).\r\n\r\nIt typically means the incremental build cache became invalid or corrupted \u2014 for example, when files were added/removed quickly during a rebuild or a previous build was interrupted.\r\n\r\nSteps that often fix it:\r\n\r\nClean the cache and rebuild completely:\r\nRestart Turbopack after deleting the .next folder.\r\nSometimes stale graph metadata remains even after rebuilds.\r\n\r\nCheck file watch limits / network drives.\r\nIf you\u2019re developing on a remote or synced filesystem (like WSL, Docker volume, or cloud folder), Turbopack may lose file change events and get out of sync.\r\n\r\nUpgrade to the latest Next.js canary, since many internal Turbopack fixes are released daily:\r\n\r\nIf reproducible, it would help to share your repo structure (especially custom entrypoints or plugins) so maintainers can trace where the invalid graph state originates.",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-09T07:32:52Z",
      "url": "https://github.com/vercel/next.js/discussions/85945",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 85963,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `142b08bf`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-10T10:12:32Z",
      "url": "https://github.com/vercel/next.js/discussions/85963",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 85968,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `142b08bf`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-10T12:02:31Z",
      "url": "https://github.com/vercel/next.js/discussions/85968",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 85987,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `40672141`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-11T05:37:54Z",
      "url": "https://github.com/vercel/next.js/discussions/85987",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 85995,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 17 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `v16.0.1-canary.5-10-g406721415`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 17 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 17 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-11T09:07:02Z",
      "url": "https://github.com/vercel/next.js/discussions/85995",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 86003,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 18 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `v16.0.1-canary.5-10-g406721415`\r\nNext.js version: `16.0.1`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 18 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 18 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-11T12:13:59Z",
      "url": "https://github.com/vercel/next.js/discussions/86003",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 86026,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `40672141`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-12T06:27:44Z",
      "url": "https://github.com/vercel/next.js/discussions/86026",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 86038,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `142b08bf`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-12T10:47:33Z",
      "url": "https://github.com/vercel/next.js/discussions/86038",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 86057,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 18 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `40672141`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 18 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 18 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```\r\n\r\n\r\nI tried running dev",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-12T20:33:15Z",
      "url": "https://github.com/vercel/next.js/discussions/86057",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 86092,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `40672141`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-13T17:03:25Z",
      "url": "https://github.com/vercel/next.js/discussions/86092",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 86107,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `40672141`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-14T00:07:18Z",
      "url": "https://github.com/vercel/next.js/discussions/86107",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 86113,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `40672141`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-14T03:54:29Z",
      "url": "https://github.com/vercel/next.js/discussions/86113",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 86286,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `40672141`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-19T09:20:52Z",
      "url": "https://github.com/vercel/next.js/discussions/86286",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 86287,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `c0b086c6`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-19T09:53:34Z",
      "url": "https://github.com/vercel/next.js/discussions/86287",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 86348,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `40672141`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-20T11:50:16Z",
      "url": "https://github.com/vercel/next.js/discussions/86348",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 86488,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `40672141`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "I\u2019m encountering an internal Turbopack task graph error during development:\r\n\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges.\r\n\r\nDebug info:\r\n- get_written_endpoint_with_issues_operation failed\r\n- endpoint_write_to_disk_operation failed\r\n- pick_endpoint failed\r\n- entrypoints_without_collectibles_operation failed\r\n\r\nEnvironment:\r\n- Turbopack version: 40672141\r\n- Next.js version is reported as 0.0.0 (likely a corrupted install)\r\n\r\nSteps I tried:\r\n1. Deleted `.next`, `.turbopack`, and `node_modules` and reinstalled all packages.\r\n2. Updated to `next@latest`.\r\n3. Ran `next dev --no-turbo` \u2014 the project works without Turbopack, so the issue appears Turbopack-related.\r\n4. Updated Node.js to the latest LTS version.\r\n5. Created a fresh Next.js project and the issue does not appear there.\r\n\r\nIt seems like an internal Turbopack graph inconsistency.  \r\nPlease advise if this is a known issue or if you need more logs or a minimal reproduction.",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-25T02:47:59Z",
      "url": "https://github.com/vercel/next.js/discussions/86488",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 86543,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `v16.0.1-canary.5-10-g406721415`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```\r\n\r\n---\r\n\r\nHi, \r\n\r\nThis error was printed to my console. It also asked me to report it \ud83d\ude04 \r\n\r\nAdditional info:\r\n\r\n```\r\nthread 'tokio-runtime-worker' (3846211) panicked at /Users/geist/dev/actions-runner/_work/next.js/next.js/turbopack/crates/turbo-tasks-backend/src/backend/operation/aggregation_update.rs:1420:17:\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-26T13:16:43Z",
      "url": "https://github.com/vercel/next.js/discussions/86543",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 86545,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `40672141`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nTurbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```\r\n\r\n$ npm run dev\r\n\r\n> react@0.1.0 dev\r\n> set PORT=3001 && next dev\r\n\r\n   \u25b2 Next.js 16.0.1 (Turbopack)\r\n   - Local:        http://localhost:3001\r\n   - Network:      http://192.168.45.60:3001\r\n   - Environments: .env.local\r\n\r\n \u2713 Starting...\r\n\r\nthread 'tokio-runtime-worker' (12164) panicked at C:\\actions-runner\\_work\\next.js\\next.js\\turbopack\\crates\\turbo-tasks-backend\\src\\backend\\operation\\aggregation_update.rs:1420:17:\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n \u2713 Ready in 59.9s\r\n\r\n-----\r\nFATAL: An unexpected Turbopack error occurred. A panic log has been written to C:\\Users\\kkh\\AppData\\Local\\Temp\\next-panic-26869e92c7872284619651f9cd8f5879.log.\r\n\r\nTo help make Turbopack better, report this error by clicking here: https://github.com/vercel/next.js/discussions/new?category=turbopack-error-report&title=Turbopack%20Error%3A%20inner_of_uppers_lost_follower%20is%20not%20able%20to%20remove%20follower%20TaskId%2017%20%28ProjectContainer%3A%3Aentrypoints%29%20from%20TaskId%2016%20%28EntrypointsOperation%3A%3Anew%29%20as%20they%20don%27t%20exist%20as%20upper%20or%20follower%20edges&body=Turbopack%20version%3A%20%6040672141%60%0ANext.js%20version%3A%20%600.0.0%60%0A%0AError%20message%3A%0A%60%60%60%0ATurbopack%20Error%3A%20inner_of_uppers_lost_follower%20is%20not%20able%20to%20remove%20follower%20TaskId%2017%20%28ProjectContainer%3A%3Aentrypoints%29%20from%20TaskId%2016%20%28EntrypointsOperation%3A%3Anew%29%20as%20they%20don%27t%20exist%20as%20upper%20or%20follower%20edges%0A%60%60%60&labels=Turbopack,Turbopack%20Panic%20Backtrace\r\n-----\r\n\r\n \u2a2f Error [TurbopackInternalError]: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n    at <unknown> (TurbopackInternalError: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges) {\r\n  location: 'C:\\\\actions-runner\\\\_work\\\\next.js\\\\next.js\\\\turbopack\\\\crates\\\\turbo-tasks-backend\\\\src\\\\backend\\\\operation\\\\aggregation_update.rs:1420:17'\r\n}\r\nError [TurbopackInternalError]: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-26T14:04:30Z",
      "url": "https://github.com/vercel/next.js/discussions/86545",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 86605,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `v16.0.1-canary.5-10-g406721415`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nTurbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-28T08:48:54Z",
      "url": "https://github.com/vercel/next.js/discussions/86605",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 86610,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `9b25f18e`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nTurbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-11-28T12:01:34Z",
      "url": "https://github.com/vercel/next.js/discussions/86610",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 86741,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `40672141`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-12-02T15:56:23Z",
      "url": "https://github.com/vercel/next.js/discussions/86741",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 88278,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `40672141`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 16 (ProjectContainer::entrypoints) from TaskId 19 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2026-01-08T14:57:00Z",
      "url": "https://github.com/vercel/next.js/discussions/88278",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89376,
      "title": "Turbopack Error: inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges",
      "question": "Turbopack version: `40672141`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of endpoint_write_to_disk_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- inner_of_uppers_lost_follower is not able to remove follower TaskId 17 (ProjectContainer::entrypoints) from TaskId 16 (EntrypointsOperation::new) as they don't exist as upper or follower edges\r\n```",
      "answer": "This discussion appears to be a duplicate of #85369.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/85369\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2026-02-02T08:43:10Z",
      "url": "https://github.com/vercel/next.js/discussions/89376",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 82277,
      "title": "Turbopack Error: internal error: entered unreachable code: there must be a path to a root",
      "question": "Turbopack version: > `v15.4.1`\r\nNext.js version: > `15.4.1`\r\n\r\n### Error message:\r\n```\r\nTurbopack Error: internal error: entered unreachable code: there must be a path to a root\r\n```\r\n\r\n\r\n### Details:\r\nStarting with Next.js 15.4.1, we get an error when trying to run `next dev --turbopack`.\r\n\r\n```\r\nyarn run v1.22.22\r\n$ next dev --turbopack\r\n   \u25b2 Next.js 15.4.1 (Turbopack)\r\n   - Local:        http://localhost:3000\r\n   - Network:      http://192.168.1.126:3000\r\n   - Environments: .env.local\r\n\r\n \u2713 Starting...\r\n\r\nthread 'tokio-runtime-worker' panicked at turbopack/crates/turbopack-core/src/module_graph/mod.rs:934:25:\r\ninternal error: entered unreachable code: there must be a path to a root\r\nstack backtrace:\r\n \u25cb Compiling instrumentation Node.js ...\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n\r\nthread 'tokio-runtime-worker' panicked at turbopack/crates/turbopack-core/src/module_graph/mod.rs:934:25:\r\ninternal error: entered unreachable code: there must be a path to a root\r\nstack backtrace:\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n\r\nthread 'tokio-runtime-worker' panicked at turbopack/crates/turbopack-core/src/module_graph/mod.rs:934:25:\r\ninternal error: entered unreachable code: there must be a path to a root\r\nstack backtrace:\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n\r\n[... This repeats a couple of times]\r\n\r\nthread 'tokio-runtime-worker' panicked at turbopack/crates/turbopack-core/src/module_graph/mod.rs:934:25:\r\ninternal error: entered unreachable code: there must be a path to a root\r\nstack backtrace:\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n\r\nthread 'tokio-runtime-worker' panicked at turbopack/crates/turbopack-core/src/module_graph/mod.rs:934:25:\r\ninternal error: entered unreachable code: there must be a path to a root\r\nstack backtrace:\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n[Error [TurbopackInternalError]: internal error: entered unreachable code: there must be a path to a root\r\n\r\nDebug info:\r\n- Execution of TaskId { id: 2147483651 } transient failed\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of PlainIssue::from_issue failed\r\n- Execution of <ModuleGraphImportTracer as ImportTracer>::get_traces failed\r\n- internal error: entered unreachable code: there must be a path to a root]\r\n\r\n\u2728  Done in 6.24s.\r\n\r\n\r\n```\r\n\r\n<details>\r\n<summary>When setting `RUST_BACKTRACE=full`, there is some more information:</summary>\r\n\r\n```\r\nthread 'tokio-runtime-worker' panicked at turbopack/crates/turbopack-core/src/module_graph/mod.rs:934:25:\r\ninternal error: entered unreachable code: there must be a path to a root\r\nstack backtrace:\r\n   0:        0x58f10992c - _napi_register_module_v1\r\n   1:        0x58f12d968 - _napi_register_module_v1\r\n   2:        0x58f1048c8 - _napi_register_module_v1\r\n   3:        0x58f1097e0 - _napi_register_module_v1\r\n   4:        0x58f10be38 - _napi_register_module_v1\r\n   5:        0x58f10bc88 - _napi_register_module_v1\r\n   6:        0x58f10c938 - _napi_register_module_v1\r\n   7:        0x58f10c500 - _napi_register_module_v1\r\n   8:        0x58f109df0 - _napi_register_module_v1\r\n   9:        0x58f10c1d0 - _napi_register_module_v1\r\n  10:        0x58f27e8ac - _napi_register_module_v1\r\n  11:        0x58d409838 - _BrotliDecoderVersion\r\n  12:        0x58d60fea4 - _BrotliDecoderVersion\r\n  13:        0x58d3f464c - _BrotliDecoderVersion\r\n  14:        0x58a243aac - <unknown>\r\n  15:        0x58a29f35c - <unknown>\r\n  16:        0x58a26b730 - <unknown>\r\n  17:        0x58a26a680 - <unknown>\r\n  18:        0x58a29eea0 - <unknown>\r\n  19:        0x58a0392c8 - <unknown>\r\n  20:        0x589f43d2c - <unknown>\r\n  21:        0x589f50db0 - <unknown>\r\n  22:        0x589f51164 - <unknown>\r\n  23:        0x58f0c92ac - _napi_register_module_v1\r\n  24:        0x58f0c8a00 - _napi_register_module_v1\r\n  25:        0x58f0b0400 - _napi_register_module_v1\r\n  26:        0x58f0aff00 - _napi_register_module_v1\r\n  27:        0x58f0c8028 - _napi_register_module_v1\r\n  28:        0x58f0b7d68 - _napi_register_module_v1\r\n  29:        0x58f0c2d90 - _napi_register_module_v1\r\n  30:        0x58f0990ac - _napi_register_module_v1\r\n  31:        0x58f093168 - _napi_register_module_v1\r\n  32:        0x58f0b69a0 - _napi_register_module_v1\r\n  33:        0x58f0a34e0 - _napi_register_module_v1\r\n  34:        0x58f09bec4 - _napi_register_module_v1\r\n  35:        0x58f09c278 - _napi_register_module_v1\r\n  36:        0x58f10ed50 - _napi_register_module_v1\r\n  37:        0x198d95c0c - __pthread_cond_wait\r\n```\r\n</details>\r\n\r\nRunning without `--turbopack` still works (obviously).\r\n\r\n\r\nI cannot find anything anywhere about this issue related to Next.js. \r\nWhile I am aware of this being one of the annoying \"crying for help\" posts, I don't know what else to do. Therefore:\r\nAny help is much appreciated!!",
      "answer": "Same here\r\n\r\nTurbopack version: `v15.5.2-3-gdb56d7759`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nTurbopack Error: internal error: entered unreachable code: there must be a path to a root\r\n```\r\n\r\n<details>\r\n<summary>Full log with RUST_BACKTRACE=full</summary>\r\n\r\n```\r\n> next dev --turbopack\r\n\r\n   \u25b2 Next.js 15.5.3 (Turbopack)\r\n   - Local:        http://localhost:3000\r\n   - Network:      http://192.168.50.199:3000\r\n\r\n \u2713 Starting...\r\n(node:88175) Warning: Setting the NODE_TLS_REJECT_UNAUTHORIZED environment variable to '0' makes TLS connections and HTTPS requests insecure by disabling certificate verification.\r\n(Use `node --trace-warnings ...` to show where the warning was created)\r\n \u2713 Ready in 876ms\r\n \u25cb Compiling / ...\r\nBrowserslist: browsers data (caniuse-lite) is 11 months old. Please run:\r\n  npx update-browserslist-db@latest\r\n  Why you should do it regularly: https://github.com/browserslist/update-db#readme\r\n\r\nthread 'tokio-runtime-worker' panicked at turbopack/crates/turbopack-core/src/module_graph/mod.rs:996:25:\r\ninternal error: entered unreachable code: there must be a path to a root\r\nstack backtrace:\r\n   0:        0x514bcf814 - _napi_register_module_v1\r\n   1:        0x514bf3194 - _napi_register_module_v1\r\n   2:        0x514bcabc4 - _napi_register_module_v1\r\n   3:        0x514bcf6c8 - _napi_register_module_v1\r\n   4:        0x514bd1d20 - _napi_register_module_v1\r\n   5:        0x514bd1b70 - _napi_register_module_v1\r\n   6:        0x514bd2820 - _napi_register_module_v1\r\n   7:        0x514bd23e8 - _napi_register_module_v1\r\n   8:        0x514bcfcd8 - _napi_register_module_v1\r\n   9:        0x514bd20b8 - _napi_register_module_v1\r\n  10:        0x514d3fc94 - _napi_register_module_v1\r\n  11:        0x5133daecc - _BrotliDecoderVersion\r\n  12:        0x51337a4c0 - _BrotliDecoderVersion\r\n  13:        0x5133caa94 - _BrotliDecoderVersion\r\n  14:        0x50fce2a30 - <unknown>\r\n  15:        0x50fca07a8 - <unknown>\r\n  16:        0x50fc6c5e4 - <unknown>\r\n  17:        0x50fc6b570 - <unknown>\r\n  18:        0x50fca0544 - <unknown>\r\n  19:        0x50ff09d9c - <unknown>\r\n  20:        0x50fbec888 - <unknown>\r\n  21:        0x50fbf73cc - <unknown>\r\n  22:        0x50fbf7780 - <unknown>\r\n  23:        0x514b9c660 - _napi_register_module_v1\r\n  24:        0x514b9bdb4 - _napi_register_module_v1\r\n  25:        0x514b6ce24 - _napi_register_module_v1\r\n  26:        0x514b6c924 - _napi_register_module_v1\r\n  27:        0x514b9b3dc - _napi_register_module_v1\r\n  28:        0x514b746d0 - _napi_register_module_v1\r\n  29:        0x514b83f98 - _napi_register_module_v1\r\n  30:        0x514b5fee8 - _napi_register_module_v1\r\n  31:        0x514b59fa4 - _napi_register_module_v1\r\n  32:        0x514b73308 - _napi_register_module_v1\r\n  33:        0x514b96198 - _napi_register_module_v1\r\n  34:        0x514b62d00 - _napi_register_module_v1\r\n  35:        0x514b630b4 - _napi_register_module_v1\r\n  36:        0x514bd4c38 - _napi_register_module_v1\r\n  37:        0x18a44fc0c - __pthread_cond_wait\r\n\r\n-----\r\nFATAL: An unexpected Turbopack error occurred. A panic log has been written to /var/folders/by/r61tv1g57ygbhphnkt4zy9jc0000gn/T/next-panic-b180009776224449561c26aac63ab761.log.\r\n\r\nTo help make Turbopack better, report this error by clicking here: https://github.com/vercel/next.js/discussions/new?category=turbopack-error-report&title=Turbopack%20Error%3A%20internal%20error%3A%20entered%20unreachable%20code%3A%20there%20must%20be%20a%20path%20to%20a%20root&body=Turbopack%20version%3A%20%60v15.5.2-3-gdb56d7759%60%0ANext.js%20version%3A%20%600.0.0%60%0A%0AError%20message%3A%0A%60%60%60%0ATurbopack%20Error%3A%20internal%20error%3A%20entered%20unreachable%20code%3A%20there%20must%20be%20a%20path%20to%20a%20root%0A%60%60%60&labels=Turbopack,Turbopack%20Panic%20Backtrace\r\n-----\r\n\r\n \u2713 Compiled / in 3.7s\r\n \u2713 Compiled /_error in 155ms\r\n \u2a2f Error [TurbopackInternalError]: internal error: entered unreachable code: there must be a path to a root\r\n\r\nDebug info:\r\n- Execution of TaskId { id: 2147483656 } transient failed\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of PlainIssue::from_issue failed\r\n- Execution of <ModuleGraphImportTracer as ImportTracer>::get_traces failed\r\n- internal error: entered unreachable code: there must be a path to a root\r\n    at <unknown> (TurbopackInternalError: internal error: entered unreachable code: there must be a path to a root) {\r\n  location: 'turbopack/crates/turbopack-core/src/module_graph/mod.rs:996:25'\r\n}\r\nError [TurbopackInternalError]: internal error: entered unreachable code: there must be a path to a root\r\n\r\nDebug info:\r\n- Execution of TaskId { id: 2147483652 } transient failed\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of PlainIssue::from_issue failed\r\n- Execution of <ModuleGraphImportTracer as ImportTracer>::get_traces failed\r\n- internal error: entered unreachable code: there must be a path to a root\r\n    at <unknown> (TurbopackInternalError: internal error: entered unreachable code: there must be a path to a root) {\r\n  location: 'turbopack/crates/turbopack-core/src/module_graph/mod.rs:996:25'\r\n}\r\n \u2a2f Error [TurbopackInternalError]: internal error: entered unreachable code: there must be a path to a root\r\n\r\nDebug info:\r\n- Execution of TaskId { id: 2147483660 } transient failed\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of PlainIssue::from_issue failed\r\n- Execution of <ModuleGraphImportTracer as ImportTracer>::get_traces failed\r\n- internal error: entered unreachable code: there must be a path to a root\r\n    at <unknown> (TurbopackInternalError: internal error: entered unreachable code: there must be a path to a root) {\r\n  location: 'turbopack/crates/turbopack-core/src/module_graph/mod.rs:996:25'\r\n}\r\nError [TurbopackInternalError]: internal error: entered unreachable code: there must be a path to a root\r\n\r\nDebug info:\r\n- Execution of TaskId { id: 2147483662 } transient failed\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of PlainIssue::from_issue failed\r\n- Execution of <ModuleGraphImportTracer as ImportTracer>::get_traces failed\r\n- internal error: entered unreachable code: there must be a path to a root\r\n    at <unknown> (TurbopackInternalError: internal error: entered unreachable code: there must be a path to a root) {\r\n  location: 'turbopack/crates/turbopack-core/src/module_graph/mod.rs:996:25'\r\n}\r\n```\r\n\r\n</details>\r\n\r\n",
      "category": "Turbopack Error Report",
      "created_at": "2025-08-01T14:19:31Z",
      "url": "https://github.com/vercel/next.js/discussions/82277",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 84205,
      "title": "Turbopack Error: internal error: entered unreachable code: there must be a path to a root",
      "question": "Turbopack version: `v15.5.3-10-g26d61f1e9`\r\n\r\nError message:\r\n```\r\ninternal error: entered unreachable code: there must be a path to a root\r\n\r\nDebug info:\r\n- Execution of TaskId { id: 2147483651 } transient failed\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of PlainIssue::from_issue failed\r\n- Execution of <ModuleGraphImportTracer as ImportTracer>::get_traces failed\r\n- internal error: entered unreachable code: there must be a path to a root\r\n```",
      "answer": "This discussion appears to be a duplicate of #82277.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/82277\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-09-24T21:58:13Z",
      "url": "https://github.com/vercel/next.js/discussions/84205",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 84340,
      "title": "Turbopack Error: internal error: entered unreachable code: there must be a path to a root",
      "question": "Turbopack version: `26d61f1e`\r\nNext.js version: `15.5.4 (Turbopack)`\r\nPlatform: Windows 11\r\n\r\nError message:\r\n```\r\nTurbopack Error: internal error: entered unreachable code: there must be a path to a root\r\n```\r\n\r\nPanic log file:\r\n```\r\n---------------------------\r\ninternal error: entered unreachable code: there must be a path to a root\r\n\r\nDebug info:\r\n- Execution of TaskId { id: 2147483654 } transient failed\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of PlainIssue::from_issue failed\r\n- Execution of <ModuleGraphImportTracer as ImportTracer>::get_traces failed\r\n- internal error: entered unreachable code: there must be a path to a root\r\n```",
      "answer": "This discussion appears to be a duplicate of #82277.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/82277\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-09-29T12:24:32Z",
      "url": "https://github.com/vercel/next.js/discussions/84340",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 87391,
      "title": "Turbopack Error: internal error: entered unreachable code: there must be a path to a root",
      "question": "Turbopack version: `911504000`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninternal error: entered unreachable code: there must be a path to a root\r\n\r\nDebug info:\r\n- Execution of TaskId { id: 2147483652 } transient failed\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of PlainIssue::from_issue failed\r\n- Execution of <ModuleGraphImportTracer as ImportTracer>::get_traces failed\r\n- internal error: entered unreachable code: there must be a path to a root\r\n```",
      "answer": "This discussion appears to be a duplicate of #82277.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/82277\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-12-19T11:23:38Z",
      "url": "https://github.com/vercel/next.js/discussions/87391",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89076,
      "title": "Turbopack Error: internal error: entered unreachable code: there must be a path to a root",
      "question": "Turbopack version: `v16.1.0-canary.22-76-gacba4a6b9`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\ninternal error: entered unreachable code: there must be a path to a root\r\n\r\nDebug info:\r\n- Execution of get_written_endpoint_with_issues_operation failed\r\n- Execution of PlainIssue::from_issue failed\r\n- Execution of <ModuleGraphImportTracer as ImportTracer>::get_traces failed\r\n- internal error: entered unreachable code: there must be a path to a root\r\n```",
      "answer": "This discussion appears to be a duplicate of #82277.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/82277\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2026-01-27T03:39:30Z",
      "url": "https://github.com/vercel/next.js/discussions/89076",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 89303,
      "title": "Universal route CSS preload causing render-blocking bloat in turbopack and webpack",
      "question": "\r\nWhile analyzing a Turbopack CSS issue, I noticed that CSS from universal routes (specifically `app/not-found`) is being preloaded globally.\r\n\r\nAfter testing **production builds with both Turbopack and Webpack**, this does not appear to be Turbopack-only. The same behavior occurs in both pipelines.\r\n\r\n## Reproduction summary\r\n\r\n- `Button.module.scss` is only used in `home` + `not-found`\r\n- dashboard routes do not import Button\r\n- however, the CSS is still preloaded and render-blocking there\r\n\r\nThe preload link appears in unrelated routes:\r\n\r\n```html\r\n<link rel=\"preload\" href=\"/_next/static/...not-found...css\" as=\"style\">\r\n````\r\n\r\nThis suggests universal route hoisting is promoting CSS into a higher shared chunk.\r\n\r\n## Impact\r\n\r\nIn small apps this is harmless, but in large apps it scales poorly:\r\n\r\n* unused fallback CSS blocks paint\r\n* CSS chunk size grows with app complexity\r\n* Lighthouse blocking time increases\r\n\r\nAdditionally, universal CSS preload appears before route-critical CSS, effectively prioritizing fallback styles over active route styles.\r\n\r\n## Question about intent\r\n\r\nBefore attempting a fix, I want to confirm:\r\n\r\n> Is this preload behavior intentional to optimize transitions, or an unintended side effect of the bundling heuristic?\r\n\r\nIf intentional, would there be interest in exploring an opt-out or heuristic tweak (e.g. lower-priority or deferred loading for universal error routes) so route-critical CSS remains unblocked?\r\n\r\nHappy to prototype or explore implementation once design intent is clarified.\r\n\r\n---\r\n\r\nRelated: #89252\r\n\r\n\r\n\r\n",
      "answer": "**Yes, this is currently expected behavior (Architecture Trade-off), but your observation on scaling is valid.**\r\n\r\n### The \"Why\" (Intent)\r\nIn the App Router model, `app/not-found` and `app/error` are treated as part of the **Global Shell** availability. Since any route segment can potentially throw a 404 or an Error during streaming or navigation, Next.js eagerly preloads these fallback UI styles to ensure an **instant, layout-shift-free transition** to the error state.\r\n* If these were lazy-loaded, a user hitting a 404 would likely see a blank screen or unstyled content while the browser fetches the new chunk, degrading the UX during a critical failure moment.\r\n\r\n### The Optimization Gap\r\nHowever, you are absolutely right that for large applications, blocking the *critical path* of the successful render to optimize for the *failure path* is a suboptimal trade-off (Lighthouse impact).\r\n\r\n### Recommendations\r\n1.  **Immediate Mitigation:** Ensure your `not-found.tsx` is extremely lightweight. Avoid importing heavy UI libraries in that specific file; stick to Tailwind utility classes or inline styles to keep that hoisted chunk minimal.\r\n2.  **Next Steps:** Since you mentioned interest in prototyping a heuristic tweak , **you should definitely open a Feature Request Issue** with your findings. The core team would likely be open to moving these \"universal routes\" to a non-blocking loading strategy.\r\n\r\nHope this clarifies the \"Intent\" vs \"Side effect\" question",
      "category": "App Router",
      "created_at": "2026-01-30T16:38:21Z",
      "url": "https://github.com/vercel/next.js/discussions/89303",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 86681,
      "title": "Baseline Browser Mapping - module is over two months old warning?",
      "question": "### Summary\n\nHey!\r\n\r\nI'm experiencing an unusual issue with the NPM plugin 'baseline-browser-mapping'. A warning is appearing that shouldn't be there.\r\n\r\nThis started happening about two days ago when I start the dev server or run a build in Next.js.\r\n\r\nWarning:\r\n[baseline-browser-mapping] The data in this module is over two months old. To ensure accurate Baseline data, please update: npm i baseline-browser-mapping@latest -D\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_",
      "answer": "Investigating this as well, I got it on my personal project. Normally you'd get a warning every now and then, that you need to update your browserslist db, every now and then, but this doesn't look like the same issue.\r\n\r\nAdding some literature here:\r\n\r\n- https://github.com/web-platform-dx/baseline-browser-mapping/issues/107\r\n- https://github.com/web-platform-dx/baseline-browser-mapping/issues/105\r\n\r\nLooks like the baseline-browser-mapping package does a literal time check against its last update (?), and if its more than 2 months it starts to print this warning... `Upstream` issue I guess, let's track the conversation in https://github.com/web-platform-dx/baseline-browser-mapping/issues/105\r\n\r\n**EDIT**: Next.js already did a bump: https://github.com/vercel/next.js/pull/86625 which is included in [16.0.6](https://github.com/vercel/next.js/releases/tag/v16.0.6)",
      "category": "Help",
      "created_at": "2025-12-01T09:16:10Z",
      "url": "https://github.com/vercel/next.js/discussions/86681",
      "has_official_answer": true
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 78232,
      "title": "Turbopack Error: Next.js package not found",
      "question": "yarn dev\r\n   \u25b2 Next.js 15.3.0 (Turbopack)\r\n   - Local:        http://localhost:3000\r\n   - Network:      http://145.239.11.24:3000\r\n\r\n \u2713 Starting...\r\n\r\n-----\r\nFATAL: An unexpected Turbopack error occurred. A panic log has been written to /tmp/next-panic-82c7942b630d792e17ebc091b8f76c02.log.\r\n\r\nTo help make Turbopack better, report this error by clicking here: https://github.com/vercel/next.js/discussions/new?category=turbopack-error-report&title=Turbopack%20Error%3A%20Next.js%20package%20not%20found&body=Turbopack%20version%3A%20%60664110c1%60%0A%0AError%20message%3A%0A%60%60%60%0ATurbopack%20Error%3A%20Next.js%20package%20not%20found%0A%60%60%60&labels=Turbopack,Turbopack%20Panic%20Backtrace\r\n-----\r\n\r\n[Error [TurbopackInternalError]: Next.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of directory_tree_to_loader_tree failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found]\r\n",
      "answer": "Thanks for the report! This error usually happens when Turbopack determined your project\u2019s root directory based on a lockfile that exists further down the filesystem than where next is installed.\r\n\r\nFor example, something like this:\r\n\r\n```\r\nrepo/\r\n  package.json\r\n  package-lock.json\r\n  node_modules/next\r\n  apps/\r\n    my-app/\r\n      package.json\r\n      package-lock.json\r\n      app/\r\n        page.tsx\r\n```\r\n\r\nHere, Turbopack determined the root directory to be `my-app`, but Next.js is installed further up the tree.\r\n\r\nYou\u2019ll need to either:\r\n- Remove the lockfile inside `my-app` if possible, or\r\n- Set `turbopack.root` in to `next.config.js` to your repository\u2019s root directory (or wherever Next.js is installed), as described [here](https://nextjs.org/docs/app/api-reference/config/next-config-js/turbopack#root-directory)\r\n\r\nWe\u2019re working on a better way of communicating this problem, and exploring other approaches where the root directory can be better discovered automatically.",
      "category": "Turbopack Error Report",
      "created_at": "2025-04-16T10:19:42Z",
      "url": "https://github.com/vercel/next.js/discussions/78232",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 78248,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `v15.3.0-canary.45-23-g664110c18`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of directory_tree_to_loader_tree failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "Thanks for the report! This error usually happens when Turbopack determined your project\u2019s root directory based on a lockfile that exists further down the filesystem than where next is installed.\r\n\r\nFor example, something like this:\r\n\r\n```\r\nrepo/\r\n  package.json\r\n  package-lock.json\r\n  node_modules/next\r\n  apps/\r\n    my-app/\r\n      package.json\r\n      package-lock.json\r\n      app/\r\n        page.tsx\r\n```\r\n\r\nHere, Turbopack determined the root directory to be `my-app`, but Next.js is installed further up the tree.\r\n\r\nYou\u2019ll need to either:\r\n- Remove the lockfile inside `my-app` if possible, or\r\n- Set `turbopack.root` in to `next.config.js` to your repository\u2019s root directory (or wherever Next.js is installed), as described [here](https://nextjs.org/docs/app/api-reference/config/next-config-js/turbopack#root-directory)\r\n\r\nWe\u2019re working on a better way of communicating this problem, and exploring other approaches where the root directory can be better discovered automatically.",
      "category": "Turbopack Error Report",
      "created_at": "2025-04-16T13:48:41Z",
      "url": "https://github.com/vercel/next.js/discussions/78248",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 78497,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `v15.3.0-canary.45-23-g664110c18`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of directory_tree_to_loader_tree failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "Thanks for the report! This error usually happens when Turbopack determined your project\u2019s root directory based on a lockfile that exists further down the filesystem than where next is installed.\r\n\r\nFor example, something like this:\r\n\r\n```\r\nrepo/\r\n  package.json\r\n  package-lock.json\r\n  node_modules/next\r\n  apps/\r\n    my-app/\r\n      package.json\r\n      package-lock.json\r\n      app/\r\n        page.tsx\r\n```\r\n\r\nHere, Turbopack determined the root directory to be `my-app`, but Next.js is installed further up the tree.\r\n\r\nYou\u2019ll need to either:\r\n- Remove the lockfile inside `my-app` if possible, or\r\n- Set `turbopack.root` in to `next.config.js` to your repository\u2019s root directory (or wherever Next.js is installed), as described [here](https://nextjs.org/docs/app/api-reference/config/next-config-js/turbopack#root-directory)\r\n\r\nWe\u2019re working on a better way of communicating this problem, and exploring other approaches where the root directory can be better discovered automatically.",
      "category": "Turbopack Error Report",
      "created_at": "2025-04-24T09:25:00Z",
      "url": "https://github.com/vercel/next.js/discussions/78497",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 78583,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `v15.3.0-5-gfa536cf2c`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of directory_tree_to_loader_tree failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "Thanks for the report! This error usually happens when Turbopack determined your project\u2019s root directory based on a lockfile that exists further down the filesystem than where next is installed.\r\n\r\nFor example, something like this:\r\n\r\n```\r\nrepo/\r\n  package.json\r\n  package-lock.json\r\n  node_modules/next\r\n  apps/\r\n    my-app/\r\n      package.json\r\n      package-lock.json\r\n      app/\r\n        page.tsx\r\n```\r\n\r\nHere, Turbopack determined the root directory to be `my-app`, but Next.js is installed further up the tree.\r\n\r\nYou\u2019ll need to either:\r\n- Remove the lockfile inside `my-app` if possible, or\r\n- Set `turbopack.root` in to `next.config.js` to your repository\u2019s root directory (or wherever Next.js is installed), as described [here](https://nextjs.org/docs/app/api-reference/config/next-config-js/turbopack#root-directory)\r\n\r\nWe\u2019re working on a better way of communicating this problem, and exploring other approaches where the root directory can be better discovered automatically.",
      "category": "Turbopack Error Report",
      "created_at": "2025-04-26T12:14:42Z",
      "url": "https://github.com/vercel/next.js/discussions/78583",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 78585,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `v15.3.0-5-gfa536cf2c`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of directory_tree_to_loader_tree failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "Thanks for the report! This error usually happens when Turbopack determined your project\u2019s root directory based on a lockfile that exists further down the filesystem than where next is installed.\r\n\r\nFor example, something like this:\r\n\r\n```\r\nrepo/\r\n  package.json\r\n  package-lock.json\r\n  node_modules/next\r\n  apps/\r\n    my-app/\r\n      package.json\r\n      package-lock.json\r\n      app/\r\n        page.tsx\r\n```\r\n\r\nHere, Turbopack determined the root directory to be `my-app`, but Next.js is installed further up the tree.\r\n\r\nYou\u2019ll need to either:\r\n- Remove the lockfile inside `my-app` if possible, or\r\n- Set `turbopack.root` in to `next.config.js` to your repository\u2019s root directory (or wherever Next.js is installed), as described [here](https://nextjs.org/docs/app/api-reference/config/next-config-js/turbopack#root-directory)\r\n\r\nWe\u2019re working on a better way of communicating this problem, and exploring other approaches where the root directory can be better discovered automatically.",
      "category": "Turbopack Error Report",
      "created_at": "2025-04-26T17:44:53Z",
      "url": "https://github.com/vercel/next.js/discussions/78585",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 78701,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `fa536cf2`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "Thanks for the report! This error usually happens when Turbopack determined your project\u2019s root directory based on a lockfile that exists further down the filesystem than where next is installed.\r\n\r\nFor example, something like this:\r\n\r\n```\r\nrepo/\r\n  package.json\r\n  package-lock.json\r\n  node_modules/next\r\n  apps/\r\n    my-app/\r\n      package.json\r\n      package-lock.json\r\n      app/\r\n        page.tsx\r\n```\r\n\r\nHere, Turbopack determined the root directory to be `my-app`, but Next.js is installed further up the tree.\r\n\r\nYou\u2019ll need to either:\r\n- Remove the lockfile inside `my-app` if possible, or\r\n- Set `turbopack.root` in to `next.config.js` to your repository\u2019s root directory (or wherever Next.js is installed), as described [here](https://nextjs.org/docs/app/api-reference/config/next-config-js/turbopack#root-directory)\r\n\r\nWe\u2019re working on a better way of communicating this problem, and exploring other approaches where the root directory can be better discovered automatically.",
      "category": "Turbopack Error Report",
      "created_at": "2025-04-30T09:57:23Z",
      "url": "https://github.com/vercel/next.js/discussions/78701",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 78781,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `fa536cf2`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of directory_tree_to_loader_tree failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "Thanks for the report! This error usually happens when Turbopack determined your project\u2019s root directory based on a lockfile that exists further down the filesystem than where next is installed.\r\n\r\nFor example, something like this:\r\n\r\n```\r\nrepo/\r\n  package.json\r\n  package-lock.json\r\n  node_modules/next\r\n  apps/\r\n    my-app/\r\n      package.json\r\n      package-lock.json\r\n      app/\r\n        page.tsx\r\n```\r\n\r\nHere, Turbopack determined the root directory to be `my-app`, but Next.js is installed further up the tree.\r\n\r\nYou\u2019ll need to either:\r\n- Remove the lockfile inside `my-app` if possible, or\r\n- Set `turbopack.root` in to `next.config.js` to your repository\u2019s root directory (or wherever Next.js is installed), as described [here](https://nextjs.org/docs/app/api-reference/config/next-config-js/turbopack#root-directory)\r\n\r\nWe\u2019re working on a better way of communicating this problem, and exploring other approaches where the root directory can be better discovered automatically.",
      "category": "Turbopack Error Report",
      "created_at": "2025-05-02T17:49:21Z",
      "url": "https://github.com/vercel/next.js/discussions/78781",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 80770,
      "title": "Turbopack Error: Next.js package not found in turborepo",
      "question": "Turbopack version: `v15.4.0-canary.89-8-g4a4715e76`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of directory_tree_to_loader_tree failed\r\n- Execution of *FileSystemPath::join failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "This discussion appears to be a duplicate of #78192.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/78192\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-06-22T14:54:41Z",
      "url": "https://github.com/vercel/next.js/discussions/80770",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 80923,
      "title": "Turbopack Error: Next.js package not found",
      "question": "When I pull [this repository](https://github.com/FerretAngel/next-heroui-tailwind-i18n-template.git) to a menorepo will trigger the error in the project\r\n\r\n\r\n\r\nTurbopack version: `7961021f`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "I found the root cause! It was because the repository I pulled contained a pnpm-lock.yaml file, which conflicted with the local monorepo project's pnpm-lock.yaml. This caused the inability to find the correct packages. After I deleted the pnpm-lock.yaml file in the project and reinstalled the dependencies, it worked normally. Thank you very much for your help!\u2764",
      "category": "Turbopack Error Report",
      "created_at": "2025-06-26T03:23:22Z",
      "url": "https://github.com/vercel/next.js/discussions/80923",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 79364,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `3def5ff9`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of directory_tree_to_loader_tree failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "This discussion appears to be a duplicate of #78192.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/78192\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-05-19T10:49:58Z",
      "url": "https://github.com/vercel/next.js/discussions/79364",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 81409,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `d9ec4a4b`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "This discussion appears to be a duplicate of #78192.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/78192\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-07-08T11:59:51Z",
      "url": "https://github.com/vercel/next.js/discussions/81409",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 81349,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `dc48e551`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of directory_tree_to_loader_tree failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "This discussion appears to be a duplicate of #78192.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/78192\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-07-06T06:55:41Z",
      "url": "https://github.com/vercel/next.js/discussions/81349",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 81324,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `v15.3.2-8-g3ab8db738`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "This discussion appears to be a duplicate of #78192.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/78192\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-07-05T02:13:09Z",
      "url": "https://github.com/vercel/next.js/discussions/81324",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 81527,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `e678913a`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of directory_tree_to_loader_tree failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "This discussion appears to be a duplicate of #78192.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/78192\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-07-11T04:56:11Z",
      "url": "https://github.com/vercel/next.js/discussions/81527",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 81601,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `66c65600`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of directory_tree_to_loader_tree failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "This discussion appears to be a duplicate of #78192.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/78192\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-07-14T04:19:55Z",
      "url": "https://github.com/vercel/next.js/discussions/81601",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 81850,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `v15.4.1-1-g4b3f955c3`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```\r\n\r\nThese errors started occurring after upgrading to the latest version of Next.js and adding Sentry.",
      "answer": "Hey, I ran into the same issue recently.\r\n\r\nIn my case, it happened after upgrading Next.js and integrating Sentry.\r\nThe error Next.js package not found usually means Turbopack isn\u2019t able to detect the next dependency correctly. I noticed the debug output says Next.js version: 0.0.0, which means it\u2019s not resolving properly, probably due to a missing or broken link in node_modules.\r\n\r\nA few things that helped me:\r\n- I double-checked that next was properly listed in my package.json\r\n- Deleted node_modules, .turbo, and lockfile, then ran a clean install\r\n- Made sure Sentry wasn\u2019t interfering with the build\r\n\r\nHope that helps! Let me know if you\u2019re still stuck, happy to take a look at your setup.",
      "category": "Turbopack Error Report",
      "created_at": "2025-07-19T14:25:57Z",
      "url": "https://github.com/vercel/next.js/discussions/81850",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 81923,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `68a59d7a`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of directory_tree_to_loader_tree failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "This discussion appears to be a duplicate of #78192.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/78192\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-07-22T11:38:31Z",
      "url": "https://github.com/vercel/next.js/discussions/81923",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 82024,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `68a59d7a`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "Hey! This error usually means that Turbopack can\u2019t find the next package in your project. Here are some steps to fix it:\r\n\r\n- Check your package.json: Make sure you have \"next\" listed as a dependency.\r\n\r\n- Install dependencies: Run npm or yarn install (depending on your environment) in your project directory to make sure all packages (including Next.js) are actually installed.\r\n\r\n- Check node_modules: Look inside your node_modules folder there should be a next directory. If not, something went wrong with the install. (I think it is the dumb way but still you can try)\r\n\r\n- Correct project folder: Double-check that you\u2019re running Turbopack in the root folder of your Next.js project (where package.json is located).\r\n",
      "category": "Turbopack Error Report",
      "created_at": "2025-07-24T18:27:45Z",
      "url": "https://github.com/vercel/next.js/discussions/82024",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 82274,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `v15.4.3-4-g9bf932c0c`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of directory_tree_to_loader_tree failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "The error message \"Next.js package not found\" typically means that Turbopack can't locate the Next.js installation in your project.\r\n\r\nHere are some steps to help troubleshoot and resolve this issue:\r\n\r\n1. Check Next.js Installation\r\nMake sure Next.js is installed correctly in your project dependencies. You can verify this by running:\r\n\r\n```\r\nnpm ls next\r\n```\r\nor\r\n```\r\nyarn list next\r\n```\r\nIf Next.js is missing, add it with:\r\n\r\n```\r\nnpm install next\r\n```\r\nor\r\n```\r\nyarn add next\r\n```\r\n\r\n2. Verify package.json and Node Modules\r\n\r\nSometimes your node_modules folder or package-lock.json/yarn.lock can become corrupted. Try deleting node_modules and reinstalling:\r\n\r\n```\r\nrm -rf node_modules package-lock.json yarn.lock\r\nnpm install\r\n```\r\nor\r\n```\r\nrm -rf node_modules package-lock.json yarn.lock\r\nyarn install\r\n```\r\n\r\n3. Check Turbopack Version Compatibility\r\n\r\nEnsure your Turbopack version is compatible with your Next.js version. Using mismatched versions might cause resolution errors.\r\n\r\n4. Project Structure\r\n\r\nMake sure your project root is set correctly and you run Turbopack commands from the directory where package.json and next.config.js live.\r\n\r\n5. Clear Build Cache\r\n\r\nSometimes build caches cause issues. Clear .next folder and any caches and try again.\r\n\r\n\r\nIf these steps don't fix the issue, please provide:\r\n\r\n- Your Next.js version (npm list next or yarn list next)\r\n\r\n- Your Turbopack version\r\n\r\n- Your project structure (a screenshot or list of files)\r\n\r\n- The exact command you are running\r\n\r\nHope this helps! Let me know if you need further assistance.",
      "category": "Turbopack Error Report",
      "created_at": "2025-08-01T11:19:21Z",
      "url": "https://github.com/vercel/next.js/discussions/82274",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 82264,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `55a7568e`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of directory_tree_to_loader_tree failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "The error message \"Next.js package not found\" typically means that Turbopack can't locate the Next.js installation in your project.\r\n\r\nHere are some steps to help troubleshoot and resolve this issue:\r\n\r\n1. Check Next.js Installation\r\nMake sure Next.js is installed correctly in your project dependencies. You can verify this by running:\r\n\r\n```\r\nnpm ls next\r\n```\r\nor\r\n```\r\nyarn list next\r\n```\r\nIf Next.js is missing, add it with:\r\n\r\n```\r\nnpm install next\r\n```\r\nor\r\n```\r\nyarn add next\r\n```\r\n\r\n2. Verify package.json and Node Modules\r\n\r\nSometimes your node_modules folder or package-lock.json/yarn.lock can become corrupted. Try deleting node_modules and reinstalling:\r\n\r\n```\r\nrm -rf node_modules package-lock.json yarn.lock\r\nnpm install\r\n```\r\nor\r\n```\r\nrm -rf node_modules package-lock.json yarn.lock\r\nyarn install\r\n```\r\n\r\n3. Check Turbopack Version Compatibility\r\n\r\nEnsure your Turbopack version is compatible with your Next.js version. Using mismatched versions might cause resolution errors.\r\n\r\n4. Project Structure\r\n\r\nMake sure your project root is set correctly and you run Turbopack commands from the directory where package.json and next.config.js live.\r\n\r\n5. Clear Build Cache\r\n\r\nSometimes build caches cause issues. Clear .next folder and any caches and try again.\r\n\r\n\r\nIf these steps don't fix the issue, please provide:\r\n\r\n- Your Next.js version (npm list next or yarn list next)\r\n\r\n- Your Turbopack version\r\n\r\n- Your project structure (a screenshot or list of files)\r\n\r\n- The exact command you are running\r\n\r\nHope this helps! Let me know if you need further assistance.",
      "category": "Turbopack Error Report",
      "created_at": "2025-08-01T06:00:41Z",
      "url": "https://github.com/vercel/next.js/discussions/82264",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 82333,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `v15.4.3-4-g9bf932c0c`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "This discussion appears to be a duplicate of #78192.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/78192\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-08-04T13:36:45Z",
      "url": "https://github.com/vercel/next.js/discussions/82333",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 82402,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `v15.4.0-canary.129-16-g27a271bd6`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of subscribe_issues_and_diags_operation failed\r\n- Execution of endpoint_server_changed_operation failed\r\n- Execution of pick_endpoint failed\r\n- Execution of entrypoints_without_collectibles_operation failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of directory_tree_to_loader_tree failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "This discussion appears to be a duplicate of #78192.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/78192\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-08-06T10:39:42Z",
      "url": "https://github.com/vercel/next.js/discussions/82402",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 82358,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `v15.3.2`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of directory_tree_to_loader_tree failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "This discussion appears to be a duplicate of #78192.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/78192\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-08-05T09:32:52Z",
      "url": "https://github.com/vercel/next.js/discussions/82358",
      "has_official_answer": false
    },
    {
      "tech": "nodejs",
      "repo": "vercel/next.js",
      "discussion_number": 82413,
      "title": "Turbopack Error: Next.js package not found",
      "question": "Turbopack version: `v15.4.4-5-g55a7568e9`\r\nNext.js version: `0.0.0`\r\n\r\nError message:\r\n```\r\nNext.js package not found\r\n\r\nDebug info:\r\n- Execution of get_entrypoints_with_issues_operation failed\r\n- Execution of EntrypointsOperation::new failed\r\n- Execution of Project::entrypoints failed\r\n- Execution of AppProject::routes failed\r\n- Execution of directory_tree_to_entrypoints_internal failed\r\n- Execution of directory_tree_to_loader_tree failed\r\n- Execution of get_next_package failed\r\n- Next.js package not found\r\n```",
      "answer": "This discussion appears to be a duplicate of #78192.\n\nPlease follow the discussion there: https://github.com/vercel/next.js/discussions/78192\n\n---\n*This comment was added automatically by discussion consolidation tool. If you believe this is in error, feel free to re-open the discussion.*",
      "category": "Turbopack Error Report",
      "created_at": "2025-08-06T15:05:11Z",
      "url": "https://github.com/vercel/next.js/discussions/82413",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 8828,
      "title": "Var $request_id not allowed in action.proxy.responseHeaders",
      "question": "Hi there!\r\n\r\nI was wondering why the request_id variable isn't allowed as a response header ([here](https://github.com/nginx/kubernetes-ingress/blob/799f715488df7ee7d6265f54ecc2631efce189ea/pkg/apis/configuration/validation/virtualserver.go#L1104)) even though it is allowed in the nginx location directive.\r\n\r\nWe want to use the request_id var as a nonce for [strict-dynamic CSP source](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/script-src#strict-dynamic).\r\n\r\nI couldn't find any reason on why this might be an issue as long as nginx was built with openssl. Is there a reason for this? As a workaround we moved the responseHeader config to the location snippet which we usually try to avoid.\r\n\r\nThanks!",
      "answer": "Hi @privateVoit Thanks for the question.  I will speak with the team to determine if there is a valid reason not to allow request_id.  It is also worth raising a feature request issue asking for the functionality, so other contributors can add this change.",
      "category": "Q&A",
      "created_at": "2026-01-07T14:08:21Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/8828",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 8619,
      "title": "Issues after enabling proxy protocol with NLB and TLS termination",
      "question": "Hi,\r\n\r\nI'm migrating from the ingress-nginx controller and ran into an issue when enabling proxy protocol on the NLB via the annotation \"service.beta.kubernetes.io/aws-load-balancer-proxy-protocol: '*'\".  After doing so, all of the nodes went unhealthy.  By default, the healthcheck on the NLB that points to the /healthz page.  I'm not exactly sure why this endpoint isn't returning correctly with proxy protocol enabled but I found out (by comparing to my current setup) that if I switch the NLB to use TCP healthchecks against the traffic port it all works fine. \r\n\r\n      service.beta.kubernetes.io/aws-load-balancer-healthcheck-protocol: TCP\r\n      service.beta.kubernetes.io/aws-load-balancer-healthcheck-port: traffic-port\r\n\r\nI have not found anything regarding similar issues so I decided to make a post here for feedback or in case anyone else stumbles into this while migrating.  Maybe there is also a better way than what I've done!\r\nThanks!",
      "answer": "hey @f1yers, \r\n\r\nthanks for this, can you please let us the know the value of service.beta.kubernetes.io/aws-load-balancer-healthcheck-path in your service yaml?",
      "category": "General",
      "created_at": "2025-12-05T18:41:32Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/8619",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 2824,
      "title": "disable SSL chain completion in Nginx+ ingress",
      "question": "Issue:\r\n\r\nI saw k8s Nginx OSS ingress have an argument \u201c--enable-ssl-chain-completion\u201d, so is there have similar command argument in F5 Nginx + ingress? Or how can I disable it?\r\n\r\nThx",
      "answer": "The `ssl-chain-completion` feature is not available in F5 NGINX Ingress Controller.  If it is a feature you are looking for, please create a feature request issue.",
      "category": "Q&A",
      "created_at": "2022-07-07T03:25:05Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/2824",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 2246,
      "title": "how to configure external DNS with NGINX and AWS loadbalancer (nlb)",
      "question": "Hallo there, \r\nI have a problem configuring my nginx. Problem is following.\r\nWe have our DNS service that I can not change. let us see we have reserved the DNS  cloudservices.company.com.\r\nThis DNS will forwards all traffic to our aws NLB Loadbalancer through NGINX like following.\r\n\r\nNLB: example12348695758575.elb.region.amazonaws.com\r\n\r\nmy ingress-rules.yaml is like \r\n\r\n```\r\napiVersion: extensions/v1beta1\r\nkind: Ingress\r\nmetadata:\r\n  name: my-resources-name\r\n  namespace: my-apps\r\n  annotations:\r\n    kubernetes.io/ingress.class: \"nginx\"\r\nspec:\r\n  rules:\r\n  - host: example12348695758575.elb.region.amazonaws.com\r\n    http:\r\n      paths:\r\n        - path: /tee\r\n          backend:\r\n            serviceName: tee-service\r\n            servicePort: 8080\r\n        - path: /coffee\r\n          backend:\r\n            serviceName: coffee-service\r\n            servicePort: 8080\r\n```\r\n\r\nMy config.yaml currently looks like \r\n\r\n```\r\napiVersion: v1\r\nkind: ConfigMap\r\nmetadata:\r\n  labels:\r\n    helm.sh/chart: ingress-nginx-4.0.14\r\n    app.kubernetes.io/name: ingress-nginx\r\n    app.kubernetes.io/instance: ingress-nginx\r\n    app.kubernetes.io/version: 1.1.0\r\n    app.kubernetes.io/managed-by: Helm\r\n    app.kubernetes.io/component: controller\r\n  name: ingress-nginx-controller\r\n  namespace: ingress-nginx\r\ndata:\r\n```\r\n\r\nmy question is:\r\nwhen I call now the nlb direct, it works and I can see my services. But if I use the DNS then I got errors like \r\n\r\n```\r\napiVersion: v1\r\nkind: ConfigMap\r\nmetadata:\r\n  labels:\r\n    helm.sh/chart: ingress-nginx-4.0.14\r\n    app.kubernetes.io/name: ingress-nginx\r\n    app.kubernetes.io/instance: ingress-nginx\r\n    app.kubernetes.io/version: 1.1.0\r\n    app.kubernetes.io/managed-by: Helm\r\n    app.kubernetes.io/component: controller\r\n  name: ingress-nginx-controller\r\n  namespace: ingress-nginx\r\ndata:\r\nallow-snippet-annotations: 'true'\r\n  http-snippet: |\r\n    server {\r\n      listen 80;\r\n      server_name   cloudservices.company.com;\r\n     }\r\n  use-forwarded-headers: 'true'\r\n```\r\n\r\nI got the error\r\n\r\n```\r\nW1207 09:45:54.777377       8 controller.go:829] Error obtaining Endpoints for Service \"my-apps/ks-console\": no object matching key \"my-apps/ks-console\" in local store\r\n2021/12/07 09:45:55 [error] 13410#13410: *5998387 open() \"/usr/local/nginx/html/tee/getVersion\" failed (2: No such file or directory), client: 149.219.220.108, server: cloudservices.wdr.de, request: \"GET /tee/getVersion HTTP/1.1\", host: \"cloudservices.company.com\"\r\n149.219.220.108 - - [07/Dec/2021:09:45:55 +0000] \"GET /tee/getVersion HTTP/1.1\" 404 185 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36\" 855 0.000 [] [] - - - - 8c52b4b09ed44ce028f44fc30085dddd\r\n```\r\n\r\nwhat should I add to the config or how to reconfigure my nginx to forwards the traffic coming from our DNS to our NLB through NGINX.\r\n\r\n\r\n\r\n",
      "answer": "This appears to be related to the [community ingress](https://github.com/kubernetes/ingress-nginx) project.",
      "category": "Q&A",
      "created_at": "2021-12-07T09:34:16Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/2246",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 6047,
      "title": "Best way to enable / forward AppBased cert auth to backend",
      "question": "Hi,\r\n\r\ni'm struggeling with enabling auf Cert-Auth forward with nginx-ingress\r\n\r\nnormal forward operations are done.\r\nbut it seems, that nginx isn't passing the Cert-Auth to the Upstream-Backend...\r\n\r\ni've tried the following things over \"configmaps\"\r\n\r\ndata:\r\n  location-snippets: |\r\n    proxy_set_header X-SSL-CERT $ssl_client_escaped_cert;\r\n    proxy_set_header ssl-client-cert $ssl_client_escaped_cert;\r\n    proxy_set_header SSL_CLIENT_CERT $ssl_client_escaped_cert;\r\n    proxy_pass_request_headers  on;\r\n\r\nbut i can't see @Backend-Site the headers if i add a \"Test-Header\"\r\n    proxy_set_header TestHeader \"Test-Header\";\r\n\r\nit is properly passed to the backend...\r\nAlso customized headers injected from the client\r\n\r\nmaybe i'm in the woods... and i can't see the solution... but maybe some one else had already this pain / issue\r\n\r\n\r\nThank you \r\n\r\n",
      "answer": "The way to pass TLS authentication to the backend application is to make use of the TLS passthrough feature.\r\nSee\r\n- https://docs.nginx.com/nginx-ingress-controller/configuration/transportserver-resource/\r\n- https://docs.nginx.com/nginx-ingress-controller/configuration/global-configuration/command-line-arguments/#-enable-tls-passthrough\r\n- https://github.com/nginx/kubernetes-ingress/blob/main/examples/custom-resources/tls-passthrough/README.md",
      "category": "Q&A",
      "created_at": "2024-07-23T11:27:26Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/6047",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 6041,
      "title": "Authentication interceptor no longer works after nginx upgrade 1.8.1 -> 1.9.0",
      "question": "After upgradation of ingress-controller from 1.8.1 -> 1.9.0, interceptor is not working for some of the API's. We verified that nginx is successfully deployed in the kubernetes cluster. We have done some minor changes to nginx.tmpl configuration file:\r\nHttpAccessLogPath: variable renamed to HTTPAccessLogPath\r\nlocation.Whitelist: variable renamed to location.Allowlist and location.Denylist\r\nEnableRealIp: variable renamed to EnableRealIPafter deployment\r\n\r\nCommunity please help us to get this issue resolve",
      "answer": "This appears to be related to the [community ingress](https://github.com/kubernetes/ingress-nginx) project.",
      "category": "Q&A",
      "created_at": "2024-07-19T06:13:54Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/6041",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 3145,
      "title": "VirtualServer + Cert-manager with enabled mtls",
      "question": "Hello, \r\n\r\nI think , this topic has not been described before \r\n\r\nI've configured VritualServer with CertManager to use Let's encrypt certificates, everything works fine. \r\n\r\nOn top of this configuration, I would like to enable mTLS configuration with the self-signed certificate also issued by cert-manager.\r\n\r\nCert-manager has created the secret with the name **certsecret**, but it can not be used in the Nginx Ingress Policy object, because **certsecret** has type \"kubernetes.io/tls\", whereas Nginx Ingress requires the type \"nginx.org/ca\"\r\n\r\nWhat would be a workaround here?\r\n\r\nMy Policy object:\r\n\r\n```\r\napiVersion: k8s.nginx.org/v1\r\nkind: Policy\r\nmetadata:\r\n  name: ingress-mtls-policy\r\nspec:\r\n  ingressMTLS:\r\n    clientCertSecret: certsecret\r\n    verifyClient: \"on\"\r\n    verifyDepth: 1\r\n```\r\n\r\n\r\nKind regards, \r\nAlexander. ",
      "answer": "The use case is the following.\r\n\r\nServer Side TLS certificates are issued by some trusted CA, in my case it is Let's encrypt. \r\n\r\nBut additionally, the client shall user client TLS certificate , issued by private CA and managed by cert-manager, this client TLS certificate is passed then to the backend service behind ingress controller. \r\n\r\nCurrently, I'm able to set up such configuration only in the following way : \r\n\r\nNginx Ingress Transport Server with TLS pass-through  -> Nginx Web Server deployment \r\n\r\nNginx Web server has the following configuration then: \r\n\r\n```\r\n        ssl_certificate conf.d/certs/letsencrypt-certificates/tls.crt;\r\n        ssl_certificate_key conf.d/certs/letsencrypt-certificates/tls.key;\r\n        ssl_client_certificate conf.d/certs/privateca/ca.crt;\r\n```\r\nIn my example **letsencrypt-certificates/tls.crt;** and **letsencrypt-certificates/tls.key;** are taken from the ConfigMap, created by Cert-Manager, these certificates are issued by Let's encrypt.\r\n\r\n**ca.crt**  is the private self-signed CA, also issued by different Cert-Manager self-signed issuer. It is used to verify client certificates. \r\n\r\nThen, I use the following proxy-pass rule in Nginx deployment:\r\n\r\n```\r\n        location /api/ {\r\n\r\n                proxy_pass http://backendservice:8000/;\r\n                proxy_set_header Host $host;\r\n                proxy_set_header X-SSL-Certificate $ssl_client_escaped_cert;\r\n        }\r\n```\r\n\r\n\r\nSince Nginx Ingress now supports cert-manager, it would be great to configure CA from the cert-manager to verify client certificates, and then there is no need to use Nginx deployment behind ingress anymore. \r\n\r\n",
      "category": "General",
      "created_at": "2022-10-13T11:06:02Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/3145",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 8075,
      "title": "More robust handling of Ingress configuration issues",
      "question": "It sometimes happens that someone makes a mistake in the Ingress resource configuration which results in a critical error on the Nginx server (typical example is duplicate path which leads to `duplicate location \\\"/somepath\\\" in /etc/nginx/conf.d/namespace-ingress.conf:261\\n\"`) - e.g. the Nginx would refuse to reload the configuration at runtime or fail to start.\r\n\r\nWhen this happens in larger environments used by multiple teams, it can be quite annoying as one team affects another one - the Nginx would effectively stop reloading all the configuration and one has to find out why and fix that (which can be a little complicated with multiple teams involved).\r\n\r\nIs it possible to make things more robust - for example to either improve the resource validation (and reject these faulty Ingress resources), or by making the Nginx ignore (skip) incorrect conigurations (whole *.conf files generated for each Ingress resource) and just produce error messages for them (thich would break things only for the team that introduced the issue)?",
      "answer": "hey @hostalp, we've an issue around this https://github.com/nginx/kubernetes-ingress/issues/7379, can you please add your comments there if you like\r\n",
      "category": "Q&A",
      "created_at": "2025-07-24T13:23:14Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/8075",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 8023,
      "title": "nginx-ingress controller upgrades - aws load balancer detached issues",
      "question": "I upgraded the Ingress Controller from version `v4.12.0 to v4.12.4` using the Helm chart with a rolling update strategy. All the Ingress Controller pods came up successfully without any errors.\r\n\r\nHowever, after the upgrade completed, I noticed that other Ingress services (attached to the AWS Load Balancer) were detached and then reattached after around 40 seconds.\r\n\r\n**What could be the reason for this behavior?\r\nIs there any way to prevent this and ensure zero downtime for traffic during the upgrade?**",
      "answer": "hey @suranga-jayalath, i think you might be using a different project https://github.com/kubernetes/ingress-nginx/releases which is k8s community ingress controller not this one ",
      "category": "Q&A",
      "created_at": "2025-07-15T12:37:43Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/8023",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 7880,
      "title": "Exposed metrics from the controller",
      "question": "Hello,\r\n\r\nI need your help to understand the available metrics from prometheus https://docs.nginx.com/nginx-ingress-controller/logging-and-monitoring/prometheus/ \r\n\r\nThe metrics available now is limited and not including https://docs.nginx.com/nginx-ingress-controller/logging-and-monitoring/service-insight/ which is mainly coming with Nginx Plus. \r\n\r\nAs we migrated from the community ingress-nginx controller, all metrics were exposed by default which is confusing me, how this could happen if nginx opensource itslef is not exposing this metrics ? was there any new release over past months that moved some of the metrics support to nginx plus ? so mainly the new version of nginx will not expose the service insights metrics ?\r\n\r\nThanks a lot in advance",
      "answer": "@sov-msaeed metrics in NIC are different form community Ingress controller and https://docs.nginx.com/nginx-ingress-controller/logging-and-monitoring/service-insight/ has always been a Nginx Plus specific feature. Are you using Nginx OSS or Nginx Plus with NIC?",
      "category": "General",
      "created_at": "2025-06-11T14:38:13Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/7880",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 7823,
      "title": "Daemonset Send TCP FIN before Node Stopps",
      "question": "We are currently using nginx as a deployment. In front of our ingress controller we have a F5 Big IP AWAF Instance which is doing the \"Loadbalancing\". Due to the current implementation there is no real Loadbalancing since 1 Backend and ServiceType Loadbalancer in the cluster. We want to swtich to NodePort version of the service. So we can configure on Big IP a backend pool with all our nodes included. This being said and tested works. Due to lifecycle and troubleshooting reason we are often required to recreate a node (delete and readd one) or restart a node. For this we do the normal drain and then shutdown the node.\r\n\r\nIn case of the NodePort and NGINX deployed as DaemonSet all still open TCP Session to the node which is powered off are stale and waiting for their Timeout TCP FIN Request. This can cause outages which are ~ 1min. I want to prevent this. Do you have any recommandation for the setup how this can be achieved. I'm pretty sure I'm not the only one struggling with this\r\n\r\n\r\n```\r\n+-----------------------+\r\n|       Client          |\r\n|  (HTTP Requests   |\r\n+-----------------------+\r\n           |\r\n           v\r\n+-----------------------+\r\n|   BIG IP F5       |\r\n+-----------------------+\r\n   |               |\r\n   v               v\r\n+---------+   +----------+\r\n| Node 1  |   | Node 2   |\r\n| (dies)  |   | (healthy)|\r\n| No FIN  |   |          |\r\n+---------+   +----------+\r\n```\r\n",
      "answer": "Hi @sass1997 Please open a support request on F5 portal to have your query redirected to the appropriate team.",
      "category": "Q&A",
      "created_at": "2025-05-21T16:00:47Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/7823",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 7684,
      "title": "OOM killed because of rollout restart",
      "question": "Hi all,\r\nEvery time we perform a rollout restart of our Ingress controller (currently on version 1.11.5), we observe 4\u20135 times of OOMKilled events before it stabilises. After these initial failures, the controller eventually runs without issues.",
      "answer": "Hi @karantyagi-cashfree, I'm afraid we didn't have the release 1.11.5. Can you confirm that you are indeed deploying NGINX Ingress Controller. If you are using the community ingress controller, please refer to https://github.com/kubernetes/ingress-nginx for more information. ",
      "category": "Q&A",
      "created_at": "2025-04-21T07:24:06Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/7684",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 7524,
      "title": "Should controller.debug be included in values.yaml to prevent Helm failures?",
      "question": "I noticed that the nginx-ingress Helm chart references .Values.controller.debug.enable in _helpers.tpl, but controller.debug is not defined in values.yaml. This leads to a nil pointer evaluating interface {}.enable error unless users explicitly define controller.debug.",
      "answer": "@abbas916990 this flag is only for live debugging purposes during development, you can read more about it [here](https://github.com/nginx/kubernetes-ingress/blob/main/site/developer/debugging.md#helm-configuration-options). You don't need this flag enabled in prod environment.\r\n```\r\ncontroller:\r\n    debug:\r\n        enable:false\r\n```\r\nis the correct value",
      "category": "General",
      "created_at": "2025-03-18T05:56:24Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/7524",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 7206,
      "title": "Add NGINX ingress to instance manager",
      "question": "hey guys,\r\n\r\nWe have ingress controller running inside K8s, we recently stood up instance manager outside and want to connect ingress controller to it. Looking at the args I have added \"-agent=true\" and can scan the instance from instance manager, it comes up unmanaged of course. The instructions from instance manager tell me to download the docker image then run it with \r\n\r\n--env=NMS_SERVER_GRPCPORT=443\\\r\n--env=NMS_SERVER_HOST=https://10.154.8.55 \r\n--env=NMS_TLS_ENABLE=true\\\r\n\r\nHow do I go about this from within K8s? Can someone point me in the place of docs for it. I'd assume there would be NMS args but I dont see them in the command line args:\r\nhttps://docs.nginx.com/nginx-ingress-controller/configuration/global-configuration/command-line-arguments/\r\n\r\nnor do I see them in the config map keys:\r\nhttps://docs.nginx.com/nginx-ingress-controller/configuration/global-configuration/configmap-resource/#summary-of-configmap-keys\r\n\r\nCan you help me out?",
      "answer": "Hi @amayacitta, at this moment NIC only supports security monitoring with NIM via agent so NAP-WAF is required. hope this helps!\r\nhttps://docs.nginx.com/nginx-ingress-controller/tutorials/security-monitoring/",
      "category": "Q&A",
      "created_at": "2025-01-23T20:00:19Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/7206",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 3716,
      "title": "Blankscreen / Service won't load",
      "question": "[Creating new post because the post I found is relatively dated]\r\n\r\nI'm currently using Cloudflare Tunnel for secure connections with my domain(s) but the Nginx Controller doesn't like the SSL certificate. Now I am as far that I'm getting a blank page most likely because Nginx is unable to check the certificate. (With the Cloudflare ingress it does work so it isn't Cloudflared - switched to Nginx because Cloudflare ingress's `/paths` don't work (well)\r\n\r\nAlthough I rather have a certificate, I just found [this](https://github.com/nginxinc/kubernetes-ingress/issues/925#issuecomment-616377783) post with a potential solution, but I can't seem to find the way to configure it. Does someone know how to solve this? Is that solution even still compatible with the last released chart, `nginx-ingress-0.17.0`?\r\n\r\nThis is the output of svc:\r\n```\r\nNAME                  TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE\r\nkuard                 ClusterIP   10.97.18.82      <none>        80/TCP    70m\r\nkubernetes            ClusterIP   10.96.0.1        <none>        443/TCP   27h\r\nkubernetes-bootcamp   ClusterIP   10.107.5.7       <none>        80/TCP    12h\r\nweb-service           ClusterIP   10.104.129.217   <none>        80/TCP    14h\r\n```\r\n\r\nThis is the output of deploy:\r\n```\r\nNAME                  READY   UP-TO-DATE   AVAILABLE   AGE\r\ncloudflared           2/2     2            2           53m\r\nhttpbin-deployment    2/2     2            2           14h\r\nkuard                 1/1     1            1           71m\r\nkubernetes-bootcamp   1/1     1            1           12h\r\n```\r\n\r\nThis is my current ingress:\r\n```\r\napiVersion: networking.k8s.io/v1\r\nkind: Ingress\r\nmetadata:\r\n  name: pi-ingress\r\n  annotations:\r\n    #kubernetes.io/ingress.class: nginx\r\n    #nginx.org/ssl-passthrough: \"true\"\r\n    #nginx.org/backend-protocol: \"HTTPS\"\r\n    #nginx.org/rewrite-target: /\r\n    nginx.org/server-snippets: |\r\n      proxy_ssl_verify off;\r\nspec:\r\n  ingressClassName: nginx\r\n  #tls:\r\n  #- hosts:\r\n  #  - projectsincluded.net\r\n  #  secretName: pi-secret\r\n  rules:\r\n  - host: projectsincluded.net\r\n    http:\r\n      paths:\r\n      - path: /\r\n        pathType: Prefix\r\n        backend:\r\n          service:\r\n            name: web-service\r\n            port:\r\n              number: 80\r\n      - path: /test\r\n        pathType: Prefix\r\n        backend:\r\n          service:\r\n            name: kubernetes-bootcamp\r\n            port:\r\n              number: 80\r\n```",
      "answer": "Hi @RFlintstone We will need a bit more info first\r\nCan you provide:\r\n1. The outputs of the components deployed on your cluster? This would include your Ingresses, Deployments, Replicasets, Services, etc... This will better help us see the full picture of how everything is currently configured.\r\n2. Can you confirm that your deployment of the Ingress Controller is using the `-enable-snippets` flag.\r\n3. Can you provide the output of the NGINX configuration. This can done using `kubectl exec -it -n <nginx-ingress-namespace> <nginx-ingress-pod> -- nginx -T`\r\n\r\nThe main thing we are looking for here is that the `proxy_ssl_verify off;` has been set correctly.\r\n",
      "category": "Q&A",
      "created_at": "2023-04-02T23:20:52Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/3716",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 4495,
      "title": "Adding nginx-prometheus-exporter as a sidecar in nginx-ingress helm chart.",
      "question": "Hi! i'm using the NGINX Ingress Controller helm chart v0.18.0 in GKE and trying to add a sidecar the nginx-prometheus-exporter v0.11.0 but the that container fail.\r\n\r\n```\r\nnginxStatus:\r\n    ## Enable the NGINX stub_status, or the NGINX Plus API.\r\n    enable: true\r\n\r\n    ## Set the port where the NGINX stub_status or the NGINX Plus API is exposed.\r\n    port: 8080\r\n\r\n    ## Add IPv4 IP/CIDR blocks to the allow list for NGINX stub_status or the NGINX Plus API. Separate multiple IP/CIDR by commas.\r\n    allowCidrs: \"127.0.0.1,::1\"\r\n\r\nprometheus:\r\n  ## Expose NGINX or NGINX Plus metrics in the Prometheus format.\r\n  create: true\r\n\r\n  ## Configures the port to scrape the metrics.\r\n  port: 9113\r\n\r\n  ## Specifies the namespace/name of a Kubernetes TLS Secret which will be used to protect the Prometheus endpoint.\r\n  secret: \"\"\r\n\r\n  ## Configures the HTTP scheme used.\r\n  scheme: http\r\n\r\nextraContainers:\r\n  - name: nginx-exporter\r\n    image: nginx/nginx-prometheus-exporter:0.11.0\r\n    args:\r\n      - '-nginx.scrape-uri=http://nginx-gke-argocd-stg-nginx-ingress-controller:9113/metrics'\r\n    resources:\r\n      limits:\r\n        memory: 128Mi\r\n        cpu: 500m\r\n    ports:\r\n      - containerPort: 9113\r\n\r\n\r\nkubectl get svc -n nginx-ingress\r\nNAME                                            TYPE           CLUSTER-IP     EXTERNAL-IP    PORT(S)                      AGE\r\nnginx-gke-argocd-stg-nginx-ingress-controller   LoadBalancer   10.215.1.108   34.86.221.10   80:32348/TCP,443:31387/TCP   4h44m\r\n```\r\n\r\nIn the args i configured the svc of the nginx-ingress deploy and in the first place the :8080/stub_status and 9113/metrics but nothing works.\r\n\r\nHow can I make the exporter work? Thanks a lot for your help!!",
      "answer": "Hi! @brianehlert yes! i have uncommented tha principals values. I share my values.yaml\r\n\r\n```\r\ncontroller:\r\n  ## The name of the Ingress Controller daemonset or deployment.\r\n  name: controller\r\n\r\n  ## The kind of the Ingress Controller installation - deployment or daemonset.\r\n  kind: deployment\r\n\r\n  ## Annotations for deployments and daemonsets\r\n  annotations: {}\r\n\r\n  ## Deploys the Ingress Controller for NGINX Plus.\r\n  nginxplus: false\r\n\r\n  # Timeout in milliseconds which the Ingress Controller will wait for a successful NGINX reload after a change or at the initial start.\r\n  nginxReloadTimeout: 60000\r\n\r\n  ## Support for App Protect WAF\r\n  appprotect:\r\n    ## Enable the App Protect WAF module in the Ingress Controller.\r\n    enable: false\r\n    ## Sets log level for App Protect WAF. Allowed values: fatal, error, warn, info, debug, trace\r\n    # logLevel: fatal\r\n\r\n  ## Support for App Protect DoS\r\n  appprotectdos:\r\n    ## Enable the App Protect DoS module in the Ingress Controller.\r\n    enable: false\r\n    ## Enable debugging for App Protect DoS.\r\n    debug: false\r\n    ## Max number of nginx processes to support.\r\n    maxWorkers: 0\r\n    ## Max number of ADMD instances.\r\n    maxDaemons: 0\r\n    ## RAM memory size to consume in MB.\r\n    memory: 0\r\n\r\n  ## Enables the Ingress Controller pods to use the host's network namespace.\r\n  hostNetwork: false\r\n\r\n  ## DNS policy for the Ingress Controller pods\r\n  dnsPolicy: ClusterFirst\r\n\r\n  ## Enables debugging for NGINX. Uses the nginx-debug binary. Requires error-log-level: debug in the ConfigMap via `controller.config.entries`.\r\n  nginxDebug: false\r\n\r\n  ## The log level of the Ingress Controller.\r\n  logLevel: 1\r\n\r\n  ## A list of custom ports to expose on the NGINX Ingress Controller pod. Follows the conventional Kubernetes yaml syntax for container ports.\r\n  customPorts: []\r\n\r\n  image:\r\n    ## The image repository of the Ingress Controller.\r\n    repository: nginx/nginx-ingress\r\n\r\n    ## The tag of the Ingress Controller image. If not specified the appVersion from Chart.yaml is used as a tag.\r\n    tag: \"3.2.0\"\r\n\r\n    ## The digest of the Ingress Controller image.\r\n    ## If digest is specified it has precedence over tag and will be used instead\r\n    # digest: \"sha256:CHANGEME\"\r\n\r\n    ## The pull policy for the Ingress Controller image.\r\n    pullPolicy: IfNotPresent\r\n\r\n  ## The lifecycle of the Ingress Controller pods.\r\n  lifecycle: {}\r\n\r\n  ## The custom ConfigMap to use instead of the one provided by default\r\n  customConfigMap: \"\"\r\n\r\n  config:\r\n    ## The name of the ConfigMap used by the Ingress Controller.\r\n    ## Autogenerated if not set or set to \"\".\r\n    # name: nginx-config\r\n\r\n    ## The annotations of the Ingress Controller configmap.\r\n    annotations: {}\r\n\r\n    ## The entries of the ConfigMap for customizing NGINX configuration.\r\n    entries: {}\r\n\r\n  ## It is recommended to use your own TLS certificates and keys\r\n  defaultTLS:\r\n    ## The base64-encoded TLS certificate for the default HTTPS server. By default, a pre-generated self-signed certificate is used.\r\n    ## Note: It is recommended that you specify your own certificate. Alternatively, omitting the default server secret completely will configure NGINX to reject TLS connections to the default server.\r\n    cert: \"\"\r\n\r\n    ## The base64-encoded TLS key for the default HTTPS server. By default, a pre-generated key is used.\r\n    ## Note: It is recommended that you specify your own key. Alternatively, omitting the default server secret completely will configure NGINX to reject TLS connections to the default server.\r\n    key: \"\"\r\n\r\n    ## The secret with a TLS certificate and key for the default HTTPS server.\r\n    ## The value must follow the following format: `<namespace>/<name>`.\r\n    ## Used as an alternative to specifying a certificate and key using `controller.defaultTLS.cert` and `controller.defaultTLS.key` parameters.\r\n    ## Note: Alternatively, omitting the default server secret completely will configure NGINX to reject TLS connections to the default server.\r\n    ## Format: <namespace>/<secret_name>\r\n    secret: \"\"\r\n\r\n  wildcardTLS:\r\n    ## The base64-encoded TLS certificate for every Ingress/VirtualServer host that has TLS enabled but no secret specified.\r\n    ## If the parameter is not set, for such Ingress/VirtualServer hosts NGINX will break any attempt to establish a TLS connection.\r\n    cert: \"\"\r\n\r\n    ## The base64-encoded TLS key for every Ingress/VirtualServer host that has TLS enabled but no secret specified.\r\n    ## If the parameter is not set, for such Ingress/VirtualServer hosts NGINX will break any attempt to establish a TLS connection.\r\n    key: \"\"\r\n\r\n    ## The secret with a TLS certificate and key for every Ingress/VirtualServer host that has TLS enabled but no secret specified.\r\n    ## The value must follow the following format: `<namespace>/<name>`.\r\n    ## Used as an alternative to specifying a certificate and key using `controller.wildcardTLS.cert` and `controller.wildcardTLS.key` parameters.\r\n    ## Format: <namespace>/<secret_name>\r\n    secret: \"\"\r\n\r\n  ## The node selector for pod assignment for the Ingress Controller pods.\r\n  # nodeSelector: {}\r\n\r\n  ## The termination grace period of the Ingress Controller pod.\r\n  terminationGracePeriodSeconds: 30\r\n\r\n  ## HorizontalPodAutoscaling (HPA)\r\n  autoscaling:\r\n    ## Enables HorizontalPodAutoscaling.\r\n    enabled: false\r\n    ## The annotations of the Ingress Controller HorizontalPodAutoscaler.\r\n    annotations: {}\r\n    ## Minimum number of replicas for the HPA.\r\n    minReplicas: 1\r\n    ## Maximum number of replicas for the HPA.\r\n    maxReplicas: 3\r\n    ## The target cpu utilization percentage.\r\n    targetCPUUtilizationPercentage: 50\r\n    ## The target memory utilization percentage.\r\n    targetMemoryUtilizationPercentage: 50\r\n\r\n  ## The resources of the Ingress Controller pods.\r\n  resources:\r\n    requests:\r\n      cpu: 100m\r\n      memory: 128Mi\r\n  # limits:\r\n  #   cpu: 1\r\n  #   memory: 1Gi\r\n\r\n  ## The tolerations of the Ingress Controller pods.\r\n  tolerations: []\r\n\r\n  ## The affinity of the Ingress Controller pods.\r\n  affinity: {}\r\n\r\n  ## The topology spread constraints of the Ingress controller pods.\r\n  # topologySpreadConstraints: {}\r\n\r\n  ## The additional environment variables to be set on the Ingress Controller pods.\r\n  env: []\r\n  # - name: MY_VAR\r\n  #   value: myvalue\r\n\r\n  ## The volumes of the Ingress Controller pods.\r\n  volumes: []\r\n  # - name: extra-conf\r\n  #   configMap:\r\n  #     name: extra-conf\r\n\r\n  ## The volumeMounts of the Ingress Controller pods.\r\n  volumeMounts: []\r\n  # - name: extra-conf\r\n  #   mountPath: /etc/nginx/conf.d/extra.conf\r\n  #   subPath: extra.conf\r\n\r\n  ## InitContainers for the Ingress Controller pods.\r\n  initContainers: []\r\n  # - name: init-container\r\n  #   image: busybox:1.34\r\n  #   command: ['sh', '-c', 'echo this is initial setup!']\r\n\r\n  ## The minimum number of seconds for which a newly created Pod should be ready without any of its containers crashing, for it to be considered available.\r\n  minReadySeconds: 0\r\n\r\n  ## Pod disruption budget for the Ingress Controller pods.\r\n  podDisruptionBudget:\r\n    ## Enables PodDisruptionBudget.\r\n    enabled: false\r\n    ## The annotations of the Ingress Controller pod disruption budget.\r\n    annotations: {}\r\n    ## The number of Ingress Controller pods that should be available. This is a mutually exclusive setting with \"maxUnavailable\".\r\n    # minAvailable: 1\r\n    ## The number of Ingress Controller pods that can be unavailable. This is a mutually exclusive setting with \"minAvailable\".\r\n    # maxUnavailable: 1\r\n\r\n    ## Strategy used to replace old Pods by new ones. .spec.strategy.type can be \"Recreate\" or \"RollingUpdate\" for Deployments, and \"OnDelete\" or \"RollingUpdate\" for Daemonsets. \"RollingUpdate\" is the default value.\r\n  strategy: {}\r\n\r\n  ## Extra containers for the Ingress Controller pods.\r\n  extraContainers: []\r\n  # - name: container\r\n  #   image: busybox:1.34\r\n  #   command: ['sh', '-c', 'echo this is a sidecar!']\r\n\r\n  # extraContainers:\r\n  # - name: nginx-exporter\r\n  #   image: nginx/nginx-prometheus-exporter:0.11.0\r\n  #   args:\r\n  #     - '-nginx.scrape-uri=http://nginx-gke-argocd-stg-nginx-ingress-controller:8080/stub_status'\r\n  #   resources:\r\n  #     limits:\r\n  #       memory: 128Mi\r\n  #       cpu: 500m\r\n  #   ports:\r\n  #     - containerPort: 9113\r\n  \r\n  ## The number of replicas of the Ingress Controller deployment.\r\n  replicaCount: 1\r\n\r\n  ## A class of the Ingress Controller.\r\n\r\n  ## IngressClass resource with the name equal to the class must be deployed. Otherwise,\r\n  ## the Ingress Controller will fail to start.\r\n  ## The Ingress Controller only processes resources that belong to its class - i.e. have the \"ingressClassName\" field resource equal to the class.\r\n\r\n  ## The Ingress Controller processes all the resources that do not have the \"ingressClassName\" field for all versions of kubernetes.\r\n  ingressClass: nginx\r\n\r\n  ## New Ingresses without an ingressClassName field specified will be assigned the class specified in `controller.ingressClass`.\r\n  setAsDefaultIngress: false\r\n\r\n  ## Comma separated list of namespaces to watch for Ingress resources. By default the Ingress Controller watches all namespaces. Mutually exclusive with \"controller.watchNamespaceLabel\".\r\n  watchNamespace: \"\"\r\n\r\n  ## Configures the Ingress Controller to watch only those namespaces with label foo=bar. By default the Ingress Controller watches all namespaces. Mutually exclusive with \"controller.watchNamespace\".\r\n  watchNamespaceLabel: \"\"\r\n\r\n  ## Comma separated list of namespaces to watch for Secret resources. By default the Ingress Controller watches all namespaces.\r\n  watchSecretNamespace: \"\"\r\n\r\n  ## Enable the custom resources.\r\n  enableCustomResources: true\r\n\r\n  ## Enable preview policies. This parameter is deprecated. To enable OIDC Policies please use controller.enableOIDC instead.\r\n  enablePreviewPolicies: false\r\n\r\n  ## Enable OIDC policies.\r\n  enableOIDC: false\r\n\r\n  ## Include year in log header. This parameter will be removed in release 2.7 and the year will be included by default.\r\n  includeYear: false\r\n\r\n  ## Enable TLS Passthrough on port 443. Requires controller.enableCustomResources.\r\n  enableTLSPassthrough: false\r\n\r\n  ## Enable cert manager for Virtual Server resources. Requires controller.enableCustomResources.\r\n  enableCertManager: false\r\n\r\n  ## Enable external DNS for Virtual Server resources. Requires controller.enableCustomResources.\r\n  enableExternalDNS: false\r\n\r\n  globalConfiguration:\r\n    ## Creates the GlobalConfiguration custom resource. Requires controller.enableCustomResources.\r\n    create: false\r\n\r\n    ## The spec of the GlobalConfiguration for defining the global configuration parameters of the Ingress Controller.\r\n    spec: {}\r\n      # listeners:\r\n      # - name: dns-udp\r\n      #   port: 5353\r\n      #   protocol: UDP\r\n      # - name: dns-tcp\r\n      #   port: 5353\r\n      #   protocol: TCP\r\n\r\n  ## Enable custom NGINX configuration snippets in Ingress, VirtualServer, VirtualServerRoute and TransportServer resources.\r\n  enableSnippets: false\r\n\r\n  ## Add a location based on the value of health-status-uri to the default server. The location responds with the 200 status code for any request.\r\n  ## Useful for external health-checking of the Ingress Controller.\r\n  healthStatus: true\r\n\r\n  ## Sets the URI of health status location in the default server. Requires controller.healthStatus.\r\n  healthStatusURI: \"/nginx-health\"\r\n\r\n  nginxStatus:\r\n    ## Enable the NGINX stub_status, or the NGINX Plus API.\r\n    enable: true\r\n\r\n    ## Set the port where the NGINX stub_status or the NGINX Plus API is exposed.\r\n    port: 8080\r\n\r\n    ## Add IPv4 IP/CIDR blocks to the allow list for NGINX stub_status or the NGINX Plus API. Separate multiple IP/CIDR by commas.\r\n    allowCidrs: \"127.0.0.1\"\r\n\r\n  service:\r\n    ## Creates a service to expose the Ingress Controller pods.\r\n    create: true\r\n\r\n    ## The type of service to create for the Ingress Controller.\r\n    type: LoadBalancer\r\n\r\n    ## The externalTrafficPolicy of the service. The value Local preserves the client source IP.\r\n    externalTrafficPolicy: Local\r\n\r\n    ## The annotations of the Ingress Controller service.\r\n    annotations: {}\r\n\r\n    ## The extra labels of the service.\r\n    extraLabels: {}\r\n\r\n    ## The static IP address for the load balancer. Requires controller.service.type set to LoadBalancer. The cloud provider must support this feature.\r\n    loadBalancerIP: \"\"\r\n\r\n    ## The list of external IPs for the Ingress Controller service.\r\n    externalIPs: []\r\n\r\n    ## The IP ranges (CIDR) that are allowed to access the load balancer. Requires controller.service.type set to LoadBalancer. The cloud provider must support this feature.\r\n    loadBalancerSourceRanges: []\r\n\r\n    ## Whether to automatically allocate NodePorts (only for LoadBalancers).\r\n    # allocateLoadBalancerNodePorts: false\r\n\r\n    ## Dual stack preference.\r\n    ## Valid values: SingleStack, PreferDualStack, RequireDualStack\r\n    # ipFamilyPolicy: SingleStack\r\n\r\n    ## List of IP families assigned to this service.\r\n    ## Valid values: IPv4, IPv6\r\n    # ipFamilies:\r\n    #   - IPv6\r\n\r\n    httpPort:\r\n      ## Enables the HTTP port for the Ingress Controller service.\r\n      enable: true\r\n\r\n      ## The HTTP port of the Ingress Controller service.\r\n      port: 80\r\n\r\n      ## The custom NodePort for the HTTP port. Requires controller.service.type set to NodePort.\r\n      # nodePort: 80\r\n\r\n      ## The HTTP port on the POD where the Ingress Controller service is running.\r\n      targetPort: 80\r\n\r\n    httpsPort:\r\n      ## Enables the HTTPS port for the Ingress Controller service.\r\n      enable: true\r\n\r\n      ## The HTTPS port of the Ingress Controller service.\r\n      port: 443\r\n\r\n      ## The custom NodePort for the HTTPS port. Requires controller.service.type set to NodePort.\r\n      # nodePort: 443\r\n\r\n      ## The HTTPS port on the POD where the Ingress Controller service is running.\r\n      targetPort: 443\r\n\r\n    ## A list of custom ports to expose through the Ingress Controller service. Follows the conventional Kubernetes yaml syntax for service ports.\r\n    customPorts: []\r\n\r\n  serviceAccount:\r\n    ## The annotations of the service account of the Ingress Controller pods.\r\n    annotations: {}\r\n\r\n    ## The name of the service account of the Ingress Controller pods. Used for RBAC.\r\n    ## Autogenerated if not set or set to \"\".\r\n    # name: nginx-ingress\r\n\r\n    ## The name of the secret containing docker registry credentials.\r\n    ## Secret must exist in the same namespace as the helm release.\r\n    imagePullSecretName: \"\"\r\n\r\n  serviceMonitor:\r\n    ## Creates a serviceMonitor to expose statistics on the kubernetes pods.\r\n    create: false\r\n\r\n    ## Kubernetes object labels to attach to the serviceMonitor object.\r\n    labels: {}\r\n\r\n    ## A set of labels to allow the selection of endpoints for the ServiceMonitor.\r\n    selectorMatchLabels: {}\r\n\r\n    ## A list of endpoints allowed as part of this ServiceMonitor.\r\n    endpoints: []\r\n\r\n  reportIngressStatus:\r\n    ## Updates the address field in the status of Ingress resources with an external address of the Ingress Controller.\r\n    ## You must also specify the source of the external address either through an external service via controller.reportIngressStatus.externalService,\r\n    ## controller.reportIngressStatus.ingressLink or the external-status-address entry in the ConfigMap via controller.config.entries.\r\n    ## Note: controller.config.entries.external-status-address takes precedence over the others.\r\n    enable: true\r\n\r\n    ## Specifies the name of the service with the type LoadBalancer through which the Ingress Controller is exposed externally.\r\n    ## The external address of the service is used when reporting the status of Ingress, VirtualServer and VirtualServerRoute resources.\r\n    ## controller.reportIngressStatus.enable must be set to true.\r\n    ## The default is autogenerated and matches the created service (see controller.service.create).\r\n    # externalService: nginx-ingress\r\n\r\n    ## Specifies the name of the IngressLink resource, which exposes the Ingress Controller pods via a BIG-IP system.\r\n    ## The IP of the BIG-IP system is used when reporting the status of Ingress, VirtualServer and VirtualServerRoute resources.\r\n    ## controller.reportIngressStatus.enable must be set to true.\r\n    ingressLink: \"\"\r\n\r\n    ## Enable Leader election to avoid multiple replicas of the controller reporting the status of Ingress resources. controller.reportIngressStatus.enable must be set to true.\r\n    enableLeaderElection: true\r\n\r\n    ## Specifies the name of the ConfigMap, within the same namespace as the controller, used as the lock for leader election. controller.reportIngressStatus.enableLeaderElection must be set to true.\r\n    ## Autogenerated if not set or set to \"\".\r\n    # leaderElectionLockName: \"nginx-ingress-leader-election\"\r\n\r\n    ## The annotations of the leader election configmap.\r\n    annotations: {}\r\n\r\n  pod:\r\n    ## The annotations of the Ingress Controller pod.\r\n    annotations: {}\r\n\r\n    ## The additional extra labels of the Ingress Controller pod.\r\n    extraLabels: {}\r\n\r\n  ## The PriorityClass of the Ingress Controller pods.\r\n  # priorityClassName: \"\"\r\n\r\n  readyStatus:\r\n    ## Enables readiness endpoint \"/nginx-ready\". The endpoint returns a success code when NGINX has loaded all the config after startup.\r\n    enable: true\r\n\r\n    ## Set the port where the readiness endpoint is exposed.\r\n    port: 8081\r\n\r\n    ## The number of seconds after the Ingress Controller pod has started before readiness probes are initiated.\r\n    initialDelaySeconds: 0\r\n\r\n  ## Enable collection of latency metrics for upstreams. Requires prometheus.create.\r\n  enableLatencyMetrics: false\r\n\r\n  ## Disable IPV6 listeners explicitly for nodes that do not support the IPV6 stack.\r\n  disableIPV6: false\r\n\r\n  ## Configure root filesystem as read-only and add volumes for temporary data.\r\n  readOnlyRootFilesystem: false\r\n\r\nrbac:\r\n  ## Configures RBAC.\r\n  create: true\r\n\r\nprometheus:\r\n  ## Expose NGINX or NGINX Plus metrics in the Prometheus format.\r\n  create: true\r\n\r\n  ## Configures the port to scrape the metrics.\r\n  port: 9113\r\n\r\n  ## Specifies the namespace/name of a Kubernetes TLS Secret which will be used to protect the Prometheus endpoint.\r\n  secret: \"\"\r\n\r\n  ## Configures the HTTP scheme used.\r\n  scheme: http\r\n\r\nserviceInsight:\r\n  ## Expose NGINX Plus Service Insight endpoint.\r\n  create: false\r\n\r\n  ## Configures the port to expose endpoint.\r\n  port: 9114\r\n\r\n  ## Specifies the namespace/name of a Kubernetes TLS Secret which will be used to protect the Service Insight endpoint.\r\n  secret: \"\"\r\n\r\n  ## Configures the HTTP scheme used.\r\n  scheme: http\r\n\r\nnginxServiceMesh:\r\n  ## Enables integration with NGINX Service Mesh.\r\n  enable: false\r\n\r\n  ## Enables NGINX Service Mesh workload to route egress traffic through the Ingress Controller.\r\n  ## Requires nginxServiceMesh.enable\r\n  enableEgress: false\r\n\r\n```\r\nEven this i have not seen the port and i can't scrape it in prometheus. I'm using the kube-prometheus-stack.",
      "category": "Q&A",
      "created_at": "2023-07-13T20:35:11Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/4495",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 3806,
      "title": "Deployment failed to create pod",
      "question": "I want to deploy the ingress controller, but I don't know where there is a problem with my configuration file\r\n\r\n```\r\napiVersion: v1\r\nkind: Namespace\r\nmetadata:\r\n  name: nginx-ingress\r\n---\r\napiVersion: networking.k8s.io/v1\r\nkind: IngressClass\r\nmetadata:\r\n  name: freecar-ink\r\n\r\nspec:\r\n  controller: nginx.org/ingress-controller\r\n\r\n---\r\napiVersion: networking.k8s.io/v1\r\nkind: Ingress\r\nmetadata:\r\n  name: freecar-ing\r\n\r\nspec:\r\n  ingressClassName: freecar-ink\r\n\r\n  rules:\r\n    - host: freecar.test\r\n      http:\r\n        paths:\r\n          - path: /\r\n            pathType: Prefix\r\n            backend:\r\n              service:\r\n                name: consul\r\n                port:\r\n                  number: 8500\r\n          - path: /\r\n            pathType: Prefix\r\n            backend:\r\n              service:\r\n                name: mysql\r\n                port:\r\n                  number: 3306\r\n---\r\napiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: freecar-kic-dep\r\n  namespace: nginx-ingress\r\nspec:\r\n  replicas: 1\r\n  selector:\r\n    matchLabels:\r\n      app: freecar-kic-dep\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: freecar-kic-dep\r\n    spec:\r\n      serviceAccountName: nginx-ingress\r\n      dnsPolicy: ClusterFirstWithHostNet\r\n      containers:\r\n        - name: nginx-ingress\r\n          image: nginx/nginx-ingress:2.2-alpine\r\n          imagePullPolicy: IfNotPresent\r\n          ports:\r\n            - name: http\r\n              containerPort: 80\r\n            - name: https\r\n              containerPort: 443\r\n            - name: readiness-port\r\n              containerPort: 8081\r\n            - name: prometheus\r\n              containerPort: 9113\r\n          readinessProbe:\r\n            httpGet:\r\n              path: /nginx-ready\r\n              port: readiness-port\r\n            periodSeconds: 1\r\n          securityContext:\r\n            allowPrivilegeEscalation: true\r\n            runAsUser: 101\r\n            capabilities:\r\n              drop:\r\n                - ALL\r\n              add:\r\n                - NET_BIND_SERVICE\r\n          env:\r\n            - name: POD_NAMESPACE\r\n              valueFrom:\r\n                fieldRef:\r\n                  fieldPath: metadata.namespace\r\n            - name: POD_NAME\r\n              valueFrom:\r\n                fieldRef:\r\n                  fieldPath: metadata.name\r\n          args:\r\n            - -ingress-class=freecar-ink\r\n            - -health-status\r\n            - -ready-status\r\n            - -nginx-status\r\n            - -enable-snippets\r\n            - -nginx-configmaps=$(POD_NAMESPACE)/nginx-config\r\n            - -default-server-tls-secret=$(POD_NAMESPACE)/default-server-secret\r\n---\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: freecar-kic-svc\r\n  namespace: nginx-ingress\r\n  annotations:\r\n    service.beta.kubernetes.io/aws-load-balancer-type: nlb\r\nspec:\r\n  type: LoadBalancer\r\n  selector:\r\n    app: freecar-kic-dep\r\n  ports:\r\n    - name: http\r\n      protocol: TCP\r\n      port: 80\r\n      targetPort: 80\r\n    - name: https\r\n      protocol: TCP\r\n      port: 443\r\n      targetPort: 443\r\n```\r\n<img width=\"1129\" alt=\"image\" src=\"https://user-images.githubusercontent.com/114405451/233825706-ca087065-1fc4-4e14-9853-efb33df47834.png\">\r\nWho can help me? This problem has been bothering me for a long time. Thank you very much\r\n\r\n",
      "answer": "Hi @Nihilism0 from the output of your deployment it shows that you have 1 desired pod, and 1 unavailable pod\r\n```\r\nReplicas:               1 desired | 0 updated | 0 total | 0 available | 1 unavailable\r\n```\r\nCan you run `kubectl describe` on the replicaset of you deployment? This should provide us with event details from the replica set, and should tell us why it was not able to startup.",
      "category": "Q&A",
      "created_at": "2023-04-23T07:19:45Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/3806",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 2816,
      "title": "Configmap for nginx ingress controller not taking effect",
      "question": "Issue:\r\n\r\nWe upgraded our AKS cluster from v1.19.x to v1.22.6 and post upgrade we had to update the Nginx-ingress docker image to use version 2.2 which is nginx version: 1.21.6 after this change the changes in the configmap configurations are getting ignored and not taking any effect and most of the default configurations are being applied for now. \r\n\r\nWe looked into the logs for nginx pods as well as the events for configmap post update, no errors were found also no events related to this.\r\n\r\nNote: Nginx ingress controller is managed by a deployment definition file.\r\n\r\n**First Question:**\r\nEven though I see the docker image's command starts with `/nginx-ingress` as per the below screenshot I still need to pass the `/nginx-ingress-controller` in the Nginx ingress deployment without it the pods crashloopBackOff. Is this expected?\r\n![Screen Shot 2022-06-30 at 12 49 29 PM](https://user-images.githubusercontent.com/87133789/176734213-7d58b4ad-1ad7-41b6-a638-731695bb63cb.png)\r\n\r\n**Second Question**\r\nThe nginx config map looks as below and it is passed as an arg with the correct namespace and name in the deployment definition. However, no changes are taking effect or is getting ignored. For ex: keepalive-timeout: 90s is getting ignored as the value for this parameter at /etc/nginx/nginx.conf is displayed as 65s. Same with the SSL protocols config, log-format.\r\n\r\n```\r\nkind: ConfigMap\r\napiVersion: v1\r\nmetadata:\r\n  name: nginx-config\r\n  namespace: default\r\ndata:\r\n  brotli-level: '4'\r\n  brotli-types: >-\r\n    text/css text/* text/javascript message/* application/x-javascript\r\n    application/json application/xml application/atom+xml application/xaml+xml\r\n  enable-brotli: 'true'\r\n  enable-modsecurity: 'true'\r\n  fail-timeout: 15s\r\n  http-snippet: |\r\n    server {\r\n      listen 18080;\r\n\r\n      location /nginx_status {\r\n        allow all;\r\n        stub_status on;\r\n      }\r\n\r\n      location / {\r\n        return 404;\r\n      }\r\n    }\r\n  keepalive-timeout: 90s\r\n  log-format: >-\r\n    $remote_addr - $request_id - [$proxy_add_x_forwarded_for] - $remote_user\r\n    [$time_local] \"$request\" $status $body_bytes_sent \"$http_referer\"\r\n    \"$http_user_agent\" $request_length $request_time [$proxy_upstream_name]\r\n    $upstream_addr $upstream_response_length $upstream_response_time\r\n    $upstream_status\r\n  proxy-body-size: 100m\r\n  proxy-connect-timeout: 100s\r\n  proxy-read-timeout: 100s\r\n  proxy-send-timeout: 100s\r\n  ssl-protocols: TLSv1.2\r\n  use-forwarded-headers: 'true'\r\n  use-http2: 'true'\r\n  worker-connections: '10240'\r\n```\r\n\r\nThe argument for the  configmap in the deployment is as shown in the below screenshot\r\n![Screen Shot 2022-06-30 at 12 57 46 PM](https://user-images.githubusercontent.com/87133789/176735119-d45ebfa4-4caf-4c41-adbc-4b4120201957.png)\r\n\r\n\r\nAny help on this much appreciated!!",
      "answer": "@rrachitha \r\nAre you using our Dockerfile to build the image? Or are you building your own customer NGINX Ingress controller image.\r\n\r\nwould it be possible to share your deployment file so I can review?\r\nLooking at your snippet in the above, the arguments do not look correct.\r\nReviewing your deployment file will help me identify the issue.\r\nThx",
      "category": "Q&A",
      "created_at": "2022-06-30T17:34:32Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/2816",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 2664,
      "title": "Trying to setup ingress resulting in back-off-restarting with 'error retrieving k8s version'",
      "question": " checked out this git-repo and tried to deploy on fresh-setup kubernetes (bare-metal, 2 workers) with flannel-cni.\r\n\r\nI used these commands to setup:\r\n\r\nkubectl apply -f common/ns-and-sa.yaml\r\nkubectl apply -f common/default-server-secret.yaml\r\nkubectl apply -f common/nginx-config.yaml\r\nkubectl apply -f rbac/rbac.yaml\r\nkubectl apply -f deployment/nginx-ingress.yaml\r\nkubectl apply -f service/loadbalancer.yaml\r\n\r\nAfter some time everything started up, except \"nginx-ingress\":\r\nState is 'waiting'\r\nLast Status: 'Terminate' with Reason 'exit-code 255'\r\n\r\nBack-off restarting failed container\r\n```\r\nReadiness probe failed: Get \"http://10.96.2.4:8081/nginx-ready\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\r\n```\r\n\r\nTerminal Log:\r\n```\r\nI0506 13:41:57.751680       1 main.go:213] Starting NGINX Ingress Controller Version=2.2.0 GitCommit=72602e19f0bb160cfe0cfa791edd922e3842def2 Date=2022-04-12T22:46:02Z Arch=linux/amd64 PlusFlag=false\r\nF0506 13:42:27.754322       1 main.go:342] error retrieving k8s version: Get \"https://10.10.0.1:443/version\": dial tcp 10.10.0.1:443: i/o timeout\r\n```\r\n\r\nWell okay I'm new to kubernetes may be there's something I didn't do right? Any help welcome.",
      "answer": "It looks like you have missed the IngressClass. \r\nhttps://docs.nginx.com/nginx-ingress-controller/installation/installation-with-manifests/#2-create-common-resources\r\nEasy to miss when doing individual manifests.\r\n\r\nAs well as the CRDs:\r\nhttps://docs.nginx.com/nginx-ingress-controller/installation/installation-with-manifests/#create-custom-resources\r\n`Note: By default, it is required to create custom resource definitions for VirtualServer, VirtualServerRoute, TransportServer and Policy. Otherwise, the Ingress Controller pods will not become Ready. If you\u2019d like to disable that requirement, configure [-enable-custom-resources](https://docs.nginx.com/nginx-ingress-controller/configuration/global-configuration/command-line-arguments#cmdoption-global-configuration) command-line argument to false and skip this section.`",
      "category": "Q&A",
      "created_at": "2022-05-06T13:49:16Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/2664",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 2952,
      "title": "Issues pulling nginx-plus-ingress:2.3.0",
      "question": "Hello, I am having an issue pulling the  nginx-plus-ingress:2.3.0 image from the private registry. Any note on what I am doing wrong?\r\n\r\nFollowed the steps in https://docs.nginx.com/nginx-ingress-controller/installation/using-the-jwt-token-docker-secret/\r\n\r\nUbuntu K8s 1.24.4 cluster\r\n\r\n```json\r\napiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: nginx-ingress\r\n  namespace: nginx-ingress\r\nspec:\r\n  replicas: 1\r\n  selector:\r\n    matchLabels:\r\n      app: nginx-ingress\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: nginx-ingress\r\n     #annotations:\r\n       #prometheus.io/scrape: \"true\"F\r\n       #prometheus.io/port: \"9113\"\r\n       #prometheus.io/scheme: http\r\n    spec:\r\n      serviceAccountName: nginx-ingress\r\n      containers:\r\n      - image: private-registry.nginx.com/v2/nginx-ic-nap/nginx-plus-ingress:2.3.0\r\n        imagePullPolicy: IfNotPresent\r\n        name: nginx-plus-ingress\r\n        ports:\r\n        - name: http\r\n          containerPort: 80\r\n        - name: https\r\n          containerPort: 443\r\n        - name: readiness-port\r\n          containerPort: 8081\r\n        - name: prometheus\r\n          containerPort: 9113\r\n        readinessProbe:\r\n          httpGet:\r\n            path: /nginx-ready\r\n            port: readiness-port\r\n          periodSeconds: 1\r\n        securityContext:\r\n          allowPrivilegeEscalation: true\r\n          runAsUser: 101 #nginx\r\n          capabilities:\r\n            drop:\r\n            - ALL\r\n            add:\r\n            - NET_BIND_SERVICE\r\n        env:\r\n        - name: POD_NAMESPACE\r\n          valueFrom:\r\n            fieldRef:\r\n              fieldPath: metadata.namespace\r\n        - name: POD_NAME\r\n          valueFrom:\r\n            fieldRef:\r\n              fieldPath: metadata.name\r\n        args:\r\n          - -nginx-plus\r\n          - -nginx-configmaps=$(POD_NAMESPACE)/nginx-config\r\n          - -default-server-tls-secret=$(POD_NAMESPACE)/default-server-secret\r\n          - -enable-cert-manager\r\n          - -enable-app-protect\r\n         #- -enable-app-protect-dos\r\n         #- -v=3 # Enables extensive logging. Useful for troubleshooting.\r\n         #- -report-ingress-status\r\n         #- -external-service=nginx-ingress\r\n         #- -enable-prometheus-metrics\r\n         #- -global-configuration=$(POD_NAMESPACE)/nginx-configuration\r\n```\r\n\r\n```json\r\napiVersion: v1\r\ndata:\r\n  .dockerconfigjson: <Removed>\r\nkind: Secret\r\nmetadata:\r\n  creationTimestamp: \"2022-08-05T20:58:53Z\"\r\n  name: regcred\r\n  namespace: nginx-ingress\r\n  resourceVersion: \"650867\"\r\n  uid: b8e08a4e-d807-4299-a21b-7012b028ac0b\r\ntype: kubernetes.io/dockerconfigjson\r\n```\r\n\r\n```json\r\nName:                nginx-ingress\r\nNamespace:           nginx-ingress\r\nLabels:              <none>\r\nAnnotations:         <none>\r\nImage pull secrets:  regcred\r\nMountable secrets:   nginx-ingress-token-z89gx\r\nTokens:              nginx-ingress-token-z89gx\r\nEvents:              <none>\r\n```\r\n",
      "answer": "It looks to me that the issue is probably the image name you have in the deployment - there is an erroneous `v2` which is required for the curl command (because it is querying the docker registry API), but it is not part of the image name. Try changing \r\n`- image: private-registry.nginx.com/v2/nginx-ic-nap/nginx-plus-ingress:2.3.0` -> `- image: private-registry.nginx.com/nginx-ic-nap/nginx-plus-ingress:2.3.0`. The rest looks OK I think!",
      "category": "Q&A",
      "created_at": "2022-08-22T14:00:24Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/2952",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 4270,
      "title": "Rate-limiting in combination with auto-scaling",
      "question": "Hi,\r\n\r\nwe have currently implemented Rate-Limiting on our Ingress-Resources using http- and location-snippets (using the limit_req directives).\r\n\r\nThat is working fine so far. Requests are limited properly per IP.\r\n\r\nHowever, we also have auto-scaling configured for our ingress-controller-pods.\r\n\r\nThe issue now is, that the rate-limits applied via snippets are per-pod. Once additional pods are spawned by the autoscaling, the total request-limit rises (as requests are now distributed on more pods, which each have an individual rate-limit).\r\n\r\nThis means that when you simply send enough requests to trigger a scale-up, you can raise and therefore circumvent the rate-limit.\r\n\r\nAny suggestions on how to solve this?\r\nIs there a way to specify a rate-limit accross all pods? Or to adapt the per-pod-limit based on the number of pods?\r\n",
      "answer": "Optimally, we want NGINX Plus to handle this using zone_sync as that will be the most accurate.\r\nAlternately, I am interpreting that you are trying to achieve global behavior with the free edition.\r\n\r\nThere is one free edition customer I know who drives their scaling with automation (not HPA) and thus reconfigures the rate limit settings when a scaling action happens.\r\n\r\nThe controller does not 'automagically' attempt to do math here.  As you state, we would need some type of Controller/Operator process to drive that from the outside.  Helm is the only place where this is all templated together, otherwise it is distinct manifests.\r\nWe leave it in your hands do that math today.\r\nIf using VirtualServer rate limit Policy, then just the Policy object needs to be updated, not an injected snippet - much easier to programmatically handle.",
      "category": "Q&A",
      "created_at": "2023-08-21T14:18:17Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/4270",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 3754,
      "title": "TransportServer TLS Field",
      "question": "Hi all,\r\n\r\nIs anyone having any issues adding the TLS field to the TransportServer custom resource, I keep getting an error that the TLS field isn't in the schema for the k8s.nginx.org/v1alpha1 API even though its in the [documentation](https://docs.nginx.com/nginx-ingress-controller/configuration/transportserver-resource/#tls) and I can see it in the [code](https://github.com/nginxinc/kubernetes-ingress/blob/main/pkg/apis/configuration/v1alpha1/types.go#L82) as well.\r\n\r\nI am using the Kubernetes Terraform provider to deploy the TransportServer manifest:\r\n![image](https://user-images.githubusercontent.com/88775596/231483033-045c051a-993b-430d-b79e-b565e41bf958.png)\r\n\r\nWithout the TLS field in the manifest it deploys fine, any help is appreciated.\r\n",
      "answer": "That just came in with 3.1 https://github.com/nginxinc/kubernetes-ingress/pull/3462\r\nWhat version are you running?\r\n_I am assuming that you installed the CRDs._",
      "category": "Q&A",
      "created_at": "2023-04-12T14:07:55Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/3754",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 3824,
      "title": "need to suppress  the nginx-ingsress warning logs:  networking.k8s.io/v1beta1",
      "question": "**Describe the bug**\r\n\r\nwe have installed nginx-ingress version v1.10.1 and kubernetes version v1.21.5\r\nnginx ingress image= nginx/nginx-ingress:1.10.1\r\n\r\nnginx-ingress pod logs are giving warnings\r\n**W0425 13:57:30.293672 1 warnings.go:70] networking.k8s.io/v1beta1 IngressClass is deprecated in v1.19+, unavailable in v\r\n1.22+; use networking.k8s.io/v1 IngressClassList**\r\n\r\nwe want to remove/suppress the above warning so that it should not be seen in the nginx-ingress logs.\r\nother warnings i have suppressed successfully using below code in the yaml.\r\n\r\nspec:\r\ncontainers:\r\n- args:\r\n- -v=2\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Deploy x to '...' using some.yaml\r\n2. View logs on '....'\r\n3. See error\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\n**Your environment**\r\n* Version of the Ingress Controller - release version or a specific commit : v1.10.1\r\n* Version of Kubernetes: v1.21.5\r\n* Kubernetes platform (e.g. Mini-kube or GCP) : on-premises \r\n* Using NGINX or NGINX Plus : NGINX daemon\r\n<!-- output from `docker inspect --format '{{ json .Config.Labels }}' <docker image> | jq` if available -->\r\n\r\n**Additional context**\r\nAdd any other context about the problem here. Any log files you want to share.\r\n",
      "answer": "Considering this message is coming from the K8s API machinery itself and not this project I don't think there is much guidance I can provide.\r\nUsually when the K8s API warns on these things it is because it sees a deprecated parameter within an object or an object itself.\r\n",
      "category": "Q&A",
      "created_at": "2023-04-27T06:49:41Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/3824",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 3729,
      "title": "Ingress cannot find the my app",
      "question": "Hi\r\nI am new to Kubernetes.\r\n\r\nmy setup:\r\n- nginx deployment as an app\r\n- nginx service\r\n- nginx ingress controller\r\n- myapp ingress rule\r\n\r\n**deployment:**\r\n```\r\napiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: nginx-deployment\r\n  labels:\r\n    app: nginx\r\nspec:\r\n  replicas: 1\r\n  selector:\r\n    matchLabels:\r\n      app: nginx\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: nginx\r\n    spec:\r\n      containers:\r\n      - name: nginx\r\n        image: nginx\r\n        ports:\r\n        - containerPort: 80\r\n```\r\n\r\n**nginx service**\r\n```\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: nginx-service\r\nspec:\r\n  selector:\r\n    app: nginx\r\n  ports:\r\n    - protocol: TCP\r\n      port: 8080\r\n      targetPort: 80\r\n```\r\n\r\n**My app Ingress**\r\n```\r\napiVersion: networking.k8s.io/v1\r\nkind: Ingress\r\nmetadata:\r\n  name: myapp-ingress\r\n  annotations:\r\n    kubernetes.io/ingress.class: \"nginx\"\r\nspec:\r\n  rules:\r\n  - host: example.com\r\n    http:\r\n      paths:\r\n      - path: /\r\n        pathType: Exact\r\n        backend:\r\n          service:\r\n            name: nginx-service\r\n            port:\r\n              number: 8080\r\n```\r\n\r\n**Services:**\r\n```\r\nk get svc\r\nNAME                                 TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE\r\ningress-nginx-controller             LoadBalancer   10.106.160.11    <pending>     80:32189/TCP,443:31960/TCP   30h\r\ningress-nginx-controller-admission   ClusterIP      10.97.119.19     <none>        443/TCP                      30h\r\nkubernetes                           ClusterIP      10.96.0.1        <none>        443/TCP                      2d21h\r\nnginx-service                        ClusterIP      10.105.137.251   <none>        8080/TCP                     21m\r\n```\r\n\r\n\r\n**ingress**\r\n```\r\nk get ingress\r\nNAME            CLASS    HOSTS         ADDRESS   PORTS   AGE\r\nmyapp-ingress   <none>   example.com             80      30m\r\n```\r\n\r\n**Pods**\r\n```\r\nk get pods\r\nNAME                                        READY   STATUS    RESTARTS        AGE\r\ningress-nginx-controller-5c6fd54c59-t5k6f   1/1     Running   1 (8m32s ago)   30h\r\nnginx-deployment-7f456874f4-6hhqh           1/1     Running   1 (6m54s ago)   2d7h\r\n```\r\n\r\nI configured \"example.com\" internally on my pc pointing to the worker node IP of my cluster.\r\n```\r\nping example.com\r\n\r\nPinging example.com [192.168.0.8] with 32 bytes of data:\r\nReply from 192.168.0.8: bytes=32 time=4ms TTL=64\r\nReply from 192.168.0.8: bytes=32 time=3ms TTL=64\r\nReply from 192.168.0.8: bytes=32 time=4ms TTL=64\r\n```\r\n\r\nBut I don't get any response when using the domain name in the URL. any help is appreciated.\r\n\r\nHowever, I get a \"Welcome to nginx!\" when I use the NodePort directly: http://example.com:30000/\r\n\r\n`nginx-service                        NodePort       10.105.137.251   <none>        8080:30000/TCP               26m`\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
      "answer": "Hi\r\nI found my issue and fixed it. The issue was in the reverse proxy configuration where I missed passing the hostname to the ingress controller in Kubernetes.\r\nI am using an Nginx reverse proxy in front of my Kubernetes cluster. \r\nThe traffic was forwarded to the ingress controller in Kubernetes, but the host header was missing, so the ingress controller could not match the hostname that was configured in the ingress yaml file.\r\n\r\nI add the following line after the proxy_path:    proxy_set_header Host            $host;\r\nand everything works fine now.\r\n\r\n",
      "category": "Q&A",
      "created_at": "2023-04-05T18:42:28Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/3729",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 2555,
      "title": "OIDC client secret is invalid error when deploying a VirtualServer on Nginx Plus on Kubernetes",
      "question": "Hi, I am getting the following when I try to deploy a virtual server in kubernetes using Nginx Plus in EKS:\r\n\r\nWarning  AddedOrUpdatedWithWarning  38s   nginx-ingress-controller  Configuration for mynmespace/my-virtual-server was added or updated ; with warning(s): OIDC policy mynamespave/kycloak-oidc-policy references an invalid secret mynamespace/oidc-secret: OIDC client secret is invalid: It must contain valid ASCII characters, must have all '\"' escaped and must not contin any '$' or whitespaces ('\\n', '\\t' etc.) or end with an unescaped '\\'\r\n\r\nI am using similar to the following:\r\n\r\n**Secret:**\r\napiVersion: v1\r\nkind: Secret\r\nmetadata:\r\n  name: oidc-secret\r\ntype: nginx.org/oidc\r\ndata:\r\n  client-secret: dzRiMzJjNGIwLWY0YjMtNDFkOS1hMzQ1LTJiYzBmYmZjYWFiYQo=\r\n\r\n\r\n**Policy:**\r\napiVersion: k8s.nginx.org/v1\r\nkind: Policy\r\nmetadata:\r\n  name: keycloak-oidc-policy\r\nspec:\r\n  ingressClassName: nginx-plus\r\n  oidc:\r\n    clientID: OIDCProxyNGINXPlus\r\n    clientSecret: oidc-secret\r\n    authEndpoint: <IDP host>/TestOIDC/protocol/openid-connect/auth\r\n    tokenEndpoint: <IDP host>/auth/realms/TestOIDC/protocol/openid-connect/token\r\n    jwksURI: <IDP host>/auth/realms/TestOIDC/protocol/openid-connect/certs\r\n\r\n\r\n**Virtual Server:**\r\n\r\napiVersion: k8s.nginx.org/v1\r\nkind: VirtualServer\r\nmetadata:\r\n  name: my-virtual-server\r\nspec:\r\n  ingressClassName: nginx-plus\r\n  host: <My Host Name>\r\n  upstreams:\r\n  - name: mybackend\r\n    service: mybasckend-service\r\n    port: 80\r\n  routes:\r\n  - path: /mybackend\r\n    policies:\r\n    - name: keycloak-oidc-policy\r\n    action:\r\n      proxy:\r\n        upstream: mybackend\r\n\r\nAny thoughts on why I keep getting this error?\r\n\r\nThanks.",
      "answer": "@billb-asg Hello there.\r\nFrom the error, it looks like your secret was not created correctly. \r\n\r\n`It must contain valid ASCII characters, must have all '\"' escaped and must not contin any '$' or whitespaces ('\\n', '\\t' etc.) or end with an unescaped ''`\r\n\r\nHow did you create your secret?\r\nAre you able to decode your secret successfully?",
      "category": "Q&A",
      "created_at": "2022-03-28T23:50:35Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/2555",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 2769,
      "title": "Issue with externalname",
      "question": "Hey. there, i'm trying to setup an ingress for an external url and I'm following the very light instructions here, https://github.com/nginxinc/kubernetes-ingress/tree/v2.2.2/examples/externalname-services.\r\n\r\nHere's my setup.\r\n\r\n```\r\nkind: Service\r\napiVersion: v1\r\nmetadata:\r\n  name: test-external-url\r\nspec:\r\n  type: ExternalName\r\n  externalName: static.wikia.nocookie.net\r\n---\r\napiVersion: networking.k8s.io/v1\r\nkind: Ingress\r\nmetadata:\r\n  name: external-ingress\r\nspec:\r\n  rules:\r\n  - host: $(INGRESS_HOST)  \r\n    http:\r\n      paths:\r\n      - path: /wikia\r\n        pathType: Prefix\r\n        backend:\r\n          service:\r\n            name: test-external-url\r\n            port:\r\n              number: 80\r\n```\r\n\r\nI added the `resolver-address` to my configmap and set that to the cluster-ip of kube-dns.\r\n\r\nProblem is when I look at the `/etc/nginx/conf.d/generetedfile.conf` I see my location route and the upstream it created, but the up stream is missing any kind of server information for what i'm proxying, and i get a 502 error and the logs of course say no live upstreams found. \r\n\r\nHere's what is generated\r\n\r\n```\r\nupstream eng-dev-sandbox-external-eip-eng-dev-sandbox.testsite-eng.com-test-external-url-80 {\r\n        zone eng-dev-sandbox-external-eip-eng-dev-sandbox.testsite-eng.com-test-external-url-80 512k;\r\n        random two least_conn;\r\n}\r\n```\r\n\r\nAny idea what i'm doing wrong here? ",
      "answer": "I noticed that you mentioned you are setting KubeDNS as the resolver.\r\nI am assuming that in your cluster KubeDNS is resolving the external hostnames.\r\n\r\nI bring this up as it is common in public clouds that KubeDNS is integrated with external DNS resolution, but in other cases it is not.",
      "category": "Q&A",
      "created_at": "2022-06-17T15:11:02Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/2769",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 2493,
      "title": "Ingress Rule route to multiple backend service ports.",
      "question": "### Discussed in https://github.com/nginxinc/kubernetes-ingress/discussions/2481\r\n\r\n<div type='discussions-op-text'>\r\n\r\n<sup>Originally posted by **iacovosb** March 11, 2022</sup>\r\nHello, and thank you for accepting my inquiry.\r\n### General information:\r\n\r\nkubernetes version: v1.23.3\r\nnginx-ingress vesion: (nginxinc/nginx-ingress OSS)  v2.1.1 / nginx:1.21.5\r\nInstallation type: bare metal\r\n\r\nI have the following service configuration:\r\n``` yaml\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: myservice\r\n  namespace: testing\r\n  labels:\r\n    app: myservice\r\nspec:\r\n  ports:\r\n  - name: http-5591\r\n    port: 5591\r\n    protocol: TCP\r\n    targetPort: 5591 ## this is one of the ports the application is running\r\n  - name: http-5592\r\n    port: 5592\r\n    protocol: TCP\r\n    targetPort: 5592 ## this is another port the application is running\r\n```\r\n\r\nAnd the respective Ingress config:\r\n``` yaml\r\nApiVersion: networking.k8s.io/v1\r\nkind: Ingress\r\nmetadata:\r\n  name: myservice\r\n  namespace: testing\r\n  annotations:\r\n    nginx.org/redirect-to-https: \"True\"\r\n  tls:\r\n  - hosts:\r\n    - myservice.example.com\r\n    secretName: wildcard-example-com\r\n  rules:\r\n  - host: myservice.example.com\r\n    http:\r\n      paths:\r\n      - pathType: Prefix\r\n        path: \"/\"\r\n        backend:\r\n          service:\r\n            name: myservice\r\n            port:\r\n             number: 5591\r\n        backend:\r\n          service:\r\n            name: myservice\r\n            port:\r\n             number: 5592\r\n```\r\n\r\nWhat I am trying to do is Load Balance the requests to myservice.example.com to the same backend service, but by using multiple ports (5591 and 5592 in this example).\r\nPlease note that the requests I want to load balance are in the same path.\r\n   ``` yaml\r\n paths:\r\n      - pathType: Prefix\r\n        path: \"/\"\r\n```\r\n\r\nThe generated config is:\r\n``` yaml\r\n        server 10.244.1.2:5592 max_fails=1 fail_timeout=10s max_conns=0;\r\n        server 10.244.11.10:5592 max_fails=1 fail_timeout=10s max_conns=0;\r\n        server 10.244.18.28:5592 max_fails=1 fail_timeout=10s max_conns=0;\r\n```\r\n\r\nTargeted config (what I am trying to achieve) is:\r\n``` yaml\r\n        server 10.244.1.2:5591 max_fails=1 fail_timeout=10s max_conns=0;\r\n        server 10.244.11.10:5591 max_fails=1 fail_timeout=10s max_conns=0;\r\n        server 10.244.18.28:5591 max_fails=1 fail_timeout=10s max_conns=0;\r\n        server 10.244.1.3:5592 max_fails=1 fail_timeout=10s max_conns=0;\r\n        server 10.244.11.13:5592 max_fails=1 fail_timeout=10s max_conns=0;\r\n        server 10.244.18.38:5592 max_fails=1 fail_timeout=10s max_conns=0;`\r\n```\r\nI have tried several approaches, but I always seem to fall into a duplication of some sort.\r\nDuplicate resource (for the host if I create multiple Ingress rules, duplicate location if I add both services under the same path, or ignoring the first part of the configuration if it is repeated in any way). \r\n\r\n<br/><br/>\r\nI also tried with multiple services and VirtualServer:\r\nServices configuration:\r\n``` yaml\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: myservice-5591\r\n  namespace: testing\r\n  labels:\r\n    app: myservice\r\nspec:\r\n  ports:\r\n  - name: http-5591\r\n    port: 5591\r\n    protocol: TCP\r\n    targetPort: 5591 ## this is one of the ports the application is running\r\n---\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: myservice-5592\r\n  namespace: testing\r\n  labels:\r\n    app: myservice\r\nspec:\r\n  ports:\r\n  - name: http-5592\r\n    port: 5592\r\n    protocol: TCP\r\n    targetPort: 5592 ## this is one of the ports the application is running\r\n```\r\nVirtual Server Config:\r\n``` yaml\r\napiVersion: k8s.nginx.org/v1\r\nkind: VirtualServer\r\nmetadata:\r\n  name: myservice-vs \r\n  namespace: testing\r\nspec:\r\n  host: myservice.example.com\r\n  tls:\r\n    secret: wildcard-example-com \r\n  upstreams:\r\n  - name: myservice-stream\r\n    service: myservice-5591\r\n    port: 5591\r\n    service: myservice-5592\r\n    port: 5592\r\n  routes:\r\n  - path: /\r\n    action:\r\n      pass: myservice-stream\r\n```\r\nAgain, one of the two services gets ignored:\r\nGenerated Config:\r\n``` yaml\r\nupstream vs_myservice {\r\n    zone vs_myservice 256k;\r\n\r\n    random two least_conn;\r\n   \r\n    server 10.244.1.3:5592 max_fails=1 fail_timeout=10s max_conns=0;\r\n    server 10.244.11.13:5592 max_fails=1 fail_timeout=10s max_conns=0;\r\n    server 10.244.18.38:5592 max_fails=1 fail_timeout=10s max_conns=0\r\n```\r\nDesired Config:\r\n``` yaml\r\nupstream vs_myservice {\r\n    zone vs_myservice 256k;\r\n\r\n    random two least_conn;\r\n    server 10.244.1.2:5591 max_fails=1 fail_timeout=10s max_conns=0;\r\n    server 10.244.11.10:5591 max_fails=1 fail_timeout=10s max_conns=0;\r\n    server 10.244.18.28:5591 max_fails=1 fail_timeout=10s max_conns=0  \r\n    server 10.244.1.3:5592 max_fails=1 fail_timeout=10s max_conns=0;\r\n    server 10.244.11.13:5592 max_fails=1 fail_timeout=10s max_conns=0;\r\n    server 10.244.18.38:5592 max_fails=1 fail_timeout=10s max_conns=0\r\n```\r\nIs there any way I can achieve the desired configuration?\r\nThank you in advance</div>",
      "answer": "Are these two different upstream groups?  (in nginx speak)\r\nAre you trying to balance between the two groups or have equal weight?\r\n\r\nUpstreams are generally considered homogeneous - as in, all listening on the same port.  The generic nginx way to handle this is generally two different upstream groups.  One on one port and the second on its port.  With a weight set for each group.\r\nThis is how you would also perform a blue/green or canary style roll-out.  \r\nIn the case of a rollout you would generally have your automation update the weight between the two groups to reduce one and increase the other until all traffic is steered to the new.\r\n\r\nIn your case the weights would be the same.\r\n\r\nLet me see if I can scare up an example.\r\n",
      "category": "General",
      "created_at": "2022-03-15T14:01:29Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/2493",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 2030,
      "title": "Error when getting IngressClass nginx: ingressclasses.networking.k8s.io \"nginx\" not found in nginx-ingress deployments",
      "question": "Was trying this but was stuck after deploying nginx-ingress.yaml with below error, is this sorted issue or am i doing it wrong? \r\nhttps://github.com/nginxinc/kubernetes-ingress/tree/master/deployments\r\n\r\nkubectl create -f deployments/deployment/nginx-ingress.yaml\r\n\r\n\r\n kubernetes-ingress]$  kubectl logs pod/nginx-ingress-ddd64b786-8bdfz -n nginx-ingress\r\nI0930 14:35:14.340272       1 main.go:271] Starting NGINX Ingress controller Version=1.12.1 GitCommit=6f72db6030daa9afd567fd7faf9d5fffac9c7c8f Date=2021-09-08T13:39:53Z PlusFlag=false\r\nW0930 14:35:14.370136       1 main.go:310] The '-use-ingress-class-only' flag will be deprecated and has no effect on versions of kubernetes >= 1.18.0. Processing ONLY resources that have the 'ingressClassName' field in Ingress equal to the class.\r\nW0930 14:35:14.379336       1 warnings.go:70] networking.k8s.io/v1beta1 IngressClass is deprecated in v1.19+, unavailable in v1.22+; use networking.k8s.io/v1 IngressClassList\r\nF0930 14:35:14.379783       1 main.go:314] **Error when getting IngressClass nginx: ingressclasses.networking.k8s.io \"nginx\" not found**\r\n\r\n\r\n kubernetes-ingress]$  kubectl get all -n nginx-ingress\r\nNAME                                READY   STATUS             RESTARTS   AGE\r\npod/nginx-ingress-ddd64b786-8bdfz   0/1     CrashLoopBackOff   8          16m\r\n\r\nNAME                            READY   UP-TO-DATE   AVAILABLE   AGE\r\ndeployment.apps/nginx-ingress   0/1     1            0           16m\r\n\r\nNAME                                      DESIRED   CURRENT   READY   AGE\r\nreplicaset.apps/nginx-ingress-ddd64b786   1         1         0       16m\r\n\r\n\r\nkubernetes-ingress]$  kubectl describe pod/nginx-ingress-ddd64b786-8bdfz -n nginx-ingress\r\nName:         nginx-ingress-ddd64b786-8bdfz\r\nNamespace:    nginx-ingress\r\nPriority:     0\r\nNode:         ip-172-XXXXXX3.us-west-2.compute.internal/172.xxxxx13\r\nStart Time:   Thu, 30 Sep 2021 14:24:22 +0000\r\nLabels:       app=nginx-ingress\r\n              pod-template-hash=ddd64b786\r\nAnnotations:  kubernetes.io/psp: eks.privileged\r\nStatus:       Running\r\n\r\nControlled By:  ReplicaSet/nginx-ingress-ddd64b786\r\nContainers:\r\n  nginx-ingress:\r\n    Container ID:  docker://8b954ba0a1609321774d34ce3db625153f3d8317bb4a1d24e417c003e1089992\r\n    Image:         nginx/nginx-ingress:1.12.1\r\n    Image ID:      docker-pullable://nginx/nginx-ingress@sha256:9e922a06363643d252978d7646ccb4c031c0901b0d59bc2eba27c3d7072e3882\r\n    Ports:         80/TCP, 443/TCP, 8081/TCP, 9113/TCP\r\n    Host Ports:    0/TCP, 0/TCP, 0/TCP, 0/TCP\r\n    Args:\r\n      -nginx-configmaps=$(POD_NAMESPACE)/nginx-config\r\n      -default-server-tls-secret=$(POD_NAMESPACE)/default-server-secret\r\n    State:          Waiting\r\n      Reason:       **CrashLoopBackOff**\r\n    Last State:     Terminated\r\n      Reason:       Error\r\n      Exit Code:    255\r\n\r\n    Ready:          False\r\n    Restart Count:  8\r\n    Readiness:      http-get http://:readiness-port/nginx-ready delay=0s timeout=1s period=1s #success=1 #failure=3\r\n    Environment:\r\n      POD_NAMESPACE:  nginx-ingress (v1:metadata.namespace)\r\n      POD_NAME:       nginx-ingress-ddd64b786-8bdfz (v1:metadata.name)\r\n    Mounts:\r\n      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-tdzv6 (ro)\r\nConditions:\r\n  Type              Status\r\n  Initialized       True\r\n  Ready             False\r\n  ContainersReady   False\r\n  PodScheduled      True\r\nVolumes:\r\n  kube-api-access-tdzv6:\r\n    Type:                    Projected (a volume that contains injected data from multiple sources)\r\n    TokenExpirationSeconds:  3607\r\n    ConfigMapName:           kube-root-ca.crt\r\n    ConfigMapOptional:       <nil>\r\n    DownwardAPI:             true\r\nQoS Class:                   BestEffort\r\nNode-Selectors:              <none>\r\nTolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s\r\n                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s\r\nEvents:\r\n  Type     Reason     Age                From               Message\r\n  ----     ------     ----               ----               -------\r\n  Normal   Scheduled  18m                default-scheduler  Successfully assigned nginx-ingress/nginx-ingress-ddd64b786-8bdfz to ip-172-16-4-113.us-west-2.compute.internal\r\n  Normal   Started    17m (x4 over 18m)  kubelet            Started container nginx-ingress\r\n  Normal   Pulled     16m (x5 over 18m)  kubelet            Container image \"nginx/nginx-ingress:1.12.1\" already present on machine\r\n  Normal   Created    16m (x5 over 18m)  kubelet            Created container nginx-ingress\r\n  Warning  BackOff    3m (x78 over 18m)  kubelet            Back-off restarting failed container\r\n",
      "answer": "@iamraj007 Hello there\r\ndid you install our `ingressClass`?\r\nYou can run:\r\n```\r\nkubectl get ingressclass\r\n```\r\n\r\nCan you show us what that output reveals?\r\nThank you.",
      "category": "Q&A",
      "created_at": "2021-09-30T14:49:11Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/2030",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 1924,
      "title": "getting 404 not found with cafe.example.com ingress using examples with kubernete-ingress 1.11.3",
      "question": "**Describe the bug**\r\nwith kubernete 1.21.1 cluster (with 3 linux and 3 windows nodes) and nginx-ingress (kubernetes-ingress  v1.11.3 )  we are constantly getting 404 not found\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. installed the nginx-ingress controller with manifests using the documentation on  https://docs.nginx.com/nginx-ingress-controller/installation/installation-with-manifests/\r\n1. deploying the cafe.example.com from the version v1.11.3 of kubernetes-ingress using the documented process in README.md with the slight modification of using nodeselector to force the running on the linux nodes.   We have added the nginx-ingress external ip (using metallb) to the host file for cafe.example.com   (10.244.0.30   cafe.example.com)\r\n\r\n**kubectl get svc -o wide -n nginx-ingress**\r\n\r\n     nginx-ingress   LoadBalancer   10.111.32.192   10.244.0.30   80:32132/TCP,443:32544/TCP   14d   app=nginx-ingress   \r\n       shows the ingress controller running with a metallb provided external IP\r\n\r\n**kubectl get ingress**\r\n\r\nNAME           CLASS    HOSTS              ADDRESS   PORTS     AGE\r\ncafe-ingress   <none>   cafe.example.com             80, 443   39m\r\n\r\n**kubectl get pods -A**       showing only cafe related\r\n\r\ndefault          coffee-6d68b8ff4f-8jdkf                           1/1     Running   0          31m\r\ndefault          coffee-6d68b8ff4f-g5rpk                           1/1     Running   0          31m\r\ndefault          tea-766cdd6757-gdj57                              1/1     Running   0          31m\r\ndefault          tea-766cdd6757-kswcj                              1/1     Running   0          31m\r\ndefault          tea-766cdd6757-smqjx                              1/1     Running   0          31m\r\n\r\n\r\ndoing     **curl --resolve cafe.example.com:80:10.244.0.30 -v http://cafe.example.com**    returns 404\r\n\r\n\r\n* Added cafe.example.com:80:10.244.0.30 to DNS cache\r\n* About to connect() to cafe.example.com port 80 (#0)\r\n*   Trying 10.244.0.30...\r\n* Connected to cafe.example.com (10.244.0.30) port 80 (#0)\r\n> GET / HTTP/1.1\r\n> User-Agent: curl/7.29.0\r\n> Host: cafe.example.com\r\n> Accept: */*\r\n>\r\n< HTTP/1.1 404 Not Found\r\n< Server: nginx/1.21.0\r\n< Date: Thu, 17 Jun 2021 19:22:37 GMT\r\n< Content-Type: text/html\r\n< Content-Length: 153\r\n< Connection: keep-alive\r\n<\r\n<html>\r\n<head><title>404 Not Found</title></head>\r\n<body>\r\n<center><h1>404 Not Found</h1></center>\r\n<hr><center>nginx/1.21.0</center>\r\n</body>\r\n</html>\r\n* Connection #0 to host cafe.example.com left intact\r\n2. View logs on '....'\r\n3. See error\r\n\r\n**Expected behavior**\r\nexpected the nginx-ingress to route to the cafe or tea deployments\r\n\r\n\r\n\r\n**Your environment**\r\n* Kubernetes v 1.21.1\r\n* On premise bare metal setup with 3 linux 3 windows nodes... linux control plane.\r\n* using nginx\r\n* \r\n\r\n **kubectl get ingress cafe-ingress**\r\n\r\nNAME           CLASS    HOSTS              ADDRESS   PORTS     AGE\r\ncafe-ingress   <none>   cafe.example.com             80, 443   43m\r\n\r\n **kubectl describe ingress cafe-ingress**\r\n\r\nName:             cafe-ingress\r\nNamespace:        default\r\nAddress:\r\nDefault backend:  default-http-backend:80 (<error: endpoints \"default-http-backend\" not found>)\r\nTLS:\r\n  cafe-secret terminates cafe.example.com\r\nRules:\r\n  Host              Path  Backends\r\n  ----              ----  --------\r\n  cafe.example.com\r\n                    /tea      tea-svc:80 (192.168.1.26:8080,192.168.2.33:8080,192.168.2.34:8080)\r\n                    /coffee   coffee-svc:80 (192.168.2.31:8080,192.168.2.32:8080)\r\nAnnotations:        <none>\r\nEvents:             <none>\r\n\r\n **curl 192.168.1.26:8080**\r\n\r\nServer address: 192.168.1.26:8080\r\nServer name: tea-766cdd6757-kswcj\r\nDate: 17/Jun/2021:19:26:10 +0000\r\nURI: /\r\nRequest ID: 60d611f651c50b9186804c420882fc8e\r\n\r\n\r\n**curl cafe.example.com**\r\n\r\n<html>\r\n<head><title>404 Not Found</title></head>\r\n<body>\r\n<center><h1>404 Not Found</h1></center>\r\n<hr><center>nginx/1.21.0</center>\r\n</body>\r\n</html>\r\n\r\n",
      "answer": "Thanks Jason,  Much appreciated.\r\n\r\nNGINX is in the nginx-ingress namespace \r\nkubectl get po,svc -A\r\n\r\nI suspect there is something small.  I am not getting anything generated  in the /etc/nginx/conf.d folder.  There is actually no /etc/nginx folder\r\n\r\n\r\nNAMESPACE        NAME                                                  READY   STATUS    RESTARTS   AGE\r\ndefault          pod/aks-helloworld-one-75c9fcd88-sx48t                1/1     Running   0          8h\r\ndefault          pod/aks-helloworld-two-6dcdb7f788-w7nx2               1/1     Running   0          8h\r\ndefault          pod/coffee-6d68b8ff4f-8jdkf                           1/1     Running   0          7h42m\r\ndefault          pod/coffee-6d68b8ff4f-g5rpk                           1/1     Running   0          7h42m\r\ndefault          pod/tea-766cdd6757-gdj57                              1/1     Running   0          7h42m\r\ndefault          pod/tea-766cdd6757-kswcj                              1/1     Running   0          7h42m\r\ndefault          pod/tea-766cdd6757-smqjx                              1/1     Running   0          7h42m\r\nkube-system      pod/coredns-558bd4d5db-2zwrp                          1/1     Running   1          20d\r\nkube-system      pod/coredns-558bd4d5db-tsbb8                          1/1     Running   1          20d\r\nkube-system      pod/etcd-iabrl-k8inp01.olh.local                      1/1     Running   1          20d\r\nkube-system      pod/kube-apiserver-iabrl-k8inp01.olh.local            1/1     Running   1          20d\r\nkube-system      pod/kube-controller-manager-iabrl-k8inp01.olh.local   1/1     Running   1          20d\r\nkube-system      pod/kube-flannel-ds-4npfv                             1/1     Running   1          20d\r\nkube-system      pod/kube-flannel-ds-fxqlw                             1/1     Running   1          20d\r\nkube-system      pod/kube-flannel-ds-qpvpn                             1/1     Running   3          20d\r\nkube-system      pod/kube-flannel-ds-windows-amd64-fd6pk               1/1     Running   3          12h\r\nkube-system      pod/kube-flannel-ds-windows-amd64-kxkvz               1/1     Running   6          9d\r\nkube-system      pod/kube-flannel-ds-windows-amd64-ppxd7               1/1     Running   9          9d\r\nkube-system      pod/kube-proxy-9q8f7                                  1/1     Running   1          20d\r\nkube-system      pod/kube-proxy-dtv2g                                  1/1     Running   1          20d\r\nkube-system      pod/kube-proxy-windows-d7wmq                          1/1     Running   1          12h\r\nkube-system      pod/kube-proxy-windows-f5w95                          1/1     Running   6          7d4h\r\nkube-system      pod/kube-proxy-windows-xx59w                          1/1     Running   6          7d4h\r\nkube-system      pod/kube-proxy-xfdk5                                  1/1     Running   1          20d\r\nkube-system      pod/kube-scheduler-iabrl-k8inp01.olh.local            1/1     Running   1          20d\r\nmetallb-system   pod/controller-6b78bff7d9-pqjsq                       1/1     Running   0          11h\r\nmetallb-system   pod/speaker-c4k5v                                     1/1     Running   0          11h\r\nmetallb-system   pod/speaker-gdzpv                                     1/1     Running   0          11h\r\nmetallb-system   pod/speaker-s85mj                                     1/1     Running   0          11h\r\nnginx-ingress    pod/nginx-ingress-55f77659df-nrsqp                    1/1     Running   0          2d9h\r\nnginx-ingress    pod/nginx-ingress-5bw4f                               1/1     Running   0          9d\r\nnginx-ingress    pod/nginx-ingress-m6btc                               1/1     Running   0          9d\r\n\r\nNAMESPACE       NAME                         TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE\r\ndefault         service/aks-helloworld-one   ClusterIP      10.96.236.14     <none>        80/TCP                       8h\r\ndefault         service/aks-helloworld-two   ClusterIP      10.105.111.115   <none>        80/TCP                       8h\r\ndefault         service/coffee-svc           ClusterIP      10.109.253.105   <none>        80/TCP                       7h52m\r\ndefault         service/kubernetes           ClusterIP      10.96.0.1        <none>        443/TCP                      20d\r\ndefault         service/tea-svc              ClusterIP      10.102.6.16      <none>        80/TCP                       7h52m\r\nkube-system     service/kube-dns             ClusterIP      10.96.0.10       <none>        53/UDP,53/TCP,9153/TCP       20d\r\nnginx-ingress   service/nginx-ingress        LoadBalancer   10.111.32.192    10.244.0.30   80:32132/TCP,443:32544/TCP   15d\r\n\r\n\r\n``",
      "category": "General",
      "created_at": "2021-06-17T19:30:28Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/1924",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 1918,
      "title": "How to connect to UDP and TCP port from outside of cluster using nginx ingress",
      "question": "I installed the nginx 1.12.0 using Helm charts where I enabled globalConfiguration.create: true and provided the listeners and also installed transport-server-tcp.yaml and transport-server-udp.yaml. Now, I am wondering, after doing all these, how can I simply reach to my endpoint ( UDP and TCP ) from outside the cluster using nginx ingress controller. I have created Service type for nginx controller as NodePort and trying to access my app using (One of worker node IP):5000  where 5000 is my udp & tcp port but it fails and that is obvious as I do not see any nodePort opened for 5000? \r\n\r\nAlso, is there a way to provide session affinity based on client IP to redirect all the traffic (UDP and TCP)from same client to one  pod only ?\r\n",
      "answer": "@Nish0808 can you post the output of your requests failing, with as much verbosity as possible?\r\nCan you also show us the transport.yaml file you configured so we can review?\r\nThank you.",
      "category": "Q&A",
      "created_at": "2021-08-31T15:10:36Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/1918",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 1873,
      "title": "Opening port25 in IKS without GlobalConfiguration and TransportServer to receive emails - Questions Clarification",
      "question": "Hello\r\nI am trying to set up email service in order to relay email in iks . Following approach reference earlier in email port forwarding (25) for GlobalConfiguration yaml , after creating deployment and service trying to create have this GlobalConfiguration configured in my cluster . It seems it is throwing an error \r\n\r\nno matches for kind \"GlobalConfiguration\" in version \"k8s.nginx.org/v1alpha1\"\r\n\r\nbelow is my yml config\r\n```\r\napiVersion: k8s.nginx.org/v1alpha1\r\nkind: GlobalConfiguration\r\nmetadata:\r\n  name: emailsever-test\r\n  namespace: emailsever\r\nspec:\r\n  listeners:\r\n  - name: postfix-tcp\r\n    port: 25\r\n    protocol: TCP\r\n```\r\n\r\nsame is happening when i am applying TransportServer yaml \r\n\r\nError below\r\nno matches for kind \"TransportServer\" in version \"k8s.nginx.org/v1alpha1\"\r\n\r\nBasic stuff i am trying to open port 25 , so question is without these 2 options as explained above for GlobalConfiguration and \r\nTransportServer would i be able to open port 25 or not? Need help here",
      "answer": "Hi @prempp \r\n\r\n> no matches for kind \"GlobalConfiguration\" in version \"k8s.nginx.org/v1alpha1\"\r\n> no matches for kind \"TransportServer\" in version \"k8s.nginx.org/v1alpha1\"\r\n\r\nMake sure that the the GlobalConfiguration and TransportServer CRDs are created in the cluster. Please see https://docs.nginx.com/nginx-ingress-controller/installation/installation-with-manifests/#create-custom-resources \r\n\r\n> Basic stuff i am trying to open port 25 , so question is without these 2 options as explained above for GlobalConfiguration and\r\nTransportServer would i be able to open port 25 or not? Need help here\r\n\r\nYes, that should work.  Additionally, if you use a Service to expose IC pods, you will also need to add port 25 on that service. For example:\r\n```yaml\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: nginx-ingress\r\n  namespace: nginx-ingress\r\nspec:\r\n  externalTrafficPolicy: Local\r\n  type: LoadBalancer\r\n  ports:\r\n  - port: 80\r\n    targetPort: 80\r\n    protocol: TCP\r\n    name: http\r\n  -  port: 443\r\n    targetPort: 443\r\n    protocol: TCP\r\n    name: https\r\n -  port: 25\r\n    targetPort: 25\r\n    protocol: TCP \r\n  selector:\r\n    app: nginx-ingress\r\n```",
      "category": "General",
      "created_at": "2021-07-07T18:53:22Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/1873",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 2108,
      "title": "Is SSL passthrough supported?",
      "question": "I found this old issue saying it is not supported and was wandering if thats still the case\r\n\r\nhttps://github.com/nginxinc/kubernetes-ingress/issues/492\r\n\r\nThanks in advance",
      "answer": "the TransportServer resource handles layer 4 TCP/UDP and is commonly used for generic passthrough use cases.\r\nhttps://docs.nginx.com/nginx-ingress-controller/configuration/transportserver-resource/\r\n\r\nSince no layer 7 capabilities around inspection or manipulation will be possible.",
      "category": "Q&A",
      "created_at": "2021-10-19T11:36:18Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/2108",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 2109,
      "title": "AppProtect function not work",
      "question": "**Describe the bug**\r\nI'm having an issue trying to enable appprotect.\r\n\r\n**To Reproduce**\r\n```\r\n  ## Support for App Protect\r\n  appprotect:\r\n    ## Enable the App Protect module in the Ingress Controller.\r\n    enable: true\r\n\r\n  ## Enable the custom resources.\r\n  enableCustomResources: true\r\n```\r\n\r\n**Expected behavior**\r\n```\r\n[root@master1 ~]# kubectl logs -n ingress-nginx-plus   pod/nginx-plus-ingress-nc4dj\r\nI1018 04:18:01.647935       1 main.go:195] Starting NGINX Ingress controller Version=v2.0.2-SNAPSHOT-bb8ec62 GitCommit=bb8ec62f683d4477ccf6de925c3b5b6902c77160 Date=2021-10-18T02:40:06Z PlusFlag=true\r\nI1018 04:18:01.660217       1 utils.go:163] Kubernetes version: 1.21.5\r\nI1018 04:18:01.665140       1 main.go:397] Using nginx version: nginx/1.21.3 (nginx-plus-r25)\r\nI1018 04:18:01.668937       1 manager.go:465] Starting AppProtect Agent\r\nF1018 04:18:01.669166       1 manager.go:469] Failed to start AppProtect Agent: fork/exec /opt/app_protect/bin/bd_agent: no such file or directory\r\n```\r\n\r\n**Your environment**\r\n* Version of the Ingress Controller : helm.sh/chart: nginx-ingress-0.11.2\r\n* Version of Kubernetes : v1.21.5\r\n* Kubernetes platform : Self deploy\r\n* Using NGINX or NGINX Plus : NGINX Plus\r\n\r\n**Additional context**\r\n`\r\nF1018 04:18:01.669166       1 manager.go:469] Failed to start AppProtect Agent: fork/exec /opt/app_protect/bin/bd_agent: no such file or directory\r\n`\r\n\r\n",
      "answer": "Hi @Wonderingkaho \r\n\r\ndid you enable App Protect in the command arguments? https://docs.nginx.com/nginx-ingress-controller/configuration/global-configuration/command-line-arguments/#-enable-app-protect",
      "category": "Q&A",
      "created_at": "2021-10-18T05:35:39Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/2109",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 1960,
      "title": "Load balancing to a backed websocket service using \"least_conn\"",
      "question": "Hi, I am trying to set up the ingress controller to load balance to a websocket backed svc using the \"least_conn\" algorithm for load balancing.\r\n\r\nTo being with, I have a service that accepts incoming websocket connections for clients. Kubeproxy is currently responsible for load balancing the incoming websocket requests across different service pods. Everything works fine with round-robin algorithm that Kubeproxy supports.\r\n\r\nNow I wanted to replace Kubeproxy with Nginx ingress controller for load balancing the websocket connections to my backend service pods. I configured all the moving parts necessary for Nginx and got websocket load balancing to work with Nginx ingress controller. However, I still see that the load balancing is still round-robin even though I configured the lb-method to \"least_conn\".  I am not sure if I missed a configuration that enables using different load balancing options. Any help is greatly appreciated.\r\n\r\nHere is the Ingress config.\r\n\r\n```\r\napiVersion: networking.k8s.io/v1\r\nkind: Ingress\r\nmetadata:\r\n name: mytest-ingress-nginx\r\n annotations:\r\n  nginx.org/websocket-services: \"mytest-svc\"\r\n  nginx.org/ssl-services: \"mytest-svc\"\r\n  nginx.org/lb-method: \"least_conn\"\r\nspec:\r\n ingressClassName: nginx\r\n tls:\r\n - hosts:\r\n   - \"testApp.westus2.cloudapp.azure.com\"\r\n   secretName: nginx-ingress-tls\r\n rules:\r\n - host: \"testApp.westus2.cloudapp.azure.com\"\r\n   http:\r\n    paths:\r\n    - path: /direct\r\n      pathType: Prefix\r\n      backend:\r\n       service:\r\n        name: mytest-svc\r\n        port:\r\n         number: 10443\r\n```",
      "answer": "@vebodank I believe we know what is going on and why you are seeing the different behavior between NGINX Ingress OSS and NGINX In gress Plus.\r\nWhat is happening is that it works fine for NGINX Ingress Plus, because NGINX Ingress Plus does not have to do a reload when upstreams are changed (brought down brought online) This can be done dynamically.\r\n\r\nWIth NGINX Ingress Open source, there has to be a reload when upstreams are changed. In your case, when you bring down one, then bring it back online.. That is important because when the reload occurs, there is a new set of worker processes that is spawned and is not aware of any current existing connections to the backend. (those connections are handled by the previous worker connections) \r\n\r\nThat said, when NGINX Ingress OSS is reloaded and the new 30 requests is sent in, NGINX Ingress OSS distributes those connections evenly across the three upstream pods.\r\nThat is why you are seeing this behavior in NGINX Ingress OSS and is different from NGINX Pus Ingress \r\n\r\nLet me know if that is helpful and answers your question.",
      "category": "Q&A",
      "created_at": "2021-09-13T17:42:03Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/1960",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 2564,
      "title": "How can I define a `limit_req_zone`?",
      "question": "\r\nI have this ingress file\r\n\r\n```\r\napiVersion: networking.k8s.io/v1\r\nkind: Ingress\r\nmetadata:\r\n  name: my-ingress\r\n  annotations:\r\n    cert-manager.io/cluster-issuer: \"letsencrypt-test\"\r\n    acme.cert-manager.io/http01-edit-in-place: \"true\"\r\n    nginx.org/location-snippets: |\r\n      limit_req zone=by_web;\r\nspec:\r\n  ingressClassName: nginx\r\n  rules:\r\n    - host: my.domain.com\r\n      http:\r\n        paths:\r\n          - path: /\r\n            pathType: Prefix\r\n            backend:\r\n              service:\r\n                name: my-service\r\n                port:\r\n                  number: 80\r\n  tls:\r\n    - hosts:\r\n        - my.domain.com\r\n      secretName: quickstart-example-tls\r\n```\r\n\r\nI was able to define a `limit_req` using `nginx.org/location-snippets`.\r\n\r\nHow can I define the `limit_req_zone`?\r\n\r\n```\r\nlimit_req_zone $request_uri zone=by_web:10m rate=60r/m;\r\n```\r\n\r\nRegards.",
      "answer": "Hi @juanpabloaj \r\n\r\n`limit_req_zone` is at the http level so you would need a `ConfigMap` with a `http-snippets`, you can find all the parameters and some examples [here](https://docs.nginx.com/nginx-ingress-controller/configuration/global-configuration/configmap-resource/#snippets-and-custom-templates).\r\n\r\nWe also have a `RateLimit` policy (if you want to use `VirtualServer` resources instead of `Ingress`) that simplifies using all the parameters. You can find the docs [here](https://docs.nginx.com/nginx-ingress-controller/configuration/policy-resource/#ratelimit).",
      "category": "Q&A",
      "created_at": "2022-03-29T21:23:13Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/2564",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 3213,
      "title": "Installation with Manifests file Ready & Available shows Zero",
      "question": "I'm following this [Link][1] to install `nginx-ingress-controller` on my bare metal server with `Kubernetes-v1.24.7`\r\n\r\nThe below commands i have executed as part of installation.\r\n\r\n```\r\n$ git clone https://github.com/nginxinc/kubernetes-ingress.git --branch v2.4.1\r\n$ cd kubernetes-ingress/deployments\r\n\r\n$ kubectl apply -f common/ns-and-sa.yaml\r\n$ kubectl apply -f rbac/rbac.yaml\r\n$ kubectl apply -f rbac/ap-rbac.yaml\r\n$ kubectl apply -f rbac/apdos-rbac.yaml\r\n\r\n$ kubectl apply -f common/default-server-secret.yaml\r\n$ kubectl apply -f common/nginx-config.yaml\r\n$ kubectl apply -f common/ingress-class.yaml\r\n\r\n$ kubectl apply -f daemon-set/nginx-ingress.yaml\r\n```\r\n\r\nI have followed `DaemonSet` method.\r\n\r\n```\r\n$ kubectl get all -n nginx-ingress\r\nNAME                      READY   STATUS    RESTARTS   AGE\r\npod/nginx-ingress-2pdf9   0/1     Running   0          44s\r\npod/nginx-ingress-pc5pp   0/1     Running   0          44s\r\npod/nginx-ingress-pzhdf   0/1     Running   0          44s\r\n\r\nNAME                           DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE\r\ndaemonset.apps/nginx-ingress   3         3         0       3            0           <none>          44s\r\n```\r\n\r\nFor all three `nginx-ingress` pods same error it shown.\r\n\r\n```\r\n$ kubectl describe pods nginx-ingress-2pdf9 -n nginx-ingress\r\nEvents:\r\n  Type     Reason     Age                 From               Message\r\n  ----     ------     ----                ----               -------\r\n  Normal   Scheduled  92s                 default-scheduler  Successfully assigned nginx-ingress/nginx-ingress-2pdf9 to worker-3\r\n  Normal   Pulled     91s                 kubelet            Container image \"nginx/nginx-ingress:2.4.1\" already present on machine\r\n  Normal   Created    91s                 kubelet            Created container nginx-ingress\r\n  Normal   Started    91s                 kubelet            Started container nginx-ingress\r\n  Warning  Unhealthy  72s (x22 over 91s)  kubelet            Readiness probe failed: HTTP probe failed with statuscode: 503\r\n\r\n```\r\n```\r\n$ kubectl logs -l app=nginx-ingress -n nginx-ingress\r\nW1028 07:34:38.940508       1 reflector.go:424] pkg/mod/k8s.io/client-go@v0.25.3/tools/cache/reflector.go:169: failed to list *v1alpha1.TransportServer: the server could not find the requested resource (get transportservers.k8s.nginx.org)\r\nE1028 07:34:38.940543       1 reflector.go:140] pkg/mod/k8s.io/client-go@v0.25.3/tools/cache/reflector.go:169: Failed to watch *v1alpha1.TransportServer: failed to list *v1alpha1.TransportServer: the server could not find the requested resource (get transportservers.k8s.nginx.org)\r\n```\r\nStill `READY` and `AVAILABLE` state showing `0`, Ideally it show `3` in both the categories. Please let me know what I'm missing here as part of installation?\r\n\r\nI suspect problem could be due to `--branch v2.4.1` version, So please let me know the supported version for my Kubernetes.\r\n\r\nAny help is appreciated.\r\n\r\n  [1]: https://docs.nginx.com/nginx-ingress-controller/installation/installation-with-manifests/",
      "answer": "Hi @mohanss08,\r\n\r\nWould you mind sharing the `daemon-set/nginx-ingress.yaml` if you have modified it?\r\n\r\nFrom your installation steps and error message, `the server could not find the requested resource (get transportservers.k8s.nginx.org)`. I am guessing that the Transport Server custom resource definition is missing from the cluster?\r\n\r\nFrom the same page you linked to:\r\n\r\n> Note: By default, it is required to create custom resource definitions for VirtualServer, VirtualServerRoute, TransportServer and Policy. Otherwise, the Ingress Controller pods will not become Ready. If you\u2019d like to disable that requirement, configure [-enable-custom-resources](https://docs.nginx.com/nginx-ingress-controller/configuration/global-configuration/command-line-arguments#cmdoption-global-configuration) command-line argument to false and skip this section.\r\n\r\nPlease create the required CRDs by following [2. Create Custom Resources](https://docs.nginx.com/nginx-ingress-controller/installation/installation-with-manifests/#create-custom-resources) in the documentation. Alternatively, if you are sure that you won't need those features provided by NGINX Ingress Controller, you can set the `-enable-custom-resources` command-line argument to `false` in your deployment YAML.\r\n",
      "category": "Q&A",
      "created_at": "2022-10-28T07:38:04Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/3213",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 4073,
      "title": "Fix listing issues reported by `staticcheck`",
      "question": "[Staticcheck](https://staticcheck.dev) reports following issues:\r\n\r\n```bash\r\n\u279c  kubernetes-ingress git:(main) staticcheck ./...\r\ninternal/certmanager/test_files/reactors.go:49:14: type assertion to the same type: createAction.GetObject() already has type runtime.Object (S1040)\r\ninternal/certmanager/test_files/util.go:26:2: rand.Seed has been deprecated since Go 1.20 and an alternative has been available since Go 1.0: Programs that call Seed and then expect a specific sequence of results from the global random source (using functions such as Int) can be broken when a dependency changes how much it consumes from the global random source. To avoid such breakages, programs that need a specific result sequence should use NewRand(NewSource(seed)) to obtain a random generator that other packages cannot access.  (SA1019)\r\ninternal/k8s/appprotect/app_protect_configuration.go:281:84: error strings should not be capitalized (ST1005)\r\ninternal/k8s/appprotect/app_protect_configuration.go:293:74: error strings should not be capitalized (ST1005)\r\ninternal/k8s/appprotect/app_protect_configuration.go:402:15: error strings should not be capitalized (ST1005)\r\ninternal/k8s/appprotect/app_protect_configuration.go:410:15: error strings should not be capitalized (ST1005)\r\ninternal/k8s/appprotect/app_protect_configuration.go:418:15: error strings should not be capitalized (ST1005)\r\ninternal/k8s/appprotect/app_protect_configuration.go:420:14: error strings should not be capitalized (ST1005)\r\ninternal/k8s/appprotect/app_protect_configuration.go:602:15: error strings should not be capitalized (ST1005)\r\ninternal/k8s/appprotect/app_protect_configuration.go:607:15: error strings should not be capitalized (ST1005)\r\ninternal/k8s/appprotect/app_protect_configuration.go:609:14: error strings should not be capitalized (ST1005)\r\ninternal/k8s/secrets/validation.go:47:10: error strings should not be capitalized (ST1005)\r\ninternal/k8s/secrets/validation.go:81:10: error strings should not be capitalized (ST1005)\r\ninternal/k8s/secrets/validation.go:84:10: error strings should not be capitalized (ST1005)\r\ninternal/k8s/secrets/validation.go:89:10: error strings should not be capitalized (ST1005)\r\ninternal/k8s/secrets/validation.go:115:10: error strings should not be capitalized (ST1005)\r\ninternal/k8s/secrets/validation.go:119:10: error strings should not be capitalized (ST1005)\r\ninternal/k8s/secrets/validation.go:152:9: error strings should not be capitalized (ST1005)\r\n```\r\n\r\nConsider this a QA issue.\r\n\r\n```bash\r\n\u279c  kubernetes-ingress git:(main) staticcheck --version\r\nstaticcheck 2023.1.3 (v0.4.3)\r\n```\r\n",
      "answer": "```shell\r\n\u279c  kubernetes-ingress git:(main) staticcheck --version\r\nstaticcheck 2025.1 (0.6.0)\r\n\u279c  kubernetes-ingress git:(main) staticcheck ./...\r\n```\r\n\r\nIt's fixed",
      "category": "General",
      "created_at": "2023-07-03T16:22:55Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/4073",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 6449,
      "title": "Replace deprecated functions and methods used in the code",
      "question": "Fix `staticcheck` errors:\r\n\r\n```shell\r\n\u279c  kubernetes-ingress git:(main) \u2717 staticcheck ./...\r\n```\r\n```shell\r\ninternal/certmanager/cm_controller.go:63:16: workqueue.RateLimitingInterface is deprecated: Use TypedRateLimitingInterface instead.  (SA1019)\r\ninternal/certmanager/cm_controller.go:93:35: workqueue.RateLimitingInterface is deprecated: Use TypedRateLimitingInterface instead.  (SA1019)\r\ninternal/certmanager/cm_controller.go:176:31: workqueue.RateLimitingInterface is deprecated: Use TypedRateLimitingInterface instead.  (SA1019)\r\ninternal/certmanager/test_files/reactors.go:49:14: type assertion to the same type: createAction.GetObject() already has type runtime.Object (S1040)\r\ninternal/externaldns/controller.go:34:16: workqueue.RateLimitingInterface is deprecated: Use TypedRateLimitingInterface instead.  (SA1019)\r\ninternal/externaldns/controller.go:65:54: workqueue.DefaultControllerRateLimiter is deprecated: Use DefaultTypedControllerRateLimiter instead.  (SA1019)\r\ninternal/externaldns/controller.go:200:31: workqueue.RateLimitingInterface is deprecated: Use TypedRateLimitingInterface instead.  (SA1019)\r\ninternal/externaldns/handlers.go:19:36: workqueue.RateLimiter is deprecated: RateLimiter is deprecated, use TypedRateLimiter instead.  (SA1019)\r\ninternal/externaldns/handlers.go:20:9: workqueue.NewItemExponentialFailureRateLimiter is deprecated: NewItemExponentialFailureRateLimiter is deprecated, use NewTypedItemExponentialFailureRateLimiter instead.  (SA1019)\r\ninternal/externaldns/handlers.go:26:8: workqueue.RateLimitingInterface is deprecated: Use TypedRateLimitingInterface instead.  (SA1019)\r\ninternal/k8s/status_test.go:93:17: cache.NewInformer is deprecated: Use NewInformerWithOptions instead.  (SA1019)\r\ninternal/k8s/status_test.go:153:17: cache.NewInformer is deprecated: Use NewInformerWithOptions instead.  (SA1019)\r\ninternal/k8s/status_test.go:214:23: cache.NewInformer is deprecated: Use NewInformerWithOptions instead.  (SA1019)\r\ninternal/k8s/status_test.go:321:23: cache.NewInformer is deprecated: Use NewInformerWithOptions instead.  (SA1019)\r\n```",
      "answer": "```shell\r\n\u279c  kubernetes-ingress git:(main) staticcheck --version\r\nstaticcheck 2025.1 (0.6.0)\r\n\u279c  kubernetes-ingress git:(main) staticcheck ./...\r\n\r\n```\r\n\r\n\r\nClosing as the issue was already addressed. `staticcheck` does not report issues.",
      "category": "General",
      "created_at": "2024-09-18T08:21:07Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/6449",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 6952,
      "title": "http-snippets on virtual server's",
      "question": "We have detected that the snippets which are part in http-snippets are being places without any context in the http-core and must be unique in all the virtualserver of the whole cluster. This being said leads me to wanting to block this feature since I don't want that virtualserver responsible persons can manipulate or open stuff which has impact on the whole nginx. Is there somebody else who have maybe the same issue? In my opinion there should be a possibility to do a configuration of the http-snippet but only triggered on base of configmap from nginx not being triggered by a virtualserver.",
      "answer": "```\r\napiVersion: k8s.nginx.org/v1\r\nkind: VirtualServer\r\nmetadata:\r\n  labels:\r\n    env: staging\r\n  name: gateway-vs\r\nspec:\r\n  host: staging.host.mycompany.ch\r\n  ingressClassName: nginx\r\n  routes:\r\n  - path: /gateway\r\n    route: staging-gateway/gateway-service-vsr\r\n  http-snippets: large_client_header_buffers 4 16k;\r\n  tls:\r\n    secret: \"\"\r\n```\r\n\r\nActually wanted to setup a new environment of this and noticed the error that nginx is telling me that the block large_client_header_buffers 4 16k; is only allowed once. Exactly this is why I'm concerned that someone could overwrite a global behaviour for others which don't know about this.",
      "category": "Q&A",
      "created_at": "2024-12-10T15:49:01Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/6952",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 6920,
      "title": "Functionality comparison to kubernete ingress-nginx",
      "question": "Hi, I tried to join slack channel but I couldn't as it seems to refuse my sign-up with any of my mail addresses (even my company one) I dunno what is the problem. is it possible to send me invitation ?\r\n\r\nI wanted to join to get real experiences from people who used both ingress-nginx and nginx-ingress-controller form F5. I want to migrate from ingress-nginx and I would like to find out what are functionalities I would miss using the F5 nginx-ingress-controller community version.",
      "answer": "Hi @sov-msaeed , have you tried `nginxcommunity.slack.com`? This is the F5/NGINX community slack. You are also more than welcome to join our community video calls (see the schedule in the README file).",
      "category": "General",
      "created_at": "2024-12-05T09:58:55Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/6920",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 6836,
      "title": "Issue with deployed rke2 second Ingress-Nginx Controller inside a Kubernetes cluster running on bare-metal.",
      "question": "We have deployed two Nginx ingress controller in our cluster. The first ingress controller works fine but we are facing issue with second one. When accessing the service through second ingress controller (http://x3.abc.com/sample), we get This site can\u2019t be reached x3.abc.com took too long to respond. error. We followed the same step as the first ingress controller including assigning different IP address using metallb and different ingress class in different namespace.\r\n\r\nDetails:\r\nRKE2 Version: v1.28.11\r\nKubernetes Version: Client Version: v1.30.3 Server Version: v1.28.11\r\nNGINX Ingress controller\r\n  Release:       v1.10.1-hardened1\r\n  Build:         git-b48c66a2f\r\n  Repository:    https://github.com/rancher/ingress-nginx\r\n  nginx version: nginx/1.25.3\r\n\r\nMetallb Version: v0.14.5\r\n\r\nFor testing purpose we deployed a simple nginx image using below yaml files. Everything is up and running, No error logs in pods\r\n, service mapped correct endpoints and ingress resource got external IP assigned by Second nginx ingress controller But when we try to access http://x3.abc.com/sample gives Site can't be reached error.\r\nDeployment.yaml\r\n![image](https://github.com/user-attachments/assets/6f04a397-17ed-4039-b6f8-f87361cb1c77)\r\n\r\nService.yaml\r\n![image](https://github.com/user-attachments/assets/b4d098e1-a96b-4fd7-89df-48cdb96d9d2c)\r\n\r\nIngress.yaml\r\n![image](https://github.com/user-attachments/assets/10f5a481-6fdd-49f8-9201-beeef7e90c34)\r\n\r\nWhen we change ingress class and host of the ingress resource with First ingress controller rest everything same then service is accessible via http://y3.abc.com/sample gives Welcome to Nginx\r\n\r\nIngress2.yaml\r\n![image](https://github.com/user-attachments/assets/5640e860-f6be-4227-a679-4e68e3bfbb26)\r\nwe would appreciate it if someone could help us to find out root cause of this issue. I am ready to provide any additional details if required. Thanks in advance!!",
      "answer": "Hi @Ganesh-hub-5, I believe you are referring to the [community ingress controller](https://github.com/kubernetes/ingress-nginx) based on your annotations and ingress controller version. This is a separate project to this so you can make an issue there for it.",
      "category": "Q&A",
      "created_at": "2024-11-21T06:05:35Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/6836",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 6579,
      "title": "Update nginx configuration to forward request to next service node on 503 response",
      "question": "Hi,\r\n\r\nWe have a case in which if a service pod returns 503 to nginx, we would like to forward the request to next service pod. We added below config to \"Ingress\" manifest in server snippets but it doesn't seem to work. Can someone pls let us know if this would work ? thank you. More details below. \r\n\r\n\r\n```\r\n\"metadata\": {\r\n    \"annotations\": {\r\n      \"nginx.org/server-snippets\":\"location /rest/v1/(abc|xyz)  \\n{\\n  proxy_next_upstream error http_503;\\n  proxy_next_upstream_tries 3;\\n}\r\n                             }\r\n                     }\r\n\r\n```\r\n      ",
      "answer": "Hey @dhatri308, are you looking to apply this directive to locations defined by Ingress object or custom location defined in `server-snippet`?\r\nPlease make sure you've enabled `-enable-snippets` flag in deployment before applying Ingress objects with snippets.\r\n\r\nIf you're looking for Ingress defined locations, then you should use `location-snippets` instead:\r\n```\r\napiVersion: networking.k8s.io/v1\r\nkind: Ingress\r\nmetadata:\r\n  name: cafe-ingress\r\n  annotations:\r\n    nginx.org/location-snippets: |\r\n      proxy_next_upstream error timeout http_503;\r\nspec:\r\n  ingressClassName: nginx\r\n  tls:\r\n  - hosts:\r\n    - cafe.example.com\r\n    secretName: cafe-secret\r\n  rules:\r\n  - host: cafe.example.com\r\n    http:\r\n      paths:\r\n      - path: /tea\r\n        pathType: Prefix\r\n        backend:\r\n          service:\r\n            name: tea-svc\r\n            port:\r\n              number: 80\r\n      - path: /coffee\r\n        pathType: Prefix\r\n        backend:\r\n          service:\r\n            name: coffee-svc\r\n            port:\r\n              number: 80\r\n\r\n```\r\nconf:\r\n```\r\n# configuration for default/cafe-ingress\r\nupstream default-cafe-ingress-cafe.example.com-coffee-svc-80 {zone default-cafe-ingress-cafe.example.com-coffee-svc-80 256k;\r\n        random two least_conn;\r\n        server 10.112.0.14:8080 max_fails=1 fail_timeout=10s max_conns=0;\r\n        server 10.112.1.8:8080 max_fails=1 fail_timeout=10s max_conns=0;\r\n}\r\n\r\nupstream default-cafe-ingress-cafe.example.com-tea-svc-80 {zone default-cafe-ingress-cafe.example.com-tea-svc-80 256k;\r\n        random two least_conn;\r\n        server 10.112.0.15:8080 max_fails=1 fail_timeout=10s max_conns=0;\r\n        server 10.112.1.9:8080 max_fails=1 fail_timeout=10s max_conns=0;\r\n        server 10.112.2.7:8080 max_fails=1 fail_timeout=10s max_conns=0;\r\n}\r\n\r\n\r\n\r\nserver {\r\n        listen 80;listen [::]:80;\r\n        listen 443 ssl;listen [::]:443 ssl;\r\n        ssl_certificate $secret_dir_path/default-cafe-secret;\r\n        ssl_certificate_key $secret_dir_path/default-cafe-secret;\r\n\r\n        server_tokens on;\r\n\r\n        server_name cafe.example.com;\r\n\r\n        set $resource_type \"ingress\";\r\n        set $resource_name \"cafe-ingress\";\r\n        set $resource_namespace \"default\";\r\n        if ($scheme = http) {\r\n         return 301 https://$host:443$request_uri;\r\n        }\r\n        location /tea {\r\n         set $service \"tea-svc\";\r\n         proxy_http_version 1.1;\r\n\r\n         proxy_next_upstream error timeout http_503;\r\n\r\n         proxy_connect_timeout 60s;\r\n         proxy_read_timeout 60s;\r\n         proxy_send_timeout 60s;\r\n         client_max_body_size 1m;\r\n         proxy_set_header Host $host;\r\n         proxy_set_header X-Real-IP $remote_addr;\r\n         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n         proxy_set_header X-Forwarded-Host $host;\r\n         proxy_set_header X-Forwarded-Port $server_port;\r\n         proxy_set_header X-Forwarded-Proto $scheme;\r\n         proxy_buffering on;\r\n         proxy_pass http://default-cafe-ingress-cafe.example.com-tea-svc-80;\r\n\r\n\r\n        }\r\n\r\n        location /coffee {\r\n         set $service \"coffee-svc\";\r\n         proxy_http_version 1.1;\r\n\r\n         proxy_next_upstream error timeout http_503;\r\n\r\n         proxy_connect_timeout 60s;\r\n         proxy_read_timeout 60s;\r\n         proxy_send_timeout 60s;\r\n         client_max_body_size 1m;\r\n         proxy_set_header Host $host;\r\n         proxy_set_header X-Real-IP $remote_addr;\r\n         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n         proxy_set_header X-Forwarded-Host $host;\r\n         proxy_set_header X-Forwarded-Port $server_port;\r\n         proxy_set_header X-Forwarded-Proto $scheme;\r\n         proxy_buffering on;\r\n         proxy_pass http://default-cafe-ingress-cafe.example.com-coffee-svc-80;\r\n\r\n\r\n        }\r\n\r\n}\r\n```\r\n",
      "category": "Q&A",
      "created_at": "2024-10-02T19:44:25Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/6579",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 6428,
      "title": "Memory spikes when (re)loading nginx configuration",
      "question": "Hi,\r\n\r\nwhenever nginx reload's it's configuration we see quite a large spike in memory-consumption for the pod.\r\nThe more reloads happen in a short timeframe the larger that spike is.\r\n\r\nI understand that is because of the way such a reload works (new worker processes, draining of existing processes etc).\r\n\r\nHowever I am a little surprised by the dimensions of that increase.\r\n\r\nHere is a screenshot of the memory-consumption of nginx pods when they are beeing replaced by other pods via a rolling update.\r\n(The behavior is very similar when just a config-reload is peformed)\r\n\r\n![image](https://github.com/user-attachments/assets/67d2d3a8-abd7-49b7-8dcf-f1d1f513c835)\r\n\r\nAs you can see the memory-usage of a pods spkies from <2GB to around ~10GB. A 5-fold increase.\r\n\r\nIs such a large increase really normal? Is there something going wrong?\r\n\r\nGiven that reloads might happen when nginx is under high load (and therefore autoscaling increases the number of nginx and backend pods) that can become an issue.\r\n\r\nHigh Load -> High Resource Usage -> Autoscaling triggers -> New Pods are created -> Config reload because of new pods -> Even higher Resource Usage because of the reloads.\r\n\r\n\r\nCurrently we have solved the issue by simply setting very high memory requests and limits (12GB).\r\nBut setting a 12 GB request for a pod that usually uses ~3GB of memory just feels wrong.\r\n",
      "answer": "Hi, \r\njust wanted to report back with some status updates.\r\n\r\nThe update to v3.7.0 improved the situation and reduced the frequency and size of memory spikes during reload.\r\nHowever we still hat very large memory-spikes now and then.\r\n\r\nUpdating to v3.7.1 however was (for whatever reason) a complete gamechanger!\r\nAfter the update to v3.7.1 memory-usage (during normal operations) dropped by 75(!!!)%.\r\nAlso memory spikes on reloads are barely noticable now.\r\nAdditionaly the values for the metric nginx_ingress_controller_nginx_last_reload_milliseconds dropped from ~8000 to ~1000.\r\n\r\nI have no idea what exactly changed with v3.7.1 compared to v3.7.0, but it drastically improved the whole situation for us.\r\n\r\nhttps://nginx.org/en/CHANGES mentions for v1.27.2: \"Feature: SSL certificates, secret keys, and CRLs are now cached on start or during reconfiguration.\"\r\nI already suspected it to be something with the CRLs. Maybe that feature helped out here?\r\n\r\n![image](https://github.com/user-attachments/assets/3c7d0569-591f-449f-a9c0-ab2738bd2b11)\r\n\r\n      \r\n",
      "category": "General",
      "created_at": "2024-09-16T12:03:53Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/6428",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 6742,
      "title": "Upstream prematurely closed connection while reading response header from upstream",
      "question": "Hi Team,\r\nI have deployed an OpenSearch cluster and am trying to access the service via ingress. However, I am getting an error in the NGINX ingress pod logs. The backend service is working fine, but when I access it via ingress, I receive this error. Can someone help me with this?\r\n\r\nThis is my ingress resource file\r\n\r\napiVersion: networking.k8s.io/v1\r\nkind: Ingress\r\nmetadata:\r\n  name: opensearch-dashboards-ingress\r\n  annotations:\r\n    nginx.ingress.kubernetes.io/rewrite-target: /\r\n    nginx.ingress.kubernetes.io/backend-protocol: \"HTTPS\" # Change to \"HTTPS\" if needed\r\n    nginx.ingress.kubernetes.io/force-ssl-redirect: \"true\"\r\n    nginx.ingress.kubernetes.io/client-body-buffer-size: \"8m\"\r\n    nginx.ingress.kubernetes.io/proxy-read-timeout: \"3600\"\r\n    nginx.ingress.kubernetes.io/proxy-send-timeout: \"3600\"\r\n    nginx.ingress.kubernetes.io/force-ssl-redirect: \"true\"\r\nspec:\r\n  ingressClassName: nginx\r\n  rules:\r\n    - host: opensearch-dashboard.example.com\r\n      http:\r\n        paths:\r\n          - path: /\r\n            pathType: Prefix\r\n            backend:\r\n              service:\r\n                name: my-first-dashboards\r\n                port:\r\n                  number: 5601\r\n\r\n\r\nError message:\r\n\r\n10.0.32.16 - - [01/Nov/2024:17:15:29 +0000] \"GET / HTTP/1.1\" 502 157 \"-\" \"curl/7.81.0\" \"-\"\r\n2024/11/01 17:15:32 [error] 153#153: *97 upstream prematurely closed connection while reading response header from upstream, client: \r\n\r\nThank you very much !",
      "answer": "Hi @anjanaprasd,\r\n\r\nThe annotations you are using in your Ingress resource are processed by the [ingress-nginx](https://github.com/kubernetes/ingress-nginx) project and does not relate to the ingress controller in this [project](https://github.com/nginxinc/kubernetes-ingress)\r\n\r\nCan you please provide the version of the ingress controller you are running? \r\nEither the top of your logs or the image you are using. \r\n",
      "category": "General",
      "created_at": "2024-11-01T17:39:03Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/6742",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 2520,
      "title": "VirtualServer and cert-manager incompatible?",
      "question": "Hi,\r\nWe recently switched to this ingress controller from the [Kubernetes nginx one](https://kubernetes.github.io/ingress-nginx/) so we could use Nginx plus and its authentication/authorization features.\r\n\r\nAfter having spent the last few days diving into a lot of documentation, logs, etc, I can only conclude that the `VirtualServer(Route)` resource types this project defines, are incompatible with the [cert-manager](https://github.com/cert-manager/cert-manager) project.\r\n\r\nTo get a secure VirtualServer resource, with a valid TLS certiciate from Let'sEncrypt, I would define something like this:\r\n```yaml\r\napiVersion: cert-manager.io/v1\r\nkind: Certificate\r\nmetadata:\r\n  name: cafe-tls\r\nspec:\r\n  dnsNames:\r\n    - cafe.example.com\r\n  issuerRef:\r\n    group: cert-manager.io\r\n    kind: ClusterIssuer\r\n    name: letsencrypt-prod\r\n  secretName: cafe-tls\r\n---\r\napiVersion: k8s.nginx.org/v1\r\nkind: VirtualServer\r\nmetadata:\r\n  name: cafe\r\nspec:\r\n  host: cafe.example.com\r\n  tls:\r\n    secret: cafe-tls\r\n  upstreams:\r\n  - name: tea\r\n    service: tea-svc\r\n    port: 80\r\n  routes:\r\n  - path: /tea\r\n    action:\r\n      pass: tea\r\n```\r\n\r\nDeploying the certificate will result in cert-manager creating an ingress to solve let'sencrypt's HTTP01 challenges (potentially sensitive values masked out):\r\n```yaml\r\napiVersion: networking.k8s.io/v1\r\nkind: Ingress\r\nmetadata:\r\n  annotations:\r\n    kubernetes.io/ingress.class: nginx\r\n    nginx.ingress.kubernetes.io/whitelist-source-range: 0.0.0.0/0,::/0\r\n  labels:\r\n    acme.cert-manager.io/http-domain: \"<masked>\"\r\n    acme.cert-manager.io/http-token: \"<masked>\"\r\n    acme.cert-manager.io/http01-solver: \"true\"\r\n  name: cm-acme-http-solver-f2gxv\r\n  namespace: cafe\r\n  ownerReferences:\r\n  - apiVersion: acme.cert-manager.io/v1\r\n    blockOwnerDeletion: true\r\n    controller: true\r\n    kind: Challenge\r\n    name: cafe-tls-ztb6n-<masked>-<masked>\r\nspec:\r\n  rules:\r\n  - host: cafe.example.com\r\n    http:\r\n      paths:\r\n      - backend:\r\n          service:\r\n            name: cm-acme-http-solver-nrthr\r\n            port:\r\n              number: 8089\r\n        path: /.well-known/acme-challenge/<masked>\r\n        pathType: ImplementationSpecific\r\n```\r\nThe challenge will never be validated however, because as soon as cert-manager creates the ingress, the following can be seen in the logs of the ingress controller:\r\n```\r\nI0321 12:54:40.550359       1 event.go:285] Event(v1.ObjectReference{Kind:\"Ingress\", Namespace:\"cafe\", Name:\"cm-acme-http-solver-4pmck\", UID:\"3c439fec-1ff0-47e6-a6af-f980896aae04\", APIVersion:\"networking.k8s.io/v1\", ResourceVersion:\"13526395\", FieldPath:\"\"}): type: 'Warning' reason: 'Rejected' All hosts are taken by other resources\r\n```\r\n\r\nWhen I delete the `VirtualServer/cafe` resource, and re-create the certificate, all is well, the challenge gets approved and the ingress is deleted again, and I can recreate the `VirtualServer/cafe` resource and have a working TLS-secured application.\r\n\r\nAt first I thought, OK, I can just modify our deployment pipeline to first deploy the certificate resource, and deploy the VirtualServer resource after the certificate was successfully validated, but then I thought about certificate renewal. Let'sencrypt issues certs with a 3-month validity, and cert-manager will take care of renewing the certificate shortly beforehand, but if that happens, it will need to create an ingress resource again, and we would be back in the same situation (because the VritualServer resource still exists).\r\n\r\nFor ingresses, this problem does not exist,  because one can add annotations to have cert-manager automatically create the certificate for them, and another annotation to instruct cert-manager to edit the existing ingress in-place instead of creating a new one. This would look like so:\r\n```yaml\r\napiVersion: networking.k8s.io/v1\r\nkind: Ingress\r\nmetadata:\r\n  name: cafe-ingress\r\n  annotations:\r\n    cert-manager.io/cluster-issuer: letsencrypt-prod #Instructs cert-manager to create the certificate resource itself\r\n    acme.cert-manager.io/http01-edit-in-place: \"true\" #Instructs cert-manager to edit this ingress resource (ingress/cafe-ingress) in-place to validate the letsencrypt challenge, instead of creating a new ingress resource\r\nspec:\r\n  tls:\r\n  - hosts:\r\n    - cafe.example.com\r\n    secretName: cafe-secret\r\n  rules:\r\n  - host: cafe.example.com\r\n    http:\r\n      paths:\r\n      - path: /tea\r\n        pathType: Prefix\r\n        backend:\r\n          service:\r\n            name: tea-svc\r\n            port:\r\n              number: 80\r\n```\r\n\r\nI doubt I'm the first person running into this, as using VirtualServer resources with cert-manager Certificate resources should be pretty basic thing to do to anyone using this ingress controller, so am I missing something?\r\n\r\nI found some issues which were more or less related:\r\n- #2069, especially [this comment](https://github.com/nginxinc/kubernetes-ingress/issues/2069#issuecomment-989971229) which seems to confirm cert-manager needs to be aware of the `VirtualServer` resource.\r\n- https://github.com/cert-manager/cert-manager/issues/3496 this issue was created before the comment in previous related issue (strangely enough), and seems to request a new feature in order to be able to deal with VirtualServer resources, however the request was rejected\r\n\r\nIn general, going to this ingress controller from the [Kubernetes nginx one](https://kubernetes.github.io/ingress-nginx/), seems like a downgrade, as these issues were not a problem with that one, even without using the `acme.cert-manager.io/http01-edit-in-place: \"true\"` annotation, everything worked, it seems that other ingress controller is able to deal with multiple ingresses using the same hostname",
      "answer": "Initial support for VirtualServer was added in https://github.com/nginxinc/kubernetes-ingress/releases/tag/v2.2.0",
      "category": "Q&A",
      "created_at": "2022-03-21T13:45:40Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/2520",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 6658,
      "title": "Possible bug? IP Whitelist not working in one environment but works in another",
      "question": "Hello all,\r\n\r\nI have two environments \"testing\" and \"qa\". I set nginx-ingress in my cluster using Helm with Terraform:\r\n\r\n```\r\nresource \"helm_release\" \"ingress\" {\r\n  name      = \"${var.environment}-ingress\"\r\n  namespace = kubernetes_namespace_v1.ingress_namespace.metadata[0].name\r\n  repository = \"https://kubernetes.github.io/ingress-nginx\"\r\n  chart     = \"ingress-nginx\"\r\n  version   = \"4.11.0\"\r\n  create_namespace = false\r\n  values = [templatefile(\"${path.module}/customValues.tftpl\", { lb_name = local.lb_name })]\r\n}\r\n```\r\n\r\nThen my customValues file is as follows:\r\n\r\n```\r\ncontroller:\r\n  allowSnippetAnnotations: true\r\n  service:\r\n    annotations:\r\n      service.beta.kubernetes.io/aws-load-balancer-type: external\r\n      service.beta.kubernetes.io/aws-load-balancer-name: ${lb_name}\r\n      service.beta.kubernetes.io/aws-load-balancer-backend-protocol: tcp\r\n      service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: \"true\"\r\n      service.beta.kubernetes.io/aws-load-balancer-scheme: internet-facing\r\n      service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: ip\r\n      service.beta.kubernetes.io/aws-load-balancer-healthcheck-port: \"10254\"\r\n      service.beta.kubernetes.io/aws-load-balancer-healthcheck-path: \"/healthz\"\r\n      service.beta.kubernetes.io/aws-load-balancer-healthcheck-interval: \"30\"\r\n      service.beta.kubernetes.io/aws-load-balancer-healthcheck-timeout: \"3\"\r\n      service.beta.kubernetes.io/aws-load-balancer-healthcheck-healthy-threshold: \"2\"\r\n      service.beta.kubernetes.io/aws-load-balancer-healthcheck-unhealthy-threshold: \"2\"\r\ningressShim:\r\n  enabled: true\r\n  ```\r\n  \r\n And then one of my ingresses is as follows:\r\n ```\r\n resource \"kubernetes_ingress_v1\" \"ingress_business_portal\" {\r\n  // we use external dns only if we don't have the CDN\r\n  wait_for_load_balancer = true\r\n\r\n  metadata {\r\n    name      = \"business-portal\"\r\n    namespace = local.business_portal_namespace\r\n    annotations = {\r\n      \"nginx.ingress.kubernetes.io/ssl-redirect\": true\r\n      \"nginx.ingress.kubernetes.io/from-to-www-redirect\": true\r\n      \"cert-manager.io/cluster-issuer\": \"${var.environment}-letsencrypt-cluster-issuer\"\r\n      \"cert-manager.io/renew-before\": \"360h\" // 15d\r\n      \"cert-manager.io/duration\": \"2160h\" // 90d\r\n      \"cert-manager.io/private-key-algorithm\": \"RSA\"\r\n      \"cert-manager.io/private-key-size\": 2048\r\n      \"cert-manager.io/private-key-encoding\": \"PKCS1\"\r\n      \"cert-manager.io/private-key-rotation-policy\": \"Always\"\r\n      \"cert-manager.io/common-name\": local.domain_environment,\r\n      \"nginx.ingress.kubernetes.io/whitelist-source-range\": local.full_ip_whitelist\r\n      \"external-dns.alpha.kubernetes.io/hostname\": var.is_cdn_enabled ? \"\" : \"${local.domain_environment},www.${local.domain_environment}\"\r\n      \"external-dns.alpha.kubernetes.io/ignore\": var.is_cdn_enabled ? \"true\": \"false\"\r\n    }\r\n\r\n    labels = {\r\n      app = \"business-portal\"\r\n    }\r\n  }\r\n  spec {\r\n    ingress_class_name = \"nginx\"\r\n\r\n    tls {\r\n      hosts = [local.domain_environment]\r\n      secret_name = local.cert_secret_name\r\n    }\r\n\r\n    rule {\r\n      host = local.domain_environment\r\n      http {\r\n        path {\r\n          path      = \"/\"\r\n          path_type = \"Prefix\"\r\n          backend {\r\n            service {\r\n              name = kubernetes_service_v1.business_portal_service.metadata[0].name\r\n              port {\r\n                number = 3000\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  timeouts {\r\n    create = \"5m\"\r\n    delete = \"5m\"\r\n  }\r\n}\r\n\r\n ```\r\n \r\nHowever, IP Whitelist works on QA but no in testing, even though when I retrieve the configmaps and describe both ingresses they seem equal. Has anyone faced something similar? The only thing that I can think of is that in the past I tried to enabled proxy protocol in testing but ended up giving up. I have tried \"kubectl rollout restart deployment testing-ingress-ingress-nginx-controller -n testing-ingress\" as well.\r\n\r\nThank you in advance and regards",
      "answer": "hi @javierguzman, it seems like you're using [community k8s ingress controller](https://github.com/kubernetes/ingress-nginx) but this repo is Nginx Ingress Controller.\r\nIf you'd like to migrate over, please have a look at https://docs.nginx.com/nginx-ingress-controller/installation/ingress-nginx/. for IP allow and block listing see https://docs.nginx.com/nginx-ingress-controller/configuration/policy-resource/#accesscontrol",
      "category": "Q&A",
      "created_at": "2024-10-15T09:20:36Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/6658",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 6534,
      "title": "Showing Unable to verify first certificate.",
      "question": "when user do any https request(destination port-443) I am converting it to port 81 as http resuest.From there I am doing some processing and after that I am converting the destination port to 443 again.So basically I am trying to decode https into http and again encoding it to https.But when I am sending any https request through postman First the request is getting converted to http as I am getting some log in my processing.But then I think some issue happening while converting the http to https as I am getting 502(Bad Gateway) response and It is showing unable to verify first certificate.I have the same certificate and key while decoding and encoding.Can any one please give some insights on this?It is very urgent for me to figure out.Thanks.",
      "answer": "Hi @sohagRudra, since you're not using Nginx Ingress Controller, may I suggest you open a discussion in official Nginx github repo please.\r\nhttps://github.com/nginx/nginx/discussions",
      "category": "Q&A",
      "created_at": "2024-09-30T05:31:04Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/6534",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 6595,
      "title": "NGINX Ingress Controller creates Load Balancer but no targets are added",
      "question": "I have set up the NGINX Ingress Controller on my Kubernetes cluster using the following configuration:\r\n\r\n```bash\r\nkubectl apply -f https://raw.githubusercontent.com/nginxinc/kubernetes-ingress/v3.7.0/deploy/crds.yaml\r\n...\r\nhelm install nginx-ingress-controller oci://ghcr.io/nginxinc/charts/nginx-ingress \\\r\n    --namespace gateway-system \\\r\n    --version \"$GATEWAY_CONTROLLER_VERSION\" \\\r\n    --set controller.service.type=LoadBalancer \\\r\n    --set controller.service.externalTrafficPolicy=Local \\\r\n    --set controller.config.use-proxy-protocol=true \\\r\n    --set controller.service.annotations.\"load-balancer\\.hetzner\\.cloud/type\"=\"External\" \\\r\n    --set controller.service.annotations.\"load-balancer\\.hetzner\\.cloud/name\"=\"$HETZNER_LOAD_BALANCER_NAME\" \\\r\n    --set controller.service.annotations.\"load-balancer\\.hetzner\\.cloud/location\"=\"$HETZNER_LOAD_BALANCER_LOCATION\" \\\r\n    --set controller.gatewayClassName=nginx-gateway-class \\\r\n    --set controller.metrics.enabled=true\r\n\r\n```\r\n\r\nWhile the Load Balancer is created successfully, there are no targets (worker nodes) being added to it. Even though there are worker nodes in the cluster, no traffic can reach them through the load balancer.\r\n\r\nI have manually added the targets myself, but as soon as I reinitialize the NGINX Ingress Controller, it removes the targets again.\r\n\r\nThis behavior is confusing, and I do not understand how the services are supposed to be exposed if the targets are consistently removed. Could you please provide clarification or guidance on why the NGINX Ingress Controller isn't properly associating targets with the load balancer?\r\n\r\nI intend to use the Gateway API to expose my services and have created the following resources accordingly:\r\n\r\n```yaml\r\n# Apply GatewayClass for NGINX Gateway\r\nkubectl apply -f - <<EOF\r\napiVersion: gateway.networking.k8s.io/v1\r\nkind: GatewayClass\r\nmetadata:\r\n  name: nginx-gateway-class\r\nspec:\r\n  controllerName: k8s.nginx.org/gateway-controller\r\nEOF\r\n\r\n# Verify the Gateway Controller service\r\nkubectl get services -n gateway-system || exit_on_error \"Error: Failed to retrieve services in gateway-system namespace.\"\r\n\r\n# Create the Gateway resource\r\nkubectl apply -f - <<EOF\r\napiVersion: gateway.networking.k8s.io/v1\r\nkind: Gateway\r\nmetadata:\r\n  name: example-gateway\r\n  namespace: gateway-system\r\nspec:\r\n  gatewayClassName: nginx-gateway-class\r\n  listeners:\r\n    - name: http\r\n      protocol: HTTP\r\n      port: 80\r\n      allowedRoutes:\r\n        namespaces:\r\n          from: All\r\nEOF\r\n```\r\n\r\nAnd right below I also attempted to create a custom service that I expect to be a target for the LoadBalancer service:\r\n\r\n```yaml\r\napiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: example\r\n  namespace: socials\r\nspec:\r\n  replicas: 1\r\n  selector:\r\n    matchLabels:\r\n      app: example\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: example\r\n      annotations:\r\n        kubernetes.io/change-cause: \"Updated deployment at $(date)\"\r\n    spec:\r\n      containers:\r\n        - name: example\r\n          image: yourusername/placeholder:example\r\n          imagePullPolicy: Always\r\n          ports:\r\n            - containerPort: 8080\r\n          readinessProbe:\r\n            httpGet:\r\n              path: /health\r\n              port: 8080\r\n            initialDelaySeconds: 5\r\n            periodSeconds: 10\r\n          resources:\r\n            requests:\r\n              cpu: \"100m\"\r\n              memory: \"1Gi\"\r\n            limits:\r\n              cpu: \"800m\"\r\n              memory: \"2Gi\"\r\n      imagePullSecrets:\r\n        - name: docker-registry-secret\r\n\r\n---\r\napiVersion: autoscaling/v2\r\nkind: HorizontalPodAutoscaler\r\nmetadata:\r\n  name: example\r\n  namespace: socials\r\nspec:\r\n  scaleTargetRef:\r\n    apiVersion: apps/v1\r\n    kind: Deployment\r\n    name: example\r\n  minReplicas: 1\r\n  maxReplicas: 3\r\n  metrics:\r\n    - type: Resource\r\n      resource:\r\n        name: cpu\r\n        target:\r\n          type: Utilization\r\n          averageUtilization: 80\r\n    - type: Resource\r\n      resource:\r\n        name: memory\r\n        target:\r\n          type: Utilization\r\n          averageUtilization: 80\r\n---\r\napiVersion: gateway.networking.k8s.io/v1\r\nkind: HTTPRoute\r\nmetadata:\r\n  name: example-route\r\n  namespace: socials\r\n  labels:\r\n    app: example\r\nspec:\r\n  parentRefs:\r\n    - name: example-gateway\r\n      namespace: gateway-system\r\n  rules:\r\n    - matches:\r\n        - path:\r\n            type: PathPrefix\r\n            value: \"/\"\r\n      backendRefs:\r\n        - name: example-service\r\n          port: 80\r\n---\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: example-service\r\n  namespace: socials\r\n  labels:\r\n    app: example\r\nspec:\r\n  selector:\r\n    app: example\r\n  ports:\r\n    - port: 80\r\n      targetPort: 8080\r\n  type: ClusterIP\r\n```\r\n\r\n**Request for Assistance:**\r\nCould you please provide clarification or guidance on the following?\r\n\r\n1. Why isn\u2019t the NGINX Ingress Controller properly associating targets with the LoadBalancer?\r\n2. What steps can I take to ensure my services are correctly exposed using the Gateway API?\r\n\r\nThank you",
      "answer": "Hi @wanGiB, thanks for opening a discussion. If you intent to use Gateway API, may I direct you to https://github.com/nginxinc/nginx-gateway-fabric, this is the native Gateway API integration by NGINX. You can also directly reach out on #nginx-gateway-fabric channel on community slack.\r\nWe will not be adding support for Gateway API in Nginx Ingress Controller.\r\n\r\n",
      "category": "Q&A",
      "created_at": "2024-10-05T08:08:58Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/6595",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 6292,
      "title": "Cannot proxy docker registry2 service",
      "question": "Unable to successfully proxy docker registry2 service ([Distribution Registry](https://distribution.github.io/distribution/)) using Ingress through ingress-controller, using NodePort type Service can work normally, using Ingress cannot work properly, and in I also have no problems with another cluster (using kubernetes/nginx-ingress). Did I miss something?\r\n\r\n![image](https://github.com/user-attachments/assets/e832306d-6b3a-4ca1-ac4e-c30b48fd913e)\r\n\r\nCluster: K8s v1.17\r\ningress controller\uff1anginx/nginx-ingress:1.12.4\r\nhelm chart: nginx-ingress-0.10.4\r\n\r\n/etc/nginx/conf.d/default-registry.conf\uff1a\r\n```nginx\r\n# configuration for default/registry\r\n\r\nupstream default-registry-registry.custom.be-registry-service-5000 {\r\n        zone default-registry-registry.custom.be-registry-service-5000 256k;\r\n        random two least_conn;\r\n\r\n        server 102.0.38.140:5000 max_fails=1 fail_timeout=10s max_conns=0;\r\n\r\n}\r\n\r\n\r\nserver {\r\n\r\n        listen 80;\r\n\r\n        server_tokens off;\r\n\r\n        server_name registry.custom.be;\r\n\r\n        set $resource_type \"ingress\";\r\n        set $resource_name \"registry\";\r\n        set $resource_namespace \"default\";\r\n\r\n        location / {\r\n                set $service \"registry-service\"; \r\n\r\n\r\n                proxy_http_version 1.1;\r\n\r\n\r\n                proxy_connect_timeout 60s;\r\n                proxy_read_timeout 60s;\r\n                proxy_send_timeout 60s;\r\n                client_max_body_size 1024m;\r\n                proxy_set_header Host $host;\r\n                proxy_set_header X-Real-IP $remote_addr;\r\n                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n                proxy_set_header X-Forwarded-Host $host;\r\n                proxy_set_header X-Forwarded-Port $server_port;\r\n                proxy_set_header X-Forwarded-Proto $scheme;\r\n                proxy_buffering on;\r\n\r\n                proxy_pass http://default-registry-registry.custom.be-registry-service-5000;\r\n\r\n        }\r\n}\r\n\r\n```\r\n\r\ndeployment.yaml:\r\n```yaml\r\napiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  labels:\r\n    app: registry\r\n  name: registry\r\n  namespace: default\r\nspec:\r\n  progressDeadlineSeconds: 600\r\n  replicas: 1\r\n  revisionHistoryLimit: 10\r\n  selector:\r\n    matchLabels:\r\n      app: registry\r\n  strategy:\r\n    type: Recreate\r\n  template:\r\n    metadata:\r\n      creationTimestamp: null\r\n      labels:\r\n        app: registry\r\n    spec:\r\n      affinity: {}\r\n      containers:\r\n      - env:\r\n        - name: REGISTRY_AUTH\r\n          value: htpasswd\r\n        - name: REGISTRY_AUTH_HTPASSWD_REALM\r\n          value: Registry Realm\r\n        - name: REGISTRY_AUTH_HTPASSWD_PATH\r\n          value: /auth/htpasswd\r\n        - name: REGISTRY_HTTP_SECRET\r\n          value: 4f3c2e1a5b6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2\r\n        image: registry:2.7.1\r\n        imagePullPolicy: IfNotPresent\r\n        name: registry\r\n        ports:\r\n        - containerPort: 5000\r\n          name: 5000tcp\r\n          protocol: TCP\r\n        resources: {}\r\n        terminationMessagePath: /dev/termination-log\r\n        terminationMessagePolicy: File\r\n        volumeMounts:\r\n        - mountPath: /var/lib/registry\r\n          name: registry-images\r\n        - mountPath: /auth\r\n          name: registry-auth\r\n      dnsPolicy: ClusterFirst\r\n      restartPolicy: Always\r\n      schedulerName: default-scheduler\r\n      securityContext: {}\r\n      terminationGracePeriodSeconds: 30\r\n      volumes:\r\n      - name: registry-images\r\n        persistentVolumeClaim:\r\n          claimName: pvc-registry-images2\r\n      - name: registry-auth\r\n        secret:\r\n          defaultMode: 420\r\n          secretName: registry-htpasswd\r\n```       \r\n\r\nservice and ingress\uff1a\r\n```\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: registry-service\r\n  namespace: default\r\nspec:\r\n  ports:\r\n  - name: port\r\n    port: 5000\r\n    protocol: TCP\r\n    targetPort: 5000\r\n  selector:\r\n    app: registry\r\n  sessionAffinity: None\r\n  type: ClusterIP\r\n---\r\napiVersion: extensions/v1beta1 \r\nkind: Ingress\r\nmetadata:\r\n  annotations:\r\n    nginx.org/client-max-body-size: 1024m\r\n  name: registry\r\n  namespace: default\r\nspec:\r\n  rules:\r\n  - host: registry.custom.be\r\n    http:\r\n      paths:\r\n      - backend:\r\n          serviceName: registry-service\r\n          servicePort:  5000\r\n        path: /\r\n```",
      "answer": "@ycyin \r\nWe're having some difficulties setting up an environment to properly test this issue on the version of Kubernetes you're using.\r\nI had tried to make a `kind` and a `minikube` cluster on k8s version 1.17, and I wasn't successful.\r\n\r\nI'll try to see if we can replicate this issue on a higher version of the product. This would mean we will be testing on `apiVersion: extensions/v1` of the `Ingress` resource.\r\n\r\nWe'll get back to you once we attempt to reproduce the issue.",
      "category": "Q&A",
      "created_at": "2024-08-27T02:37:07Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/6292",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 6284,
      "title": "Is there any start guide to work with EKS NLB?",
      "question": "I just want to start a new NLB that using my NGINX ingress controller, and getting health check fail issue.\r\nI don't really came to discussion to figure out how to resolve my problem, but better to understand what steps need to do from scratch.\r\nThe baseline I understand is:\r\n1. New EKS\r\n2. VPC CNI addon\r\n3. Install  aws-load-balancer-controller\r\n4. Install nginx ingress controller and annoation it to be NLB\r\n\r\nLet me know if one of this steps is wrong and where can I see basic configuration to start.",
      "answer": "Hi @davidt-gh,\r\n\r\nWhat version of NIC are you using?\r\n\r\nWhat type of health check are you using?\r\n\r\nCan you send us your logs to show the error. \r\n\r\n",
      "category": "Q&A",
      "created_at": "2024-08-25T09:07:24Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/6284",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 6077,
      "title": "404 on a parametered route in ASP.NET Web API",
      "question": "I have a parametered route, I don't know exactly what it is called generally, but instead of using query string like `http://localhost:8080/api/file?appId={appId}&key={key}`, we're using this `http://localhost:8080/api/file/{appId}/{key}`.\r\n\r\nThe ingress we created works fine on all of the Web API's endpoints but not with the parametered route. Here's the minion ingress for the service:\r\n\r\n```\r\napiVersion: networking.k8s.io/v1\r\nkind: Ingress\r\nmetadata:\r\n  name: myservice.ingress\r\n  namespace: myservice\r\n  annotations:\r\n    nginx.org/mergeable-ingress-type: \"minion\"\r\n    nginx.org/rewrites: \"serviceName=myservice-webapi rewrite=/\"\r\nspec:\r\n  ingressClassName: nginx\r\n  rules:\r\n  - host: mydomain.com\r\n    http:\r\n      paths:\r\n      - path: /serviceapi/myservice/\r\n         pathType: Prefix\r\n         backend:\r\n           service:\r\n             name: myservice-webapi\r\n             port:\r\n               number: 80\r\n```\r\n\r\nI can access all of the API endpoints through `https://mydomain.com/serviceapi/myservice/api/` aside from the `https://mydomain.com//serviceapi/myservice/api/file/{appId}/{key}` which returns a 404 error. Any idea how to fix this? Thanks!\r\n\r\nI'm trying to research about this but I'm lacking with the proper terms for this.",
      "answer": "It suddenly worked without changing anything. thanks!",
      "category": "Q&A",
      "created_at": "2024-07-28T12:16:58Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/6077",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 6214,
      "title": "Capture Client IP or Real IP when using AWS LB",
      "question": "Hello,\r\n\r\nI'm trying to capture and pass the Client IP or Real IP to the upstream. Below is my deployment model.\r\n\r\nClient -> AWS ALB -> Nginx-Ingress deployed on self managed K8s Cluster (1.30) on AWS EC2\r\n\r\nI tried using snippet\r\n\r\n```\r\n    nginx.org/location-snippets: |\r\n      proxy_set_header X-ABC-CLIENTIP $proxy_add_x_forwarded_for;\r\n```\r\n\r\nBut it is not capturing the real IP, rather giving the private IP. \r\nAlso, the header case is not retained. It is shown as `X-Abc-Clientip`\r\n\r\nAWS ALB gives real ip using X-Forwarded-For it seems. May I know how we can configure to use that header as is and get the real IP ? \r\n\r\nDoes anyone has experience on similar setup ? Any help is appreciated. Thanks. \r\n\r\n\r\n",
      "answer": "Hi @prawen, I will close this so we keep the discussion in https://github.com/nginxinc/kubernetes-ingress/issues/6228",
      "category": "Q&A",
      "created_at": "2024-08-15T16:58:03Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/6214",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 5957,
      "title": "Unable to route traffic for tcp protocol using nginx-ingress-controller from Private Link Service(Azure)",
      "question": "We have deployed nginx-ingress-controller using helm and override the tcp port using config map(overriding port for backend service) but its not able to listen on tcp port.\r\nIngress controller is able to listen on default port 443 and 80 but unable to listen on TCP port 5050(Custum port).\r\nFollowing is the defination for configmap(TCP protocol):-->\r\napiVersion: v1\r\nkind: ConfigMap\r\nmetadata:\r\n  name: tcp-services\r\n  namespace: nginx-ingress\r\ndata:\r\n  5050: \"default/xyz-svc:5050\"\r\n\r\nIngress.yaml:\r\n{{- if .Values.ingress.enabled }}\r\napiVersion: networking.k8s.io/v1\r\nkind: Ingress\r\nmetadata:\r\n  name: {{ .Values.deployment.name }}-ing\r\n  namespace: {{ .Values.deployment.namespace }}\r\n  annotations:\r\n    nginx.ingress.kubernetes.io/backend-protocol: \"HTTPS\"\r\nspec:\r\n  ingressClassName: nginx\r\n  tls:\r\n  - hosts:\r\n    - {{ .Values.ingress.hosts }}\r\n    secretName: {{ .Values.deployment.group }}-tls-secret\r\n  rules:\r\n  - host: {{ .Values.ingress.hosts }}\r\n    http:\r\n      paths:\r\n      - path: /\r\n        pathType: Prefix\r\n        backend:\r\n          service:\r\n            name: {{ .Values.ingress.backend.name }}\r\n            port: \r\n              number: {{ .Values.ingress.backend.port }} \r\n  {{- if .Values.ingress.revpxy.enabled }} \r\n  - host: {{ .Values.ingress.hosts }}\r\n    http:\r\n      paths:\r\n      - path: /\r\n        pathType: Prefix\r\n        backend:\r\n          service:\r\n            name: {{ .Values.ingress.backend.name }}\r\n            port: \r\n              number: {{ .Values.ingress.revpxy.backend.port }} \r\n            \r\n{{- end }}\r\n{{- end }}\r\n\r\n**Discription**: \r\nBased on ingress rule, we are routing traffic based on ingress host name for example if the hostname = xyz then it should route request to xyz-svc on port 5050 .\r\nAnd if the hostname = ABC then it should routhe request to ABC-svc on port 5050 .\r\n but we are not able to route request based on host name && getting connection timeout .\r\n\r\nWe are looking some support/suggestion on how to proceed further.\r\n\r\n\r\n        \r\n        ",
      "answer": "Hi @pandeyaws, can you confirm you are indeed using the NGINX Ingress Controller in this repo, and if so, can you please let me know the version you were using? I noticed that you were using the annotation `nginx.ingress.kubernetes.io/backend-protocol` which is not in our list of supported annotations. https://docs.nginx.com/nginx-ingress-controller/configuration/ingress-resources/advanced-configuration-with-annotations/\r\nAdditionally, as this is not a Helm chart we provided, to ensure that the issue is not related to Helm, could you please provide the generated ingress specification by using the command `kubectl describe ingress <name> -n <namespace>`?\r\nGenerally, if you need to open ports other than 80 and 443 on a cloud platform, you might want to refer to the platform's documentation for deploying a vendor-specific LoadBalancer, and ensure that the security and network policies are configured correctly to allow traffic on the custom port.\r\n",
      "category": "Q&A",
      "created_at": "2024-07-04T14:09:33Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/5957",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 5733,
      "title": "Location Snippets ignored when using Action.Return",
      "question": "I want to expose a robots.txt endpoint. This can be done quiet easily with the Action.Return. Additionally I want to add CORS Headers. As there doesn't seem to be an option for this I am using location-snippets. The issue is that the location snippet is ignored. Heres the config:\r\n\r\n```\r\napiVersion: k8s.nginx.org/v1\r\nkind: VirtualServer\r\nmetadata:\r\n  name: example.com\r\n  namespace: default\r\nspec:\r\n  host: example.com\r\n  routes:\r\n  - path: /robots.txt\r\n    action:\r\n      return:\r\n        body: |-\r\n          User-agent: *\r\n          Disallow: /\r\n        code: 200\r\n        type: text/plain\r\n    location-snippets: |\r\n      add_header 'Cache-Control' 'private, max-age=0' always;\r\n      add_header 'Cross-Origin-Resource-Policy' 'cross-origin' always;\r\n      add_header 'X-Content-Type-Options' 'nosniff' always;\r\n      add_header 'X-Xss-Protection' '1; mode=block' always;\r\n      add_header 'X-Frame-Options' 'SAMEORIGIN' always;\r\n      add_header 'Frame-Options' 'SAMEORIGIN' always;\r\n ```\r\nThe result using curl is:\r\n```\r\n> GET /robots.txt HTTP/2\r\n> Host: example.com\r\n> User-Agent: curl/8.6.0\r\n> Accept: */*\r\n> \r\n< HTTP/2 200 \r\n< server: nginx\r\n< date: Wed, 12 Jun 2024 07:46:11 GMT\r\n< content-type: text/plain\r\n< content-length: 25\r\n< \r\nUser-agent: *\r\n* Connection #0 to host example.com left intact\r\nDisallow: /%  \r\n```\r\n\r\nIt's simply missing within the rendered nginx.conf:\r\n\r\n```\r\n    location @return_0 {\r\n        default_type \"text/plain\";\r\n        # status code is ignored here, using 0\r\n        return 0 \"User-agent: *\r\nDisallow: /\";\r\n    }\r\n    \r\n    location /robots.txt {\r\n        set $service \"\";\r\n        status_zone \"\";\r\n\r\n        error_page 418 =200 \"@return_0\";\r\n        proxy_intercept_errors on;\r\n        proxy_pass http://unix:/var/lib/nginx/nginx-418-server.sock;\r\n        set $default_connection_header close;\r\n    }\r\n```\r\n\r\nI did enable the location-snippets flag and it works when using the proxy option:\r\n```\r\napiVersion: k8s.nginx.org/v1\r\nkind: VirtualServer\r\nmetadata:\r\n  name: example.com\r\n  namespace: default\r\nspec:\r\n  host: example.com\r\n  routes:\r\n    - action:\r\n        proxy:\r\n          upstream: nginx-app\r\n      location-snippets: |\r\n        add_header 'Cache-Control' 'private, max-age=0' always;\r\n        add_header 'Cross-Origin-Resource-Policy' 'cross-origin' always;\r\n        add_header 'X-Content-Type-Options' 'nosniff' always;\r\n        add_header 'X-Xss-Protection' '1; mode=block' always;\r\n        add_header 'X-Frame-Options' 'SAMEORIGIN' always;\r\n        add_header 'Frame-Options' 'SAMEORIGIN' always;\r\n      path: /\r\n  upstreams:\r\n    - name: nginx-app\r\n      port: 8080\r\n      service: nginx-app\r\n```\r\n\r\nThe location snippet is added to the nginx.conf\r\n```\r\n    location / {\r\n        set $service \"nginx-app\";\r\n        status_zone \"nginx-app\";\r\n        set $resource_type \"virtualserver\";\r\n        set $resource_name \"example.com\";\r\n        set $resource_namespace \"default\";\r\n        add_header 'Cache-Control' 'private, max-age=0' always;\r\n        add_header 'Cross-Origin-Resource-Policy' 'cross-origin' always;\r\n        add_header 'X-Content-Type-Options' 'nosniff' always;\r\n        add_header 'X-Xss-Protection' '1; mode=block' always;\r\n        add_header 'X-Frame-Options' 'SAMEORIGIN' always;\r\n        add_header 'Frame-Options' 'SAMEORIGIN' always;\r\n        \r\n...\r\n```\r\nI couldn't find any corresponding log entries to this. And I tried version 3.1 and 3.5 and they both do not work.\r\n\r\nCan anybody help?",
      "answer": "Hi @privateVoit, thanks for reporting. We believe this is a bug and plan to work on it. You can track progress [here](https://github.com/nginxinc/kubernetes-ingress/issues/5746).\r\n",
      "category": "Q&A",
      "created_at": "2024-06-12T07:58:47Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/5733",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 5823,
      "title": "Ingress controller custome load balancer name",
      "question": "Hi\r\nI am trying to deploy ingress nginx load balancer on aws eks cluster and controller version is 1.5.1. Its deployed successfully. Now i want to change random load balancer name to my custom name for that i am using annotation service.beta.kubernetes.io/aws-load-balancer-name: \"my-clb-name\". But this is not working . Can you please suggest why this is happening.\r\n",
      "answer": "Hi @prksh823 , could you please provide your deployment file? The controller version you provided (1.5.1) can suggest you are using community NGINX ingress controller (https://github.com/kubernetes/ingress-nginx), not NGINX Ingress Controller (this project).",
      "category": "General",
      "created_at": "2024-06-24T07:30:49Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/5823",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 5840,
      "title": "RBAC Permission Failures on Existing Cluster, replicasets and nodes?",
      "question": "Came back from a the weekend today and we're seeing a chunk of errors in our ingresscontroller, which is no longer processing traffic.  This isn't all of them, but they're all looking for replicaset and node rbac access.\r\n\r\nEX:\r\n\r\n- `Error collecting telemetry data: Replicas: replicasets.apps \"nginx-ingress-controller-86684cd77b\" is forbidden: User \"system:serviceaccount:nginx-ingress:nginx-ingress\" cannot get resource \"replicasets\" in API group \"apps\" in the namespace \"nginx-ingress\"`\r\n-  `Error collecting telemetry data: error generating InstallationID: replicasets.apps \"nginx-ingress-controller-86684cd77b\" is forbidden: User \"system:serviceaccount:nginx-ingress:nginx-ingress\" cannot get resource \"replicasets\" in API group \"apps\" in the namespace \"nginx-ingress\"`\r\n- `E0624 21:16:42.625628 1 collector.go:159] Error collecting telemetry data: Nodes: nodes is forbidden: User \"system:serviceaccount:nginx-ingress:nginx-ingress\" cannot list resource \"nodes\" in API group \"\" at the cluster scope`\r\n\r\nWe've got this same deployment mapped across eight environments but this is the only one failing, and after looking all day, we're at a loss.\r\n\r\nWe can see in the RBAC yaml in the repo that those permissions aren't deployed with the cluster, and as far as we know they aren't (shouldn't be?) required.\r\n\r\nStack is Azure Kubernetes, local accounts with Kubernetes RBAC.  \r\n\r\nAs far as we can tell from our logs, nothing changed.  We've redeployed the controller a few times but have been met with no success.\r\n\r\nDoes anyone in the community have any ideas here that might point us in the right direction?",
      "answer": "Just noticed we need to update this argument in the docs from `.telemetry` to `.telemetryReporting` But should be possible to find in the values.yaml file\r\n`controller.telemetryReporting.enable=false`",
      "category": "Q&A",
      "created_at": "2024-06-24T22:03:39Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/5840",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 5750,
      "title": "Failed to get nginx version: exit status 127",
      "question": "Hi,\r\n\r\nI installed nginx-ingress using helm, chart: 1.2.2 nginx-ingress version: 3.5.2\r\n\r\ncustom values:\r\n```\r\ncontroller:\r\n  kind: deployment\r\n  hostNetwork: false\r\n  ingressClass: \r\n    name: nginx-master\r\n  enableSnippets: true\r\n  nodeSelector:\r\n    node-role.kubernetes.io/master: \"true\"\r\n  service:\r\n    type: NodePort\r\n    spec:\r\n      externalTrafficPolicy: Local\r\n\r\nprometheus:\r\n  create: false\r\n```\r\nerror message:\r\n```\r\nI0614 04:13:47.751514       1 flags.go:316] Starting with flags: [\"-nginx-plus=false\" \"-nginx-reload-timeout=60000\" \"-enable-app-protect=false\" \"-enable-app-protect-dos=false\" \"-nginx-configmaps=ni-master/ni-master-nginx-ingress\" \"-\r\nI0614 04:13:47.754849       1 main.go:273] Kubernetes version: 1.29.4                                                                                                                                                                    \r\nF0614 04:13:47.759105       1 manager.go:357] Failed to get nginx version: exit status 127 \r\n```\r\nwhat could be causing the error?\r\n\r\n[source code](https://github.com/nginxinc/kubernetes-ingress/blob/v3.5.2/internal/nginx/manager.go#L357)\r\n\r\nI notice the following error:\r\n```bash\r\ntype=PROCTITLE msg=audit(1718351745.502:10267950): proctitle=2F7573722F7362696E2F6E67696E78002D76\r\ntype=SYSCALL msg=audit(1718351745.502:10267950): arch=c000003e syscall=10 success=no exit=-13 a0=7f722bd05000 a1=4000 a2=1 a3=7f722bb5c208 items=0 ppid=3960597 pid=3960617 auid=4294967295 uid=101 gid=101 euid=101 suid=101 fsuid=101 egid=101 sgid=101 fsgid=101 tty=(none) ses=4294967295 comm=\"nginx\" exe=\"/usr/sbin/nginx\" subj=system_u:system_r:container_t:s0:c202,c292 key=(null)\r\ntype=AVC msg=audit(1718351745.502:10267950): avc:  denied  { read } for  pid=3960617 comm=\"nginx\" path=\"/usr/lib/x86_64-linux-gnu/libc.so.6\" dev=\"dm-10\" ino=548935078 scontext=system_u:system_r:container_t:s0:c202,c292 tcontext=system_u:object_r:unlabeled_t:s0 tclass=file permissive=0\r\n\r\n```\r\n",
      "answer": "Hi,\r\n\r\nI managed to work around it by creating a selinux policy but I'm not sure why the target file is unlabeled.",
      "category": "Q&A",
      "created_at": "2024-06-14T04:16:02Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/5750",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 5534,
      "title": "Looking for annotation similar to \"nginx.ingress.kubernetes.io/auth-url\"",
      "question": "Hi, we migrating project from kubernetes/ingress-nginx/ to nginxinc/kubernetes-ingress. Stuck a bit with annotations:\r\n\"nginx.ingress.kubernetes.io/auth-url\"\r\n\"nginx.ingress.kubernetes.io/auth-response-headers\"\r\nSomehow cannot find analogs here. Need community help ",
      "answer": "Thx all, Below you can find solution that applied in our end and it probably will save someone's time:\r\nfor api clients ingress (service requires authorisation):\r\n```\r\nnginx.org/location-snippets: |\r\n      auth_request \"/someauth\"\r\n      auth_request_set $authHeader0 $upstream_header;\r\n      proxy_set_header 'x-some-header' $authHeader0;\r\n```\r\nfor api server ingress (config that provide authorisation):\r\n```\r\nnginx.org/server-snippets: |\r\n      location = /someauth{\r\n        internal;\r\n        proxy_set_header X-Auth-Request-Redirect $request_uri;\r\n        proxy_set_header X-Original-Method $request_method;\r\n        proxy_pass https://someserver.com/authpath;\r\n      }\r\n```",
      "category": "Q&A",
      "created_at": "2024-05-10T12:57:06Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/5534",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 5550,
      "title": "Nginx controller with many ingress files",
      "question": "Hello,\r\nin my production env I have an nginx controller with a single ingress file for all my customers. I have about 2k rules with a different host for each customer.\r\nI'm thinking about splitting it in one ingress file for each customer. Is there any limit to number of ingress files for an nginx controller?  Can I have 2000 ingress files for a single nginx controller?\r\n\r\nThank you in advance for your help.\r\n\r\nElia",
      "answer": "@epi82 you have a couple options. You can have one NGINX Ingress controller serving 100s to 1000s of ingress resource files.\r\nYou can even have multiple NGINX Ingress controller deployments to balance out the Ingress resources. (2 deployments hosting 500 ingress resources each). Gives you flexibility for maintenance/upgrades and reduces the blast radius if there is a problem (not all your eggs in one basket).\r\n\r\nWe do have customers with 1000s of resources being used with NGINX Ingress controller.\r\n\r\nHTH",
      "category": "Q&A",
      "created_at": "2024-05-14T20:30:09Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/5550",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 5576,
      "title": "How do I redirect to another domain name?",
      "question": "Hey there. I know I can use annotations to, say, redirect http to https. However, I need to redirect one domain to another. As it so happens I'm specifically wanting to redirect my www subdomain to my root domain, but I'm also curious how to do this more generally. Is there a way to do that without enabling snippets? For example, the k8s community nginx ingress controller has the annotation `nginx.ingress.kubernetes.io/from-to-www-redirect`. It also has more generic `nginx.ingress.kubernetes.io/permanent-redirect`.\r\n\r\nThanks for your help!",
      "answer": "@kyrofa Hello there! If you are using our CRD, you can do this quite easily with `action.redirect`:\r\n\r\nhttps://docs.nginx.com/nginx-ingress-controller/configuration/virtualserver-and-virtualserverroute-resources/#actionredirect\r\n\r\nif you are using Ingress resource, then yea, you would need to do use snippets or create a custom annotation.\r\nHTH",
      "category": "Q&A",
      "created_at": "2024-05-17T15:37:53Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/5576",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 4818,
      "title": "Nginx Ingress Controller on GKE Autopilot with Google Cloud Anthos (Istio and Envoy under the hood)",
      "question": "Hello everyone! I'm trying to configure nginx to work with istio's virtualservice to achieve **cookie-based canary deployment routing** and whenever I deploy manifests below I get 502 error in logs of ingress and nothing in istio-sidecar logs. My guess is that traffic from ingress is not sent via sidecar and therefore can't reach virtualservice.\r\nI know that config is very specific, and still kindly asking for a help with figuring out what part of it is wrong and hopeful to get a direction where to search for a solution.\r\n\r\nI use `nginx/nginx-ingress:3.3.2` ingress installed via helm and google's `gcr.io/gke-release/asm/proxyv2:1.16.7-asm.10` for the sidecar.\r\n\r\nHere below my manifests:\r\n\r\n<details>\r\n  <summary>How deployment and Virtualservers are configured</summary>\r\n\r\n## Main website helm rendered manifests:\r\n```yaml\r\n---\r\n# Source: example/charts/web/templates/deployment.yaml\r\napiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: web\r\n  labels:\r\n    helm.sh/chart: web-0.1.0\r\n    app.kubernetes.io/name: web\r\n    app.kubernetes.io/instance: example\r\n    app.kubernetes.io/version: \"1.0.0\"\r\n    app.kubernetes.io/managed-by: Helm\r\nspec:\r\n  strategy:\r\n    type: RollingUpdate\r\n    rollingUpdate:\r\n      maxSurge: 4\r\n      maxUnavailable: 1\r\n  selector:\r\n    matchLabels:\r\n      app.kubernetes.io/name: web\r\n      app.kubernetes.io/instance: example\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app.kubernetes.io/name: web\r\n        app.kubernetes.io/instance: example\r\n    spec:\r\n      serviceAccountName: example\r\n      containers:\r\n        - name: web\r\n          image: ghcr.io/examplerepo/web:v1\r\n          imagePullPolicy: IfNotPresent\r\n          envFrom:\r\n            - configMapRef:\r\n                name: web-configmap\r\n            - secretRef:\r\n                name: web-secret\r\n          ports:\r\n            - containerPort: 3000\r\n          startupProbe:\r\n            httpGet:\r\n              path: /probe/startup\r\n              port: 3000\r\n            failureThreshold: 6\r\n            periodSeconds: 45\r\n            timeoutSeconds: 15\r\n          livenessProbe:\r\n            httpGet:\r\n              path: /probe/live\r\n              port: 3000\r\n            periodSeconds: 30\r\n            timeoutSeconds: 7\r\n          readinessProbe:\r\n            httpGet:\r\n              path: /probe/ready\r\n              port: 3000\r\n            timeoutSeconds: 3\r\n          resources:\r\n            limits:\r\n              cpu: 2000m\r\n              ephemeral-storage: 16Gi\r\n              memory: 4Gi\r\n            requests:\r\n              cpu: 1000m\r\n              ephemeral-storage: 8Gi\r\n              memory: 2Gi\r\n---\r\n# Source: example/charts/canaryWeb/templates/deployment.yaml\r\napiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: canary-web\r\n  labels:\r\n    helm.sh/chart: web-0.1.0\r\n    app.kubernetes.io/name: web\r\n    app.kubernetes.io/component: canary\r\n    app.kubernetes.io/instance: example\r\n    app.kubernetes.io/version: \"1.0.0\"\r\n    app.kubernetes.io/managed-by: Helm\r\nspec:\r\n  selector:\r\n    matchLabels:\r\n      app.kubernetes.io/name: web\r\n      app.kubernetes.io/instance: example\r\n      app.kubernetes.io/component: canary\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app.kubernetes.io/name: web\r\n        app.kubernetes.io/instance: example\r\n        app.kubernetes.io/component: canary\r\n        version: canary\r\n    spec:\r\n      serviceAccountName: example\r\n      containers:\r\n        - name: canary-web\r\n          image: ghcr.io/examplerepo/web:v2\r\n          imagePullPolicy: IfNotPresent\r\n          envFrom:\r\n            - configMapRef:\r\n                name: canary-web-configmap\r\n            - secretRef:\r\n                name: canary-web-secret\r\n          ports:\r\n            - containerPort: 3000\r\n          startupProbe:\r\n            httpGet:\r\n              path: /probe/startup\r\n              port: 3000\r\n            failureThreshold: 6\r\n            periodSeconds: 45\r\n            timeoutSeconds: 15\r\n          livenessProbe:\r\n            httpGet:\r\n              path: /probe/live\r\n              port: 3000\r\n            periodSeconds: 30\r\n            timeoutSeconds: 7\r\n          readinessProbe:\r\n            httpGet:\r\n              path: /probe/ready\r\n              port: 3000\r\n            timeoutSeconds: 3\r\n          resources:\r\n            limits:\r\n              cpu: 2000m\r\n              ephemeral-storage: 16Gi\r\n              memory: 4Gi\r\n            requests:\r\n              cpu: 1000m\r\n              ephemeral-storage: 8Gi\r\n              memory: 2Gi\r\n---\r\n# Source: example/charts/web/templates/istionet.yaml\r\napiVersion: networking.istio.io/v1alpha3\r\nkind: DestinationRule\r\nmetadata:\r\n  name: web\r\n  labels:\r\n    helm.sh/chart: web-0.1.0\r\n    app.kubernetes.io/name: web\r\n    app.kubernetes.io/instance: example\r\n    app.kubernetes.io/version: \"1.0.0\"\r\n    app.kubernetes.io/managed-by: Helm\r\nspec:\r\n  host: web\r\n  subsets:\r\n    - name: main\r\n      labels:\r\n        version: main\r\n      trafficPolicy:\r\n        loadBalancer:\r\n          consistentHash:\r\n            httpCookie:\r\n              name: userAffinity=main\r\n              ttl: 3h\r\n    - name: canary\r\n      labels:\r\n        version: canary\r\n---\r\n# Source: example/charts/web/templates/virtualserver.yaml\r\napiVersion: k8s.nginx.org/v1\r\nkind: VirtualServer\r\nmetadata:\r\n  name: web\r\n  labels:\r\n    helm.sh/chart: web-0.1.0\r\n    app.kubernetes.io/name: web\r\n    app.kubernetes.io/instance: example\r\n    app.kubernetes.io/version: \"1.0.0\"\r\n    app.kubernetes.io/managed-by: Helm\r\nspec:\r\n  ingressClassName: nginx\r\n  host: www.example-website.com\r\n  tls:\r\n    redirect:\r\n      enable: true\r\n  upstreams:\r\n    - name: web\r\n      service: web\r\n      port: 80\r\n      use-cluster-ip: true\r\n  routes:\r\n    - path: ~ /settings\r\n      location-snippets: |\r\n        add_header        Content-Security-Policy  \"\" always;\r\n        add_header        X-XSS-Protection         \"1; mode=block\" always;\r\n        add_header        X-Content-Type-Options   \"nosniff\" always;\r\n        add_header        Referrer-Policy          \"strict-origin-when-cross-origin\" always;\r\n        add_header        X-Origin-Instance        \"gke\" always;\r\n        proxy_hide_header X-Frame-Options;\r\n      action:\r\n        proxy:\r\n          upstream: web\r\n          requestHeaders:\r\n            set:\r\n            - name: Host\r\n              value: web.staging.svc.cluster.local\r\n    - path: /\r\n      action:\r\n        proxy:\r\n          upstream: web\r\n          requestHeaders:\r\n            set:\r\n            - name: Host\r\n              value: web.staging.svc.cluster.local\r\n  server-snippets:   |-\r\n    sendfile                on;\r\n    tcp_nopush              on;\r\n    tcp_nodelay             on;\r\n    types_hash_max_size     2048;\r\n    types_hash_bucket_size  64;\r\n  \r\n    # Proxy tuning\r\n    proxy_buffer_size       256k;\r\n    proxy_buffers           4 512k;\r\n    proxy_busy_buffers_size 512k;\r\n    proxy_connect_timeout   180s;\r\n    proxy_read_timeout      180s;\r\n    proxy_send_timeout      180s;\r\n  \r\n    # SSL Tweaks\r\n    resolver                1.1.1.1 1.0.0.1 8.8.8.8 8.8.4.4 208.67.222.222 208.67.220.220 valid=60s;\r\n    resolver_timeout        2s;\r\n    ssl_buffer_size         4k;\r\n    ssl_protocols           TLSv1.3;\r\n    ssl_session_cache       shared:SSL:10m;\r\n    ssl_session_tickets     off;\r\n    ssl_session_timeout     1d;\r\n    # ssl_prefer_server_ciphers            off;\r\n    # ssl_stapling                         on;\r\n    # ssl_stapling_verify                  on;\r\n  \r\n    # Gzip compression tweaks\r\n    gzip              on;\r\n    gzip_buffers      16 8k;\r\n    gzip_comp_level   9;\r\n    gzip_http_version 1.1;\r\n    gzip_proxied      any;\r\n    gzip_types        text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss application/atom+xml image/svg+xml text/javascript;\r\n    gzip_vary         on;\r\n  \r\n    # CSP and HTTP tweaks\r\n    add_header        X-XSS-Protection         \"1; mode=block\" always;\r\n    add_header        X-Content-Type-Options   \"nosniff\" always;\r\n    add_header        X-Origin-Instance        \"gke\";\r\n    add_header        Referrer-Policy          \"strict-origin-when-cross-origin\" always;\r\n    # some other headers added\r\n\r\n    # Top level rules\r\n\r\n    location = / {\r\n      proxy_pass https://www.example-landing.com/homepage;\r\n      add_header X-Origin-Instance \"gke-next-static\";\r\n    }\r\n\r\n---\r\n# Source: example/charts/web/templates/istionet.yaml\r\napiVersion: networking.istio.io/v1alpha3\r\nkind: VirtualService\r\nmetadata:\r\n  name: web\r\n  labels:\r\n    helm.sh/chart: web-0.1.0\r\n    app.kubernetes.io/name: web\r\n    app.kubernetes.io/instance: example\r\n    app.kubernetes.io/version: \"1.0.0\"\r\n    app.kubernetes.io/managed-by: Helm\r\nspec:\r\n  hosts:\r\n    - web\r\n  http:\r\n    - match:\r\n        - headers:\r\n            Cookie:\r\n              regex: .*userAffinity=main.*\r\n      route:\r\n        - destination:\r\n            host: web\r\n            subset: main\r\n    - match:\r\n        - headers:\r\n            Cookie:\r\n              regex: .*userAffinity=canary.*\r\n      route:\r\n        - destination:\r\n            host: web\r\n            subset: canary\r\n    - route:\r\n        - destination:\r\n            host: web\r\n            subset: main\r\n          weight: 99\r\n        - destination:\r\n            host: web\r\n            subset: canary\r\n          weight: 1\r\n          headers:\r\n            response:\r\n              add:\r\n                Set-Cookie: userAffinity=canary; Max-Age=3600000\r\n\r\n---\r\n```\r\n\r\n</details>\r\n\r\n\r\n<details>\r\n  <summary>How nginx deployment is configured</summary>\r\n\r\n## NGINX with helm resulting yamls:\r\n\r\n```yaml\r\n---\r\n# Source: nginx-ingress/templates/controller-service.yaml\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: ingress-nginx-ingress-controller\r\n  namespace: ingress\r\n  labels:\r\n    helm.sh/chart: nginx-ingress-1.0.2\r\n    app.kubernetes.io/name: nginx-ingress\r\n    app.kubernetes.io/instance: ingress\r\n    app.kubernetes.io/version: \"3.3.2\"\r\n    app.kubernetes.io/managed-by: Helm\r\nspec:\r\n  externalTrafficPolicy: Local\r\n  loadBalancerIP: 28.48.48.40\r\n  type: LoadBalancer\r\n  ports:\r\n  - port: 80\r\n    targetPort: 80\r\n    protocol: TCP\r\n    name: http\r\n  - port: 443\r\n    targetPort: 443\r\n    protocol: TCP\r\n    name: https\r\n  selector:\r\n    app.kubernetes.io/name: nginx-ingress\r\n    app.kubernetes.io/instance: ingress\r\n---\r\n# Source: nginx-ingress/templates/controller-deployment.yaml\r\napiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: ingress-nginx-ingress-controller\r\n  namespace: ingress\r\n  labels:\r\n    helm.sh/chart: nginx-ingress-1.0.2\r\n    app.kubernetes.io/name: nginx-ingress\r\n    app.kubernetes.io/instance: ingress\r\n    app.kubernetes.io/version: \"3.3.2\"\r\n    app.kubernetes.io/managed-by: Helm\r\nspec:\r\n  replicas: 2\r\n  selector:\r\n    matchLabels:\r\n      app.kubernetes.io/name: nginx-ingress\r\n      app.kubernetes.io/instance: ingress\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app.kubernetes.io/name: nginx-ingress\r\n        app.kubernetes.io/instance: ingress\r\n      annotations:\r\n        prometheus.io/scrape: \"true\"\r\n        prometheus.io/port: \"9113\"\r\n        prometheus.io/scheme: \"http\"\r\n        sidecar.istio.io/inject: \"true\"\r\n        traffic.sidecar.istio.io/excludeInboundPorts: 80,443\r\n        traffic.sidecar.istio.io/excludeOutboundIPRanges: 10.42.42.0/22\r\n        traffic.sidecar.istio.io/includeInboundPorts: \"\"\r\n    spec:\r\n      serviceAccountName: ingress-nginx-ingress\r\n      automountServiceAccountToken: true\r\n      securityContext:\r\n        seccompProfile:\r\n          type: RuntimeDefault\r\n      terminationGracePeriodSeconds: 30\r\n      hostNetwork: false\r\n      dnsPolicy: ClusterFirst\r\n      containers:\r\n      - image: nginx/nginx-ingress:3.3.2\r\n        name: nginx-ingress\r\n        imagePullPolicy: \"IfNotPresent\"\r\n        ports:\r\n        - name: http\r\n          containerPort: 80\r\n          protocol: TCP\r\n        - name: https\r\n          containerPort: 443\r\n          protocol: TCP\r\n        - name: prometheus\r\n          containerPort: 9113\r\n        - name: readiness-port\r\n          containerPort: 8081\r\n        readinessProbe:\r\n          httpGet:\r\n            path: /nginx-ready\r\n            port: readiness-port\r\n          periodSeconds: 1\r\n          initialDelaySeconds: 0\r\n        resources:\r\n          requests:\r\n            cpu: 100m\r\n            memory: 128Mi\r\n        securityContext:\r\n          allowPrivilegeEscalation: false\r\n          readOnlyRootFilesystem: false\r\n          runAsUser: 101 #nginx\r\n          runAsNonRoot: true\r\n          capabilities:\r\n            drop:\r\n            - ALL\r\n            add:\r\n            - NET_BIND_SERVICE\r\n        env:\r\n        - name: POD_NAMESPACE\r\n          valueFrom:\r\n            fieldRef:\r\n              fieldPath: metadata.namespace\r\n        - name: POD_NAME\r\n          valueFrom:\r\n            fieldRef:\r\n              fieldPath: metadata.name\r\n        args:\r\n          - -nginx-plus=false\r\n          - -nginx-reload-timeout=60000\r\n          - -enable-app-protect=false\r\n          - -enable-app-protect-dos=false\r\n          - -nginx-configmaps=$(POD_NAMESPACE)/ingress-nginx-ingress\r\n          - -ingress-class=nginx\r\n          - -health-status=true\r\n          - -health-status-uri=/nginx-health\r\n          - -nginx-debug=false\r\n          - -v=1\r\n          - -nginx-status=true\r\n          - -nginx-status-port=8080\r\n          - -nginx-status-allow-cidrs=127.0.0.1\r\n          - -report-ingress-status\r\n          - -external-service=ingress-nginx-ingress-controller\r\n          - -enable-leader-election=true\r\n          - -leader-election-lock-name=ingress-nginx-ingress-leader-election\r\n          - -wildcard-tls-secret=ingress/example-website-wildcard-tls\r\n          - -enable-prometheus-metrics=true\r\n          - -prometheus-metrics-listen-port=9113\r\n          - -prometheus-tls-secret=\r\n          - -enable-service-insight=false\r\n          - -service-insight-listen-port=9114\r\n          - -service-insight-tls-secret=\r\n          - -enable-custom-resources=true\r\n          - -enable-snippets=true\r\n          - -include-year=false\r\n          - -disable-ipv6=false\r\n          - -enable-tls-passthrough=false\r\n\r\n          - -enable-preview-policies=false\r\n          - -enable-cert-manager=false\r\n          - -enable-oidc=false\r\n          - -enable-external-dns=false\r\n          - -ready-status=true\r\n          - -ready-status-port=8081\r\n          - -enable-latency-metrics=true\r\n---\r\n# Source: nginx-ingress/templates/controller-ingress-class.yaml\r\napiVersion: networking.k8s.io/v1\r\nkind: IngressClass\r\nmetadata:\r\n  name: nginx\r\n  labels:\r\n    helm.sh/chart: nginx-ingress-1.0.2\r\n    app.kubernetes.io/name: nginx-ingress\r\n    app.kubernetes.io/instance: ingress\r\n    app.kubernetes.io/version: \"3.3.2\"\r\n    app.kubernetes.io/managed-by: Helm\r\nspec:\r\n  controller: nginx.org/ingress-controller\r\n---\r\n```\r\n\r\n</details>\r\n\r\n",
      "answer": "I am not sure what Istio changed that is causing an incompatibility with the K8s Service object which would break any relationship for an ingress controller.\r\nThe VirtualService has a history of having a linkage to the Service object of the backend application.  Without the Service object any ingress controller does not know what Service to route the backend traffic to.  Which, historically, has been how Istio decided what Service to apply what VirtualService rules to (capture the traffic at the Istio side car at the ingress when sent to the Service IP).\r\n\r\nThe historic implementation from object to object is:\r\nclient -> Ingress -> Service -> VirtualService -> backend pods\r\nor from a component perspective:\r\nclient -> ingress controller -> service mesh -> backend service\r\n",
      "category": "Q&A",
      "created_at": "2023-12-19T07:59:55Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/4818",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 5158,
      "title": "Cert manager not working after nginx migration",
      "question": "Recently we have migrated from using Community maintained Kubernetes Controller to NIC (3.3.0)  and Nginx (1.25.2)\r\nPost that the Auto renewal of TLS Certificates is failing .  \r\nThe Http-01 challenges are failing with 404 or 403  errors.\r\n\r\n`Waiting for HTTP-01 challenge propagation: wrong status code '403', expected '200', Processing: true, Presented: true`\r\n\r\nDuring the time of renewal a new ingress for acme gets created  but looks like its not reachable from nginx and hence the request gets routed instead to cert-manager instead of the acme solver pod . \r\n\r\nCert manager Webhook logs - \r\nI1205 06:12:31.009927       1 dynamic_source.go:266] cert-manager/webhook \"msg\"=\"Updated cert-manager webhook TLS certificate\" \"DNSNames\"=[\"cert-manager-webhook\",\"cert-manager-webhook.cert-manager\",\"cert-manager-webhook.cert-manager.svc\"]\r\nI1208 11:21:07.746462       1 logs.go:59] http: TLS handshake error from 10.0.1.4:51434: EOF\r\n\r\nAs per most users, such issues occur because the challenge request cannot route to acme solver pod. How can I rule out nginx issue here ?\r\n",
      "answer": "Noticed my current ClusterIssuer has\r\n```\r\nspec:\r\n  acme:\r\n    email: <fghjkl>\r\n    preferredChain: \"\"\r\n    privateKeySecretRef:\r\n      name: letsencrypt\r\n    server: https://acme-v02.api.letsencrypt.org/directory\r\n    solvers:\r\n    - http01:\r\n        ingress:\r\n          class: nginx\r\n```\r\nand when I try to update it to\r\n`ingressClassName: nginx`\r\nI get ,  unknown field \"spec.acme.solvers[0].http01.ingress.ingressClassName\"    \r\n\r\n\r\nWhat is the right way to give class name in ClusterIssuer?\r\n\r\n (edited)",
      "category": "Q&A",
      "created_at": "2024-02-23T11:26:14Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/5158",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 5299,
      "title": "nginx ingress with client cert auth - cert-manager acme challenge",
      "question": "Hi All, I have been trying to do a auto renewal of lets encrypt certs using cert-manger through http acme challenge in nginx ingress where im doing auth-tls-verify-client. Since the endpoint is secured by client cert auth - it looks like challenge is not approved yet because the http call from cert-manger doesnt have the right Client cert to authenticate. Is there any way to just to allow cert-manger calls without client cert auth ? \r\n\r\nHere is my annotations: \r\n\r\n    cert-manager.io/cluster-issuer: letsencrypt-prod\r\n    kubernetes.io/ingress.class: nginx\r\n    nginx.ingress.kubernetes.io/auth-tls-secret: default/ca-bundle-secret\r\n    nginx.ingress.kubernetes.io/auth-tls-verify-client: 'on'\r\n    nginx.ingress.kubernetes.io/auth-tls-verify-depth: '2'\r\n    nginx.ingress.kubernetes.io/proxy-body-size: 512m\r\n    nginx.ingress.kubernetes.io/server-snippet: >\r\n      if ($ssl_client_i_dn !~ \"(CN=CNames)\")\r\n      {\r\n        return 403 \" 403 Forbidden - Wrong client cert\";\r\n      }\r\n    nginx.ingress.kubernetes.io/ssl-redirect: 'false' \r\n\r\nAny suggestion helps. Thanks!!",
      "answer": "@akaaabos could you please let us know if you use [kubernetes-ingress](https://github.com/nginxinc/kubernetes-ingress) project? ",
      "category": "General",
      "created_at": "2024-03-21T21:40:54Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/5299",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 5230,
      "title": "Static Private IP Possible?",
      "question": "I am currently supporting a team which is using the kubernetes-ingress (not plus) to set up ingress on services, and one of the issues we're come across is the private IP of the ingress pods can potentially change if the cluster reboots/updates - which breaks DNS resolution.\r\n\r\nWe found some deprecated config values that seem to point to this - but nothing current.  Is it possible to set a static private IP value for the ingress pods in the deployment.\r\n\r\nSetup:\r\n\r\n- Standard Nginx-Ingress\r\n- Azure Kubernetes Service - GCC High\r\n- Ingress is deployed into it's own namespace on our linux agentpool running CBL Mariner. ",
      "answer": "Hi @jordanabakerafs,\r\nI think you have found the correct annotation with that azure docs link.\r\n\r\n`service.beta.kubernetes.io/azure-load-balancer-internal: \"true\"`\r\n\r\nI want to point out that the Ingress controller in those azure docs is the community ingress controller.\r\n\r\nHowever this annotation will work for any ingress controller\r\n\r\nIf you are using helm you can add this annotation to the loadbalancer service in the NGINX Ingress Controller's helm chart\r\n```yaml\r\ncontroller:\r\n    service:\r\n        annotations:\r\n            service.beta.kubernetes.io/azure-load-balancer-internal: \"true\"\r\n```\r\n\r\nLet us know how you get on",
      "category": "Q&A",
      "created_at": "2024-03-11T15:49:37Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/5230",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 5100,
      "title": "Expose keyval timeouts for the OIDC integration via NIC's configmap & helm chart.",
      "question": "**Is your feature request related to a problem? Please describe.**\r\nWhen extending expiration duration for ID Token beyond 1 hour, the default OIDC configuration will delete the ID token from associated keyval zone after exactly 1 hour.\r\n\r\nRefresh of tokens (using refresh token) are not guaranteed to return ID Token (even if still active/expiration has not passed) - in the use-case that prompted this feature request - the IDP did not.\r\n\r\nThis effectively limited session duration to 1 hour before a re-login flow was required. \r\n\r\n**Describe the solution you'd like**\r\nExpose keyval timeouts found [here](https://github.com/nginxinc/kubernetes-ingress/blob/b5435238231570782e8e17df2c065e584d5a7ef2/internal/configs/oidc/oidc_common.conf#L21) as NIC configmap keys, and via helm values file key.\r\n\r\n**Describe alternatives you've considered**\r\nThis issue was resolved in the short term by adjusting and manually overriding the oidc_common.conf file in the NIC container using a configmap injected via volume mount.\r\n\r\nOther options included building custom NIC images, with that file adjusted with desired timeouts. \r\n\r\nBoth approaches are less convenient / require more ongoing maintaincence than configuration via configmap key / helm values file key.\r\n",
      "answer": "Hi @jo-carter \r\n\r\nWhen it comes to files in `/internal/configs/oidc` we don't ever modify or configure those files directly in this project.\r\nThese files are maintained and updated in the [nginx-openid-connect](https://github.com/nginxinc/nginx-openid-connect) repo. Any time there is an update to these files, we will sync those changes with our repo.\r\n\r\nThat being said, we do understand that there are some times use-cases that require updates to these files.\r\n\r\nThere are two main ways to go about this:\r\n1. Update the value you wish to update (in this case the timeout value for `oidc_access_token`) and then re-build the project.\r\nThis, of course, will require you to maintain your own build of the ingress controller, which might not be ideal. This is usually why we would recommend the 2nd option.\r\n\r\n2. We have a document [here](https://docs.nginx.com/nginx-ingress-controller/tutorials/oidc-custom-configuration/) which details how use a custom OIDC configuration. I would advise looking at that document and see if that approach fits this purpose. This option does **not** require you to build a custom image",
      "category": "General",
      "created_at": "2024-02-14T17:33:41Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/5100",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 2862,
      "title": "NGINX Inc Ingress Controller PHP-FPM support",
      "question": "Hello,\r\n\r\nAfter doing some research I found that the nginx inc ingress controller does not have php-fpm fastcgi support by default. I am trying to deploy wordpress php fpm container using the nginx ingress controller in my kubernetes cluster without using any intermediate nginx container as a passthrough for the fpm. But it will need server snippets to be enabled on the ingress controller which is not advised according to the nginx.org ingress controller documentations. The documentation asks for configuring everything through annotations but I am unable to find the suitable annotations for configuring my ingress resource to support fpm and just work with the wordpress phh fpm container. Any ideas suggestion regarding this will be very helpful. How do I achieve fpm pass through configuration without the use of server snippets and by only using ingress resource annotations?\r\n\r\nThank You.",
      "answer": "Snippets are required to unlock some capabilities of NGINX Ingress Controller.\r\nThe message about snippets is a cautionary warning, that if the deployment has snippets enabled that anyone with access to your K8s API and the Ingress or NGINX Ingress Controller CRDs (any K8s admin) could introduce a malicious configuration.  That is all.  A note to you to take proper precautions.\r\n\r\nIn this case, only include the additional functionality that is necessary - only those settings in the proper context of either the Ingress or Virtual Server resource.\r\n\r\nUsing the VirtualServer resource is the easiest way to introduce the snippets you mention: https://docs.nginx.com/nginx-ingress-controller/configuration/virtualserver-and-virtualserverroute-resources/#using-snippets\r\n",
      "category": "Q&A",
      "created_at": "2022-07-16T15:42:42Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/2862",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 5101,
      "title": "Support for ECDSA ciphers",
      "question": "Hello,\r\n\r\nI would like to have my NIC release configuration as:\r\n```\r\ncontroller:\r\n  config:\r\n    entries:\r\n      ssl-ciphers: \"ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384\"\r\n```\r\n\r\nI've got also my VirtualServer configured this way:\r\n```\r\nspec:\r\n  cert-manager:\r\n    cluster-issuer: my-issuer\r\n```\r\n\r\nRight now only 3/6 ciphers are working (RSA) and afaik the reason is that certificate generated by VirtualServer is an RSA certfiicate (`Signature Algorithm: sha256WithRSAEncryption`). \r\n\r\nWhat I would like to do is to add 2nd certificate for ECDSA. **I've got one idea (below) but before I'll implement I wanted to ask you is there any simpler way to do it? (maybe I'm missing something)**\r\n\r\nMy idea is to use https://github.com/nginxinc/kubernetes-ingress/tree/v3.4.2/examples/shared-examples/custom-templates and somehow (not sure yet how) add to the virtualserver-template another ssl_certificate and ssl_certificate_key (before create on my side ecdsa certificate - https://cert-manager.io/docs/faq/#is-ecc-elliptic-curve-cryptography-supported). As you can see it is quite complicated - much better will be to have possibility:\r\n* to add to VS (.spec.tls) array of tls definitions\r\n* to add to VS (.spec.tls.cert-manager) privateKey.algorythm  \r\n ",
      "answer": "@mariusz-gomse-centra Hello there.\r\n\r\nJust a small note:\r\n```\r\nis that certificate generated by VirtualServer is an RSA certfiicate\r\n```\r\n\r\nWe do not actually generate the certificate. That would be the provider generating the certificate. In this case you are using cert-manager.\r\nWe just \"load in\" the certificate into the server block and use the NGINX `ssl_` directives for the .cert and .key. For this scenario, it sounds like you want a ECDSA cert (second cert) to be used within your `virtualServer` resource.\r\n\r\nI am assuming you want to have two entires for `ssl_certificate` and `ssl_certificate_key` in your `server` block, the second cert focused for elliptical curve support?\r\nIf your goal is to support multiple certificates, this would be a request for enhancement (RFE) for `virtualServer` resource to support multiple certificates in the .yaml syntax.\r\n\r\nThe way you have it now using snippets, would be the current way to implement your goal.\r\n\r\nLet me know if that helps.\r\n",
      "category": "Q&A",
      "created_at": "2024-02-15T06:28:40Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/5101",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 5052,
      "title": "Should we align NGINX Ingress Controller Defaults with NGINX Defaults. And if so, how?",
      "question": "In issue #5050 , it was pointed out that we don't follow NGINX defaults for `keepalive_timeout` and `keepalive_requests`. We currently default to `65` and `100` respectively for these values whereas NGINX defaults to `75` and `1000` since 1.19.\r\n\r\nThe reason we do not follow the default, is because we hardcode these values in NIC, and add `keepalive_timeout` and `keepalive_requests` to the config irrespective of whether the user has specified them.\r\n\r\nConsidering the substantial increase in `keepalive_requests` could be more than a modest adjustment, should we update our this new defuault to align with NGINX's? \r\n\r\nAdditionally, should we consider not setting these directives unless specified by the user, allowing for NGINX's latest defaults to always take precedence if undefined by the user ([rather than us updating this struct of defaults](https://github.com/nginxinc/kubernetes-ingress/blob/50b936382a5451d961a964d184ae850a0f5c29e9/internal/configs/config_params.go#L175C1-L207C38))?\r\n",
      "answer": "I'm not an advanced nginx user by any means. I'm coming to this project with pretty fresh eyes, as I'm deploying NIC into my clusters.\r\n\r\nThe problem I ran in to in the issue above was solely based on assumptions, and I'd like to flavor some insight as a new user coming to this project, as I'm sure I am not the only one with these assumptions.\r\n\r\nMy view on the NIC is that it is simply nginx wrapped into the Kubernetes environment. nginx for K8s.\r\nWith that said, I would assume that the nginx docs are the source of truth, and that the NIC simply provides a k8s native way to deploy and assume nginx. \r\n\r\nUsing the configmap to configure nginx is the k8s way to turn the knobs on what would otherwise be the nginx.conf file. Anything not set in the conf file would simply fall back on the nginx config defaults laid out in the nginx documentation.\r\n\r\nHowever, I've come to realize that isn't true and that there is config drift due to defaults being set in the NIC configmap. I can't really treat the nginx docs as the source of truth anymore, and now must treat the NIC configmap docs as that.\r\n\r\nI understand the world isn't perfect and that there are most likely differences and that it's ok to just switch up the mental model and refer to those docs instead, it just makes it harder to find an answer sometimes when most internet searching points to nginx directly, where as now those results simply have an asterisk next to them and must be double checked against the NIC documentation.\r\n\r\nAnyways, it would be great to more easily opt the NIC into the nginx defaults so that it can more easily benefit from the main project's decisions, which would allow the NIC to directly benefit from those, as they undoubtedly have more inertia behind them.\r\n\r\nHopefully this insight is helpful! Great work on the project and overall am super happy with it!",
      "category": "General",
      "created_at": "2024-02-08T14:48:26Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/5052",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 4847,
      "title": "Minio web console redirects to random high port",
      "question": "I deployed Minio on my Kubernetes cluster. The cluster is setup with Talos, 6 nodes, 3 workers. I setup MetalLB and Nginx-ingress controller. For the latter I followed the blog on Nginx website that sets up cert-manager along the way. I also followed along with the cafe test. This all works fine.\r\n\r\nNext I setup NFS storage using `nfs-subdir-external-provisioner` installed via Helm. I tested that with a pod and pvc and also seems to work fine.\r\n\r\nFInally, I setup Minio. I adapted the manifest to deploy it in its own namespace and use a pvc I prepared. The latter works also, I can see the directories and files for Minio config being created. Minio starts,  describe shows no weird events. On a sidenote, it gets a certificate! \ud83d\ude04 \r\n\r\nNow, when I access the Minio gui, it loads for a second or two and shows a page not found. In the address bar, it redirected to some high port, `https://minio.svc.k8s.domain.net:40625/`.\r\n\r\nWhen I force it to the login page, `https://minio.svc.k8s.privatebits.net/login`, it does not redirect but shows me the following (and loads instantly):\r\n```\r\n<Error>\r\n<Code>AccessDenied</Code>\r\n<Message>Access Denied.</Message>\r\n<BucketName>login</BucketName>\r\n<Resource>/login</Resource>\r\n<RequestId>17A5EF7AD1AEB59C</RequestId>\r\n<HostId>dd9025bab4ad464b049177c95eb6ebf374d3b3fd1af9251148b658df7ac2e3e8</HostId>\r\n</Error>\r\n```\r\nAs for logging, this is the important parts that I see. The ingress-controller logs shows  `GET /login HTTP/1.1\" 403 289` when I force the login page. When it redirects it shows `GET / HTTP/1.1\" 307 78`.\r\n\r\nI can post all the manifests etc, but that would create a monster post that nobody wants to plow through. Figured I would post this first and see what extra information is required. At this point Im not sure what would be useful.\r\n\r\nHopefully someone can help me troubleshoot this so I learn something and can proceed. I'm kind of stuck at the moment not because I need Minio perse, but I need to migrate a whole bunch of Docker containers from a standalone host to this cluster that will suffer the same if I don't understand this.\r\n\r\nThanks in advance, wouild really appreciate some assistance \ud83d\ude3a .",
      "answer": "Strictly speculation.\r\nBut I would guess that https://minio.svc.k8s.domain.net:40625/ represents the minio service itself being published as NodePort and not behind the ingress controller.\r\n\r\nWe would need to see your configuration resources.\r\n\r\nI am assuming that you should have this traffic flow:\r\nclient -> metallb -> ingress controller -> minio\r\n\r\nWhich means that the ingress controller should have an Ingress or VirtualServer resource configured with the hostname minio.svc.k8s.domain.net and some port (assume 80/443 by default)\r\n",
      "category": "Q&A",
      "created_at": "2023-12-31T14:14:30Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/4847",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 4791,
      "title": "IP whitelisting with Cert Manager",
      "question": "Hello!\r\n\r\nI have a tricky issue here. I am trying to enable IP whitelisting for my staging instances, but the issue is that, the IP whitelisting is also applied to the `/.well-known/acme-challenge/...` path, which has to be publicly accessible. I've spent some time on that I could not find any solution to this.\r\n\r\nThis is the relevant ingress annotation\r\n```\r\n        nginx.org/location-snippets: |\r\n          proxy_next_upstream error timeout http_502 http_503;\r\n          allow x.x.x.x;\r\n          deny all;\r\n``` \r\n\r\nAnd it generates this config file:\r\n```\r\n# configuration for previews/preview-onboarding\r\n\r\nupstream previews-...-cm-acme-http-solver-hhtdt-8089 {\r\n\tzone previews-...-cm-acme-http-solver-hhtdt-8089 256k;\r\n\trandom two least_conn;\r\n\r\n\tserver 10.224.0.24:8089 max_fails=1 fail_timeout=10s max_conns=0;\r\n\r\n}\r\nupstream previews-...-80 {\r\n\tzone previews-...-80 256k;\r\n\trandom two least_conn;\r\n\r\n\tserver 10.224.0.86:8080 max_fails=1 fail_timeout=10s max_conns=0;\r\n\tserver 10.224.0.17:8080 max_fails=1 fail_timeout=10s max_conns=0;\r\n\tserver 10.224.2.111:8080 max_fails=1 fail_timeout=10s max_conns=0;\r\n\r\n}\r\n\r\n\r\nserver {\r\n\r\n\r\n\r\n\tlisten 80;\r\n\tlisten [::]:80;\r\n\r\n\tlisten 443 ssl;\r\n\tlisten [::]:443 ssl;\r\n\r\n\r\n\tssl_certificate /etc/nginx/secrets/previews-preview-tls;\r\n\tssl_certificate_key /etc/nginx/secrets/previews-preview-tls;\r\n\r\n\tserver_tokens on;\r\n\r\n\tserver_name ...preview.....io;\r\n\r\n\tset $resource_type \"ingress\";\r\n\tset $resource_name \"preview-onboarding\";\r\n\tset $resource_namespace \"previews\";\r\n\r\n\r\n\tif ($scheme = http) {\r\n\t\treturn 301 https://$host:443$request_uri;\r\n\t}\r\n\r\n\r\n\r\n\tlocation /.well-known/acme-challenge/... {\r\n\t\tset $service \"cm-acme-http-solver-hhtdt\";\r\n\r\n\r\n\t\tproxy_http_version 1.1;\r\n\r\n\r\n\t\tproxy_next_upstream error timeout http_502 http_503;\r\n\t\tallow x.x.x.x;\r\n\t\tdeny all;\r\n\r\n                ....\r\n\r\n\t\tproxy_pass http://previews-...-80;\r\n\r\n\r\n\t}\r\n\tlocation / {\r\n\t\tset $service \"preview-...\";\r\n\r\n\r\n\t\tproxy_http_version 1.1;\r\n\r\n\t\tproxy_set_header Upgrade $http_upgrade;\r\n\t\tproxy_set_header Connection $connection_upgrade;\r\n\r\n\t\tproxy_next_upstream error timeout http_502 http_503;\r\n\t\tallow x.x.x.x;\r\n\t\tdeny all;\r\n\r\n                ...\r\n\r\n\r\n\t\tproxy_pass http://previews-preview-...-80;\r\n\r\n\r\n\t}\r\n\r\n\r\n}\r\n```\r\n\r\nAny ideas, how to deny specified ips for \"/\" but allow them for \" /.well-known/acme-challenge/...\"? Thanks!\r\n\r\nEDIT:\r\n\r\nI am using `acme.cert-manager.io/http01-edit-in-place: \"true\"` annotation as well.",
      "answer": "Hey! That's not possible. Sorry I wasn't clear enough. The \"...\" in the location path `/.well-known/acme-challenge/...` is actually full path, so if I do the proposed, it won't work since the generated configuration is more specific. I've actually already solved this by using DNS01 Challenge Provider in the cert manager. Another possible solution would be probably using Mergeable Ingresses without `acme.cert-manager.io/http01-edit-in-place: \"true\"` but I was not successful configuring it.",
      "category": "Q&A",
      "created_at": "2023-12-13T11:25:51Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/4791",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 2875,
      "title": "Install nginx ingress on EKS with private LB",
      "question": "Hi Community Members,\r\n\r\nCan you help me with the exact command to install nginx ingress controller on AWS EKS 1.22 using the helm command.\r\n\r\nI don't require the custom resources and appprotect\r\nand create internal only Load balancer with annoatation: service.beta.kubernetes.io/aws-load-balancer-internal: \"true\"\r\n\r\nI came up with this command, is it correct?\r\n\r\nhelm install my-release nginx-stable/nginx-ingress --set controller.enableCustomResources=false --set controller.appprotect.enable=false --set controller.service.external.enabled=false --set controller.service.internal.enabled=true --set controller.service.internal.annotations.service.beta.kubernetes.io/aws-load-balancer-internal: \"true\"",
      "answer": "I am not sure if this is going to help you, but here are the `values.yaml` I used to deploy it using a private NLB.\r\n\r\n```yaml\r\ningress-nginx:\r\n  controller:\r\n    ingressClassResource:\r\n      default: false\r\n\r\n    service:\r\n      external:\r\n        enabled: false\r\n\r\n      internal:\r\n        enabled: true\r\n        annotations:\r\n          service.beta.kubernetes.io/aws-load-balancer-backend-protocol: \"tcp\"\r\n          service.beta.kubernetes.io/aws-load-balancer-type: \"nlb\"\r\n          service.beta.kubernetes.io/aws-load-balancer-scheme: \"internal\"\r\n          service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: \"true\"\r\n          service.beta.kubernetes.io/aws-load-balancer-internal: \"true\"\r\n```",
      "category": "General",
      "created_at": "2022-07-21T07:41:03Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/2875",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 4751,
      "title": "duplicate nginx settings",
      "question": "Hi,\r\n\r\nHow to avoid creating duplicate nginx settings? I set `grpc_read_timeout` in my VirtualServer `location-snippets`. I keep getting below. When I check NIC configs, there are 2 `grpc_read_timeout` entries in that service location. I want to be able to update these settings.\r\n```\r\n[emerg] 40#40: \\\"grpc_read_timeout\\\" directive is duplicate in /etc/nginx/conf.d/test_grpc_gr \u2502\r\n\u2502 pc-vs.conf:248\\n\"\r\n```",
      "answer": "user error. I found what I was looking for at https://docs.nginx.com/nginx-ingress-controller/configuration/virtualserver-and-virtualserverroute-resources .",
      "category": "Q&A",
      "created_at": "2023-12-05T23:10:11Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/4751",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 4624,
      "title": "services with more than 1 ports issues",
      "question": "Hi,\r\nDoes VirtualServer & VirtualServerRoutes handle services with two ports or more? I'm seeing issues where I set two `upstream` with the same service name but a different port. It doesn't work it's complaining about duplicate upstream. The services is pointing at the same container pod. Any help is appreciated.\r\n\r\n```\r\napiVersion: k8s.nginx.org/v1\r\nkind: VirtualServer\r\nmetadata:\r\n  name: virtual-server\r\nspec:\r\n  host: virtual-server.example.com\r\n  tls:\r\n    secret: virtual-server-route-tls-grpc-secret\r\n  routes:\r\n  - path: \"/helloworld.Greeter\"\r\n    route: virtual-server-route\r\n  - path: \"/backend1/test\"\r\n    route: virtual-server-route\r\n---\r\napiVersion: k8s.nginx.org/v1\r\nkind: VirtualServerRoute\r\nmetadata:\r\n  name: virtual-server-route\r\nspec:\r\n  host: virtual-server.example.com\r\n  upstreams:\r\n  - name: backendgrpc\r\n    service: backend\r\n    port: 50051\r\n    type: grpc\r\n  - name: backendhttp\r\n    service: backend\r\n    port: 80\r\n   type: http\r\n  subroutes:\r\n  - path: \"/helloworld.Greeter\"\r\n    action:\r\n      pass: backendgrpc\r\n  - path: \"/backend1/test\"\r\n    action:\r\n      pass: backendhttp\r\n```",
      "answer": "Hi @Rockawear\r\n\r\n> I'm able to go around it is by creating two VirtualServerRoute for each service rather than mixing them.\r\n\r\nThis is exactly the way you want to use VirtualServerRoutes.\r\nWhen using a `VirtualServerRoute` with a `VirutalServer`, each of your `path` and `route` entries must point to their own `VirutalServerRoute`, as the `path` defined in the `VirtualServer` must match the prefix of each `subroute` set in the respective `VirtualServerRoute`\r\n\r\nDetails about `subroute` are in our docs [here](https://docs.nginx.com/nginx-ingress-controller/configuration/virtualserver-and-virtualserverroute-resources/#virtualserverroutesubroute)",
      "category": "Q&A",
      "created_at": "2023-11-07T19:28:19Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/4624",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 4611,
      "title": "Regarding current vulnerabilities in NGINX CVE-2023-5043/CVE-2022-4886/",
      "question": "Hi All,\r\n\r\n  We are running nginxinc open source version we would like to know if above vulnerability is applicable here as well ?\r\n\r\nhttps://github.com/kubernetes/ingress-nginx/issues/10571\r\nhttps://github.com/kubernetes/ingress-nginx/issues/10570\r\nhttps://github.com/kubernetes/ingress-nginx/issues/10572\r\n\r\nAbove talks about chrooted and annotation injection whereas nginxinc runs as 101 nginx user is above appicable ?. Btw we are using nginx for only udp traffic. It will help a lot if someone can share input on the same.\r\n\r\nrgds\r\nBalaji",
      "answer": "Hi @ThenmozhiBalaji \r\n\r\nThere is a blog post that covers this topic: https://www.nginx.com/blog/which-nginx-ingress-controllers-are-impacted-by-cve-2022-4886-cve-2023-5043-and-cve-2023-5044/\r\n\r\nIn short, these vulnerabilities _only_ apply to the community version.",
      "category": "Q&A",
      "created_at": "2023-11-06T11:20:08Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/4611",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 4447,
      "title": "Getting \"upstream sent duplicate header line\" error (502)",
      "question": "Hey! \r\n\r\nWe're using`nginx-ingress-0.18.1` as an ingress controller for Spring Boot app.\r\n\r\nAfter some time of running the backend pods, we start to get 502 responses with following error.\r\n\r\n```\r\n2023/10/01 18:15:31 [error] 1646#1646: *2862237 upstream sent duplicate header line: \"Transfer-Encoding: chunked\", previous value: \"Transfer-Encoding: chunked\" while reading response header from upstream, client: xxx, server: xxx, request: \"GET xxx HTTP/1.1\", upstream: \"http://10.224.1.48:8080/xxx\", host: \"xxx\", referrer: \"xxx\"\r\n```\r\n\r\nNot sure whether the issue comes from nginx or the spring-boot backend. But I am not sure, why this actually leads to 502 error while the duplicate header might just be ignored. Is there a way how to tell nginx to ignore it when the header values are just the same?",
      "answer": "`upstream sent duplicate header line` and `while reading response header from upstream`\r\nIs the important thing here.  That is your backend application as far as NGINX is concerned.\r\nUnless you have something in-line with the application, like a sidecar that is adding the second header to the response or some other proxy pod, it is the application / framework itself.\r\n\r\nYour comment of \"After some time of running the backend pods, we start to get\"...\r\nDo the responses get continually larger?\r\nIf this was NGINX doing anything such as a mis-configured add_header - it should be consistent and not appear after any period of time.\r\n\r\nNow, I want to spend a bit of time focusing on which NGINX Ingress controller you are using.\r\n\"nginx-ingress\" tends to be this project.  But the version number \"0.18.1\" can be the community project or it can be the version of the Helm chart of this project you are using.  It is difficult to determine.\r\n\r\n ",
      "category": "Q&A",
      "created_at": "2023-10-01T19:21:53Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/4447",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 4462,
      "title": "Acme Let's Encrypt challenge with VirtualServer + TLS redirect",
      "question": "Hello!\r\n\r\nHow to configure VirtualServer with TLS redirect to be able to complete Acme Let's Encrypt challenge? Acme challenge request to /.well-know endpoint is automatically redirected to https (443) which result in `ERR_SSL_UNRECOGNIZED_NAME_ALERT` error and request cannot be full-filled.\r\n\r\nHere is VS deployment:\r\n\r\n```\r\napiVersion: k8s.nginx.org/v1\r\nkind: VirtualServer\r\nmetadata:\r\n  name: vs-test\r\n  namespace: default\r\nspec:\r\n  host: vs-demo-test.example.com\r\n  routes:\r\n    - action:\r\n        pass: test\r\n      path: /\r\n  tls:\r\n    cert-manager:\r\n      cluster-issuer: letsencrypt-prod\r\n    redirect:\r\n      enable: true\r\n    secret: vs-demo-test.example.com-tls\r\n  upstreams:\r\n    - name: test\r\n      port: 80\r\n      service: test\r\n```\r\n",
      "answer": "@janisii please check this [PR](https://github.com/nginxinc/kubernetes-ingress/commit/d8e92787614485de3c54ba66780a41fb2b6e435d)",
      "category": "General",
      "created_at": "2023-10-03T10:58:48Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/4462",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 3554,
      "title": "Exposing CoAP Service with IP preservation",
      "question": "Hi,\r\n\r\nsince I didn't really have an idea after a few hours, I just wanted to ask for some advice. I have a CoAP server running in AWS EKS. So far everything works with the `transportserver` pointing at my service. Now I have the requirement that I need the client IP. By default, the IP of the Nginx pod is passed.\r\n\r\nI use helm to deploy the Nginx controller.\r\n\r\nOne idea I had was to add `serverSnippets: proxy_bind $remote_addr transparent;` to the transportserver and modifying the daemonset to get more permissions:\r\n```\r\n        securityContext:\r\n          allowPrivilegeEscalation: true\r\n          runAsUser: 101 #nginx\r\n          runAsNonRoot: true\r\n          privileged: true\r\n          capabilities:\r\n            drop:\r\n            - ALL\r\n            add:\r\n            - NET_BIND_SERVICE\r\n            - NET_ADMIN\r\n            - NET_RAW\r\n            - CAP_NET_ADMIN\r\n```\r\nBut still getting the error:\r\n```\r\n[alert] 155#155: *13120 setsockopt(IP_TRANSPARENT) failed (1: Operation not permitted) while connecting to upstream, udp client: <IP_I_WANT>, server: 0.0.0.0:8000, upstream: \"<IP_I_GET>:8000\", bytes from/to client:61/0, bytes from/to upstream:0/0\r\n```\r\n\r\nAnother idea was to implement a lua plugin that can add the client IP as CoAP option. The problem ist, I can't find any hints on how to include plugins e.g. by mounting them to a specific directory in combination with the helm chart.\r\n\r\nDo someone have a idea or hint on how to achieve it?",
      "answer": "Hi @StevenCyb thanks for opening up a discussion, would you mind taking a look at https://github.com/nginxinc/kubernetes-ingress/tree/v3.0.2/examples/shared-examples/proxy-protocol and see if it matches your requirement?",
      "category": "Q&A",
      "created_at": "2023-02-14T14:55:26Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/3554",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 4290,
      "title": "Security Attributes for Nginx Ingress",
      "question": "Hi,\r\n\r\nI want to close security recommendations for Kubernetes Cluster in Microsoft Defender for Cloud.\r\n\r\nOne of them is \"**Kubernetes clusters should disable automounting API credentials**\" and it can be solved by added \"`automountServiceAccountToken: false`\" for _POD security_ \"**spec** --> **template** --> **spec**\"\r\n\r\n```\r\nspec:\r\n  template:\r\n    metadata:\r\n    spec:\r\n      automountServiceAccountToken: false\r\n```\r\n\r\nBut when I am adding this value for the Ingress Nginx Controller, the pods give me CrashLoopBackOff status and that logs in below.\r\n\r\nHow can I solve this?\r\n\r\n```\r\nclient_config.go:618] Neither --kubeconfig nor --master was specified.  Using the inClusterConfig.  This might not work.\r\nclient_config.go:623] error creating inClusterConfig, falling back to default config: open /var/run/secrets/kubernetes.io/serviceaccount/token: no such file or directory\r\nmain.go:267] Error while initiating a connection to the Kubernetes API server. This could mean the cluster is misconfigured (e.g. it has invalid API server certificates or Service Accounts configuration). Reason: invalid configuration: no configuration has been provided, try setting KUBERNETES_MASTER environment variable\r\n```",
      "answer": "Hi @3rk1n, from you problem statement I understand that this is a security recommendation from Microsoft Azure Defender **but** Ingress Controller needs credentials to access the K8s API in order to function.\r\n\r\nSo the behaviour you're seeing after setting `automountServiceAccountToken: false` is **_completely expected_**. Our recommendation would be either:\r\n\r\n- Ignore this particular security recommendation and use rbac security measures to prevent unwanted access OR\r\n- Set `automountServiceAccountToken: false` and then immediately manually configure the API access token.\r\n\r\nSee: https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#use-the-default-service-account-to-access-the-api-server\r\n",
      "category": "Q&A",
      "created_at": "2023-08-24T07:50:24Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/4290",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 4216,
      "title": "Why the config-map configured for the ingress controller is getting auto modified randomly ?",
      "question": "Hello. \r\n\r\nI am seeing random events generated which shows that the config-map is getting updated. There is no manual update on the configmap. I am also not able to find what was changed. \r\n\r\nWhat are the triggers for the configmap ? \r\n\r\nCan anybody help me find the trigger or in general point to what to look for ? \r\n\r\nIngress is hosted ok EKS cluster. \r\nI did rand controller with debug + v5 log level, but there is no information about the event except that only the configmap was updated. \r\n\r\nThank you. \r\n\r\nPlease let me know if any other information is needed. \r\n",
      "answer": "The only writing that the ingress controller performs is events back against objects.\r\nLogs would tell us what is happening.  Normal event logging output of the ingress controller pods is pretty informative in helping all of us understand what is happening.\r\nPod logs and check the configmap status for events.\r\n\r\nI am also assuming that you do not have any pipelines that might be repeatedly writing the configmap, even though the source has not changed.  The ingress controller sets watches for updates on config objects and is notified by the K8s API.",
      "category": "Q&A",
      "created_at": "2023-08-13T08:32:04Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/4216",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 4195,
      "title": "Helm Chart and deployment manifests",
      "question": "I'd like to get early feedback about a \"refactor\" of the Helm chart directory and the generation of deployment manifests based on use cases.\r\n\r\nThe first part is about moving the helm chart to the root of the project and inside the `nginx-ingress` folder to follow Helm's best practices. This means that the new structure would be `charts/nginx-ingress` instead of `deployments/helm-chart/`.\r\nWill this cause any problems? Maybe with existing automation? Would release notes be enough to cover this?\r\nI would expect most people to pull the chart locally if they want to modify the `values.yaml` file, with something like `helm pull oci://ghcr.io/nginxinc/charts/nginx-ingress --untar --version 0.18.0`, but feedback is appreciated.\r\n\r\nThe second part is to create deployments for different use cases, generating them from the Helm Chart to have a single source of truth, something like:\r\n```\r\ndeploy/\r\n\u251c\u2500\u2500 README.md\r\n\u251c\u2500\u2500 app-protect-dos\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 deploy.yaml\r\n\u251c\u2500\u2500 app-protect-waf\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 deploy.yaml\r\n\u251c\u2500\u2500 aws-nlb\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 deploy.yaml\r\n...\r\n\u2514\u2500\u2500 read-only-fs\r\n    \u2514\u2500\u2500 deploy.yaml\r\n```\r\nThese manifest files will have everything that's needed for the deployment in a single file, `Service`, `Service Account`, `Namespace`, `Deployment`, etc.\r\nWould this be helpful? What use cases should we consider adding? Should we also include CRDs in there?\r\n\r\nAny feedback would be greatly appreciated \ud83d\ude4f \r\n",
      "answer": "> The first part is about moving the helm chart to the root of the project and inside the `nginx-ingress` folder to follow Helm's best practices. This means that the new structure would be `charts/nginx-ingress` instead of `deployments/helm-chart/`.\r\n> Will this cause any problems? Maybe with existing automation? Would release notes be enough to cover this?\r\n\r\nIt is a breaking change, and should be mentioned as such in release notes for upgrade guidance. People will surely encounter issues by running an outdated command. But keep in mind that it will be very tricky to decide for removing any mitigation that gets put in place to support the old directory structure. So I would say to just allow the failure, and let people go read release notes (or check the updated installation page).\r\n\r\n> I would expect most people to pull the chart locally if they want to modify the `values.yaml` file, with something like `helm pull oci://ghcr.io/nginxinc/charts/nginx-ingress --untar --version 0.18.0`, but feedback is appreciated.\r\n\r\nI don't think there is a major concern here, as long as the structure changes are covered in release notes.\r\n\r\nWhen people run `helm install` and `helm upgrade`, I would expect a custom values YAML file locally, such as:\r\n```yaml\r\ncontroller:\r\n  config:\r\n    entries:\r\n      set-real-ip-from: '10.1.1.64/27'\r\n  readOnlyRootFilesystem: true\r\n  service:\r\n    annotations:\r\n      service.beta.kubernetes.io/azure-load-balancer-internal: 'true'\r\n      service.beta.kubernetes.io/azure-load-balancer-ipv4: 10.1.2.4\r\n```\r\n\r\nThe deployment would be done as `helm install nginx-ingress oci://ghcr.io/nginxinc/charts/nginx-ingress --version 0.18.0 --values nginx-ingress.yml`.\r\n\r\n> These manifest files will have everything that's needed for the deployment in a single file, `Service`, `Service Account`, `Namespace`, `Deployment`, etc.\r\n> Would this be helpful? What use cases should we consider adding? Should we also include CRDs in there?\r\n\r\nThis depends on what your goal for the files is...\r\nI would assume it's to facilitate \"quick-start\" situations. If so, all bells and whistles make sense to include in this YAML file.\r\n\r\nIncluding `Namespace` resource is beneficial so that people can run a simple `kubectl apply -f https://github.com/nginxinc/kubernetes-ingress/raw/v3.3.0/deploy/use-case/deploy.yaml` without worrying about pre-requisites (create namespace/specify namespace for `kubectl` invocation). This could fit into a simple pipeline that prepares the NIC without a dependency on Helm. If people have advanced scenarios, where they want a different namespace name, they would most likely know what to do with the YAML.\r\n\r\nThe `Deployment` should utilize a custom `Service Account`, and it needs `RBAC`, so these make sense to me as well.\r\n\r\nCRDs are being pushed as the primary configuration mechanism. To make the project structure easier to maintain, maybe it makes sense to leave them out of the use-case-specific YAMLs, and have a separate `deploy/crds.yaml` that people apply first. Depends.\r\n\r\n`Service` makes sense to include for some use-cases (such as cloud-specific configurations, where there isn't much flexibility expected). You probably want to include some basic Service definition for other general-purpose scenarios (e.g. the mentioned read-only rootfs). This way, all the YAML files deploy a similar set of resources (with different configurations).",
      "category": "General",
      "created_at": "2023-08-09T02:41:00Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/4195",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 3633,
      "title": "does not have any active Endpoint.",
      "question": "\r\nI am getting this error when i upgraded my Kubernetes version on my AKS cluster \r\n\r\nNGINX Ingress controller\r\n  Release:       v1.4.0\r\n  Build:         50be2bf95fd1ef480420e2aa1d6c5c7c138c95ea\r\n  Repository:    https://github.com/kubernetes/ingress-nginx\r\n  nginx version: nginx/1.19.10\r\n\r\n-------------------------------------------------------------------------------\r\n\r\nW0310 11:50:56.507021       7 client_config.go:617] Neither --kubeconfig nor --master was specified.  Using the inClusterConfig.  This might not work.\r\nI0310 11:50:56.507154       7 main.go:209] \"Creating API client\" host=\"https://10.0.0.1:443\"\r\nI0310 11:50:56.543039       7 main.go:253] \"Running in Kubernetes cluster\" major=\"1\" minor=\"24\" git=\"v1.24.9\" state=\"clean\" commit=\"57fbbcc2804848b95cad5519f5\r\nec9d6355430db9\" platform=\"linux/amd64\"\r\nI0310 11:50:56.756763       7 main.go:104] \"SSL fake certificate created\" file=\"/etc/ingress-controller/ssl/default-fake-certificate.pem\"\r\nI0310 11:50:56.775362       7 ssl.go:533] \"loading tls certificate\" path=\"/usr/local/certificates/cert\" key=\"/usr/local/certificates/key\"\r\nI0310 11:50:56.795074       7 nginx.go:260] \"Starting NGINX Ingress controller\"\r\nI0310 11:50:56.811865       7 event.go:285] Event(v1.ObjectReference{Kind:\"ConfigMap\", Namespace:\"ingress-basic\", Name:\"nginx-ingress-ingress-nginx-controller\r\n\", UID:\"5757472d-67e9-4f82-a58c-caec0f58f851\", APIVersion:\"v1\", ResourceVersion:\"22152023\", FieldPath:\"\"}): type: 'Normal' reason: 'CREATE' ConfigMap ingress-\r\nbasic/nginx-ingress-ingress-nginx-controller\r\nI0310 11:50:57.900366       7 store.go:430] \"Found valid IngressClass\" ingress=\"develop/develop-unified-ingress\" ingressclass=\"nginx\"\r\nI0310 11:50:57.901578       7 event.go:285] Event(v1.ObjectReference{Kind:\"Ingress\", Namespace:\"develop\", Name:\"develop-unified-ingress\", UID:\"d0c1fb93-80e2-4\r\n8e3-b4ed-5c58af2c28d6\", APIVersion:\"networking.k8s.io/v1\", ResourceVersion:\"24658494\", FieldPath:\"\"}): type: 'Normal' reason: 'Sync' Scheduled for sync\r\nI0310 11:50:57.996676       7 nginx.go:303] \"Starting NGINX process\"\r\nI0310 11:50:57.996774       7 leaderelection.go:248] attempting to acquire leader lease ingress-basic/ingress-controller-leader...\r\nI0310 11:50:57.997141       7 nginx.go:323] \"Starting validation webhook\" address=\":8443\" certPath=\"/usr/local/certificates/cert\" keyPath=\"/usr/local/certific\r\nates/key\"\r\nW0310 11:50:57.997577       7 controller.go:1112] Service \"develop/camera-service\" does not have any active Endpoint.\r\nW0310 11:50:57.997672       7 controller.go:1112] Service \"develop/sp-platform\" does not have any active Endpoint.\r\nI0310 11:50:57.997798       7 controller.go:168] \"Configuration changes detected, backend reload required\"\r\nI0310 11:50:58.002004       7 status.go:84] \"New leader elected\" identity=\"nginx-ingress-ingress-nginx-controller-6647c7779d-lpwkb\"\r\nI0310 11:50:58.093407       7 controller.go:185] \"Backend successfully reloaded\"\r\nI0310 11:50:58.093536       7 controller.go:196] \"Initial sync, sleeping for 1 second\"\r\nI0310 11:50:58.093591       7 event.go:285] Event(v1.ObjectReference{Kind:\"Pod\", Namespace:\"ingress-basic\", Name:\"nginx-ingress-ingress-nginx-controller-6647c\r\n7779d-xck99\", UID:\"d7246654-6d98-451f-a992-fa84789cf800\", APIVersion:\"v1\", ResourceVersion:\"24659659\", FieldPath:\"\"}): type: 'Normal' reason: 'RELOAD' NGINX r\r\neload triggered due to a change in configuration\r\nW0310 11:51:01.800889       7 controller.go:1112] Service \"develop/camera-service\" does not have any active Endpoint.\r\nW0310 11:51:01.801014       7 controller.go:1112] Service \"develop/sp-platform\" does not have any active Endpoint.\r\nW0310 11:51:05.134430       7 controller.go:1112] Service \"develop/camera-service\" does not have any active Endpoint.\r\nW0310 11:51:05.134554       7 controller.go:1112] Service \"develop/sp-platform\" does not have any active Endpoint.\r\nW0310 11:51:08.467755       7 controller.go:1112] Service \"develop/camera-service\" does not have any active Endpoint.\r\nW0310 11:51:08.468026       7 controller.go:1112] Service \"develop/sp-platform\" does not have any active Endpoint.\r\nW0310 11:51:11.801926       7 controller.go:1112] Service \"develop/camera-service\" does not have any active Endpoint.\r\nW0310 11:51:11.802148       7 controller.go:1112] Service \"develop/sp-platform\" does not have any active Endpoint.\r\nW0310 11:51:15.134454       7 controller.go:1112] Service \"develop/camera-service\" does not have any active Endpoint.\r\nW0310 11:51:15.134577       7 controller.go:1112] Service \"develop/sp-platform\" does not have any active Endpoint.\r\nW0310 11:51:20.148933       7 controller.go:1112] Service \"develop/camera-service\" does not have any active Endpoint.\r\nW0310 11:51:20.149161       7 controller.go:1112] Service \"develop/sp-platform\" does not have any active Endpoint.\r\nW0310 11:51:23.483068       7 controller.go:1112] Service \"develop/camera-service\" does not have any active Endpoint.\r\nW0310 11:51:23.483204       7 controller.go:1112] Service \"develop/sp-platform\" does not have any active Endpoint.\r\nW0310 11:51:26.816003       7 controller.go:1112] Service \"develop/camera-service\" does not have any active Endpoint.\r\nW0310 11:51:26.816110       7 controller.go:1112] Service \"develop/sp-platform\" does not have any active Endpoint.\r\nW0310 11:51:32.112999       7 controller.go:1112] Service \"develop/camera-service\" does not have any active Endpoint.\r\nW0310 11:51:32.113539       7 controller.go:1112] Service \"develop/sp-platform\" does not have any active Endpoint.\r\nW0310 11:51:35.447164       7 controller.go:1112] Service \"develop/camera-service\" does not have any active Endpoint.\r\nW0310 11:51:35.447321       7 controller.go:1112] Service \"develop/sp-platform\" does not have any active Endpoint.\r\nW0310 11:51:38.779811       7 controller.go:1112] Service \"develop/camera-service\" does not have any active Endpoint.\r\nW0310 11:51:38.779938       7 controller.go:1112] Service \"develop/sp-platform\" does not have any active Endpoint.\r\nW0310 11:51:42.113117       7 controller.go:1112] Service \"develop/camera-service\" does not have any active Endpoint.\r\nW0310 11:51:42.113283       7 controller.go:1112] Service \"develop/sp-platform\" does not have any active Endpoint.\r\nW0310 11:51:45.446465       7 controller.go:1112] Service \"develop/camera-service\" does not have any active Endpoint.\r\nW0310 11:51:45.446681       7 controller.go:1112] Service \"develop/sp-platform\" does not have any active Endpoint.\r\nI0310 11:52:15.553617       7 status.go:84] \"New leader elected\" identity=\"nginx-ingress-ingress-nginx-controller-6647c7779d-6z2w4\"\r\nW0310 11:53:40.326607       7 controller.go:1112] Service \"develop/sp-platform\" does not have any active Endpoint.\r\nW0310 11:53:47.320393       7 controller.go:1112] Service \"develop/camera-service\" does not have any active Endpoint.\r\nW0310 11:53:47.320499       7 controller.go:1112] Service \"develop/sp-platform\" does not have any active\u00a0Endpoint.\r\n\r\n\r\n\r\n\r\n\r\n```\r\n`apiVersion: networking.k8s.io/v1\r\nkind: Ingress\r\nmetadata:\r\n  namespace: develop\r\n  name: develop-unified-ingress\r\n  annotations:\r\n    kubernetes.io/ingress.class: nginx\r\n    nginx.ingress.kubernetes.io/ssl-redirect: \"false\"\r\n    nginx.ingress.kubernetes.io/use-regex: \"true\"\r\n    nginx.ingress.kubernetes.io/rewrite-target: /$1\r\n    nginx.ingress.kubernetes.io/proxy-body-size: 50m\r\n    nginx.ingress.kubernetes.io/request-timeout: \"600\"\r\n    nginx.ingress.kubernetes.io/proxy-read-timeout: \"3600\"\r\n    nginx.ingress.kubernetes.io/proxy-send-timeout: \"3600\"\r\n    er-snippets: |\r\n      location / {\r\n        proxy_set_header Upgrade $http_upgrade;\r\n        proxy_http_version 1.1;\r\n        proxy_set_header X-Forwarded-Host $http_host;\r\n        proxy_set_header X-Forwarded-Proto $scheme;\r\n        proxy_set_header X-Forwarded-For $remote_addr;\r\n        proxy_set_header Host $host;\r\n        proxy_set_header Connection \"Upgrade\";\r\n        proxy_cache_bypass $http_upgrade;\r\n        }\r\nspec:\r\n  rules:\r\n    - host: devgateway.com\r\n      http:\r\n        paths:\r\n          - backend:\r\n              service:\r\n                name: adminer-dev\r\n                port:\r\n                  number: 8080\r\n            path: /adminer.php(/|$)(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: fms-fleet\r\n                port:\r\n                  number: 8010\r\n            path: /fms-fleet/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: fms-driver\r\n                port:\r\n                  number: 8011\r\n            path: /fms-driver/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: fms-maintenance\r\n                port:\r\n                  number: 8012\r\n            path: /fms-maintenance/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: user-ms\r\n                port:\r\n                  number: 8013\r\n            path: /user-ms/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: cob-packages\r\n                port:\r\n                  number: 8021\r\n            path: /cob-packages/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: cob-customer\r\n                port:\r\n                  number: 8022\r\n            path: /cob-customer/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: cob-inventory\r\n                port:\r\n                  number: 8023\r\n            path: /cob-inventory/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: cob-new-customer\r\n                port:\r\n                  number: 8024\r\n            path: /cob-new-customer/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: maptrail-generic\r\n                port:\r\n                  number: 8031\r\n            path: /maptrail-generic/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: map-trail\r\n                port:\r\n                  number: 8032\r\n            path: /map-trail/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: smpp-mail\r\n                port:\r\n                  number: 8033\r\n            path: /smpp-mail/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: jubaili-be\r\n                port:\r\n                  number: 8035\r\n            path: /jubaili-be/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: at-advance\r\n                port:\r\n                  number: 8036\r\n            path: /at-advance/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: loki\r\n                port:\r\n                  number: 3100\r\n            path: /loki/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: camera-service\r\n                port:\r\n                  number: 8037\r\n            path: /camera-service/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: report-analytics\r\n                port:\r\n                  number: 8038\r\n            path: /report-analytics/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: scheduler-ms\r\n                port:\r\n                  number: 8039\r\n            path: /scheduler-ms/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: platform-audit\r\n                port:\r\n                  number: 8040\r\n            path: /platform-audit/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: device-manager\r\n                port:\r\n                  number: 8041\r\n            path: /device-manager/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: platform-role-access\r\n                port:\r\n                  number: 8042\r\n            path: /platform-role-access/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: notification-alerts\r\n                port:\r\n                  number: 8043\r\n            path: /notification-alerts/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: smart-building\r\n                port:\r\n                  number: 8044\r\n            path: /smart-building/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: live-stream\r\n                port:\r\n                  number: 5000\r\n            path: /live-stream/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: live-stream\r\n                port:\r\n                  number: 4400\r\n            path: /ws-live-stream/(.*)\r\n            pathType: Prefix\r\n          - backend:\r\n              service:\r\n                name: sp-platform\r\n                port:\r\n                  number: 8087\r\n            path: /sp-platform/(.*)\r\n            pathType: Prefix`\r\n```\r\n            \r\n          My ingress file looks like this it was working fine before the upgrade.",
      "answer": "From your comments I believe that you are not using THIS project, but rather you are using the K8s community ingress controller.\r\n\r\nThis is my take away from 'ingress-nginx' and the use of community ingress annotations ( nginx.ingress.kubernetes.io )\r\n\r\nCan you please double check that?\r\n",
      "category": "Q&A",
      "created_at": "2023-03-10T16:50:55Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/3633",
      "has_official_answer": true
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 4138,
      "title": "Transport Server from Rabbitmq on Openshift, connection refused",
      "question": "Hi, \r\nI recently deployed the ingress operator in Openshift and im trying to access an instance of Rabbitmq out the cluster,\r\nFor testing, HTTP ingress work correct, but im trying to setuip tcp access.\r\n\r\nBut i cant make transportServer to work with rabbitmq.\r\n To reproduce:\r\n1. Install Rabbitmq on rabbitmq-system namespace\r\n2. Install a INgress controller with the operator on rabbitmq-system\r\n3.  Expose rabbitmq services \"rabbitmq-sandbox2\" on port 5672\r\n```\r\nkind: Service\r\napiVersion: v1\r\nmetadata:\r\n  annotations:\r\n    rabbitmq.com/topology-allowed-namespaces: rabbitmq-system\r\n  resourceVersion: '74006948'\r\n  name: rabbitmq-sandbox2\r\n  namespace: rabbitmq-system\r\n  ownerReferences:\r\n    - apiVersion: rabbitmq.com/v1beta1\r\n      kind: RabbitmqCluster\r\n      name: rabbitmq-sandbox2\r\n      uid: d74ea3d0-4f06-40a2-9157-4bc7fc9352a5\r\n      controller: true\r\n      blockOwnerDeletion: true\r\n  labels:\r\n    app.kubernetes.io/component: rabbitmq\r\n    app.kubernetes.io/name: rabbitmq-sandbox2\r\n    app.kubernetes.io/part-of: rabbitmq\r\nspec:\r\n  ports:\r\n    - name: amqp\r\n      protocol: TCP\r\n      appProtocol: amqp\r\n      port: 5672\r\n      targetPort: 5672\r\n    - name: management\r\n      protocol: TCP\r\n      appProtocol: http\r\n      port: 15672\r\n      targetPort: 15672\r\n    - name: stream\r\n      protocol: TCP\r\n      appProtocol: rabbitmq.com/stream\r\n      port: 5552\r\n      targetPort: 5552\r\n    - name: prometheus\r\n      protocol: TCP\r\n      appProtocol: prometheus.io/metrics\r\n      port: 15692\r\n      targetPort: 15692\r\n  type: ClusterIP\r\n\r\n  selector:\r\n    app.kubernetes.io/name: rabbitmq-sandbox2\r\n```\r\n4. Create global configuration and create listener opn por \"30552\"\r\n\r\n `apiVersion: k8s.nginx.org/v1alpha1\r\nkind: GlobalConfiguration \r\nmetadata:\r\n  name: nginx-configuration\r\n  namespace: rabbitmq-system\r\nspec: \r\n  listeners:\r\n  - name: rabbitmq-tcp\r\n    port: 30552\r\n    protocol: TCP`\r\n\r\n6. Create a transport server\r\n`apiVersion: k8s.nginx.org/v1alpha1\r\nkind: TransportServer\r\nmetadata:\r\n  name: rabbitmq-listener\r\n  namespace: rabbitmq-system\r\nspec:\r\n  host: rabbitmq.apps.ocptest.domain.com\r\n  listener:\r\n    name: rabbitmq-tcp\r\n    protocol: TCP\r\nupstreams:\r\n- name: rabbitmq-sandbox2\r\n  service: rabbitmq-sandbox2\r\n  port: 5672\r\naction:\r\n  pass: rabbitmq-sandbox2`\r\n\r\n\r\nFor testing:\r\nandres@MIS3749:~$ curl rabbit.apps.ocptest.domain.com:30552 -vvv\r\n*   Trying 10.21.64.102:30552...\r\n* TCP_NODELAY set\r\n* connect to 10.xx.xx.xx2 port 30552 failed: Connection refused\r\n* Failed to connect to rabbit.apps.ocptest.domain.com port 30552: Connection refused\r\n* Closing connection 0",
      "answer": "i can not see how  the transporServer create a new listener or if the listener is running.\r\ni forget to add the the configuration of the ingress service, where i added 5672 service.\r\n```\r\nNamespace:                rabbitmq-system\r\nLabels:                   app.kubernetes.io/instance=nginxingress-sample\r\n                          app.kubernetes.io/managed-by=Helm\r\n                          app.kubernetes.io/name=nginx-ingress\r\n                          app.kubernetes.io/version=3.2.0\r\n                          helm.sh/chart=nginx-ingress-0.18.0\r\nAnnotations:              meta.helm.sh/release-name: nginxingress-sample\r\n                          meta.helm.sh/release-namespace: rabbitmq-system\r\nSelector:                 app.kubernetes.io/instance=nginxingress-sample,app.kubernetes.io/name=nginx-ingress\r\nType:                     LoadBalancer\r\nIP:                       172.30.154.152\r\nPort:                     amqp  5672/TCP\r\nTargetPort:               5672/TCP\r\nNodePort:                 amqp  31195/TCP\r\nEndpoints:                <none>\r\nPort:                     http  80/TCP\r\nTargetPort:               80/TCP\r\nNodePort:                 http  32440/TCP\r\nEndpoints:                <none>\r\nPort:                     https  443/TCP\r\nTargetPort:               443/TCP\r\nNodePort:                 https  32525/TCP\r\nEndpoints:                <none>\r\nSession Affinity:         None\r\nExternal Traffic Policy:  Local\r\nHealthCheck NodePort:     30838\r\n```\r\n\r\nit is supossed now that nginx will be listening on 5672?\r\n\r\nFrom a test pod:\r\n~ $ curl 172.30.144.210:5672\r\ncurl: (1) Received HTTP/0.9 when not allowed\r\n\r\nFrom out Kubernetes:\r\ncurl rabbitmq.apps.ocptest.domain.com:5672\r\ncurl: (7) Failed to connect to rabbitmq.apps.ocptest.domain.com port 5672: Connection refused\r\n\r\nTesting ingress:\r\ncurl curl rabbitmq.apps.ocptest.arionbanki.is:80\r\n(works)",
      "category": "General",
      "created_at": "2023-07-24T12:46:44Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/4138",
      "has_official_answer": false
    },
    {
      "tech": "nginx",
      "repo": "nginxinc/kubernetes-ingress",
      "discussion_number": 3859,
      "title": "controller.wildcardTLS.secret - what is used for and how?",
      "question": "We start a new app with a TLS certificate we just generated.\r\nI've understood from IT, the certificate is a wildcard for all subdomains under the domain that is used for our cluster, for example, our domain is `devops.cls`, then any subdomain under `*.devops.cls` will point to cluster (round-robin), and the certificate is for `*.devops.cls`.\r\nI've read the docs and saw at first `controller.defaultTLS.secret`, but once I've started to read this one, I saw `controller.wildcardTLS.secret`.\r\n1. Using this parameter, do I still need to specify a secret on other ingresses in the cluster?\r\n2. Probably other services, will not be on the same NS of nginx, is it a problem?\r\n3. Can someone show me an example of:\r\n3.1. Secret YAML, and command to deploy it? (what about namespace?)\r\n3.2. How to put a relevant secret name under `controller.wildcardTLS.secret`? (`controller.wildcardTLS.secret: example/example`)\r\n3.3. Ingress who use my nginx ingress class, and want to use HTTPS & TLS (not sure if need to specifiy http?)",
      "answer": "You are thinking about this the exact same way I did when I first ran across it.\r\nThe 'wildcard' has no reference to this being a 'wildcard certificate' - as in it is *.domain\r\nInstead it refers to how the certificate is used.\r\n\r\nIf fact the wildcard certificate pattern with Ingress was available long before K8s officially supported a wildcard hostname.\r\n\r\nThe pattern with a wildcard secret is that you can define it once and continue to use it without specifically referencing it again.\r\nThis pattern is unique to the Ingress resource and is legacy at this point.\r\n\r\nPersonally, I recommend getting accustomed to the pattern of defining a secret and then referencing it explicitly each time you use it.\r\nThat is the better pattern, and you will also run into in the future with the Gateway API.\r\n\r\nBasically, a secret is a secret.  Put your certificate into one, name it, reference it each time you use it.\r\n\r\nIf you want to grasp how Gateway API will be working in the future, take a look at the CRDs this project offers as they are extremely similar to the evolving Gateway API.  https://docs.nginx.com/nginx-ingress-controller/configuration/virtualserver-and-virtualserverroute-resources/\r\n",
      "category": "Q&A",
      "created_at": "2023-05-04T07:28:32Z",
      "url": "https://github.com/nginx/kubernetes-ingress/discussions/3859",
      "has_official_answer": true
    }
  ]
}