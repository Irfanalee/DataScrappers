{
  "tech": "nodejs",
  "count": 415,
  "examples": [
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 69692842,
      "title": "Error message &quot;error:0308010C:digital envelope routines::unsupported&quot;",
      "problem": "I created the default IntelliJ IDEA React project and got this:\n`Error: error:0308010C:digital envelope routines::unsupported\n    at new Hash (node:internal/crypto/hash:67:19)\n    at Object.createHash (node:crypto:130:10)\n    at module.exports (/Users/user/Programming Documents/WebServer/untitled/node_modules/webpack/lib/util/createHash.js:135:53)\n    at NormalModule._initBuildHash (/Users/user/Programming Documents/WebServer/untitled/node_modules/webpack/lib/NormalModule.js:417:16)\n    at handleParseError (/Users/user/Programming Documents/WebServer/untitled/node_modules/webpack/lib/NormalModule.js:471:10)\n    at /Users/user/Programming Documents/WebServer/untitled/node_modules/webpack/lib/NormalModule.js:503:5\n    at /Users/user/Programming Documents/WebServer/untitled/node_modules/webpack/lib/NormalModule.js:358:12\n    at /Users/user/Programming Documents/WebServer/untitled/node_modules/loader-runner/lib/LoaderRunner.js:373:3\n    at iterateNormalLoaders (/Users/user/Programming Documents/WebServer/untitled/node_modules/loader-runner/lib/LoaderRunner.js:214:10)\n    at iterateNormalLoaders (/Users/user/Programming Documents/WebServer/untitled/node_modules/loader-runner/lib/LoaderRunner.js:221:10)\n/Users/user/Programming Documents/WebServer/untitled/node_modules/react-scripts/scripts/start.js:19\n  throw err;\n  ^\n`\nIt seems to be a recent issue - webpack ran into this 4 days ago and is still working on it.",
      "solution": "The error comes from your dependency relying on an obsolete version of SSL, so you have two good, and two questionable-at-best options:\n1. Try to just reinstall your dependency\n\nDelete your node_modules folder and rerun `npm install`. If your dependency relies on compiling against whatever version of Node you have installed, this may immediately fix the problem. This is the least likely solution to work, but may fix the problem without any \"real\" work on your part so is always worth trying.\n\n2. Update your dependency\n\nAlmost all dependencies with this problem have a newer version available that you can install instead. Find out which version of your dependency corresponds to after Node 18 became the LTS version of Node, band uplift your dependency to that version.\n\nThis is, really, the only proper solution: update your dependencies, because just like Node.js itself, they can leave your project vulnerable to attacks and exploits.\n3. Downgrade to Node.js v16.\n\nYou can downgrade Node itself so that you're using a version that uses the old, insecure, version of LibSSL. That doesn't \"solve\" the problem of running insecure and potentially exploitable code, of course, but your code will at least run.\n\n(You can either do that using the official Node installers, or you can use something like `nvm`. For Windows, use `nvm-windows`.)\nThis is, obviously, a bad idea. As is the next one:\n4. Tell Node to use the legacy OpenSSL provider\nOn Unix-like (Linux, macOS, Git bash, etc.):\n`export NODE_OPTIONS=--openssl-legacy-provider\n`\nOn Windows command prompt:\n```\n`set NODE_OPTIONS=--openssl-legacy-provider\n`\n```\nOn PowerShell:\n```\n`$env:NODE_OPTIONS = \"--openssl-legacy-provider\"\n`\n```\nWhen Node 18 had just become the active LTS options 1 and 2 weren't really available, but for anyone still finding this answer, 3 and 4 should no longer be considered serious options in any way.",
      "question_score": 2570,
      "answer_score": 3048,
      "created_at": "2021-10-24T01:39:57",
      "url": "https://stackoverflow.com/questions/69692842/error-message-error0308010cdigital-envelope-routinesunsupported"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 66239691,
      "title": "What does npm install --legacy-peer-deps do exactly? When is it recommended / What&#39;s a potential use case?",
      "problem": "Just ran into this error:\n```\n`npm ERR! code ERESOLVE\nnpm ERR! ERESOLVE unable to resolve dependency tree\nnpm ERR! \nnpm ERR! While resolving: nexttwin@0.1.0\nnpm ERR! Found: react@17.0.1\nnpm ERR! node_modules/react\nnpm ERR!   react@\"17.0.1\" from the root project\nnpm ERR! \nnpm ERR! Could not resolve dependency:\nnpm ERR! peer react@\"^16.8.0\" from react-hook-mousetrap@2.0.4\nnpm ERR! node_modules/react-hook-mousetrap\nnpm ERR!   react-hook-mousetrap@\"*\" from the root project\nnpm ERR! \n`\n```\nThe module I am trying to install seems to have a different peer dependency from what I have installed. It seems like npm changed its behaviour in this regard and now lets the install fail.\nWhat can I do now to fix this? I don't want to downgrade my React version for this.\nI know there is a flag called `--legacy-peer-deps` but I am not sure what exactly this does and whether it's recommended to use it / what the potential disadvantages are? I assume there is a reason npm did let the install fail.\nIt's just strange because I was using `yarn` up until very recently and everything was fine.",
      "solution": "Here's how I solved this problem:\nFirst, what's happening: react-hook-mousetrap is looking for react@16.8.0, but it is not finding it. Instead it is finding @react17.0.1, which is a newer version. For some reason mousetrap doesn't like this newer version, and you are being notified (it is not a big deal, but they decided it was worth stopping your build).\nOne solution: forcibly install the specific version of react that mousetrap wants:\n```\n`yarn add react@16.8.0\n`\n```\nWhat this does is roll back your react version to a slightly older one that is compatible with mousetrap. You won't notice any difference, and in future iterations, hopefully mousetrap is updated, so this goes away.\nAnother solution: make a sweeping decision to not install any older version dependencies:\n```\n`npm add xxxx --legacy-peer-deps\n`\n```\nWhat this does is ignore old dependencies for this package. It is more comprehensive, and makes a lot of the decisions for you.",
      "question_score": 592,
      "answer_score": 125,
      "created_at": "2021-02-17T11:03:55",
      "url": "https://stackoverflow.com/questions/66239691/what-does-npm-install-legacy-peer-deps-do-exactly-when-is-it-recommended-wh"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 69081410,
      "title": "Error [ERR_REQUIRE_ESM]: require() of ES Module not supported",
      "problem": "I'm trying to make a Discord bot that just says if someone is online on the game.\nHowever I keep getting this message:\n\n[ERR_REQUIRE_ESM]: require() of ES Module from not supported. Instead change the require of index.js in... to a dynamic import() which is available in all CommonJS modules.\n\nThis is my code:\n`    module.exports = {\n        name: 'username',\n        description: \"this is the username command\",\n        async execute(message, args) {\n\n            const fetch = require('node-fetch');\n\n            if (args.length !== 1) {\n                return message.channel.send(\"invalid username wtf\")\n            }\n\n            const ign = args[0]\n\n            if (ign.length > 16 || ign.length  data.json()).then(data => data.id).catch(err => message.channel.send(\"error wtf\"));\n            const onlineInfo = await fetch(`https://api.hypixel.net/status?key=${john}&uuid=${uuid}`).then(data => data.json());\n\n            if (uuid.length !== 32) {\n                return;\n            }\n\n            if (onlineinfo.success) {\n                if (onlineinfo.session.online) {\n                    message.channel.send(\"they are online\")\n                }\n                else {\n                    message.channel.send(\"they are offline\")\n                }\n            }\n            else {\n                message.channel.send(\"hypixel api bad wtf\")\n            }\n        }\n    }\n`\nThis is my package.json file:\n`{\n    \"name\": \"discordbot\",\n    \"version\": \"1.0.0\",\n    \"main\": \"main.js\",\n    \"scripts\": {\n        \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\",\n        \"start\": \"node main.js\"\n    },\n    \"author\": \"\",\n    \"license\": \"ISC\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"discord.js\": \"^13.0.1\",\n        \"node-fetch\": \"^3.0.0\"\n    }\n}\n`",
      "solution": "`node-fetch` v3 recently stopped support for the `require` way of importing it in favor of ES Modules. You'll need to use ESM imports now, like:\n`import fetch from \"node-fetch\";\n`\nat the top of your file.",
      "question_score": 308,
      "answer_score": 53,
      "created_at": "2021-09-07T02:51:50",
      "url": "https://stackoverflow.com/questions/69081410/error-err-require-esm-require-of-es-module-not-supported"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 66020820,
      "title": "npm: When to use `--force` and `--legacy-peer-deps`",
      "problem": "I'm trying to understand how recreating the `node_modules` directory for deployment works.\nWe're using `npm ci` instead of `npm install` to ensure a clean slate during deployment. However, when we run it without any flags, we get the following error:\n\nFix the upstream dependency conflict, or retry this command with --force, or --legacy-peer-deps to accept an incorrect (and potentially broken) dependency resolution.\n\nThe documentation for `npm install` for `--force` is as follows (there are no flags on `npm ci`'s page):\n\nThe -f or --force argument will force npm to fetch remote resources even if a local copy exists on disk.\n\nMeanwhile, the documentation for `--legacy-peer-deps` says:\n\n--legacy-peer-deps: ignore all peerDependencies when installing, in the style of npm version 4 through version 6.\n\nIt seems that both flags will let `npm ci` generate the `node_modules` directory without any issues, but I am still unclear about the differences between the two.\nFrom what I understand, `--force` sounds like it will be on a last-dependency-downloaded-wins basis and will overwrite any previously downloaded dependencies. Meanwhile, `--legacy-peer-deps` sounds like it will always skip peer dependencies (whatever those are) during installation even if there are no issues.\nWhat are the differences between the two flags, and when should we use them?",
      "solution": "In the new version of npm (v7), by default, `npm install` will fail when it encounters conflicting peerDependencies. It was not like that before.\nTake a look here for more info about peer dependencies in npm v7.\nThe differences between the two are below -\n\n`--legacy-peer-deps`: ignore all peerDependencies when installing, in the style of npm version 4 through version 6.\n\n`--strict-peer-deps`: fail and abort the install process for any conflicting peerDependencies when encountered. By default, npm will only crash for peerDependencies conflicts caused by the direct dependencies of the root project.\n\n`--force`: will force npm to fetch remote resources even if a local copy exists on disk.",
      "question_score": 263,
      "answer_score": 199,
      "created_at": "2021-02-03T04:27:19",
      "url": "https://stackoverflow.com/questions/66020820/npm-when-to-use-force-and-legacy-peer-deps"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 67652612,
      "title": "ChunkLoadError: Loading chunk node_modules_next_dist_client_dev_noop_js failed",
      "problem": "I've been following the basics tutorial on the Next.js website and when I got to the Global Styles step, I started getting the following runtime error:\n```\n`ChunkLoadError: Loading chunk node_modules_next_dist_client_dev_noop_js failed.\n(error: http://localhost:3000/_next/static/chunks/fallback/node_modules_next_dist_client_dev_noop_js.js)\n`\n```\nError 1:\n\nError 2:\n\nI followed all the steps exactly and when I close the error pop-up, the app works fine.\nIf anyone can provide any guidance on this I'd appreciate it a lot!",
      "solution": "Delete the `.next` folder at the root of your project, relaunch your project, and force-refresh your page (Shift+F5 / Cmd+Shift+R) to remove the cache.\nIt apparently is a cache issue. After browsing through GH Issues & various blog posts, my conclusion is that nobody knows what the heck is going on with this webpack-related error, probably caused by Next.js's behavior.",
      "question_score": 254,
      "answer_score": 664,
      "created_at": "2021-05-22T19:55:10",
      "url": "https://stackoverflow.com/questions/67652612/chunkloaderror-loading-chunk-node-modules-next-dist-client-dev-noop-js-failed"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 73509984,
      "title": "ESLint: TypeError: this.libOptions.parse is not a function",
      "problem": "I was getting started with Next.js on WebStorm 2022.2.1 Build #WS-222.3739.57.\nI created a new Next.js project with TypeScript enabled, and that's all.\nThe error is shown below:\n`TypeError: this.libOptions.parse is not a function\n\nTypeError: this.libOptions.parse is not a function\n    at ESLint8Plugin. (C:\\Program Files\\JetBrains\\WebStorm 2022.1.2\\plugins\\JavaScriptLanguage\\languageService\\eslint\\bin\\eslint8-plugin.js:139:64)\n    at step (C:\\Program Files\\JetBrains\\WebStorm 2022.1.2\\plugins\\JavaScriptLanguage\\languageService\\eslint\\bin\\eslint8-plugin.js:44:23)\n    at Object.next (C:\\Program Files\\JetBrains\\WebStorm 2022.1.2\\plugins\\JavaScriptLanguage\\languageService\\eslint\\bin\\eslint8-plugin.js:25:53)\n    at C:\\Program Files\\JetBrains\\WebStorm 2022.1.2\\plugins\\JavaScriptLanguage\\languageService\\eslint\\bin\\eslint8-plugin.js:19:71\n    at new Promise ()\n    at __awaiter (C:\\Program Files\\JetBrains\\WebStorm 2022.1.2\\plugins\\JavaScriptLanguage\\languageService\\eslint\\bin\\eslint8-plugin.js:15:12)\n    at ESLint8Plugin.invokeESLint (C:\\Program Files\\JetBrains\\WebStorm 2022.1.2\\plugins\\JavaScriptLanguage\\languageService\\eslint\\bin\\eslint8-plugin.js:133:16)\n    at ESLint8Plugin. (C:\\Program Files\\JetBrains\\WebStorm 2022.1.2\\plugins\\JavaScriptLanguage\\languageService\\eslint\\bin\\eslint8-plugin.js:120:44)\n    at step (C:\\Program Files\\JetBrains\\WebStorm 2022.1.2\\plugins\\JavaScriptLanguage\\languageService\\eslint\\bin\\eslint8-plugin.js:44:23)\n    at Object.next (C:\\Program Files\\JetBrains\\WebStorm 2022.1.2\\plugins\\JavaScriptLanguage\\languageService\\eslint\\bin\\eslint8-plugin.js:25:53)\nProcess finished with exit code -1\n`\nMy Node.js version is v16.15.1, and the ESLint version is 8.23.0.\nThis is what my devDependencies look like;\n```\n`  \"devDependencies\": {\n    \"@types/node\": \"18.7.13\",\n    \"@types/react\": \"18.0.17\",\n    \"@types/react-dom\": \"18.0.6\",\n    \"eslint\": \"8.23.0\",\n    \"eslint-config-next\": \"12.2.5\",\n    \"prisma\": \"^4.2.1\",\n    \"typescript\": \"4.8.2\"\n  }\n`\n```\nMy .eslintrc.json file:\n```\n`{\n  \"extends\": \"next/core-web-vitals\"\n}\n`\n```",
      "solution": "The issue is tracked at WEB-57089, and it is fixed in 2022.2.2 preview build.\nThe issue is caused by the changes introduced in ESLint 8.23 (offending upstream commit: View on GitHub). Downgrading ESLint to 8.22.x or earlier (with `npm install eslint@8.22.0 --save-exact`) should help.",
      "question_score": 254,
      "answer_score": 346,
      "created_at": "2022-08-27T11:55:13",
      "url": "https://stackoverflow.com/questions/73509984/eslint-typeerror-this-liboptions-parse-is-not-a-function"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 68774489,
      "title": "punycode is deprecated in npm - what should I replace it with?",
      "problem": "I'm using the npm module `punycode` in my Angular project.\nVsCode tells me it's deprecated and https://nodejs.org/api/punycode.html#punycode_punycode\nconfirms:\n\nThe version of the punycode module bundled in Node.js is being deprecated. In a future major version of Node.js this module will be removed. Users currently depending on the punycode module should switch to using the userland-provided Punycode.js module instead.\n\nThe suggestion is to switch to the 'userland-provided' module.\nWhat is that?\nThere is a link to https://github.com/mathiasbynens/punycode.js and I tried including that in my package.json instead of 'punycode' and I get the same error.",
      "solution": "Recently I faced this same issue.\nI highly recommend you use the LTS(long term support) version of the node.\nYou can validate the version here: https://nodejs.org/en\nso then in your command line you should perform:\n```\n`$nvm install --lts\n$nvm use --lts\n`\n```\nThis solves the problem, because makes you use the most tested and approved version.\nIf I use the version with latest features (actually 21.5.0 at time of writing instead of 20.0.8) I will face the problem reported here. There is an issue open in github to solve it by the way.\nYou can see more details here: https://github.com/yarnpkg/yarn/issues/9005",
      "question_score": 235,
      "answer_score": 167,
      "created_at": "2021-08-13T16:58:19",
      "url": "https://stackoverflow.com/questions/68774489/punycode-is-deprecated-in-npm-what-should-i-replace-it-with"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 70541068,
      "title": "Instead change the require of index.js, to a dynamic import() which is available in all CommonJS modules",
      "problem": "Trying to work with node/javascript/nfts, I am a noob and followed along a tutorial, but I get this error:\n```\n`error [ERR_REQUIRE_ESM]: require() of ES Module [...] is not supported. Instead change the require of index.js [ in my file...]  to a dynamic import() which is available in all CommonJS modules\n`\n```\nMy understanding is that they've updated the node file, so i need a different code than that in the tutorial, but i don't know which one I'm supposed to change, where and to what. Please be as specific as you can\n```\n`const FormData = require('form-data');\nconst fetch = require('node-fetch');\nconst path = require(\"path\")\nconst basePath = process.cwd();\nconst fs = require(\"fs\");\n\nfs.readdirSync(`${basePath}/build/images`).foreach(file).forEach(file => {\n    const formData = new FormData();\n    const fileStream = fs.createReadStream(`${basePath}/build/images/${file}`);\n    formData.append('file',fileStream);\n\n    let url = 'https://api.nftport.xyz/v0/files';\n\n    let options = {\n      method: 'POST',\n      headers: {\n        Authorization: '[...]',\n      },\n      body: formData\n    };\n    \n    fetch(url, options)\n      .then(res => res.json())\n      .then(json => {\n       const fileName = path.parse(json.file_name).name;\n       let rawdata = fs.readFileSync(`${basePath}/build/json/${fileName}.json`);\n       let metaData = JSON.parse(rawdata);\n\n       metaData.file_url = json.ipfs_url;\n\n       fs.writeFileSync(`${basePath}/build/json${fileName}.json`, JSON.stringify(metaData, null, 2));\n\n       console.log(`${json.file_name} uploaded & ${fileName}.json updated!`);\n      })\n      .catch(err => console.error('error:' + err));\n})\n\n`\n```",
      "solution": "It is because of the `node-fetch` package. As recent versions of this package only supports ESM; you have to downgrade it to an older version `node-fetch@2.6.1` or lower.\n`npm i node-fetch@2.6.1`\nThis should solve the issue.",
      "question_score": 218,
      "answer_score": 184,
      "created_at": "2021-12-31T10:55:54",
      "url": "https://stackoverflow.com/questions/70541068/instead-change-the-require-of-index-js-to-a-dynamic-import-which-is-available"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 69665222,
      "title": "Node.js 17.0.1 Gatsby error - &quot;digital envelope routines::unsupported ... ERR_OSSL_EVP_UNSUPPORTED&quot;",
      "problem": "I am building a Gatsby site. I upgraded Node.js to v17.0.1, and when I run a build, there is an error:\n`Error: digital envelope routines::unsupported\n\nopensslErrorStack: [ 'error:03000086:digital envelope routines::initialization error' ],\nlibrary: 'digital envelope routines',\nreason: 'unsupported',\ncode: 'ERR_OSSL_EVP_UNSUPPORTED'\n`\nIf I downgrade it to v16, it works fine, and the build will be successful. How can I fix this?\nFrom googling, this may be a similar issue:\nError: error:06065064:digital envelope routines:EVP_DecryptFinal_ex:bad decrypt #48",
      "solution": "This is most likely an issue with webpack.\n\nIf you are on version 4, this was fixed in version 4.47.0 (release).\nIf you are on version 5, this was fixed in version 5.61.0 (release).\n\nUpgrading webpack to a version beyond what is listed above should address the problem.\nSee this issue for further discussion when the bug was originally noticed:\n\nhttps://github.com/webpack/webpack/issues/14532\n\nUltimately this was related to webpack using `md4` hashes and their fix was to switch to using a WASM implementation of the `md4` algorithm rather than node's builtin (of which node's relies on OpenSSL, hence the error).\nNote that while a member of the webpack team had stated they did not plan to backport the fix to webpack 4, version v4.47.0 nonetheless included a custom `md4` implementation to bring support for Node 18 and above.\n\nOriginal Response:\nGatsby / the tooling used in Gatsby must be using a cryptographic algorithm or key size which is no longer allowed by default with OpenSSL 3.0.\nFrom Node.js 17's announcement post:\n\nIf you hit an `ERR_OSSL_EVP_UNSUPPORTED` error in your application with Node.js 17, it\u2019s likely that your application or a module you\u2019re using is attempting to use an algorithm or key size which is no longer allowed by default with OpenSSL 3.0. A new command-line option, `--openssl-legacy-provider`, has been added to revert to the legacy provider as a temporary workaround for these tightened restrictions.\n\nRunning this on the terminal might look like:\n```\n`node --openssl-legacy-provider ./node_modules/.bin/gatsby build\n`\n```\nYou can also pass this in via the NODE_OPTIONS environment variable.\nSo if you'd like to continue using the NPM script, you can change the `build` script to:\n```\n`// package.json\n{\n  \"scripts\": {\n    \"build\": \"NODE_OPTIONS=--openssl-legacy-provider gatsby build\"\n  }\n}\n`\n```",
      "question_score": 206,
      "answer_score": 114,
      "created_at": "2021-10-21T18:00:47",
      "url": "https://stackoverflow.com/questions/69665222/node-js-17-0-1-gatsby-error-digital-envelope-routinesunsupported-err-os"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 69554485,
      "title": "ESLint - Error: Must use import to load ES Module",
      "problem": "I am currently setting up a boilerplate with React, TypeScript, styled components, Webpack, etc., and I am getting an error when trying to run ESLint:\n\nError: Must use import to load ES Module\n\nHere is a more verbose version of the error:\n`/Users/ben/Desktop/development projects/react-boilerplate-styled-context/src/api/api.ts\n  0:0  error  Parsing error: Must use import to load ES Module: /Users/ben/Desktop/development projects/react-boilerplate-styled-context/node_modules/eslint/node_modules/eslint-scope/lib/definition.js\nrequire() of ES modules is not supported.\nrequire() of /Users/ben/Desktop/development projects/react-boilerplate-styled-context/node_modules/eslint/node_modules/eslint-scope/lib/definition.js from /Users/ben/Desktop/development projects/react-boilerplate-styled-context/node_modules/babel-eslint/lib/require-from-eslint.js is an ES module file as it is a .js file whose nearest parent package.json contains \"type\": \"module\" which defines all .js files in that package scope as ES modules.\nInstead rename definition.js to end in .cjs, change the requiring code to use import(), or remove \"type\": \"module\" from /Users/ben/Desktop/development projects/react-boilerplate-styled-context/node_modules/eslint/node_modules/eslint-scope/package.json\n`\nThe error occurs in every single one of my .js and .ts/ .tsx files where I only use `import` or the file doesn't even have an import at all. I understand what the error is saying, but I don't have any idea why it is being thrown when in fact I only use imports or even no imports at all in some files.\nHere is my package.json file where I trigger the linter from using `npm run lint:eslint:quiet`:\n```\n`{\n  \"name\": \"my-react-boilerplate\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.tsx\",\n  \"directories\": {\n    \"test\": \"test\"\n  },\n  \"engines\": {\n    \"node\": \">=14.0.0\"\n  },\n  \"type\": \"module\",\n  \"scripts\": {\n    \"build\": \"webpack --config webpack.prod.js\",\n    \"dev\": \"webpack serve --config webpack.dev.js\",\n    \"lint\": \"npm run typecheck && npm run lint:css && npm run lint:eslint:quiet\",\n    \"lint:css\": \"stylelint './src/**/*.{js,ts,tsx}'\",\n    \"lint:eslint:quiet\": \"eslint --ext .ts,.tsx,.js,.jsx  ./src --no-error-on-unmatched-pattern --quiet\",\n    \"lint:eslint\": \"eslint --ext .ts,.tsx,.js,.jsx  ./src --no-error-on-unmatched-pattern\",\n    \"lint:eslint:fix\": \"eslint --ext .ts,.tsx,.js,.jsx  ./src --no-error-on-unmatched-pattern --quiet --fix\",\n    \"test\": \"cross-env NODE_ENV=test jest --coverage\",\n    \"test:watch\": \"cross-env NODE_ENV=test jest --watchAll\",\n    \"typecheck\": \"tsc --noEmit\",\n    \"precommit\": \"npm run lint\"\n  },\n  \"lint-staged\": {\n    \"*.{ts,tsx,js,jsx}\": [\n      \"npm run lint:eslint:fix\",\n      \"git add --force\"\n    ],\n    \"*.{md,json}\": [\n      \"prettier --write\",\n      \"git add --force\"\n    ]\n  },\n  \"husky\": {\n    \"hooks\": {\n      \"pre-commit\": \"npx lint-staged && npm run typecheck\"\n    }\n  },\n  \"resolutions\": {\n    \"styled-components\": \"^5\"\n  },\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"@babel/core\": \"^7.5.4\",\n    \"@babel/plugin-proposal-class-properties\": \"^7.5.0\",\n    \"@babel/preset-env\": \"^7.5.4\",\n    \"@babel/preset-react\": \"^7.0.0\",\n    \"@types/history\": \"^4.7.6\",\n    \"@types/react\": \"^17.0.29\",\n    \"@types/react-dom\": \"^17.0.9\",\n    \"@types/react-router\": \"^5.1.17\",\n    \"@types/react-router-dom\": \"^5.1.5\",\n    \"@types/styled-components\": \"^5.1.15\",\n    \"@typescript-eslint/eslint-plugin\": \"^5.0.0\",\n    \"babel-cli\": \"^6.26.0\",\n    \"babel-eslint\": \"^10.0.2\",\n    \"babel-loader\": \"^8.0.0-beta.6\",\n    \"babel-polyfill\": \"^6.26.0\",\n    \"babel-preset-env\": \"^1.7.0\",\n    \"babel-preset-react\": \"^6.24.1\",\n    \"babel-preset-stage-2\": \"^6.24.1\",\n    \"clean-webpack-plugin\": \"^4.0.0\",\n    \"dotenv-webpack\": \"^7.0.3\",\n    \"error-overlay-webpack-plugin\": \"^1.0.0\",\n    \"eslint\": \"^8.0.0\",\n    \"eslint-config-airbnb\": \"^18.2.0\",\n    \"eslint-config-prettier\": \"^8.3.0\",\n    \"eslint-config-with-prettier\": \"^6.0.0\",\n    \"eslint-plugin-compat\": \"^3.3.0\",\n    \"eslint-plugin-import\": \"^2.25.2\",\n    \"eslint-plugin-jsx-a11y\": \"^6.2.3\",\n    \"eslint-plugin-prettier\": \"^4.0.0\",\n    \"eslint-plugin-react\": \"^7.14.2\",\n    \"eslint-plugin-react-hooks\": \"^4.2.0\",\n    \"extract-text-webpack-plugin\": \"^3.0.2\",\n    \"file-loader\": \"^6.2.0\",\n    \"html-webpack-plugin\": \"^5.3.2\",\n    \"husky\": \"^7.0.2\",\n    \"prettier\": \"^2.4.1\",\n    \"raw-loader\": \"^4.0.2\",\n    \"style-loader\": \"^3.3.0\",\n    \"stylelint\": \"^13.13.1\",\n    \"stylelint-config-recommended\": \"^5.0.0\",\n    \"stylelint-config-styled-components\": \"^0.1.1\",\n    \"stylelint-processor-styled-components\": \"^1.10.0\",\n    \"ts-loader\": \"^9.2.6\",\n    \"tslint\": \"^6.1.3\",\n    \"typescript\": \"^4.4.4\",\n    \"url-loader\": \"^4.1.1\",\n    \"webpack\": \"^5.58.2\",\n    \"webpack-cli\": \"^4.2.0\",\n    \"webpack-dev-server\": \"^4.3.1\",\n    \"webpack-merge\": \"^5.3.0\"\n  },\n  \"dependencies\": {\n    \"history\": \"^4.10.0\",\n    \"process\": \"^0.11.10\",\n    \"react\": \"^17.0.1\",\n    \"react-dom\": \"^17.0.1\",\n    \"react-router-dom\": \"^5.2.0\",\n    \"styled-components\": \"^5.2.1\"\n  }\n}\n`\n```\nHere is my .eslintrc file:\n```\n`{\n  \"extends\": [\"airbnb\", \"prettier\"],\n  \"parser\": \"babel-eslint\",\n  \"plugins\": [\"prettier\", \"@typescript-eslint\"],\n  \"parserOptions\": {\n    \"ecmaVersion\": 8,\n    \"ecmaFeatures\": {\n      \"experimentalObjectRestSpread\": true,\n      \"impliedStrict\": true,\n      \"classes\": true\n    }\n  },\n  \"env\": {\n    \"browser\": true,\n    \"node\": true,\n    \"jest\": true\n  },\n  \"rules\": {\n    \"arrow-body-style\": [\"error\", \"as-needed\"],\n    \"class-methods-use-this\": 0,\n    \"react/jsx-filename-extension\": 0,\n    \"global-require\": 0,\n    \"react/destructuring-assignment\": 0,\n    \"import/named\": 2,\n    \"linebreak-style\": 0,\n    \"import/no-dynamic-require\": 0,\n    \"import/no-named-as-default\": 0,\n    \"import/no-unresolved\": 2,\n    \"import/prefer-default-export\": 0,\n    \"semi\": [2, \"always\"],\n    \"max-len\": [\n      \"error\",\n      {\n        \"code\": 80,\n        \"ignoreUrls\": true,\n        \"ignoreComments\": true,\n        \"ignoreStrings\": true,\n        \"ignoreTemplateLiterals\": true\n      }\n    ],\n    \"new-cap\": [\n      2,\n      {\n        \"capIsNew\": false,\n        \"newIsCap\": true\n      }\n    ],\n    \"no-param-reassign\": 0,\n    \"no-shadow\": 0,\n    \"no-tabs\": 2,\n    \"no-underscore-dangle\": 0,\n    \"react/forbid-prop-types\": [\n      \"error\",\n      {\n        \"forbid\": [\"any\"]\n      }\n    ],\n    \"import/no-extraneous-dependencies\": [\"error\", { \"devDependencies\": true }],\n    \"react/jsx-no-bind\": [\n      \"error\",\n      {\n        \"ignoreRefs\": true,\n        \"allowArrowFunctions\": true,\n        \"allowBind\": false\n      }\n    ],\n    \"react/no-unknown-property\": [\n      2,\n      {\n        \"ignore\": [\"itemscope\", \"itemtype\", \"itemprop\"]\n      }\n    ]\n  }\n}\n`\n```\nAnd I\u2019m not sure if it is relevant, but here is also my tsconfig.eslint.json file:\n```\n`{\n  \"extends\": \"./tsconfig.json\",\n  \"include\": [\"./src/**/*.ts\", \"./src/**/*.tsx\", \"./src/**/*.js\"],\n  \"exclude\": [\"node_modules/**\", \"build/**\", \"coverage/**\"]\n}\n`\n```\nHow can I fix this?\nGoogling the error does not present any useful forums or raised bugs. Most of them just state not to use `require` in your files which I am not.",
      "solution": "I think the problem is that you are trying to use the deprecated babel-eslint parser, last updated a year ago, which looks like it doesn't support ES6 modules.  Updating to the latest parser seems to work, at least for simple linting.\nSo, do this:\n\nIn package.json, update the line `\"babel-eslint\": \"^10.0.2\",` to `\"@babel/eslint-parser\": \"^7.5.4\",`.  This works with the code above but it may be better to use the latest version, which at the time of writing is 7.19.1.\nRun `npm i` from a terminal/command prompt in the folder\nIn .eslintrc, update the parser line `\"parser\": \"babel-eslint\",` to `\"parser\": \"@babel/eslint-parser\",`\nIn .eslintrc, add `\"requireConfigFile\": false,` to the parserOptions section (underneath `\"ecmaVersion\": 8,`) (I needed this or babel was looking for config files I don't have)\nRun the command to lint a file\n\nThen, for me with just your two configuration files, the error goes away and I get appropriate linting errors.",
      "question_score": 204,
      "answer_score": 427,
      "created_at": "2021-10-13T13:14:45",
      "url": "https://stackoverflow.com/questions/69554485/eslint-error-must-use-import-to-load-es-module"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 69693907,
      "title": "Error [ERR_PACKAGE_PATH_NOT_EXPORTED]: Package subpath &#39;./lib/tokenize&#39; is not defined by &quot;exports&quot; in the package.json of a module in node_modules",
      "problem": "This is a React web app. When I run\n```\n`npm start\n`\n```\nThis error occurred\n```\n`> dataflow@0.1.0 start\n> react-scripts start\n\nnode:internal/modules/cjs/loader:488\n      throw e;\n  ^\n\nError [ERR_PACKAGE_PATH_NOT_EXPORTED]: Package subpath './lib/tokenize' is not defined by \"exports\" in /Users/juliantc/Desktop/ai-studio/development/frontend/node_modules/postcss-safe-parser/node_modules/postcss/package.json\n    at new NodeError (node:internal/errors:371:5)\n    at throwExportsNotFound (node:internal/modules/esm/resolve:416:9)\n    at packageExportsResolve (node:internal/modules/esm/resolve:669:3)\n    at resolveExports (node:internal/modules/cjs/loader:482:36)\n    at Function.Module._findPath (node:internal/modules/cjs/loader:522:31)\n    at Function.Module._resolveFilename (node:internal/modules/cjs/loader:919:27)\n    at Function.Module._load (node:internal/modules/cjs/loader:778:27)\n    at Module.require (node:internal/modules/cjs/loader:999:19)\n    at require (node:internal/modules/cjs/helpers:102:18)\n    at Object. (/Users/juliantc/Desktop/ai-    studio/development/frontend/node_modules/postcss-safe-parser/lib/safe-parser.js:1:17) {\n  code: 'ERR_PACKAGE_PATH_NOT_EXPORTED'\n}\n\nNode.js v17.0.1\n`\n```\nThis error only occurs when I run this on this specific computer, which I do not have superuser access to. It works on other computers.\nFor reference, this is `./node_modules/postcss-safe-parser/node_modules/postcss/package.json`\n```\n`{\n  \"name\": \"postcss\",\n  \"version\": \"8.2.6\",\n  \"description\": \"Tool for transforming styles with JS plugins\",\n  \"engines\": {\n    \"node\": \"^10 || ^12 || >=14\"\n  },\n  \"exports\": {\n    \".\": {\n      \"require\": \"./lib/postcss.js\",\n      \"import\": \"./lib/postcss.mjs\",\n      \"types\": \"./lib/postcss.d.ts\"\n    },\n    \"./\": \"./\"\n  },\n  \"main\": \"./lib/postcss.js\",\n  \"types\": \"./lib/postcss.d.ts\",\n  \"keywords\": [\n    \"css\",\n    \"postcss\",\n    \"rework\",\n    \"preprocessor\",\n    \"parser\",\n    \"source map\",\n    \"transform\",\n    \"manipulation\",\n    \"transpiler\"\n  ],\n  \"funding\": {\n    \"type\": \"opencollective\",\n    \"url\": \"https://opencollective.com/postcss/\"\n  },\n  \"author\": \"Andrey Sitnik \",\n  \"license\": \"MIT\",\n  \"homepage\": \"https://postcss.org/\",\n  \"repository\": \"postcss/postcss\",\n  \"dependencies\": {\n    \"colorette\": \"^1.2.1\",\n    \"nanoid\": \"^3.1.20\",\n    \"source-map\": \"^0.6.1\"\n  },\n  \"browser\": {\n    \"./lib/terminal-highlight\": false,\n    \"colorette\": false,\n    \"fs\": false\n  }\n}\n`\n```\nAnd this is what I get when I list the files in ./node_modules/postcss-safe-parser/node_modules/postcss/lib/\nlgtd-lt-119-mbmt:frontend juliantc$ ls ./node_modules/postcss-safe-parser/node_modules/postcss/lib/\n```\n`at-rule.d.ts        css-syntax-error.d.ts   input.d.ts      map-generator.js    postcss.d.ts        processor.js        rule.js         tokenize.js\nat-rule.js      css-syntax-error.js input.js        node.d.ts       postcss.js      result.d.ts     stringifier.js      warn-once.js\ncomment.d.ts        declaration.d.ts    lazy-result.d.ts    node.js         postcss.mjs     result.js       stringify.d.ts      warning.d.ts\ncomment.js      declaration.js      lazy-result.js      parse.d.ts      previous-map.d.ts   root.d.ts       stringify.js        warning.js\ncontainer.d.ts      fromJSON.d.ts       list.d.ts       parse.js        previous-map.js     root.js         symbols.js\ncontainer.js        fromJSON.js     list.js         parser.js       processor.d.ts      rule.d.ts       terminal-highlight.js\n`\n```",
      "solution": "I'm also stuck with the same problem because I installed the latest version of Node.js.\n\nFor Linux users who use NVM to manage node\n```\n`nvm uninstall \n`\n```\nnow install the `LTS` version\n```\n`nvm install --lts\n`\n```\nThis worked for me.\n\nOR\n\nTry to delete Node_modules and the lock file\n\nDelete your `node_modules` folder, `package-lock.json` or `yarn.lock`\n\nRe-Install all the dependencies.\n```\n`npm i\n`\n```\nor\n```\n`yarn\n`\n```\n\nFor a better understanding of how to install node, check out this blog by digital ocean\nhttps://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-20-04",
      "question_score": 188,
      "answer_score": 168,
      "created_at": "2021-10-24T06:31:30",
      "url": "https://stackoverflow.com/questions/69693907/error-err-package-path-not-exported-package-subpath-lib-tokenize-is-not-d"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 72013449,
      "title": "Upgrading Jest to v29 - Error Test environment jest-environment-jsdom cannot be found",
      "problem": "Has anyone successfully upgraded to latest Jest version `29`?\nI'm receiving an error:\n`Error: Test environment jest-environment-jsdom cannot be found. Make sure the testEnvironment configuration option points to an existing node module.\n`",
      "solution": "Jest team added more descriptive error message in version `28.0.1`\n`Error:...\nAs of Jest 28 \"jsdom\" is no longer shipped by default, make sure to install it separately.\n`\nInstalling `jsdom` package resolves the issue:\n`# npm\nnpm install -D jest-environment-jsdom\n# yarn\nyarn add -D jest-environment-jsdom\n`",
      "question_score": 149,
      "answer_score": 295,
      "created_at": "2022-04-26T13:51:19",
      "url": "https://stackoverflow.com/questions/72013449/upgrading-jest-to-v29-error-test-environment-jest-environment-jsdom-cannot-be"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 69041454,
      "title": "Error: require() of ES modules is not supported when importing node-fetch",
      "problem": "I'm creating a program to analyze security camera streams and got stuck on the very first line. At the moment my .js file has nothing but the import of node-fetch and it gives me an error message. What am I doing wrong?\nRunning Ubuntu 20.04.2 LTS in Windows Subsystem for Linux.\nNode version:\n```\n`user@MYLLYTIN:~/CAMSERVER$ node -v\nv14.17.6\n`\n```\nnode-fetch package version:\n```\n`user@MYLLYTIN:~/CAMSERVER$ npm v node-fetch\n\nnode-fetch@3.0.0 | MIT | deps: 2 | versions: 63\nA light-weight module that brings Fetch API to node.js\nhttps://github.com/node-fetch/node-fetch\n\nkeywords: fetch, http, promise, request, curl, wget, xhr, whatwg\n\ndist\n.tarball: https://registry.npmjs.org/node-fetch/-/node-fetch-3.0.0.tgz\n.shasum: 79da7146a520036f2c5f644e4a26095f17e411ea\n.integrity: sha512-bKMI+C7/T/SPU1lKnbQbwxptpCrG9ashG+VkytmXCPZyuM9jB6VU+hY0oi4lC8LxTtAeWdckNCTa3nrGsAdA3Q==\n.unpackedSize: 75.9 kB\n\ndependencies:\ndata-uri-to-buffer: ^3.0.1 fetch-blob: ^3.1.2         \n\nmaintainers:\n- endless \n- bitinn \n- timothygu \n- akepinski \n\ndist-tags:\nlatest: 3.0.0        next: 3.0.0-beta.10  \n\npublished 3 days ago by endless \n`\n```\nesm package version:\n```\n`user@MYLLYTIN:~/CAMSERVER$ npm v esm\n\nesm@3.2.25 | MIT | deps: none | versions: 140\nTomorrow's ECMAScript modules today!\nhttps://github.com/standard-things/esm#readme\n\nkeywords: commonjs, ecmascript, export, import, modules, node, require\n\ndist\n.tarball: https://registry.npmjs.org/esm/-/esm-3.2.25.tgz\n.shasum: 342c18c29d56157688ba5ce31f8431fbb795cc10\n.integrity: sha512-U1suiZ2oDVWv4zPO56S0NcR5QriEahGtdN2OR6FiOG4WJvcjBVFB0qI4+eKoWFH483PKGuLuu6V8Z4T5g63UVA==\n.unpackedSize: 308.6 kB\n\nmaintainers:\n- jdalton \n\ndist-tags:\nlatest: 3.2.25  \n\npublished over a year ago by jdalton \n`\n```\nContents of the .js file (literally nothing but the import):\n```\n`user@MYLLYTIN:~/CAMSERVER$ cat server.js \nimport fetch from \"node-fetch\";\n`\n```\nResult:\n```\n`user@MYLLYTIN:~/CAMSERVER$ node -r esm server.js \n/home/user/CAMSERVER/node_modules/node-fetch/src/index.js:1\nError [ERR_REQUIRE_ESM]: Must use import to load ES Module: /home/user/CAMSERVER/node_modules/node-fetch/src/index.js\nrequire() of ES modules is not supported.\nrequire() of /home/user/CAMSERVER/node_modules/node-fetch/src/index.js from /home/user/CAMSERVER/server.js is an ES module file as it is a .js file whose nearest parent package.json contains \"type\": \"module\" which defines all .js files in that package scope as ES modules.\nInstead rename index.js to end in .cjs, change the requiring code to use import(), or remove \"type\": \"module\" from /home/user/CAMSERVER/node_modules/node-fetch/package.json.\n\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1089:13) {\n  code: 'ERR_REQUIRE_ESM'\n}\nuser@MYLLYTIN:~/CAMSERVER$ \n`\n```",
      "solution": "`node-fetch` v3 is ESM-only: https://github.com/node-fetch/node-fetch#loading-and-configuring-the-module. The `esm` module you\u2019re adding is for adding ESM compatibility, but it\u2019s unnecessary now that Node 12+ supports ESM natively; and it doesn\u2019t work with ESM-only packages like `node-fetch` 3+.\nTo fix your issue:\n\nRemove the `esm` package.\nAdd `\"type\": \"module\"` to your `package.json`.\n\nAnd that\u2019s it. Then when you run `node server.js` it should work.",
      "question_score": 132,
      "answer_score": 18,
      "created_at": "2021-09-03T10:01:10",
      "url": "https://stackoverflow.com/questions/69041454/error-require-of-es-modules-is-not-supported-when-importing-node-fetch"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 70309135,
      "title": "chalk - Error [ERR_REQUIRE_ESM]: require() of ES Module",
      "problem": "Hi tried to install chalk on my very simple app and then i got error:\n```\n`Error [ERR_REQUIRE_ESM]: require() of ES Module my-file-is-here  and chalk\\node_modules\\chalk\\source\\index.js from my-file-is-here not supported.\nInstead change the require of index.js in my-file-is-here to a dynamic import() which is available in all CommonJS modules.\n    at Object. (`my-file-is-here`) {\n  code: 'ERR_REQUIRE_ESM'\n}\n`\n```\nthats my code:\n```\n`const os = require(\"os\")\nconst chalk = require(\"chalk\")\n\nconsole.log(\"app running\")\n`\n```",
      "solution": "Chalk 5 has changed to ESM. They provide a link to better understand what that means: Pure ESM.\nFrom chalk README:\n\nIMPORTANT: Chalk 5 is ESM. If you want to use Chalk with TypeScript or a build tool, you will probably want to use Chalk 4 for now.\n\nAs of this reply, the last version of chalk 4 is `4.1.2`.",
      "question_score": 124,
      "answer_score": 183,
      "created_at": "2021-12-10T19:48:43",
      "url": "https://stackoverflow.com/questions/70309135/chalk-error-err-require-esm-require-of-es-module"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 65554910,
      "title": "jest ReferenceError: Cannot access &#39;&#39; before initialization",
      "problem": "I'm getting the error:\n`ReferenceError: Cannot access 'myMock' before initialization`\nEven though i respected jest documentation about the hoisting:\n`A limitation with the factory parameter is that, since calls to jest.mock() are hoisted to the top of the file, it's not possible to first define a variable and then use it in the factory. An exception is made for variables that start with the word 'mock'.`\nI'm doing this:\n`import MyClass from './my_class';\nimport * as anotherClass from './another_class';\n\nconst mockMethod1 = jest.fn();\nconst mockMethod2 = jest.fn();\njest.mock('./my_class', () => {\n  return {\n    default: {\n      staticMethod: jest.fn().mockReturnValue(\n        {\n          method1: mockMethod1,\n          method2: mockMethod2,\n        })\n    }\n  }\n});\n`\nas you can see both of my variables respect the \"standard\" but are not hoisted properly.\nAm I missing something ?\nObviously it works when I just pass `jest.fn()` instead of my variables, but i'm not sure how to be able to use these in my test later on.",
      "solution": "The accepted answer does not handle when you need to spy on the `const` declaration, as it is defined inside the module factory scope.\nFor me, the module factory needs to be above any import statement that eventually imports the thing you want to mock.\nHere is a code snippet using a nestjs with prisma library.\n```\n`// app.e2e.spec.ts\nimport { Test, TestingModule } from '@nestjs/testing';\nimport { INestApplication } from '@nestjs/common';\nimport * as request from 'supertest';\nimport mockPrismaClient from './utils/mockPrismaClient'; // you can assert, spy, etc. on this object in your test suites.\n\n// must define this above the `AppModule` import, otherwise the ReferenceError is raised.\njest.mock('@prisma/client', () => {\n  return {\n    PrismaClient: jest.fn().mockImplementation(() => mockPrismaClient),\n  };\n});\n\nimport { AppModule } from './../src/app.module'; // somwhere here, the prisma is imported\n\ndescribe('AppController (e2e)', () => {\n  let app: INestApplication;\n\n  beforeEach(async () => {\n    const moduleFixture: TestingModule = await Test.createTestingModule({\n      imports: [AppModule],\n    }).compile();\n\n    app = moduleFixture.createNestApplication();\n    await app.init();\n  });\n)};\n`\n```",
      "question_score": 112,
      "answer_score": 35,
      "created_at": "2021-01-03T22:03:07",
      "url": "https://stackoverflow.com/questions/65554910/jest-referenceerror-cannot-access-before-initialization"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 71463698,
      "title": "Why we need &quot;nodenext&quot; typescript compiler option when we have &quot;esnext&quot;?",
      "problem": "In the typescript compiler options #module we've a bunch of options including `nodenext` and `esnext`, where `nodenext` is experimental (as of now).\nWhy we need this additional `nodenext` option when the `esnext` option seem already working with node.js?\nOr rephrased in other words, what is the difference between `nodenext` and `esnext`?\n\nsource: https://github.com/microsoft/TypeScript/issues/46452#issuecomment-1066771513",
      "solution": "`module` and `moduleResolution`\nThe first thing that needs clarification is the difference the `module` and `moduleResolution` compiler options. The former is an emit setting: what module-related code will tsc be willing to emit to JS? The easiest way to see the effect of this option is by toggling between settings `commonjs` and `esnext`:\n\nInput code\nOutput `--module commonjs`\nOutput `--module esnext`\n\n`import { createSourceFile } from \"typescript\"`\n`\"use strict\"; Object.defineProperty(exports, \"__esModule\", { value: true }); const typescript_1 = require(\"typescript\");`\n`import { createSourceFile } from \"typescript\"`\n\nWhile this setting fundamentally controls emit, it can impose limitations on what module-related input code is allowed. For example, you cannot write imports in the style of `import fs = require(\"fs\")` under `--module es2015` (or higher ES targets) because there is no `require` to speak of in the ES module system. Additionally, using top-level `await` is only allowed in `--module es2022` (or higher) or `system` because it requires corresponding support in the module loading system.\nOn the other hand, `--moduleResolution` is all about the algorithm used to answer the question \u201cgiven a file system and some input file containing an import from `\"lodash\"`, what files should I look for to find that module?\u201d Obviously, the decision to look in a folder with a magical name `node_modules` is one related to Node (albeit one that a huge amount of non-Node tooling has copied for convenience), and is not going to be correct for every possible runtime.\nDifferences in `moduleResolution`\nWith this context, we\u2019re ready to begin answering your question directly. The biggest, most noticeable difference between `--module nodenext` and `--module esnext` is that the former implies `--moduleResolution nodenext`, a new resolution mode designed for Node\u2019s specific implementation of co-existing ESM and CJS, while the latter does not imply a `moduleResolution` setting because there is no such corresponding setting in TypeScript right now. Put another way, when you say you\u2019re using `--module esnext`, you\u2019re allowed to write, and we will emit, the latest and greatest ES module code constructs, but we will not do anything differently with deciding how imports resolve. You\u2019ll likely continue using `--moduleResolution node`, which was designed for Node\u2019s implementation of CJS. What does this mean for you? If you\u2019re writing ESM for Node, you can probably make some stuff work with `--module esnext` and `--moduleResolution node`, but newer Node-specific features like package.json exports won\u2019t work, and it will be extremely easy to shoot yourself in the foot when writing import paths. Paths will be evaluated by tsc under Node\u2019s CJS rules, but then at runtime, Node will evaluate them under its ESM rules since you\u2019re emitting ESM. There are significant differences between these algorithms\u2014notably, the latter requires relative imports to use file extensions instead of dropping the `.js`, and `index` files have no special meaning, so you can\u2019t import the index file just by naming the path to the directory.\nDifferences in `module`\nThe difference observable in the `--module` setting itself is a bit more subtle. As I mentioned before, in `esnext` you aren\u2019t allowed to write `import Foo = require(\"bar\")` because we assume there is no `require`. In `nodenext`, we know that a given module might be an ES module or it might be a CJS module, based on its file extension (`.mts` \u2192 `.mjs` implies ESM and `.cts` \u2192 `.cjs` implies CJS) and/or the `type` field in the nearest package.json file. `--module nodenext` enables looking at these things to make decisions about what kind of module a given file is, which controls what kind of module output we emit. If the aforementioned conditions result in a module being interpreted as CJS, the output for that file is nearly identical (maybe identical?) to what you\u2019d get from `--module commonjs`. If the module is interpreted as ESM, the output is very similar to what you\u2019d get from `--module esnext`, with one exception I can recall off the top of my head: you\u2019re still allowed to write `import Foo = require(\"bar\")`, and that gets compiled to:\n```\n`import { createRequire as _createRequire } from \"module\";\nconst __require = _createRequire(import.meta.url);\nconst Foo = __require(\"bar\");\n`\n```\nSummary\nI think the answer to your question can be summarized like this:\n\nNode 12+ has support for CJS and ESM side-by-side, indicated by package.json `type` and special file extensions, so we need a module emit mode that understands that stuff. That mode can be thought of roughly as a Node-based selector between the existing `commonjs` and `esnext` modes, with a few additional little differences tailored to Node.\nNode 12+ also brings major new features to how module specifiers in packages can resolve, and enforces a different and much stricter resolution algorithm specifically for ESM imports. Without a matching TypeScript resolution mode, we both fail to resolve in the face of those new features and let you write paths that won\u2019t resolve in ESM resolution.",
      "question_score": 108,
      "answer_score": 207,
      "created_at": "2022-03-14T07:22:24",
      "url": "https://stackoverflow.com/questions/71463698/why-we-need-nodenext-typescript-compiler-option-when-we-have-esnext"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 68707553,
      "title": "Uncaught ReferenceError: Buffer is not defined",
      "problem": "Our application kept showing the error in the title. The problem is very likely related to Webpack 5 polyfill and after going through a couple of solutions:\n\nSetting fallback + install with npm\n\n```\n`fallback: {\n  \"stream\": require.resolve(\"stream-browserify\"),\n  \"buffer\": require.resolve(\"buffer/\")\n}\n`\n```\n\nSetting alias\n\n```\n`alias: {\n  \"buffer\": \"buffer\",\n  \"stream\": \"stream-browserify\"\n}\n`\n```\nWe are still seeing the dreadful error:\n```\n`rfc6979.js:3 Uncaught ReferenceError: Buffer is not defined\n    at Object.4142 (rfc6979.js:3)\n    at r (bootstrap:19)\n    at Object.5892 (js.js:4)\n    at r (bootstrap:19)\n    at Object.4090 (bip32.js:5)\n    at r (bootstrap:19)\n    at Object.7786 (index.js:3)\n    at r (bootstrap:19)\n    at Object.1649 (MnemonicKey.js:50)\n    at r (bootstrap:19)\n`\n```\nOur setup is vanilla NodeJS + TypeScript + Webpack for multi-target: node + browser. Any help would be great!",
      "solution": "Answering my own question. Two things helped to resolve the issue:\n\nAdding plugins section with ProviderPlugin into webpack.config.js\n\n```\n`const webpack = require('webpack');\n\nmodule.exports = {\n    // ...\n\n    plugins: [\n        // Work around for Buffer is undefined:\n        // https://github.com/webpack/changelog-v5/issues/10\n        new webpack.ProvidePlugin({\n            Buffer: ['buffer', 'Buffer'],\n        }),\n        new webpack.ProvidePlugin({\n            process: 'process/browser',\n        }),\n    ],\n\n`\n```\n\nAlso add in resolve.fallback into webpack.config.js:\n\n```\n`    resolve: {\n        extensions: [ '.ts', '.js' ],\n        fallback: {\n            \"stream\": require.resolve(\"stream-browserify\"),\n            \"buffer\": require.resolve(\"buffer\")\n        }\n    },\n\n`\n```",
      "question_score": 107,
      "answer_score": 113,
      "created_at": "2021-08-09T08:14:25",
      "url": "https://stackoverflow.com/questions/68707553/uncaught-referenceerror-buffer-is-not-defined"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 72866798,
      "title": "Error message &quot;node: --openssl-legacy-provider is not allowed in NODE_OPTIONS&quot;",
      "problem": "This problem appeared after an update, `sudo apt upgrade`, on Ubuntu\u00a020.04 (Focal Fossa).\nPreviously, I worked on versions Node.js v18.0.0 and npm 8.7.0, but after the update there was a problem. I ran command `nvm install node --reinstall-packages-from=node`, but it did not help.\nNow I use npm v8.12.1 and Node.js v18.4.0.\nWhen running the command `npm start`, I receive the message:\n`> mini-app@0.0.0 start\n> cross-env PORT=10888 HTTPS=false react-scripts start --openssl-legacy-provider\n\nnode: --openssl-legacy-provider is not allowed in NODE_OPTIONS\n`\npart of a file, package.json, looks like this :\n` \"scripts\": {\n    \"start\": \"cross-env PORT=10888 HTTPS=false react-scripts start --openssl-legacy-provider\",\n    \"build\": \"react-scripts build\",\n    \"predeploy\": \"npm run build\",\n    \"deploy\": \"vk-miniapps-deploy\",\n    \"tunnel\": \"vk-tunnel --insecure=1 --http-protocol=https --ws-protocol=wss --host=localhost --port=10888\"\n  },\n`\nI went back to version npm 8.7.0, `npm install -g npm@8.7.0`, but now even the output of Node.js version  shows the same error:\n`node -v\n`\nOutput:\n`node: --openssl-legacy-provider is not allowed in NODE_OPTIONS\n`\nAttempt to update:\n`nvm install 12.13.0\n`\nOutput:\n`v12.13.0 is already installed.\nNow using node v12.13.0 (npm v)\n`",
      "solution": "You can try to perform an unset on the NODE_OPTIONS production variable. It can be done from the command line.\nYour Node.js version seems already up-to-date (version 18). A similar problem was already treated and solved according to the GitHub page Running code via CLI triggers error: --openssl-legacy-provider is not allowed in NODE_OPTIONS #136599.",
      "question_score": 106,
      "answer_score": 6,
      "created_at": "2022-07-05T11:10:14",
      "url": "https://stackoverflow.com/questions/72866798/error-message-node-openssl-legacy-provider-is-not-allowed-in-node-options"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 66486903,
      "title": "Top-level \u2018await\u2019 expressions are only allowed when the \u2018module\u2019 option is set to \u2018esnext&#39;",
      "problem": "I am going through Stripes integration steps and have come across an error for my code found in step 2.1 (https://stripe.com/docs/connect/collect-then-transfer-guide#create-an-account-link)\nHow do I fix this error?\nCode:\n```\n`const stripe = require('stripe')('someID');\nconst account = await stripe.accounts.create({\n  type: 'express',\n});\n`\n```\nError:\n\nTop-level 'await' expressions are only allowed when the 'module'\noption is set to 'esnext' or 'system', and the 'target' option is set\nto 'es2017' or higher.ts(1378)",
      "solution": "You can wrap your code for const account inside an async function as your target option doesn't support top level await.\n```\n` const account = async () => {\n    await stripe.accounts.create({\n       type: \"express\",\n    });\n };\n`\n```\nIt depends on your code whether you want to return something or you want to perform some other tasks after await.\nIncase if you want to use top level await, More about using top level await is on https://stackoverflow.com/a/56590390/9423152\nThis it just a workaround of the problem not the exact solution as referred by other users.\nFurthermore,\nYou can try changing the module option and target in tsconfig file if you are using Typescript on node.",
      "question_score": 104,
      "answer_score": 49,
      "created_at": "2021-03-05T05:43:01",
      "url": "https://stackoverflow.com/questions/66486903/top-level-await-expressions-are-only-allowed-when-the-module-option-is-set-t"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 67063993,
      "title": "sh: husky: command not found",
      "problem": "I've setup a node project with husky but when my collegue tries to run `npm install` on his Mac he gets the following error :\n```\n`noa-be@1.0.0 prepare\nhusky install\n\nsh: husky: command not found\nnpm ERR! code 127\nnpm ERR! path /Users/X/Desktop/Workspace/project\nnpm ERR! command failed\nnpm ERR! command sh -c husky install\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     /Users/X/.npm/_logs/2021-04-12T13_07_25_842Z-debug.log\n`\n```\nThese are the relevant package.json parts:\n`{\n    \"scripts\": {\n        \"prepare\": \"husky install\"\n    },\n    \"devDependencies\": {\n        \"husky\": \"^5.2.0\",\n    }\n}\n`\nI thought this would be enough for husky to be installed when running `npm install`, but it's not. What am I missing?",
      "solution": "I've been able to solve the problem by upgrading to latest Husky version (7.0.1, from 5.2.0).\nGit was also helpful, and told me that the files weren't executables. (Git V 2.24.1)\nSo I give them executable rights :\n```\n`chmod +x PATH_TO_HUSKY_FILE\n`\n```\nYou'll need to execute this command for every hooks",
      "question_score": 103,
      "answer_score": 12,
      "created_at": "2021-04-12T20:43:10",
      "url": "https://stackoverflow.com/questions/67063993/sh-husky-command-not-found"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 67833794,
      "title": "npm ERR! could not determine executable to run",
      "problem": "I want to run my project by `npm run watch` and when I do nothing, it suddenly appears an error like this.\n```\n`git:(master) \u2717 npm run watch\n\n> watch\n> npx mix watch\n\nnpm ERR! could not determine executable to run\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     /Users/bintangtobing/.npm/_logs/2021-06-04T08_11_16_499Z-debug.log\n`\n```\nDoes anyone know about these errors?\nI have already did a solution,\nit is delete node_modules on the project folder and run an `npm install` and it still got the same error.",
      "solution": "Ended up doing\n```\n`rm -rf .git/hooks\nnpm install\n`\n```\nFollowin this sugestion https://github.com/npm/cli/issues/1845#issuecomment-814884999\nWorked for me",
      "question_score": 100,
      "answer_score": 139,
      "created_at": "2021-06-04T10:16:51",
      "url": "https://stackoverflow.com/questions/67833794/npm-err-could-not-determine-executable-to-run"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 69087292,
      "title": "require(&#39;node-fetch&#39;) gives ERR_REQUIRE_ESM",
      "problem": "I just use\n`const fetch = require('node-fetch')\n`\nAnd I get\n`Error [ERR_REQUIRE_ESM]: require() of ES Module C:\\Users\\Alex\\Desktop\\rollbot\\node_modules\\node-fetch\\src\\index.js from C:\\Users\\Alex\\Desktop\\rollbot\\index.js not supported.\nInstead change the require of C:\\Users\\Alex\\Desktop\\rollbot\\node_modules\\node-fetch\\src\\index.js in C:\\Users\\Alex\\Desktop\\rollbot\\index.js to a \ndynamic import() which is available in all CommonJS modules.\n{\n  code: 'ERR_REQUIRE_ESM'\n}\n`\nAll my other packages work, just node-fetch does this. What should I do in order to use node-fetch?",
      "solution": "From the `node-fetch` package readme:\n\nnode-fetch is an ESM-only module - you are not able to import it with\nrequire. We recommend you stay on v2 which is built with CommonJS\nunless you use ESM yourself. We will continue to publish critical bug\nfixes for it.\n\nIf you want to `require` it, then downgrade to v2.\nThe other option you have is to use async `import('node-fetch').then(...)`",
      "question_score": 97,
      "answer_score": 68,
      "created_at": "2021-09-07T13:19:59",
      "url": "https://stackoverflow.com/questions/69087292/requirenode-fetch-gives-err-require-esm"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 67114659,
      "title": "npm ERR! code E401 npm ERR! Incorrect or missing password",
      "problem": "My Node version is 10.15.0 and NPM version is 6.8.4\nOn running npm install after upgrading\nnpm to 14.16.0 and npm to 7.6.2\nGetting this error -\n```\n`npm ERR! code E401\nnpm ERR! Incorrect or missing password.\nnpm ERR! If you were trying to login, change your password, create an\nnpm ERR! authentication token or enable two-factor authentication then\nnpm ERR! that means you likely typed your password in incorrectly.\nnpm ERR! Please try again, or recover your password at:\nnpm ERR!     https://www.npmjs.com/forgot\nnpm ERR! \nnpm ERR! If you were doing some other operation then your saved credentials are\nnpm ERR! probably out of date. To correct this please try logging in again with:\nnpm ERR!     npm login\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     /Users/xyz/.npm/_logs/2021-04-15T18_55_07_993Z-debug.log\n`\n```",
      "solution": "Try Deleting the package-lock.json file before running the command \"npm install\" after upgrading the node versions, if you have not done that.\n\nIf that will not work try removing the .npmrc file in $HOME directory as mentioned in this post.\n\nNPM ERR Code E401: Unable to authenticate, need: Bearer authorization\nNote - Deleting package-lock.json can have its own issues as mentioned in this posts, so go with this solution unless you find any better solution.\nDeleting `package-lock.json` to Resolve Conflicts quickly",
      "question_score": 95,
      "answer_score": 112,
      "created_at": "2021-04-15T21:06:35",
      "url": "https://stackoverflow.com/questions/67114659/npm-err-code-e401-npm-err-incorrect-or-missing-password"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 69719601,
      "title": "Getting error &#39;digital envelope routines&#39;, reason: &#39;unsupported&#39;, code: &#39;ERR_OSSL_EVP_UNSUPPORTED&#39;",
      "problem": "I got this error when learning Next.js, using `npx create-next-app` command according to site documentation here https://nextjs.org/docs/api-reference/create-next-app. Everything works until I start the server,\nError stack:\n```\n`$ npm run dev\n\n> devto-clone@0.1.0 dev\n> next dev\n\nready - started server on 0.0.0.0:3000, url: http://localhost:3000\ninfo  - Using webpack 5. Reason: Enabled by default https://nextjs.org/docs/messages/webpack5\nError: error:0308010C:digital envelope routines::unsupported\n    at new Hash (node:internal/crypto/hash:67:19)\n    at Object.createHash (node:crypto:130:10)\n    at BulkUpdateDecorator.hashFactory (C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:138971:18)\n    at BulkUpdateDecorator.update (C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:138872:50)\n    at OriginalSource.updateHash (C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack-sources3\\index.js:1:10264)\n    at NormalModule._initBuildHash (C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:68468:17)\n    at handleParseResult (C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:68534:10)\n    at C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:68628:4\n    at processResult (C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:68343:11)\n    at C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:68407:5\nError: error:0308010C:digital envelope routines::unsupported\n    at new Hash (node:internal/crypto/hash:67:19)\n    at Object.createHash (node:crypto:130:10)\n    at BulkUpdateDecorator.hashFactory (C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:138971:18)\n    at BulkUpdateDecorator.update (C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:138872:50)\n    at OriginalSource.updateHash (C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack-sources3\\index.js:1:10264)\n    at NormalModule._initBuildHash (C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:68468:17)\n    at handleParseResult (C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:68534:10)\n    at C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:68628:4\n    at processResult (C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:68343:11)\n    at C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:68407:5\nnode:internal/crypto/hash:67\n  this[kHandle] = new _Hash(algorithm, xofLen);\n                  ^\n\nError: error:0308010C:digital envelope routines::unsupported\n    at new Hash (node:internal/crypto/hash:67:19)\n    at Object.createHash (node:crypto:130:10)\n    at BulkUpdateDecorator.hashFactory (C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:138971:18)\n    at BulkUpdateDecorator.update (C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:138872:50)\n    at OriginalSource.updateHash (C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack-sources3\\index.js:1:10264)\n    at NormalModule._initBuildHash (C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:68468:17)\n    at handleParseResult (C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:68534:10)\n    at C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:68628:4\n    at processResult (C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:68343:11)\n    at C:\\xampp\\htdocs\\devto-clone\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:68407:5 {\n  opensslErrorStack: [ 'error:03000086:digital envelope routines::initialization error' ],\n  library: 'digital envelope routines',\n  reason: 'unsupported',\n  code: 'ERR_OSSL_EVP_UNSUPPORTED'\n}\n\nNode.js v17.0.1\n`\n```\npackage.json :\n`{\n  \"name\": \"devto-clone\",\n  \"version\": \"0.1.0\",\n  \"private\": true,\n  \"scripts\": {\n    \"dev\": \"next dev\",\n    \"build\": \"next build\",\n    \"start\": \"next start\",\n    \"lint\": \"next lint\"\n  },\n  \"dependencies\": {\n    \"next\": \"11.1.2\",\n    \"react\": \"17.0.2\",\n    \"react-dom\": \"17.0.2\"\n  },\n  \"devDependencies\": {\n    \"eslint\": \"7.32.0\",\n    \"eslint-config-next\": \"11.1.2\"\n  }\n}\n`",
      "solution": "I found this solution https://github.com/webpack/webpack/issues/14532\n\nif using bash just run `NODE_OPTIONS=--openssl-legacy-provider` before any command\n\nadding `NODE_OPTIONS=--openssl-legacy-provider` to package.json\n`\"scripts\": {\n   \"start\": \"SET NODE_OPTIONS=--openssl-legacy-provider && react-scripts start\",\n   \"build\": \"SET NODE_OPTIONS=--openssl-legacy-provider && react-scripts build\"\n },\n`\n\nEdit\nIn my case, I'm using Nodejs 17.0.1 version and causing this error.\nFirstly I'm using this command `export NODE_OPTIONS=--openssl-legacy-provider` before any command in GitBash Windows to fix this issue.\nBut, I think it's not an efficient way, so what I do is :\n\nUninstall Nodejs 17.0.1\nInstall it again Nodejs 16.13.0 version\nI'm facing error another error when I start the server using \"yarn serve\" (another of my exiting Vuejs project), I don't remember what is this, but after I run \"yarn\" and \"yarn serve\", everything works now as I accept",
      "question_score": 93,
      "answer_score": 178,
      "created_at": "2021-10-26T10:10:16",
      "url": "https://stackoverflow.com/questions/69719601/getting-error-digital-envelope-routines-reason-unsupported-code-err-oss"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 69647332,
      "title": "Cannot read properties of undefined (reading &#39;transformFile&#39;) at Bundler.transformFile",
      "problem": "I have updated `node` today and I'm getting this error:\n```\n`error: TypeError: Cannot read properties of undefined (reading 'transformFile')\n    at Bundler.transformFile (/Users/.../node_modules/metro/src/Bundler.js:48:30)\n    at runMicrotasks ()\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\n    at async Object.transform (/Users/.../node_modules/metro/src/lib/transformHelpers.js:101:12)\n    at async processModule (/Users/.../node_modules/metro/src/DeltaBundler/traverseDependencies.js:137:18)\n    at async traverseDependenciesForSingleFile (/Users/.../node_modules/metro/src/DeltaBundler/traverseDependencies.js:131:3)\n    at async Promise.all (index 0)\n    at async initialTraverseDependencies (/Users/.../node_modules/metro/src/DeltaBundler/traverseDependencies.js:114:3)\n    at async DeltaCalculator._getChangedDependencies (/Users/.../node_modules/metro/src/DeltaBundler/DeltaCalculator.js:164:25)\n    at async DeltaCalculator.getDelta (/Users/.../node_modules/metro/src/DeltaBundler/DeltaCalculator.js:94:16)\n`\n```\nOther than that I haven't done anything unusual, so I'm not sure what to share. If I'm missing any info please comment and I'll add it.\nWhile building the terminal also throws this error:\n```\n`Failed to construct transformer:  Error: error:0308010C:digital envelope routines::unsupported\n    at new Hash (node:internal/crypto/hash:67:19)\n    at Object.createHash (node:crypto:130:10)\n    at stableHash (/Users/.../node_modules/metro-cache/src/stableHash.js:19:8)\n    at Object.getCacheKey (/Users/.../node_modules/metro-transform-worker/src/index.js:593:7)\n    at getTransformCacheKey (/Users/.../node_modules/metro/src/DeltaBundler/getTransformCacheKey.js:24:19)\n    at new Transformer (/Users/.../node_modules/metro/src/DeltaBundler/Transformer.js:48:9)\n    at /Users/.../node_modules/metro/src/Bundler.js:22:29\n    at processTicksAndRejections (node:internal/process/task_queues:96:5) {\n  opensslErrorStack: [ 'error:03000086:digital envelope routines::initialization error' ],\n  library: 'digital envelope routines',\n  reason: 'unsupported',\n  code: 'ERR_OSSL_EVP_UNSUPPORTED'\n}\n`\n```\nMy node, npx and react-native versions are:\n\nnode: 17.0.0\nnpx: 8.1.0\nreact-native-cli: 2.0.1",
      "solution": "Ran into the same issue with Node.js 17.0.0. To solve it, I downgraded to version 14.18.1, deleted `node_modules` and reinstalled.",
      "question_score": 93,
      "answer_score": 112,
      "created_at": "2021-10-20T15:52:55",
      "url": "https://stackoverflow.com/questions/69647332/cannot-read-properties-of-undefined-reading-transformfile-at-bundler-transfo"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 70374005,
      "title": "Invalid options object. Dev Server has been initialized using an options object that does not match the API schema",
      "problem": "I have been stuck on this error in my project when I add `\"proxy\": \"http://localhost:6000\"` to my `package.json`.\nThis is the error response after `yarn start`:\n\n`Invalid options object. Dev Server has been initialized using an options object that does not match the API schema.\n - options.allowedHosts[0] should be a non-empty string. \nerror Command failed with exit code 1.\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\n`\n\nBut everything is fine when I remove `\"proxy\": \"http://localhost:6000\"`.\nThis is my `package.json`:\n`{\n  \"name\": \"client\",\n  \"version\": \"0.1.0\",\n  \"private\": true, \n  \"dependencies\": {\n    \"@material-ui/core\": \"^4.12.3\",\n    \"@testing-library/jest-dom\": \"^5.16.1\",\n    \"@testing-library/react\": \"^12.1.2\",\n    \"@testing-library/user-event\": \"^13.5.0\",\n    \"axios\": \"^0.24.0\",\n    \"moment\": \"^2.29.1\",\n    \"react\": \"^17.0.2\",\n    \"react-dom\": \"^17.0.2\",\n    \"react-file-base64\": \"^1.0.3\",\n    \"react-redux\": \"^7.2.6\",\n    \"react-scripts\": \"5.0.0\",\n    \"redux\": \"^4.1.2\",\n    \"redux-thunk\": \"^2.4.1\",\n    \"web-vitals\": \"^2.1.2\"\n  },\n  \"scripts\": {\n    \"start\": \"react-scripts start\",\n    \"build\": \"react-scripts build\",\n    \"test\": \"react-scripts test\",\n    \"eject\": \"react-scripts eject\"\n  },\n  \"eslintConfig\": {\n    \"extends\": [\n      \"react-app\",\n      \"react-app/jest\"\n    ]\n  },\n  \"browserslist\": {\n    \"production\": [\n      \">0.2%\",\n      \"not dead\",\n      \"not op_mini all\"\n    ],\n    \"development\": [\n      \"last 1 chrome version\",\n      \"last 1 firefox version\",\n      \"last 1 safari version\"\n    ]\n  },\n  \"proxy\": \"http://localhost:6000\"\n}\n`",
      "solution": "Here is a workaround. Delete `\"proxy\": \"http://localhost:6000\"`. Install package `http-proxy-middleware` with command `npm install http-proxy-middleware --save`. Create a file `setupProxy.js` inside your src folder or the root of your folder. Add these lines inside:\n```\n`const { createProxyMiddleware } = require('http-proxy-middleware');\n\nmodule.exports = function(app) {\n  app.use(\n    '/api',\n    createProxyMiddleware({\n      target: 'http://localhost:6000',\n      changeOrigin: true,\n    })\n  );\n};\n`\n```\nNow, run your app. It should work.",
      "question_score": 92,
      "answer_score": 83,
      "created_at": "2021-12-16T05:57:13",
      "url": "https://stackoverflow.com/questions/70374005/invalid-options-object-dev-server-has-been-initialized-using-an-options-object"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 74726224,
      "title": "opensslErrorStack: [ &#39;error:03000086:digital envelope routines::initialization error&#39; ]",
      "problem": "```\n`  opensslErrorStack: [ 'error:03000086:digital envelope routines::initialization error' ],\n  library: 'digital envelope routines',\n  reason: 'unsupported',\n  code: 'ERR_OSSL_EVP_UNSUPPORTED'\n}\n\n`\n```\nI get this error when i switched to node v18",
      "solution": "Here are two options now -\n\nTry to uninstall Node.js version 17+ and reinstall Node.js version 16+\n\nYou can re-install the current LTS Node.js version from their Official site. Or more specific downloads from here;\nYou can use NVM (Node Version Manager)\n\nLinux and Mac users can use this nvm package link\nWindows users can use this nvm package link\n\nOpen a terminal and paste these as described:\n\nLinux and macOS (Windows Git Bash)-\n```\n`export NODE_OPTIONS=--openssl-legacy-provider\n`\n```\nWindows command prompt-\n```\n`set NODE_OPTIONS=--openssl-legacy-provider\n`\n```\nWindows PowerShell-\n```\n`$env:NODE_OPTIONS = \"--openssl-legacy-provider\"\n`\n```",
      "question_score": 87,
      "answer_score": 132,
      "created_at": "2022-12-08T07:16:50",
      "url": "https://stackoverflow.com/questions/74726224/opensslerrorstack-error03000086digital-envelope-routinesinitialization-e"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 71913692,
      "title": "Module not found: Error: Can&#39;t resolve &#39;react-dom/client&#39;",
      "problem": "I am using react with the following packages:\n```\n`{\n  \"name\": \"demo\",\n  \"version\": \"0.1.0\",\n  \"private\": true,\n  \"dependencies\": {\n    \"@testing-library/jest-dom\": \"^5.16.4\",\n    \"@testing-library/react\": \"^13.0.1\",\n    \"@testing-library/user-event\": \"^13.5.0\",\n    \"h3-js\": \"^3.7.2\",\n    \"leaflet\": \"^1.7.1\",\n    \"react\": \"^17.0.1\",\n    \"react-dom\": \"^17.0.1\",\n    \"react-leaflet\": \"3.0.2\",\n    \"react-scripts\": \"5.0.1\",\n    \"web-vitals\": \"^2.1.4\"\n  },\n  \"scripts\": {\n    \"start\": \"react-scripts start\",\n    \"build\": \"react-scripts build\",\n    \"test\": \"react-scripts test\",\n    \"eject\": \"react-scripts eject\"\n  },\n  \"eslintConfig\": {\n    \"extends\": [\n      \"react-app\",\n      \"react-app/jest\"\n    ]\n  },\n  \"browserslist\": {\n    \"production\": [\n      \">0.2%\",\n      \"not dead\",\n      \"not op_mini all\"\n    ],\n    \"development\": [\n      \"last 1 chrome version\",\n      \"last 1 firefox version\",\n      \"last 1 safari version\"\n    ]\n  }\n}\n`\n```\nMy `index.js` looks like the following:\n```\n`import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nconst root = ReactDOM.createRoot(document.getElementById('root'));\nroot.render(\n  \n    \n  \n);\n\nreportWebVitals();\n\n`\n```\nMy `App.js` is like the following:\n```\n`import React from \"react\";\nimport { render } from \"react-dom\";\nimport LeafletMap from \"./Map\";\n\nclass App extends React.Component {\n  state = { resolution: 8, kRing: 0 };\n\n  constructor(props) {\n    super(props);\n    this.state = { resolution: 8, kRing: 0 };\n  }\n\n  render() {\n    return (\n      \n        \n        Resolution:\n        \n        \n        K Rings:\n        \n      \n    );\n  }\n\n  onChangeResolution = (e) => {\n    this.setState({ resolution: Number.parseInt(e.target.value) });\n  };\n  onChangeKRings = (e) => {\n    this.setState({ kRing: Number.parseInt(e.target.value) });\n  };\n}\n\nexport default App;\n\n`\n```\nWhen I run my app with `npm run start` I get the following error:\n```\n`Compiled with problems:X\n\nERROR in ./src/index.js 5:0-40\n\nModule not found: Error: Can't resolve 'react-dom/client' in '/home/Desktop/Code/demo_app/src'\n`\n```\nI reinstalled all packages and its also listed in `npm list`:\n```\n`>  npm list\ndemo_app@0.1.0 /home/Desktop/Code/demo_app\n\u251c\u2500\u2500 @testing-library/jest-dom@5.16.4\n\u251c\u2500\u2500 @testing-library/react@13.0.1\n\u251c\u2500\u2500 @testing-library/user-event@13.5.0\n\u251c\u2500\u2500 h3-js@3.7.2\n\u251c\u2500\u2500 leaflet@1.7.1\n\u251c\u2500\u2500 react-dom@17.0.1\n\u251c\u2500\u2500 react-leaflet@3.0.2\n\u251c\u2500\u2500 react-scripts@5.0.1\n\u251c\u2500\u2500 react@17.0.1\n\u2514\u2500\u2500 web-vitals@2.1.4\n`\n```\nAny suggestions why I have problems compiling my application?",
      "solution": "The final solution that worked for me was simply to change the React 18 `index.js` file to the following:\n```\n`import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  \n    \n  ,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\nreportWebVitals();\n\n`\n```",
      "question_score": 87,
      "answer_score": 102,
      "created_at": "2022-04-18T17:19:09",
      "url": "https://stackoverflow.com/questions/71913692/module-not-found-error-cant-resolve-react-dom-client"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 70020046,
      "title": "Quasar Error: Cannot find module &#39;ajv/dist/compile/codegen&#39;",
      "problem": "(node:21216) UnhandledPromiseRejectionWarning:   Error: Cannot find module 'ajv/dist/compile/codegen'\n\nloader.js:815 Function.Module._resolveFilename\ninternal/modules/cjs/loader.js:815:15\n\nloader.js:667 Function.Module._load\ninternal/modules/cjs/loader.js:667:27\n\nloader.js:887 Module.require\ninternal/modules/cjs/loader.js:887:19\n\nhelpers.js:74 require\ninternal/modules/cjs/helpers.js:74:18\n\ntypeof.js:3 Object.\n[front]/[mini-css-extract-plugin]/[ajv-keywords]/dist/definitions/typeof.js:3:19\n\nloader.js:999 Module._compile\ninternal/modules/cjs/loader.js:999:30\n\nloader.js:1027 Object.Module._extensions..js\ninternal/modules/cjs/loader.js:1027:10\n\nloader.js:863 Module.load\ninternal/modules/cjs/loader.js:863:32\n\nloader.js:708 Function.Module._load\ninternal/modules/cjs/loader.js:708:14\n\nloader.js:887 Module.require\ninternal/modules/cjs/loader.js:887:19\n\n(node:21216) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). To terminate the node process on unhandled promise rejection, use the CLI flag `--unhandled-rejections=strict` (see https://nodejs.org/api/cli.html#cli_unhandled_rejections_mode). (rejection id: 1)\n(node:21216) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.",
      "solution": "I had the same issue when I used JHipster, which I solved by running this command\n```\n`npm install --save-dev ajv@^7 \n`\n```\nThanks to this answer",
      "question_score": 83,
      "answer_score": 198,
      "created_at": "2021-11-18T13:42:42",
      "url": "https://stackoverflow.com/questions/70020046/quasar-error-cannot-find-module-ajv-dist-compile-codegen"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 68481686,
      "title": "type &#39;typeof globalThis&#39; has no index signature",
      "problem": "i get this error whenever i try to add a function to the global nodejs global namsepace in a TypeScript environment.\n\nElement implicitly has an 'any' type because type 'typeof globalThis'\nhas no index signature\n\ndeclaring the global namespace\n```\n`declare global {\n  namespace NodeJS {\n    interface Global {\n      signin(): string[]\n    }\n  }\n}\n`\n```\nso if i try this\n```\n`global.signin = () => {}\n`\n```\nit returns a\n\nElement implicitly has an 'any' type because type 'typeof globalThis'\nhas no index signature",
      "solution": "in my own case i didn't quite realize until later that the global namespace i declared was case sensitive.\ninstead of this. before my question was edited it was `namespace NODEJS`\n```\n`declare global {\n  namespace NODEJS {\n    interface Global {\n      signin(): string[]\n    }\n  }\n}\n`\n```\nit was supposed to be this\n```\n`declare global {\n  namespace NodeJS {\n    interface Global {\n      signin(): string[]\n    }\n  }\n}\n`\n```\npay attention to `NODEJS and NodeJS`. After i made these changes, typescript was cool with it and it work the way i expected it to.",
      "question_score": 81,
      "answer_score": 1,
      "created_at": "2021-07-22T10:36:18",
      "url": "https://stackoverflow.com/questions/68481686/type-typeof-globalthis-has-no-index-signature"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 69631437,
      "title": "Error: Cannot find module &#39;webpack/lib/rules/DescriptionDataMatcherRulePlugin&#39; Require stack:",
      "problem": "I have webpack-cli installed on my laravel project. I don't know why first of all we need it to run my vue app but this is causing an error:\nWhen I run npm run dev or npm run hot\n```\n`[webpack-cli] Error: Cannot find module 'webpack/lib/rules/DescriptionDataMatcherRulePlugin'\nRequire stack:\n- C:\\Users\\Viruss\\Desktop\\test-meme-library\\meme-library\\node_modules\\vue-loader\\lib\\plugin-webpack5.js\n- C:\\Users\\Viruss\\Desktop\\test-meme-library\\meme-library\\node_modules\\vue-loader\\lib\\plugin.js\n- C:\\Users\\Viruss\\Desktop\\test-meme-library\\meme-library\\node_modules\\vue-loader\\lib\\index.js\n- C:\\Users\\Viruss\\Desktop\\test-meme-library\\meme-library\\node_modules\\laravel-mix\\src\\components\\Vue.js\n- C:\\Users\\Viruss\\Desktop\\test-meme-library\\meme-library\\node_modules\\laravel-mix\\src\\components\\ComponentRegistrar.js\n- C:\\Users\\Viruss\\Desktop\\test-meme-library\\meme-library\\node_modules\\laravel-mix\\src\\Mix.js\n- C:\\Users\\Viruss\\Desktop\\test-meme-library\\meme-library\\node_modules\\laravel-mix\\setup\\webpack.config.js\n- C:\\Users\\Viruss\\Desktop\\test-meme-library\\meme-library\\node_modules\\webpack-cli\\lib\\webpack-cli.js\n- C:\\Users\\Viruss\\Desktop\\test-meme-library\\meme-library\\node_modules\\webpack-cli\\lib\\bootstrap.js\n- C:\\Users\\Viruss\\Desktop\\test-meme-library\\meme-library\\node_modules\\webpack-cli\\bin\\cli.js\n- C:\\Users\\Viruss\\Desktop\\test-meme-library\\meme-library\\node_modules\\webpack\\bin\\webpack.js\n    at Function.Module._resolveFilename (internal/modules/cjs/loader.js:902:15)\n    at Function.Module._load (internal/modules/cjs/loader.js:746:27)\n    at Module.require (internal/modules/cjs/loader.js:974:19)\n    at require (internal/modules/cjs/helpers.js:93:18)\n    at Object. (C:\\Users\\Viruss\\Desktop\\test-meme-library\\meme-library\\node_modules\\vue-loader\\lib\\plugin-webpack5.js:6:42)\n    at Module._compile (internal/modules/cjs/loader.js:1085:14)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1114:10)\n    at Module.load (internal/modules/cjs/loader.js:950:32)\n    at Function.Module._load (internal/modules/cjs/loader.js:790:12)\n    at Module.require (internal/modules/cjs/loader.js:974:19) {\n  code: 'MODULE_NOT_FOUND',\n  requireStack: [\n    'C:\\\\Users\\\\Viruss\\\\Desktop\\\\test-meme-library\\\\meme-library\\\\node_modules\\\\vue-loader\\\\lib\\\\plugin-webpack5.js',\n    'C:\\\\Users\\\\Viruss\\\\Desktop\\\\test-meme-library\\\\meme-library\\\\node_modules\\\\vue-loader\\\\lib\\\\plugin.js',\n    'C:\\\\Users\\\\Viruss\\\\Desktop\\\\test-meme-library\\\\meme-library\\\\node_modules\\\\vue-loader\\\\lib\\\\index.js',\n    'C:\\\\Users\\\\Viruss\\\\Desktop\\\\test-meme-library\\\\meme-library\\\\node_modules\\\\laravel-mix\\\\src\\\\components\\\\Vue.js',\n    'C:\\\\Users\\\\Viruss\\\\Desktop\\\\test-meme-library\\\\meme-library\\\\node_modules\\\\laravel-mix\\\\src\\\\components\\\\ComponentRegistrar.js',\n    'C:\\\\Users\\\\Viruss\\\\Desktop\\\\test-meme-library\\\\meme-library\\\\node_modules\\\\laravel-mix\\\\src\\\\Mix.js',\n    'C:\\\\Users\\\\Viruss\\\\Desktop\\\\test-meme-library\\\\meme-library\\\\node_modules\\\\laravel-mix\\\\setup\\\\webpack.config.js',\n    'C:\\\\Users\\\\Viruss\\\\Desktop\\\\test-meme-library\\\\meme-library\\\\node_modules\\\\webpack-cli\\\\lib\\\\webpack-cli.js',\n    'C:\\\\Users\\\\Viruss\\\\Desktop\\\\test-meme-library\\\\meme-library\\\\node_modules\\\\webpack-cli\\\\lib\\\\bootstrap.js',\n    'C:\\\\Users\\\\Viruss\\\\Desktop\\\\test-meme-library\\\\meme-library\\\\node_modules\\\\webpack-cli\\\\bin\\\\cli.js',\n    'C:\\\\Users\\\\Viruss\\\\Desktop\\\\test-meme-library\\\\meme-library\\\\node_modules\\\\webpack\\\\bin\\\\webpack.js'\n  ]\n}\n`\n```\n\nVue is installed also vue-loader, can't understand why it can't find those files. Also, I looked at the node_modules everything is in there ...",
      "solution": "You need to update your vue-loader\n```\n`npm update vue-loader\n`\n```\nAnd if it is not installed, install it\n```\n`npm i vue-loader\n`\n```",
      "question_score": 80,
      "answer_score": 249,
      "created_at": "2021-10-19T15:10:12",
      "url": "https://stackoverflow.com/questions/69631437/error-cannot-find-module-webpack-lib-rules-descriptiondatamatcherruleplugin-r"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 67541374,
      "title": "NVM: Getting Permission denied with nvm install command",
      "problem": "I recently fresh-installed Ubuntu 21.04 and wanted to install nvm:\n`curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.38.0/install.sh | bash`\nThen closed and re-opened the terminal. When requesting an install of version `12.16.3` (have tried with other versions as well). I'm getting the following error:\n```\n`nvm install 12.16.3\nDownloading and installing node v12.16.3...\nDownloading https://nodejs.org/dist/v12.16.3/node-v12.16.3-linux-x64.tar.xz...\nWarning: Failed to create the file \nWarning: /home/sauronnikko/.nvm/.cache/bin/node-v12.16.3-linux-x64/node-v12.16.\nWarning: 3-linux-x64.tar.xz: Permission denied\ncurl: (23) Failure writing output to destination\n\nBinary download from https://nodejs.org/dist/v12.16.3/node-v12.16.3-linux-x64.tar.xz failed, trying source.\ngrep: /home/sauronnikko/.nvm/.cache/bin/node-v12.16.3-linux-x64/node-v12.16.3-linux-x64.tar.xz: No such file or directory\nProvided file to checksum does not exist.\nBinary download failed, trying source.\nDownloading https://nodejs.org/dist/v12.16.3/node-v12.16.3.tar.xz...\nWarning: Failed to create the file \nWarning: /home/sauronnikko/.nvm/.cache/src/node-v12.16.3/node-v12.16.3.tar.xz: \nWarning: Permission denied\ncurl: (23) Failure writing output to destination\n\nBinary download from https://nodejs.org/dist/v12.16.3/node-v12.16.3.tar.xz failed, trying source.\ngrep: /home/sauronnikko/.nvm/.cache/src/node-v12.16.3/node-v12.16.3.tar.xz: No such file or directory\nProvided file to checksum does not exist.\n`\n```",
      "solution": "Posted an issue to nvm's repo\nTurns out the problem was with `curl` and that I had installed it with `snap` instead of regular `apt install curl`.",
      "question_score": 79,
      "answer_score": 173,
      "created_at": "2021-05-14T23:57:33",
      "url": "https://stackoverflow.com/questions/67541374/nvm-getting-permission-denied-with-nvm-install-command"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 70577085,
      "title": "nodejs will not enable corepack: operation not permitted",
      "problem": "I have installed nodejs and i am trying to enable corepack with `corepack enable` but it gives me this error on windows:\n```\n`Internal Error: EPERM: operation not permitted, open 'C:\\Program Files\\nodejs\\pnpm'\nError: EPERM: operation not permitted, open 'C:\\Program Files\\nodejs\\pnpm'\n`\n```\nI can not find the pnpm folder is is refering to in the nodejs folder and i have tried to `npm install -g pnpm` which did install pnpm\nhow do I fix this?",
      "solution": "Try running the cmd as administrator",
      "question_score": 77,
      "answer_score": 124,
      "created_at": "2022-01-04T11:09:37",
      "url": "https://stackoverflow.com/questions/70577085/nodejs-will-not-enable-corepack-operation-not-permitted"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 65856300,
      "title": "wasm code commit Allocation failed - process out of memory",
      "problem": "I have a nodejs script which was working fine on nodejs 12. I got a new macbook air on which I installed nodejs LTS 14. The scripts was not working as intended so I have downgraded it to nodejs 12 LTS. Now I'm getting an error for process out of memory. I have also tried using --max-oud-size to increase the memory allocation.\n` export NODE_OPTIONS=--max_old_space_size=4096`\nIt didn't work. Following is the stack trace for the error\n```\n`\n\n[8193:0x150008000]       41 ms: Scavenge 2.9 (4.9) -> 2.7 (5.7) MB, 0.5 / 0.0 ms  (average mu = 1.000, current mu = 1.000) allocation failure \n[8193:0x150008000]       54 ms: Scavenge 3.9 (5.9) -> 3.6 (8.6) MB, 0.3 / 0.0 ms  (average mu = 1.000, current mu = 1.000) allocation failure \n[8193:0x150008000]       59 ms: Scavenge 5.2 (8.6) -> 3.9 (9.1) MB, 0.2 / 0.0 ms  (average mu = 1.000, current mu = 1.000) allocation failure \n\n==== JS stack trace =========================================\n\nSecurity context: 0x00010b1808d1 \n    0: builtin exit frame: new constructor(aka Module)(this=0x000102ea1961 ,0x000102ea1811 ,0x000102ea1961 )\n\n    1: ConstructFrame [pc: 0x100ca8758]\n    2: StubFrame [pc: 0x100d91204]\n    3: /* anonymous */ [0x102ea10b1] [/Applications/XAMPP/xamppfiles/htdocs/web-dev/local-cron-jobs/node_modules/long/src/long.js:9...\n\nFATAL ERROR: wasm code commit Allocation failed - process out of memory\n 1: 0x1004db324 node::Abort() [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n 2: 0x1004db4a4 node::errors::TryCatchScope::~TryCatchScope() [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n 3: 0x1005fab78 v8::Utils::ReportOOMFailure(v8::internal::Isolate*, char const*, bool) [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n 4: 0x1005fab0c v8::internal::V8::FatalProcessOutOfMemory(v8::internal::Isolate*, char const*, bool) [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n 5: 0x100b332bc v8::internal::wasm::WasmCodeAllocator::AllocateForCodeInRegion(v8::internal::wasm::NativeModule*, unsigned long, v8::base::AddressRegion) [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n 6: 0x100b34198 v8::internal::wasm::NativeModule::CreateEmptyJumpTableInRegion(unsigned int, v8::base::AddressRegion) [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n 7: 0x100b33660 v8::internal::wasm::NativeModule::AddCodeSpace(v8::base::AddressRegion) [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n 8: 0x100b33fd4 v8::internal::wasm::NativeModule::NativeModule(v8::internal::wasm::WasmEngine*, v8::internal::wasm::WasmFeatures const&, bool, v8::internal::VirtualMemory, std::__1::shared_ptr, std::__1::shared_ptr, std::__1::shared_ptr*) [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n 9: 0x100b36214 v8::internal::wasm::WasmCodeManager::NewNativeModule(v8::internal::wasm::WasmEngine*, v8::internal::Isolate*, v8::internal::wasm::WasmFeatures const&, unsigned long, bool, std::__1::shared_ptr) [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n10: 0x100b3cb1c v8::internal::wasm::WasmEngine::NewNativeModule(v8::internal::Isolate*, v8::internal::wasm::WasmFeatures const&, unsigned long, bool, std::__1::shared_ptr) [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n11: 0x100b3ca64 v8::internal::wasm::WasmEngine::NewNativeModule(v8::internal::Isolate*, v8::internal::wasm::WasmFeatures const&, std::__1::shared_ptr) [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n12: 0x100b14578 v8::internal::wasm::CompileToNativeModule(v8::internal::Isolate*, v8::internal::wasm::WasmFeatures const&, v8::internal::wasm::ErrorThrower*, std::__1::shared_ptr, v8::internal::wasm::ModuleWireBytes const&, v8::internal::Handle*) [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n13: 0x100b3a710 v8::internal::wasm::WasmEngine::SyncCompile(v8::internal::Isolate*, v8::internal::wasm::WasmFeatures const&, v8::internal::wasm::ErrorThrower*, v8::internal::wasm::ModuleWireBytes const&) [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n14: 0x100b5bc98 v8::(anonymous namespace)::WebAssemblyModule(v8::FunctionCallbackInfo const&) [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n15: 0x10065f150 v8::internal::FunctionCallbackArguments::Call(v8::internal::CallHandlerInfo) [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n16: 0x10065e4b8 v8::internal::MaybeHandle v8::internal::(anonymous namespace)::HandleApiCallHelper(v8::internal::Isolate*, v8::internal::Handle, v8::internal::Handle, v8::internal::Handle, v8::internal::Handle, v8::internal::BuiltinArguments) [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n17: 0x10065dfb4 v8::internal::Builtin_Impl_HandleApiCall(v8::internal::BuiltinArguments, v8::internal::Isolate*) [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n18: 0x100d2b0cc Builtins_CEntry_Return1_DontSaveFPRegs_ArgvOnStack_BuiltinExit [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n19: 0x100ca8758 Builtins_JSBuiltinsConstructStub [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n20: 0x100d91204 Builtins_ConstructHandler [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n21: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n22: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n23: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n24: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n25: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n26: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n27: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n28: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n29: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n30: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n31: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n32: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n33: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n34: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n35: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n36: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n37: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n38: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n39: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n40: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n41: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n42: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n43: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n44: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n45: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n46: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n47: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n48: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n49: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n50: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n51: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n52: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n53: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n54: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n55: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n56: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n57: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n58: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n59: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n60: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n61: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n62: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n63: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n64: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n65: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n66: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n67: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n68: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n69: 0x100cad520 Builtins_InterpreterEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n70: 0x100caa5a8 Builtins_JSEntryTrampoline [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n71: 0x100caa24c Builtins_JSEntry [/Users/rahulbharati/.nvm/versions/node/v12.20.1/bin/node]\n72: 0x150008000 ```\n\nAny help appreciated. Thanks.\n`\n```",
      "solution": "This issue has been fixed in Node 15.3.0.\nI updated mine and it worked fine for me.",
      "question_score": 76,
      "answer_score": 48,
      "created_at": "2021-01-23T07:15:18",
      "url": "https://stackoverflow.com/questions/65856300/wasm-code-commit-allocation-failed-process-out-of-memory"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 74131595,
      "title": "Error: error:1E08010C:DECODER routines::unsupported with Google auth library",
      "problem": "I've recently ran into this error with the google cloud storage SDK on Node.js.\nI know for a fact that this worked in the past without any changes, but I haven't touched the code in a while and might be wrong.\nHere's the error itself:\n```\n`Error: error:1E08010C:DECODER routines::unsupported\n    at Sign.sign (node:internal/crypto/sig:131:29)\n    at Object.sign (node_modules/jwa/index.js:152:45)\n    at Object.jwsSign [as sign] (node_modules/jws/lib/sign-stream.js:32:24)\n    at GoogleToken.requestToken (node_modules/gtoken/build/src/index.js:232:31)\n    at GoogleToken.getTokenAsyncInner (node_modules/gtoken/build/src/index.js:166:21)\n    at GoogleToken.getTokenAsync (node_modules/gtoken/build/src/index.js:145:55)\n    at GoogleToken.getToken (node_modules/gtoken/build/src/index.js:97:21)\n    at JWT.refreshTokenNoCache (node_modules/google-auth-library/build/src/auth/jwtclient.js:172:36)\n    at JWT.refreshToken (node_modules/google-auth-library/build/src/auth/oauth2client.js:153:24)\n    at JWT.getRequestMetadataAsync (node_modules/google-auth-library/build/src/auth/oauth2client.js:298:28) {\n  library: 'DECODER routines',\n  reason: 'unsupported',\n  code: 'ERR_OSSL_UNSUPPORTED'\n}\n`\n```\nThe code that throws this error is the following:\n`const credentials = {\n    type: process.env.TYPE,\n    project_id: process.env.PROJECT_ID,\n    private_key_id: process.env.PRIVATE_KEY_ID,\n    private_key: process.env.PRIVATE_KEY,\n    client_email: process.env.CLIENT_EMAIL,\n    client_id: process.env.CLIENT_ID,\n    auth_uri: process.env.AUTH_URI,\n    token_uri: process.env.TOKEN_URI,\n    auth_provider_x509_cert_url: process.env.AUTH_PROVIDER_X509_CERT_URL,\n    client_x509_cert_url: process.env.CLIENT_X509_CERT_URL,\n  };\n\n  const storage = new Storage({\n    credentials,\n  });\n  if (!req.file) {\n    logger('POST /profile_image', logLevels.error, 'No file uploaded!');\n    ResponseError.badRequest(res);\n  }\n  const bucketName = process.env.BUCKET_NAME;\n  const bucket = storage.bucket(bucketName);\n  const fileName = `profile_pics/${req.user}/${req.file.originalname}`;\n  const file = bucket.file(fileName);\n  const stream = file.createWriteStream({\n    metadata: {\n      contentType: req.file.mimetype,\n    },\n  });\n  stream.on('error', (err) => {\n    console.error('Error pushing the picture: ', err);  {\n    return file.makePublic().then(async () => {\n       ...\n      })\n  });\n  stream.end(req.file.buffer);\n`\nThe `process.env` contains all the right values, I've made sure to try with a new private key but same error. Has anyone seen this one before?\nTIA!",
      "solution": "Answering this as community wiki. As mentioned above in comments by John Hanley\n\nDo not store service accounts in environment variables.\nIf you do, do not break the service account into pieces. Base64 encode the entire service account, store it in a variable, and then Base64 decode it when required.\nYour code is failing because the client is being set up with bad credentials. Most likely a corrupted private key.",
      "question_score": 73,
      "answer_score": 32,
      "created_at": "2022-10-19T22:35:53",
      "url": "https://stackoverflow.com/questions/74131595/error-error1e08010cdecoder-routinesunsupported-with-google-auth-library"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 70865039,
      "title": "&quot;npm install&quot; hangs on sill: idealTree build",
      "problem": "I've been trying to solve this over the last two days, or so, with no effect:\n\nSolution that I have attempted include:\n\nDeleting the package-lock.json file\nCoordinating with the other dev on the project to align the Node.js\nversion and reinstalling the whole framework\nUsing --verbose as part of the `npm i` command\nEditing environmental variables to add NPM to them\nDeleting the \"node_modules\" folder (with `rm -rf node_modules/`)\nDisabling, then re-enabling SSH\nTrying with and without VPN being active\nClearing the cache via the command line, i.e. the node_modules step\nabove\n\nThis is a link to another topic on the same issue on SO that also seems to be outstanding: Link\nI've reviewed the range of discussions on SO about the problem, to no particular avail, and I think I'm out of options. Any insight is appreciated",
      "solution": "The issue was the connection to registry.npmjs.org, after the installation attempt finally processed.\n\nThe solution is that when you go to run \"npm install\", you have to add \"registry.npmjs.org\" at the end of it, and it sums up to:\nnpm i registry.npmjs.org\nMake sure to run this from the folder of your NodeJS project.\nOther useful links to consult:\nNPM stuck on idealTree: timing idealTree\nnpm install hangs\nstop \"npm install\" at [..................] | idealTree:regal: sill idealTree buildDeps\nError : getaddrinfo ENOTFOUND registry.npmjs.org registry.npmjs.org:443 --this one is for Angular, but still relevant.\nAs a final curiosity, going to registry.npmjs.org leads to this site:\n\nwhere as https://www.npmjs.com/package/registry.npmjs.org leads to\n\nYou will note the command I used in this solution on the right side of that last screenshot.\nFinally:\n\nThere is a typo in the error output: error refers to \"registry.nPJMs.org\", whereas the address has to be \"registry.nPMJs.org\".\nI don't know if this should be brought to the attention of NodeJS devs, but there you go.",
      "question_score": 71,
      "answer_score": 22,
      "created_at": "2022-01-26T15:27:29",
      "url": "https://stackoverflow.com/questions/70865039/npm-install-hangs-on-sill-idealtree-build"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 67361936,
      "title": "&#39;exec user process caused: exec format error&#39; in AWS Fargate Service",
      "problem": "I am totally new to AWS but I've been running my dockerized application locally for months now with no issues. Now that I am trying to deploy this app via AWS ECS/Fargate, my containers are stopped repeatedly with this linux error: `standard_init_linux.go:219: exec user process caused: exec format error`. This error seems to suggest that the architecture in Fargate does not recognize one of the Linux commands I'm running but I can't find a good answer anywhere for how to find the architecture that's running or how to track down the specific command that's causing the issue.\nThese are my Dockerfiles for the frontend and backend. The project is built in the MERN stack and is split into the frontend (React) and the backend (MongoDB/Express)\nFrontend:\n```\n`FROM alpine:3.10\n\nENV NODE_VERSION 15.9.0\n\nWORKDIR /frontend\n\nCOPY package*.json ./\n\nRUN apk add --no-cache nodejs npm\n\n# some packages rely on gyp so we need this\n# pulled from https://github.com/nodejs/docker-node/issues/282\nRUN apk add --no-cache --virtual .gyp \\\n        python \\\n        make \\\n        g++ \\\n    && npm install\n\nCOPY . .\n\nEXPOSE 3000\n\nCMD [\"npm\", \"start\"]\n`\n```\nBackend:\n```\n`FROM alpine:3.10\n\nENV NODE_VERSION 15.9.0\n\nWORKDIR /backend\n\nCOPY package*.json ./\n\nRUN apk add --no-cache nodejs npm\n\n# some packages rely on gyp so we need this\n# pulled from https://github.com/nodejs/docker-node/issues/282\nRUN apk add --no-cache --virtual .gyp \\\n        python \\\n        make \\\n        g++ \\\n    && npm install --silent\\\n    && apk del .gyp\n\nCOPY ./ ./\n\nEXPOSE 8080\n\nCMD [\"npm\", \"start\"]\n`\n```\nAny help would be greatly appreciated!",
      "solution": "I think you've identified your problem.\nYou're building your images on Apple's M1 chip, which is an ARM architecture. Fargate is probably running on the more common Intel x86-64 architecture. Images you build locally on your Mac aren't going to be able to run there.\nThe easiest solution is probably to have your images build automatically in Docker Hub (or use a Github Action to build them in Github).\nI don't have all the details about how you're building and deploying your images, so it's possible I'm missing some details.",
      "question_score": 67,
      "answer_score": 65,
      "created_at": "2021-05-03T01:21:44",
      "url": "https://stackoverflow.com/questions/67361936/exec-user-process-caused-exec-format-error-in-aws-fargate-service"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 72586253,
      "title": "Typescript: Debug Failure. False expression: Non-string value passed to `ts.resolveTypeReferenceDirective`",
      "problem": "I've an `npm` command line application that i've built not so long ago and it worked fine. Now that i've updated it, and due to changes in the versions of typescript over the period, i'm getting an error when i want to run this package which says:\n`Debug Failure. False expression: Non-string value passed to `ts.resolveTypeReferenceDirective`, likely by a wrapping package working with an outdated `resolveTypeReferenceDirectives` signature. This is probably not a problem in TS itself.\n`\nHere is the `package.json` file:\n`{\n  \"name\": \"initialiseur\",\n  \"version\": \"4.0.4\",\n  \"main\": \"src index.ts\",\n  \"author\": \"@crispengari\",\n  \"license\": \"MIT\",\n  \"bin\": \"src/index.ts\",\n  \"description\": \"THIS IS A BOILER PLATE THAT INITIALIZE A NODE EXPRESS BACKEND FOR TYPESCRIPT AND JAVASCRIPT\",\n  \"scripts\": {\n    \"watch\": \"tsc -w\",\n    \"start\": \"ts-node src/index.ts\",\n    \"dev\": \"nodemon dist/index.ts\",\n    \"start:fast\": \"tsnd --respawn src/index.ts\"\n  },\n  \"dependencies\": {\n    \"@types/inquirer\": \"^7.3.3\",\n    \"@types/node\": \"^17.0.42\",\n    \"@types/npm\": \"^7.19.0\",\n    \"chalk\": \"^4.1.2\",\n    \"cors\": \"^2.8.5\",\n    \"cross-fetch\": \"^3.1.5\",\n    \"dotenv\": \"^10.0.0\",\n    \"inquirer\": \"^8.1.2\",\n    \"node-fetch\": \"^3.2.6\",\n    \"octokit\": \"^1.7.2\",\n    \"ts-node\": \"^10.8.1\",\n    \"typescript\": \"^4.6.5\"\n  },\n  \"devDependencies\": {\n    \"@types/node-fetch\": \"^2.6.1\",\n    \"nodemon\": \"^2.0.12\",\n    \"ts-node-dev\": \"^2.0.0\"\n  },\n  \"bugs\": {\n    \"url\": \"https://github.com/CrispenGari/initialiseur/issues\"\n  },\n  \"homepage\": \"https://github.com/CrispenGari/initialiseur#readme\",\n  \"keywords\": [\n    \"node.ts\",\n    \"node.js\",\n    \"typescript\",\n    \"ts\",\n    \"nodejs-backend\",\n    \"javascript\",\n    \"js\",\n    \"express\",\n    \"backend\"\n  ]\n}\n`\nWhen i'm testing it locally by running:\n`npm start\n\n# or \nyarn start\n\n`\nEverything is working fine, but after publishing it to npm to start it i run the following command:\n`npx initialiseur\n`\nThen I'm getting the error from a command line. The whole error is as follows:\n`C:\\Users\\crisp\\AppData\\Roaming\\npm\\node_modules\\initialiseur\\node_modules\\typescript\\lib\\typescript.js:42536\n        ts.Debug.assert(typeof typeReferenceDirectiveName === \"string\", \"Non-string value passed to `ts.resolveTypeReferenceDirective`, likely by a wrapping package working with an outdated `resolveTypeReferenceDirectives` signature. This is probably not a problem in TS itself.\");\n                 ^\nError: Debug Failure. False expression: Non-string value passed to `ts.resolveTypeReferenceDirective`, likely by a wrapping package working with an outdated `resolveTypeReferenceDirectives` signature. This is probably not a problem in TS itself.\n    at Object.resolveTypeReferenceDirective (C:\\Users\\crisp\\AppData\\Roaming\\npm\\node_modules\\initialiseur\\node_modules\\typescript\\lib\\typescript.js:42536:18)\n    at C:\\Users\\crisp\\AppData\\Roaming\\npm\\node_modules\\ts-node\\src\\resolver-functions.ts:131:51\n    at Array.map ()\n    at Object.resolveTypeReferenceDirectives (C:\\Users\\crisp\\AppData\\Roaming\\npm\\node_modules\\ts-node\\src\\resolver-functions.ts:130:31)\n    at actualResolveTypeReferenceDirectiveNamesWorker (C:\\Users\\crisp\\AppData\\Roaming\\npm\\node_modules\\initialiseur\\node_modules\\typescript\\lib\\typescript.js:116673:163)\n    at resolveTypeReferenceDirectiveNamesWorker (C:\\Users\\crisp\\AppData\\Roaming\\npm\\node_modules\\initialiseur\\node_modules\\typescript\\lib\\typescript.js:116973:26)\n    at processTypeReferenceDirectives (C:\\Users\\crisp\\AppData\\Roaming\\npm\\node_modules\\initialiseur\\node_modules\\typescript\\lib\\typescript.js:118455:31)\n    at findSourceFileWorker (C:\\Users\\crisp\\AppData\\Roaming\\npm\\node_modules\\initialiseur\\node_modules\\typescript\\lib\\typescript.js:118340:21)\n    at findSourceFile (C:\\Users\\crisp\\AppData\\Roaming\\npm\\node_modules\\initialiseur\\node_modules\\typescript\\lib\\typescript.js:118195:26)\n    at processImportedModules (C:\\Users\\crisp\\AppData\\Roaming\\npm\\node_modules\\initialiseur\\node_modules\\typescript\\lib\\typescript.js:118601:25)\n`\nFrom the above error i can tell that the problem maybe comming from `typescript`, I'v tried changing version of typescript but still it's not working. In my `src/index.ts` it looks as follows:\n```\n`\n#!/usr/bin/env ts-node\nimport path from \"path\";\nimport inquirer from \"inquirer\";\nimport { writeFile, readFile } from \"fs/promises\";\n\n....\n\n`\n```",
      "solution": "Getting the same as of a couple of days.\nReverting ts-node to v10.6.0 fixes it for me.",
      "question_score": 66,
      "answer_score": 19,
      "created_at": "2022-06-11T18:54:43",
      "url": "https://stackoverflow.com/questions/72586253/typescript-debug-failure-false-expression-non-string-value-passed-to-ts-reso"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 67254339,
      "title": "nvm install node fails to install on macOS Big Sur M1 Chip",
      "problem": "I'm trying to install the latest version of node using nvm. I've just got the newly released SIlicon Macbook Pro with the M1 chip (not sure if that is related). I've installed xcode on the app store and the xcode tools on the command line. The main error i'm getting is:\n```\n`clang: error: no such file or directory: 'CXX=c++'\n`\n```",
      "solution": "If you have installed `nvm` using `homebrew` and are trying to install the node using command `nvm install `, you will face errors on apple silicon machines (ARM) for versions lower than 15. Node versions older than 15  do not work on apple silicon machines (ARM) because ARM architecture is not supported.\nFor anything under v15, you will need to install node using Rosetta 2.\n\nHow to open terminal in Rosetta2 mode: Go to Application -> Right click on terminal app -> Get Info -> Select \"Open using Rosetta\" -> Restart Terminal\nIn Terminal, write -> `arch -x86_64 zsh`\n\nNow you will able to install any version of node (even multiple versions)",
      "question_score": 64,
      "answer_score": 196,
      "created_at": "2021-04-25T16:15:10",
      "url": "https://stackoverflow.com/questions/67254339/nvm-install-node-fails-to-install-on-macos-big-sur-m1-chip"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 66214552,
      "title": "/tmp/chromium: error while loading shared libraries: libnss3.so: cannot open shared object file: No such file or directory Vercel",
      "problem": "when I try to access my API uploaded on vercel server, I'm getting this error.\nDid anyone have the same error?\nWhen I run it locally, it works fine.\n\n2021-02-15T19:38:59.218Z  0109b575-a2e7-478e-aefe-aa3335b5b6b8    ERROR   Error: Failed to launch the browser process!\n/tmp/chromium: error while loading shared libraries: libnss3.so: cannot open shared object file: No such file or directory\nTROUBLESHOOTING: https://github.com/puppeteer/puppeteer/blob/main/docs/troubleshooting.md\nat onClose (/var/task/node_modules/puppeteer-core/lib/cjs/puppeteer/node/BrowserRunner.js:193:20)\nat Interface. (/var/task/node_modules/puppeteer-core/lib/cjs/puppeteer/node/BrowserRunner.js:183:68)\nat Interface.emit (events.js:327:22)\nat Interface.close (readline.js:424:8)\nat Socket.onend (readline.js:202:10)\nat Socket.emit (events.js:327:22)\nat endReadableNT (internal/streams/readable.js:1327:12)\nat processTicksAndRejections (internal/process/task_queues.js:80:21)\n\ncode\n```\n`import puppeteer, { Page } from 'puppeteer-core'\nimport chrome from 'chrome-aws-lambda'\n\nexport async function getOptions() {\n  const isDev = !process.env.AWS_REGION\n  let options;\n\n  const chromeExecPaths = {\n    win32: 'C:\\\\Program Files (x86)\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe',\n    linux: '/usr/bin/google-chrome',\n    darwin: '/Applications/Google Chrome.app/Contents/MacOS/Google Chrome'\n  }\n  \n  const exePath = chromeExecPaths[process.platform]\n\n  if (isDev) {\n    options = {\n      args: [],\n      executablePath: exePath,\n      headless: true\n    }\n  } else {\n    options = {\n      args: chrome.args,\n      executablePath: await chrome.executablePath,\n      headless: chrome.headless\n    }\n  }\n\n  return options\n}\n\nlet _page: Page | null\nasync function getPage(): Promise {\n  if (_page) {\n    return _page\n  }\n\n  const options = await getOptions()\n  const browser = await puppeteer.launch(options)\n\n  _page = await browser.newPage()\n\n  return _page\n}\n\nexport async function getScreenshot(html: string, { width, height } = { width: 800, height: 800 }) {\n  const page = await getPage();\n\n  await page.setContent(html);\n  await page.setViewport({ width, height });\n\n  const file = await page.screenshot({ type: 'png' });\n\n  return file;\n}\n`\n```",
      "solution": "I had the same issue where puppeteer was running okay on my local environment but when i deployed to AWS EC2 i face up the same error shared loading libraries\nSolution\n\nFirst check the version of nodejs you are running and if its not less than v14.0 or greater than v14.0. Upgrade or downgrade (recommended to upgrade) and restart your app then try.\n\nThe most common cause is a bug in Node.js v14.0.0 which broke extract-zip, the module Puppeteer uses to extract browser downloads into the right place. The bug was fixed in Node.js v14.1.0, so please make sure you're running that version or higher. Alternatively, if you cannot upgrade, you could downgrade to Node.js v12, but we recommend upgrading when possible.\n\nTrivial:- Make sure the directory where your project folder is located is not owned by root.\n\nFor those who might have experience this issue while running on windows enviroment, You can try to pass ignoreDefaultArgs: ['--disable-extensions'] option when launching it chromium from code i.e\n```\n`const browser = await puppeteer.launch({ignoreDefaultArgs: ['--disable-extensions']})\n`\n```\nThis will deactivate default behaviour of puppeteer from disabling any extensions usually used by chromium/chrome.\nLinux and MAcOS uses\nThe issues that results in this error\n\nUnhandledPromiseRejectionWarning: Error: Failed to launch the browser process!\nerror while loading shared libraries: libnss3.so: cannot open shared object file: No such file or directory TROUBLESHOOTING\n\nis mostly but not all the times caused by missing dependencies that are required in the latest version. The good thing is you can easily check the missing chrome dependencies causing the crash.\n\nMake sure you are in the root folder of your project\nNavigate to node_modules folder\nNavigate to the folder where puppeteer chrome Linux tools are installed\n\ncd /project_folder/node_modules/puppeteer/.local-chromium/linux-some number/chrome-linux\nreplace the linux-some number with whatever ls will output\nls  at /.local-chromium to check name of your directory\n\nAt the last directory [ chrome-linux ] run below command to check the missing dependencies\nldd chrome | grep not\n\nif you see any missing dependencies, run this command to install everything and restart your application.\n```\n`sudo apt-get install ca-certificates fonts-liberation libappindicator3-1 libasound2 libatk-bridge2.0-0 libatk1.0-0 libc6 libcairo2 libcups2 libdbus-1-3 libexpat1 libfontconfig1 libgbm1 libgcc1 libglib2.0-0 libgtk-3-0 libnspr4 libnss3 libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 libxdamage1 libxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 lsb-release wget xdg-utils\n`\n```\nVoila!! everything should be fixed",
      "question_score": 64,
      "answer_score": 85,
      "created_at": "2021-02-15T20:52:29",
      "url": "https://stackoverflow.com/questions/66214552/tmp-chromium-error-while-loading-shared-libraries-libnss3-so-cannot-open-sha"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 70958371,
      "title": "Unexpected token &#39;.&#39; when trying to run &#39;npm install&#39;",
      "problem": "I am trying to install the angular cli with 'npm install -g @angular/cli' and I am met with the following error:\n```\n`npm ERR! Unexpected token '.'\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     C:\\Users\\\\AppData\\Local\\npm-cache\\_logs\\2022-02-02T15_25_07_320Z-debug-0.log\n`\n```\nVersion of npm: 8.3.1\nVersion of node: v17.4.0\nAny help would be greatly appreciated! Thank you :)",
      "solution": "This is a reported issue for npm version 8.3.1.\nYour best bet is to skip this version (Either use 8.3.2 or 8.4), use an earlier version (8.3.0) or use another node version (",
      "question_score": 64,
      "answer_score": 24,
      "created_at": "2022-02-02T16:31:59",
      "url": "https://stackoverflow.com/questions/70958371/unexpected-token-when-trying-to-run-npm-install"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 68618743,
      "title": "Cannot find module &#39;agentkeepalive&#39; when updating NPM to 7.20.3",
      "problem": "When I'm trying to update npm to 7.20.3 (`npm install -g npm@7.20.3`), npm throws :\n```\n`npm ERR! code MODULE_NOT_FOUND\nnpm ERR! Cannot find module 'agentkeepalive'\nnpm ERR! Require stack:\nnpm ERR! - /Users/ShaggyRogers/.nvm/versions/node/v14.16.0/lib/node_modules/npm/node_modules/make-fetch-happen/agent.js\n...\n`\n```",
      "solution": "In order to quickly fix this error just install or re-install globally `agentkeepalive` :\n```\n`npm install -g agentkeepalive --save\n`\n```\nThen update npm :\n```\n`npm install -g npm@7.20.3\n`\n```\nUPDATE :\nSince June 23 2021, the bug seems to be fixed in `v7.17.0` (GitHub issue)\nYou can first upgrade to `v7.17.0`:\n```\n`npm install -g npm@7.17.0\n`\n```\nThen upgrade to the last version of npm :\n```\n`npm install -g npm@7.21.0\n`\n```\nor\n```\n`npm install -g npm@latest\n`\n```",
      "question_score": 62,
      "answer_score": 138,
      "created_at": "2021-08-02T10:45:34",
      "url": "https://stackoverflow.com/questions/68618743/cannot-find-module-agentkeepalive-when-updating-npm-to-7-20-3"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 71747609,
      "title": "How to specify &quot;packageManager&quot; in package.json",
      "problem": "As per\nhttps://nodejs.org/dist/latest-v16.x/docs/api/all.html#all_packages_packagemanager\nWe can specify package manager from the list of supported package managers.\nHowever, the VS code complains that the value is not correct.\n\nI have also tried following values which also gives warnings\n\n`pnpm`\n`pnpm@6`\n`pnpm@6.0.0`\n`pnpm@^6.32.4`\n\n@jonrsharpe, still the same warning without space",
      "solution": "The packageManager field requires to match the following regex\n```\n`(npm|pnpm|yarn)@\\d+\\.\\d+\\.\\d+(-.+)?\n`\n```\nAnd\n```\n`\"packageManager\": \"^pnpm@6.32.4\"\n`\n```\nseems to resolve the warning but, for example\n```\n`\"packageManager\": \"123!@#pnpm@6.32.4\"\n`\n```\nalso meet the regex, which implies that the former might not work as intended.\nAccording to the PR on nodejs (deps: add corepack #39608)\n\nHow does Corepack work?\nThe sources are located inside nodejs/corepack. The gist is that Corepack installs \"jumpers\" next to the Node binary (just like what already happens for the npm and npx binaries) for the supported package managers (binaries are currently pnpm, pnpx, yarn, and yarnpkg, plus an extra one for corepack itself). They thus become exposed through the $PATH environment variable. Once called, these jumpers look into the local folder to find the top-most package.json, and read the packageManager field from them. Depending on the result:\n\nIf no packageManager field exists, the requested version is assumed to be the defaults ones in the Corepack configuration.\nIf a packageManager field exists, then it's used as the requested version.\n\nAnd in Corepack configuration,\n```\n`\"pnpm\": {\n  \"default\": \"7.3.0\",\n  ...\n}\n`\n```\nThe default version of pnpm is 7.3.0 as of now, which is used when packageManager field is omitted,\nSo it is best to set\n```\n`\"packageManager\": \"pnpm@6.32.4\"\n`\n```\nto ensure it working as intended.",
      "question_score": 60,
      "answer_score": 40,
      "created_at": "2022-04-05T09:13:14",
      "url": "https://stackoverflow.com/questions/71747609/how-to-specify-packagemanager-in-package-json"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 70582072,
      "title": "&quot;npm run&quot; fails with ERR_OSSL_EVP_UNSUPPORTED",
      "problem": "I have an existing project which I lately installed on a new equipment.\nIt is a Laravel + vue project.\nWhen I run `npm run watch` I get the following error:\n`> development\n> cross-env NODE_ENV=development node_modules/webpack/bin/webpack.js --progress --hide-modules --config=node_modules/laravel-mix/setup/webpack.config.js \"--watch\"\n\n10% building 1/1 modules 0 active\nwebpack is watching the files\u2026\n\n10% building 1/3 modules 2 active ...er/index.js??ref--5-4!/var/www/node_modules/sass-loader/lib/loader.js??ref--5-5!/var/www/resources/sass/app.scssError: error:0308010C:digital envelope routines::unsupported\n    at new Hash (node:internal/crypto/hash:67:19)\n    at Object.createHash (node:crypto:130:10)\n    at module.exports (/var/www/node_modules/webpack/lib/util/createHash.js:135:53)\n    at NormalModule._initBuildHash (/var/www/node_modules/webpack/lib/NormalModule.js:417:16)\n    at handleParseError (/var/www/node_modules/webpack/lib/NormalModule.js:471:10)\n    at /var/www/node_modules/webpack/lib/NormalModule.js:503:5\n    at /var/www/node_modules/webpack/lib/NormalModule.js:358:12\n    at /var/www/node_modules/loader-runner/lib/LoaderRunner.js:373:3\n    at iterateNormalLoaders (/var/www/node_modules/loader-runner/lib/LoaderRunner.js:214:10)\n    at iterateNormalLoaders (/var/www/node_modules/loader-runner/lib/LoaderRunner.js:221:10)\n    at /var/www/node_modules/loader-runner/lib/LoaderRunner.js:236:3\n    at runSyncOrAsync (/var/www/node_modules/loader-runner/lib/LoaderRunner.js:130:11)\n    at iterateNormalLoaders (/var/www/node_modules/loader-runner/lib/LoaderRunner.js:232:2)\n    at /var/www/node_modules/loader-runner/lib/LoaderRunner.js:186:6\n    at runSyncOrAsync (/var/www/node_modules/loader-runner/lib/LoaderRunner.js:130:11)\n    at /var/www/node_modules/loader-runner/lib/LoaderRunner.js:178:3\n    at loadLoader (/var/www/node_modules/loader-runner/lib/loadLoader.js:47:3)\n    at iteratePitchingLoaders (/var/www/node_modules/loader-runner/lib/LoaderRunner.js:169:2)\n    at iteratePitchingLoaders (/var/www/node_modules/loader-runner/lib/LoaderRunner.js:165:10)\n    at /var/www/node_modules/loader-runner/lib/LoaderRunner.js:188:6\n    at runSyncOrAsync (/var/www/node_modules/loader-runner/lib/LoaderRunner.js:124:12)\n    at /var/www/node_modules/loader-runner/lib/LoaderRunner.js:178:3\n    at loadLoader (/var/www/node_modules/loader-runner/lib/loadLoader.js:47:3)\n    at iteratePitchingLoaders (/var/www/node_modules/loader-runner/lib/LoaderRunner.js:169:2)\n    at runLoaders (/var/www/node_modules/loader-runner/lib/LoaderRunner.js:365:2)\n    at NormalModule.doBuild (/var/www/node_modules/webpack/lib/NormalModule.js:295:3)\n    at NormalModule.build (/var/www/node_modules/webpack/lib/NormalModule.js:446:15)\n    at Compilation.buildModule (/var/www/node_modules/webpack/lib/Compilation.js:739:10)\n    at /var/www/node_modules/webpack/lib/Compilation.js:981:14\n    at /var/www/node_modules/webpack/lib/NormalModuleFactory.js:409:6\n    at /var/www/node_modules/webpack/lib/NormalModuleFactory.js:155:13\n    at AsyncSeriesWaterfallHook.eval [as callAsync] (eval at create (/var/www/node_modules/tapable/lib/HookCodeFactory.js:33:10), :6:1)\n    at /var/www/node_modules/webpack/lib/NormalModuleFactory.js:138:29\n    at /var/www/node_modules/webpack/lib/NormalModuleFactory.js:346:9\n    at processTicksAndRejections (node:internal/process/task_queues:78:11)\nnode:internal/crypto/hash:67\n  this[kHandle] = new _Hash(algorithm, xofLen);\n                  ^\n\nError: error:0308010C:digital envelope routines::unsupported\n    at new Hash (node:internal/crypto/hash:67:19)\n    at Object.createHash (node:crypto:130:10)\n    at module.exports (/var/www/node_modules/webpack/lib/util/createHash.js:135:53)\n    at NormalModule._initBuildHash (/var/www/node_modules/webpack/lib/NormalModule.js:417:16)\n    at /var/www/node_modules/webpack/lib/NormalModule.js:452:10\n    at /var/www/node_modules/webpack/lib/NormalModule.js:323:13\n    at /var/www/node_modules/loader-runner/lib/LoaderRunner.js:367:11\n    at /var/www/node_modules/loader-runner/lib/LoaderRunner.js:233:18\n    at context.callback (/var/www/node_modules/loader-runner/lib/LoaderRunner.js:111:13)\n    at /var/www/node_modules/babel-loader/lib/index.js:55:103 {\n  opensslErrorStack: [ 'error:03000086:digital envelope routines::initialization error' ],\n  library: 'digital envelope routines',\n  reason: 'unsupported',\n  code: 'ERR_OSSL_EVP_UNSUPPORTED'\n}\n`\nI am using Node.js v17.3.0, npm version 8.3.0, and webpack 4.41.4.",
      "solution": "Node.js version 17 has switched to using OpenSSL 3.0. They advise:\n\nWhile OpenSSL 3.0 APIs should be mostly compatible with those provided by OpenSSL 1.1.1, we do anticipate some ecosystem impact due to tightened restrictions on the allowed algorithms and key sizes.\nIf you hit an `ERR_OSSL_EVP_UNSUPPORTED` error in your application with Node.js 17, it\u2019s likely that your application or a module you\u2019re using is attempting to use an algorithm or key size which is no longer allowed by default with OpenSSL 3.0. A command-line option, `--openssl-legacy-provider`, has been added to revert to the legacy provider as a temporary workaround for these tightened restrictions.\n\nThis has been resolved in Webpack versions 5 and 6, but there are no plans to backport this fix to version 4.\nTo pass the `--openssl-legacy-provider` flag to Node, you can prefix your command with the environment variable assignment:\n`NODE_OPTIONS=--openssl-legacy-provider npm run watch\n`",
      "question_score": 59,
      "answer_score": 86,
      "created_at": "2022-01-04T17:35:03",
      "url": "https://stackoverflow.com/questions/70582072/npm-run-fails-with-err-ossl-evp-unsupported"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 70296652,
      "title": "How can I use &quot;exports&quot; in package.json for nested submodules and TypeScript?",
      "problem": "I want to take advantage of the new-ish \"exports\" feature of Node.js/`package.json` so that I can do the following:\n```\n`\"exports\": {\n  \".\": \"./dist/index.js\",\n  \"./foo\": \"./dist/path/to/foo.js\"\n}\n`\n```\nand users can do the following:\n```\n`import { foo } from 'my-package/foo';\n`\n```\nTypeScript 4.5 should support the \"exports\" field, yet it does not seem to work. I am building a simple package using TS 4.5.2, and I am consuming that package in a project using TS 4.5.2. I have looked at other SO questions and this GitHub thread and this bug report but can't seem to find a consensus on the issue and whether it should work today.\nI am still able to import using the more verbose syntax:\n```\n`import { foo } from 'my-package/dist/path/to/foo.js';\n`\n```\nI have also tried the object notation for exports, to no avail:\n```\n`\"exports\": {\n  \".\": { \"require\": \"./dist/index.js\", \"import\": \"./dist/index.js\" },\n  \"./foo\": { \"require\": \"./dist/path/to/foo.js\", \"import\": \"./dist/path/to/foo.js\" }\n}\n`\n```\nIs this feature ready to be used with TypeScript projects today? If yes, what am I missing? Specifics about tsconfig would be useful for both the source project and consuming project. The TS compiler complains about `node12`/`nodenext` being used for either the `module` or `moduleResolution` fields (I am definitely using TS 4.5.2).",
      "solution": "Here's the breakdown:\n\nNode.js has supported `exports` since v12.7.0 (Jul. 2019)\nWhen I asked this question (Dec. 2021), Node.js had supported the `exports` field for  nearly 2.5 years. It seemed reasonable to assume that TypeScript supported it.\n\nThe latest version of TypeScript at that time (4.5) did not support the `exports` field.\nThis was particularly confusing because the TS 4.5 beta announcement said that it would support`package.json` exports.\n\nTypescript 4.7 (June 2022) finally supported `package.json` exports\n\nUsing `typesVersions` in `package.json` is not the solution\nSeveral people suggested using `typesVersions` - but that's a completely separate feature which is specific to TypeScript only (read more about it here). The `exports` field in `package.json` is a feature of node and should work with any npm module.\n\nSo, if you have a TypeScript project and you want to be able to import a package which uses `package.json` \"exports\", you will need to do the following:\n\nYour TypeScript project must be using TS v4.7 or later\nYour `tsconfig` should be using `moduleResolution` of `node16` or `nodenext`.\n\nYou don't have to set `moduleResolution` if you are using `module` with a value of `CommonJS`, `ES2015`, `ES6`, `ES2020`, or `ESNEXT`",
      "question_score": 58,
      "answer_score": 40,
      "created_at": "2021-12-09T22:00:09",
      "url": "https://stackoverflow.com/questions/70296652/how-can-i-use-exports-in-package-json-for-nested-submodules-and-typescript"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 73607410,
      "title": "&quot;ReferenceError: structuredClone is not defined&quot; using jest with nodejs &amp; typescript",
      "problem": "I'm running tests with `jest` in a simple NodeJS app that uses typescript. My test is throwing an error: `ReferenceError: structuredClone is not defined`.\nI'm not getting any linter errors and the code compiles fine normally.\n`  const variableForValidation = structuredClone(variableForValidationUncloned);\n`\npackage.json:\n`  \"dependencies\": {\n    ...\n  },\n  \"devDependencies\": {\n    \"@types/jest\": \"^29.0.0\",\n    \"@types/node\": \"^18.7.15\",\n    \"@typescript-eslint/eslint-plugin\": \"^5.36.1\",\n    \"@typescript-eslint/parser\": \"^5.36.1\",\n    \"eslint\": \"^8.23.0\",\n    \"jest\": \"^28.0.1\",\n    \"nodemon\": \"^2.0.19\",\n    \"serverless-plugin-typescript\": \"^2.1.2\",\n    \"ts-jest\": \"^28.0.8\",\n    \"ts-node\": \"^10.9.1\",\n    \"typescript\": \"^4.8.2\"\n  }\n\n`\nThis github issue suggests to me that the issue has been resolved: https://github.com/facebook/jest/issues/12628 - or perhaps I'm misunderstanding?\nI've seen a similar Stack question but using Mocha: mocha not recognizing structuredClone is not defined",
      "solution": "`structuredClone` was added in Node 17.\nIf you can't update, the `JSON` hack (stringify then parse) works, but has some shortcomings that might be relevant to you:\n\nRecursive data structures: JSON.stringify() will throw when you give\nit a recursive data structure. This can happen quite easily when\nworking with linked lists or trees.\nBuilt-in types: JSON.stringify()\nwill throw if the value contains other JS built-ins like Map, Set,\nDate, RegExp or ArrayBuffer.\nFunctions: JSON.stringify() will quietly\ndiscard functions.\n\nEdit 2fev23:\nI recently learned about the json-stringify-safe, that helps with the circular issue.\nEdit 24jan25:\nThere are other options, sorted by GitHub stars:\n\nFlight Control's superjson - 4.3k\nYahoo's serialize-javascript - 2.8k\nRich Harris' devalue - 2.2k",
      "question_score": 56,
      "answer_score": 48,
      "created_at": "2022-09-05T11:42:47",
      "url": "https://stackoverflow.com/questions/73607410/referenceerror-structuredclone-is-not-defined-using-jest-with-nodejs-typesc"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 71282206,
      "title": "github Dependabot alert: Inefficient Regular Expression Complexity in nth-check",
      "problem": "Possible duplicate, but couldn't find any clear answers.\n\nDependabot cannot update nth-check to a non-vulnerable version\nThe latest possible version that can be installed is 1.0.2 because of the following >conflicting dependency:\n\nreact-scripts@5.0.0 requires nth-check@^1.0.2 via a transitive dependency on css-select@2.1.0\n\njust upgraded to react-scripts@5.0.0 from 4.0.0.",
      "solution": "As Dan Abramov explains in this issue, it is (very likely) a false alarm and can be safely dismissed.\nMore specifically, if you are using CRA and nth-check is referenced only from it, it is not an issue, because CRA is a build tool and the vulnerable code will never get into the resulting application bundle and thus will never be called by client code.\nYou can verify this by moving \"react-scripts\" into \"devDependencies\" in `package.json` and running `npm audit --production`.",
      "question_score": 54,
      "answer_score": 82,
      "created_at": "2022-02-27T05:53:31",
      "url": "https://stackoverflow.com/questions/71282206/github-dependabot-alert-inefficient-regular-expression-complexity-in-nth-check"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 74747476,
      "title": "DeprecationWarning: Mongoose: the `strictQuery` option will be switched back to `false` by default in Mongoose 7",
      "problem": "I am just making a database called Fruits from my `app.js` and connecting the database to MongoDB using Mongoose.\n`const mongoose = require(\"mongoose\");\n\nmongoose.connect(\"mongodb://localhost:27017/fruitsDB\", {useNewUrlParser: true});\n\nmongoose.set('strictQuery', false);\n\nconst fruitSchema = new mongoose.Schema({\n    name: String,\n    rating: Number,\n    review: String\n});\n\nconst Fruit = mongoose.model(\"Fruit\", fruitSchema);\n\nconst fruit = new Fruit({\n    name: \"Apple\",\n    rating: 7,\n    review: \"Taste Good\"\n});\n\nfruit.save();\n`\nWhenever I try `node app.js`, I am getting DeprecationWarning. Even though I tried using `mongoose.set('strictQuery', true);`, the same error continues as follows:\n`(node:15848) [MONGOOSE] DeprecationWarning: Mongoose: the `strictQuery` option w\nill be switched back to `false` by default in Mongoose 7. Use `mongoose.set('str\nictQuery', false);` if you want to prepare for this change. Or use `mongoose.set\n('strictQuery', true);` to suppress this warning.\n(Use `node --trace-deprecation ...` to show where the warning was created)\nD:\\Web Development\\FruitsProject\\node_modules\\mongoose\\lib\\drivers\\node-mongodb-\nnative\\collection.js:158\n          const err = new MongooseError(message);\n                      ^\n\nMongooseError: Operation `fruits.insertOne()` buffering timed out after 10000ms\n    at Timeout. (D:\\Web Development\\FruitsProject\\node_modules\\mongoo\nse\\lib\\drivers\\node-mongodb-native\\collection.js:158:23)\n    at listOnTimeout (node:internal/timers:564:17)\n    at process.processTimers (node:internal/timers:507:7)\n\nNode.js v18.12.1\n`\nAnd then the second error also continues fruits.insertOne().\nBecause of this, my MongoDB database is not getting updated.\n`test> show dbs\nadmin    40.00 KiB\nconfig  108.00 KiB\nlocal    40.00 KiB\nshopDB   72.00 KiB\n`\nI just want to fix this error. But I don't know where to fix this error. For the second part of the error, it seems like it is coming from the node_modules itself. How can I fix this error?",
      "solution": "```\n`mongoose.set(\"strictQuery\", false);\n\nmongoose.connect(process.env.MONGO_URL);\n`\n```\nOR\n```\n`mongoose.set(\"strictQuery\", false);\nmongoose.connect(process.env.MONGO_URL, () => {\n  console.log(\"Connected to MongoDB\");\n});\n`\n```\n`const connectDB = async () => {\n    try {\n        mongoose.set('strictQuery', false);\n        await mongoose.connect(db, {\n            useNewUrlParser: true,\n            useUnifiedTopology: true,\n        });\n        console.log('MongoDB Connected...');\n    } catch (err) {\n        console.error(err.message);\n        // make the process fail\n        process.exit(1);\n    }\n`",
      "question_score": 53,
      "answer_score": 91,
      "created_at": "2022-12-09T20:24:21",
      "url": "https://stackoverflow.com/questions/74747476/deprecationwarning-mongoose-the-strictquery-option-will-be-switched-back-to"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 68085375,
      "title": "Cannot find module &#39;fs/promises&#39;",
      "problem": "Good morning,\nI have created a program in Vue JS, this connects with an API that I have created in a main.js file to execute system commands.\nThe problem I have is that when compiling for production with electron I get the following error:\n\nI use the command `npm run electron:build`\nWhen I use `npm run electron:serve` work without problems\nAnyone have any idea why is the error and how to fix it?\nThanks",
      "solution": "I experienced this issue a few days ago as well. I realized that trying to fix another issue, I deleted the `node_modules` folder and the `package-lock.json` file, then run the `npm install` command. This made the build to fail with 'fs/promises'. There are 2 solutions to this issue:\n\nDownload the latest stable Node version. This should have the `fs/promises` module and will fix the issue.\nDelete the `node_modules` folder and bring back the old `package-lock.json` file to ensure that the package versions remain the same. Then run the `npm install` command and the issue should be fixed.",
      "question_score": 53,
      "answer_score": 45,
      "created_at": "2021-06-22T16:25:59",
      "url": "https://stackoverflow.com/questions/68085375/cannot-find-module-fs-promises"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 69665780,
      "title": "Error [ERR_UNSUPPORTED_ESM_URL_SCHEME]: Only file and data URLs are supported by the default ESM loader - Vue 3",
      "problem": "I get the following error when i want to start my vue 3 typescript project:\n```\n` ERROR  Error [ERR_UNSUPPORTED_ESM_URL_SCHEME]: Only file and data URLs are supported by the default ESM loader. On Windows, absolute paths must be valid file:// URLs. Received protocol 'c:'\n Error [ERR_UNSUPPORTED_ESM_URL_SCHEME]: Only file and data URLs are supported by the default ESM loader. On Windows, absolute paths must be valid file:// URLs. Received protocol 'c:'\nat new NodeError (node:internal/errors:371:5)\nat defaultResolve (node:internal/modules/esm/resolve:1016:11)\nat ESMLoader.resolve (node:internal/modules/esm/loader:422:30)\nat ESMLoader.getModuleJob (node:internal/modules/esm/loader:222:40)\nat ESMLoader.import (node:internal/modules/esm/loader:276:22)\nat importModuleDynamically (node:internal/modules/cjs/loader:1041:29)\nat importModuleDynamicallyWrapper (node:internal/vm/module:437:21)\nat importModuleDynamically (node:vm:381:46)\nat importModuleDynamicallyCallback (node:internal/process/esm_loader:35:14)\nat loadFileConfig (C:\\Projects\\backify-ui\\documentation\\node_modules\\@vue\\cli-service\\lib\\util\\loadFileConfig.js:28:7)\n`\n```\nThis error occurs since I renamed my `vue.config.js` to `vue.config.mjs`. The funny thing is that this project works via gitpod.io but not in phpstorm and vscode.\nMy vue.config.mjs:\n```\n`import rehypeHighlight from \"rehype-highlight\";\n\nexport default {\n  chainWebpack: (config) => {\n    config.module\n      .rule(\"mdx\")\n      .test(/\\.mdx?$/)\n      .use(\"babel-loader\")\n      .loader(\"babel-loader\")\n      .options({ plugins: [\"@vue/babel-plugin-jsx\"] /* Other options\u2026 */ })\n      .end()\n      .use(\"@mdx-js/loader\")\n      .loader(\"@mdx-js/loader\")\n      .options({\n        jsx: true,\n        rehypePlugins: [rehypeHighlight] /* otherOptions\u2026 */,\n      })\n      .end();\n  },\n};\n`\n```",
      "solution": "The whole thing seems to be a bug with the current vue cli configuration and node.js version. For more info check out the comment from @Dima Parzhitsky and @Zhang Buzz.\nThe best workaround for me was to simply use the `@vue/cli@5.0.0-beta.7` in combination with node `v16.12.0`.\nAlso i use a `vue.config.mjs` instead of `vue.config.js`\nAnother solution could be to move the whole thing into the package.json, more about this in the comment of @James Batchelor (but i didn't test it)",
      "question_score": 50,
      "answer_score": 5,
      "created_at": "2021-10-21T18:42:34",
      "url": "https://stackoverflow.com/questions/69665780/error-err-unsupported-esm-url-scheme-only-file-and-data-urls-are-supported-by"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 70383636,
      "title": "All NPM commands error with TypeError: Class extends value undefined is not a constructor or null",
      "problem": "I've been using `n` to install node for years with no issues. Now on my Big Sur mac, I updated from v14.17.6 to v16. This updated without incident and `node -v` shows \"16.13.1\".\nHowever afterwards, any npm command I run immediately errors with this:\n```\n`\u00bb npm -v\nTypeError: Class extends value undefined is not a constructor or null\n    at Object. (/usr/local/lib/node_modules/npm/node_modules/socks-proxy-agent/dist/agent.js:114:44)\n    at Module._compile (node:internal/modules/cjs/loader:1097:14)\n    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1149:10)\n    at Module.load (node:internal/modules/cjs/loader:975:32)\n    at Function.Module._load (node:internal/modules/cjs/loader:822:12)\n    at Module.require (node:internal/modules/cjs/loader:999:19)\n    at require (node:internal/modules/cjs/helpers:102:18)\n    at Object. (/usr/local/lib/node_modules/npm/node_modules/socks-proxy-agent/dist/index.js:5:33)\n    at Module._compile (node:internal/modules/cjs/loader:1097:14)\n    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1149:10)\n    at Module.load (node:internal/modules/cjs/loader:975:32)\n    at Function.Module._load (node:internal/modules/cjs/loader:822:12)\n    at Module.require (node:internal/modules/cjs/loader:999:19)\n    at require (node:internal/modules/cjs/helpers:102:18)\n    at Object. (/usr/local/lib/node_modules/npm/node_modules/make-fetch-happen/lib/agent.js:161:25)\n    at Module._compile (node:internal/modules/cjs/loader:1097:14)\n`\n```\nI tried an earlier v16 build (16.9.1) and `n latest` which is currently 17.2.0, and again any npm command immediately errors with the exact same issue. Dropping my node version back to 14.17.6, and `npm` is back to working properly.\nAny idea on how to resolve this?",
      "solution": "I had the same issue. Had some older npm installation and when I ran the windows installer it failed.\nI did the following:\n\nuse the installer (https://nodejs.org/en/download/) to remove node,npm\ndelete from `C:\\Users\\%username%\\AppData\\Roaming\\npm-cache` and nvm folders if available.\nremove `C:\\Program Files\\node` if available\nremove Environment Variables all settings for NPM and NODE. There are both in user and system wide multiple entries.\n\nReinstall everything with the installer.",
      "question_score": 49,
      "answer_score": 48,
      "created_at": "2021-12-16T19:00:17",
      "url": "https://stackoverflow.com/questions/70383636/all-npm-commands-error-with-typeerror-class-extends-value-undefined-is-not-a-co"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 72895721,
      "title": "FirebaseCloudMessaging : PlatformException (PlatformException(null-error, Host platform returned null value for non-null return value., null, null))",
      "problem": "I'm trying to send notifications from an Node.js API to a Flutter application.\nFirst, I want to make my application able to receive notifications from Firebase.\nBut, when I initializeApp, I got an issue :\n\nPlatformException (PlatformException(null-error, Host platform\nreturned null value for non-null return value., null, null))\n\nand this, in the console:\n`E/flutter (25357): [ERROR:flutter/lib/ui/ui_dart_state.cc(198)] Unhandled Exception: PlatformException(null-error, Host platform returned null value for non-null return value., null, null)\nE/flutter (25357): #0      FirebaseCoreHostApi.optionsFromResource (package:firebase_core_platform_interface/src/pigeon/messages.pigeon.dart:250)\npackage:firebase_core_platform_interface/\u2026/pigeon/messages.pigeon.dart:1\nE/flutter (25357): \nE/flutter (25357): #1      MethodChannelFirebase.initializeApp (package:firebase_core_platform_interface/src/method_channel/method_channel_firebase.dart:89)\npackage:firebase_core_platform_interface/\u2026/method_channel/method_channel_firebase.dart:1\nE/flutter (25357): \nE/flutter (25357): #2      Firebase.initializeApp (package:firebase_core/src/firebase.dart:40)\npackage:firebase_core/src/firebase.dart:1\nE/flutter (25357): \nE/flutter (25357): #3      main (package:notifappfcm/main.dart:13)\npackage:notifappfcm/main.dart:1\n`\nI've been looking for a solution to this problem, but I really can't find it.\nThis is my application code:\nmain.dart\n```\n`import 'package:firebase_messaging/firebase_messaging.dart';\nimport 'package:flutter/material.dart';\nimport 'package:firebase_core/firebase_core.dart';\nimport 'mainscreen.dart';\n\nFuture _firebadeMessagingBackgroundHandler(RemoteMessage message) async {\n  await Firebase.initializeApp(); // options: DefaultFirebaseConfig.platformOptions\n  print('Handling a background message ${message.messageId}');\n}\n\nvoid main() async {\n  WidgetsFlutterBinding.ensureInitialized();\n  await Firebase.initializeApp();\n\n  FirebaseMessaging.onBackgroundMessage(_firebadeMessagingBackgroundHandler);\n\n  runApp(const MyApp());\n}\n\nclass MyApp extends StatelessWidget {\n  const MyApp({Key? key}) : super(key: key);\n\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      title: 'Flutter Demo',\n      theme: ThemeData(\n        primarySwatch: Colors.blue,\n      ),\n      home: const MainScreen(),\n    );\n  }\n}\n\nclass MyHomePage extends StatefulWidget {\n  const MyHomePage({Key? key, required this.title}) : super(key: key);\n\n  final String title;\n\n  @override\n  State createState() => _MyHomePageState();\n}\n\nclass _MyHomePageState extends State {\n  int _counter = 0;\n\n \n  void _incrementCounter() {\n    setState(() {\n      _counter++;\n    });\n  }\n\n @override\n  void initState() {\n    super.initState();\n  }\n\n  \n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: Text(widget.title),\n      ),\n      body: Center(\n        child: Column(\n          mainAxisAlignment: MainAxisAlignment.center,\n          children: [\n            const Text(\n              'You have pushed the button this many times:',\n            ),\n            Text(\n              '$_counter',\n              style: Theme.of(context).textTheme.headline4,\n            ),\n          ],\n        ),\n      ),\n      floatingActionButton: FloatingActionButton(\n        onPressed: _incrementCounter,\n        tooltip: 'Increment',\n        child: const Icon(Icons.add),\n      ),\n    );\n  }\n}\n`\n```\nmainscreen.dart\n```\n`import 'package:firebase_messaging/firebase_messaging.dart';\nimport 'package:flutter/foundation.dart';\nimport 'package:flutter/material.dart';\nimport 'package:flutter_local_notifications/flutter_local_notifications.dart';\n\nclass MainScreen extends StatefulWidget {\n  const MainScreen({Key? key}) : super(key: key);\n\n  @override\n  State createState() => _MainScreenState();\n}\n\nclass _MainScreenState extends State {\n  late AndroidNotificationChannel channel;\n  late FlutterLocalNotificationsPlugin flutterLocalNotificationsPlugin;\n\n  @override\n  void initState() {\n    super.initState();\n\n    requestPermission();\n    loadFCM();\n    listenFCM();\n    // Get device's notification token\n    getToken();\n  }\n\n  void getToken() async {\n    await FirebaseMessaging.instance.getToken().then((token) => print(token));\n  }\n\n  void requestPermission() async {\n    FirebaseMessaging messaging = FirebaseMessaging.instance;\n\n    NotificationSettings settings = await messaging.requestPermission(\n      alert: true,\n      announcement: false,\n      badge: true,\n      carPlay: false,\n      criticalAlert: false,\n      provisional: false,\n      sound: true,\n    );\n\n    if (settings.authorizationStatus == AuthorizationStatus.authorized) {\n      print('User granted permission');\n    } else if (settings.authorizationStatus ==\n        AuthorizationStatus.provisional) {\n      print('User granted provisional permission');\n    } else {\n      print('User declined or has not accepted permission');\n    }\n  }\n\n  void listenFCM() async {\n    FirebaseMessaging.onMessage.listen((RemoteMessage message) {\n      RemoteNotification? notification = message.notification;\n      AndroidNotification? android = message.notification?.android;\n      if (notification != null && android != null && !kIsWeb) {\n        flutterLocalNotificationsPlugin.show(\n            notification.hashCode,\n            notification.title,\n            notification.body,\n            NotificationDetails(\n                android: AndroidNotificationDetails(channel.id, channel.name,\n                    // ignore: todo\n                    // TODO add a proper drawable resource to android (now using one that already exists)\n                    icon: 'launch_background')));\n      }\n    });\n  }\n\n  void loadFCM() async {\n    if (!kIsWeb) {\n      channel = const AndroidNotificationChannel(\n        'high_importance_channel', // id\n        'High Importance Notifications', // title\n        importance: Importance.high,\n        enableVibration: true,\n      );\n\n      flutterLocalNotificationsPlugin = FlutterLocalNotificationsPlugin();\n\n      /// Create an Android Notification Channel.\n      ///\n      /// We use this channel in the `AndroidManifest.xml` file to override the\n      /// default FCM channel to enable heads up notifications.\n      await flutterLocalNotificationsPlugin\n          .resolvePlatformSpecificImplementation()\n          ?.createNotificationChannel(channel);\n\n      /// Update the iOS foreground notification presentation options to allow\n      /// heads up notifications.\n      await FirebaseMessaging.instance\n          .setForegroundNotificationPresentationOptions(\n        alert: true,\n        badge: true,\n        sound: true,\n      );\n    }\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n        body: Center(\n      child: Container(\n        height: 40,\n        width: 200,\n        color: Colors.red,\n      ),\n    ));\n  }\n}\n`\n```",
      "solution": "Make sure you have added the Firebase SDK dependencies in the\nProject Level build.gradle file\nand Application Level build.gradle file\nDependencies to be added in Project Level build.gradle:\n```\n`buildscript {\n  repositories {\n    // Check that you have the following line (if not, add it):\n    google()  // Google's Maven repository\n  }\n  dependencies {\n    ...\n    // Add this line\n    classpath 'com.google.gms:google-services:4.3.13'\n  }\n}\n\nallprojects {\n  ...\n  repositories {\n    // Check that you have the following line (if not, add it):\n    google()  // Google's Maven repository\n    ...\n  }\n}\n`\n```\nDependencies to be added in App Level build.gradle:\n```\n`apply plugin: 'com.android.application'\n// Add this line\napply plugin: 'com.google.gms.google-services'\n\ndependencies {\n  // Import the Firebase BoM\n  implementation platform('com.google.firebase:firebase-bom:30.2.0')\n\n  // Add the dependency for the Firebase SDK for Google Analytics\n  // When using the BoM, don't specify versions in Firebase dependencies\n  implementation 'com.google.firebase:firebase-analytics'\n\n  // Add the dependencies for any other desired Firebase products\n  // https://firebase.google.com/docs/android/setup#available-libraries\n}\n`\n```",
      "question_score": 48,
      "answer_score": 77,
      "created_at": "2022-07-07T11:49:54",
      "url": "https://stackoverflow.com/questions/72895721/firebasecloudmessaging-platformexception-platformexceptionnull-error-host-p"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 72203399,
      "title": "Why am I suddenly getting &quot;Could not read source map&quot; in VSCode using Angular with NodeJS 17 and above?",
      "problem": "I suddenly can't debug my Angular Application. Not quite sure what I did. It might have happen after I updated node.js\n\nAngular: 13.1.1\nNodeJS: 18.1.0\nVSCode: 1.67.1\n\nLaunch.json\n```\n`\"configurations\": [\n    {\n      \"type\": \"pwa-chrome\",\n      \"request\": \"launch\",\n      \"name\": \"Launch Chrome against localhost\",\n      \"url\": \"http://localhost:4200\",\n      \"webRoot\": \"${workspaceFolder}/src\",\n      \"sourceMaps\": true,\n    },\n  ]\n`\n```\nErrors:\n```\n`Could not read source map for http://localhost:4200/runtime.js: Unexpected 503 response from http://127.0.0.1:4200/runtime.js.map: connect ECONNREFUSED 127.0.0.1:4200\nCould not read source map for http://localhost:4200/vendor.js: Unexpected 503 response from http://127.0.0.1:4200/vendor.js.map: connect ECONNREFUSED 127.0.0.1:4200\nCould not read source map for http://localhost:4200/main.js: Unexpected 503 response from http://127.0.0.1:4200/main.js.map: connect ECONNREFUSED 127.0.0.1:4200\nCould not read source map for http://localhost:4200/styles.js: Unexpected 503 response from http://127.0.0.1:4200/styles.js.map: connect ECONNREFUSED 127.0.0.1:4200\nCould not read source map for http://localhost:4200/polyfills.js: Unexpected 503 response from http://127.0.0.1:4200/polyfills.js.map: connect ECONNREFUSED 127.0.0.1:4200\nCould not read source map for http://localhost:4200/scripts.js: Unexpected 503 response from http://127.0.0.1:4200/scripts.js.map: connect ECONNREFUSED 127.0.0.1:4200\nCould not read source map for http://localhost:4200/common.js: Unexpected 503 response from http://127.0.0.1:4200/common.js.map: connect ECONNREFUSED 127.0.0.1:4200\nCould not read source map for http://localhost:4200/common.js: Unexpected 503 response from http://127.0.0.1:4200/common.js.map: connect ECONNREFUSED 127.0.0.1:4200\nCould not read source map for http://localhost:4200/src_app_lora_lora_module_ts.js: Unexpected 503 response from http://127.0.0.1:4200/src_app_lora_lora_module_ts.js.map: connect ECONNREFUSED 127.0.0.1:4200\nCould not read source map for http://localhost:4200/src_app_telegrams_telegrams_module_ts.js: Unexpected 503 response from http://127.0.0.1:4200/src_app_telegrams_telegrams_module_ts.js.map: connect ECONNREFUSED 127.0.0.1:4200\nCould not read source map for http://localhost:4200/src_app_items-management_items-management_module_ts.js: Unexpected 503 response from http://127.0.0.1:4200/src_app_items-management_items-management_module_ts.js.map: connect ECONNREFUSED 127.0.0.1:4200\nCould not read source map for http://localhost:4200/src_app_model-management_model-management_module_ts.js: Unexpected 503 response from http://127.0.0.1:4200/src_app_model-management_model-management_module_ts.js.map: connect ECONNREFUSED 127.0.0.1:4200\nCould not read source map for http://localhost:4200/src_app_key-management_key-management_module_ts.js: Unexpected 503 response from http://127.0.0.1:4200/src_app_key-management_key-management_module_ts.js.map: connect ECONNREFUSED 127.0.0.1:4200\nCould not read source map for http://localhost:4200/default-src_app_model-management_services_items_service_ts-src_app_model-management_services_-687318.js: Unexpected 503 response from http://127.0.0.1:4200/default-src_app_model-management_services_items_service_ts-src_app_model-management_services_-687318.js.map: connect ECONNREFUSED 127.0.0.1:4200\nCould not read source map for http://localhost:4200/src_app_gum_gum_module_ts.js: Unexpected 503 response from http://127.0.0.1:4200/src_app_gum_gum_module_ts.js.map: connect ECONNREFUSED 127.0.0.1:4200\nCould not read source map for http://localhost:4200/src_app_biot_biot_module_ts.js: Unexpected 503 response from http://127.0.0.1:4200/src_app_biot_biot_module_ts.js.map: connect ECONNREFUSED 127.0.0.1:4200\n`\n```",
      "solution": "I actually had the same problem (using Angular 14 with NX).\nThe debugger would work on node 16 but not on node 18.\nWhat made it work is adding the flag '--host=127.0.0.1' to the start script in package.json.\n```\n`\"start\": \"ng serve --host=127.0.0.1\"\n`\n```\nMy launch json:\n```\n` \"version\": \"0.2.0\",\n  \"configurations\": [\n    \n    {\n      \"name\": \"Debug Frontend\",\n      \"type\": \"pwa-chrome\",\n      \"request\": \"launch\",\n      \"preLaunchTask\": \"Serve Frontend\",\n      \"url\": \"http://localhost:4200/#\",\n      \"webRoot\": \"${workspaceFolder}\",\n      \"sourceMaps\": true,\n      \"sourceMapPathOverrides\": {\n        \"webpack:/*\": \"${webRoot}/*\",\n        \"/./*\": \"${webRoot}/*\",\n        \"/src/*\": \"${webRoot}/src/*\",\n        \"/*\": \"*\",\n        \"/./~/*\": \"${workspaceFolder}/node_modules/*\"\n      }\n    }\n`\n```\nMy tasks.json\n```\n`{\n  \"version\": \"2.0.0\",\n  \"tasks\": [\n    {\n      \"label\": \"Serve Frontend\",\n      \"type\": \"npm\",\n      \"script\": \"start\",\n      \"isBackground\": true,\n      \"presentation\": {\n        \"focus\": true,\n        \"panel\": \"dedicated\"\n      },\n      \"group\": {\n        \"kind\": \"build\",\n        \"isDefault\": true\n      },\n      \"problemMatcher\": {\n        \"owner\": \"typescript\",\n        \"source\": \"ts\",\n        \"applyTo\": \"closedDocuments\",\n        \"fileLocation\": [\"relative\", \"${cwd}\"],\n        \"pattern\": \"$tsc\",\n        \"background\": {\n          \"activeOnStart\": true,\n          \"beginsPattern\": {\n            \"regexp\": \"(.*?)\"\n          },\n          \"endsPattern\": {\n            \"regexp\": \"Compiled |Failed to compile.\"\n          }\n        }\n      }\n    }\n  ]\n}\n`\n```\nEdit:\nIf you are using NX, you need to change the name of your script in tasks.json to match your package.json, as well as need to add the host to the start script in package.json:\n```\n`\"start:frontend\": \"nx serve frontend --host=127.0.0.1\"\n`\n```",
      "question_score": 48,
      "answer_score": 67,
      "created_at": "2022-05-11T17:05:53",
      "url": "https://stackoverflow.com/questions/72203399/why-am-i-suddenly-getting-could-not-read-source-map-in-vscode-using-angular-wi"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 74227892,
      "title": "Error: TypeError: &#39;process.env&#39; only accepts a configurable whileinstall windows-build-tools",
      "problem": "Downloading installers failed. Error: TypeError: 'process.env' only accepts a configurable, writable, and enumerable data descriptor.\nI have run this command npm install --global windows-build-tools\nNode version : v18.12.0\nNPM version : 8.19",
      "solution": "I had the exact same problem.\nFirst I tried to do `npm install --global --production windows-build-tools@4.0.0 ` but didn't work then `npm config set msvs_version 2022` but still didn't work.\nFinally I tried to download node version 17.9.1 and retried the command and it worked!!\nSo here are the steps:\nStep 1: uninstall Node version 18.12 and install version 17.9.1\nStep 2: Search %temp% under window search bar (Copy %temp% then press windows button + Ctrl V)\n\nStep 3: Create 'dd_client_.log.txt' and enter 'Closing installer. Return code: 3010.'\n\nafter that you should be able to finish the whole process with `npm install --global windows-build-tools`\nbig thanks to seantsang\nBetween I have no Idea if the technique of seantsang work directly when installing windows-build-tools with node.js version 18.12 .\nIf what I said didn't help, maybe try this",
      "question_score": 47,
      "answer_score": 66,
      "created_at": "2022-10-27T22:21:18",
      "url": "https://stackoverflow.com/questions/74227892/error-typeerror-process-env-only-accepts-a-configurable-whileinstall-windows"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 74548318,
      "title": "How to resolve &quot;Error: error:0308010C:digital envelope routines::unsupported&quot; Nodejs 18 error",
      "problem": "I need help with my NuxtJS application.\nI recently had ESLint conflicts in the app after I left it for some time without updating (2 months). So after I started working on it, it presented a challenge trying to resolve the ESLint issue. I then had to migrate the project to a newer version of Node and ESLint.\nAfter doing this, I solved the conflict issue and my project could install my dependencies, but now the server won't start. Node is now throwing an error that I don't even know how to fix. I don't know if many others are facing this issue after upgrading their versions of Node.js, but it's throwing an error about an unsupported hash function.\nHere is a screenshot of the terminal error that is preventing my server from starting up:\n\nI have resolved all ESLint and syntax errors that came with the migration, so I don't know what else to do.\nBelow is a snippet of my nuxt.config.js file:\n`export default {\n  // Global page headers: https://go.nuxtjs.dev/config-head\n  head: {\n    title: 'heritage-fd',\n    meta: [\n      { charset: 'utf-8' },\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\n      { hid: 'description', name: 'description', content: '' },\n      { name: 'format-detection', content: 'telephone=no' }\n    ],\n    \n    link: [\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\n    ],\n    \n    script: [\n      {\n        src: '~/static/css/bootstrap.min.js',\n      },\n    ],\n  },\n\n  // Global CSS: https://go.nuxtjs.dev/config-css\n  css: [\n    {src: '~/static/css/bootstrap.min.css', lang: 'scss'},\n    {src: '~/assets/scss/custom.scss', lang: 'scss'},\n    {src: \"~layouts/global.css\"},\n    {src: '~/static/css/style.css', lang: 'scss'},\n    {src: '~/assets/css/main.css'}\n    \n  ],\n\n  // Plugins to run before rendering page: https://go.nuxtjs.dev/config-plugins\n   plugins: [\n    \"~/plugins/vee-validate.js\",\n    { src: '~/plugins/persistedState.client.js', ssr: false }\n   ],\n\n  // Auto import components: https://go.nuxtjs.dev/config-components\n  components: true,\n\n  // Modules for dev and build (recommended): https://go.nuxtjs.dev/config-modules\n  buildModules: [\n    // https://go.nuxtjs.dev/eslint\n    '@nuxtjs/eslint-module',\n    'nuxt-gsap-module',\n    '@nuxtjs/fontawesome',\n  ],\n\n  // Modules: https://go.nuxtjs.dev/config-modules\n  modules: [\n    // https://go.nuxtjs.dev/axios\n    '@nuxtjs/axios',\n    // https://go.nuxtjs.dev/pwa\n    '@nuxtjs/pwa',\n    '@nuxtjs/auth-next',\n    'nuxt-vue-select'\n  ],\n\n  // Axios module configuration: https://go.nuxtjs.dev/config-axios\n  axios: {\n    // Workaround to avoid enforcing hard-coded localhost:3000: https://github.com/nuxt-community/axios-module/issues/308\n    baseURL: 'http://localhost:8000/api/',\n    \n  },\n\n  // PWA module configuration: https://go.nuxtjs.dev/pwa\n   pwa: {\n    manifest: {\n      lang: 'en',\n    },\n  },\n\n  // Build Configuration: https://go.nuxtjs.dev/config-build\n build: {\n    transpile: [\"vee-validate/dist/rules\"],\n    vendor: [\"vue-tables-2\"]\n  },\n}\n`",
      "solution": "Concerning this error, after doing some much research, i finally discovered that the whole error comes with the nodejs upgrade to version v18.12.1, so i advice everyone facing this same issue who just recently upgraded tio node v18.12.1 to downgrade back to node v16.0.0, if u need help with this , you can use `nvm`.\nsome steps are outlined below, with some link to resources\n`\n\nDownload and install nvm\nFollow instructions here\n\nInstall Nodejs v16.0.0\n`nvm install 16.0.0`\n\nUninstall nodejs v18.12.1\n`nvm uninstall 18.12.1` or your own version of node\n\nI truly this helps someone as it did for me, I know the pains that come with framework errors. Please comment if you need further assistance.\nthank you.",
      "question_score": 45,
      "answer_score": 47,
      "created_at": "2022-11-23T15:22:34",
      "url": "https://stackoverflow.com/questions/74548318/how-to-resolve-error-error0308010cdigital-envelope-routinesunsupported-no"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 70398678,
      "title": "i tried to Polyfill modules in webpack 5 but not working (Reactjs)",
      "problem": "Hi guys am a newbie in React when i start my project i get the Wepback V5 Error Message\nResolve updated : https://github.com/facebook/create-react-app/issues/11756#issuecomment-1001162736\nThis What am using!\n```\n`Os: Win11\nNode : v16\nReact:v17\nReact-script : v5\nWebpack:v5\n`\n```\nThis Error Message Contains\n```\n`Crypto\nHttp\nHttps\nStream\n`\n```\nError Output\nCompiled with problems:X\n```\n`ERROR in ./node_modules/eth-lib/lib/bytes.js 9:193-227\n\nModule not found: Error: Can't resolve 'crypto' in 'C:\\Users\\PC\\Desktop\\Portfolio\\portfolio_app\\node_modules\\eth-lib\\lib'\n\nBREAKING CHANGE: webpack Image Contain Output",
      "solution": "I resolve these errors but my app did not render.\nIf you are interested to clear these errors you can paste code right into `your-project/node_modules/react-scripts/config/webpack.config.js` but these changes can be overwritten after rebuilding your app.\nFind in  module.exports object resolve and write fallback,in your case it's \"crypto\": `require.resolve(\"crypto-browserify\")`.\nAnd install dependency `npm install crypto-browserify`.\n```\n`resolve: {\n//   fallback: {\n//     \"fs\": false,\n//     \"tls\": false,\n//     \"net\": false,\n//     \"http\": require.resolve(\"stream-http\"),\n//     \"https\": false,\n//     \"zlib\": require.resolve(\"browserify-zlib\") ,\n//     \"path\": require.resolve(\"path-browserify\"),\n//     \"stream\": require.resolve(\"stream-browserify\"),\n//     \"util\": require.resolve(\"util/\"),\n       \"crypto\": require.resolve(\"crypto-browserify\")\n} \n`\n```\nOr you can add fallback using react-app-rewired as was described in Github https://github.com/facebook/create-react-app/issues/11756\nInstall react-app-rewired, create `config-overrides.js` file in the root of your project.\nMy code in the file\n`module.exports = function override (config, env) {\n    console.log('override')\n    let loaders = config.resolve\n    loaders.fallback = {\n        \"fs\": false,\n        \"tls\": false,\n        \"net\": false,\n        \"http\": require.resolve(\"stream-http\"),\n        \"https\": false,\n        \"zlib\": require.resolve(\"browserify-zlib\") ,\n        \"path\": require.resolve(\"path-browserify\"),\n        \"stream\": require.resolve(\"stream-browserify\"),\n        \"util\": require.resolve(\"util/\"),\n        \"crypto\": require.resolve(\"crypto-browserify\")\n    }\n    \n    return config\n}\n`\nIn package.json change scripts from\n`'start': 'react-scripts start'`\nto\n`'start': 'react-app-rewired start'`.\nThen start project npm run start or yarn start",
      "question_score": 45,
      "answer_score": 36,
      "created_at": "2021-12-17T21:41:44",
      "url": "https://stackoverflow.com/questions/70398678/i-tried-to-polyfill-modules-in-webpack-5-but-not-working-reactjs"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 69884898,
      "title": "How to upload a stream to S3 with AWS SDK v3",
      "problem": "I have to transfer a file from and API endpoint to two different bucket.\nThe original upload is made using:\n```\n`curl -X PUT -F \"data=@sample\" \"http://localhost:3000/upload/1/1\"\n`\n```\nThe endpoint where the file is uploaded:\n`const PassThrough = require('stream').PassThrough;\n\nasync function uploadFile (req, res) {\n  try {\n    const firstS3Stream = new PassThrough();\n    const secondS3Stream = new PassThrough();\n    req.pipe(firstS3Stream);\n    req.pipe(secondS3Stream);\n\n    await Promise.all([\n      uploadToFirstS3(firstS3Stream),\n      uploadToSecondS3(secondS3Stream),\n    ]);\n    return res.end();\n  } catch (err) {\n    console.log(err)\n    return res.status(500).send({ error: 'Unexpected error during file upload' });\n  }\n}\n`\nAs you can see, I use two PassThrough streams, in order to duplicate the request stream into two readable streams, as suggested in this SO thread.\nThis piece of code remains unchanged, what is interesting here are the `uploadToFirstS3` and `uploadToSecondS3` functions. In this minimal example both do exactly the same thing with a different configuration, i will expend only one here.\nWhat Works Well:\n`const aws = require('aws-sdk');\n\nconst s3 = new aws.S3({\n  accessKeyId: S3_API_KEY,\n  secretAccessKey: S3_API_SECRET,\n  region: S3_REGION,\n  signatureVersion: 'v4',\n});\n\nconst uploadToFirstS3 = (stream) => (new Promise((resolve, reject) => {\n  const uploadParams = {\n    Bucket: S3_BUCKET_NAME,\n    Key: 'some-key',\n    Body: stream,\n  };\n  s3.upload(uploadParams, (err) => {\n    if (err) reject(err);\n    resolve(true);\n  });\n}));\n`\nThis piece of code (based on the aws-sdk package) works fine. My issue here is that i want it to run with the @aws-sdk/client-s3 package in order to reduce the size of the project.\nWhat doesn't work:\nI first tried to use S3Client.send(PutObjectCommand):\n`const { S3Client, PutObjectCommand } = require('@aws-sdk/client-s3');\n\nconst s3 = new S3Client({\n  credentials: {\n    accessKeyId: S3_API_KEY,\n    secretAccessKey: S3_API_SECRET,\n  },\n  region: S3_REGION,\n  signatureVersion: 'v4',\n});\n\nconst uploadToFirstS3 = (stream) => (new Promise((resolve, reject) => {\n  const uploadParams = {\n    Bucket: S3_BUCKET_NAME,\n    Key:'some-key',\n    Body: stream,\n  };\n  s3.send(new PutObjectCommand(uploadParams), (err) => {\n    if (err) reject(err);\n    resolve(true);\n  });\n}));\n`\nThen I tried S3.putObject(PutObjectCommandInput):\n`const { S3 } = require('@aws-sdk/client-s3');\n\nconst s3 = new S3({\n  credentials: {\n    accessKeyId: S3_API_KEY,\n    secretAccessKey: S3_API_SECRET,\n  },\n  region: S3_REGION,\n  signatureVersion: 'v4',\n});\n\nconst uploadToFirstS3 = (stream) => (new Promise((resolve, reject) => {\n  const uploadParams = {\n    Bucket: S3_BUCKET_NAME,\n    Key:'some-key',\n    Body: stream,\n  };\n  s3.putObject(uploadParams, (err) => {\n    if (err) reject(err);\n    resolve(true);\n  });\n}));\n`\nThe two last examples both give me a 501 - Not Implemented error with the header `Transfer-Encoding`. I checked `req.headers` and there is no `Transfer-Encoding` in it, so I guess the sdk adds in the request to s3 ?\nSince the first example (based on aws-sdk) works fine, I'm sure the error is not due to an empty body in the request as suggested in this SO thread.\nStill, I thought maybe the stream wasn't readable yet when triggering the upload, thus I wrapped the calls to `uploadToFirstS3` and `uploadToSecondS3` with a callback triggered by the `req.on('readable', callback)` event, but nothing changed.\nI would like to process the files in memory without storing it on the disk at any time. Is there a way to achieve it using the @aws-sdk/client-s3 package ?",
      "solution": "In v3 you can use the `Upload` class from `@aws-sdk/lib-storage` to do multipart uploads.  Seems like there might be no mention of this in the docs site for `@aws-sdk/client-s3` unfortunately.\nIt's mentioned in the upgrade guide here: https://github.com/aws/aws-sdk-js-v3/blob/main/UPGRADING.md#s3-multipart-upload\nHere's a corrected version of the example provided in https://github.com/aws/aws-sdk-js-v3/tree/main/lib/lib-storage:\n```\n`  import { Upload } from \"@aws-sdk/lib-storage\";\n  import { S3Client } from \"@aws-sdk/client-s3\";\n\n  const target = { Bucket, Key, Body };\n  try {\n    const parallelUploads3 = new Upload({\n      client: new S3Client({}),\n      tags: [...], // optional tags\n      queueSize: 4, // optional concurrency configuration\n      leavePartsOnError: false, // optional manually handle dropped parts\n      params: target,\n    });\n\n    parallelUploads3.on(\"httpUploadProgress\", (progress) => {\n      console.log(progress);\n    });\n\n    await parallelUploads3.done();\n  } catch (e) {\n    console.log(e);\n  }\n`\n```\nAt the time of writing, the following `Body` types are supported:\n\n`string`\n`Uint8Array`\n`Buffer`\n`Blob` (hence also `File`)\nNode `Readable`\n`ReadableStream`\n\n(according to https://github.com/aws/aws-sdk-js-v3/blob/main/lib/lib-storage/src/chunker.ts)\nHowever if the `Body` object comes from a polyfill or separate realm and thus isn't strictly an `instanceof` one of these values, you will get an error.  You can work around a case like this by cloning the `Uint8Array`/`Buffer` or piping the stream through a `PassThrough`.  For example if you are using `archiver` to upload a `.zip` or `.tar` archive, you can't pass the archiver stream directly because it's a userland `Readable` implementation (at time of writing), so you must do `Body: archive.pipe(new PassThrough())`.",
      "question_score": 44,
      "answer_score": 86,
      "created_at": "2021-11-08T15:14:03",
      "url": "https://stackoverflow.com/questions/69884898/how-to-upload-a-stream-to-s3-with-aws-sdk-v3"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 66459081,
      "title": "Parcel SemVer bug",
      "problem": "So, I've used Parcel multiple times before and I've never had an issue with it.\nThis time it throws some stupid errors about SemVer versioning and I'm literally loosing my mind trying to find a solution which would fix this problem.\nI've started new project: installed npm w/ `npm init` (no additional options), then installed parcel `npm install --save-dev parcel-bundler` and then created my folder structure:\n\n--node_modules \n--index.html \n--index.js\n\nHere is my package.json:\n`{\n  \"name\": \"playground\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"dev\": \"parcel index.html\"\n  },\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"parcel-bundler\": \"^1.12.4\"\n  }\n}\n`\nI've configured default npm script to run parcel: `\"dev\": \"parcel index.html\"` and run it.\nEverything works fine, however when I connect my index.js in index.html via `` it throws big fat error, saying:\n\n`D:\\workingSpace\\playground\\index.js: Invalid Version: undefined\n  at new SemVer (D:\\workingSpace\\playground\\node_modules\\@babel\\preset-env\\node_modules\\semver\\semver.js:314:11)\n  at compare (D:\\workingSpace\\playground\\node_modules\\@babel\\preset-env\\node_modules\\semver\\semver.js:647:10)   \n  at lt (D:\\workingSpace\\playground\\node_modules\\@babel\\preset-env\\node_modules\\semver\\semver.js:688:10)        \n  at D:\\workingSpace\\playground\\node_modules\\@babel\\preset-env\\lib\\index.js:276:22\n  at Object.default (D:\\workingSpace\\playground\\node_modules\\@babel\\helper-plugin-utils\\lib\\index.js:22:12)     \n  at getEnvPlugins (D:\\workingSpace\\playground\\node_modules\\parcel-bundler\\src\\transforms\\babel\\env.js:62:34)   \n  at getEnvConfig (D:\\workingSpace\\playground\\node_modules\\parcel-bundler\\src\\transforms\\babel\\env.js:12:25)    \n  at async getBabelConfig (D:\\workingSpace\\playground\\node_modules\\parcel-bundler\\src\\transforms\\babel\\config.js:32:19)\n  at async babelTransform (D:\\workingSpace\\playground\\node_modules\\parcel-bundler\\src\\transforms\\babel\\transform.js:6:16)\n  at async JSAsset.pretransform (D:\\workingSpace\\playground\\node_modules\\parcel-bundler\\src\\assets\\JSAsset.js:83:5)\n`\n\nCurrently I'm using Node v14.6.0 and accordingly it's npm version - 6.14.11\nI've never faced this bug before, please help T_T",
      "solution": "This is a known problem in the newest version of Parcel.\nThe solution of this problem was to revert back to version `1.12.3`, or by updating to the version 2 of Parcel. You can do the first solution by:\n`npm uninstall parcel-bundler\nnpm i --save-dev parcel-bundler@1.12.3\n`\nThe second solution could be done like this:\n`npm i --save-dev parcel@next\n`\nYou might have to refactor your code a bit to prevent breaking changes if you decided to use the nightly version of Parcel. Check more about how to migrate to Parcel v2 / nightly here.\nCatch up with that issue here.\n\nUpdate #1: 28/05/2021\nIt seems that Parcel team has been working on a fix, as of the time of writing (28/05/2021). While I have not personally checked if the update has worked properly or not, this answer is still very much a viable and feasible solution.",
      "question_score": 42,
      "answer_score": 83,
      "created_at": "2021-03-03T15:31:21",
      "url": "https://stackoverflow.com/questions/66459081/parcel-semver-bug"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 67746885,
      "title": "@prisma/client did not initialize yet. Please run &quot;prisma generate&quot; and try to import it again",
      "problem": "I am using prisma, postgres, docker, kubernets.\nnpx prisma migrate dev working.\nand npx prisma generate produce below output:\n```\n`\u2714 Generated Prisma Client (2.23.0) to ./node_modules/@prisma/client in 68ms\nYou can now start using Prisma Client in your code. Reference: https://pris.ly/d/client\n\nimport { PrismaClient } from '@prisma/client'\nconst prisma = new PrismaClient()\n`\n```\nbut when I tried to use in my route file produce the error:\nnew-route.ts\n```\n`import { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n`\n```\nmy docker file:\n```\n`FROM node:alpine\n\nWORKDIR /app\nCOPY package.json .\nRUN npm install --only=prod\nCOPY . .\n\nCMD [\"npm\", \"start\"]\n`\n```",
      "solution": "I usually don't use docker for this while developing, but I have this issue every time I change something in my `schema.prisma` and have to use `npx prisma generate`. The solution for me is to restart the node application running `npm start` again. Maybe if you restart your containers it might work.\nif you are inside kubernets pod then access the pod using terminal then give generate command\n```\n`kubectl exec -it pod_name sh\nnpx prisma generate\n`\n```",
      "question_score": 41,
      "answer_score": 14,
      "created_at": "2021-05-29T03:03:26",
      "url": "https://stackoverflow.com/questions/67746885/prisma-client-did-not-initialize-yet-please-run-prisma-generate-and-try-to-i"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 69427025,
      "title": "Programmatic Webpack &amp; Jest (ESM): can&#39;t resolve module without &#39;.js&#39; file extension",
      "problem": "I'm using webpack programmatically, with typescript, ESM, and jest. In a jest test I'm getting errors for not including a `.js` file extension when importing ES modules. For example:\n```\n`    Module not found: Error: Can't resolve 'modulename' in '/path/components'\n    Did you mean 'modulename.js'?\n    BREAKING CHANGE: The request 'modulename' failed to resolve only because it was resolved as fully specified\n    (probably because the origin is strict EcmaScript Module, e. g. a module with javascript mimetype, a '*.mjs' file, or a '*.js' file where the package.json contains '\"type\": \"module\"').\n    The extension in the request is mandatory for it to be fully specified.\n    Add the extension to the request.\n`\n```\nThe module in question does indeed have `\"type\": \"module\"` set in its `package.json`. I have tried adding `.js` to the import, and it doesn't help.\nI'm invoking jest with:\n```\n`node --experimental-vm-modules --experimental-specifier-resolution=node node_modules/jest/bin/jest.js\n`\n```\nas is recommended in the docs (everything else works except webpack). Note that I have tried with and without `--experimental-specifier-resolution=node` (this has helped in other similar circumstances).\nAny thoughts on how to get webpack to work? Thanks in advance!\nNote: everything was working until it was all converted to ESM! Now only programmatic webpack isn't working.\nWebpack config:\n```\n`  {\n    entry,\n    target: 'web',\n    output: {\n      path: outputDir,\n      filename: '[name].js',\n    },\n    mode: process.env.NODE_ENV as 'development' | 'production' | 'none' | undefined,\n    resolve: {\n      extensions: [\n        '.ts',\n        '.tsx',\n        '.js',\n        '.jsx',\n        '.ttf',\n        '.eot',\n        '.otf',\n        '.svg',\n        '.png',\n        '.woff',\n        '.woff2',\n        '.css',\n        '.scss',\n        '.sass',\n      ],\n    },\n    module: {\n      rules: [\n        {\n          test: /\\.(ttf|eot|otf|svg|png)$/,\n          loader: 'file-loader',\n        },\n        {\n          test: /\\.(woff|woff2)$/,\n          loader: 'url-loader',\n        },\n        {\n          test: /\\.(js|jsx|ts|tsx)$/,\n          exclude: /node_modules/,\n          loader: 'babel-loader',\n          options: {\n            sourceType: 'unambiguous',\n            presets: [\n              [\n                '@babel/preset-env',\n                {\n                  corejs: '3.0.0,',\n                  useBuiltIns: 'usage',\n                },\n              ],\n              '@babel/preset-react',\n              '@babel/preset-typescript',\n            ],\n            plugins: [\n              'css-modules-transform',\n              [\n                'babel-plugin-react-scoped-css',\n                {\n                  include: '.scoped.(sa|sc|c)ss$',\n                },\n              ],\n              '@babel/plugin-proposal-class-properties',\n            ],\n          },\n        },\n        {\n          test: /\\.(sc|c|sa)ss$/,\n          use: [\n            'style-loader',\n            'css-loader',\n            'scoped-css-loader',\n            'sass-loader',\n          ],\n        },\n      ],\n    },\n  }\n`\n```",
      "solution": "Ok so I found the solution here.\nBasically, had to add 2 things to the webpack config under `module.rules`:\n```\n`{\n  test: /\\.m?js/,\n  type: \"javascript/auto\",\n},\n{\n  test: /\\.m?js/,\n  resolve: {\n    fullySpecified: false,\n  },\n},\n`\n```",
      "question_score": 41,
      "answer_score": 70,
      "created_at": "2021-10-03T18:57:35",
      "url": "https://stackoverflow.com/questions/69427025/programmatic-webpack-jest-esm-cant-resolve-module-without-js-file-exten"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 78790943,
      "title": "In TypeScript 5.6+, `Buffer` is not assignable to `ArrayBufferView` or `Uint8Array | DataView`",
      "problem": "Trying to upgrade to TypeScript 5.6 Beta, I get the following error messages in `node_modules`. I didn't make any other change, so what should I do to fix these errors?\n```\n`node_modules/@types/node/buffer.d.ts:632:19 - error TS2430: Interface 'Buffer' incorrectly extends interface 'Uint8Array'.\n  The types returned by 'reverse()' are incompatible between these types.\n    Type 'this' is not assignable to type 'Uint8Array'.\n      Type 'Buffer' is not assignable to type 'Uint8Array'.\n        The types returned by 'slice(...).entries()' are incompatible between these types.\n          Type 'IterableIterator' is missing the following properties from type 'BuiltinIterator': map, filter, take, drop, and 8 more.\n\n632         interface Buffer extends Uint8Array {\n                      ~~~~~~\n`\n```\n```\n`node_modules/@types/node/fs/promises.d.ts:56:66 - error TS2344: Type 'Buffer' does not satisfy the constraint 'ArrayBufferView'.\n  Type 'Buffer' is not assignable to type 'Uint8Array | DataView'.\n    Type 'Buffer' is not assignable to type 'Uint8Array'.\n      The types returned by 'entries()' are incompatible between these types.\n        Type 'IterableIterator' is missing the following properties from type 'BuiltinIterator': map, filter, take, drop, and 8 more.\n\n56     interface FileReadOptions {\n                                                                    ~~~~~~\n`\n```\n```\n`node_modules/@types/node/fs/promises.d.ts:238:49 - error TS2344: Type 'Buffer' does not satisfy the constraint 'ArrayBufferView'.\n  Type 'Buffer' is not assignable to type 'Uint8Array | DataView'.\n    Type 'Buffer' is not assignable to type 'Uint8Array'.\n      The types returned by 'entries()' are incompatible between these types.\n        Type 'IterableIterator' is missing the following properties from type 'BuiltinIterator': map, filter, take, drop, and 8 more.\n\n238         read(options?: FileReadOptions): Promise>;\n                                                    ~~~~~~\n`\n```\nNote: when I used a newer version of TypeScript 5.6, mentions of `BuiltinIterator` seem replaced with `ArrayIterator`.",
      "solution": "Short Answer\nYou need a new version of the Node.js types.\n```\n`npm update @types/node --save-dev\n\n# or if you need a specific version\nnpm install -D @types/node@16\nnpm install -D @types/node@18\nnpm install -D @types/node@20\nnpm install -D @types/node@22\n`\n```\nLong Answer\nFirst, `IterableIterator` describes a type that is both `Iterable` (it can create an `Iterator` by calling `someValue[Symbol.iterator()]`), and is itself an `Iterator` (you can call things like `next()` on it over and over until it's out of values).\n`Iterable`s (and `IterableIterator`s) are nice because they can be used in all sorts of places in JavaScript - but a lot of people found themselves missing methods on `Array`s like `map`, `filter`, etc. So a recent proposal was brought forward in JavaScript/ECMAScript to bring many useful methods from `Array` (plus a few more). You can adapt any existing `Iterable`s into this new type with `Iterable.from`:\n```\n`Iterator.from(...).filter(someFunction);\n`\n```\nNow whenever a built-in method, or a generator, produces one of these `IterableIterator`s, it is backed by the methods on `Iterator.prototype`, and you can call something like `map`, `filter`, etc.\n```\n`new Uint8Array(100).entries().map(x => x)\n`\n```\nNotice though that we're talking about a new runtime value called `Iterator`. You can reference `Iterator` and `Iterator.prototype` as actual values in JavaScript. This is a bit awkward since TypeScript defines its own thing called `Iterator` that exists purely for type-checking. So due to this unfortunate name clash, TypeScript needs to introduce a separate type to describe these built-in iterable iterators.\nTypeScript 5.6 introduces a new type called `IteratorObject` (and a few subtypes like `ArrayIterator`). Lots of built-in collections and methods produce this type, so many methods had to be updated to produce it.\nSo how does this cause problems in Node.js? Well in `@types/node`, `Buffer` is basically a subtype of `Uint8Array`. `Buffer` unnecessarily redeclared the `entries()` method in a way that copied the old signature:\n`    /**\n     * Returns an array of key, value pairs for every entry in the array\n     */\n    entries(): IterableIterator;\n}\n`\nHowever, in TypeScript 5.6, `Uint8Array` has been updated to use a signature like:\n`    entries(): ArrayIterator;\n}\n`\nThis caused the two to diverge in slightly incompatible ways.\nSo recently, `@types/node` has been updated to avoid the issue entirely.",
      "question_score": 41,
      "answer_score": 67,
      "created_at": "2024-07-25T01:26:24",
      "url": "https://stackoverflow.com/questions/78790943/in-typescript-5-6-buffer-is-not-assignable-to-arraybufferview-or-uint8arr"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 74705475,
      "title": "AWS ECS exec /usr/local/bin/docker-entrypoint.sh: exec format error",
      "problem": "I am pretty new to this Docker world and I am trying to deploy an image (nodejs-typescript service) from aws ECR to aws ECS but when I create the service inside the cluster this error appears and the taks never gets running:\n`exec /usr/local/bin/docker-entrypoint.sh: exec format error\n`\nMy Dockerfile looks like this:\n```\n`FROM node:lts-alpine\n\nWORKDIR /usr/app\n\nCOPY package*.json ./\nCOPY tsconfig*.json ./\n\nRUN yarn install --quiet\n\nRUN yarn global add pm2\n\nCOPY . .\n\nRUN yarn build\n\nCMD [\"pm2-runtime\", \"build/src/localServer.js\"]\n`\n```\nIt is working fine on my pc when I build the image and run it:\n`(base) MacBook-Pro api % docker run -it -p 3000:3000 api-dev                                    \n2022-12-06T15:35:27: PM2 log: Launching in no daemon mode\n2022-12-06T15:35:27: PM2 log: App [localServer:0] starting in -fork mode-\n2022-12-06T15:35:27: PM2 log: App [localServer:0] online\nConnected to my_mongo_db_cluster\n\ud83d\ude80  Server ready at: http://localhost:3000/\n`\nThe task definition is running on Linux/X86_64.\nAny suggestions or tips to find out what is the problem? Thanks!\nEDIT: when I add an ENTRYPOINT to my Dockerfile like this\n```\n`# same steps\n\nCOPY . .\n\nRUN yarn build\n\nENTRYPOINT [\"pm2-runtime\", \"build/src/localServer.js\"]\n`\n```\nit throw this error `exec /usr/local/bin/pm2-runtime: exec format error`. The same happens when I change `pm2-runtime` to `node`\n```\n`# same steps\n\nCOPY . .\n\nRUN yarn build\n\nENTRYPOINT [\"node\", \"build/src/localServer.js\"]\n`\n```\nHope it helps.",
      "solution": "I found out what was the problem. It was my Apple M1 chip doing its incompatibility magic. For those who has the same problem, just adding the platform `--platform=linux/amd64` in your Dockerfile seems to solve the problem:\n```\n`FROM --platform=linux/amd64 node:lts-alpine\n\n# more instructions...\n`\n```",
      "question_score": 40,
      "answer_score": 112,
      "created_at": "2022-12-06T16:57:07",
      "url": "https://stackoverflow.com/questions/74705475/aws-ecs-exec-usr-local-bin-docker-entrypoint-sh-exec-format-error"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 68630229,
      "title": "Stripe Checkout example running into CORS error from localhost",
      "problem": "I am trying to integrate Stripe Checkout using the instructions given here https://stripe.com/docs/payments/accept-a-payment?integration=checkout for node.\nI have followed their instructions to a tee and have updated the API key in the example with an actual (test) one from my account.\nI am using React in the frontend and express in the backend. I have enabled cors.\nThe request from React to the backend succeeds and a preflight request is kicked off to stripe. The preflight response from stripe is a 403 and the actual request is blocked with a CORS error - `PreflightMissingAllowOriginHeader`\nBackend Code (minimal)\n```\n`const express = require(\"express\");\nconst app = express();\nconst cors = require(\"cors\");\n\nconst stripe = require(\"stripe\")(\n  process.env.STRIPE_SECRET_KEY\n);\n\napp.use(\n  cors({\n    origin: [\"http://localhost:8000\", \"https://checkout.stripe.com\"],\n  })\n);\n\napp.post(\"/create-checkout-session\", async (req, res) => {\n  console.log('getting here 1')\n  const session = await stripe.checkout.sessions.create({\n    payment_method_types: [\"card\"],\n    line_items: [\n      {\n        price_data: {\n          currency: \"usd\",\n          product_data: {\n            name: \"T-shirt\",\n          },\n          unit_amount: 2000,\n        },\n        quantity: 1,\n      },\n    ],\n    mode: \"payment\",\n    success_url: \"http://localhost:4242/success.html\",\n    cancel_url: \"http://localhost:4242/cancel.html\",\n  });\n  \n  console.log('getting here 2')\n  res.redirect(303, session.url);\n});\n\napp.listen(4242, () => console.log(`Listening on port ${4242}!`));\n`\n```\nFrontend Code\n```\n`  handleClick = () => {\n    const res = fetch(`${process.env.BACKEND_API_URL}/create-checkout-session`, {\n      method: 'POST',\n      headers: {\n        \"Content-Type\": 'text/html'\n      }\n    })\n  }\n`\n```",
      "solution": "Here are some of the things I learned while trying to debug this.\n\nStripe checkout uses AWS Cloudfront and it does not allow options requests (as per Stripe's config)\nOPTIONS request are not sent to Stripe when I change the request type in the frontend to `text/plain`. (Yes, that's right, after my server returns the 303 with Stripe's url, Chrome does not send an OPTIONS request to Stripe)\nBest to avoid redirects when using React\n\nHere is the updated backend and frontend code, respectively, that solved the problem\n```\n`app.post(\"/create-checkout-session\", async (req, res) => {\n  const session = await stripe.checkout.sessions.create({\n    payment_method_types: [\"card\"],\n    line_items: [\n      {\n        price_data: {\n          currency: \"usd\",\n          product_data: {\n            name: \"T-shirt\",\n          },\n          unit_amount: 2000,\n        },\n        quantity: 1,\n      },\n    ],\n    mode: \"payment\",\n    success_url: \"http://localhost:8000/success\",\n    cancel_url: \"http://localhost:8000/cancel\",\n  });\n\n  res.json({url: session.url}) //  {\n    const res = await fetch(`${process.env.BACKEND_API_URL}/create-checkout-session`, {\n      method: 'POST',\n      headers: {\n        \"Content-Type\": 'application/json'\n      }\n    })\n    const body = await res.json()\n    window.location.href = body.url\n  }\n\n`\n```",
      "question_score": 40,
      "answer_score": 71,
      "created_at": "2021-08-03T06:03:28",
      "url": "https://stackoverflow.com/questions/68630229/stripe-checkout-example-running-into-cors-error-from-localhost"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 71385330,
      "title": "next-auth JWEDecryptionFailed",
      "problem": "I am using this code to be able to use the credentials next-auth provider along with cognito as oauth serviice: this to allow email and password auth. I am running next-auth@4.2.1:\n```\n`import CognitoProvider from \"next-auth/providers/cognito\";\nimport NextAuth from 'next-auth'\nimport CredentialsProvider from \"next-auth/providers/credentials\"\nimport * as cognito from '../../../lib/cognito'\nimport { Auth } from 'aws-amplify';\n\nexport default NextAuth({\n    providers: [\n        CredentialsProvider({\n            credentials: {\n              username: { label: \"Username\", type: \"text\", placeholder: \"jsmith\" },\n              password: {  label: \"Password\", type: \"password\" }\n            },\n            async authorize(credentials, req) {\n                try {\n                    const user = await Auth.signIn(credentials.username, credentials.password);\n                    return user\n                } catch (error) {\n                    console.log('error signing in', error);\n                }\n            }\n          })\n    ],\n    debug: process.env.NODE_ENV === 'development' ? true : falsey\n\n})\n`\n```\nI often get this error:\n```\n`https://next-auth.js.org/errors#jwt_session_error decryption operation failed {\n  message: 'decryption operation failed',\n  stack: 'JWEDecryptionFailed: decryption operation failed\\n' +\n    '    at gcmDecrypt (/home/aurel/Documents/repos/front/node_modules/jose/dist/node/cjs/runtime/decrypt.js:67:15)\\n' +\n    '    at decrypt (/home/aurel/Documents/repos/front/node_modules/jose/dist/node/cjs/runtime/decrypt.js:92:20)\\n' +\n    '    at flattenedDecrypt (/home/aurel/Documents/repos/front/node_modules/jose/dist/node/cjs/jwe/flattened/decrypt.js:119:52)\\n' +\n    '    at async compactDecrypt (/home/aurel/Documents/repos/front/node_modules/jose/dist/node/cjs/jwe/compact/decrypt.js:18:23)\\n' +\n    '    at async jwtDecrypt (/home/aurel/Documents/repos/front/node_modules/jose/dist/node/cjs/jwt/decrypt.js:8:23)\\n' +\n    '    at async Object.decode (/home/aurel/Documents/repos/front/node_modules/next-auth/jwt/index.js:64:7)\\n' +\n    '    at async Object.session (/home/aurel/Documents/repos/front/node_modules/next-auth/core/routes/session.js:41:28)\\n' +\n    '    at async NextAuthHandler (/home/aurel/Documents/repos/front/node_modules/next-auth/core/index.js:96:27)\\n' +\n    '    at async NextAuthNextHandler (/home/aurel/Documents/repos/front/node_modules/next-auth/next/index.js:21:19)\\n' +\n    '    at async /home/aurel/Documents/repos/front/node_modules/next-auth/next/index.js:57:32',\n  name: 'JWEDecryptionFailed'\n}\n`\n```\nfound https://next-auth.js.org/errors#jwt_session_error in the docs but does not really help\nthanks",
      "solution": "just had to add a secret to make it work\n```\n`export default NextAuth({\n    secret: process.env.AUTH_SECRET,\n    providers: [\n    ...\n    ]\n})\n`\n```",
      "question_score": 39,
      "answer_score": 74,
      "created_at": "2022-03-07T18:55:06",
      "url": "https://stackoverflow.com/questions/71385330/next-auth-jwedecryptionfailed"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 68731242,
      "title": "How do you load environment variables from .env and .env.local with dotenv?",
      "problem": "This might look like a newbie question, but I am unable to find the way to load environment variables from both .env and .env.local files in node with dotenv.\nIs it even possible? How do people load environment variables from both files nowadays if not with dotenv?",
      "solution": "Quoting from dotenv's npm page\n\nShould I have multiple .env files?\nNo. We strongly recommend against having a \"main\" .env file and an\n\"environment\" .env file like .env.test. Your config should vary\nbetween deploys, and you should not be sharing values between\nenvironments.'\n\nBut to use .env.local or .env.test or any other environment.. one at a time is\n```\n`require('dotenv').config({ path: `.env.${process.env.NODE_ENV}` })\n`\n```\nIf you still want to do it refer to dotenv-flow at\nhttps://www.npmjs.com/package/dotenv-flow\ndotenv-flow comes with the feature of overwriting variables at environments.\n\nEdit - 2024 March\nMy above answer might be obsolete now since the package dotenv supports multiple env files for multiple envs via dotenvx - another package from the same creator that claims to be a better dotenv than dotenv.\nhttps://github.com/dotenvx/dotenvx",
      "question_score": 39,
      "answer_score": 41,
      "created_at": "2021-08-10T19:33:42",
      "url": "https://stackoverflow.com/questions/68731242/how-do-you-load-environment-variables-from-env-and-env-local-with-dotenv"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 73790956,
      "title": "Cross-site POST form submissions are forbidden",
      "problem": "My sveltekit app has a form which sends a POST request to server. The app is working fine on dev server but when I build and run the app it fails to send the form data via POST request. It shows the following error in the browser:\n\nCross-site POST form submissions are forbidden",
      "solution": "You have to set the the ORIGIN env var like this\n`ORIGIN=http://localhost:3000 node build/index.js`\nhttps://github.com/sveltejs/kit/tree/master/packages/adapter-node#origin-protocol_header-and-host_header",
      "question_score": 39,
      "answer_score": 39,
      "created_at": "2022-09-20T20:07:03",
      "url": "https://stackoverflow.com/questions/73790956/cross-site-post-form-submissions-are-forbidden"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 69878173,
      "title": "SCRAM-SERVER-FIRST-MESSAGE: client password must be a string",
      "problem": "Ive read documentation from several pages on SO of this issue, but i havent been able to fix my issue with this particular error.\n```\n`    throw new Error('SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string')\n    ^\n\nError: SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string\n    at Object.continueSession (C:\\Users\\CNFis\\Desktop\\WulfDevelopments\\ThePantry\\node_modules\\pg\\lib\\sasl.js:24:11)\n    at Client._handleAuthSASLContinue (C:\\Users\\CNFis\\Desktop\\WulfDevelopments\\ThePantry\\node_modules\\pg\\lib\\client.js:257:10)\n    at Connection.emit (events.js:400:28)\n    at C:\\Users\\CNFis\\Desktop\\WulfDevelopments\\ThePantry\\node_modules\\pg\\lib\\connection.js:114:12\n    at Parser.parse (C:\\Users\\CNFis\\Desktop\\WulfDevelopments\\ThePantry\\node_modules\\pg-protocol\\dist\\parser.js:40:17)\n    at Socket. (C:\\Users\\CNFis\\Desktop\\WulfDevelopments\\ThePantry\\node_modules\\pg-protocol\\dist\\index.js:11:42)\n    at Socket.emit (events.js:400:28)\n    at addChunk (internal/streams/readable.js:290:12)\n    at readableAddChunk (internal/streams/readable.js:265:9)\n    at Socket.Readable.push (internal/streams/readable.js:204:10)\n`\n```\nits as if in my `connectDB()` function its not recognizing the password to the database. I am trying to run a `seeder.js` script to seed the database with useful information for testing purposes, and if i run `npm run server` which is a script that just starts a nodemon server, itll connect to the DB just fine. but when i try to run my script to seed data, i am returning this error.\n\r\n\r\n`import { Sequelize } from \"sequelize\";\nimport colors from \"colors\";\nimport dotenv from \"dotenv\";\n\ndotenv.config();\n\nconst user = \"postgres\";\nconst host = \"localhost\";\nconst database = \"thePantry\";\nconst port = \"5432\";\n\nconst connectDB = async () => {\n  const sequelize = new Sequelize(database, user, process.env.DBPASS, {\n    host,\n    port,\n    dialect: \"postgres\",\n    logging: false,\n  });\n  try {\n    await sequelize.authenticate();\n    console.log(\"Connection has been established successfully.\".bgGreen.black);\n  } catch (error) {\n    console.error(\"Unable to connect to the database:\".bgRed.black, error);\n  }\n};\n\nexport default connectDB;`\r\n\r\n\r\n\nabove is my connectDB() file, and again, it works when i run the server normally. but i receive this error only when trying to seed the database. Ill post my seeder script below:\n\r\n\r\n`import dotenv from \"dotenv\";\nimport colors from \"colors\";\nimport users from \"./data/users.js\";\n\nimport User from \"./models/userModel.js\";\n\nimport connectDB from \"./config/db.js\";\n\ndotenv.config();\nconsole.log(process.env.DBPASS);\n\nconnectDB();\n\nconst importData = async () => {\n  try {\n    await User.drop();\n    await User.sync();\n\n    await User.bulkCreate(users);\n\n    console.log(\"Data Imported\".green.inverse);\n    process.exit();\n  } catch (e) {\n    console.error(`${e}`.red.inverse);\n    process.exit(1);\n  }\n};\n\nconst destroyData = async () => {\n  try {\n    await User.bulkDestroy();\n\n    console.log(\"Data Destroyed\".red.inverse);\n    process.exit();\n  } catch (e) {\n    console.error(`${e}`.red.inverse);\n    process.exit(1);\n  }\n};\n\nif (process.argv[2] === \"-d\") {\n  destroyData();\n} else {\n  importData();\n}`",
      "solution": "So, i may have figured this out by playing around in another project with sequelize, as it turns out, the initial connection to the database in my `server.js` file, honestly means nothing. Unlike `Mongoose` where the connection is available across the whole app. its not the same for `Sequelize` this connection that it creates is only apparent in certain places, for example i was trying the same process in my other project as i am here, except i was trying to read data from my DB using the `model` that i built with `sequelize` and i was receiving the same type error, i went into where i defined the model and made a `sequelize` connection there, and i was then able to read from the database using that object model.\nLong story short, to fix the error in this app i have to place a connection to the database in the `seeder.js` file or i have to place a connection in the `User` model (this is ideal since ill be using the model in various places) to be able to seed information or read information from the database.",
      "question_score": 39,
      "answer_score": 8,
      "created_at": "2021-11-08T03:43:48",
      "url": "https://stackoverflow.com/questions/69878173/scram-server-first-message-client-password-must-be-a-string"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 66088443,
      "title": "Install Angular Unsupported Engine, OSX",
      "problem": "I am reinstalling my MacBook. And I receive the following message when I install (`npm install -g @angular/cli`) angular. Any idea why? I suspect the nom version but I comes along with node...\n```\n`Developments npm install -g @angular/cli\nnpm WARN EBADENGINE Unsupported engine {\nnpm WARN EBADENGINE   package: '@angular/cli@11.1.4',\nnpm WARN EBADENGINE   required: { node: '>= 10.13.0', npm: '^6.11.0', yarn: '>= 1.13.0' },\nnpm WARN EBADENGINE   current: { node: 'v15.8.0', npm: '7.5.2' }\nnpm WARN EBADENGINE }\nnpm WARN EBADENGINE Unsupported engine {\nnpm WARN EBADENGINE   package: '@angular-devkit/architect@0.1101.4',\nnpm WARN EBADENGINE   required: { node: '>= 10.13.0', npm: '^6.11.0', yarn: '>= 1.13.0' },\nnpm WARN EBADENGINE   current: { node: 'v15.8.0', npm: '7.5.2' }\nnpm WARN EBADENGINE }\nnpm WARN EBADENGINE Unsupported engine {\nnpm WARN EBADENGINE   package: '@angular-devkit/core@11.1.4',\nnpm WARN EBADENGINE   required: { node: '>= 10.13.0', npm: '^6.11.0', yarn: '>= 1.13.0' },\nnpm WARN EBADENGINE   current: { node: 'v15.8.0', npm: '7.5.2' }\nnpm WARN EBADENGINE }\nnpm WARN EBADENGINE Unsupported engine {\nnpm WARN EBADENGINE   package: '@angular-devkit/schematics@11.1.4',\nnpm WARN EBADENGINE   required: { node: '>= 10.13.0', npm: '^6.11.0', yarn: '>= 1.13.0' },\nnpm WARN EBADENGINE   current: { node: 'v15.8.0', npm: '7.5.2' }\nnpm WARN EBADENGINE }\nnpm WARN EBADENGINE Unsupported engine {\nnpm WARN EBADENGINE   package: '@schematics/angular@11.1.4',\nnpm WARN EBADENGINE   required: { node: '>= 10.13.0', npm: '^6.11.0', yarn: '>= 1.13.0' },\nnpm WARN EBADENGINE   current: { node: 'v15.8.0', npm: '7.5.2' }\nnpm WARN EBADENGINE }\nnpm WARN EBADENGINE Unsupported engine {\nnpm WARN EBADENGINE   package: '@schematics/update@0.1101.4',\nnpm WARN EBADENGINE   required: { node: '>= 10.13.0', npm: '^6.11.0', yarn: '>= 1.13.0' },\nnpm WARN EBADENGINE   current: { node: 'v15.8.0', npm: '7.5.2' }\nnpm WARN EBADENGINE }\nnpm WARN deprecated har-validator@5.1.5: this library is no longer supported\nnpm WARN deprecated request@2.88.2: request has been deprecated, see https://github.com/request/request/issues/3142\n\n    added 241 packages, and audited 242 packages in 12s\n    \n    20 packages are looking for funding\n      run `npm fund` for details\n    \n    found 0 vulnerabilities\n`\n```",
      "solution": "Update - 25th Feb 2021\nnpm `7.5.6` or greater now works with `angular-cli` versions `9.1.15`, `10.2.3`, `11.2.2`, `12.0.0-next.2` or greater (within each major version) as per  this comment from the Angular team\nOriginal Message - 7th Feb 2021\nAs of writing npm 7 is not fully supported by `angular-cli` as per this GitHub issue\nI also get the same warnings on Windows with `current: { node: 'v15.4.0', npm: '7.5.2' }`\nAngular CLI returns a warning when I run `ng new` with npm 7 and offers a workaround\n```\n`npm version 7.5.2 detected.\nThe Angular CLI currently requires npm version 6.\n\nPlease install a compatible version to proceed (`npm install --global npm@6`).\n`\n```\nnpm 7 was made generally available very recently on 2nd Feb 2021\nThis an ongoing issue and the npm team have recently added a comment in response to the Angular team to the aforementioned GitHub issue.",
      "question_score": 39,
      "answer_score": 32,
      "created_at": "2021-02-07T14:22:52",
      "url": "https://stackoverflow.com/questions/66088443/install-angular-unsupported-engine-osx"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 73378375,
      "title": "Error cause property not recognized in TypeScript",
      "problem": "I stumbled upon the possibility to add a cause to the Error constructor in javascript.\nBut when I try to use this feature my app does not start as it does not know this \"new\" constructor arg.\n```\n`> tsc && node dist/index.js\npromo/promo-service/am-promo-request-handler.ts:43:104 - error TS2554: Expected 0-1 arguments, but got 2.        \n43         throw new Error(`Can't read Maxmind GeoLite2 City db from mmdb file '${config.pathMmdbCity}'`, { cause: err});\nFound 1 error in promo/promo-service/am-promo-request-handler.ts:43 \n`\n```\nAll of the following commands stop with the above compile error\n```\n`nodemon\ntsc && node dist/index.js\nts-node index.ts\n`\n```\nI added the following script to my package.json (to be sure to ask the right instance of node and the other tools for its version)\n```\n`\"check\": \"nodemon -v && node -v && tsc -v && ts-node -v && npm -v\"\n`\n```\nIt returns\n```\n`2.0.19\nv16.14.2\nVersion 4.7.4\nv10.9.1\n8.17.0\n`\n```\nThe feature should be available since node version 10.9.0\n```\n`@types/node@18.7.6\n`\n```\nMy tsconfig.json\n```\n`{\n  \"compilerOptions\": {\n    \"target\": \"es2017\",\n    \"module\": \"commonjs\",\n    \"sourceMap\": true,\n    \"outDir\": \"./dist/\",\n    \"removeComments\": true,\n    \"esModuleInterop\": true,\n    \"forceConsistentCasingInFileNames\": true,\n    \"strict\": true,\n    \"skipLibCheck\": true\n  }\n}\n`\n```\nI'm using VSC on Windows.\nAny idea what I need to change/update?",
      "solution": "Short answer: `cause` is only supported in ES2022 and up. You can tell TypeScript to accept it one of two ways via the `compilerOptions` in `tsconfig.json`:\nOption 1: Update your `target` and/or `lib` to `ES2022`\nWorks if you are able to ignore support for older browsers or polyfill them.\n`{\n  \"compilerOptions\": {\n    \"target\": \"es2022\",\n    \"lib\": [\"es2022\"],\n  },\n}\n`\nOption 2: Add just the relevant `es2022.error` support to `lib`\nThis is a better option if you aren't ready to bump your overall target, and instead just want to include specific well-supported features.\n`{\n  \"compilerOptions\": {\n    \"target\": \"es2019\",\n    \"lib\": [\"es2019\", \"es2022.error\"],\n  },\n}\n`\nWant more nitty gritty detail? Refer to @jsejcksn\u2019s very thorough answer.",
      "question_score": 38,
      "answer_score": 49,
      "created_at": "2022-08-16T20:02:55",
      "url": "https://stackoverflow.com/questions/73378375/error-cause-property-not-recognized-in-typescript"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 71803499,
      "title": "Typeorm when trying to run migrations: Missing required argument: dataSource",
      "problem": "I'm trying to run TypeORM migrations with `ormconfig.json` like this\n```\n`{\n  \"name\": \"default\",\n  \"type\": \"postgres\",\n  \"host\": \"ip-is-here\",\n  \"port\": 5432,\n  \"username\": \"name\",\n  \"password\": \"12345\",\n  \"database\": \"db1\",\n  \"synchronize\": false,\n  \"logging\": false,\n  \"entities\": [\"dist/storage/**/*.js\"],\n  \"migrations\": [\"dist/storage/migrations/**/*.js\"],\n  \"cli\": {\n    \"entitiesDir\": \"src/storage\",\n    \"migrationsDir\": \"src/storage/migrations\"\n  }\n}\n`\n```\nvia `yarn typeorm migration:run` \nBut get an error:\n```\n`Missing required argument: dataSource\n`\n```\nWhat I have to do?\nThank you for your advices!",
      "solution": "TypeOrm removed `ormconfig.json` support in version 0.3.0. You should use new syntax - create `ormconfig.ts` and specify options for you database, for example:\n`export const connectionSource = new DataSource({\n    migrationsTableName: 'migrations',\n    type: 'postgres',\n    host: 'localhost',\n    port: 5432,\n    username: 'user',\n    password: 'pass',\n    database: 'somehealthchecker',\n    logging: false,\n    synchronize: false,\n    name: 'default',\n    entities: ['src/**/**.entity{.ts,.js}'],\n    migrations: ['src/migrations/**/*{.ts,.js}'],\n    subscribers: ['src/subscriber/**/*{.ts,.js}'],\n});\n`\nThen, after running the connection:\n`await connectionSource.initialize();\n`\nYou can get entities by:\n`const myRepo = connectionSource.getRepository(SomeEntity)\n`\nAlso your scripts in `package.json` should look like this:\n`\"migration:generate\": \"./node_modules/.bin/ts-node ./node_modules/.bin/typeorm migration:generate -d src/modules/config/ormconfig.ts\",\n\"migration:up\": \"./node_modules/.bin/ts-node ./node_modules/.bin/typeorm migration:run -d src/modules/config/ormconfig.ts\",\n\"migration:down\": \"./node_modules/.bin/ts-node ./node_modules/.bin/typeorm migration:revert -d src/modules/config/ormconfig.ts\",\n`\nAfter the command, just give the name for migration in the console without -n option",
      "question_score": 38,
      "answer_score": 50,
      "created_at": "2022-04-08T23:52:26",
      "url": "https://stackoverflow.com/questions/71803499/typeorm-when-trying-to-run-migrations-missing-required-argument-datasource"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 68490546,
      "title": "How to download a file on Next.js using an API route",
      "problem": "I'm using next.js. I have a 3rd party service I need to retrieve a PDF file from. The service requires an API key that I don't want exposed on the client side.\nHere are my files\n/api/getPDFFile.js\n...\n```\n`  const options = {\n    method: 'GET',\n    encoding: 'binary',\n    headers: {\n      'Subscription-Key': process.env.GUIDE_STAR_CHARITY_CHECK_API_PDF_KEY,\n      'Content-Type': 'application/json',\n    },\n    rejectUnauthorized: false,\n  };\n\n  const binaryStream = await fetch(\n    'https://apidata.guidestar.org/charitycheckpdf/v1/pdf/26-4775012',\n    options\n  );\n  \n  return res.status(200).send({body: { data: binaryStream}}); \n\n`\n```\npages/getPDF.js\n```\n`    {\n  fetch('http://localhost:3000/api/guidestar/charitycheckpdf',\n    {\n      method: 'GET',\n      encoding: 'binary',\n      responseType: 'blob',\n    }).then(response => {\n      if (response.status !== 200) {\n        throw new Error('Sorry, I could not find that file.');\n      }\n      return response.blob();\n    }).then(blob => {\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.style.display = 'none';\n      a.href = url;\n      a.setAttribute('download', 'test.pdf');\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n    })}}>Click to Download\n`\n```\nClicking the button downloads a file, but when I open it I see the error message, \"Failed to load PDF document.\"",
      "solution": "You appear to be using `node-fetch`. So, you can do something like this:\n`// /pages/api/getAPI.js\n\nimport stream from 'stream';\nimport { promisify } from 'util';\nimport fetch from 'node-fetch';\n\nconst pipeline = promisify(stream.pipeline);\nconst url = 'https://w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf';\n\nconst handler = async (req, res) => {\n  const response = await fetch(url); // replace this with your API call & options\n  if (!response.ok) throw new Error(`unexpected response ${response.statusText}`);\n\n  res.setHeader('Content-Type', 'application/pdf');\n  res.setHeader('Content-Disposition', 'attachment; filename=dummy.pdf');\n  await pipeline(response.body, res);\n};\n\nexport default handler;\n`\nThen from client:\n`// /pages/index.js\n\nconst IndexPage = () => Download PDF;\nexport default IndexPage;\n`\nCodeSandbox Link (open the deployed URL in a new tab to see it work)\nReferences:\n\nAPI Routes | Next.js\nStreams | node-fetch\nHow to send a pdf file from Node/Express app to the browser\n``: The Anchor element | MDN\n\nPS: I don't think much error handling is necessary in this case. If you wish to be more informative to your user you can. But this much code will also work just fine. In case of error the file download will fail showing \"Server Error\". Also, I don't see a need to create a `blob` URL first. You can directly download it in your app as the API is on the same origin.\n\nEarlier I had used `request`, also posting it here in case someone needs it:\n`import request from 'request';\nconst url = 'https://w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf';\nexport default (_, res) => { request.get(url).pipe(res); };\n`",
      "question_score": 38,
      "answer_score": 44,
      "created_at": "2021-07-22T21:29:17",
      "url": "https://stackoverflow.com/questions/68490546/how-to-download-a-file-on-next-js-using-an-api-route"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 66434750,
      "title": "npm ERR! git dep preparation failed when trying to install package.json",
      "problem": "I'm trying to install package.json file using the command `npm install`, but I'm getting the following error.\n```\n`npm ERR! git dep preparation failed\nnpm ERR! command C:\\Program Files\\nodejs\\node.exe C:\\Users\\DHRUV\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npm-cli.js install --force --cache=C:\\Users\\DHRUV\\AppData\\Local\\npm-cache --prefer-offline=false --prefer-online=false --offline=false --no-progress --no-save --no-audit\nnpm ERR! npm WARN using --force Recommended protections disabled.\nnpm ERR! npm ERR! code 128\nnpm ERR! npm ERR! command failed\nnpm ERR! npm ERR! command git ls-remote ssh://git@github.com/gulpjs/gulp.git\nnpm ERR! npm ERR! Host key verification failed.\nnpm ERR! npm ERR! fatal: Could not read from remote repository.\nnpm ERR! npm ERR!\nnpm ERR! npm ERR! Please make sure you have the correct access rights\nnpm ERR! npm ERR! and the repository exists.\nnpm ERR!\n`\n```\nI have installed Git and node.\npackage.json:\n`{\n  \"name\": \"LandTransfer\",\n  \"version\": \"0.0.0\",\n  \"scripts\": {\n    \"ng\": \"ng\",\n    \"start\": \"ng serve\",\n    \"build\": \"ng build\",\n    \"test\": \"ng test --watch=false\",\n    \"lint\": \"ng lint\",\n    \"e2e\": \"ng e2e\",\n    \"postinstall\": \"node patch.js\"\n  },\n  \"private\": true,\n  \"dependencies\": {\n    \"@angular/animations\": \"7.1.0\",\n    \"@angular/cdk\": \"^7.1.0\",\n    \"@angular/common\": \"7.1.0\",\n    \"@angular/compiler\": \"7.1.0\",\n    \"@angular/core\": \"7.1.0\",\n    \"@angular/forms\": \"7.1.0\",\n    \"@angular/http\": \"7.1.0\",\n    \"@angular/material\": \"^7.1.0\",\n    \"@angular/platform-browser\": \"7.1.0\",\n    \"@angular/platform-browser-dynamic\": \"7.1.0\",\n    \"@angular/platform-server\": \"7.1.0\",\n    \"@angular/router\": \"7.1.0\",\n    \"bootstrap\": \"^4.3.1\",\n    \"core-js\": \"^2.5.7\",\n    \"ethers\": \"^4.0.20\",\n    \"rxjs\": \"^6.3.3\",\n    \"truffle-contract\": \"^4.0.1\",\n    \"tslib\": \"^1.9.0\",\n    \"typedarray-to-buffer\": \"^3.1.5\",\n    \"web3\": \"1.0.0-beta.37\",\n    \"zone.js\": \"^0.8.26\"\n  },\n  \"devDependencies\": {\n    \"@angular-devkit/build-angular\": \"^0.12.1\",\n    \"@angular-devkit/core\": \"0.8.1\",\n    \"@angular/cli\": \"^7.1.0\",\n    \"@angular/compiler-cli\": \"7.1.0\",\n    \"@angular/language-service\": \"7.1.0\",\n    \"@types/jasmine\": \"^2.8.12\",\n    \"@types/jasminewd2\": \"^2.0.6\",\n    \"@types/node\": \"^6.14.2\",\n    \"codelyzer\": \"^4.4.4\",\n    \"jasmine-core\": \"^2.99.1\",\n    \"jasmine-spec-reporter\": \"^4.2.1\",\n    \"karma\": \"^3.1.1\",\n    \"karma-chrome-launcher\": \"^2.2.0\",\n    \"karma-cli\": \"^1.0.1\",\n    \"karma-coverage-istanbul-reporter\": \"^1.4.3\",\n    \"karma-jasmine\": \"^1.1.2\",\n    \"karma-jasmine-html-reporter\": \"^0.2.2\",\n    \"protractor\": \"^5.4.1\",\n    \"protractor-console-plugin\": \"^0.1.1\",\n    \"ts-node\": \"^3.3.0\",\n    \"tslint\": \"^5.11.0\",\n    \"typescript\": \"3.1.6\",\n    \"webpack\": \"^4.26.1\",\n    \"webpack-dev-server\": \"^3.1.10\"\n  }\n}\n`",
      "solution": "Try this\nStep 1:\n```\n`$ npm cache clean --force\n`\n```\nStep 2:\nDelete `node_modules` by `$ rm -rf node_modules` also delete `package-lock.json`\nStep 3:\nUpdate the `npm` to the latest stable version\n```\n`npm install -g npm@7.6.0\n`\n```\nStep 3:\n```\n`npm install\n`\n```\nTo start again,\n```\n`$ npm start\n`\n```",
      "question_score": 38,
      "answer_score": 38,
      "created_at": "2021-03-02T08:06:13",
      "url": "https://stackoverflow.com/questions/66434750/npm-err-git-dep-preparation-failed-when-trying-to-install-package-json"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 66321327,
      "title": "Npm Install is Failing (Could not resolve dependency)",
      "problem": "When i try to do `npm install` i get the following:\n```\n`npm ERR! code ERESOLVE\nnpm ERR! ERESOLVE unable to resolve dependency tree\nnpm ERR!\nnpm ERR! While resolving: foliosure@1.0.1\nnpm ERR! Found: zone.js@0.8.29\nnpm ERR! node_modules/zone.js\nnpm ERR!   zone.js@\"~0.8.26\" from the root project\nnpm ERR!   peer zone.js@\"~0.8.26\" from @angular/core@7.2.16\nnpm ERR!   node_modules/@angular/core\nnpm ERR!     @angular/core@\"~7.2.0\" from the root project\nnpm ERR!     peer @angular/core@\"^7.0.0 || ^8.0.0 || ^9.0.0 || ^10.0.0 || ^11.0.0\" from primeng_latest@11.2.3\nnpm ERR!     node_modules/primeng_latest\nnpm ERR!       primeng_latest@\"npm:primeng@^11.2.0\" from the root project\nnpm ERR!     3 more (@angular/common, @angular/forms, @angular/platform-browser)\nnpm ERR!\nnpm ERR! Could not resolve dependency:\nnpm ERR! peer zone.js@\"^0.10.2\" from primeng_latest@11.2.3\nnpm ERR! node_modules/primeng_latest\nnpm ERR!   primeng_latest@\"npm:primeng@^11.2.0\" from the root project\nnpm ERR!\nnpm ERR! Fix the upstream dependency conflict, or retry\nnpm ERR! this command with --force, or --legacy-peer-deps\n`\n```\nThis is my `package.json` dependencies file:\n```\n`  \"dependencies\": \n    \"@angular/compiler\": \"~7.2.0\",\n    \"@angular/core\": \"~7.2.0\",\n    \"@angular/forms\": \"~7.2.0\",\n    \"@angular/http\": \"^7.2.4\",\n    \"@angular/material\": \"^7.3.7\",\n    \"@angular/router\": \"~7.2.0\",\n    \"@types/d3\": \"^5.7.2\",\n    \"bootstrap\": \"^4.4.1\",\n    \"codemirror\": \"^5.58.2\",\n    \"file-saver\": \"^2.0.0\",\n    \"font-awesome\": \"^4.7.0\",\n    \"highcharts\": \"^9.0.0\",\n    \"material-design-icons\": \"^3.0.1\",\n    \"moment\": \"^2.24.0\",\n    \"ngx-spinner\": \"^7.2.0\",\n    \"ngx-toastr\": \"^9.2.0\",\n    \"primeicons\": \"^1.0.0\",\n    \"primeng\": \"^7.0.5\",\n    \"primeng_latest\": \"npm:primeng@^11.2.0\",\n    \"rxjs\": \"~6.3.3\",\n    \"zone.js\": \"~0.8.26\"\n`\n```\nI tried downgrading the versions but it still gives the error. I also tried to google the solution but didn't find the right solution, would appreciate any help, Thank you.",
      "solution": "Looks like it's a problem with Peer Dependencies try with npm install `--legacy-peer-deps`.",
      "question_score": 36,
      "answer_score": 109,
      "created_at": "2021-02-22T19:24:52",
      "url": "https://stackoverflow.com/questions/66321327/npm-install-is-failing-could-not-resolve-dependency"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 78876691,
      "title": "&quot;SyntaxError: Unexpected identifier &#39;assert&#39;&quot; on JSON import in Node v22",
      "problem": "A Node program of mine that worked fine in Node v21 now immediately crashes with a syntax error in Node v22. The line that triggers the error looks like this:\n```\n`import config from \"./some-config-file.json\" assert { type: \"json\" };\n`\n```\nand the error says:\n`SyntaxError: Unexpected identifier 'assert'\n    at compileSourceTextModule (node:internal/modules/esm/utils:337:16)\n    at ModuleLoader.moduleStrategy (node:internal/modules/esm/translators:166:18)\n    at callTranslator (node:internal/modules/esm/loader:436:14)\n    at ModuleLoader.moduleProvider (node:internal/modules/esm/loader:442:30)\n    at async ModuleJob._link (node:internal/modules/esm/module_job:106:19)\n`\nWhy am I getting this error in code that previously worked, and how should I fix it?",
      "solution": "This is due to support for \"import assertions\" being removed from Node in favour of \"import attributes\", which are essentially the same thing except you have to use the keyword `with` instead of `assert`:\n```\n`import config from \"./some-config-file.json\" with { type: \"json\" };\n`\n```\n(That trivial explanation of the change might sound like it must be missing something, but at least for now and in the context of Node, it really isn't. The change happened in Node because the underlying ECMAScript spec proposal made the same name and keyword change, on the grounds that some new import attributes - besides `type: \"json\"` - will have behaviours not properly described as \"asserting\" anything. But Node still supports only one import attribute, `type: \"json\"`, which behaves exactly the same as it did with the old `assert` syntax.)\nTo fix the error, you could just adopt the new syntax (i.e. change `assert` to `with`). However, do note that support for the \"import attributes\" syntax (with `with`) was added later than the older \"import assertions\" syntax (with `assert`); the latter has been around since Node 17.1 and 16.14, while the former was only added in Node 18.20. Thus, swapping from `assert` to `with` will fix your program for Node 22 and later at the expense of breaking it for Node 16 and 17.\nIf avoiding breaking compatibility with old Node versions matters to you, consider not using `import` for reading JSON files at all and instead reading and parsing them explicitly:\n```\n`import fs from 'node:fs';\nimport { dirname, join } from 'node:path';\nimport { fileURLToPath } from 'node:url';\n\nconst configPath = join(\n  dirname(fileURLToPath(import.meta.url)),\n  './some-config-file.json'\n);\nconst config = JSON.parse(fs.readFileSync(configPath, 'utf8'));\n`\n```\nThis is, of course, uglier and more complicated, in part because just getting the path to the current ES module in a way compatible with old Node versions is itself annoyingly complicated.\nThe behaviour is also not quite identical to `import`. If you were previously importing the same JSON module from multiple different JavaScript modules in your program, `import` would only read and parse the JSON file once and then cache the module in memory to return on subsequent imports, whereas the incantation I propose above won't do this. This makes my version worse for performance and also more vulnerable to silly behaviours if the content of the JSON file gets modified under your program's feet while it's launching. To fix this, you could always wrap the parsing of the JSON file in a single JavaScript module that all your other modules import the parsed JSON from.\nBut in exchange for accepting the ugliness, verbosity, and slightly worse behaviour than `import`, you get broad compatibility across Node versions, which might be worth it for you!",
      "question_score": 36,
      "answer_score": 98,
      "created_at": "2024-08-15T22:09:39",
      "url": "https://stackoverflow.com/questions/78876691/syntaxerror-unexpected-identifier-assert-on-json-import-in-node-v22"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 71501892,
      "title": "Parsing error: No Babel config file detected",
      "problem": "I'm trying to create a project in vue. But I get this problem after I create a project.\n`Parsing error: No Babel config file detected for C:\\\\HotelManagmet\\clienthotel\\babel.config.js. Either disable config file checking with requireConfigFile: false, or configure Babel so that it can find the config files.`\nI can not solve it, I have tried to reinstall node.js and visual studio code but the problem remains. Have tried running npm audit fix --force but unfortunately the result is the same. Anyone know what it could be?",
      "solution": "I had the same issue and this change fixed the issue.\nIn your `.eslintrc.js` file, add `requireConfigFile: false`\n```\n`parserOptions: {\n  parser: '@babel/eslint-parser',\n  requireConfigFile: false, // <== ADD THIS\n  ecmaVersion: 2018, // Allows for the parsing of modern ECMAScript features\n  sourceType: 'module' // Allows for the use of imports\n}\n`\n```",
      "question_score": 36,
      "answer_score": 63,
      "created_at": "2022-03-16T18:38:35",
      "url": "https://stackoverflow.com/questions/71501892/parsing-error-no-babel-config-file-detected"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 70180990,
      "title": "Getting : npm WARN using --force Recommended protections disabled",
      "problem": "I have an old Nuxt.js package that was developed in Node 12 and I want to use it now with Node 16 (the latest stable) but when I try to install my packages by `npm install` I'm getting the versions difference errors.\nBut I know the packages are up to date. So, I'm trying to force clear my npm cache by `sudo npm cache clean -f` but I'm getting this error:\n\nnpm WARN using --force Recommended protections disabled.\n\nThe environment is `ubuntu 20.04` and this is my `package.json` file:\n`{\n  \"name\": \"frontend\",\n  \"version\": \"1.0.0\",\n  \"private\": true,\n  \"scripts\": {\n    \"dev\": \"nuxt\",\n    \"build\": \"nuxt build\",\n    \"start\": \"nuxt start\",\n    \"generate\": \"nuxt generate\"\n  },\n  \"dependencies\": {\n    \"@nuxtjs/auth\": \"^4.9.1\",\n    \"@nuxtjs/axios\": \"^5.13.6\",\n    \"@nuxtjs/dotenv\": \"^1.4.1\",\n    \"@nuxtjs/google-adsense\": \"^1.4.0\",\n    \"@nuxtjs/gtm\": \"^2.4.0\",\n    \"@nuxtjs/router\": \"^1.6.1\",\n    \"better-vue-input-tag\": \"^1.1.0\",\n    \"bootstrap\": \"^5.1.3\",\n    \"bootstrap-vue\": \"^2.21.2\",\n    \"core-js\": \"^3.19.2\",\n    \"eslint\": \"^8.3.0\",\n    \"jquery\": \"^3.6.0\",\n    \"laravel-vue-pagination\": \"^2.3.1\",\n    \"node-sass\": \"^6.0.1\",\n    \"nuxt\": \"^2.15.8\",\n    \"popper.js\": \"^1.16.1\",\n    \"sass-loader\": \"^12.3.0\",\n    \"vform\": \"^2.1.2\",\n    \"vue-autosuggest\": \"^2.2.0\",\n    \"vue-gtag\": \"^1.16.1\",\n    \"vue-infinite-loading\": \"^2.4.5\",\n    \"vue2-google-maps-withscopedautocomp\": \"^0.12.1\"\n  },\n  \"devDependencies\": {\n    \"eslint-config-prettier\": \"^8.3.0\",\n    \"eslint-plugin-prettier\": \"^4.0.0\",\n    \"ip\": \"^1.1.5\",\n    \"prettier\": \"^2.5.0\"\n  }\n}\n`\nHow can I use the force flag without getting errors?\nEdit:\nThe errors that I'm getting for versions difference:",
      "solution": "So I was having the same problem as you and I thought that the caching didn't work, but in reality it worked it was just a warning message, try this command `npm cache verify` to verify if the caching worked or not and if it worked your problem is not with the caching but the problem is probably with your node version.\n```\n`PS C:\\code>  npm cache clean --force\nnpm WARN using --force Recommended protections disabled.\nPS C:\\code> npm cache verify\nCache verified and compressed (~\\AppData\\Local\\npm-cache\\_cacache)\nContent verified: 0 (0 bytes)\nIndex entries: 0\nFinished in 0.008s\nPS C:\\code>\n`\n```",
      "question_score": 36,
      "answer_score": 82,
      "created_at": "2021-12-01T09:23:09",
      "url": "https://stackoverflow.com/questions/70180990/getting-npm-warn-using-force-recommended-protections-disabled"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 75157299,
      "title": "How can zod date type accept ISO date strings?",
      "problem": "When defining a schema with zod, how do I use a date type?\nIf I use `z.date()` (see below) the date object is serialized to a ISO date string. But then if I try to parse it back with zod, the validator fails because a string is not a date.\n```\n`import { z } from \"zod\"\n\nconst someTypeSchema = z.object({\n    t: z.date(),\n})\ntype SomeType = z.infer\n\nfunction main() {\n    const obj1: SomeType = {\n        t: new Date(),\n    }\n    const stringified = JSON.stringify(obj1)\n    console.log(stringified)\n    const parsed = JSON.parse(stringified)\n    const validated = someTypeSchema.parse(parsed) // <- Throws error! \"Expected date, received string\"\n    console.log(validated.t)\n}\nmain()\n`\n```",
      "solution": "Discovered that I can accept a string for the property, and use `transform` to turn it into a `Date` during parsing\n```\n`import { z } from \"zod\"\n\nconst someTypeSchema = z.object({\n    t: z.string().transform((str) => new Date(str)),\n})\ntype SomeType = z.infer\n\nfunction main() {\n    const obj1: SomeType = {\n        t: new Date(),\n    }\n    const stringified = JSON.stringify(obj1)\n    console.log(stringified) // <-- {\"t\":\"2023-09-07T07:19:51.128Z\"}\n    const parsed = JSON.parse(stringified)\n    const validated = someTypeSchema.parse(parsed)\n    console.log(validated.t instanceof Date) // <-- \"true\"\n}\nmain()\n`\n```",
      "question_score": 36,
      "answer_score": 8,
      "created_at": "2023-01-18T10:47:53",
      "url": "https://stackoverflow.com/questions/75157299/how-can-zod-date-type-accept-iso-date-strings"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 67145332,
      "title": "&quot; Could not send request &quot; error in Postman Web version",
      "problem": "I am using postman web version.\nI sent request using POST on `url = localhost:3000/students`\nBut it is giving error :\n```\n`Could not send request\nCloud Agent Error: Can not send requests to localhost. Select a different agent.\n`\n```\nPlease help what to do :(",
      "solution": "Postman Website cannot send a request to your computer's localhost. It first needs to connect to your PC with the Postman desktop client. You can download it here. Run it, then go to the Postman workspace in your browser -> send the request and it will work.",
      "question_score": 36,
      "answer_score": 60,
      "created_at": "2021-04-18T07:01:47",
      "url": "https://stackoverflow.com/questions/67145332/could-not-send-request-error-in-postman-web-version"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 69006097,
      "title": "Does npx no longer do install-less run?",
      "problem": "From the nodejs.dev site:\n\nnpx allows you to run that npm command without installing it first. If the command isn't found, npx will install it into a central cache:\n\nThey use this as an example:\n```\n`npx cowsay \"Hello\"\n`\n```\nBut when I run that:\n```\n`$ npx cowsay \"Hello\"\n\nNeed to install the following packages:\n  cowsay\nOk to proceed? (y)\n`\n```\nHuh? Is there some preference that I need to set now? I'm used to `npx` running things without installing them, like they say on nodejs.dev. I don't really want to install `cowsay` in my globals.\n```\n`Node v14.17.5\nNPM 7.21.0\nOS:ProductName: Mac OS X\nProductVersion: 10.15.7\n`\n```\nFiled as an issue here: https://github.com/nodejs/nodejs.org/issues/4104\nEdit: just tested this in NPM 6 and it works as expected. This might be a change in NPM post v6.\n```\n`\u2717 npm --version\n6.14.16\n\n\u2717 npx cowsay \"Hello\"\n\nnpx: installed 41 in 7.509s\n _______\n\n...\n`\n```",
      "solution": "This appears to be a change after NPM 6.\n```\n`$ nvm install 18\nDownloading and installing node v18.0.0...\n...\n\n$ nvm use 18  # this was a fresh install \nNow using node v18.0.0 (npm v8.6.0)\n\n$ npx cowsay \"Node 18\"\nNeed to install the following packages:\n  cowsay\nOk to proceed? (y) y\n _________\n\n ---------\n        \\   ^__^\n         \\  (oo)\\_______\n            (__)\\       )\\/\\\n                ||----w |\n                ||     ||\n\n$ nvm use 14\nNow using node v14.19.1 (npm v6.14.16)\n\n$ npm uninstall --global cowsay # in case I already had it installed\nup to date in 0.037s\n\n$ npx cowsay \"Node 14\"  # NOTE: no confirmation \nnpx: installed 41 in 5.271s\n _________\n\n ---------\n        \\   ^__^\n         \\  (oo)\\_______\n            (__)\\       )\\/\\\n                ||----w |\n                ||     ||\n\n`\n```\nNote: no confirmation for the install in Node 14.\nIf you want to use a package without confirming the install in Node 7+ you'll need to add the confirm flag. See @Nitesh's answer.",
      "question_score": 36,
      "answer_score": 4,
      "created_at": "2021-09-01T01:01:46",
      "url": "https://stackoverflow.com/questions/69006097/does-npx-no-longer-do-install-less-run"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 75959563,
      "title": "Node.js ERR_OSSL_EVP_UNSUPPORTED error when running npm run start",
      "problem": "I'm encountering an error when trying to run npm run start on my Node.js project. The error message I'm seeing is:\n\nex.js:59:103 {   opensslErrorStack: ['error:03000086:digital envelope\nroutines::initialization error'],   library: 'digital envelope\nroutines',   reason: 'unsupported',   code: 'ERR_OSSL_EVP_UNSUPPORTED'\n}\nNode.js v19.8.1 ERROR: \"front\" exited with 1.\n\nI've checked that the port is empty and no process is running, but the error persists. Can anyone help me understand what might be causing this error and how to fix it?\nI tried to install nvm and install node 14.17 but still facing the same error.",
      "solution": "Try to run that on your terminal before running starting command:\n`# linux\nexport NODE_OPTIONS=--openssl-legacy-provider\n# windows\nset NODE_OPTIONS=--openssl-legacy-provider\n`",
      "question_score": 35,
      "answer_score": 80,
      "created_at": "2023-04-07T16:57:48",
      "url": "https://stackoverflow.com/questions/75959563/node-js-err-ossl-evp-unsupported-error-when-running-npm-run-start"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 75936720,
      "title": "No preset version installed for command yarn",
      "problem": "I have problem with asdf.\nI have already install nodejs latest.\n```\n`asdf install nodejs latest\n... \nasdf local nodejs latest / asdf global nodejs latest \n`\n```\nBut if I try\n```\n`yarn                                                        \uf017 \nNo preset version installed for command yarn\nPlease install a version by running one of the following:\n\nasdf install nodejs 18.0.0\n\nor add one of the following versions in your config file at /Users/../project-name/.tool-versions\nnodejs 14.17.0\nnodejs 19.0.1\n`\n```\nBut my .tool-version in project structure already contains it:\n```\n`nodejs 18.0.0\nnodejs 19.0.1\n`\n```\n(For my project I need nodejs >= 18)\nI am using apple M1 chip.",
      "solution": "This happens when you have yarn installed under a different version of node, but not the active one. As yarn is a package under the node version, so you need to (re)install yarn with the new active version of node:\n```\n`npm install -g yarn\n`\n```\nThen it should work.",
      "question_score": 35,
      "answer_score": 72,
      "created_at": "2023-04-05T09:29:50",
      "url": "https://stackoverflow.com/questions/75936720/no-preset-version-installed-for-command-yarn"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 74830166,
      "title": "Unable to import ESM module in Nestjs",
      "problem": "I am having a problem with importing ESM modules in my project based on Nest.js. As far as I understand, this problem is relevant not just to Nest.js but typescript as well.\nI have tried various things and combinations of Node.js & typescript versions, adding `\"type\":\"module\"` to `package.json` & changes in the settings of my `tsconfig.json` file, so it has the following view, which is far from default values:\n`{\n  \"compilerOptions\": {\n    \"lib\": [\"ES2020\"],\n    \"esModuleInterop\": true,\n    \"module\": \"NodeNext\",\n    \"declaration\": true,\n    \"removeComments\": true,\n    \"emitDecoratorMetadata\": true,\n    \"experimentalDecorators\": true,\n    \"allowSyntheticDefaultImports\": true,\n    \"moduleResolution\": \"Node\",\n    \"target\": \"esnext\",\n    \"sourceMap\": true,\n    \"outDir\": \"./dist\",\n    \"baseUrl\": \"./\",\n    \"incremental\": true,\n    \"skipLibCheck\": true,\n    \"strictNullChecks\": false,\n    \"noImplicitAny\": false,\n    \"strictBindCallApply\": false,\n    \"forceConsistentCasingInFileNames\": false,\n    \"noFallthroughCasesInSwitch\": false,\n  }\n}\n`\nMy full environment is:\n\nNode.js (19.2.1 LTS) managed via nvm\nTypescript (4.9.4, but I also tried 4.3.5)\n@nestjs/common: 9.2.1\n@nestjs/core: 9.2.1\nts-loader: \"9.4.2\",\nts-node: \"10.9.1\",\ntsconfig-paths: \"4.1.0\",\n\nBut it still gives me an error when I am trying to import any ESM module in any of my services. For example:\n```\n`import random from `random`;\n\nexport class AppService implements OnApplicationBootstrap {\n  async test() {\n     const r = random.int(1, 5);\n     console.log(r);\n  }\n}\n`\n```\nDoes anyone have a clue how to fix it?",
      "solution": "This Problem seems to occur more frequently since more packages are switching over to be distributed as ES module.\nSummary\n\nES Modules can import CommonJS modules\nCommonJS modules cannot import ES Modules synchronously\nNestJS does currently not support to compile to ESM - see this PR\n\nThere are two approaches for this problem.\nImport package asynchronously using the dynamic `import()` function\nThe instruction to use `import()` for ES modules in CommonJS can be found everywhere. But when using typescript the additional hint is missing how to prevent the compiler to transform the `import()` call to a `require()`. I found two options for this:\n\nset `moduleResolution` to `nodenext` or `node16` in your `tsconfig.json` (Variant 1)\nuse the `eval` workaround - this is based on the section \"Solution 2: Workaround using eval\" from answer https://stackoverflow.com/a/70546326/13839825 (Variant 2 & 3)\n\nVariant 1: `await import()` whenever needed\nThis solution is often suggested on the official NestJS Discord\n\nadd `\"moduleResolution\": \"nodenext\"` or `\"moduleResolution\": \"node16\"` to your `tsconfig.json`\nuse an `await import()` call when needed\nsimple and straight forward\npackage is not listed on top with other imports\nyou cannot import/use types from the imported ES module (at least I found no possibility so far)\nonly works in `async` context\n\n`import { Injectable } from '@nestjs/common';\n\n@Injectable()\nexport class AppService {\n  async getHello(): Promise {\n    const random = (await import('random')).default;\n    return 'Hello World! ' + random.int(1, 10);\n  }\n}\n`\nVariant 2: Helper Function\nNote: Importing a type from a ES module will not result in an `require` call, since it's only used by the typescript compiler and not the runtime environment.\n\na bit messy because package is always hidden behind an extra function call\nonly works in `async` context\nyou can import/use types\n\n`import { Injectable } from '@nestjs/common';\nimport { type Random } from 'random';\n\nasync function getRandom(): Promise {\n  const module = await (eval(`import('random')`) as Promise);\n  return module.default;\n}\n\n@Injectable()\nexport class AppService {\n  async getHello(): Promise {\n    return 'Hello World! ' + (await getRandom()).int(1, 10);\n  }\n}\n\n`\nVariant 3: Import and save to local variable\n\nno extra function call needed\nimported module can be undefined at runtime (unlikely but still bad practice)\nyou can import/use types\n\n`import { Injectable } from '@nestjs/common';\nimport { type Random } from 'random';\n\nlet random: Random;\neval(`import('random')`).then((module) => {\n  random = module.default;\n});\n\n@Injectable()\nexport class AppService {\n  async getHello(): Promise {\n    return 'Hello World! ' + random.int(1, 10);\n  }\n}\n\n`\nConvert your NestJS project to ES modules (not recommended)\nAlthough not supported, it seems possible to setup NestJS to compile to ESM.\nThis Guide has good instructions how to do this for any typescript project.\nI tested it with NestJS and found these steps sufficient:\n\nadd `\"type\": \"module\"` to your `package.json`\nchange `module` to `NodeNext`in your compilerOptions in `tsconfig.json`\nadd the `.js` extension to all of your relative imports\n\nNow the import should work as expected.\n`import { Injectable } from '@nestjs/common';\nimport random from 'random';\n\n@Injectable()\nexport class AppService {\n  async getHello(): Promise {\n    return 'Hello World! ' + random.int(1, 10);\n  }\n}\n`\nWhat did not work so far were the unit tests with jest. I got other import errors there and I bet there are more problems down the road.\nI would avoid this approach and wait until NestJS officially supports ES modules.",
      "question_score": 35,
      "answer_score": 70,
      "created_at": "2022-12-16T23:02:09",
      "url": "https://stackoverflow.com/questions/74830166/unable-to-import-esm-module-in-nestjs"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 70820079,
      "title": "Error [ERR_REQUIRE_ESM]: require() of ES Module ... not supported",
      "problem": "I'm making a discord bot in `TypeScript` using `discord.js`. When I tried to compile code this morning I got this error:\n```\n`C:\\SECRET\\Kostegator\\dist\\Util\\getMeme.js:17\nconst node_fetch_1 = __importDefault(require(\"node-fetch\"));\n                                     ^\n\nError [ERR_REQUIRE_ESM]: require() of ES Module C:\\SECRET\\Kostegator\\node_modules\\node-fetch\\src\\index.js from C:\\SECRET\\Kostegator\\dist\\Util\\getMeme.js not supported.\nInstead change the require of index.js in C:\\SECRET\\Kostegator\\dist\\Util\\getMeme.js to a dynamic import() which is available in all CommonJS modules.\n    at Object. (C:\\SECRET\\Kostegator\\dist\\Util\\getMeme.js:17:38)\n    at Object. (C:\\SECRET\\Kostegator\\dist\\Util\\index.js:15:14)\n    at Object. (C:\\SECRET\\Kostegator\\dist\\Commands\\BotOwner\\startAutoUpdate.js:4:16)\n    at C:\\SECRET\\Kostegator\\dist\\Client\\index.js:61:41\n    at Array.forEach ()\n    at ExtendedClient. (C:\\SECRET\\Kostegator\\dist\\Client\\index.js:58:48)        \n    at Generator.next ()\n    at C:\\SECRET\\Kostegator\\dist\\Client\\index.js:27:71\n    at new Promise ()\n    at __awaiter (C:\\SECRET\\Kostegator\\dist\\Client\\index.js:23:12)\n    at ExtendedClient.init (C:\\SECRET\\Kostegator\\dist\\Client\\index.js:51:16)\n    at Object. (C:\\SECRET\\Kostegator\\dist\\index.js:19:4) {\n  code: 'ERR_REQUIRE_ESM'\n}\n`\n```\nHere's the GitHub repo: Kostegator",
      "solution": "The current version of `node-fetch` is ONLY compatible with an ESM import (using `import`), not from CommonJS modules using `require()`.\nYou have these choices to fix:\n\nSwitch your project to an ESM module and load it with `import fetch from 'node-fetch';`.\n\nIn a very recent version of nodejs, you can dynamically import an ESM module into a CommonJS module using `let fetch = await import('node-fetch')`.\n\nUse the v2 version of `node-fetch` that still supports being loaded with `require()` as explained here in the doc.",
      "question_score": 34,
      "answer_score": 38,
      "created_at": "2022-01-23T08:42:38",
      "url": "https://stackoverflow.com/questions/70820079/error-err-require-esm-require-of-es-module-not-supported"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 66317125,
      "title": "Node.js nodemailer error - wrong version number/invalid greeting",
      "problem": "I have a big problem with setting up the nodemailer on my node.js server. Tried everthing I found on the internet but nothing works. The only thing that was easy to setup was the gmail service. but unfortunately I cannot use that one.\nWith secure set to true, i get an ssl error with the reason wrong version code.\n```\n`[Error: 22468:error:1408F10B:SSL routines:ssl3_get_record:wrong version number:c:\\ws\\deps\\openssl\\openssl\\ssl\\record\\ssl3_record.c:332:\n] {\n  library: 'SSL routines',\n  function: 'ssl3_get_record',\n  reason: 'wrong version number',\n  code: 'ESOCKET',\n  command: 'CONN'\n}\n`\n```\nBut when I try to set secure to false, then I get an invalid greeting error.\n```\n`Error: Invalid greeting. response=* OK [CAPABILITY IMAP4rev1 UIDPLUS CHILDREN NAMESPACE THREAD=ORDEREDSUBJECT THREAD=REFERENCES SORT QUOTA ACL ACL2=UNION STARTTLS] Courier-IMAP ready. Copyright 1998-2016 Double Precision, Inc.  See COPYING for distribution information.: * OK [CAPABILITY IMAP4rev1 UIDPLUS CHILDREN NAMESPACE THREAD=ORDEREDSUBJECT THREAD=REFERENCES SORT QUOTA ACL ACL2=UNION STARTTLS] Courier-IMAP ready. Copyright 1998-2016 Double Precision, Inc.  See COPYING for distribution information.\n    at SMTPConnection._actionGreeting (C:\\Users\\Motiondata\\Documents\\repos\\rmn_app\\server\\rmn_server\\node_modules\\nodemailer\\lib\\smtp-connection\\index.js:1189:27)\n    at SMTPConnection._processResponse (C:\\Users\\Motiondata\\Documents\\repos\\rmn_app\\server\\rmn_server\\node_modules\\nodemailer\\lib\\smtp-connection\\index.js:932:20)\n    at SMTPConnection._onData (C:\\Users\\Motiondata\\Documents\\repos\\rmn_app\\server\\rmn_server\\node_modules\\nodemailer\\lib\\smtp-connection\\index.js:739:14)\n    at Socket.SMTPConnection._onSocketData (C:\\Users\\Motiondata\\Documents\\repos\\rmn_app\\server\\rmn_server\\node_modules\\nodemailer\\lib\\smtp-connection\\index.js:189:44)\n    at Socket.emit (events.js:315:20)\n    at addChunk (_stream_readable.js:309:12)\n    at readableAddChunk (_stream_readable.js:284:9)\n    at Socket.Readable.push (_stream_readable.js:223:10)\n    at TCP.onStreamRead (internal/stream_base_commons.js:188:23) {\n  code: 'EPROTOCOL',\n  response: '* OK [CAPABILITY IMAP4rev1 UIDPLUS CHILDREN NAMESPACE THREAD=ORDEREDSUBJECT THREAD=REFERENCES SORT QUOTA ACL ACL2=UNION STARTTLS] Courier-IMAP ready. Copyright 1998-2016 Double Precision, Inc.  See COPYING for distribution information.',\n  command: 'CONN'\n}\n`\n```\nMy code is the following:\n```\n`const transporter = nodemailer.createTransport({\n  host: process.env.MAIL_HOST, // mx.example.com\n  port: process.env.MAIL_PORT, // 143\n  secure: true,\n  auth: {\n    user: process.env.MAIL_ADDRESS,\n    pass: process.env.MAIL_PWD\n  }\n})\n`\n```\nI checked the credentials a thousand time, they are definetly not the problem.\nHope anyone can help me.\nThanks in advance.",
      "solution": "Refering to this issue mentioned here: https://github.com/nodemailer/nodemailer/issues/165\nSee if this helps, adding the `tls.ciphers` option to use `SSLv3`:\n```\n`const transport = nodemailer.createTransport({\n    host: process.env.MAIL_HOST, // mx.example.com\n    port: process.env.MAIL_PORT, // 143\n    secureConnection: false, // TLS requires secureConnection to be false\n    auth: {\n        user: process.env.MAIL_ADDRESS,\n        pass: process.env.MAIL_PWD\n    },\n    tls: {\n        ciphers:'SSLv3'\n    }\n});\n`\n```\nFor Outlook365, this should work:\n```\n`service: \"Outlook365\",\nauth: {\n   user: '[YOUR_O365_EMAIL]',\n   pass: '[YOUR_O365_PASSWORD]'\n}, \n`\n```\nRefer here: https://stackoverflow.com/a/37725123/9360885\nIf you're using HotMail, then remove `host` and `port`, and just add `service: \"hotmail\"`.",
      "question_score": 33,
      "answer_score": 68,
      "created_at": "2021-02-22T15:00:28",
      "url": "https://stackoverflow.com/questions/66317125/node-js-nodemailer-error-wrong-version-number-invalid-greeting"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 66068149,
      "title": "Receive a string and verify if it is a valid date with date-fns",
      "problem": "I just want to validate if the string that i received is a valid date using date-fns.\nI gonna receive a date like this '29/10/1989', BR date.\nI want to transform it into 29-10-1989 and check if its valid.\nAnyone can help me with this?\n```\n`const parsedDate = parseISO('29/10/1989')\n`\n```\nthis code above doesnt work, i got 'Invalid Date'",
      "solution": "Try `parse` with `locale` options like this:\n`import { parse, isValid, format } from 'date-fns';\nimport { enGB } from 'date-fns/locale';\n\nconst parsedDate = parse('29/10/1989', 'P', new Date(), { locale: enGB });\nconst isValidDate = isValid(parsedDate);\nconst formattedDate = format(parsedDate, 'dd-MM-yyyy');\n`",
      "question_score": 33,
      "answer_score": 58,
      "created_at": "2021-02-05T18:49:00",
      "url": "https://stackoverflow.com/questions/66068149/receive-a-string-and-verify-if-it-is-a-valid-date-with-date-fns"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 71813662,
      "title": "Is it possible to run a node.js script as a module with the node command (without using package.json)?",
      "problem": "Let's say I have a `code.js` file with the following node.js script:\n`const axios = require('axios')\n\nasync function getData(){\n    const response = await axios.get('https://mypage.com.br')\n    console.log(response.data)\n}\ngetData()\n`\nIf I execute it with `node code.js` it works perfectly fine... However, I'd like to execute it as a module, just so I can use the `import` statement and use the `await` command as top level. I'd like to accomplish that without creating a project with a `package.json` file. My final result would be something like this:\n`import axios from 'axios' \n\nconst response = await axios.get('https://mypage.com.br')\nconsole.log(response.data)\n`\nI haven't managed to make it work with the `node` command. I know there's a `--input-type=module` parameter I can use with it. But I've tried running `node --input-type=module code.js` and I've received the following error:\n```\n`SyntaxError: Cannot use import statement outside a module\n`\n```\nSo, that means it's not even being recognized as a module yet. Is it possible to do? Can I execute an isolated script with the command `node` as a module (while using `await` on top level)?",
      "solution": "Rename the file to `name.mjs`. This `--input-type` parameter only applies to STDIN and `--eval`-d files.",
      "question_score": 33,
      "answer_score": 21,
      "created_at": "2022-04-10T06:00:41",
      "url": "https://stackoverflow.com/questions/71813662/is-it-possible-to-run-a-node-js-script-as-a-module-with-the-node-command-withou"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 66676555,
      "title": "NodeJS 14.x - Native AWS Lambda Import/Export Support",
      "problem": "I am looking to make use of the native import/export that comes with ES6.\nI am using Serverless Containers within AWS Lambda.\nI have my `Dockerfile` which looks like this:\n```\n`FROM public.ecr.aws/lambda/nodejs:14\n\nCOPY app ./\n\nRUN npm install\n\nCMD [ \"app.handler\" ]\n`\n```\nI then have an `app` directory with my application code. The `app.js` code looks like this:\n```\n`import { success } from './utils/log';\n\nexports.handler = async () => {\n  success('lambda invoked');\n  const response = 'Hello World';\n  return {\n    statusCode: 200,\n    body: JSON.stringify(response),\n    isBase64Encoded: false,\n  };\n};\n`\n```\nAs you can see from this line `import { success } from './utils/log';` I am making use of native imports.\nIn my package.json I specify this:\n```\n`  \"type\": \"module\"\n`\n```\nAs I need to tell my application this is a module and I would like imports natively. If I don't specify this, I get:\n```\n`{\n    \"errorType\": \"Runtime.UserCodeSyntaxError\",\n    \"errorMessage\": \"SyntaxError: Cannot use import statement outside a module\",\n    \"stack\": [\n        \"Runtime.UserCodeSyntaxError: SyntaxError: Cannot use import statement outside a module\",\n        \"    at _loadUserApp (/var/runtime/UserFunction.js:98:13)\",\n        \"    at Object.module.exports.load (/var/runtime/UserFunction.js:140:17)\",\n        \"    at Object. (/var/runtime/index.js:43:30)\",\n        \"    at Module._compile (internal/modules/cjs/loader.js:1063:30)\",\n        \"    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1092:10)\",\n        \"    at Module.load (internal/modules/cjs/loader.js:928:32)\",\n        \"    at Function.Module._load (internal/modules/cjs/loader.js:769:14)\",\n        \"    at Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:72:12)\",\n        \"    at internal/main/run_main_module.js:17:47\"\n    ]\n}\n`\n```\nSo, I specify it, telling Lambda this is a module. However, for the life of me I can't get it to work, I am seeing this error:\n```\n`{\n    \"errorType\": \"Error\",\n    \"errorMessage\": \"Must use import to load ES Module: /var/task/app.js\\nrequire() of ES modules is not supported.\\nrequire() of /var/task/app.js from /var/runtime/UserFunction.js is an ES module file as it is a .js file whose nearest parent package.json contains \\\"type\\\": \\\"module\\\" which defines all .js files in that package scope as ES modules.\\nInstead rename app.js to end in .cjs, change the requiring code to use import(), or remove \\\"type\\\": \\\"module\\\" from /var/task/package.json.\\n\",\n    \"code\": \"ERR_REQUIRE_ESM\",\n    \"stack\": [\n        \"Error [ERR_REQUIRE_ESM]: Must use import to load ES Module: /var/task/app.js\",\n        \"require() of ES modules is not supported.\",\n        \"require() of /var/task/app.js from /var/runtime/UserFunction.js is an ES module file as it is a .js file whose nearest parent package.json contains \\\"type\\\": \\\"module\\\" which defines all .js files in that package scope as ES modules.\",\n        \"Instead rename app.js to end in .cjs, change the requiring code to use import(), or remove \\\"type\\\": \\\"module\\\" from /var/task/package.json.\",\n        \"\",\n        \"    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1080:13)\",\n        \"    at Module.load (internal/modules/cjs/loader.js:928:32)\",\n        \"    at Function.Module._load (internal/modules/cjs/loader.js:769:14)\",\n        \"    at Module.require (internal/modules/cjs/loader.js:952:19)\",\n        \"    at require (internal/modules/cjs/helpers.js:88:18)\",\n        \"    at _tryRequire (/var/runtime/UserFunction.js:75:12)\",\n        \"    at _loadUserApp (/var/runtime/UserFunction.js:95:12)\",\n        \"    at Object.module.exports.load (/var/runtime/UserFunction.js:140:17)\",\n        \"    at Object. (/var/runtime/index.js:43:30)\",\n        \"    at Module._compile (internal/modules/cjs/loader.js:1063:30)\"\n    ]\n}\n`\n```\nIt looks like `/var/runtime/UserFunction.js` is calling my app handler as a require and a module. However, I have no control over `/var/runtime/UserFunction.js` (I don't believe?). In my `Dockerfile` I have specified `Node14`. I don't quite know where I have gone wrong?\nWhat I am looking to do is run the latest and greatest of Node14 (such as imports) without Babel/Transpiler that \"bloat\" my code. If someone could point me in the right direction of where I have gone wrong, it would be appreciated.",
      "solution": "It appears that since yesterday there finally is native support for the ES6 module syntax in Node 14 lambdas - see https://aws.amazon.com/blogs/compute/using-node-js-es-modules-and-top-level-await-in-aws-lambda",
      "question_score": 32,
      "answer_score": 16,
      "created_at": "2021-03-17T16:49:18",
      "url": "https://stackoverflow.com/questions/66676555/nodejs-14-x-native-aws-lambda-import-export-support"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 66673012,
      "title": "Should I update my npm version or use the one node.js provides?",
      "problem": "I have a project that uses node.js 14.16.0. Both me and my teammember use that version.\nI use npm 6.14.11 and my teammember uses npm 7.x.x.\nThis results in the package-lock.json being different; the `lockFileVersion` property is 1 on my PC but 2 on theirs.\nI already use `nvm` and am considering to add a `.nvmrc` so everyone always uses the same node version, but this doesn't fix the npm version issue.\nI believe that it is a good idea to use the npm version that the installed node.js version provides. If the next big LTS release uses a new npm version, the project will switch to that. But on NPM's site they say:\n\nnpm is a separate project from Node.js, and tends to update more frequently. As a result, even if you\u2019ve just downloaded Node.js (and therefore npm), you\u2019ll probably need to update your npm. Luckily, npm knows how to update itself!\n\nWhich makes me believe I should always update.\nBut they also say:\n\nNode.js has lots of versions! To use Node.js, and therefore npm, effectively, you\u2019ll want to make sure that you are on a version that is supported by the Node.js team. In general, you should use the version of Node.js labelled \u201cLTS\u201d.\n\nWhich makes me believe I shouldn't update and just use the one node.js provides.\nWhat is the best practice?",
      "solution": "npm has a concept of LTS. They used to tag a release `lts` so you could `npm install -g npm@lts` and get the latest lts version, but alas, no more.\nnpm will continue to support any major version of npm as long as it shipped with a version of node that is still supported. So they will support npm@6 until 14 goes EOL because npm@6 shipped with version 14.\nThat said, npm@7 is the current version of npm and it too will be supported on 14 as well for as long as 14 is supported.\nIf you don't want to force your coworker to update, `npm@6` will continue to receive updates as long as Node.js 14 is supported. I would recommend updating to the latest `npm@6` with `npm install -g npm@6` though. Either version (`npm@6` or `npm@7`) should work just fine. You just need to pick one with your coworker to avoid the `package-lock.json` churn (or not care about the lockfile churn).",
      "question_score": 32,
      "answer_score": 32,
      "created_at": "2021-03-17T13:21:10",
      "url": "https://stackoverflow.com/questions/66673012/should-i-update-my-npm-version-or-use-the-one-node-js-provides"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 66085585,
      "title": "CocoaPods could not find compatible versions for pod &quot;lottie-ios&quot;",
      "problem": "i can't install react-native-lottie throwing error compatatible version for lottie-react-native  CocoaPods could not find compatible versions for pod \"lottie-ios\"",
      "solution": "as per the error says we need to go for\n```\n`npm i lottie-ios@3.1.8 lottie-react-native@3.5.0\ncd ios\npod install\n`\n```\nIssue resolved!\nObviously install npm onto this MacOS box first.",
      "question_score": 31,
      "answer_score": 58,
      "created_at": "2021-02-07T08:39:22",
      "url": "https://stackoverflow.com/questions/66085585/cocoapods-could-not-find-compatible-versions-for-pod-lottie-ios"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 68527897,
      "title": "How to specifiy path for actions/setup-node in Github",
      "problem": "Note: I have already seen these two:\nHow do I run my CI steps in a specific folder in github action \nHow to specify node's path in Github action?\nBut I still cant get it to work, thats why I am asking how I am able to set the working directory for a `uses` command. My yaml currently looks as follows:\n```\n`# This workflow will build a Java project with Maven\n# For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-maven\n\nname: Java CI with Maven\n\non:\n  push:\n    branches: [ main, Create-.yml-file ]\n  pull_request:\n    branches: [ main, Create-.yml-file ]\n\njobs:\n  javatest:\n    runs-on: ubuntu-latest\n\n    steps:\n    - uses: actions/checkout@v2\n    - uses: actions/setup-java@v2\n      with:\n        java-version: '16'\n        distribution: 'adopt'\n    - name: Cache Maven packages\n      uses: actions/cache@v2\n      with:\n        path: ~/.m2\n        key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}\n        restore-keys: ${{ runner.os }}-m2\n    - name: Build with Maven\n      run: |\n          mvn -f ./backend/pom.xml -B test\n          #mvn -f ./notification/pom.xml -B test\n\n    - name: Generate JaCoCo Badge\n      uses: cicirello/jacoco-badge-generator@v2\n      with:\n        generate-branches-badge: true\n        on-missing-report: quiet\n        jacoco-csv-file: >\n          -backend/target/site/jacoco/jacoco.csv\n\n    - name: Log coverage percentage\n      run: |\n        echo \"coverage = ${{ steps.jacoco.outputs.coverage }}\"\n        echo \"branch coverage = ${{ steps.jacoco.outputs.branches }}\"\n\n    - name: Commit the badge (if it changed)\n      run: |\n        if [[ `git status --porcelain` ]]; then\n          git config --global user.name 'myusername'\n          git config --global user.email 'myId@users.noreply.github.com'\n          git add -A\n          git commit -m \"Autogenerated JaCoCo coverage badge\"\n          git push\n        fi\n\n    - name: Upload JaCoCo coverage report\n      uses: actions/upload-artifact@v2\n      with:\n        name: jacoco-report\n        path: target/site/jacoco/\n      \n  nodejstest:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v2\n    - name: Use Node.js ${{ matrix.node-version }}\n      uses: actions/setup-node@v2\n      with:\n        node-version: ${{ matrix.node-version }}\n        cache: 'npm'\n    - run: npm ci\n      working-directory: ./frontend\n    - run: npm run build --if-present\n      working-directory: ./frontend\n    - run: npm test\n      working-directory: ./frontend\n\n`\n```\nwith the error occuring here:\n```\n` - name: Use Node.js ${{ matrix.node-version }}\n      uses: actions/setup-node@v2\n      with:\n        node-version: ${{ matrix.node-version }}\n        cache: 'npm'\n`\n```\nAnd looking like this:\n```\n`Run actions/setup-node@v2\n/usr/local/bin/npm config get cache\n/home/runner/.npm\nError: Dependencies lock file is not found in /home/runner/work/path/to/main/directory. Supported file patterns: package-lock.json,yarn.lock\n`\n```\nMy package-lock ist located in the .../path/to/main/directory/frontend so it is obvious that it can not be found but according to the other two solutions this snippet should work shouldn't it? I also already tried combining the last three run statements into one as well as move the working-directory setting to different places. All with varying amounts of failure",
      "solution": "The support for custom path (relative to repository root) was added in version 2.4:\nhttps://github.com/actions/setup-node/releases/tag/v2.4.0\n\nYou can try specifying `'**/package-lock.json'` in the\n`cache-dependency-path` (it didn't work for me with other patterns).\nAlso you can try setting the `working directory` (either for all jobs or your `nodejstest` specific job) to point to your `frontend` folder.\n\n```\n`  nodejstest:\n    runs-on: ubuntu-latest\n    defaults:\n      run:\n        working-directory: 'frontend' # Here the path to the folder where package-lock.json is located.\n    strategy:\n      matrix:\n        node-version: [16.x] # Are you are missing this specification?\n    steps:\n    - uses: actions/checkout@v2\n    - name: Use Node.js ${{ matrix.node-version }}\n      uses: actions/setup-node@v2\n      with:\n        node-version: ${{ matrix.node-version }}\n        cache: 'npm'\n        cache-dependency-path: '**/package-lock.json' # THIS PATTERN did the trick for me.\n`\n```",
      "question_score": 31,
      "answer_score": 58,
      "created_at": "2021-07-26T11:59:08",
      "url": "https://stackoverflow.com/questions/68527897/how-to-specifiy-path-for-actions-setup-node-in-github"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 74616687,
      "title": "error TS2707 Generic type &#39;\u0275\u0275DirectiveDeclaration&#39; requires between 6 and 8 type arguments",
      "problem": "After installing angular material and adding angular material imports in app.module.ts to the project im having errors and all solutions didn't work so far. I have angular 14, node 16. First error, which in reality is way longer:\n```\n`Error: node_modules/@angular/cdk/a11y/index.d.ts:152:18 - error TS2707: Generic type '\u0275\u0275DirectiveDeclaration' requires between 6 and 8 type arguments.\n\n152     static \u0275dir: i0.\u0275\u0275DirectiveDeclaration;\n                     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nError: node_modules/@angular/cdk/a11y/index.d.ts:175:18 - error TS2707: Generic type '\u0275\u0275DirectiveDeclaration' requires between 6 and 8 type arguments.\n\n175     static \u0275dir: i0.\u0275\u0275DirectiveDeclaration;\n                     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nError: node_modules/@angular/cdk/a11y/index.d.ts:208:18 - error TS2707: Generic type '\u0275\u0275DirectiveDeclaration' requires between 6 and 8 type arguments.\n\n208     static \u0275dir: i0.\u0275\u0275DirectiveDeclaration;\n                     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nError: node_modules/@angular/cdk/bidi/index.d.ts:37:18 - error TS2707: Generic type '\u0275\u0275DirectiveDeclaration' requires between 6 and 8 type arguments.\n\n37     static \u0275dir: i0.\u0275\u0275DirectiveDeclaration;\n                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n`\n```\n```\n`{\n  \"name\": \"highlight\",\n  \"version\": \"0.0.0\",\n  \"scripts\": {\n    \"ng\": \"ng\",\n    \"start\": \"ng serve\",\n    \"build\": \"ng build\",\n    \"watch\": \"ng build --watch --configuration development\",\n    \"test\": \"ng test\"\n  },\n  \"private\": true,\n  \"dependencies\": {\n    \"@angular/animations\": \"^14.2.4\",\n    \"@angular/cdk\": \"^15.0.0\",\n    \"@angular/common\": \"^14.2.4\",\n    \"@angular/compiler\": \"^14.2.4\",\n    \"@angular/core\": \"^14.2.4\",\n    \"@angular/forms\": \"^14.2.4\",\n    \"@angular/material\": \"^15.0.0\",\n    \"@angular/platform-browser\": \"^14.2.4\",\n    \"@angular/platform-browser-dynamic\": \"^14.2.4\",\n    \"@angular/router\": \"^14.2.4\",\n    \"@fortawesome/angular-fontawesome\": \"^0.11.1\",\n    \"@fortawesome/fontawesome-svg-core\": \"^6.2.0\",\n    \"@fortawesome/free-solid-svg-icons\": \"^6.2.0\",\n    \"@ng-bootstrap/ng-bootstrap\": \"^13.0.0\",\n    \"@popperjs/core\": \"^2.11.6\",\n    \"@syncfusion/ej2-angular-calendars\": \"^20.3.56\",\n    \"apexcharts\": \"^3.36.3\",\n    \"bootstrap\": \"^5.2.2\",\n    \"jwt-decode\": \"^3.1.2\",\n    \"ng-apexcharts\": \"^1.7.4\",\n    \"rxjs\": \"~6.6.0\",\n    \"tslib\": \"^2.3.0\",\n    \"zone.js\": \"~0.11.4\"\n  },\n  \"devDependencies\": {\n    \"@angular-devkit/build-angular\": \"^14.2.4\",\n    \"@angular/cli\": \"^14.2.4\",\n    \"@angular/compiler-cli\": \"^14.2.4\",\n    \"@angular/localize\": \"^14.2.4\",\n    \"@types/jasmine\": \"~3.8.0\",\n    \"@types/node\": \"^12.11.1\",\n    \"jasmine-core\": \"~3.8.0\",\n    \"karma\": \"~6.3.0\",\n    \"karma-chrome-launcher\": \"~3.1.0\",\n    \"karma-coverage\": \"~2.0.3\",\n    \"karma-jasmine\": \"~4.0.0\",\n    \"karma-jasmine-html-reporter\": \"~1.7.0\",\n    \"typescript\": \"4.7\"\n  }\n}\n`\n```\nI tried to delete node_modules, .angular and npm install. Didn't work.\nNext i tried to reinstall angular material - npm install --save @angular/material @angular/cdk - gave me error, but different one. Im suspecting this is showing more clear reason of my actual error.  As suggested in error i tried commands npm install --legacy-peer-deps, --force, npm install --save --legacy-peer-deps ,did not work. Maybe someone have more experience and recognize the problem?\n```\n`npm ERR! code ERESOLVE\nnpm ERR! ERESOLVE unable to resolve dependency tree\nnpm ERR! \nnpm ERR! While resolving: highlight@0.0.0\nnpm ERR! Found: @angular/common@14.2.12\nnpm ERR! node_modules/@angular/common\nnpm ERR!   @angular/common@\"^14.2.4\" from the root project\nnpm ERR! \nnpm ERR! Could not resolve dependency:\nnpm ERR! peer @angular/common@\"^15.0.0 || ^16.0.0\" from @angular/cdk@15.0.0\nnpm ERR! node_modules/@angular/cdk\nnpm ERR!   @angular/cdk@\"^15.0.0\" from the root project\nnpm ERR! \nnpm ERR! Fix the upstream dependency conflict, or retry\nnpm ERR! this command with --force, or --legacy-peer-deps\nnpm ERR! to accept an incorrect (and potentially broken) dependency resolution.\n`\n```\nMy ng v outcome:\n```\n`Angular CLI: 14.2.10\nNode: 16.10.0\nPackage Manager: npm 7.24.0 \nOS: darwin x64\n\nAngular: 14.2.12\n... animations, common, compiler, compiler-cli, core, forms\n... localize, platform-browser, platform-browser-dynamic, router\n\nPackage                         Version\n---------------------------------------------------------\n@angular-devkit/architect       0.1402.10\n@angular-devkit/build-angular   14.2.10\n@angular-devkit/core            14.2.10\n@angular-devkit/schematics      14.2.10\n@angular/cdk                    15.0.1\n@angular/cli                    14.2.10\n@angular/material               15.0.1\n@schematics/angular             14.2.10\nrxjs                            6.6.7\ntypescript                      4.7.4\n`\n```",
      "solution": "Had the same issue.\nGo with ngrx/component 14.3.2, if you use Angular 14.\nOr update directly to Angular 15.",
      "question_score": 31,
      "answer_score": 5,
      "created_at": "2022-11-29T16:46:58",
      "url": "https://stackoverflow.com/questions/74616687/error-ts2707-generic-type-%c9%b5%c9%b5directivedeclaration-requires-between-6-and-8-type"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 70403417,
      "title": "TypeError: match.loader.options.plugins is not a function",
      "problem": "I am trying to use tailwindCSS in a ReactJS app\nThese are the scripts commands in `package.json` file\n```\n`  \"scripts\": {\n    \"start\": \"craco start\",\n    \"build\": \"craco build\",\n    \"test\": \"craco test\",\n    \"eject\": \"react-scripts eject\"\n  }\n`\n```\nThis is my `craco.config.js`\n```\n`module.exports = {\n    style: {\n        postcss: {\n            plugins: [\n                require('tailwindcss'),\n                require('autoprefixer'),\n            ],\n        },\n    },\n}\n`\n```\nWhen I am used `npm run start` command, I am facing this error\n```\n`TypeError: match.loader.options.plugins is not a function\n    at extendsPostcss (C:\\Development\\Open Source\\Learning Hub\\react\\node_modules\\@craco\\craco\\lib\\features\\webpack\\style\\postcss.js:54:51)\n    at overrideLoader (C:\\Development\\Open Source\\Learning Hub\\react\\node_modules\\@craco\\craco\\lib\\features\\webpack\\style\\postcss.js:97:9)\n    at C:\\Development\\Open Source\\Learning Hub\\react\\node_modules\\@craco\\craco\\lib\\features\\webpack\\style\\postcss.js:118:13\n    at Array.forEach ()\n    at overridePostcss (C:\\Development\\Open Source\\Learning Hub\\react\\node_modules\\@craco\\craco\\lib\\features\\webpack\\style\\postcss.js:117:17)\n    at overrideStyle (C:\\Development\\Open Source\\Learning Hub\\react\\node_modules\\@craco\\craco\\lib\\features\\webpack\\style\\style.js:9:25)\n    at mergeWebpackConfig (C:\\Development\\Open Source\\Learning Hub\\react\\node_modules\\@craco\\craco\\lib\\features\\webpack\\merge-webpack-config.js:77:30)\n    at overrideWebpackDev (C:\\Development\\Open Source\\Learning Hub\\react\\node_modules\\@craco\\craco\\lib\\features\\webpack\\override.js:11:36)\n    at C:\\Development\\Open Source\\Learning Hub\\react\\node_modules\\@craco\\craco\\scripts\\start.js:27:5\n`\n```\nThings that I have tried :\n\nReinstall `node_modules`\n\nGot this error, when I tried to do that\n\n```\n`$ npm i @craco/craco\nnpm ERR! code ERESOLVE\nnpm ERR! ERESOLVE unable to resolve dependency tree\nnpm ERR!\nnpm ERR! While resolving: first-react-app@0.1.0\nnpm ERR! Found: react-scripts@5.0.0\nnpm ERR! node_modules/react-scripts\nnpm ERR!   react-scripts@\"5.0.0\" from the root project\nnpm ERR!\nnpm ERR! Could not resolve dependency:\nnpm ERR! peer react-scripts@\"^4.0.0\" from @craco/craco@6.4.3\nnpm ERR! node_modules/@craco/craco\nnpm ERR!   @craco/craco@\"*\" from the root project\nnpm ERR!\nnpm ERR! Fix the upstream dependency conflict, or retry\nnpm ERR! this command with --force, or --legacy-peer-deps\nnpm ERR! to accept an incorrect (and potentially broken) dependency resolution.\n`\n```",
      "solution": "Have you solved your problem? There is a solution to the problem.\nhttps://github.com/facebook/create-react-app/issues/11777\n\ntry to replace \"postcss\" with \"postcssOptions\" in craco config\nI had the same problem , this method works for me.",
      "question_score": 30,
      "answer_score": 53,
      "created_at": "2021-12-18T13:26:54",
      "url": "https://stackoverflow.com/questions/70403417/typeerror-match-loader-options-plugins-is-not-a-function"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 76281195,
      "title": "Stripe - Webhook payload must be provided as a string or a Buffer",
      "problem": "I am trying to code a subscription system with stripe. My following code is mostly copied from the stripe docs, but it always shows me this error:\n```\n`Webhook signature verification failed. Webhook payload must b\ne provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead.\nSignature verification is impossible without access to the original signed material.\nLearn more about webhook signing and explore webhook integration \nexamples for various frameworks at https://github.com/stripe/stripe-node#webhook-signing\n`\n```\nThis is my code written in javascript:\n```\n`app.post(\n  '/webhook',\n  express.raw({ type: 'application/json' }),\n  (request, response) => {\n    let event = request.body;\n\n    const endpointSecret = 'whsec_.....';\n\n    if (endpointSecret) {\n\n      const signature = request.headers['stripe-signature'];\n      try {\n        event = stripe.webhooks.constructEvent(\n          request.body,\n          signature,\n          endpointSecret\n        );\n      } catch (err) {\n        console.log(`\u26a0\ufe0f  Webhook signature verification failed.`, err.message);\n        return response.sendStatus(400);\n      }\n    }\n    let subscription;\n    let status;\n\n    switch (event.type) {\n      case 'customer.subscription.created':\n        subscription = event.data.object;\n        status = subscription.status;\n        console.log(`Subscription status is ${status}.`);\n\n        break;\n      default:\n        console.log(`Unhandled event type ${event.type}.`);\n    }\n    response.send();\n  }\n);\n`\n```\nDoes anyone know what I am doing wrong? I have literally been searching the internet for an hour now and cant find anything. Thanks in advance!",
      "solution": "It's because `app.use(express.json());` code. Try to move webhook route before `app.use(express.json());`.\n`// webhook route\napp.post(\n  '/webhook',\n  express.raw({ type: 'application/json' }),\n  (request, response) => {\n    let event = request.body;\n\n    const endpointSecret = 'whsec_.....';\n\n    if (endpointSecret) {\n\n      const signature = request.headers['stripe-signature'];\n      try {\n        event = stripe.webhooks.constructEvent(\n          request.body,\n          signature,\n          endpointSecret\n        );\n      } catch (err) {\n        console.log(`\u26a0\ufe0f  Webhook signature verification failed.`, err.message);\n        return response.sendStatus(400);\n      }\n    }\n    let subscription;\n    let status;\n\n    switch (event.type) {\n      case 'customer.subscription.created':\n        subscription = event.data.object;\n        status = subscription.status;\n        console.log(`Subscription status is ${status}.`);\n\n        break;\n      default:\n        console.log(`Unhandled event type ${event.type}.`);\n    }\n    response.send();\n  }\n);\n\napp.use(express.json());\n`",
      "question_score": 30,
      "answer_score": 40,
      "created_at": "2023-05-18T15:14:26",
      "url": "https://stackoverflow.com/questions/76281195/stripe-webhook-payload-must-be-provided-as-a-string-or-a-buffer"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 74792293,
      "title": "AWS Lambda &quot;cannot find module aws-sdk&quot; in Build a Basic Web Application tutorial",
      "problem": "I'm trying to get a start with AWS by starting at the beginning, running the Build a Basic Web Application tutorial. I figured I'd be able to just follow it step by step and have a simple Hello World web page front end to a little database. But I'm running into a strange error: including the bare-bones, default `aws-sdk` module is failing!\nShort version:\nThis code:\n```\n`// Include the AWS SDK module\nconst AWS = require('aws-sdk');\n`\n```\ngenerates this error: `Error: Cannot find module 'aws-sdk'`\nLong Story:\nI'm following the process step by step, creating all the pieces using the AWS online tools. The first hint of trouble happened when I created my Lambda function. I wasn't too worried that the Create Function tool shows a Node.js version of 18.x instead of the tutorial's Node.js 16.x, but I definitely noticed that the Lambda shell it generated was named `index.mjs` instead of `index.js`. No problem, I'll just use that file. I replaced the contents with Amazon's HelloWorld code.\n```\n`// Define handler function, the entry point to our code for the Lambda service\n// We receive the object that triggers the function as a parameter\nexports.handler = async (event) => {\n    // Extract values from event and format as strings\n    let name = JSON.stringify(`Hello from Lambda, ${event.firstName} ${event.lastName}`);\n    // Create a JSON object with our response and store it in a constant\n    const response = {\n        statusCode: 200,\n        body: name\n    };\n    // Return the response constant\n    return response;\n};\n`\n```\nI set up the Test Event functionality using their data:\n```\n`{\n  \"firstName\": \"Ada\",\n  \"lastName\": \"Lovelace\"\n}\n`\n```\nBut running the code generated my first error: `exports is not defined in ES module scope`\nDoing some searching on that error sent me down a rabbit hole far outside the scope of a basic tutorial, so I renamed the file from index.mjs to index.js. Rebuilt and poof, it worked just fine:\n```\n`{\n  \"statusCode\": 200,\n  \"body\": \"\\\"Hello from Lambda, Ada Lovelace\\\"\"\n}\n`\n```\nI won't go through the steps of creating the database, because that's not relevant. Everything was fine until I replaced the code with the code that would access the database - it errored with the message above. To simplify the issue, I deleted the Lambda and rebuilt it with the working code above, and the `require` statement:\n```\n`// Include the AWS SDK module\nconst AWS = require('aws-sdk');\n// Define handler function, the entry point to our code for the Lambda service\n// We receive the object that triggers the function as a parameter\nexports.handler = async (event) => {\n    // Extract values from event and format as strings\n    let name = JSON.stringify(`Hello from Lambda, ${event.firstName} ${event.lastName}`);\n    // Create a JSON object with our response and store it in a constant\n    const response = {\n        statusCode: 200,\n        body: name\n    };\n    // Return the response constant\n    return response;\n};\n`\n```\nRunning that generates this output:\n```\n`{\n  \"errorType\": \"Runtime.ImportModuleError\",\n  \"errorMessage\": \"Error: Cannot find module 'aws-sdk'\\nRequire stack:\\n- /var/task/index.js\\n- /var/runtime/index.mjs\",\n  \"trace\": [\n    \"Runtime.ImportModuleError: Error: Cannot find module 'aws-sdk'\",\n    \"Require stack:\",\n    \"- /var/task/index.js\",\n    \"- /var/runtime/index.mjs\",\n    \"    at _loadUserApp (file:///var/runtime/index.mjs:1000:17)\",\n    \"    at async UserFunction.js.module.exports.load (file:///var/runtime/index.mjs:1035:21)\",\n    \"    at async start (file:///var/runtime/index.mjs:1200:23)\",\n    \"    at async file:///var/runtime/index.mjs:1206:1\"\n  ]\n}\n`\n```\nThe strangest thing I see in the dump: it still references `index.mjs` even though I deleted the file (or renamed it - I tried both ways). In the online IDE, I only have access to the file tree that shows only index.js. I assume that's `/var/task` so I don't know where `/var/runtime` is that still contains a reference to `index.mjs`.\nI'm looking forward to the solution to this head-scratcher. It feels like it's simple enough that it should Just Work!",
      "solution": "The code provided by the that tutorial will not work with Lambda Runtime using NodeJS 18. There are a few reasons for this:\n\nNode.js 18.x is using AWS SDK v3. In your code, you are trying to import AWS SDK v2. The problem is that, NodeJS 18.x runtime does not come with version 2 of the AWS SDK automatically packaged and ready to use. This is the reason why you got the error for not being able to find `aws-sdk`. The newer v3 SDK is significantly different from the older v2 version.\n\n`exports is not defined in ES module scope` - the reason for this error is that Node.js 18.x runtime is using ECMAScript modules instead of CommonJS modules. This is why you are seeing a JavaScript file with an `.mjs` extension. Suffice to say, ECMAScript modules export dependencies differently (using `export` keyword), likewise they use  `import` instead of `require` for importing dependencies.\n\nUpdate and warning for newer readers:\nSupport for NodeJS 16.x was dropped by AWS, so you may not be able to proceed with the steps bellow!\nSince you are doing a tutorial, I suggest sticking with NodeJS 16 (or lower available version) for now. Migrating to NodeJS 18.x is not as a trivial task as you might expect, but is not the end of the world as long as you have the necessary experience. Hopefully, this tutorial will be updated in the future for the latest available runtimes.\nTo create a function using NodeJS 16.x you can select the runtime from the list:",
      "question_score": 30,
      "answer_score": 62,
      "created_at": "2022-12-14T01:13:26",
      "url": "https://stackoverflow.com/questions/74792293/aws-lambda-cannot-find-module-aws-sdk-in-build-a-basic-web-application-tutoria"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 67456980,
      "title": "Getting a 504/502 error on api requests in Nextjs deployed on Vercel",
      "problem": "I have developed an application in Next.js. For the backend I have used the api endpoints configured in Nextjs which rest inside `pages/api`. The api end points quite often return 502(Gateway timeout error) or 504(There is a problem with our deployment).\nWith some research I found out that it was happening because the server was timing out. For Vercel where I have deployed my Nextjs application, the timeout max period for serverless functions is 10s.\nThe code for one of endpoints(https://bulkbays.com/api/fetchSections) is\n`import db from \"../../config/db\";\nimport Section from \"../../Models/Section\";\n\ndb();\n\nexport default async function handler(req, res) {\n\n    console.log('Entered the serverless function')\n\n    Section.find()\n        .lean()\n        .then((sections) => {\n            console.log('Fetched Sections',sections)\n            return res.json(sections);\n        })\n        .catch((err) => {\n            console.log('Error in fetching sessions',err)\n            return res.json({\n                status: false,\n                msg: \"An unexpected problem occured\",\n                err,\n            });\n        });\n}\n`\nPlease someone tell me how could it take more than 10 seconds. Its the simplest of queries one could make. Also the result of this query is just an array of length 9 with objects as items which has strings as its values. It looks sth like this\n`[\n  {\n  \"_id\":\"6092a55478ccc2092c5e41b0\",\n  \"images\":[\"http://res.cloudinary.com/bulkbays97/image/upload/v1620223428/eysvsch2hf4ymajizzcn.jpg\",\"http://res.cloudinary.com/bulkbays97/image/upload/v1620223429/qiwa2idfrntiygsfmnx2.jpg\",\"http://res.cloudinary.com/bulkbays97/image/upload/v1620223429/elwhjk7abwcde7ccqcxf.jpg\",\"http://res.cloudinary.com/bulkbays97/image/upload/v1620223428/yuzhe8iehcyj1rmfyr09.jpg\"],\n  \"title\":\"P-Caps\",\n  \"createdAt\":\"2021-05-05T14:01:56.626Z\",\n  \"updatedAt\":\"2021-05-05T14:01:56.626Z\",\"__v\":0\n  },\n  ....\n]\n`\nThis is the log for one of the requests which sent a 502 or 504 response\n`[GET] /api/fetchSections\n14:36:34:38\nStatus:-1\nDuration:10010.32 ms\nInit Duration: N/A\nMemory Used:60 MB\nID:x7lh8-1620552994128-a44f049a01ae\nUser Agent:Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:88.0) Gecko/20100101 Firefox/88.0\n2021-05-09T09:36:44.511Z 62c16977-9c5c-42f5-961f-a63083638a9c Task timed out after 10.01 seconds\n`\nWhat should I do? Should I use something like Heroku(not serverless) for this or what?\nI made this website for a client and now I do not know what is the problem that's causing this.",
      "solution": "When using Vercel with a Hobby plan, your serverless API routes can only be processed for 5 seconds. This means that after 5 seconds, the route responds with a 504 GATEWAY TIMEOUT error.\nTo resolve this, you would need to reduce the amount of time your API route takes to respond, or upgrade your Vercel plan.",
      "question_score": 30,
      "answer_score": 37,
      "created_at": "2021-05-09T13:04:28",
      "url": "https://stackoverflow.com/questions/67456980/getting-a-504-502-error-on-api-requests-in-nextjs-deployed-on-vercel"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 73205111,
      "title": "crypto.randomUUID is not a function",
      "problem": "I'm very new to JS, I want to generate a UUID. Here's what I tried, step by step:\n\n`mkdir test`\n`cd test`\n`touch file1.js`\nInside `file1.js`:\n\n`let crypto;\ntry {\n  crypto = require('crypto');\n} catch (err) {\n  console.log('crypto support is disabled!');\n}\n\nvar uuid = crypto.randomUUID();\nconsole.log(uuid);\n`\nAnd you see the error:\n`TypeError: crypto.randomUUID is not a function\n    at Object. (/home/runner/yplebns1ahn/index.js:9:19)\n    at Module._compile (internal/modules/cjs/loader.js:999:30)\n`\nWhat is wrong? I can't find an answer anywhere. Node JS version:\n`node -v` shows `v12.22.9`\nscreenshot showing code and error",
      "solution": "here you can use `randomBytes()` method for get unique id\n```\n`const crypto = require('crypto');\nconsole.log(crypto.randomBytes(20).toString('hex'));\n`\n```\nyou can also use uuidv4 instead of crypto\n```\n`const { uuid } = require('uuidv4');\nconsole.log(uuid());\n`\n```",
      "question_score": 30,
      "answer_score": 25,
      "created_at": "2022-08-02T11:27:57",
      "url": "https://stackoverflow.com/questions/73205111/crypto-randomuuid-is-not-a-function"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 68476229,
      "title": "M1 Related! - Prisma: Can&#39;t reach database server at `database`:`5432`",
      "problem": "Since I have moved to the new Apple Silicon architecture my docker setup with nextjs and postgres is not working anymore. The database inside the docker cannot be found by the nextjs server where I am using prisma.\nThe prisma client can't reach the postgres database on port 5432.\n\nCan't reach database server at `test-postgres`:`5432`\n\nThe migration also does not work and returns the same error above.\n`docker-compose run --publish 5555:5555 next npx prisma migrate dev\n`\ndocker-compose.yml\n```\n`postgres:\n    container_name: 'test-postgres'\n    restart: unless-stopped\n    image: 'postgres:13'\n    ports:\n      - '15432:5432'\n    volumes:\n      - 'pgdata:/var/lib/postgresql/data/'\n    environment:\n      POSTGRES_PASSWORD: postgres\n`\n```\n.env\n```\n`DATABASE_URL=\"postgres://postgres:postgres@localhost:15432/postgres\"\n`\n```\nI have also added the arm binary target to the schema.prisma\nschema.prisma\n```\n`\ngenerator client {\n  provider        = \"prisma-client-js\"\n  binaryTargets   = [\"native\", \"debian-openssl-1.1.x\", \"linux-arm-openssl-1.1.x\", \"linux-musl\"]\n  previewFeatures = [\"orderByRelation\", \"selectRelationCount\"]\n}\n`\n```\nThe postgres container is actually running and I can see it through the Docker Desktop Dashboard. One thing I have noticed inside the postgres container was this ERROR:\n```\n`2021-07-21 12:52:58.927 UTC [76] ERROR:  relation \"_prisma_migrations\" does not exist at character 126\n`\n```\nHave someone experienced it before and found a solution for it?\n[EDIT]\nHow to reproduce\nclone repo, follow README.md and see expected behaviour on a M1 Apple Silicon Machine: https://github.com/baristikir/prisma-postgres-M1",
      "solution": "Adding `?connect_timeout=300` to the connection string of the database did the trick.\n```\n`DATABASE_URL=\"postgres://postgres:postgres@localhost:15432/postgres?connect_timeout=300\"\n`\n```",
      "question_score": 29,
      "answer_score": 81,
      "created_at": "2021-07-21T22:40:23",
      "url": "https://stackoverflow.com/questions/68476229/m1-related-prisma-cant-reach-database-server-at-database5432"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 68574254,
      "title": "Body exceeded 1mb limit error in Next.js API route",
      "problem": "If I use `FormData` on Next.js to upload image to server I always get this error.\nI tried a lot but I didn't fix this.\nMy code:\n`const changeValue = (e) => {\nif (e.target.name === \"avatar\") {\n      const file = e.target.files[0];\n      const formData = new FormData();\n      formData.append(\"image\", file, file.name);\n      try {\n        const config = {\n          Headers: {\n            \"Content-Type\": \"multipart/form-data\",\n          },\n        };\n        axios\n          .post(\"/api/upload\", formData, config)\n          .then((res) => {\n            setAvatar(res.data);\n            setAvatarPreview(res.data);\n          })\n          .catch((err) => {\n            console.log(err.message);\n          });\n      } catch (err) {\n        console.log(err);\n      }\n    } \n}\n`",
      "solution": "API routes in `page` router\nThe default size limit for the body parser is `1mb` in API routes. You can modify this value through the custom `config` object exported from the API route.\n`// /pages/api/upload.js\n\nexport const config = {\n    api: {\n        bodyParser: {\n            sizeLimit: '2mb' // Set desired value here\n        }\n    }\n}\n`\nNote that there's a limit imposed on the API routes body size, see How to override the 4mb API Routes body size limit? for details.\n\nServer Actions in `app` router\nThe same default size limit of `1mb` is applied to Server Actions. You can modify this value using the `serverActions.bodySizeLimit` option in `next.config.js`.\n`// next.config.js\n\nmodule.exports = {\n    serverActions: {\n        bodySizeLimit: '2mb' // Set desired value here\n    }\n}\n`",
      "question_score": 29,
      "answer_score": 63,
      "created_at": "2021-07-29T12:26:16",
      "url": "https://stackoverflow.com/questions/68574254/body-exceeded-1mb-limit-error-in-next-js-api-route"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 67199539,
      "title": "TSC not found in Docker build",
      "problem": "When building an image that needs to be compiled from typescript, I get this error.\n\nsh: 1: tsc: not found\n\nThe command '/bin/sh -c npm run tsc' returned a non-zero code: 127\n\nHere is the relevant code:\ndocker-compose.yaml\n```\n`version: '3.1'\n\nservices:\n  nodeserver:\n    build:\n      context: .\n      target: prod\n    ports:\n      - \"3000:3000\"\n    volumes:\n      - ./src:/app/src\n      - ./public:/app/public\n      - ./templates:/app/templates\n`\n```\nDockerfile\n```\n`FROM node:15.11.0 AS base\nEXPOSE 3000\nENV NODE_ENV=production\nWORKDIR /app\nCOPY package*.json ./\n\nRUN npm install --only=production && npm cache clean --force\n\n##########################################################################################\n\nFROM base AS dev\n\nENV NODE_ENV=development\n\nRUN npm install --only=development\n\nCMD npm run dev\n\n##########################################################################################\n\nFROM dev AS source\n\nCOPY dist dist\nCOPY templates templates\nCOPY public public\n\nRUN npm run tsc\n\n##########################################################################################\n\nFROM base AS test\n\nCOPY --from=source /app/node_modules /app/node_modules\nCOPY --from=source /app/templates /app/templates\nCOPY --from=source /app/public /app/public\nCOPY --from=source /app/dist /app/dist\n\nCMD npm run test\n\n##########################################################################################\n\nFROM test AS prod\n\nCMD npm start\n`\n```\npackage.json\n```\n`{\n  \"name\": \"nodeserver\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"start\": \"node ./dist/app.js\",\n    \"deploy\": \"git add . && git commit -m Heroku && git push heroku main\",\n    \"tsc\": \"tsc --outDir ./dist\",\n    \"dev\": \"npm run ts-watch\",\n    \"test\": \"npm run jest --runInBand\",\n    \"ts-watch\": \"tsc-watch --project . --outDir ./dist --onSuccess \\\"nodemon ./dist/app.js\\\"\"\n  },\n  \"jest\": {\n    \"testEnvironment\": \"node\"\n  },\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"git+https://github.com/MiquelPiza/nodeserver.git\"\n  },\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"bugs\": {\n    \"url\": \"https://github.com/MiquelPiza/nodeserver/issues\"\n  },\n  \"homepage\": \"https://github.com/MiquelPiza/nodeserver#readme\",\n  \"dependencies\": {\n    \"@sendgrid/mail\": \"^7.4.2\",\n    \"bcryptjs\": \"^2.4.3\",\n    \"express\": \"^4.17.1\",\n    \"handlebars\": \"^4.7.7\",\n    \"jsonwebtoken\": \"^8.5.1\",\n    \"lodash\": \"^4.17.20\",\n    \"mongodb\": \"^3.6.4\",\n    \"mongoose\": \"^5.11.19\",\n    \"multer\": \"^1.4.2\",\n    \"socket.io\": \"^4.0.0\",\n    \"validator\": \"^13.5.2\"\n  },\n  \"devDependencies\": {\n    \"@types/bcryptjs\": \"^2.4.2\",\n    \"@types/express\": \"^4.17.11\",\n    \"@types/jsonwebtoken\": \"^8.5.0\",\n    \"@types/lodash\": \"^4.14.168\",\n    \"@types/mongoose\": \"^5.10.3\",\n    \"@types/multer\": \"^1.4.5\",\n    \"@types/node\": \"^14.14.33\",\n    \"@types/sendgrid\": \"^4.3.0\",\n    \"@types/validator\": \"^13.1.3\",\n    \"env-cmd\": \"^10.1.0\",\n    \"jest\": \"^26.6.3\",\n    \"nodemon\": \"^2.0.7\",\n    \"supertest\": \"^6.1.3\",\n    \"tsc-watch\": \"^4.2.9\",\n    \"typescript\": \"^4.2.3\"\n  },\n  \"engines\": {\n    \"node\": \"15.11.0\"\n  }\n}\n`\n```\ntsconfig.json\n```\n`{\n  \"compilerOptions\": {\n\n    \"target\": \"es5\", \n    \"module\": \"commonjs\",\n    \"strict\": true,\n    \"strictNullChecks\": false,\n    \"esModuleInterop\": true,\n    \"skipLibCheck\": true,\n    \"forceConsistentCasingInFileNames\": true,\n  },\n  \"include\": [\"src\"]\n}\n`\n```\nThis dockerfile works:\n```\n`FROM node:15.11.0 AS build\n\nWORKDIR /app\nCOPY package.json .\nRUN npm install\nADD . .\nRUN npm run tsc\n\nFROM node:15.11.0\nWORKDIR /app\n\nCOPY package.json .\nRUN npm install --production\n\nADD public ./public\nADD templates ./templates\nCOPY --from=build /app/dist dist\n\nEXPOSE 3000\nCMD npm start\n`\n```\nI'm using this dockerfile for reference, from a Docker course: https://github.com/BretFisher/docker-mastery-for-nodejs/blob/master/typescript/Dockerfile\nI don't see what I'm doing wrong, the source stage should have the dev dependencies, among them typescript, so it should be able to run tsc.\nAny help appreciated. Thanks.\nEDIT:\nIn addition to using npm ci instead of npm install, I had to copy tsconfig.json to the working directory (and copy src directory instead of dist, which is created by tsc) for tsc to work properly. This is the modified source stage in the Dockerfile:\n```\n`FROM dev AS source\n\nCOPY src src\nCOPY templates templates\nCOPY public public\nCOPY tsconfig.json tsconfig.json\n\nRUN npm run tsc\n`\n```",
      "solution": "EDIT 2:\nThis issue has been resolved.  If your package-lock.json file is corrupted, you may be able to fix it with the utility fix-has-install-script.\nOriginal Answer:\nUse `npm ci` (or add `package-lock.json` to your `.dockerignore` file, or delete `package-lock.json` in your local environment before building).  The why is answered here.\nEDIT 1:\nHere's what I believe is going on.  Disclaimer, I'm not an expert on `nodejs` or `npm` -- in fact I'm something of a novice.  And all of this is conjecture based on some experiments.\nWhat's going wrong?\n`npm` is not linking the binaries for the dev dependencies via sym links in `node_modules/.bin` because the `package-lock.json` file has gotten into a corrupted state where the (prod) dependencies are in lockfileVersion 2 format, and the dev dependencies are still in lockfileVersion 1 format.\nWhy is this happening?\nNote: Making a bunch of assumptions here.\n\nYour local host using using npm 6, and the docker container is using npm 7.\nBecause of this, the existing `package-lock.json` is in `lockfileVersion: 1` which doesn't include a `bin` section for dependencies that have binaries.  Version 2 does save the `bin:` section, which `npm` must use to determine what binaries to install/link.\n\nWhen you run the production dependency install (e.g. `NODE_ENV=production npm install`), using `npm` version 7, `npm` is upgrading the version of your `package-lock.json` to `lockfileVersion: 2`, part of this includes saving `bin:` sections for the dependencies that install binaries.  Importantly, it updates only the production dependencies.  Now the `package-lock.json` file is corrupted because it claims to be in version 2 format, but all the dev dependencies are either still in version 1 or at least don't have the `bin:` section correctly applied.\n\nWhen you now try to install your dev dependencies, `npm` sees that the `package-lock.json` is in `lockfileVersion: 2`, so it assumes that the dev dependencies have been upgraded as well (but they haven't been, or at least not correctly).  It doesn't find the `bin:` sections because they don't exist and so it doesn't link the binaries to the `node_modules/.bin/` directory.\n\nYou can perform a minimum reproduction of it using this `Dockerfile`:\n```\n`FROM node:14 as npm6\nWORKDIR /app\n# Create a node project using npm 6 and install a dev dependency\n# that contains a binary.\nRUN npm init --yes && \\\n    npm install --save-dev typescript\n\nFROM node:15 as npm7\nCOPY --from=npm6 /app/package*.json /app/\nWORKDIR /app\n# Install production dependencies, then all dependencies. This should\n# link the binaries for typescript in (e.g. tsc) under node_modules/.bin.\nRUN npm install -g npm@7.10.0 && \\\n    npm install --production && \\\n    npm install\n\n# Causes error, tsc not found.\nCMD [\"npx\", \"-c\", \"tsc --version\"]\n`\n```\nI couldn't find an existing bug ticket so I created one here.  Perhaps it will get fixed.",
      "question_score": 29,
      "answer_score": 11,
      "created_at": "2021-04-21T18:10:05",
      "url": "https://stackoverflow.com/questions/67199539/tsc-not-found-in-docker-build"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 76039613,
      "title": "How do I read NPM dependency-conflict errors?",
      "problem": "I'm trying to run `npm install` on a fairly outdated project and keep running into NPM dependency errors. I've ran into hundreds of errors like these before in various projects, but I have yet to find a good guide on how to read them. This thread comes closest but does not really describe a general case, and these docs help me understand the underlying structures of my dependencies, but do not really help me debug.\nBelow is the error I'm running into right now, starting at the bottom, my interpretation is that `@aws-amplify/ui-react@1.2.26` requires `react-dom@\">=16.7.0\"`, but beyond that I don't follow. It looks like `react-dom@18.2.0` requires `react@\"^18.2.0\"`, but I don't see how this is relevant given that `react-dom` isn't even a dependency in my project (at least not one explicitly stated).\nI think that the indentation block means that the error comes from a nested dependency, but I really don't know what to make of this. Similarly, The error above is also related to `@aws-amplify/ui-react@1.2.26`, but I can't tell if it causes the error below, or vice versa (or maybe they are unrelated entirely?).\nI'm looking to get 1) general advice on how to decipher NPM dependency errors into actionable steps, and 2) recommendations on how to fix this specific error.\nAlso note I've tried to `npm update @aws-amplify/ui-react@1.2.26` but I run into similar errors.\n```\n`npm ERR! code ERESOLVE\nnpm ERR! ERESOLVE unable to resolve dependency tree\nnpm ERR!\nnpm ERR! While resolving: myapp@0.0.1\nnpm ERR! Found: react@17.0.1\nnpm ERR! node_modules/react\nnpm ERR!   react@\"17.0.1\" from the root project\nnpm ERR!   peer react@\">= 16.7.0\" from @aws-amplify/ui-react@1.2.26\nnpm ERR!   node_modules/@aws-amplify/ui-react\nnpm ERR!     @aws-amplify/ui-react@\"^1.2.26\" from the root project\nnpm ERR!\nnpm ERR! Could not resolve dependency:\nnpm ERR! peer react@\"^18.2.0\" from react-dom@18.2.0\nnpm ERR! node_modules/react-dom\nnpm ERR!   peer react-dom@\">= 16.7.0\" from @aws-amplify/ui-react@1.2.26\nnpm ERR!   node_modules/@aws-amplify/ui-react\nnpm ERR!     @aws-amplify/ui-react@\"^1.2.26\" from the root project\nnpm ERR!\nnpm ERR! Fix the upstream dependency conflict, or retry\nnpm ERR! this command with --force, or --legacy-peer-deps\nnpm ERR! to accept an incorrect (and potentially broken) dependency resolution.\n`\n```\nAlso if it helps, the full list of my NPM dependencies is here:\n```\n`  \"dependencies\": {\n    \"@aws-amplify/core\": \"^4.3.12\",\n    \"@aws-amplify/ui-react\": \"^1.2.26\",\n    \"@babel/plugin-proposal-decorators\": \"^7.16.7\",\n    \"@flyskywhy/react-native-gcanvas\": \"^2.3.22\",\n    \"@nozbe/watermelondb\": \"^0.24.0\",\n    \"@react-native-async-storage/async-storage\": \"^1.17.6\",\n    \"@react-native-community/checkbox\": \"^0.5.9\",\n    \"@react-native-community/datetimepicker\": \"^4.0.1\",\n    \"@react-native-community/masked-view\": \"^0.1.11\",\n    \"@react-native-community/netinfo\": \"^6.2.1\",\n    \"@react-navigation/bottom-tabs\": \"^5.11.15\",\n    \"@react-navigation/native\": \"^5.9.8\",\n    \"@react-navigation/stack\": \"^5.14.9\",\n    \"@testing-library/react-hooks\": \"^5.1.3\",\n    \"amazon-cognito-identity-js\": \"^5.2.4\",\n    \"aws-amplify\": \"^4.3.12\",\n    \"aws-amplify-react-native\": \"^5.0.5\",\n    \"babel-preset-react-native\": \"^4.0.1\",\n    \"crypto\": \"^1.0.1\",\n    \"eslint-plugin-react\": \"^7.31.0\",\n    \"eslint-plugin-react-native\": \"^4.0.0\",\n    \"formik\": \"^2.2.9\",\n    \"generate-username-from-email\": \"^1.0.2\",\n    \"graphql\": \"^16.2.0\",\n    \"lodash\": \"^4.17.21\",\n    \"moment\": \"^2.29.1\",\n    \"prop-types\": \"^15.8.1\",\n    \"react\": \"17.0.1\",\n    \"react-native\": \"0.64.1\",\n    \"react-native-bootsplash\": \"^3.2.7\",\n    \"react-native-canvas\": \"^0.1.38\",\n    \"react-native-chart-kit\": \"^6.11.0\",\n    \"react-native-confirmation-code-input\": \"^1.0.4\",\n    \"react-native-device-info\": \"^10.5.1\",\n    \"react-native-dotenv\": \"^3.3.1\",\n    \"react-native-elements\": \"^3.4.2\",\n    \"react-native-gesture-handler\": \"^1.10.3\",\n    \"react-native-i18n\": \"^2.0.15\",\n    \"react-native-idle-timer\": \"^2.1.7\",\n    \"react-native-keychain\": \"^7.0.0\",\n    \"react-native-reanimated\": \"2.2.4\",\n    \"react-native-safe-area-context\": \"^3.3.2\",\n    \"react-native-screens\": \"^3.4.0\",\n    \"react-native-svg\": \"^12.1.1\",\n    \"react-native-toast-notifications\": \"^3.2.3\",\n    \"react-native-vector-icons\": \"^8.1.0\",\n    \"react-native-video\": \"^5.2.0\",\n    \"react-native-video-controls\": \"^2.8.1\",\n    \"react-native-vimeo-iframe\": \"^1.0.4\",\n    \"react-native-webview\": \"^11.21.1\",\n    \"react-navigation\": \"^4.4.4\",\n    \"unique-username-generator\": \"^1.0.1\",\n    \"yup\": \"^0.32.11\"\n  },\n  \"devDependencies\": {\n    \"@babel/core\": \"^7.16.7\",\n    \"@babel/runtime\": \"^7.16.7\",\n    \"@react-native-community/eslint-config\": \"^2.0.0\",\n    \"@testing-library/react-native\": \"^7.2.0\",\n    \"@types/react-native-vector-icons\": \"^6.4.10\",\n    \"babel-jest\": \"^26.6.3\",\n    \"eslint\": \"^8.22.0\",\n    \"eslint-config-prettier\": \"^8.5.0\",\n    \"eslint-config-standard\": \"^17.0.0\",\n    \"eslint-plugin-import\": \"^2.26.0\",\n    \"eslint-plugin-n\": \"^15.2.5\",\n    \"eslint-plugin-prettier\": \"^4.2.1\",\n    \"eslint-plugin-promise\": \"^6.0.1\",\n    \"husky\": \"^6.0.0\",\n    \"jest\": \"^26.6.3\",\n    \"jetifier\": \"^1.6.8\",\n    \"metro-react-native-babel-preset\": \"^0.64.0\",\n    \"prettier\": \"^2.7.1\",\n    \"react-test-renderer\": \"17.0.1\"\n  }\n`\n```",
      "solution": "Your specific error is caused by a version number mismatch. You are specifying a version of React for your project (`17.0.1`) in your `package.json`, and also (via `@aws-amplify/ui-react@^1.2.26` which requires `react-dom@>=16.7.0` but is currently using `react-dom@18.2.0`, which in turn requires `react@18.2.0`) loading an incompatible version as a peer dependency. The reason for this is that at some point a version of react-dom was required that is now too high of a version number, and you should be able to fix this by downgrading the version of `react-dom` to match your version of `react` (17.0.1), which will still satisfy the requirement `react-dom@>=16.7.0`.\nIn this case, where the already-resolved dependencies have formed a bit of a knot, you might also solve the problem by deleting your `package-lock.json` and rerunning `npm install`.\nHow to read NPM dependency errors?\nThe good news is, you're on the right lines with your own investigation. You should try getting the dependency graph for your project (`npm list`) and tracing through which modules require which submodules - this can have several layers of nesting. It's also useful to run `npm list [module]` to see what dependencies a given module has. This lets you see at a glance what existing dependencies might be affected when you add a new module. If you run into the same problem again, this might be enough to get you unstuck.\nWe can also take a closer look at some of the error messages you were getting.\n```\n`npm ERR! Could not resolve dependency:\nnpm ERR! peer react@\"^18.2.0\" from react-dom@18.2.0\nnpm ERR! node_modules/react-dom\nnpm ERR!   peer react-dom@\">= 16.7.0\" from @aws-amplify/ui-react@1.2.26\nnpm ERR!   node_modules/@aws-amplify/ui-react\nnpm ERR!     @aws-amplify/ui-react@\"^1.2.26\" from the root project\n`\n```\nThe key things to note here are that the version of `react-dom` with the dependency is not using the same version number as where it's being required. This usually means that there are multiple places where it's a dependency, and NPM has tried to solve all conflicts already, but because NPM lists all places where a conflicting dependency is required, we know that's not the case here. I recommend reading up about the purpose of `package-lock.json` if you want to understand this in more depth.\n`@aws-amplify/ui-react` is specified as coming 'from the root project', so we know it's a top-level dependency. Usually with a version mismatch, if you can trace all the dependencies through to the root dependency, you can look at potentially bumping one or more root dependencies to solve the problem that way.\nLastly, you can pin a specific version of a dependency and overwrite NPM's own version resolution mechanism. This is most useful when you want to use a patched version of a nested dependency without updating everything that depends on that package, e.g. to remove a vulnerability in the project. It's risky if you're not sure what you're doing, though. You can do this with the `overrides` section of the `package.json`.",
      "question_score": 29,
      "answer_score": 3,
      "created_at": "2023-04-18T00:01:44",
      "url": "https://stackoverflow.com/questions/76039613/how-do-i-read-npm-dependency-conflict-errors"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 72384329,
      "title": "Using SSH agent with Docker Compose and Dockerfile",
      "problem": "I am having issues using a private github repo in one of my NestJS apps. When I create the docker image using the `docker build` command, the image is successfully created and everything works fine. However I can't use the Dockerfile with `docker-compose`.\nHere's the part of `Dockerfile` where I use the `BuildKit` mount feature:\n```\n`RUN mkdir -p -m 0600 ~/.ssh && ssh-keyscan github.com >> ~/.ssh/known_hosts\n\nRUN --mount=type=ssh npm install\n\n`\n```\nWhen building the image with `Dockerfile` alone I pass the `--ssh default` argument, like this and it successfully installs the private repo:\n```\n`docker build --ssh default -t CONTAINER_NAME .\n`\n```\nFollowing this article, inside the `docker-compose.yml` file I have included the `$SSH_AUTH_SOCK` like this:\n```\n`environment:\n      - NODE_ENV:${NODE_ENV}\n      - SSH_AUTH_SOCK:${SSH_AUTH_SOCK}\nvolumes:\n      - $SSH_AUTH_SOCK:${SSH_AUTH_SOCK}\n`\n```\nHowever I get this error whenever I try to run `docker-compose up`\n```\n`#11 44.97 npm ERR! code 128\n#11 44.97 npm ERR! An unknown git error occurred\n#11 44.97 npm ERR! command git --no-replace-objects ls-remote ssh://git@github.com/organization/repo.git\n#11 44.97 npm ERR! git@github.com: Permission denied (publickey).\n#11 44.97 npm ERR! fatal: Could not read from remote repository.\n#11 44.97 npm ERR! \n#11 44.97 npm ERR! Please make sure you have the correct access rights\n#11 44.97 npm ERR! and the repository exists.\n`\n```\nAny idea what I am doing wrong?",
      "solution": "They have added the ssh flag as option to the build key in compose: https://github.com/compose-spec/compose-spec/pull/234\n`services:\n  sample:\n    build:\n      context: .\n      ssh:\n        - default\n`",
      "question_score": 29,
      "answer_score": 41,
      "created_at": "2022-05-25T23:22:52",
      "url": "https://stackoverflow.com/questions/72384329/using-ssh-agent-with-docker-compose-and-dockerfile"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 65592541,
      "title": "Webpack when run in terminal it gives an &quot;error error: unknown option &#39;-p&#39;&quot;",
      "problem": "I wanted to run Webpack using npm run build but it gives an error in the terminal\n```\n`error: unknown option '-p'\n[webpack-cli] Run 'webpack --help' to see available commands and options\nnpm ERR! code ELIFECYCLE\nC:\\React Projects\\Webpack\\Project>\n`\n```\n\npackage.json\n```\n`{\n  \"name\": \"project\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"dependencies\": {\n    \"webpack\": \"^5.11.1\"\n  },\n  \"devDependencies\": {\n    \"webpack-cli\": \"^4.3.1\"\n  },\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\",\n    \"build\": \"webpack -p\",\n    \"watch\": \"webpack --watch\"\n  },\n  \"author\": \"\",\n  \"license\": \"ISC\"\n}\n`\n```",
      "solution": "Looks like it was updated to be `--mode production` in a recent release.\nhttps://github.com/webpack/webpack-cli/issues/1934",
      "question_score": 28,
      "answer_score": 66,
      "created_at": "2021-01-06T09:35:08",
      "url": "https://stackoverflow.com/questions/65592541/webpack-when-run-in-terminal-it-gives-an-error-error-unknown-option-p"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 65976322,
      "title": "how to create a readable stream from a remote url in nodejs?",
      "problem": "on nodejs documentation, the streams section says I can do `fs.createReadStream(url || path)`.\nBut, when I actually do that It tells me `Error: ENOENT: no such file or directory`.\nI just want to pipe the video from a readable to a writable stream, But I'm stuck on creating a readable one.\nmy code:\n```\n`const express = require('express')\nconst fs = require('fs')\nconst url = 'https://www.example.com/path/to/mp4Video.mp4'\nconst port = 3000\n\napp.get('/video', (req, res) => {\n    const readable = fs.createReadStream(url)\n})\napp.listen(port, () => {\n    console.log('listening on port ' + port)\n})\n`\n```\nthe ERROR:\n```\n`listening on port 3000\nevents.js:291\n      throw er; // Unhandled 'error' event\n      ^\n\nError: ENOENT: no such file or directory, open 'https://www.example.com/path/to/mp4Video.mp4'\nEmitted 'error' event on ReadStream instance at:\n    at internal/fs/streams.js:136:12\n    at FSReqCallback.oncomplete (fs.js:156:23) {\n  errno: -2,\n  code: 'ENOENT',\n  syscall: 'open',\n  path: 'https://www.example.com/path/to/mp4Video.mp4'\n}\n`\n```\n`PS: https://www.example.com/path/to/mp4Video.mp4 IS NOT THE ACTUAL URL`",
      "solution": "`fs.createReadStream()` does not work with http URLs only `file://` URLs or filename paths.  Unfortunately, this is not described in the `fs` doc, but if you look at the source code for `fs.createReadStream()` and follow what it calls you can find that it ends up calling `fileURULtoPath(url)` which will throw if it's not a `file:` URL.\n```\n`function fileURLToPath(path) {\n  if (typeof path === 'string')\n    path = new URL(path);\n  else if (!isURLInstance(path))\n    throw new ERR_INVALID_ARG_TYPE('path', ['string', 'URL'], path);\n  if (path.protocol !== 'file:')\n    throw new ERR_INVALID_URL_SCHEME('file');\n  return isWindows ? getPathFromURLWin32(path) : getPathFromURLPosix(path);\n}\n`\n```\nIt would suggest using the `got()` library to get yourself a readstream from a URL:\n```\n`const got = require('got');\nconst mp4Url = 'https://www.example.com/path/to/mp4Video.mp4';\n\napp.get('/video', (req, res) => {\n    got.stream(mp4Url).pipe(res);\n});\n`\n```\nMore examples described in this article: How to stream file downloads in Nodejs with Got.\n\nYou can also use the plain `http/https` modules to get the readstream, but I find `got()` to be generally useful at a higher level for lots of http request things so that's what I use.  But, here's code with the https module.\n```\n`const https = require('https');\nconst mp4Url = 'https://www.example.com/path/to/mp4Video.mp4';\n\napp.get(\"/\", (req, res) => {\n    https.get(mp4Url, (stream) => {\n        stream.pipe(res);\n    });\n});\n`\n```\nMore advanced error handling could be added to both cases.",
      "question_score": 28,
      "answer_score": 38,
      "created_at": "2021-01-31T07:22:29",
      "url": "https://stackoverflow.com/questions/65976322/how-to-create-a-readable-stream-from-a-remote-url-in-nodejs"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 77663053,
      "title": "How to enable Object.groupBy() in TypeScript and Node.js",
      "problem": "I am running on Node.js v18.17.1 and TypeScript v5.\nI heard about the new JavaScript method `Object.groupBy()`.\n\r\n\r\n`const inventory = [\n  { name: \"asparagus\", type: \"vegetables\", quantity: 5 },\n  { name: \"bananas\", type: \"fruit\", quantity: 0 },\n  { name: \"goat\", type: \"meat\", quantity: 23 },\n  { name: \"cherries\", type: \"fruit\", quantity: 5 },\n  { name: \"fish\", type: \"meat\", quantity: 22 },\n];\n\nconst result = Object.groupBy(inventory, ({ type }) => type);\nconsole.log(result)`\r\n\r\n\r\n\nWhen I write in my code `Object.groupBy()`, I get the following TypeScript error:\n```\n`Property 'groupBy' does not exist on type 'ObjectConstructor'.ts(2339)\n`\n```\nI have the following TypeScript configuration:\n` \"compilerOptions\": {\n    \"target\": \"es5\",\n    \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\n    // ... etc\n`\nHow can I enable `Object.groupBy()` so that I can use it in my code?",
      "solution": "Here is the PR to enable it: https://github.com/microsoft/TypeScript/pull/56805. It's in state Open at the moment. Hopefully will be merged soon.\nBefore it merged you can use a workaround adding these extension interfaces in your project:\n```\n`/// {projectSrcRoot}/groupBy.d.ts\n\ninterface ObjectConstructor {\n    /**\n     * Groups members of an iterable according to the return value of the passed callback.\n     * @param items An iterable.\n     * @param keySelector A callback which will be invoked for each item in items.\n     */\n    groupBy(\n        items: Iterable,\n        keySelector: (item: T, index: number) => K,\n    ): Partial>;\n}\n\ninterface MapConstructor {\n    /**\n     * Groups members of an iterable according to the return value of the passed callback.\n     * @param items An iterable.\n     * @param keySelector A callback which will be invoked for each item in items.\n     */\n    groupBy(\n        items: Iterable,\n        keySelector: (item: T, index: number) => K,\n    ): Map;\n}\n\nconst basic = Object.groupBy([0, 2, 8], x => x < 5 ? 'small' : 'large');\n`\n```",
      "question_score": 28,
      "answer_score": 14,
      "created_at": "2023-12-14T22:01:34",
      "url": "https://stackoverflow.com/questions/77663053/how-to-enable-object-groupby-in-typescript-and-node-js"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 70725063,
      "title": "TS Jest won&#39;t accept top-level-awaits with NodeJS 16 &amp; TypeScript",
      "problem": "I'm trying to update my NodeJS 12 & TypeScript app to Node16, one of the reasons is the need to use top-level-awaits.\nThe code compiles correctly after the update, but Jest won't accept the specific top-level-await code:\n```\n`ts-jest[ts-compiler] (WARN) src/xxx.ts:11:17 - error TS1378: Top-level 'await' expressions are only allowed when the 'module' option is set to 'es2022', 'esnext', 'system', or 'nodenext', and the 'target' option is set to 'es2017' or higher.\n\n11 const project = await client.getProjectId();\n                   ~~~~~\n FAIL  src/xxx.test.ts\n  \u25cf Test suite failed to run\n\n    Jest encountered an unexpected token\n`\n```\npackage.json:\n`{\n    \"name\": \"functions\",\n    \"scripts\": {\n        \"lint\": \"eslint --ext .js,.ts .\",\n        \"lint:fix\": \"eslint --ext .js,.ts . --fix\",\n        \"build\": \"tsc -b\",\n        \"build:watch\": \"tsc-watch\",\n        \"serve\": \"...\",\n        \"test\": \"env-cmd -f .env.json jest --runInBand --verbose\"\n    },\n    \"type\": \"module\",\n    \"engines\": {\n        \"node\": \"16\"\n    },\n    \"main\": \"lib/index.js\",\n    \"exports\": \"./lib/index.js\",\n    \"dependencies\": {\n        \"test\": \"^1.0.0\"\n    },\n    \"devDependencies\": {\n        \"@google-cloud/functions-framework\": \"^2.1.0\",\n        \"@types/busboy\": \"^1.3.0\",\n        \"@types/compression\": \"1.7.2\",\n        \"@types/cors\": \"^2.8.12\",\n        \"@types/express\": \"^4.17.12\",\n        \"@types/express-serve-static-core\": \"^4.17.28\",\n        \"@types/google-libphonenumber\": \"^7.4.23\",\n        \"@types/jest\": \"^27.4.0\",\n        \"@types/jsonwebtoken\": \"^8.5.7\",\n        \"@types/luxon\": \"^2.0.9\",\n        \"@types/node-zendesk\": \"^2.0.6\",\n        \"@types/sinon\": \"^10.0.6\",\n        \"@types/supertest\": \"^2.0.11\",\n        \"@types/swagger-ui-express\": \"^4.1.3\",\n        \"@types/uuid\": \"^8.3.4\",\n        \"@types/yamljs\": \"^0.2.31\",\n        \"@typescript-eslint/eslint-plugin\": \"^5.9.0\",\n        \"@typescript-eslint/parser\": \"^5.9.0\",\n        \"env-cmd\": \"^10.1.0\",\n        \"eslint\": \"^8.6.0\",\n        \"eslint-config-google\": \"^0.14.0\",\n        \"eslint-config-prettier\": \"^8.3.0\",\n        \"eslint-plugin-import\": \"^2.25.4\",\n        \"eslint-plugin-prettier\": \"^4.0.0\",\n        \"eslint-plugin-react-hooks\": \"^4.2.1-beta-a65ceef37-20211130\",\n        \"jest\": \"^27.4.7\",\n        \"prettier\": \"^2.5.1\",\n        \"sinon\": \"^12.0.1\",\n        \"supertest\": \"^6.2.1\",\n        \"ts-jest\": \"^27.1.3\",\n        \"ts-node\": \"^10.4.0\",\n        \"tsc-watch\": \"^4.6.0\",\n        \"typescript\": \"^4.5.4\"\n    },\n    \"private\": true\n}\n`\ntsconfig.json:\n```\n`{\n  \"compilerOptions\": {\n    \"module\": \"es2022\",\n    \"noImplicitReturns\": true,\n    \"noUnusedLocals\": true,\n    \"outDir\": \"lib\",\n    \"sourceMap\": false,\n    \"strict\": true,\n    \"target\": \"es2021\",\n    \"moduleResolution\": \"Node\",\n    \"resolveJsonModule\": true\n  },\n  \"compileOnSave\": true,\n  \"include\": [\n    \"src\"\n  ],\n  \"ts-node\": {\n    \"moduleTypes\": {\n      \"jest.config.ts\": \"cjs\"\n    }\n  }\n}\n`\n```\njest.config.ts:\n```\n`export default {\n  roots: [\n    '/src'\n  ],\n  setupFiles: ['./src/setupJestEnv.ts'],\n  preset: 'ts-jest',\n  testEnvironment: 'node',\n  testPathIgnorePatterns: ['/node_modules/'],\n  coverageDirectory: './coverage',\n  coveragePathIgnorePatterns: ['node_modules', 'src/database', 'src/test', 'src/types'],\n  globals: { 'ts-jest': { diagnostics: false } },\n};\n`\n```\nI can't really understand what's wrong here. Any idea?",
      "solution": "After some research, I can certainly tell you that we are still far from a reliable solution. The main problem is that the top-level `await` is available\n\nwhen the 'module' option is set to 'es2022', 'esnext', 'system', or 'nodenext', and the 'target' option is set to 'es2017' or higher.\n\nEven if you set both `module` and `target` to `es2022` in the `tsconfig.json`,   you will have to understand and solve a lot of errors, as you have experienced. I have just found a configuration that works for me now, but it might present other problems I am not aware of.\n\n```\n`$ node --version\nv17.7.2\n$ npm list\nmyproject@1.0.0 /home/me/folder\n\u251c\u2500\u2500 @types/jest@27.4.1\n\u251c\u2500\u2500 @types/node@17.0.25\n\u251c\u2500\u2500 config@3.3.7\n\u251c\u2500\u2500 jest@27.5.1\n\u251c\u2500\u2500 sequelize@6.18.0\n\u251c\u2500\u2500 timespan@2.3.0\n\u251c\u2500\u2500 ts-jest@27.1.4\n\u251c\u2500\u2500 ts-node@10.7.0\n\u251c\u2500\u2500 ...\n\u2514\u2500\u2500 typescript@4.6.3\n`\n```\nI have other libraries, but they did not have to be readapted. I am using `jest` for testing and `sequelize` as ORM: they need to be configured appropriately. Let's start from the `package.json`:\n```\n`{\n    \"type\": \"module\",\n    \"scripts\": {\n        \"prestart\": \"npx tsc\",\n        \"start\": \"NODE_ENV=production node --es-module-specifier-resolution=node out/index.js\",\n        \"test\": \"node --no-warnings --experimental-vm-modules node_modules/jest/bin/jest.js tests/\"\n    },\n    ...\n}\n`\n```\n\n`\"type\": \"module\"` is explained here\nThe `start` command in the `scripts` section needs the option `--es-module-specifier-resolution=node`, necessary to enable ES Modules instead of the default CommonJS modules.\n(For Jest only): `--no-warnings` is not mandatory, but `--experimental-vm-modules` is.\n\nAs for the Jest configurations:\n```\n`$ cat jest.config.ts\nimport type { Config } from '@jest/types';\n\nconst config: Config.InitialOptions = {\n    globals: {\n        \"ts-jest\": {\n            useESM: true\n        }\n    },\n    preset: 'ts-jest/presets/default-esm',\n    roots: [\"tests/\"],\n    modulePathIgnorePatterns: [\n        \"/node_modules/\"\n    ]\n};\n\nexport default config;\n`\n```\nYou can add new properties, of course, but this is more or less the minimal configuration. You can find the other presets here (in case you need them), while the `globals` section for `ts-jest` is furtherly explained here.\n\nLet's see the `tsconfig.json`, which is a bit more complex:\n```\n`$ cat tsconfig.json\n{\n    \"ts-node\": {\n        \"moduleTypes\": {\n            \"jest.config.ts\": \"cjs\"\n        }\n    },\n    \"compilerOptions\": {\n        \"lib\": [\"ES2021\"],\n        \"module\": \"ESNext\",\n        \"esModuleInterop\": true,\n        \"moduleResolution\": \"node\",\n        \"target\": \"ESNext\",\n        \"outDir\": \"out\",\n        \"resolveJsonModule\": true\n    },\n    \"compileOnSave\": true,\n    \"include\": [\"src/\"],\n    \"exclude\": [\"node_modules\", \"**/*.spec.ts\"]\n}\n`\n```\nAgain, it is more or less the minimal configuration, I guess `module` and `target` properties can be initialized with the other alternatives in the error shown when trying to use the top-level `await`, but I am not sure they are all working.\n\nNow to the worst part, the packages' compatibility with ES modules. I have not studied enough to tell you when an `import` from a certain package needs to be adapted, but I will provide you with some examples.\nBuilt-in libraries/`config`/`timespan`\nBuilt-in libraries should be ok as they are. In my project I am also using `config` and `timespan`:\n\n`timespan`: `import * as timespan from \"timespan\"`. The `Timespan` object is accessible using `new timespan.Timespan(...)` for example.\n`config`: `import config from 'config'`.\n`util`: with built-in packages, I think you can import any exported function as if you are using the CommonJS syntax. For instance, `import { format } from 'util'`.\n\n`sequelize` (and many others...)\nI am using `sequelize` with typescript, but I had to change the `import` syntax. The error I have encountered is:\n\nSyntaxError: The requested module 'sequelize' does not provide an export named 'DataTypes' at ...\n\nThe problem is that experimental modules do not support named exports. The new `import` syntax depends on what you need to import:\n\nfor types, you can still import them as before, like `import { Type1, Type2 } from 'your_library'`\nfor classes (but I think everything that comes from the value space), you first need to import a default object, and then use the object destructuring to extract the needed values.\n\nFor example, with `sequelize`:\n```\n`import Sequelize, \n    { InferAttributes, InferCreationAttributes, CreationOptional }\n    from 'sequelize';                         // InferAttributes, InferCreationAttributes, CreationOptional are types \nconst { Op, DataTypes, Model } = Sequelize    // these are classes\n\nclass UserModel extends Model, \n    InferCreationAttributes> \n{\n    declare id: CreationOptional\n    ...\n}\n`\n```\n\nAdditional sources\n\nCan't use top-level await\nMisleading error that module does not provide export\nError importing with --experimental-modules\nTop-level Await for Typescript in 2022 (useful to configure `nodemon` too)",
      "question_score": 28,
      "answer_score": 12,
      "created_at": "2022-01-15T21:13:10",
      "url": "https://stackoverflow.com/questions/70725063/ts-jest-wont-accept-top-level-awaits-with-nodejs-16-typescript"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 67169683,
      "title": "dyld: Library not loaded: /usr/local/opt/icu4c/lib/libicui18n.67.dylib",
      "problem": "I had this error when trying to commit.\n```\n`dyld: Library not loaded: /usr/local/opt/icu4c/lib/libicui18n.67.dylib\n  Referenced from: /usr/local/bin/node\n  Reason: image not found\n.husky/pre-commit: line 4: 20559 Abort trap: 6           yarn lint-staged\nhusky - pre-commit hook exited with code 134 (error)\n`\n```\nIt seems to be coming from node and its icu4c dependency",
      "solution": "I just needed to do `brew reinstall icu4c`, see https://gist.github.com/berkedel/d1fc6d13651c16002f64653096d1fded",
      "question_score": 27,
      "answer_score": 85,
      "created_at": "2021-04-19T23:39:57",
      "url": "https://stackoverflow.com/questions/67169683/dyld-library-not-loaded-usr-local-opt-icu4c-lib-libicui18n-67-dylib"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 72417847,
      "title": "Insomnia : Error: SSL peer certificate or SSH remote key was not OK",
      "problem": "I added my own certificate to a node.js express server for testing purposes. Then I attempted to contact the post from Insomnia, but I received an error message.\n`Error: SSL peer certificate or SSH remote key was not OK`\nThe server code:\n```\n`const express = require('express');\nconst path = require('path');\nconst fs = require(\"fs\");\nvar https = require('https');\n\nvar privateKey = fs.readFileSync('cert/server.key');\nvar certificate = fs.readFileSync('cert/server.crt');\n\nvar credentials = {key: privateKey, cert: certificate};\nconst app = express()\nconst port = 8000\n// app.use(express.urlencoded()); \napp.use(express.json());\n// Routes\napp.get('/', (req, res) => {\n  res.sendFile(path.join(__dirname, './public/index.html'));\n})\n \napp.post('/signin', (req, res) => {\n  console.log(req.body.username);\n  methods.signin();\n  res.end();\n})\n\napp.use(express.static('public'))\nvar httpsServer = https.createServer(credentials, app);\nhttpsServer.listen(port);\nconsole.log('Server started at https://localhost:' + port);\n\n`\n```",
      "solution": "Go into your setting/preferences and under Request/Response uncheck Validate certificates",
      "question_score": 27,
      "answer_score": 71,
      "created_at": "2022-05-28T19:31:27",
      "url": "https://stackoverflow.com/questions/72417847/insomnia-error-ssl-peer-certificate-or-ssh-remote-key-was-not-ok"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 68338838,
      "title": "how to get the ip address of the client from server side in next.js app?",
      "problem": "I want to get the user time zone and location to render a server-side page depending on the location and time zone but I can't get the user IP address from the request or get the localhost IP address (127.0.0.1). so what should I do ?",
      "solution": "You can use something like request-ip package. Then in your API route:\n```\n`import requestIp from 'request-ip'\n\nexport default async function myRoute(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  const detectedIp = requestIp.getClientIp(req)\n}\n`\n```",
      "question_score": 27,
      "answer_score": 23,
      "created_at": "2021-07-11T20:06:32",
      "url": "https://stackoverflow.com/questions/68338838/how-to-get-the-ip-address-of-the-client-from-server-side-in-next-js-app"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 68694195,
      "title": "How do I fix CLIENT_MISSING_INTENTS error?",
      "problem": "I started learning about discord.js, but now I am facing this issue.\nI tried some googling, but I couldn't manage to fix it.\n```\n`const Discord = require('discord.js');\n// const Discord = require('discord.js');\n\n// Using Intents class\nconst client = new Discord.Client();\n\nclient.on('message', (msg) => {\n  // Send back a reply when the specific command has been written by a user.\n  if (msg.content === '!hello') {\n    msg.reply('Hello, World!');\n  }\n});\n\nclient.login('my_token');\n`\n```\nThis is the error I am getting:",
      "solution": "You need to specify the events which you want your bot to receive using gateway intents.\nInstead of\n```\n`const client = new Discord.Client();\n`\n```\nUse\n```\n`const client = new Discord.Client({ intents: [Enter intents here] })\n`\n```\nFor example\nDiscord.js v14:\n```\n`const client = new Discord.Client({ intents: [\n  Discord.GatewayIntentBits.Guilds,\n  Discord.GatewayIntentBits.GuildMessages\n]})\n`\n```\nDiscord.js v13:\n`const client = new Discord.Client({ intents: [\"GUILDS\", \"GUILD_MESSAGES\"] })`\n\nHere's another useful page: Gateways\n\nIntents help you control which events your bot receives. See Privileged Intents for more information.\nYou need node.js 16.6 or higher to use discord.js13. `npm install node@16` in shell.\nThe list of client events are under the events tab at Client.",
      "question_score": 27,
      "answer_score": 35,
      "created_at": "2021-08-07T18:25:57",
      "url": "https://stackoverflow.com/questions/68694195/how-do-i-fix-client-missing-intents-error"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 74698021,
      "title": "Installing node: /lib64/libm.so.6: version `GLIBC_2.27&#39; not found (required by node) error on linux",
      "problem": "I have followed this - How to install node.tar.xz file in linux\nin the end while doing node --version I am getting these errors -\n\nWhat should be done next here?, not able to find proper steps with respect to my scenario.",
      "solution": "This error happens when you install Node on an operating system that has a version of GLIBC that is lower than Node can support. For example, Node v18 supports GLIBC v2.7 or later. When you attempt to install Node v18.x on any Linux OS that has GLIBC v2.6 or lower, you will get such errors.\nTo see the version of GLIBC that your operating system has, execute the ldd command on the terminal:\n```\n`$ ldd --version\n`\n```\nI can suggest three options to resolve this issue:\n\nEither install Node from source code. This will allow you to recompile\nOr install an older version of Node that your OS can support\nOr upgrade your Linux OS to a newer version.\n\nReference: Install Node from source code",
      "question_score": 27,
      "answer_score": 33,
      "created_at": "2022-12-06T07:11:10",
      "url": "https://stackoverflow.com/questions/74698021/installing-node-lib64-libm-so-6-version-glibc-2-27-not-found-required-by-n"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 72442682,
      "title": "npm ERR! code ERR_SOCKET_TIMEOUT npm ERR! network Socket timeout",
      "problem": "This the error:\n```\n`npm ERR! code ERR_SOCKET_TIMEOUT\nnpm ERR! network Socket timeout\nnpm ERR! network This is a problem related to network connectivity.\nnpm ERR! network In most cases you are behind a proxy or have bad network settings.\nnpm ERR! network \nnpm ERR! network If you are behind a proxy, please make sure that the\nnpm ERR! network 'proxy' config is set properly.  See: 'npm help config'\n`\n```\nI ran `npm cache clean --force`\nDeleted `node_modules` and `package-lock.json` and run `npm install` but still got me that error",
      "solution": "Try this answer\nor run `npm i -g npm@8.5.1`\ni think it's an issue with npm version , 8.5.1 solves the problem in most cases\nbasically try earlier versions and i think the problem will be solved",
      "question_score": 26,
      "answer_score": 29,
      "created_at": "2022-05-31T07:34:43",
      "url": "https://stackoverflow.com/questions/72442682/npm-err-code-err-socket-timeout-npm-err-network-socket-timeout"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 71865726,
      "title": "How to resolve &quot;TypeError: (0 , dayjs_1.default) is not a function&quot;",
      "problem": "This is my `logger.ts` file, where the error below happens:\n```\n`import logger from \"pino\";\nimport dayjs from \"dayjs\";\n\nconst log = logger({\n  prettyPrint: true,\n  base: {\n    pid: false,\n  },\n  timestamp: () => `,\"time\":\"${dayjs().format()}\"`,\n});\n\nexport default log;\n`\n```\nERROR:\n```\n`yarn dev\nyarn run v1.22.17\nwarning package.json: License should be a valid SPDX license expression\nwarning ..\\..\\..\\..\\package.json: No license field\n$ ts-node-dev --respawn --transpile-only src/app.ts\n[INFO] 19:09:45 ts-node-dev ver. 1.1.8 (using ts-node ver. 9.1.1, typescript ver. 4.6.3)\nTypeError: (0 , dayjs_1.default) is not a function\n    at timestamp (C:\\Users\\A\\Desktop\\desktop\\base_code\\back_bc_node\\src\\utils\\logger.ts:9:37)\n    at pino (C:\\Users\\A\\Desktop\\desktop\\base_code\\back_bc_node\\node_modules\\pino\\pino.js:147:26)\n    at Object. (C:\\Users\\A\\Desktop\\desktop\\base_code\\back_bc_node\\src\\utils\\logger.ts:4:19)\n    at Module._compile (node:internal/modules/cjs/loader:1103:14)\n    at Module._compile (C:\\Users\\A\\Desktop\\desktop\\base_code\\back_bc_node\\node_modules\\source-map-support\\source-map-support.js:568:25)\n    at Module.m._compile (C:\\Users\\A\\AppData\\Local\\Temp\\ts-node-dev-hook-15803171947249184.js:69:33)\n    at Module._extensions..js (node:internal/modules/cjs/loader:1155:10)\n    at require.extensions. (C:\\Users\\A\\AppData\\Local\\Temp\\ts-node-dev-hook-15803171947249184.js:71:20)\n    at Object.nodeDevHook [as .ts] (C:\\Users\\A\\Desktop\\desktop\\base_code\\back_bc_node\\node_modules\\ts-node-dev\\lib\\hook.js:63:13)\n    at Module.load (node:internal/modules/cjs/loader:981:32)\n[ERROR] 19:09:46 TypeError: (0 , dayjs_1.default) is not a function\n(node:10308) [PINODEP008] PinoWarning: prettyPrint is deprecated, look at https://github.com/pinojs/pino-pretty for alternatives.\n(Use `node --trace-warnings ...` to show where the warning was created)\n`\n```\nIt was working on my previous app, but I don't know why do I get this error for my new application. How can I resolve this problem?",
      "solution": "Day.js does not export a default entry like that; use `import * as dayjs from 'dayjs'` to import all of its exports (as you are trying to do).",
      "question_score": 26,
      "answer_score": 48,
      "created_at": "2022-04-14T04:13:31",
      "url": "https://stackoverflow.com/questions/71865726/how-to-resolve-typeerror-0-dayjs-1-default-is-not-a-function"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 66724333,
      "title": "Is there a way to log the node-fetch request?",
      "problem": "So I'm trying to use some APIs in node.js using node-fetch and I would like to log the final request that is being sent to the server, but I can't find any way how to do it. Can you help me please? Here is the code:\n```\n`const fs = require('fs');\nconst fetch = require('node-fetch');\nconst https = require('https');\n\nconst reqUrl = 'https://endpoint.com';\nconst headers = {\n    'Accept': 'application/json',\n    'Content-Type': 'application/json',\n    'Digest': 'SHA-256=47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU=',\n    'Date': 'Sat, 20 Mar 2021 15:42:18 GMT',\n    'X-Request-ID': 'request_id',\n    'Authorization': 'Bearer my_bearer',\n    'Signature': 'my_signature'\n};\n\nconst certs = {\n    key: fs.readFileSync('path_to_key'),\n    cert: fs.readFileSync('path_to_cert')\n};\n\nasync function getAccounts() {\n    const options = {\n        cert: certs.cert,\n        key: certs.key,\n        rejectUnauthorized: false\n    };\n\n    const sslConfiguredAgent = new https.Agent(options);\n\n    try {\n        // here is the problem. How to view the final request header?\n        fetch(reqUrl, {\n            method: 'GET',\n            headers: headers,\n            agent: sslConfiguredAgent\n        }).then(response => {\n            const headers = response.headers;\n            console.log(headers); // I know that this log outputs the RESPONSE headers, I want to find out how to output the REQUEST headers \n        });\n    } catch (error) {\n        console.log(error);\n    }\n};\n\ngetAccounts(); // function call\n`\n```",
      "solution": "The `node-fetch` library itself does not appear to have any debugging or logging ability built into it (by perusing the source on github).  It is, however built on top of the `http` library which does have some logging/debugging capabilities.\nIt won't show you the exact outgoing request, but it will show you all the data is has gathered for the request right before it's constructed into the final http request.  For example, if you set `NODE_DEBUG=http` in your environment before running your program, then you can get output like this:\n```\n`HTTP 20624: call onSocket 0 0\nHTTP 20624: createConnection google.com:80: {\n  protocol: 'http:',\n  slashes: true,\n  auth: null,\n  host: 'google.com',\n  port: 80,\n  hostname: 'google.com',\n  hash: null,\n  search: null,\n  query: null,\n  pathname: '/',\n  path: null,\n  href: 'http://google.com/',\n  method: 'GET',\n  headers: [Object: null prototype] {\n    'Some-Header': [ 'someValue' ],\n    Accept: [ '*/*' ],\n    'User-Agent': [ 'node-fetch/1.0 (+https://github.com/bitinn/node-fetch)' ],\n    'Accept-Encoding': [ 'gzip,deflate' ],\n    Connection: [ 'close' ]\n  },\n  agent: undefined,\n  servername: 'google.com',\n  _agentKey: 'google.com:80:'\n}\nHTTP 20624: sockets google.com:80: 1 1\nHTTP 20624: outgoing message end.\n(node:20624) Warning: Setting the NODE_DEBUG environment variable to 'http' can expose sensitive data (such as passwords, tokens and authentication headers) in the resulting log.\n(Use `node --trace-warnings ...` to show where the warning was created)\nHTTP 20624: requestTimeout timer moved to req\nHTTP 20624: AGENT incoming response!\nHTTP 20624: call onSocket 0 0\nHTTP 20624: createConnection www.google.com:80: {\n  protocol: 'http:',\n  slashes: true,\n  auth: null,\n  host: 'www.google.com',\n  port: 80,\n  hostname: 'www.google.com',\n  hash: null,\n  search: null,\n  query: null,\n  pathname: '/',\n  path: null,\n  href: 'http://www.google.com/',\n  method: 'GET',\n  headers: [Object: null prototype] {\n    'Some-Header': [ 'someValue' ],\n    Accept: [ '*/*' ],\n    'User-Agent': [ 'node-fetch/1.0 (+https://github.com/bitinn/node-fetch)' ],\n    'Accept-Encoding': [ 'gzip,deflate' ],\n    Connection: [ 'close' ]\n  },\n  agent: undefined,\n  servername: 'www.google.com',\n  _agentKey: 'www.google.com:80:'\n}\nHTTP 20624: sockets www.google.com:80: 1 2\nHTTP 20624: outgoing message end.\nHTTP 20624: CLIENT socket onClose\nHTTP 20624: removeSocket google.com:80: writable: false\nHTTP 20624: HTTP socket close\nHTTP 20624: requestTimeout timer moved to req\nHTTP 20624: AGENT incoming response!\ndone\nHTTP 20624: AGENT socket.destroySoon()\nHTTP 20624: CLIENT socket onClose\nHTTP 20624: removeSocket www.google.com:80: writable: false\nHTTP 20624: HTTP socket close\n`\n```\nAnd, if you set:\n```\n`NODE_DEBUG=http,net,stream\n`\n```\nYou will get even more info.  I still don't see any way with this debugging to get the exact data that is being sent out for the http request, though the data from the http module shows you what will be assembled into that request.  You might have to use either a proxy or a network logger to see the exact stream being sent to the server.\nNote: As of Sep 2023, newer versions of nodejs are using Trace Events for some modules such as http instead of the DEBUG flags.",
      "question_score": 26,
      "answer_score": 61,
      "created_at": "2021-03-20T18:09:51",
      "url": "https://stackoverflow.com/questions/66724333/is-there-a-way-to-log-the-node-fetch-request"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 71534322,
      "title": "HTTP Stream using Axios (Node JS)",
      "problem": "I'm trying to stream price data via HTTP and I use axios to make normal REST API requests, but I don't know how to handle 'Transfer Encoding': 'chunked' type of requests.\nThis code just hangs and doesn't produce any error so assume it's working but not able to process the response:\n```\n`const { data } = await axios.get(`https://stream.example.com`, {headers: \n{Authorization: `Bearer ${token}`, 'Content-Type': 'application/octet- \nstream'}})\n\nconsole.log(data) // execution hangs before reaching here\n`\n```\nAppreciate your help.\nWORKING SOLUTION:\nAs pointed out from the answer below, we need to add a responseType: stream as an axios option and also add an event listener on the response.\nWorking code:\n```\n`const response = await axios.get(`https://stream.example.com`, {\n  headers: {Authorization: `Bearer ${token}`}, \n  responseType: 'stream'\n});\n\nconst stream = response.data\nstream.on('data', data => { \n  data = data.toString()\n  console.log(data) \n})\n`\n```",
      "solution": "FYI, sending the `content-type` header for a GET request is meaningless.  The content-type header applies to the BODY of the http request and there is no body for a GET request.\nWith the `axios()` library, if you want to get direct access to the response stream, you use the `responseType` option to tell Axios that you want access to the raw response stream:\n```\n`const response = await axios.get('https://stream.example.com', {\n    headers: {Authorization: `Bearer ${token}`, \n    responseType: 'stream'\n});\n\nconst stream = response.data;\n\nstream.on('data', data => {\n    console.log(data);\n});\n\nstream.on('end', () => {\n    console.log(\"stream done\");\n});\n`\n```\nAxios document reference here.",
      "question_score": 26,
      "answer_score": 46,
      "created_at": "2022-03-19T00:59:57",
      "url": "https://stackoverflow.com/questions/71534322/http-stream-using-axios-node-js"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 76253884,
      "title": "npm ci command failing with &quot;Cannot read property &#39;@angular/animations&#39; of undefined&quot;",
      "problem": "While performing docker build for my Angular project, In the npm ci step, I'm getting below error:\n`Cannot read property '@angular/animations' of undefined`\nAs there is no proper error, we are unable to find the solution.\nVersions of package and node:\n\n@angular/animations - 15.2.9\nNode.Js - 18.14.2\nNPM - 9.5\nAngular Cli - 15.2.8\n\nWhat I have tried till now:\n\nCross check package.json file for Animations module\nTry downgrading the @angular/animations version\nDeleting package-lock.json file and node_module directory\nDeleting cache and tried\n\nDockerFile:\n```\n`FROM docker-images.artifactory.dummydomain.com/db/node:14.18-alpine as build\n\nWORKDIR /usr/src/app\nCOPY . /usr/src/app\nRUN npm install -g @angular/cli@15.2.8\nRUN npm ci \nRUN ng build --configuration=test\nUSER node\nCOPY --chown=node:node . .\n`\n```\nPackage.json Files dependencies:\n```\n`    \"@angular/animations\": \"^15.2.9\",\n    \"@angular/cdk\": \"^15.2.9\",\n    \"@angular/common\": \"^15.2.9\",\n    \"@angular/compiler\": \"^15.2.9\",\n    \"@angular/core\": \"^15.2.9\",\n    \"@angular/forms\": \"^15.2.9\",\n    \"@angular/localize\": \"^15.2.9\",\n    \"@angular/material\": \"^15.2.9\",\n    \"@angular/material-moment-adapter\": \"^15.2.9\",\n    \"@angular/platform-browser\": \"^15.2.9\",\n    \"@angular/platform-browser-dynamic\": \"^15.2.9\",\n    \"@angular/router\": \"^15.2.9\",\n    \"angular-in-memory-web-api\": \"^0.9.0\",\n    \"core-js\": \"^3.6.2\",\n    \"export-from-json\": \"^1.7.0\",\n    \"hammerjs\": \"^2.0.8\",\n    \"material-design-icons-iconfont\": \"^6.7.0\",\n    \"moment\": \"^2.24.0\",\n    \"ng-uikit-pro-standard\": \"^1.0.0\",\n    \"ngx-spinner\": \"^15.0.1\",\n    \"rxjs\": \"~6.6.7\",\n    \"socket.io-client\": \"^4.5.4\",\n    \"sweetalert2\": \"^11.6.9\",\n    \"tslib\": \"^2.0.0\",\n    \"vkbeautify\": \"^0.99.3\",\n    \"zone.js\": \"~0.11.4\"\n  },\n  \"devDependencies\": {\n    \"@angular-devkit/build-angular\": \"^15.2.8\",\n    \"@angular/cli\": \"^15.2.8\",\n    \"@angular/compiler-cli\": \"^15.2.9\",\n    \"@angular/language-service\": \"^15.2.9\",\n    \"@types/jasmine\": \"~3.6.0\",\n    \"@types/jasminewd2\": \"~2.0.3\",\n    \"@types/node\": \"^12.11.1\",\n    \"codelyzer\": \"^6.0.0\",\n    \"jasmine-core\": \"~3.8.0\",\n    \"jasmine-spec-reporter\": \"~5.0.0\",\n    \"karma\": \"~6.4.2\",\n    \"karma-chrome-launcher\": \"~3.1.0\",\n    \"karma-coverage-istanbul-reporter\": \"~3.0.2\",\n    \"karma-jasmine\": \"~4.0.0\",\n    \"karma-jasmine-html-reporter\": \"^1.7.0\",\n    \"protractor\": \"~7.0.0\",\n    \"ts-node\": \"~7.0.0\",\n    \"tslint\": \"~6.1.0\",\n    \"typescript\": \"~4.9.5\"\n  }\n`\n```\nIt would be great if someone can help. TIA!",
      "solution": "This error occurs if npm tries to process a lockfile which it cannot understand (the error message is not helpful at all). The format of the lockfile is changing over time, and npm marks the current version with the `lockfileVersion` parameter in the lockfile:\n\nNo version provided: an \"ancient\" shrinkwrap file from a version of npm prior to npm v5.\n1: The lockfile version used by npm v5 and v6.\n2: The lockfile version used by npm v7 and v8. Backwards compatible to v1 lockfiles.\n3: The lockfile version used by npm v9 and above. Backwards compatible to npm v7.\n\nYou are using v14.18 as a base image, which is shipped with npm v6. In your system you have npm v9, so the `lockfileVersion` is 3. As you can read in the above list, this format is not compatible with npm v6.\nThe recommended fix would be to update the version of the Node base image to v16 (npm 8) or v18 (npm 9). Alternatively, you could perform an `npm install` using npm v8, and commit + push the resulting lockfile.",
      "question_score": 26,
      "answer_score": 51,
      "created_at": "2023-05-15T14:03:41",
      "url": "https://stackoverflow.com/questions/76253884/npm-ci-command-failing-with-cannot-read-property-angular-animations-of-undef"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 79372334,
      "title": "Blocked request. This host (&quot;frontend_web&quot;) is not allowed",
      "problem": "When building vite react in docker-compose application, a message appears when opening the web-site page\n\nBlocked request. This host (\"frontend_web\") is not allowed. To allow this host, add \"frontend_web\" to `server.allowedHosts` in vite.config.js.\n\nI tried to use `vite-plugin-allowed-hosts` but it gives me an error when building the docker-container\n\n[ERROR] Failed to resolve entry for package \"vite-plugin-allowed-hosts\". The package may have incorrect main/module/exports specified in its package.json. [plugin externalize-deps]",
      "solution": "A recent Vite update (6.0.11, to my knowledge) has introduced changes that \"break\" setups using proxies. To resolve this, you need to configure `allowedHosts` in your Vite configuration as told.\nIn your case this should work:\n`server: {\n  allowedHosts: ['frontend_web'],\n}\n`\nor\n`server: {\n  allowedHosts: true\n}\n`",
      "question_score": 26,
      "answer_score": 40,
      "created_at": "2025-01-20T19:29:46",
      "url": "https://stackoverflow.com/questions/79372334/blocked-request-this-host-frontend-web-is-not-allowed"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 69090357,
      "title": "ng --version showing The current version of Node (16.8.0) is not supported by Angular",
      "problem": "I just installed the latest version of node(16.8) using nvm and angular/cli(12.2).\nBut when i run\n`ng --version`\nIt shows the following:\nWarning: The current version of Node (16.8.0) is not supported by Angular.\nI tried to downgrade the node and  installed node 14.15 but ng is not working anymore.\nShould i ignore the warning and use node 16?.\nWhy is ng not working with node 14.15?.\nPS: I am using nvm to manage the different node versions",
      "solution": "You can use Angular CLI with Node >=14 version. Command not working, because you switched to another nvm node version with it's own installed packages. You have to install angular cli again on your node 14.15. `npm install -g @angular/cli`",
      "question_score": 26,
      "answer_score": 12,
      "created_at": "2021-09-07T16:50:19",
      "url": "https://stackoverflow.com/questions/69090357/ng-version-showing-the-current-version-of-node-16-8-0-is-not-supported-by-an"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 71152952,
      "title": "What does npm ERR! code ELSPROBLEMS mean?",
      "problem": "Building a node project, using serverless\nFirstly I get the error\n```\n`Error:\nError: npm ls -prod -json -depth=1 failed with code 1\n  at ChildProcess. (/Users/jrobens/NetBeansProjects/azuron/winpay/winpay- \n`\n```\nuploader/node_modules/serverless-webpack/lib/utils.js:91:16)\nTo find our more information I enter npm ls -prod -json -depth=1 and get\n```\n`npm ERR! code ELSPROBLEMS\nnpm ERR! invalid: serverless@3.2.1 \n/my-project/node_modules/serverless\n{\n`\n```\nIt looks as though webpack worked\n```\n`webpack compiled successfully in 4581 ms\n`\n```\nAbout the environment: node-14, typescript, aws\n```\n`\u251c\u2500\u2500 @serverless/typescript@3.2.0\n\u251c\u2500\u2500 @types/serverless@3.0.0\n\u251c\u2500\u2500 serverless-apigw-binary@0.4.4\n\u251c\u2500\u2500 serverless-certificate-creator@1.6.0\n\u251c\u2500\u2500 serverless-dynamodb-local@0.2.40\n\u251c\u2500\u2500 serverless-http@2.7.0\n\u251c\u2500\u2500 serverless-iam-roles-per-function@3.2.0\n\u251c\u2500\u2500 serverless-plugin-aws-alerts@1.7.4\n\u251c\u2500\u2500 serverless-prune-plugin@2.0.1\n\u251c\u2500\u2500 serverless-s3-local@0.6.21\n\u251c\u2500\u2500 serverless-webpack@5.6.1\n`\n```",
      "solution": "Fixing this\n```\n`npm ls --omit=dev json \n`\n```\nproduces a json list of the packages. The -depth=1 flag brought an error to light. There was an invalid package.\nFind the invalid package by\n```\n`npm ls\n`\n```\nand fix any error messages.\nIn my case there was an old serverless plugin that had a dependency of a different version of serverless.",
      "question_score": 26,
      "answer_score": 13,
      "created_at": "2022-02-17T06:31:33",
      "url": "https://stackoverflow.com/questions/71152952/what-does-npm-err-code-elsproblems-mean"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 66049860,
      "title": "Cannot connect to MongoDB because of wrong URI",
      "problem": "I was trying to run mongoDB on node server\nFull Code here from MongoDB:\n\nMy mongo version: 4.4.3\nNode version: v15.7.0\n\nI've imported get started code from MongoDB, and here's the code:\n```\n`const { MongoClient } = require(\"mongodb\");\n// Connection URI\nconst uri =\n  \"mongodb+srv://sample-hostname:27017/?poolSize=20&writeConcern=majority\";\n// Create a new MongoClient\nconst client = new MongoClient(uri);\nasync function run() {\n  try {\n    // Connect the client to the server\n    await client.connect();\n    // Establish and verify connection\n    await client.db(\"admin\").command({ ping: 1 });\n    console.log(\"Connected successfully to server\");\n  } finally {\n    // Ensures that the client will close when you finish/error\n    await client.close();\n  }\n}\nrun().catch(console.dir);\n`\n```\nOn terminal, when i run \"node app.js\", it throws me following error:\n```\n`> (node:79653) Warning: Accessing non-existent property 'MongoError' of\n> module exports inside circular dependency (Use `node --trace-warnings\n> ...` to show where the warning was created) MongoParseError: URI does\n> not have hostname, domain name and tld\n>     at parseSrvConnectionString (/home/harmony/Desktop/FruitsProject/node_modules/mongodb/lib/core/uri_parser.js:50:21)\n>     at parseConnectionString (/home/harmony/Desktop/FruitsProject/node_modules/mongodb/lib/core/uri_parser.js:594:12)\n>     at connect (/home/harmony/Desktop/FruitsProject/node_modules/mongodb/lib/operations/connect.js:284:3)\n>     at /home/harmony/Desktop/FruitsProject/node_modules/mongodb/lib/mongo_client.js:225:5\n>     at maybePromise (/home/harmony/Desktop/FruitsProject/node_modules/mongodb/lib/utils.js:681:3)\n>     at MongoClient.connect (/home/harmony/Desktop/FruitsProject/node_modules/mongodb/lib/mongo_client.js:221:10)\n>     at run (/home/harmony/Desktop/FruitsProject/app.js:12:18)\n>     at Object. (/home/harmony/Desktop/FruitsProject/app.js:21:1)\n`\n```",
      "solution": "The error `Accessing non-existent property 'MongoError' of > module exports inside circular dependency` is caused by a bug in mongodb 3.6.4\nIt's already reported here\nBack to version 3.6.3 works for me:\n```\n`npm uninstall mongodb --save\n`\n```\nInstall version 3.6.3\n```\n`npm i mongodb@3.6.3\n`\n```",
      "question_score": 25,
      "answer_score": 40,
      "created_at": "2021-02-04T17:34:45",
      "url": "https://stackoverflow.com/questions/66049860/cannot-connect-to-mongodb-because-of-wrong-uri"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 66409161,
      "title": "How to tell Jest that spaces are in fact, spaces?",
      "problem": "Given the code:\n`import { getLocale } from './locale';\n\nexport const euro = (priceData: number): string => {\n  const priceFormatter = new Intl.NumberFormat(getLocale(), {\n    style: 'currency',\n    currency: 'EUR',\n  });\n\n  return priceFormatter.format(priceData);\n}\n\nexport default null;\n`\nand the related test:\n`import { euro } from './currency';\n\ntest('euro', () => {\n  expect(euro(42)).toBe(\"42,00 \u20ac\");\n});\n`\nJest says:\n\nEven if I copy-paste the expected result of Jest to my assert, the error is still the same.\nSo the question is: Why the hell? :-D",
      "solution": "You want this test to assert:\n```\n`\"42,00\\xa0\u20ac\"\n`\n```\n\nIt's not a space (different ascii code / unicode). According to a jest issue about string comparison being incorrect `Intl.NumberFormat` uses a non-breaking space.\nAnd as pointed out in a similar question's answer:\n\nNumberFormat use small non-breaking space (`\\u202f`) for thousand separator and normal non-breaking space beforece currency (`\\xa0`).",
      "question_score": 25,
      "answer_score": 44,
      "created_at": "2021-02-28T13:36:47",
      "url": "https://stackoverflow.com/questions/66409161/how-to-tell-jest-that-spaces-are-in-fact-spaces"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 67525595,
      "title": "Cross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at https://localhost:8000/users/login",
      "problem": "I am trying to make a post message to  the /users/signup end and this error occurs every time.\nHere is my code from server.js\n```\n`const https = require('https');\nconst fs = require('fs');\nvar path = require('path');\nconst  mongoose = require('mongoose');\nconst express = require('express');\nvar cors = require('cors') //\nvar session = require('express-session');\nvar FileStore = require('session-file-store')(session); // data base for storing information about sessions.\nvar cookieParser = require('cookie-parser');\nvar logger = require('morgan'); // gia ta htpp errors, requests logger\nmongoose.set('useFindAndModify', false);\nmongoose.set('useUnifiedTopology',true);\nconst url = 'mongodb://localhost:27017/database';\nmongoose.set('useNewUrlParser',true);\nmongoose.set('useCreateIndex',true);\nmongoose.connect(url)\n\n.then(connection => {\n  console.log('Connected to MongoDB DB')\n})\n.catch(error => {\nconsole.log(error.message)\n})\nvar app = express();\napp.use(cors());\nvar passport = require('passport');\nvar authenticate = require('./authenticate');\nconst usersRouter = require('./routes/users');\nconst options = {\n  key: fs.readFileSync('./key.pem','utf8'),\n  cert: fs.readFileSync('./server.crt','utf8')\n};\n\napp.use(function(req, res, next) { // kolpa magkiorika poy de ta kserw\n    res.header(\"Access-Control-Allow-Origin\", \"*\");\n    res.header(\"Access-Control-Allow-Headers\", \"Origin, X-Requested-With, Content-Type, Accept, Access-Control-Allow-Headers, Access-Control-Request-Method, Access-Control-Request-Headers, Authorization\");\n    res.header('Access-Control-Allow-Methods', 'GET, PUT, POST, DELETE, PATCH, OPTIONS');\n    next();\n});\napp.set('views', path.join(__dirname, 'views'));\napp.set('view engine', 'jade');\napp.use(logger('dev'));\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use(session({\n  name: 'session-id',\n  secret: '12345-67890-09876-54321', // digital sign for cookie.( Server secret key to sign the cookie)\n  saveUninitialized: false,\n  resave: false,\n  store: new FileStore(({logFn: function(){}}))\n}));\napp.use(passport.initialize());\napp.use(passport.session());\n\napp.use('/users',usersRouter);\n\nfunction auth (req, res, next) {\n  if (!req.user) {\n    var err = new Error('You are not authenticated!');\n    err.status = 403;\n    return next(err);\n  }\n  else {\n        next();\n  }\n}\napp.use(auth);\nconst port = 8000;\nserver = https.createServer(options, app).listen(port, function(){\n    console.log(`Server started on port ${port}`);\n});\n //error  handler \nmodule.exports = server;\n`\n```\nI have add   lines of code to allow cors on requests but the error keep exists. When i am using postman everything works fine, and the cors headers are in the response headers.\nHere it is , the Register Component\n```\n`import React, { Component,useState } from 'react';\nimport '../css/Register.css';\nimport axios from 'axios';\nimport {withRouter} from 'react-router';\nimport url from '../services/url';\n\nclass Register extends Component{\n    constructor(props){\n        super(props);\n        this.state = {\n            username: \"\",\n            password: \"\",\n            password2: \"\",\n            phone: \"\",\n            email: \"\",\n            userType: \"\"\n        };\n        this.handleChange = this.handleChange.bind(this);\n        this.handleSubmit = this.handleSubmit.bind(this);\n    }\n\n    handleChange(event) {\n        this.setState({ [event.target.name]: event.target.value })\n    }\n\n    handleSubmit = async event => {\n      event.preventDefault();\n        \n        if(this.state.password === this.state.password2){\n            try {\n                const response = await fetch(`https://localhost:8000/users/signup`, {\n                    method: 'POST',\n                    mode: 'cors',\n                    headers: {\n                        'Content-Type': 'application/json',\n                    },\n                    body: JSON.stringify({\n                        username: this.state.username,\n                        password: this.state.password,\n                        phone: this.state.phone,\n                        email: this.state.email,\n                        userType: this.state.userType\n\n                    })\n                })\n                const jsoned = await response.json();\n            } catch (error) {\n                console.log(error);\n                console.log('asdfasfasfa');\n            }\n        }else{\n            alert('passwords do not match')\n        }    \n  };\nrender(){\n      .... html code..\n    }\nexport default withRouter(Register);\n`\n```\nAnd the full error message\nCross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at https://localhost:8000/users/signup. (Reason: CORS request did not succeed).\nTypeError: NetworkError when attempting to fetch resource.\nthe signup route.\n```\n`router.post('/signup', (req, res, next) => {\n  User.register(new User({username: req.body.username, email:req.body.email, phone:req.body.phone, userType:req.body.userType}), \n    req.body.password, (err, user) => {\n    if(err) {\n      console.log(err)\n      res.statusCode = 500;\n      res.setHeader('Content-Type', 'application/json');\n      res.json({err: err});\n    }\n    else {\n      passport.authenticate('local')(req, res, () => {\n        res.statusCode = 200;\n        res.setHeader('Content-Type', 'application/json');\n        res.json({success: true, status: 'Registration Successful!'});\n      });\n    }\n  });\n});\n`\n```\nRequest headers when i send post request\n```\n`OPTIONS /users/signup HTTP/1.1\nHost: localhost:8000\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:88.0) Gecko/20100101 Firefox/88.0\nAccept: */*\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate, br\nAccess-Control-Request-Method: POST\nAccess-Control-Request-Headers: content-type\nReferer: http://localhost:3000/\nOrigin: http://localhost:3000\nConnection: keep-alive\n`\n```",
      "solution": "So, after days of searching , i figured it out that Mozzila Firefox was blocking self signed certificates. I had to add an exception for localhost. :)",
      "question_score": 25,
      "answer_score": 6,
      "created_at": "2021-05-13T22:08:51",
      "url": "https://stackoverflow.com/questions/67525595/cross-origin-request-blocked-the-same-origin-policy-disallows-reading-the-remot"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "node.js",
      "question_id": 66168437,
      "title": "TypeORM findOne with nested relations",
      "problem": "I am having some issues performing a nested find query with TypeORM. Here's the basic code:\n`    const { completionId } = req?.params;\n    const user = req.user;\n\n    const retrievedCompletion = await getRepository(\n      CompletionGoogleSearch\n    ).findOne({\n      relations: ['run', 'run.user'],\n      where: {\n        id: completionId,\n        // run: { user: { id: user.id } }, // This is the code that breaks the function\n      },\n    });\n\n    console.log(retrievedCompletion?.run.user.id);\n    console.log(user.id);\n`\nIt looks to me like there's nothing out of order, and that the query should run. Any idea on what I am doing wrong? I know I can get around this issue by writing a querybuilder query or using raw SQL\u2013I am just curious to understand if there's a flaw in my code.",
      "solution": "The feature you're asking about doesn't supported on typeorm yet (Feb 2021).\nCheckout this issue that was opened on 2018.",
      "question_score": 25,
      "answer_score": 3,
      "created_at": "2021-02-12T09:22:01",
      "url": "https://stackoverflow.com/questions/66168437/typeorm-findone-with-nested-relations"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 72336177,
      "title": "Error: req#logout requires a callback function",
      "problem": "can't able to find solution of this tried everything, i am just new in using passport. Error: req#logout requires a callback function  i have coded this before but that time i have not received any error, but this time dont know why i am getting this, i have also read passport docs and tried every solutions\nthanks in advance\n```\n`\n\n    \n        \n            \n        \n        \n            \n                 Logout\n            \n        \n    \n\n`\n```\n\njs code\n```\n`require('dotenv').config();\nconst express = require(\"express\");\nconst bodyParser = require(\"body-parser\");\nconst ejs = require(\"ejs\");\nconst mongoose = require(\"mongoose\");\nconst session = require('express-session');\nconst passport = require('passport');\nconst passportLocalMongoose = require('passport-local-mongoose');\nconst GoogleStrategy = require('passport-google-oauth20').Strategy;\nconst findOrCreate = require('mongoose-findorcreate');\n\nconst app = express();\n\napp.use(express.static(\"public\"));\napp.set('view engine', 'ejs');\napp.use(bodyParser.urlencoded({\n    extended: true\n}));\n\napp.use(session({\n    secret: process.env.SECRET,\n    resave: false,\n    saveUninitialized: false\n}))\n\napp.use(passport.initialize());\napp.use(passport.session());\n\nmongoose.connect(\"#DB\")\n\nconst accountsdata = new mongoose.Schema({\n    email: String,\n    password: String,\n    googleId: String,\n    facebookId: String,\n    combo: String,\n    date: String,\n    price: String,\n    accountemail: String\n\n});\n\naccountsdata.plugin(passportLocalMongoose);\naccountsdata.plugin(findOrCreate);\n\nconst data = new mongoose.model(\"amazonprime\", accountsdata);\n\npassport.use(data.createStrategy());\n\npassport.serializeUser(function (user, cb) {\n    process.nextTick(function () {\n        cb(null, { id: user.id, username: user.username });\n    });\n});\n\npassport.deserializeUser(function (user, cb) {\n    process.nextTick(function () {\n        return cb(null, user);\n    });\n});\n\npassport.use(new GoogleStrategy({\n    clientID: process.env.CLIENT_ID,\n    clientSecret: process.env.CLIENT_SECRET,\n    callbackURL: \"http://localhost:3000/auth/google/home\",\n    userProfileURL: \"https://www.googleapis.com/oauth2/v3/userinfo\"\n},\n    function (accessToken, refreshToken, profile, cb) {\n        console.log(profile)\n        data.findOrCreate({ googleId: profile.id }, function (err, user) {\n            return cb(err, user);\n        });\n    }\n));\n\napp.get(\"/\", (req, res) => {\n    res.render(\"login\");\n});\n\napp.get('/auth/google',\n    passport.authenticate(\"google\", { scope: [\"profile\"] })\n);\n\napp.get(\"/auth/google/home\",\n    passport.authenticate(\"google\", { failureRedirect: \"/\" }),\n    function (req, res) {\n\n        res.redirect(\"/home\");\n    });\n\napp.get(\"/signup\", (req, res) => {\n    res.render(\"signup\");\n});\n\napp.get(\"/home\", function (req, res) {\n    if (req.isAuthenticated()) {\n        res.render(\"home\");\n\n    } else {\n        res.redirect(\"/\");\n    }\n})\n\napp.get(\"/logout\", (req, res) => {\n    req.logout();\n    res.redirect(\"/\");\n});\n\napp.post(\"/signup\", (req, res) => {\n\n    data.register({ username: req.body.username }, req.body.password, function (err, user) {\n        if (err) {\n            console.log(err);\n            res.redirect(\"/signup\");\n        } else {\n            passport.authenticate(\"local\")(req, res, function () {\n                res.redirect(\"/home\");\n            })\n        }\n    })\n})\n\napp.post(\"/\", function (req, res) {\n\n    const user = new data({\n        username: req.body.username,\n        password: req.body.password\n    })\n    req.login(user, function (err) {\n        if (err) {\n            console.log(err);\n        } else {\n            passport.authenticate(\"local\")(req, res, function () {\n                res.redirect(\"/home\")\n            })\n        }\n    })\n});\n\napp.get(\"/logout\", (req, res) => {\n    req.logout();\n    res.redirect(\"/\");\n});\n\napp.listen(3000, function () {\n    console.log(\"Server started on port 3000.\");\n});\n`\n```\n\nerror\n```\n`Error: req#logout requires a callback function\n    at IncomingMessage.req.logout.req.logOut (E:\\Web Development\\Data Handler\\node_modules\\passport\\lib\\http\\request.js:65:44)\n    at E:\\Web Development\\Data Handler\\app.js:105:9\n    at Layer.handle [as handle_request] (E:\\Web Development\\Data Handler\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (E:\\Web Development\\Data Handler\\node_modules\\express\\lib\\router\\route.js:144:13)\n    at Route.dispatch (E:\\Web Development\\Data Handler\\node_modules\\express\\lib\\router\\route.js:114:3)\n    at Layer.handle [as handle_request] (E:\\Web Development\\Data Handler\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at E:\\Web Development\\Data Handler\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (E:\\Web Development\\Data Handler\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (E:\\Web Development\\Data Handler\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at SessionStrategy.strategy.pass (E:\\Web Development\\Data Handler\\node_modules\\passport\\lib\\middleware\\authenticate.js:346:9)\n`\n```",
      "solution": "Since version 0.6.0 (which was released only a few days ago by the time of writing this), `req.logout` is asynchronous. This is part of a larger change that averts session fixation attacks.\nSee the release announcement:\n\nThe other major change is that that `req.logout()` is now an asynchronous function, whereas previously it was synchronous. For instance, a logout route that was previously:\n`app.post('/logout', function(req, res, next) {\n  req.logout();\n  res.redirect('/');\n});\n`\nshould be modified to:\n`app.post('/logout', function(req, res, next) {\n  req.logout(function(err) {\n    if (err) { return next(err); }\n    res.redirect('/');\n  });\n});\n`\n\nJared Hanson mentioned that the docs are not up to date yet:\n\nIt is necessary in order to improve the security of how sessions are managed during logout. Upgrading to 0.6.0 will require applications to pass a callback to `req#logout`. I'm still working on updating the docs and examples.",
      "question_score": 52,
      "answer_score": 128,
      "created_at": "2022-05-22T11:08:45",
      "url": "https://stackoverflow.com/questions/72336177/error-reqlogout-requires-a-callback-function"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 71185664,
      "title": "Why does Zod make all my schema fields optional?",
      "problem": "I am using Zod inside my Express & TypeScript & Mongoose API project and when trying to validate my user input against the user schema it returns types conflicts:\n```\n`  Argument of type '{ firstName?: string; lastName?: string; password?: string; passwordConfirmation?: string; email?: string; }' is not assignable to parameter of type 'UserInput'.\n      Property 'email' is optional in type '{ firstName?: string; lastName?: string; password?: string; passwordConfirmation?: string; email?: string; }' but required in type 'UserInput'\n`\n```\nHere is the schema def:\n```\n`export const createUserSchema = object({\n  body: object({\n    firstName: string({\n      required_error: 'First name is required',\n    }),\n    lastName: string({\n      required_error: 'Last name is required',\n    }).nonempty(),\n    password: string({\n      required_error: 'Password is required',\n    })\n      .nonempty()\n      .min(6, 'Password too short - should be 6 chars minimum'),\n\n    passwordConfirmation: string({\n      required_error: 'Confirm password is required',\n    }),\n    email: string({\n      required_error: 'Email is required',\n    })\n      .email('Not a valid email')\n      .nonempty(),\n  }).refine((data) => data.password === data.passwordConfirmation, {\n    message: 'Passwords do not match',\n    path: ['passwordConfirmation'],\n  }),\n});\n\nexport type CreateUserInput = Omit, 'body.passwordConfirmation'>;\n\nexport interface UserInput {\n  email: string;\n  firstName: string;\n  lastName: string;\n  password: string;\n}\n`\n```\nHow to make these Zod schema fields all not optional as it is making it optional by default?",
      "solution": "This might be caused by not using `strict: true` in TypeScript compiler options as referred to installation section in README file.\nFollowing basic tsconfig.json file would fix that:\n`{\n    \"compilerOptions\": {\n        \"strict\": true   \n    }\n}\n`",
      "question_score": 42,
      "answer_score": 65,
      "created_at": "2022-02-19T14:56:57",
      "url": "https://stackoverflow.com/questions/71185664/why-does-zod-make-all-my-schema-fields-optional"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 71643703,
      "title": "TypeScript: can only be default-imported using the &#39;esModuleInterop&#39; flag",
      "problem": "I've the following `index.ts`:\n`import { User } from \"./datatypes\"\nimport express from 'express';\n\nconsole.log(\"hello world\")\n`\nThis is my `package.json`:\n`{\n  \"name\": \"simple_app\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"start\": \"tsc index.ts && node index.js\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"dependencies\": {\n    \"dotenv\": \"^16.0.0\",\n    \"express\": \"^4.17.3\"\n  },\n  \"devDependencies\": {\n    \"@types/express\": \"^4.17.13\",\n    \"@types/node\": \"^17.0.23\",\n    \"ts-node\": \"^10.7.0\",\n    \"typescript\": \"^4.6.3\"\n  }\n}\n`\nAnd this is my `tsconfig.json`:\n`  {\n    \"compilerOptions\": {\n      \"module\": \"commonjs\",\n      \"esModuleInterop\": true,\n      \"resolveJsonModule\": true,\n      \"target\": \"es6\",\n      \"moduleResolution\": \"node\",\n      \"sourceMap\": true,\n      \"outDir\": \"dist\"\n    },\n    \"lib\": [\"es2015\"]\n  }\n`\nWhen I write `npm run start`, I obtain:\n```\n` Module '\"/mnt/c/Users/raffa/Desktop/simple_app/node_modules/@types/express/index\"' can only be default-imported using the 'esModuleInterop' flag\n\n2 import express from 'express';\n         ~~~~~~~\n\n  node_modules/@types/express/index.d.ts:133:1\n    133 export = e;\n        ~~~~~~~~~~~\n    This module is declared with using 'export =', and can only be used with a default import when using the 'esModuleInterop' flag.\n`\n```\nHow can I solve this problem?",
      "solution": "If you call `tsc` from the command line with a specific file path, it will ignore your `tsconfig.json`\nTypescript docs (https://www.typescriptlang.org/docs/handbook/tsconfig-json.html):\n\nWhen input files are specified on the command line, tsconfig.json files are ignored.\n\nThis means that the `esModuleInterop` part of tsconfig.json will have no effect if you call `tsc index.ts`.\nIt's possible to work around it by using `import * as express from 'express';`, but there may be other issues arising from ignored TS configs.\nOne problem with `tsc -w && node index.js` (from one of the comments) is that the `-w` will make it wait instead of terminating by itself, which means you won't get to the part after the \"&&\".  So, you won't get to the `node index.js` part.\n(But at least this time, `tsc` doesn't get one specific file, therefore the config is not ignored)\nAlso, in your config, the `outDir` is set to `dist`, so the compiled file will go there. So, you should use the following instead:\n`tsc && node ./dist/index.js`",
      "question_score": 28,
      "answer_score": 40,
      "created_at": "2022-03-28T09:21:02",
      "url": "https://stackoverflow.com/questions/71643703/typescript-can-only-be-default-imported-using-the-esmoduleinterop-flag"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 75586474,
      "title": "Mongoose stopped accepting callbacks for some of its functions",
      "problem": "I've been using callbacks for .save() and .findOne() for a few days now and just today I encounter these errors:\n```\n`throw new MongooseError('Model.prototype.save() no longer accepts a callback')\n\nMongooseError: Model.prototype.save() no longer accepts a callback\n`\n```\nand\n`MongooseError: Model.findOne() no longer accepts a callback`\nIt's really awkward given that callbacks are still accepted in the docs at least for .findOne().\n```\n`app.post(\"/register\", (req, res) => {\n    const newUser = new User({\n        email: req.body.username,\n        password: req.body.password\n    });\n\n    newUser.save((err) => {\n        if (err) console.log(err)\n        else res.render(\"secrets\");\n    });\n});\n`\n```\nThis is what used to work for me, using express and mongoose. Please let me know how to fix it.",
      "solution": "MongooseError: Model.find() no longer accepts a callback\n\nSince the callback function has been deprecated from now onwards.\nIf you are using these functions with callbacks, use async/await or promises if async functions don't work for you.\n```\n`app.get(\"/articles\", async (req, res) => {\n  try {\n    const articles = await Article.find({ });\n    res.send(articles);\n    console.log(articles);\n  } catch (err) {\n    console.log(err);\n  }\n});\n`\n```",
      "question_score": 25,
      "answer_score": 34,
      "created_at": "2023-02-28T00:18:28",
      "url": "https://stackoverflow.com/questions/75586474/mongoose-stopped-accepting-callbacks-for-some-of-its-functions"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 72233594,
      "title": "Stripe API &quot;No valid payment method types for this Payment Intent.&quot;",
      "problem": "As you can imagine I'm currently setting up the payment API with using Stripe.\nProblem is, I've never done such thing before and am following the docs pretty much one by one.\nSo I require stripe using (100% the right!) key.\n```\n`const stripe = require(\"stripe\")(\n  \"keyhere\"\n);\n`\n```\ncreate the intent in a method...\n```\n`const paymentIntent = stripe.paymentIntents.create({\n  amount: process.env.AUDIT_PRICE,\n  currency: \"eur\",\n  automatic_payment_methods: { enabled: true },\n});\n`\n```\ncall that method on a certain express route:\n```\n`exports.createNewCashOrder = async (req, res) => {\n  const intent = await paymentIntent();\n  res.json({ client_secret: intent.client_secret });\n};\n`\n```\nThe rest is irrelevant for now, since my backend server doesn't even start on localhost.\nActually it's live for like 0.001 seconds and than crashes with this error:\n\nStripeInvalidRequestError: No valid payment method types for this\nPayment Intent. Please ensure that you have activated payment methods\ncompatible with your chosen currency in your dashboard\n\nIt also sends back a large error object, where at the end it says that pretty much everything (also the payment methods) are undefined.\n\nNow on my dashboard, I did activate card payment, but it obviously somehow does not recognize it...\nAny ideas what I've done wrong?\nGlad for any help!",
      "solution": "This is just a hunch but is your amount too small?\nhttps://stripe.com/docs/api/payment_intents/create#create_payment_intent-amount\nIf that is the case you get this error because you specified\n```\n`automatic_payment_methods: {enabled: true}\n`\n```\nStripe is looking for a payment method that can handle an amount lower than the minimum so that's why you get this error. Try specifying a payment method and see if you get a different error message that indicates the amount is too low.\nRemember the docs state the amount is represented as\n\nA positive integer representing how much to charge in the smallest currency unit (e.g., 100 cents to charge $1.00 or 100 to charge \u00a5100, a zero-decimal currency).\n\nUpdate\nAs of the Stripe API version 2023-08-16 `automatic_payment_methods` are enabled by default.  This means you may hit this error without specifying `automatic_payment_methods` in your request to the Payment Intent API if you are on the latest version.",
      "question_score": 24,
      "answer_score": 58,
      "created_at": "2022-05-13T19:46:19",
      "url": "https://stackoverflow.com/questions/72233594/stripe-api-no-valid-payment-method-types-for-this-payment-intent"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 65680842,
      "title": "&quot;Error: MongooseError: Operation `users.insertOne()` buffering timed out after 10000ms&quot;,",
      "problem": "I'm running MongoDB Atlas on node express and I got this error when I tested with postman.\n```\n`const express = require('express');\nconst cors = require('cors');\nconst mongoose = require('mongoose');\n\nrequire('dotenv').config();\n\nconst app = express();\nconst port = process.env.PORT || 5000;\n\napp.use(cors());\napp.use(express.json());\n\nconst uri = process.env.ATLAS_URI;\nmongoose.connect(uri, { useNewUrlParser: true, useCreateIndex: true }\n);\nconst connection = mongoose.connection;\nconnection.once('open', () => {\n  console.log(\"MongoDB database connection established successfully\");\n})\n\nconst exercisesRouter = require('./routes/exercises');\nconst usersRouter = require('./routes/users');\n\napp.use('/exercises', exercisesRouter);\napp.use('/users', usersRouter);\n\napp.listen(port, () => {\n    console.log(`Server is running on port: ${port}`);\n});\n`\n```\nThis is my `.env`, I'm guessing the problem might be here too, Kindly help:\n```\n`ATLAS_URI=mongodb+srv://userone:useronepassword1234@cluster0.swye5.mongodb.net/?retryWrites=true&w=majority\n`\n```",
      "solution": "In my case, I had to go to Atlas, and reset my whitelisted IP to the correct address.\nThen I restarted my local server and tried posting again on postman... And it worked!",
      "question_score": 23,
      "answer_score": 17,
      "created_at": "2021-01-12T10:06:06",
      "url": "https://stackoverflow.com/questions/65680842/error-mongooseerror-operation-users-insertone-buffering-timed-out-after-1"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 72374103,
      "title": "Running a simple express app with ts-node-dev and get error: False expression: Non-string value passed to `ts.resolveTypeReferenceDirective`",
      "problem": "I am new to typescript and express. I am trying to run the simplest express app using `ts-node-dev`, but get the following error.\n`> ./node_modules/.bin/ts-node-dev src/index.ts                                                 16:07:40\n[INFO] 16:07:42 ts-node-dev ver. 1.1.8 (using ts-node ver. 9.1.1, typescript ver. 4.7.2)\nCompilation error in /home/lht/microservice/ticketing/auth/src/index.ts\nError: Debug Failure. False expression: Non-string value passed to `ts.resolveTypeReferenceDirective`, likely by a wrapping package working with an outdated `resolveTypeReferenceDirectives` signature. This is probably not a problem in TS itself.\n    at Object. (/home/lht/microservice/ticketing/auth/src/index.ts:1:7)\n    at Module._compile (internal/modules/cjs/loader.js:778:30)\n    at Module._compile (/home/lht/microservice/ticketing/auth/node_modules/source-map-support/source-map-support.js:568:25)\n    at Module.m._compile (/tmp/ts-node-dev-hook-8101223397369532.js:69:33)\n    at Module._extensions..js (internal/modules/cjs/loader.js:789:10)\n    at require.extensions.(anonymous function) (/tmp/ts-node-dev-hook-8101223397369532.js:71:20)\n    at Object.nodeDevHook [as .ts] (/home/lht/microservice/ticketing/auth/node_modules/ts-node-dev/lib/hook.js:63:13)\n    at Module.load (internal/modules/cjs/loader.js:653:32)\n    at tryModuleLoad (internal/modules/cjs/loader.js:593:12)\n    at Function.Module._load (internal/modules/cjs/loader.js:585:3)\n[ERROR] 16:07:42 Error: Debug Failure. False expression: Non-string value passed to `ts.resolveTypeReferenceDirective`, likely by a wrapping package working with an outdated `resolveTypeReferenceDirectives` signature. This is probably not a problem in TS itself.\n`\nThe following is my `index.ts` file.\n`import express from \"express\";\nimport { json } from \"body-parser\";\n\nconst app = express();\napp.use(json());\n\napp.listen(3000, () => {\n  console.log(\"Listening on port 3000!\");\n});\n`\nThis is my `package.json` file\n`{\n  \"name\": \"auth\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"start\": \"ts-node src/index.ts\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {},\n  \"dependencies\": {\n    \"@types/express\": \"^4.17.13\",\n    \"@types/node\": \"^17.0.35\",\n    \"express\": \"^4.18.1\",\n    \"ts-node\": \"^10.8.0\",\n    \"ts-node-dev\": \"^1.1.8\",\n    \"typescript\": \"^4.7.2\"\n  }\n}\n`\nI wonder if there are some configurations that I am doing are wrong. Thanks in advance.",
      "solution": "Just change the `ts-node-dev` version from `1.1.8` to `2.0.0-0` in my `package.json` file, then run `npm install` again, and the error disappears.\n`{\n  \"name\": \"auth\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"start\": \"ts-node src/index.ts\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {},\n  \"dependencies\": {\n    \"@types/express\": \"^4.17.13\",\n    \"@types/node\": \"^17.0.35\",\n    \"express\": \"^4.18.1\",\n    \"ts-node\": \"^10.8.0\",\n    \"ts-node-dev\": \"^2.0.0-0\",\n    \"typescript\": \"^4.7.2\"\n  }\n}\n`",
      "question_score": 22,
      "answer_score": 18,
      "created_at": "2022-05-25T10:14:45",
      "url": "https://stackoverflow.com/questions/72374103/running-a-simple-express-app-with-ts-node-dev-and-get-error-false-expression-n"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 66287172,
      "title": "Tokenization is skipped for long lines for performance reasons. The length of a long line can be configured via `editor.maxTokenizationLineLength`",
      "problem": "I'm at a loss here. I have a Node.js server built for my project and out of nowhere, I started getting this error when I try to run the server in VSCode:\nTokenization is skipped for long lines for performance reasons. The length of a long line can be configured via `editor.maxTokenizationLineLength`.\nI had edited some of my functions in my controller before this started. I discarded all changes but the error still persists. I don't understand what has changed for this to happen. Any advice would be greatly appreciated.\nMy code is here if you want to take a look\nhttps://github.com/Kevinclane/timeclock",
      "solution": "Apparently, just toggling the options for breakpoints on caught and uncaught exceptions causes it to fail... Doesn't make sense, but it works now.",
      "question_score": 22,
      "answer_score": 2,
      "created_at": "2021-02-20T02:43:29",
      "url": "https://stackoverflow.com/questions/66287172/tokenization-is-skipped-for-long-lines-for-performance-reasons-the-length-of-a"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 73379691,
      "title": "Unexpected LAMBDA_RUNTIME Failed to post handler success response. Http response code: 413 error",
      "problem": "So I have a serverless express application running in a Lambda. One request (response size around 800KB) keeps returning a `LAMBDA_RUNTIME Failed to post handler success response. Http response code: 413.` error.\nI thought it could be due to some internal logic timing out, and added logs, and all the fetch and processing takes maximum 6 seconds, but the lamdba still returns this error.\nThese are the response headers\n```\n`x-amz-cf-pop: YTO50-C3\nx-amzn-errortype: InternalServerErrorException\nx-amzn-requestid: f291230-342-4324-324-cb7df188944c\nx-cache: Error from cloudfront\n`\n```\nThe response size is definitely not too big, I am returning a response with right data, no errors are being thrown in the logs. Any idea why this could be happening? Also any suggestions on how I can debug this issue? Everything of course works in local, but is there a way for me debug the actual lambda? The logs I added indicate that the full process completes, yet somehow there is an error being returned.\nUpdated my serverless.yml config\n```\n`service: my-service\nvariablesResolutionMode: 20210326\nuseDotenv: true\n\ncustom:\n  serverless-offline:\n    useChildProcesses: true\n  webpack:\n    webpackConfig: ./webpack.config.js\n    packager: \"yarn\"\n    includeModules: true\n  prune:\n    automatic: true\n    includeLayers: true\n    number: 3\n  customDomain:\n    domainName: \"abc.com\"\n    basePath: \"val\"\n    stage: ${someval}\n    createRoute53Record: true\n\nplugins:\n  - serverless-domain-manager\n  - serverless-webpack\n  - serverless-prune-plugin\n  - serverless-webpack-prisma\n  - serverless-offline\n\nprovider:\n  lambdaHashingVersion: \"20201221\"\n  name: aws\n  runtime: nodejs14.x\n  region: us-east-1\n  timeout: 30\n  apiGateway:\n    minimumCompressionSize: 1024 \n  iamRoleStatements:\n    - Effect: Allow\n      Action: ssm:Get*\n      Resource:\n        - \"abc/${opt:stage}/backend/*\"\n        - \"abc/${opt:stage}/services/*\"\n    - Effect: Allow\n      Action: kms:Decrypt\n      Resource: \"*\"\n    - Effect: \"Allow\"\n      Action: s3:PutObject\n      Resource: \"abc/*\"\n    - Effect: \"Allow\"\n      Action:\n        - sns:Publish\n      Resource: \"*\"\n\n  environment:\n    - myvars: 'abc'\n\nfunctions:\n  graphql:\n    handler: src/index.graphqlHandler\n    events:\n      - http:\n          path: /graphql\n          method: options\n      - http:\n          path: /graphql\n          method: get\n      - http:\n          path: /graphql\n          method: post\n`\n```",
      "solution": "This error is usually due to hitting the Lambda limit for response payload.\nCurrently, AWS Lambdas have a hard limit for invocation payloads of:\n\n6MB for Synchronous requests and\n256KB for Asynchronous requests,\n\nAccording to the documentation:\n\nhttps://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-limits.html\nKeep in mind that this is a hard limit and cannot be increased.\nCurrently (2022), if you need more than this limit, you'll have two options that I can think of\n\nuse another stack, for example ECS\nyou can compress (gzip, brotli, etc) your response inside the lambda and uncompress in the consumer. If you're using API Gateway to expose your lambda, you'll have to set the appropriate header.\n\nPersonally, I've experienced similar issues even before reaching this threshold, so it can be hard to calculate exactly the size of your payload.",
      "question_score": 21,
      "answer_score": 45,
      "created_at": "2022-08-16T22:01:09",
      "url": "https://stackoverflow.com/questions/73379691/unexpected-lambda-runtime-failed-to-post-handler-success-response-http-response"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 71635179,
      "title": "Type &#39;string&#39; has no properties in common with type &#39;FindOneOptions&lt;User&gt;&#39;",
      "problem": "I am trying to build a backend with express.js. I now have the following problem:\n```\n`import { Request, Response } from \"express\";\nimport { getManager } from \"typeorm\";\nimport { User } from \"../entity/user.entity\";\n\nexport const GetUser = async (req: Request, res: Response) => {\n  const repository = getManager().getRepository(User);\n\n  const { password, ...user } = await repository.findOne(req.params.id);\n\n  res.send(user);\n};\n`\n```\nThe following error always occurs:\n(parameter) req: Request>\nType 'string' has no properties in common with type 'FindOneOptions'.ts(2559)\n\nrouter.ts\n```\n`router.get(\"/api/users/:id\", AuthMiddleware, GetUser);\n`\n```\nuser.entity.ts\n```\n`import {\n  Column,\n  Entity,\n  JoinColumn,\n  ManyToOne,\n  PrimaryGeneratedColumn,\n} from \"typeorm\";\nimport { Role } from \"./role.entity\";\n\n@Entity()\nexport class User {\n  @PrimaryGeneratedColumn()\n  id: number;\n  @Column()\n  first_name: string;\n  @Column()\n  last_name: string;\n  @Column({\n    unique: true,\n  })\n  email: string;\n  @Column()\n  password: string;\n\n  @ManyToOne(() => Role)\n  @JoinColumn({ name: \"role_id\" })\n  role: Role;\n}\n`\n```\nCan anyone help me with my problem?",
      "solution": "The typeorm's `findOne` function is equivalent to `Select * ... limit 1`. This means that the `findOne` actually expects an object containing conditions to match and return the first element for which the condition is satisfied.\nIn your case, the code should be:\n`repository.findOne({where: {id: parseInt(req.params.id, 10)}})\n`\nor\n`repository.findOneBy({id: parseInt(req.params.id, 10)})\n`\nThis will find the user whose `id` field will match match the `req.params.id`.",
      "question_score": 20,
      "answer_score": 39,
      "created_at": "2022-03-27T11:35:03",
      "url": "https://stackoverflow.com/questions/71635179/type-string-has-no-properties-in-common-with-type-findoneoptionsuser"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 66328425,
      "title": "JWT: Argument of type &#39;string | undefined&#39; is not assignable to parameter of type &#39;Secret&#39;",
      "problem": "I'm using dotenv to declare JWT_SECRET env variable and It's showing the error mentioned in title.\n.env\n```\n`NODE_ENV=\"development\"\nJWT_SECRET=\"mySecretString\"\n`\n```\nenvironment.d.ts\n```\n`import { Secret } from 'jwt-promisify'\n\ndeclare global {\n    namespace NodeJS {\n        interface ProcessEnv {\n            JWT_SECRET: Secret,\n            NODE_ENV: 'development' | 'production',\n            PORT?: number | string\n        }\n    }\n}\n\nexport {}\n`\n```\nI'm using in my routes file im signing token with `JWT_SECRET`\nroute.ts\n`const token = await jwt.sign({ id: newUser.id }, process.env.JWT_SECRET)\n`\nHere intellisense is working but when I run the app or compile it the error appears.\nerror\n```\n`error TS2345: Argument of type 'string | undefined' is not assignable to parameter of type 'Secret'.\n  Type 'undefined' is not assignable to type 'Secret'.\n\n32         const token = await jwt.sign({ id: newUser.id }, process.env.JWT_SECRET)\n                                                            ~~~~~~~~~~~~~~~~~~~~~~\n\n`\n```",
      "solution": "```\n`  jwt.sign(data, process.env.SIGNATURE_KEY as string, {\n        expiresIn: '30d',\n        algorithm: \"HS256\"\n    }, (err, encoded)=>{\n        err ? reject(err) : resolve(encoded)\n    })\n`\n```\nFor Typescript, I think Type casting works. I also didn't implement async-await because the sign method wasn't hinted as a `Promise`. But I guess it works too!",
      "question_score": 19,
      "answer_score": 50,
      "created_at": "2021-02-23T07:54:23",
      "url": "https://stackoverflow.com/questions/66328425/jwt-argument-of-type-string-undefined-is-not-assignable-to-parameter-of-typ"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 65931950,
      "title": "API request to Stripe fails (Error: Not a valid URL)",
      "problem": "I want to build a simple checkout page using the Stripe Prebuilt Checkout Page in a Node application.\nI follow all the necessary steps in the Stripe docs but the API request doesn't seem to work.\nserver.js -\n```\n`const express = require(\"express\");\nconst stripe = require(\"stripe\")(\n  \"\"\n);\n\nconst app = express();\n\napp.get(\"/checkout-sucess\", (req, res) => {\n  res.send(\"Success\");\n});\n\napp.get(\"/checkout-cancel\", (req, res) => {\n  res.send(\"Cancelled\");\n});\n\napp.post(\"/create-checkout-session\", async (req, res) => {\n  const session = await stripe.checkout.sessions.create({\n    payment_method_types: [\"card\"],\n    line_items: [\n      {\n        price_data: {\n          currency: \"inr\",\n          product_data: {\n            name: \"Cewa\",\n          },\n          unit_amount: 200,\n        },\n        quantity: 1,\n      },\n    ],\n    mode: \"payment\",\n    success_url: \"/checkout-success\",\n    cancel_url: \"/checkout-cancel\",\n  });\n\n  res.json({ id: session.id });\n});\n\napp.listen(4242, () => {\n  console.log(\"Server is live on Port 4242!\");\n});\n`\n```\ncheckout.html -\n```\n`\n\n  \n    \n    \n    Stripe API Test\n    \n    \n  \n  \n    \n      Checkout\n    \n  \n\n  \n    var stripe = Stripe(\n      \"\n\n`\n```\nWhen I make this request, I get the following error in the console coming from `checkout.html` -\nError: Not a valid URL\nI don't think I've missed anything from the docs. Any idea what's going wrong? Thanks in advance.",
      "solution": "You need to add real success and cancel url, please check below code:\n```\n`const session = await stripe.checkout.sessions.create({\n    payment_method_types: [\"card\"],\n    line_items: [\n      {\n        price_data: {\n          currency: \"inr\",\n          product_data: {\n            name: \"Cewa\",\n          },\n          unit_amount: 200,\n        },\n        quantity: 1,\n      },\n    ],\n    mode: \"payment\",\n    success_url: \"http://sitename.com/checkout-success\",\n    cancel_url: \"http://sitename.com/checkout-cancel\",\n  });\n`\n```",
      "question_score": 19,
      "answer_score": 22,
      "created_at": "2021-01-28T07:18:45",
      "url": "https://stackoverflow.com/questions/65931950/api-request-to-stripe-fails-error-not-a-valid-url"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 79553495,
      "title": "throw new TypeError(`Missing parameter name at ${i}: ${DEBUG_URL}`);",
      "problem": "Gadget Controller Ts Code :\n```\n`import { Request, Response, NextFunction } from 'express';\nimport { Status } from '@prisma/client'\nimport prisma from '../utils/prisma.client';\nimport { AppError } from '../utils/error.handler';\n\n// Generate random codename for gadgets\nconst generateCodename = (): string => {\n  const adjectives = ['Mighty', 'Silent', 'Phantom', 'Shadow', 'Stealth', 'Covert', 'Invisible', 'Deadly', 'Rapid', 'Quantum'];\n  const nouns = ['Eagle', 'Panther', 'Cobra', 'Viper', 'Falcon', 'Wolf', 'Hawk', 'Tiger', 'Raven', 'Phoenix'];\n  \n  const randomAdjective = adjectives[Math.floor(Math.random() * adjectives.length)];\n  const randomNoun = nouns[Math.floor(Math.random() * nouns.length)];\n  \n  return `The ${randomAdjective} ${randomNoun}`;\n};\n\n// Generate random mission success probability\nconst generateMissionProbability = (): number => {\n  return Math.floor(Math.random() * 100);\n};\n\n// Get all gadgets with optional status filter\nexport const getAllGadgets = async (req: Request, res: Response, next: NextFunction) => {\n  try {\n    const { status } = req.query;\n    \n    const whereClause = status ? { status: status as Status } : {};\n    \n    const gadgets = await prisma.gadget.findMany({\n      where: whereClause\n    });\n    \n    const gadgetsWithProbability = gadgets.map(gadget => ({\n      ...gadget,\n      missionSuccessProbability: generateMissionProbability()\n    }));\n    \n    res.status(200).json({\n      status: 'success',\n      results: gadgetsWithProbability.length,\n      data: {\n        gadgets: gadgetsWithProbability\n      }\n    });\n  } catch (error) {\n    next(error);\n  }\n};\n\n// Create a new gadget\nexport const createGadget = async (req: Request, res: Response, next: NextFunction) => {\n  try {\n    const { status } = req.body;\n    \n    const gadget = await prisma.gadget.create({\n      data: {\n        name: generateCodename(),\n        status: status || 'Available'\n      }\n    });\n    \n    res.status(201).json({\n      status: 'success',\n      data: {\n        gadget\n      }\n    });\n  } catch (error) {\n    next(error);\n  }\n};\n\n// Update a gadget\nexport const updateGadget = async (req: Request, res: Response, next: NextFunction) => {\n  try {\n    const { id } = req.params;\n    const { name, status } = req.body;\n    \n    const gadget = await prisma.gadget.findUnique({\n      where: { id }\n    });\n    \n    if (!gadget) {\n      return next(new AppError('No gadget found with that ID', 404));\n    }\n    \n    const updatedGadget = await prisma.gadget.update({\n      where: { id },\n      data: {\n        name,\n        status\n      }\n    });\n    \n    res.status(200).json({\n      status: 'success',\n      data: {\n        gadget: updatedGadget\n      }\n    });\n  } catch (error) {\n    next(error);\n  }\n};\n\n// Decommission a gadget (soft delete)\nexport const decommissionGadget = async (req: Request, res: Response, next: NextFunction) => {\n  try {\n    const { id } = req.params;\n    \n    const gadget = await prisma.gadget.findUnique({\n      where: { id }\n    });\n    \n    if (!gadget) {\n      return next(new AppError('No gadget found with that ID', 404));\n    }\n    \n    const decommissionedGadget = await prisma.gadget.update({\n      where: { id },\n      data: {\n        status: 'Decommissioned',\n        decomissionedAt: new Date()\n      }\n    });\n    \n    res.status(200).json({\n      status: 'success',\n      data: {\n        gadget: decommissionedGadget\n      }\n    });\n  } catch (error) {\n    next(error);\n  }\n};\n\n// Trigger self-destruct sequence for a gadget\nexport const selfDestructGadget = async (req: Request, res: Response, next: NextFunction) => {\n  try {\n    const { id } = req.params;\n    \n    const gadget = await prisma.gadget.findUnique({\n      where: { id }\n    });\n    \n    if (!gadget) {\n      return next(new AppError('No gadget found with that ID', 404));\n    }\n    \n    // Generate confirmation code\n    const confirmationCode = Math.floor(100000 + Math.random() * 900000);\n    \n    const updatedGadget = await prisma.gadget.update({\n      where: { id },\n      data: {\n        status: 'Destroyed',\n        selfDestruct: new Date()\n      }\n    });\n    \n    res.status(200).json({\n      status: 'success',\n      confirmationCode,\n      message: 'Self-destruct sequence initiated',\n      data: {\n        gadget: updatedGadget\n      }\n    });\n  } catch (error) {\n    next(error);\n  }\n};\n\n`\n```\n```\n`The Gadgets Routes : \nrouter.get('/', getAllGadgets);\nrouter.post('/', createGadget);\nrouter.patch('/:id', updateGadget);\nrouter.delete('/:id', decommissionGadget);\nrouter.post('/:id/self-destruct', selfDestructGadget);\n\n`\n```\nEven though i have no error in the routing , still i am getting the error :\nthrow new TypeError(`Missing parameter name at ${i}: ${DEBUG_URL}`);\n^\nTypeError: Missing parameter name at 1: https://git.new/pathToRegexpError\nI possibly tried everything , GPT , V0 , StackOverFlow but the solutions didn't work.\nHere is the package.json :\n```\n`{\n  \"name\": \"pg_imp\",\n  \"version\": \"1.0.0\",\n  \"main\": \"dist/index.js\",\n  \"scripts\": {\n    \"start\": \"node dist/index.js\",\n    \"dev\": \"ts-node-dev --respawn --transpile-only src/index.ts\",\n    \"build\": \"tsc\",\n    \"prisma:generate\": \"prisma generate\",\n    \"prisma:migrate\": \"prisma migrate dev --name init\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"description\": \"\",\n  \"devDependencies\": {\n    \"@types/bcrypt\": \"^5.0.2\",\n    \"@types/cors\": \"^2.8.17\",\n    \"@types/express\": \"^5.0.1\",\n    \"@types/jsonwebtoken\": \"^9.0.9\",\n    \"@types/uuid\": \"^10.0.0\",\n    \"prisma\": \"^6.5.0\",\n    \"ts-node-dev\": \"^2.0.0\",\n    \"typescript\": \"^5.8.2\"\n  },\n  \"dependencies\": {\n    \"@prisma/client\": \"^6.5.0\",\n    \"bcrypt\": \"^5.1.1\",\n    \"cors\": \"^2.8.5\",\n    \"dotenv\": \"^16.4.7\",\n    \"express\": \"^5.1.0\",\n    \"express-validator\": \"^7.2.1\",\n    \"helmet\": \"^8.1.0\",\n    \"jsonwebtoken\": \"^9.0.2\",\n    \"pg\": \"^8.14.1\",\n    \"uuid\": \"^11.1.0\"\n  }\n}\n\n`\n```\nCan somebody please tell , how to fix the bug ! i am unable to fix this since 48Hrs (Skill Issue)\nI have tried downgrading the Express version to 4 because some said the Express vr:5 is causing the error , but that didnt help ,\ni checked all the routes & api endpoints but that didn't help either.\nGadget Routes :\n```\n`// src/routes/gadget.routes.ts\nimport { Router } from 'express';\nimport { \n  getAllGadgets, \n  createGadget, \n  updateGadget, \n  decommissionGadget, \n  selfDestructGadget \n} from '../controllers/gadget.controller';\nimport { protect } from '../middleware/auth.middleware';\n\nconst router = Router();\n\n// Apply authentication middleware to all routes\nrouter.use(protect);\n\n// Routes\nrouter.get('/', getAllGadgets);\nrouter.post('/', createGadget);\nrouter.patch('/:id', updateGadget);\nrouter.delete('/:id', decommissionGadget);\nrouter.post('/:id/self-destruct', selfDestructGadget);\n\nexport default router;\n`\n```\napp.ts :\n```\n`import express, { Request, Response, NextFunction } from 'express';\nimport cors from 'cors';\nimport helmet from 'helmet';\nimport authRoutes from './routes/auth.routes';\nimport gadgetRoutes from './routes/gadget.routes';\nimport { AppError, handleError } from './utils/error.handler';\n\nconst app = express();\n\n// Middleware\napp.use(helmet());\napp.use(cors());\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\n\n// Routes\napp.use('/api/auth', authRoutes);\napp.use('/api/gadgets', gadgetRoutes);\n\n// Health check route\napp.get('/health', (req, res) => {\n  res.status(200).json({ status: 'success', message: 'API is running' });\n});\n\n// Handle undefined routes\napp.all('*', (req, res, next) => {\n  next(new AppError(`Can't find ${req.originalUrl} on this server!`, 404));\n});\n\n// Global error handler\napp.use((err: any, req: Request, res: Response, next: NextFunction) => {\n  handleError(err, res);\n});\n\nexport default app;\n`\n```\nauth_routes.ts :\n```\n`import { Router } from 'express';\nimport { body } from 'express-validator';\nimport { register, login } from '../controllers/auth.controller';\nimport { validate } from '../middleware/validate.middleware';\n\nconst router = Router();\n\n// Validation rules\nconst registerValidation = [\n  body('username')\n    .notEmpty().withMessage('Username is required')\n    .isLength({ min: 3 }).withMessage('Username must be at least 3 characters long'),\n  body('password')\n    .notEmpty().withMessage('Password is required')\n    .isLength({ min: 6 }).withMessage('Password must be at least 6 characters long')\n];\n\nconst loginValidation = [\n  body('username').notEmpty().withMessage('Username is required'),\n  body('password').notEmpty().withMessage('Password is required')\n];\n\n// Routes\nrouter.post('/register', validate(registerValidation), register);\nrouter.post('/login', validate(loginValidation), login);\n\nexport default router;\n`\n```\nAuth_Middlewaree.ts :\n```\n`import { Request, Response, NextFunction } from 'express';\nimport jwt from 'jsonwebtoken';\nimport { AppError } from '../utils/error.handler';\nimport prisma from '../utils/prisma.client';\n\ninterface JwtPayload {\n  id: string;\n}\n\ndeclare global {\n  namespace Express {\n    interface Request {\n      user?: {\n        id: string;\n      };\n    }\n  }\n}\n\nexport const protect = async (req: Request, res: Response, next: NextFunction) => {\n  try {\n    // 1) Get token and check if it exists\n    let token;\n    if (req.headers.authorization && req.headers.authorization.startsWith('Bearer')) {\n      token = req.headers.authorization.split(' ')[1];\n    }\n\n    if (!token) {\n      return next(new AppError('You are not logged in. Please log in to get access', 401));\n    }\n\n    // 2) Verify token\n    const decoded = jwt.verify(token, process.env.JWT_SECRET as string) as JwtPayload;\n\n    // 3) Check if user still exists\n    const user = await prisma.user.findUnique({\n      where: { id: decoded.id }\n    });\n\n    if (!user) {\n      return next(new AppError('The user belonging to this token no longer exists', 401));\n    }\n\n    // 4) Grant access to protected route\n    req.user = { id: user.id };\n    next();\n  } catch (error) {\n    next(new AppError('Invalid token. Please log in again', 401));\n  }\n};\n`\n```",
      "solution": "Change the fallback router from\n`app.all('*', (req, res, next) => {})\n`\nto\n`app.all('/{*any}', (req, res, next) => {})\n`\nYou can find related resources at Moving to Express 5\n\nThe wildcard * must have a name, matching the behavior of parameters :, use /*splat instead of /*\n\n*splat matches any path without the root path. If you need to match the root path as well /, you can use /{*splat}, wrapping the wildcard in braces.",
      "question_score": 18,
      "answer_score": 60,
      "created_at": "2025-04-03T18:21:25",
      "url": "https://stackoverflow.com/questions/79553495/throw-new-typeerrormissing-parameter-name-at-i-debug-url"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 66508616,
      "title": "&#39;require() of ES modules is not supported. &#39; error with Node.js, express, swagger-jsdoc",
      "problem": "I trying to import swagger-jsdoc but I get an error. I searched on internet but other solutions not work for me.\nMy server.js file like that:\n```\n`const express = require('express');\nconst app = express();\nconst swaggerJsDoc = require('swagger-jsdoc');\n\nconst port = 3000;\n\napp.get('/customers', (req,res) => {\n    res.send('Customers Route');\n})\n\napp.listen(port, ()=> {\n    console.log('Server listening on 3000');\n})\n`\n```\nAnd my package.json file like that:\n```\n`{\n  \"name\": \"swaggertest\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"start\": \"nodemon app.js\",\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"dependencies\": {\n    \"express\": \"^4.17.1\",\n    \"nodemon\": \"^2.0.7\",\n    \"swagger-jsdoc\": \"^7.0.0-rc.4\",\n    \"swagger-ui-express\": \"^4.1.6\"\n  }\n}\n`\n```\nBut when I try to run this project with \"npm start\" I getting this error:\nnode:internal/modules/cjs/loader:1108\nthrow new ERR_REQUIRE_ESM(filename, parentPath, packageJsonPath);\n^\n\nError [ERR_REQUIRE_ESM]: Must use import to load ES Module:\n/Users/me/Desktop/Projects/swaggertest/node_modules/swagger-jsdoc/index.js\nrequire() of ES modules is not supported. require() of\n/Users/me/Desktop/Projects/swaggertest/node_modules/swagger-jsdoc/index.js\nfrom /Users/me/Desktop/Projects/swaggertest/app.js is an ES module\nfile as it is a .js file whose nearest parent package.json contains\n\"type\": \"module\" which defines all .js files in that package scope as\nES modules. Instead rename index.js to end in .cjs, change the\nrequiring code to use import(), or remove \"type\": \"module\" from\n/Users/me/Desktop/Projects/swaggertest/node_modules/swagger-jsdoc/package.json.\n...\ncode: 'ERR_REQUIRE_ESM'\n...\n\nHow can I solve this issue?",
      "solution": "I solved this issue with downgrade swagger-jsdoc to 6.0.0\nSo, my package.json file now look like:\n```\n`{\n  \"name\": \"swaggertest\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"start\": \"nodemon app.js\",\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"dependencies\": {\n    \"express\": \"^4.17.1\",\n    \"nodemon\": \"^2.0.7\",\n    \"swagger-jsdoc\": \"6.0.0\",\n    \"swagger-ui-express\": \"^4.1.6\"\n  }\n}\n`\n```",
      "question_score": 18,
      "answer_score": 26,
      "created_at": "2021-03-06T18:29:10",
      "url": "https://stackoverflow.com/questions/66508616/require-of-es-modules-is-not-supported-error-with-node-js-express-swagge"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 72971679,
      "title": "Get esbuild to watch for changes, rebuild, and restart express server",
      "problem": "I am trying to create a simple SSR powered project using express + react. To do this, I need to simultaneously watch frontend and backend scripts during development.\nThe goal here is to use express routes to point to react page components. Now, I have this working, but I am having problems with DX.\nHere are my package scripts:\n```\n`    \"build:client\": \"esbuild src/index.js --bundle --outfile=public/bundle.js --loader:.js=jsx\",\n    \"build:server\": \"esbuild src/server.jsx --bundle --outfile=public/server.js --platform=node\",\n    \"build\": \"npm run build:client && npm run build:server\",\n    \"start\": \"node ./public/server.js\"\n`\n```\nNow this works if I do `npm run build && npm run start`, but the problem is that it doesn't watch for changes and rebuild the frontend bundle or restart the backend server.\nNow, if I add `--watch` to the 2 build scripts, it only starts watching the `index.js` file and does not execute the other scripts.\nSo if I add `nodemon` to my start script, it doesn't matter because esbuild won't get past the first script due to the watcher.\nIs there a simpler way of doing what I am trying to do here? I also want to add tailwind to this project once I figure this out, so any tips around that would be helpful as well.",
      "solution": "I would suggest using the JS interface to esbuild, i.e., write a small JS script that requires esbuild and runs it, and then use the functional version of https://esbuild.github.io/api/#watch. Something like this:\n`require('esbuild').build({\n  entryPoints: ['app.js'],\n  outfile: 'out.js',\n  bundle: true,\n  watch: {\n    onRebuild(error, result) {\n      if (error) console.error('watch build failed:', error)\n      else { \n        console.log('watch build succeeded:', result)\n        // HERE: somehow restart the server from here, e.g., by sending a signal that you trap and react to inside the server.\n      }\n    },\n  },\n}).then(result => {\n  console.log('watching...')\n})\n`\n\nUpdate\nTo get the same behavior in esbuild 0.17+:\n```\n`const config = {\n  // entryPoints:\n  // ...\n  plugins: [{\n    name: 'rebuild-notify',\n    setup(build) {\n      build.onEnd(result => {\n        console.log(`build ended with ${result.errors.length} errors`);\n        // HERE: somehow restart the server from here, e.g., by sending a signal that you trap and react to inside the server.\n      })\n    },\n  }],\n};\n\nconst run = async () => {\n  const ctx = await esbuild.context(config);\n  await ctx.watch();\n};\n\nrun();\n`\n```",
      "question_score": 17,
      "answer_score": 11,
      "created_at": "2022-07-13T21:33:02",
      "url": "https://stackoverflow.com/questions/72971679/get-esbuild-to-watch-for-changes-rebuild-and-restart-express-server"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 66654037,
      "title": "mongo-connect error with mongo-connect(session)",
      "problem": "After searching around about it, I can't find any solution or mistake in my `code` about this error. I've got my `app.js` files inside my node JS application with the `mongo-connect` declaration :\n```\n`const MongoStore = require('connect-mongo')(session)\n`\n```\nAnd I've got this error :\n\nTypeError: Class constructor MongoStore cannot be invoked without\n'new'\nat Object. (/Users/souhailmohamed/project/devops/story website/app.js:11:20)\nat Module._compile (internal/modules/cjs/loader.js:1063:30)\nat Object.Module._extensions..js (internal/modules/cjs/loader.js:1092:10)\nat Module.load (internal/modules/cjs/loader.js:928:32)\nat Function.Module._load (internal/modules/cjs/loader.js:769:14)\nat Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:72:12)\nat internal/main/run_main_module.js:17:47\n\nThere is my `app.use` code beloww :\n```\n`app.use(session({\n    secret: 'story book',\n    resave: false,\n    saveUninitialized: false,\n    store: new MongoStore({ mongooseConnection: mongoose.connection })\n}))\n`\n```\nI understand pretty well about the\n```\n`const MongoStore = require('connect-mongo')(session)\n`\n```\nbut I didn't understand the error. But it's from a tutorial from youtube by traversy media LinK",
      "solution": "`connect-mongo` v4 introduces new signature (compared to v3).\nHere is the official migration guide.\n\nAlso, here is a quick diff of what I changed in my specific project (using `mongoose` and `dotenv`) to upgrade from `connect-mongo` v3 to v4:",
      "question_score": 17,
      "answer_score": 20,
      "created_at": "2021-03-16T12:11:10",
      "url": "https://stackoverflow.com/questions/66654037/mongo-connect-error-with-mongo-connectsession"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 66503751,
      "title": "Cross-Domain Session Cookie (Express API on Heroku + React App on Netlify)",
      "problem": "I have a React App making calls to an API in node.js/Express.\nFrontend is deployed in Netlify (https), Backend deployed on Heroku (https).\nMy problem:\n\nEverything working in dev environment (localhost)\nIn production (Netlify/Heroku), the api calls to register and login seem to work but the session cookie is not stored in the browser. Because of that, any other calls to protected routes in the API fail (because I don't receive the user credentials).\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\n\nTalking is cheap, show me the code....\nBackend (Express API):\n\nI'm using passport (local strategy), express-session, cors.\n\nApp.js\n`require('./configs/passport');\n\n// ...\n\nconst app = express();\n\n// trust proxy (https://stackoverflow.com/questions/64958647/express-not-sending-cross-domain-cookies)\napp.set(\"trust proxy\", 1); \n\napp.use(\n  session({\n    secret: process.env.SESSION_SECRET,\n    cookie: {\n      sameSite: process.env.NODE_ENV === \"production\" ? 'none' : 'lax',\n      maxAge: 60000000,\n      secure: process.env.NODE_ENV === \"production\",\n    },\n    resave: true,\n    saveUninitialized: false,\n    ttl: 60 * 60 * 24 * 30\n  })\n);\n\napp.use(passport.initialize());\napp.use(passport.session());\n\n// ...\n\napp.use(\n  cors({\n    credentials: true,\n    origin: [process.env.FRONTEND_APP_URL]\n  })\n);\n\n//...\n\napp.use('/api', require('./routes/auth-routes'));\napp.use('/api', require('./routes/item-routes'));\n\n`\nCRUD endpoint (ex. item-routes.js):\n`// Create new item\nrouter.post(\"/items\", (req, res, next) => {\n    Item.create({\n        title: req.body.title,\n        description: req.body.description,\n        owner: req.user._id // \nFrontend (React App):\n\nUsing Axios with the option \"withCredentials\" set to true...\n\nUser registration and login:\n`class AuthService {\n  constructor() {\n    let service = axios.create({\n      baseURL: process.env.REACT_APP_API_URL,\n      withCredentials: true\n    });\n    this.service = service;\n  }\n  \n  signup = (username, password) => {\n    return this.service.post('/signup', {username, password})\n    .then(response => response.data)\n  }\n\n  login = (username, password) => {\n    return this.service.post('/login', {username, password})\n    .then(response => response.data)\n  }\n   \n  //...\n}\n`\nCreating a new item...:\n```\n`    axios.post(`${process.env.REACT_APP_API_URL}/items`, {\n        title: this.state.title,\n        description: this.state.description,\n    }, {withCredentials:true})\n    .then( (res) => {\n        // ...\n    });\n`\n```",
      "solution": "Short answer:\nIt wasn't working as expected because I was testing on Chrome Incognito and, by default, Chrome blocks third party cookies in Incognito mode (more details).\nBelow is a list with some things to check if you're having a similar issue ;)\n\nChecklist\nIn case it helps, here's a checklist with different things that you main need ;)\n\n(Backend) Add \"trust proxy\" option\n\nIf you're deploying on Heroku, add the following line (you can add it before your session settings).\n```\n`app.set(\"trust proxy\", 1);\n\n`\n```\n\n(Backend) Check your session settings\n\nIn particular, check the option `sameSite` and `secure` (more details here).\nThe code below will set `sameSite: 'none'` and `secure: true` in production:\n```\n`app.use(\n  session({\n    secret: process.env.SESSION_SECRET || 'Super Secret (change it)',\n    resave: true,\n    saveUninitialized: false,\n    cookie: {\n      sameSite: process.env.NODE_ENV === \"production\" ? 'none' : 'lax', // must be 'none' to enable cross-site delivery\n      secure: process.env.NODE_ENV === \"production\", // must be true if sameSite='none'\n    }\n  })\n);\n`\n```\n\n(Backend) CORS config\n\n```\n`app.use(\n  cors({\n    credentials: true,\n    origin: [process.env.FRONTEND_APP_URL]\n  })\n);\n`\n```\n\n(Backend) Environment Variables\n\nSetup the environment variables in Heroku. For example:\n```\n`FRONTEND_APP_URL = https://my-project.netlify.app\n`\n```\nIMPORTANT: For the CORS URL, avoid a trailing slash at the end. The following may not work:\n```\n`FRONTEND_APP_URL = https://my-project.netlify.app/ --> avoid this trailing slash!\n`\n```\n\n(Frontend) Send credentials\n\nMake sure you're sending credentials in your API calls (you need to do that for all calls you make to the API, including the call for user login).\nIf you're using axios, you can do use `withCredentials` option. For example:\n```\n`    axios.post(`${process.env.REACT_APP_BACKEND_API_URL}/items`, {\n        title: this.state.title,\n        description: this.state.description,\n    }, {withCredentials:true})\n    .then( (res) => {\n        // ...\n    });\n`\n```\n\n(Browser) Check the configuration for third-party cookies\n\nFor testing, you probably want to make sure you're using the default configuration provided by each browser.\nFor example, as of 2021, Chrome blocks third-party cookies in Incognito mode (but not in \"normal\" mode), so you probably want to have something like this:\n\n...and deal with browser restrictions...:\n\nFinally, keep in mind that each browser has a different policy for third party cookies and, in general, those restrictions are expected to increase in the coming years.\nFor example, Chrome is expected to block third-party cookies at some point in 2023 (source).\nIf your App needs to bypass those restrictions, here are some options:\n\nImplement Backend & Frontend under the same domain\n\nImplement Backend & Frontend under subdomains of the same domain (example, example.com & api.example.com)\n\nHave your Backend API under a proxy (if you're using Netlify, you can easily setup a proxy using a _redirects file)",
      "question_score": 17,
      "answer_score": 23,
      "created_at": "2021-03-06T09:24:28",
      "url": "https://stackoverflow.com/questions/66503751/cross-domain-session-cookie-express-api-on-heroku-react-app-on-netlify"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 66738563,
      "title": "Error importing PrismaClient in code compiled from typescript [SyntaxError: Named export &#39;PrismaClient&#39; not found]",
      "problem": "In server.ts, importing PrismaClient like this:\n```\n`import { PrismaClient } from '@prisma/client';\n\nexport const prisma = new PrismaClient();\n`\n```\nthrows an Error when building with tsc and running the compiled code:\n```\n`yarn run build && yarn run start\n\nimport { PrismaClient } from '@prisma/client';\n         ^^^^^^^^^^^^\nSyntaxError: Named export 'PrismaClient' not found. The requested module '@prisma/client' is a CommonJS module, which may not support all module.exports as named exports.\nCommonJS modules can always be imported via the default export, for example using:\n\n    import pkg from '@prisma/client';\n    const { PrismaClient } = pkg;\n    \n        at ModuleJob._instantiate (internal/modules/esm/module_job.js:104:21)\n        at async ModuleJob.run (internal/modules/esm/module_job.js:149:5)\n        at async Loader.import (internal/modules/esm/loader.js:166:24)\n        at async Object.loadESM (internal/process/esm_loader.js:68:5)\n    error Command failed with exit code 1.\n`\n```\nSo I did what was recommended and changed the code to:\n```\n`import Prisma from '@prisma/client';\n\nconst { PrismaClient } = Prisma;\nexport const prisma = new PrismaClient();\n`\n```\nAnd this code works after building with tsc and running the resulting code. But now running the typescript files with ts-node-dev throws this Error:\n```\n`yarn run dev\n\nTypeError: Cannot destructure property 'PrismaClient' of 'client_1.default' as it is undefined.\n    at Object. (C:\\Users\\gfs10\\Projetos\\rest-api\\src\\server.ts:11:9)\n    at Module._compile (internal/modules/cjs/loader.js:1063:30)\n    at Module._compile (C:\\Users\\gfs10\\Projetos\\rest-api\\node_modules\\source-map-support\\source-map-support.js:547:25)\n    at Module.m._compile (C:\\Users\\gfs10\\AppData\\Local\\Temp\\ts-node-dev-hook-9753341767331849.js:69:33)\n    at Module._extensions..js (internal/modules/cjs/loader.js:1092:10)\n    at require.extensions. (C:\\Users\\gfs10\\AppData\\Local\\Temp\\ts-node-dev-hook-9753341767331849.js:71:20)\n    at Object.nodeDevHook [as .ts] (C:\\Users\\gfs10\\Projetos\\rest-api\\node_modules\\ts-node-dev\\lib\\hook.js:63:13)\n    at Module.load (internal/modules/cjs/loader.js:928:32)\n    at Function.Module._load (internal/modules/cjs/loader.js:769:14)\n    at Module.require (internal/modules/cjs/loader.js:952:19)\n[ERROR] 19:03:38 TypeError: Cannot destructure property 'PrismaClient' of 'client_1.default' as it is undefined.\n`\n```\nAnd changing the code to:\n```\n`import Prisma from '@prisma/client';\n\nexport const prisma = new Prisma.PrismaClient();\n`\n```\nthrows this error:\n```\n`yarn run dev\n\nTypeError: Cannot read property 'PrismaClient' of undefined\n    at Object. (C:\\Users\\gfs10\\Projetos\\rest-api\\src\\server.ts:11:34)\n    at Module._compile (internal/modules/cjs/loader.js:1063:30)\n    at Module._compile (C:\\Users\\gfs10\\Projetos\\rest-api\\node_modules\\source-map-support\\source-map-support.js:547:25)\n    at Module.m._compile (C:\\Users\\gfs10\\AppData\\Local\\Temp\\ts-node-dev-hook-7015369495927739.js:69:33)\n    at Module._extensions..js (internal/modules/cjs/loader.js:1092:10)\n    at require.extensions. (C:\\Users\\gfs10\\AppData\\Local\\Temp\\ts-node-dev-hook-7015369495927739.js:71:20)\n    at Object.nodeDevHook [as .ts] (C:\\Users\\gfs10\\Projetos\\rest-api\\node_modules\\ts-node-dev\\lib\\hook.js:63:13)\n    at Module.load (internal/modules/cjs/loader.js:928:32)\n    at Function.Module._load (internal/modules/cjs/loader.js:769:14)\n    at Module.require (internal/modules/cjs/loader.js:952:19)\n[ERROR] 19:09:01 TypeError: Cannot read property 'PrismaClient' of undefined\n`\n```\nHow come? How can I make both work at the same time?\nMy tsconfig.json\n```\n`{\n  \"compilerOptions\": {\n    \"target\": \"ES2020\",\n    \"moduleResolution\": \"node\",\n    \"outDir\": \"./build/\",\n    \"rootDir\": \"./src/\",\n    \"strict\": true,\n    \"alwaysStrict\": true,\n    \"noImplicitAny\": true,\n    \"noUnusedLocals\": true,\n    \"noUnusedParameters\": true,\n    \"noImplicitReturns\": true,\n    \"strictNullChecks\": true,\n    \"strictPropertyInitialization\": true,\n    \"strictBindCallApply\": true,\n    \"noImplicitThis\": true,\n    \"noFallthroughCasesInSwitch\": true,\n    \"esModuleInterop\": true,\n    \"declaration\": true\n  }\n}\n`\n```\nMy package.json:\n```\n`{\n  \"name\": \"rest-api\",\n  \"version\": \"1.0.0\",\n  \"description\": \"A REST API boilerplate.\",\n  \"main\": \"server.ts\",\n  \"author\": \"Gledyson Ferreira\",\n  \"license\": \"MIT\",\n  \"type\": \"module\",\n  \"scripts\": {\n    \"start\": \"node --experimental-specifier-resolution=node build/server.js\",\n    \"dev\": \"SET NODE_ENV=development&& ts-node-dev --clear src/server.ts\",\n    \"build\": \"tsc\",\n    \"lint\": \"eslint --ext .ts .\"\n  },\n  \"devDependencies\": {\n    \"@typescript-eslint/eslint-plugin\": \"^4.18.0\",\n    \"@typescript-eslint/parser\": \"^4.18.0\",\n    \"eslint\": \"^7.22.0\",\n    \"prisma\": \"^2.19.0\",\n    \"ts-node-dev\": \"^1.1.6\",\n    \"typescript\": \"^4.2.3\"\n  },\n  \"dependencies\": {\n    \"@prisma/client\": \"^2.19.0\",\n    \"@types/bcrypt\": \"^3.0.0\",\n    \"@types/cors\": \"^2.8.10\",\n    \"@types/express\": \"^4.17.11\",\n    \"@types/jsonwebtoken\": \"^8.5.1\",\n    \"@types/morgan\": \"^1.9.2\",\n    \"@types/node\": \"^14.14.35\",\n    \"@types/passport\": \"^1.0.6\",\n    \"@types/passport-jwt\": \"^3.0.5\",\n    \"bcrypt\": \"^5.0.1\",\n    \"cors\": \"^2.8.5\",\n    \"express\": \"^4.17.1\",\n    \"jsonwebtoken\": \"^8.5.1\",\n    \"morgan\": \"^1.10.0\",\n    \"passport\": \"^0.4.1\",\n    \"passport-jwt\": \"^4.0.0\"\n  }\n}\n`\n```\nMy server.ts\n```\n`import express from 'express';\nimport Prisma from '@prisma/client';\nimport config from './config';\nimport api from './api';\nimport middleware from './middlewares';\nimport morgan from 'morgan';\nimport cors from 'cors';\nimport passport from 'passport';\nimport setReqUser from './services/passport';\n\nexport const prisma = new Prisma.PrismaClient();\nconst app = express();\n\napp.disable('x-powered-by');\napp.use(express.json());\napp.use(morgan('tiny'));\napp.use(cors());\napp.use(passport.initialize());\nsetReqUser(passport);\n\napp.use('/api/v1', api.authRoute);\napp.use('/api/v1/users', api.userRoute);\n\napp.use(middleware.unknownEndpoint);\napp.use(middleware.errorHandler);\n\napp.listen(config.port, () => {\n  console.log(`\n    ################################################\n    \n    Server running on port ${config.port} in ${config.env} mode.\n\n    ################################################\n  `);\n});\n`\n```",
      "solution": "As you may know this issue was being worked on here.\nIn the mean time what you could do to proceed with your tests is to use dependency injection with a mocked prisma client and to move the deconstruction line\n```\n`const { PrismaClient } = pkg;\n`\n```\nto where your class or function uses it inside an if, i.e:\n```\n`class MyClass {\n  prisma: Prisma.PrismaClient\n\n  def constructor(props) {\n    if (!props?.prisma) {\n      const { PrismaClient } = Prisma\n      this.prisma = new PrismaClient({\n        log: ['error']\n      })\n    } else {\n      this.prisma = props.prisma\n    }\n  }\n}\n`\n```\nI know its not ideal but hopefully this does the trick.\nto mock the PrismaClient you could mock it using jest-mock-extended like so\n```\n`const mockPrisma = mockDeep();\n`\n```",
      "question_score": 16,
      "answer_score": 1,
      "created_at": "2021-03-22T00:17:17",
      "url": "https://stackoverflow.com/questions/66738563/error-importing-prismaclient-in-code-compiled-from-typescript-syntaxerror-name"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 70256124,
      "title": "How to validate request body in Node.js, Express - is it possible without using a library?",
      "problem": "I have the code (below) and one developer said to me that I had to validate my request:\n```\n`router.post('/dashboard', passport.authenticate('jwt', { session: false }),\n(req, res) => {\n\n    try {\n        let newPost = new Post({\n            category: req.body.category,\n            title: req.body.title,\n            photo: req.body.photo,\n            text: req.body.text,\n            author: req.body.author,\n            date: req.body.date\n        });\n\n        Post.addPost(newPost, (err, user) => {\n            if (err) {\n                res.json({success: false, msg: `Post has not been added. ${err}`})\n            } else {\n                res.json({success: true, msg: 'Post was added.'})\n            }\n        })\n    } catch (err) {\n       const error = (res, error) => {\n            res.status(500).json({\n                success: false,\n                message: error.message ? error.message : error\n            })\n       }\n\n       console.log('error routes/auth POST', res, error)\n    }\n})\n`\n```\nI googled and found the solutions i.e. using libraries for request validation like `express-validator` - is it ok?\nAre there any native, built-in express, node.js methods to validate a request?\nOr it's better to use a library like `express-validator`?",
      "solution": "Express.js doesn't have a built-in validator.\nBut you can use express-validator  or joi. Both of these libraries are good.\nif you are using typescript in your project class-validator is a better option, it will let you use types.\nAnd this is a great talk on why you need to validate the data. Take Data Validation Seriously by Paul Milham",
      "question_score": 15,
      "answer_score": 34,
      "created_at": "2021-12-07T08:08:34",
      "url": "https://stackoverflow.com/questions/70256124/how-to-validate-request-body-in-node-js-express-is-it-possible-without-using"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 71850295,
      "title": "Share Prisma Types Between Microservices",
      "problem": "I'm working on a project right now that has multiple TypeScript microservices performing operations on the same database. In each microservice, we are using the Prisma client to perform database operations. The issue I'm experiencing is we need to duplicate our `schema.prisma` file in each microservice and generate the Prisma client for each service. Is there a way to manage our database in a separate project while sharing the generated client between the microservices without having duplicate `schema.prisma` in each project?",
      "solution": "prisma generates a client from the schema. This client is as far as im aware totally independent of the schema files and the prisma package. If you copy those generated files in any way, you can reuse the client in a different project.\nThere is a nice article on medium using npm packages I guess.\nhttps://isidoro-ferreiro.medium.com/share-your-prisma-client-across-projects-44d1c7aca6fd\nHowever u could also use something like nodemon or your ci pipeline to copy the generated client files to the other services.",
      "question_score": 15,
      "answer_score": 10,
      "created_at": "2022-04-13T01:50:32",
      "url": "https://stackoverflow.com/questions/71850295/share-prisma-types-between-microservices"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 73166678,
      "title": "Data is not sent using axios to backend in react and Unsupported protocol localhost: axoos is thrown",
      "problem": "I am using express js as backend and also have added proxy of backend in the package.json of react js. Before it used to throw an error with fetch method and moved to the axios method to prevent that. The data is in json format and completely working after copy pasting on postman to check backend.\n```\n`import React ,{useState} from 'react'\nimport './contact.css'\nimport axios from \"axios\"\n\nconst Contact = (e) => {\n    const [email, setEmail] = useState('')\n    const [description,setDescription]=useState('');\n    const[message,setMessage]=useState('')\n\nconst [name ,setName] = useState('')\n\nconst url='localhost:5000/api/contact'\n    const contactClick=async (e)=>{\n      const subject=\"contacting\"\n        e.preventDefault();\n      const formData={\n        name:name,\n        email:email,\n        subject:subject,\n        description:description\n      }\n\n      console.log(JSON.stringify(formData));\n      axios.post(url, JSON.stringify(formData))\n   .then(res => setMessage('email sent'))\n   .catch(err => {setMessage('Unable to sent email ')\n  return console.log(err)})\n\n    };\n    \n  return (\n    <>\n    \n    \n    {message}\n\n        setEmail(e.target.value) \n} />\n\n        setName(e.target.value)} />\n        setDescription(e.target.value)}/>\n        \n\n    \n    \n    \n  )\n}\n\nexport default Contact\n`\n```",
      "solution": "I think `axios.post()` takes data as object not string as mentioned here in the docs.\nreplace it with `axios.post(url, formData)` without stringifying it.\nhttps://axios-http.com/docs/post_example\nBut the resulted data from `JSON.stringify(formData)` is `'{the data}'`",
      "question_score": 14,
      "answer_score": 2,
      "created_at": "2022-07-29T14:22:34",
      "url": "https://stackoverflow.com/questions/73166678/data-is-not-sent-using-axios-to-backend-in-react-and-unsupported-protocol-localh"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 65882838,
      "title": "How to solve JsonWebTokenError &quot;invalid signature&quot; after assigning some infos to the generated token?",
      "problem": "Have a problem when trying to verify the token (it was working fine before i added some data to it before generating it) .. but now it does not seem to be working !\nThis is how i generate the token when user send a POST request (login)\n```\n`require('dotenv')\nconst jwt       = require('jsonwebtoken');\nconst bcrypt    = require('bcryptjs')\nconst Role      = require('../models/Role');\nconst Section   = require('../models/Section');\nconst User      = require('../models/User');\n\n// Login !\nrouter.post('/', async (req, res) => {\n\n    let sections_fetched = [];\n\n    // Validate data \n        \n    // Check username\n    const user = await User.findOne({username: req.body.username });\n    if(!user) return res.status(400).send('Wrong user login credentials !');\n\n    // Check password\n    const is_pass_valid = await bcrypt.compare(req.body.password , user.password);\n    if (!is_pass_valid) return res.status(400).send('Wrong user login credentials !');\n\n    // Get role Object:\n    const _role = await Role.findOne({_id:user.role , is_deleted:false});\n    if (!_role) res.json(\"Failed fetching role !\");\n\n    // loop through sections   \n    for (let index = 0; index this is my JWT verification middleare :\n```\n`require('dotenv')\nconst jwt = require('jsonwebtoken');\n\nmodule.exports = function (req, res, next) {\n\n    const token = req.header('auth-token');\n\n    if (!token) return res.status(401).send('Access Denied !');\n    console.log(process.env.JWT_TOKEN_SECRET);\n    console.log(token);\n\n    try \n    {\n        \n        const verified = jwt.verify(token, process.env.JWT_TOKEN_SECRET);\n        req.user = verified;  \n        next();\n\n    } \n    catch (error) \n    {\n        res.status(400).send('Invalid token !');\n    }\n}\n`\n```\nand this is a simple example of listing users (using the JWT verification middleware ! ) :\n```\n`const verifyToken = require('../middlewares/verifyToken'); // my jwt middleware to verify !\n\n// Listing All users\nrouter.get('/', verifyToken, async (req, res) => \n{\n    try \n    { \n        const users = await User.find({is_deleted:false});\n        res.json(users);\n    }\n    catch (error) \n    {\n        console.log(\"err ->\\n\"+error);\n        res.json({message: error});\n    } \n});\n\n`\n```",
      "solution": "what is 'secret in the below line? seems you are adding a secret key twice, replace the hardcoded word 'secret' with token from env\n```\n`const token = jwt.sign({username:user.username, role:{name:_role.name, sections:sections_fetched}}, 'secret', {expiresIn : '24h'}, process.env.JWT_TOKEN_SECRET);\n`\n```",
      "question_score": 14,
      "answer_score": 10,
      "created_at": "2021-01-25T11:21:46",
      "url": "https://stackoverflow.com/questions/65882838/how-to-solve-jsonwebtokenerror-invalid-signature-after-assigning-some-infos-to"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 66346501,
      "title": "How to set HTTP only cookie in NestJS",
      "problem": "I am trying to implement JWT authorization with accessToken and refreshToken. Both the accessToken and refresh token need to be set in HTTP only cookie.\nI tried this code but it is not setting cookies. I am using NestJS framework here.\n```\n`import { Controller, Request, Post, Body, Response } from '@nestjs/common';\n@Controller()\nexport class UserController {\n  constructor() {}\n\n  @Post('users/login')\n  async login(\n    @Request() req,\n    @Body() credentials: { username: string; password: string },\n    @Response() res,\n  ) {\n    try {\n      // Login with username and password\n      const accessToken = 'something';\n      const refreshToken = 'something';\n      const user = { username: credentials.username };\n\n      res.cookie('accessToken', accessToken, {\n        expires: new Date(new Date().getTime() + 30 * 1000),\n        sameSite: 'strict',\n        httpOnly: true,\n      });\n      return res.send(user);\n    } catch (error) {\n      throw error;\n    }\n  }\n}\n`\n```\nThe res.send() method is working fine i am getting data in response .How can i set cookie here ?\nThis is my main.ts file: -\n```\n`import { NestFactory } from '@nestjs/core';\nimport { AppModule } from './app.module';\nimport { Logger } from '@nestjs/common';\nimport { AuthenticatedSocketIoAdapter } from './chat/authchat.adapter';\nimport * as cookieParser from 'cookie-parser';\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n  app.enableCors();\n  app.use(cookieParser());\n  app.useWebSocketAdapter(new AuthenticatedSocketIoAdapter(app));\n  await app.listen(3000);\n  Logger.log('User microservice running');\n}\nbootstrap();\n`\n```\nAnd to get the cookie I am using:-\n```\n`request.cookies\n`\n```",
      "solution": "Conversation in the comments:\nAxios, on the client side, needs to have `withCredentials` set to `true` to send the cookies back to the server. The server was sending and setting thecookies as expected.",
      "question_score": 13,
      "answer_score": 13,
      "created_at": "2021-02-24T08:34:07",
      "url": "https://stackoverflow.com/questions/66346501/how-to-set-http-only-cookie-in-nestjs"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 69653359,
      "title": "Is NestJs a right choice for a node.js beginner or should I do something with Express first?",
      "problem": "I know `Nest.js` is on top of Express JS and can be on fastify, I have completed the express JS library project in the Mozilla (MDN) training site but for many reasons like the architecture of the app and discussions that I saw on web about problematic situations with express and modern JS like async-await, etc\u2026\nI searched for a more reliable choice: sails-js, nest and feathers came up, feathers were awesome but `Nest.js` had very good documentation and I avoided typescript for a while, but as for now it seems to be everywhere, and I hope with nest I could get to know it better and the practical use of it, at frontend I honestly could not find a good reason for using it besides it's a trend, except for angular 2 plus. Don't get me wrong angular is one of the reasons I hope to come around TS.\nShort Version\nSo this is my current situation as a frontend developer (vue & svelte mostly) a few months in NodeJS atmosphere (express and hapi) my question is: should I stick to hapi & express or go with NestJs & alternatives like feathers and sails?\nPlease forgive my lack of experience for writing in English.",
      "solution": "Nest.js & Typescript is a framework for enterprise-level applications which provides a clear structure and guidelines of how things should be.\nSo for the beginner pros are:\n\nOOP (SOLID) in TS/JS\nIntroducing the latest LTS features of TS, like decorators, dependency injections, and so on.\nIn build ESLint, prettier, and monorepo mod which can be activated via Nest CLI.\nEasy deployment via docker-compose for microservice architecture.\n\nYou can't achieve these things via such old frameworks like Express + (something else)\nAs for the cons:\n\nIt's hard to understand why there is a `contoller` file, `service` file, and why there are multiple `module` files with `forRoot` and `forRootAsync` connections to DBs and so on.\n\nIn time, it will be difficult to write/build projects w/o Nestjs because it's very good, but has a bit different pattern of programming.\n\n@Afaq mentioned that TS is the future (and Nestjs as well), but it's a bit wrong. JS as a native language always inherits the best available options from TS, as it did with CoffeeScript and so on. So one day in the future, you could wake up and look at your TS codebase as a legacy without appropriate support, while native technology goes forward.",
      "question_score": 12,
      "answer_score": 13,
      "created_at": "2021-10-20T23:40:33",
      "url": "https://stackoverflow.com/questions/69653359/is-nestjs-a-right-choice-for-a-node-js-beginner-or-should-i-do-something-with-ex"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 67860273,
      "title": "Preflight request doesn&#39;t pass access control check: It does not have HTTP ok status problem and i don&#39;t know why, i imported everything right",
      "problem": "I'm getting this error where it says \"Response to preflight request doesn't pass access control check: It does not have HTTP ok status.\" Anyone have any idea on what could it be?\nThis is my code on backend:\napp.js\n```\n`app.delete(\"api/posts/:id\", (req,res,next) =>{\n  console.log(req.params.id);\n  res.status(200).json({message: 'post deleted!'})\n})\n\n`\n```\nThis is the code on frontend:\nposts.service.ts:\n```\n`deletePost(postId: string) {\n    this.http\n      .delete('http://localhost:3000/api/posts/' + postId)\n      .subscribe(() => {\n        console.log('deleted');\n      });\n  }\n\n`\n```\npost-list.component.ts\n```\n`onDelete(postId: string) {\n    this.postsService.deletePost(postId);\n  }\n`\n```\nAnd post-list.component.html:\n```\n`DELETE\n`\n```\nNote that I DID ALLOW CORS in my code, here's the proof:\n```\n`app.use((req, res, next) => {\n  res.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n  res.setHeader(\n    \"Access-Control-Allow-Headers\",\n    \"Origin, X-Requested-With, Content-Type, Accept\"\n  );\n  res.setHeader(\n    \"Access-Control-Allow-Methods\",\n    \"GET, POST, PATCH, PUT, DELETE, OPTIONS\"\n  );\n  next();\n});\n`\n```\nHere's a picture of the problem:",
      "solution": "Preflight requests are not handeled as \"normal\" request. They have the http OPTIONS header.So after your code snippet where you set the CORS header just add the following lines:\n```\n`app.options('/*', (_, res) => {\n    res.sendStatus(200);\n});\n`\n```\nThis just sets the status to 200 and should fix your problem.",
      "question_score": 12,
      "answer_score": 16,
      "created_at": "2021-06-06T16:39:42",
      "url": "https://stackoverflow.com/questions/67860273/preflight-request-doesnt-pass-access-control-check-it-does-not-have-http-ok-st"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 69677744,
      "title": "Express error: Strict MIME type checking is enforced for module scripts per HTML spec",
      "problem": "I'm trying to build a simple single page application via express.\nEverything works fine until I start creating the classes, then the browser throws the following error:\n\nFailed to load module script: Expected a JavaScript module script but the server responded with a MIME type of \"text/html\". Strict MIME type checking is enforced for module scripts per HTML spec.\n\nI was hoping that `express.static()` would make that go away but that's not the case.\nI'm not very skilled yet with JS, Node and all that, so I apologize for anything dumb here.\nMy code is quite simple at the moment:\nfile architecture:\n```\n`-server.js\n-[frontend]\n+-[static]\n++-index.html\n++-[js]\n+++-index.js\n+++-[views]\n++++-AbstractView.js\n++++-Home.js\n-[node_modules]\n-package.json\n`\n```\nserver.js\n```\n`const express = require('express');\nconst path = require('path');\n\nconst App = express()\n\nApp.use('/static', express.static(path.resolve(__dirname, 'frontend', 'static')))\nApp.get('/*', (req, res) => {\n    res.sendFile(path.resolve(__dirname, \"frontend\", \"index.html\"))\n})\nApp.listen(3000, () => console.log(\"server running on port 3000\"))\n`\n```\nindex.js:\n```\n`import Home from \"./views/Home\"\n\nconst navigateTo = url => {\n    history.pushState(null, null, url)\n    router()\n}\n\nconst router = async() => {\n    const routes = [{\n                path: '/',\n                view: new Home()\n            },\n            // {\n            //     path: '/projects',\n            //     view: () => console.log('projects')\n            // },\n            // {\n            //     path: '/about',\n            //     view: () => console.log('about')\n            // },\n            // {\n            //     path: '/studies',\n            //     view: () => console.log('studies')\n            // },\n        ]\n        // test routes for matches\n    const potentialMatches = routes.map(route => {\n        return {\n            route: route,\n            isMatch: location.pathname === route.path\n        }\n    })\n\n    /**\n     * NEED TO SET 404 PAGE!\n     */\n    let match = potentialMatches.find(potentialMatch => potentialMatch.isMatch)\n    if (!match) {\n        match = {\n            route: routes[0],\n            isMatch: true\n        }\n    }\n\n    const view = new match.route.view()\n    const content = document.querySelector(\"#app\")\n    content.innerHTML = await view.getHtml()\n    console.log(content);\n}\n\nwindow.addEventListener(\"popstate\", router);\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n    document.body.addEventListener(\"click\", e => {\n        if (e.target.matches(\"[data-link\")) {\n            e.preventDefault()\n            navigateTo(e.target.href)\n        }\n    })\n    router()\n})\n`\n```\nthe Home class (extending and AbstractView general class):\n```\n`import AbstractView from \"./AbstractView\";\n\nexport default class Home extends AbstractView {\n    constructor() {\n        super()\n        this.setTitle(\"Home\")\n    }\n    setTitle(title) {\n        document.title = title\n    }\n\n    async getHtml() {\n        return `Home`;\n    }\n}\n`\n```\nThe generic class:\n```\n`export default class AbstractView {\n    constructor() {\n\n    }\n    setTitle(title) {\n        document.title = title\n    }\n\n    async getHtml() {\n        return \"\";\n    }\n}\n`\n```\nof course, the index.html file:\n```\n`\n\n    \n    \n    \n    Paolo Iocca\n\n    \n        \n        \n        \n    \n    \n        \n            \n                \n                    home \n                \n                \n                    projects\n          \n          \n            about \n                \n                \n                    studies\n            \n                \n            \n        \n    \n    \n    \n\n`\n```\nHope you can help me with this. Thanks a lot.\n_____ UPDATE\nhere's the package.json file, just in case:\n```\n`{\n    \"dependencies\": {\n        \"express\": \"^4.17.1\"\n    },\n    \"name\": \"boilerplate-server\",\n    \"version\": \"1.0.0\",\n    \"main\": \"server.js\",\n    \"devDependencies\": {\n        \"nodemon\": \"^2.0.14\",\n        \"serve-static\": \"^1.14.1\"\n    },\n    \"scripts\": {\n        \"dev\": \"nodemon server\",\n        \"start\": \"node server.js\"\n    },\n    \"keywords\": [],\n    \"author\": \"\",\n    \"license\": \"ISC\",\n    \"description\": \"\"\n}\n`\n```",
      "solution": "The statement\n`import Home from \"./views/Home\"\n`\nleads to the request `GET /static/js/views/Home` (without `.js` suffix), which the `static` middleware cannot serve. But now the next middleware takes over and responds with the `index.html` file (with `Content-Type: text/html`). That's why you see a 200 OK status, but the browser complains about the wrong content type.\nWith\n`express.static(path.resolve(__dirname, 'frontend', 'static'),\n  {extensions: [\"js\"]});\n`\nyou would instruct the `static` middleware to silently add the `.js` suffix.",
      "question_score": 12,
      "answer_score": 8,
      "created_at": "2021-10-22T15:27:43",
      "url": "https://stackoverflow.com/questions/69677744/express-error-strict-mime-type-checking-is-enforced-for-module-scripts-per-html"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 65953381,
      "title": "How to use .env with ES6 module with node js and express application?",
      "problem": "I need your help on how I can use .env file on this application. here is my problem: I am building an app using ES6 module in my node express app. I am facing a problem while storing my variable in .env file, both these two ways below are giving this error : `MongooseError: The uri parameter to openUri() must be a string, got \"undefined\". Make sure the first parameter to mongoose.connect() or mongoose.createConnection() is a string. did not connect`. But when I only use the plain string connect is working, that means that I am not using the dotenv file correctly:\n1-\n```\n`import {} from \"dotenv/config.js\";\nimport express from \"express\";\nimport mongoose from \"mongoose\";\nimport cors from \"cors\";\n\nconst app=express()\n...\n//DB config\nmongoose.connect(process.env.CONNECTION_URL,\n    {\n      useCreateIndex: true,\n      useNewUrlParser: true,\n      useUnifiedTopology: true,\n    })\n\napp.listen(port,()=>console.log(`server on ${port}`) \n`\n```\n2-\n```\n`import dotenv from \"dotenv\";\nimport express from \"express\";\nimport mongoose from \"mongoose\";\nimport cors from \"cors\";\n\ndotenv.config();\n\nconst app=express()\n...\n//DB config\nmongoose.connect(process.env.CONNECTION_URL,\n    {\n      useCreateIndex: true,\n      useNewUrlParser: true,\n      useUnifiedTopology: true,\n    })\n\napp.listen(port,()=>console.log(`server on ${port}`)\n`\n```",
      "solution": "There are several methods to import dotenv configs, 2u4u has been answered one of the way to import dotenv, and you can try this one below too for your future reference.\n```\n`import { configDotenv } from \"dotenv\";\nimport express from \"express\";\n\nconst app = express();\nconfigDotenv();\n\napp.get(\"/\" , (req, res) => {\n    return res.json(\"HELLO WORLD\")\n});\n\napp.listen(process.env.PORT, () => {\n    console.log(`This app listens to http://localhost:${process.env.PORT}`)\n});\n`\n```\nSince the `configDotenv` is a function, and I checked with `console.log` for a better clarification though, then you need to call below. That's it and worked for me too.",
      "question_score": 11,
      "answer_score": 1,
      "created_at": "2021-01-29T12:13:06",
      "url": "https://stackoverflow.com/questions/65953381/how-to-use-env-with-es6-module-with-node-js-and-express-application"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 65679580,
      "title": "Gitlab CI/CD pipeline giving Dockerfile error",
      "problem": "Good Evening,\nI am trying to deploy my nodeJS app to my Digital Ocean Server and its saying it cant find my Dockerfile. I did check and the Dockerfile does not have a .txt extension. Any guidance is appreciated. I have my variables set in my Gitlab project.\nThe pipeline throws the below error:\n\"$ chmod og= $ID_RSA\nchmod: unrecognized option: ---BEGIN\nBusyBox v1.31.1 () multi-call binary.\nUsage: chmod [-Rcvf] MODE[,MODE]... FILE...\nEach MODE is one or more of the letters ugoa, one of the\nsymbols +-= and one or more of the letters rwxst\n-R  Recurse\n-c  List changed files\n-v  List all files\n-f  Hide errors\"\n\r\n\r\n`stages:\n  - build\n  - publish\n  - deploy\n\nvariables:\n  TAG_LATEST: $CI_REGISTRY_IMAGE/$CI_COMMIT_REF_NAME:latest\n  TAG_COMMIT: $CI_REGISTRY_IMAGE/$CI_COMMIT_REF_NAME:$CI_COMMIT_SHORT_SHA\n\nbuild:\n  image: node:latest\n  stage: build\n  script:\n    - npm install\n    - echo   \"ACCOUNT_SID=$ACCOUNT_SID\" >> .env\n    - echo   \"AUTH_TOKEN=$AUTH_TOKEN\" >> .env\n    - echo   \"API_KEY=$API_KEY\" >> .env\n    - echo   \"API_SECRET=$API_SECRET\" >> .env\n    - echo   \"PHONE_NUMBER=$PHONE_NUMBER\" >> .env\n    - echo    \"sengrid_api=$sengrid_api\" >> .env\n\npublish:\n  image: docker:latest\n  stage: publish\n  services:\n    - docker:dind\n  script:\n    - docker build . -t $TAG_COMMIT -t $TAG_LATEST \n    - docker login -u gitlab-ci-token -p $CI_BUILD_TOKEN $CI_REGISTRY\n    - docker push $TAG_COMMIT\n    - docker push $TAG_LATEST\n\ndeploy:\n  image: alpine:latest\n  stage: deploy\n  tags:\n    - deployment\n  script:\n    - chmod og= $ID_RSA\n    - apk update && apk add openssh-client\n    - ssh -i $ID_RSA -o StrictHostKeyChecking=no $SERVER_USER@$SERVER_IP \"docker login -u gitlab-ci-token -p $CI_BUILD_TOKEN $CI_REGISTRY\"\n    - ssh -i $ID_RSA -o StrictHostKeyChecking=no $SERVER_USER@$SERVER_IP \"docker pull $TAG_COMMIT\"\n    - ssh -i $ID_RSA -o StrictHostKeyChecking=no $SERVER_USER@$SERVER_IP \"docker container rm -f my-app || true\"\n    - ssh -i $ID_RSA -o StrictHostKeyChecking=no $SERVER_USER@$SERVER_IP \"docker run -d -p 80:3000 --name my-app $TAG_COMMIT\"\n  environment:\n    name: production\n    url: http://167.172.225.124\n  only:\n    - master`",
      "solution": "Check first if the docker build argument order is correct:\nInstead of:\n```\n`docker build -t $TAG_COMMIT -t $TAG_LATEST .\n`\n```\nI would try:\n```\n`docker build . -t $TAG_COMMIT -t $TAG_LATEST\n`\n```\nCheck also you are in the right path when you are running this build command.\nAnd that there is a file named `Dockerfile` (the default name needed by `docker build`).\n\nRegarding the error:\n`chmod og= $ID_RSA \nchmod: unrecognized option: ---BEGIN\n`\nYou need to apply `chmod` on a file, not on a file content.\nThe variable `ID_RSA` includes the key itself, not the key filename.\nUse `~/.ssh/id_rsa` instead of `$ID_RSA`.",
      "question_score": 11,
      "answer_score": 4,
      "created_at": "2021-01-12T08:26:12",
      "url": "https://stackoverflow.com/questions/65679580/gitlab-ci-cd-pipeline-giving-dockerfile-error"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 71122741,
      "title": "How do I add custom property to Express.Request in Typescript?",
      "problem": "I'm sorry for my poor English skills.\nI created a new project using express-generator-typescript.\n\n$ npx express-generator-typescript --use-yarn\n\nI want to add additional properties to `Express.Request` for my custom middleware.\nSo I created `types/myRequest.d.ts` in `./src` and put and save the code as below:\n```\n`// myRequest.d.ts\ndeclare namespace Express {\n  interface Request {\n    myProp?: boolean;\n  }\n}\n`\n```\nAnd I uncommented \"typeRoots\" in `tsconfig.json` and added \"./node_modules/@types\", \"./src/types\", and I tried to use the added property by creating a some middleware in `./src/routes/api.ts`. Here's the full code:\n```\n`// api.ts\nimport { NextFunction, Request, Response, Router } from \"express\";\nimport userRouter from \"./user-router\";\n\nfunction myMiddleware(req: Request, _res: Response, next: NextFunction) {\n  req.myProp = true;\n  next();\n}\n\n// Export the base-router\nconst baseRouter = Router();\n\n// Setup routers\nbaseRouter.use(\"/users\", myMiddleware, userRouter);\n\n// Export default.\nexport default baseRouter;\n`\n```\nThis builds fine, also IntelliSense in VS Code works fine and doesn't show any issues. However, when I run `yarn start:dev` I get the following error:\n```\n`/home/me/dev/express-gen-ts/node_modules/ts-node/src/index.ts:828\n    return new TSError(diagnosticText, diagnosticCodes);\n           ^\nTSError: \u2a2f Unable to compile TypeScript:\nsrc/routes/api.ts:5:7 - error TS2339: Property 'myProp' does not exist on type 'Request>'.\n\n5   req.myProp = true;\n        ~~~~~~\n\n    at createTSError (/home/me/dev/express-gen-ts/node_modules/ts-node/src/index.ts:828:12)\n    at reportTSError (/home/me/dev/express-gen-ts/node_modules/ts-node/src/index.ts:832:19)\n    at getOutput (/home/me/dev/express-gen-ts/node_modules/ts-node/src/index.ts:1022:36)\n    at Object.compile (/home/me/dev/express-gen-ts/node_modules/ts-node/src/index.ts:1326:43)\n    at Module.m._compile (/home/me/dev/express-gen-ts/node_modules/ts-node/src/index.ts:1458:30)\n    at Module._extensions..js (node:internal/modules/cjs/loader:1153:10)\n    at Object.require.extensions. [as .ts] (/home/me/dev/express-gen-ts/node_modules/ts-node/src/index.ts:1462:12)\n    at Module.load (node:internal/modules/cjs/loader:981:32)\n    at Function.Module._load (node:internal/modules/cjs/loader:822:12)\n    at Module.require (node:internal/modules/cjs/loader:1005:19) {\n  diagnosticCodes: [ 2339 ]\n}\n[nodemon] app crashed - waiting for file changes before starting...\n`\n```\nSo I can't do development in dev state. Of course if I don't use additional properties, the dev state is also available and works fine.\nI think `express-generator-typescript` itself has some setting. Because changing \"typeRoots\" in `tsconfig.json` doesn't change the result. But I couldn't find it.\nThank you in advance.",
      "solution": "Whenever I run into this type of problem, I usually use \"declare module\" to add properties to Express's \"Request\" interface instead of declaring them in a namespace. This way I usually don't have to change anything in the tsconfig nor add any .d.ts files.\nAdd these lines to your api.ts code (note that in most cases you will need to reference the express-serve-static-core module as this is where the Request interface is declared):\n```\n`declare module \"express-serve-static-core\" {\n  interface Request {\n    myProp?: boolean;\n  }\n}\n`\n```\nFull file:\n```\n`// api.ts\nimport { NextFunction, Request, Response, Router } from \"express\";\nimport userRouter from \"./user-router\";\n\ndeclare module \"express-serve-static-core\" {\n  interface Request {\n    myProp?: boolean;\n  }\n}\n\nfunction myMiddleware(req: Request, _res: Response, next: NextFunction) {\n  req.myProp = true;\n  next();\n}\n\n// Export the base-router\nconst baseRouter = Router();\n\n// Setup routers\nbaseRouter.use(\"/users\", myMiddleware, userRouter);\n\n// Export default.\nexport default baseRouter;\n`\n```\nNormally this should make your newly added property available in other files as well, but you can of course export the manipulated Request interface just to be safe.",
      "question_score": 11,
      "answer_score": 15,
      "created_at": "2022-02-15T08:47:35",
      "url": "https://stackoverflow.com/questions/71122741/how-do-i-add-custom-property-to-express-request-in-typescript"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 71910780,
      "title": "Docker run fails &quot;return process.dlopen(module, path.toNamespacedPath(filename));&quot;",
      "problem": "im trying to make a dockerfile and run my code into this container. im getting following error:\n```\n`node:internal/modules/cjs/loader:1187\n  return process.dlopen(module, path.toNamespacedPath(filename));\n                 ^\n\nError: /node_modules/bcrypt/lib/binding/napi-v3/bcrypt_lib.node: invalid ELF header\n    at Object.Module._extensions..node (node:internal/modules/cjs/loader:1187:18)\n    at Module.load (node:internal/modules/cjs/loader:981:32)\n    at Function.Module._load (node:internal/modules/cjs/loader:822:12)\n    at Module.require (node:internal/modules/cjs/loader:1005:19)\n    at require (node:internal/modules/cjs/helpers:102:18)\n    at Object. (/node_modules/bcrypt/bcrypt.js:6:16)\n    at Module._compile (node:internal/modules/cjs/loader:1103:14)\n    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1157:10)\n    at Module.load (node:internal/modules/cjs/loader:981:32)\n    at Function.Module._load (node:internal/modules/cjs/loader:822:12) {\n  code: 'ERR_DLOPEN_FAILED'\n}\n`\n```\nMy application works fine without docker.\ni also tryed to remove bcrypt like in this question: Node - was compiled against a different Node.js version using NODE_MODULE_VERSION 51\ndockerfile:\n```\n`FROM node:16\nWORKDIR ./\nCOPY package*.json ./\nRUN npm install \nCOPY . .\nEXPOSE 4000\nCMD [\"node\", \"server.js\"]\n`\n```\n.dockerignore:\n```\n`node_modules\nupload\nexport\nconverage\n.git\n.tmp\n.vscode\n.github\n.env\n`\n```",
      "solution": "You need to add a `.dockerignore`\nThe basic `.dockerignore` look like\n```\n`# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.\n\n# dependencies\n/node_modules\n/.pnp\n.pnp.js\n\n# testing\n/coverage\n\n# production\n/build\n\n# misc\n.DS_Store\n.env.local\n.env.development.local\n.env.test.local\n.env.production.local\n\nnpm-debug.log*\nyarn-debug.log*\nyarn-error.log*\n`\n```",
      "question_score": 11,
      "answer_score": 12,
      "created_at": "2022-04-18T12:45:44",
      "url": "https://stackoverflow.com/questions/71910780/docker-run-fails-return-process-dlopenmodule-path-tonamespacedpathfilename"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 70964519,
      "title": "Typescript no overload matches this call",
      "problem": "I'm new to TypeScript and I'm currently stuck. I have a nodejs and express app.\nI'm getting the following error: No overload matches this call.\n```\n`The last overload gave the following error.\n    Argument of type '{ isLoggedIn: (req: Request>, res: Response>, next: NextFunction) => Response | undefined; }' is not assignable to parameter of type 'RequestHandlerParams>'.\n      Type '{ isLoggedIn: (req: Request>, res: Response>, next: NextFunction) => Response | undefined; }' is missing the following properties from type '(ErrorRequestHandler> | RequestHandler>)[]': length, pop,\n`\n```\nThis is my route file\n```\n`export {}\n\nimport express, { Router } from 'express';\n\nimport lessons from '@controllers/lessons';\nimport isLoggedIn from '@middleware/user';\n\nconst lessonRoutes: Router = express.Router();\n\nlessonRoutes.route('/')\n        .get(isLoggedIn, lessons.lessonForm)\n`\n```\n\nThis is my middleware file\n```\n`import { Request, Response, NextFunction } from 'express';\n\nconst isLoggedIn = (req: Request, res: Response, next: NextFunction) => {\n    if (!req.isAuthenticated()) {\n        return res.status(401).json({\n            error: \"User must sign in\"\n          })\n    }\n    next();\n}\n\nexport default {\n    isLoggedIn\n}\n\n    \n`\n```",
      "solution": "Your exports from the middleware file have been set up incorrectly.\nYou are constructing an object with one property, `isLoggedIn`, which is the handler function, and then exporting that object as the default export.\nSo, when you import the default export from this file in the line:\n```\n`import isLoggedIn from '@middleware/user';\n`\n```\nNow `isLoggedIn` is equal to the value of the default export. i.e. `isLoggedIn` is an object with one property `isLoggedIn` that is equal to the handler function. So, instead of passing a function to `route('/').get(...)` like it expects, you are passing it an object.\nYou can use a named export from your middleware file instead:\n```\n`export const isLoggedIn = (...) => ...;\n`\n```\nThen import it by name:\n```\n`import {isLoggedIn} from '@middleware/user';\n`\n```",
      "question_score": 10,
      "answer_score": 3,
      "created_at": "2022-02-03T01:18:05",
      "url": "https://stackoverflow.com/questions/70964519/typescript-no-overload-matches-this-call"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 73741056,
      "title": "Error TS2339: Property &#39;use&#39; does not exist on type express &quot;Application&quot;",
      "problem": "Recently one of our old written micro-service (Nodejs V10 + Typescript V7.0.1) start throwing following errors:\n```\n`return new TSError(diagnosticText, diagnosticCodes)\nTSError: \u2a2f Unable to compile TypeScript:\nsrc/app.ts(31,14): error TS2339: Property 'listen' does not exist on type 'Application'.\nsrc/app.ts(48,14): error TS2339: Property 'use' does not exist on type 'Application'.\nsrc/app.ts(49,14): error TS2339: Property 'use' does not exist on type 'Application'.\nsrc/app.ts(50,14): error TS2339: Property 'set' does not exist on type 'Application'.\nsrc/app.ts(51,14): error TS2339: Property 'set' does not exist on type 'Application'.\nsrc/app.ts(52,14): error TS2339: Property 'use' does not exist on type 'Application'.\n`\n```\nCode Environment\nWe are running our code in docker-compose in order to maintain the old nodejs and typescript versions, Dockerfile content\n```\n`FROM node:10\nWORKDIR /app\nCOPY package*.json ./\nRUN npm install\nCOPY . .\nCMD [ \"npm\", \"run\", \"start\" ]\n`\n```\nSame code working on local system but not on development server. No relevant information found on google, could you please suggest what might be the reason for this.\nThank you in advance.",
      "solution": "After a lot of R&D, We come to know that ts-node & typescript npms needs to be updated. Following command fix the problem.\n```\n`npm i ts-node --save-dev && npm i typescript --save-dev\n`\n```",
      "question_score": 10,
      "answer_score": 13,
      "created_at": "2022-09-16T09:00:45",
      "url": "https://stackoverflow.com/questions/73741056/error-ts2339-property-use-does-not-exist-on-type-express-application"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 76137987,
      "title": "OpenAI Completion Stream with Node.js and Express.js",
      "problem": "I'm trying to build a ChatGPT website clone and now I need to make the stream completion effect that shows the result word-per-word.\nMy server is a TypeScript Node.js app that uses the Express.js framework.\nHere's the route:\n`import express, { Request, Response } from 'express';\nimport cors from 'cors';\nimport { Configuration, OpenAIAPI } from 'openai';\n\n// ...\n\napp.post('/api/admin/testStream', async (req: Request, res: Response) => {\n    const { password } = req.body;\n\n    try {\n        if (password !== process.env.ADMIN_PASSWORD) {\n            res.send({ message: 'Incorrect password' });\n            return;\n        }\n        const completion = await openai.createCompletion({\n            model: 'text-davinci-003',\n            prompt: 'Say this is a test',\n            stream: true,\n        }, { responseType: 'stream' });\n\n        completion.data.on('data', (chunk: any) => {\n            console.log(chunk.toString());\n        });\n\n        res.send({ message: 'Stream started' });\n    } catch (err) {\n        console.log(err);\n        res.send(err);\n    }\n});\n\n// ...\n`\nRight now, it gives me an error saying\n\nProperty 'on' does not exist on type 'CreateCompletionResponse'.ts(2339)\n\neven if I set the `{ responseType: 'stream' }`.\nHow can I solve this problem and send the response chunk-per-chunk to the frontend? (I'm using Socket.IO.)",
      "solution": "Finally solved it thanks to the help of @uzluisf !\nHere's what I did:\n```\n`import express, { Request, Response } from 'express';\nimport cors from 'cors';\nimport { Configuration, OpenAIAPI } from 'openai';\nimport http, { IncomingMessage } from 'http';\n\n// ...\n\napp.post('/api/admin/testStream', async (req: Request, res: Response) => {\n    const { password } = req.body;\n\n    try {\n        if (password !== process.env.ADMIN_PASSWORD) {\n            res.send({ message: 'Incorrect password' });\n            return;\n        }\n\n        const completion = await openai.createChatCompletion({\n            model: 'gpt-3.5-turbo',\n            messages: [{ role: 'user', content: 'When was America founded?' }],\n            stream: true,\n        }, { responseType: 'stream' });\n\n        const stream = completion.data as unknown as IncomingMessage;\n\n        stream.on('data', (chunk: Buffer) => {\n            const payloads = chunk.toString().split(\"\\n\\n\");\n            for (const payload of payloads) {\n                if (payload.includes('[DONE]')) return;\n                if (payload.startsWith(\"data:\")) {\n                    const data = JSON.parse(payload.replace(\"data: \", \"\"));\n                    try {\n                        const chunk: undefined | string = data.choices[0].delta?.content;\n                        if (chunk) {\n                            console.log(chunk);\n                        }\n                    } catch (error) {\n                        console.log(`Error with JSON.parse and ${payload}.\\n${error}`);\n                    }\n                }\n            }\n        });\n\n        stream.on('end', () => {\n            setTimeout(() => {\n                console.log('\\nStream done');\n                res.send({ message: 'Stream done' });\n            }, 10);\n        });\n\n        stream.on('error', (err: Error) => {\n            console.log(err);\n            res.send(err);\n        });\n    } catch (err) {\n        console.log(err);\n        res.send(err);\n    }\n});\n\n// ...\n`\n```\nFor more info, visit https://github.com/openai/openai-node/issues/18\nAlso managed to send chunks of message using Socket.IO events!\n\nLinks to example code:\n\nFront-End\nBack-End",
      "question_score": 10,
      "answer_score": 18,
      "created_at": "2023-04-29T21:15:47",
      "url": "https://stackoverflow.com/questions/76137987/openai-completion-stream-with-node-js-and-express-js"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 69074405,
      "title": "NestJS - Cannot set headers after they are sent to the client",
      "problem": "In my NestJs project, I am using decorator `@Res() res` and using the response object to set custom response header status by multiple cases.\nWhen calling, sometimes it logs: ` Error [ERR_HTTP_HEADERS_SENT]: Cannot remove headers after they are sent to the client`\nAfter I viewed the issues list in Github and searching on the internet, I know this is relating to Express middleware and the built-in filter of NestJs.\nSo, I remove `.send()` and add ` return;` at the end of the Controller method, the log will disappear.\nMy first code:\n```\n`@Get()\nget(@Req() req, @Res() res) {\n  const result = this.service.getData(req);\n  res.status(result.statusCode).json(result.data).send(); // when using .send(), it will cause error\n}\n`\n```\nCode after I fixed look like this:\n```\n`@Get()\nget(@Req() req, @Res() res) {\n  const result = this.service.getData(req);\n  res.status(result.statusCode).json(result.data); // when remove .send(), it will succeed\n  return;\n}\n`\n```\nMy question: Do I have to add ` return;` at the end of the method? Why using `.send()` sometimes  cause error but not always?",
      "solution": "because `requet.json({...})` already send response to \"client\". So `.send()` after `requet.json({...})` will try to send another response.\nthe good way to do is to return response like this:\n```\n`return res.status(result.statusCode).json(result.data);\n`\n```\nbecause if you miss `return` your code may cause unexpected result.\nExample:\n```\n`res.status(result.statusCode).json(result.data); //response is sent\nlet a = \"Something good\"; // Code will be executed\nconsole.log(a); // Code will be executed\n`\n```",
      "question_score": 10,
      "answer_score": 18,
      "created_at": "2021-09-06T14:17:07",
      "url": "https://stackoverflow.com/questions/69074405/nestjs-cannot-set-headers-after-they-are-sent-to-the-client"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 66659450,
      "title": "Getting body-Parser is deprecated Warning In Vs code and not Able to get Body tried to use inbuilt body-parser of express",
      "problem": "Below Is Code Of `app.js` file\n```\n`var port = process.env.PORT || 8080; // set our port\nvar express = require('express');\nvar app = express();\nvar bodyParser = require('body-parser')\nvar cors = require('cors');\nvar indexRouter = require(\"./server/routes/index\");\nvar http = require('http').Server(app);\nconst path = require('path')\n\nconst Licence = require('./server/CronJob/CronJob');\n\nhttp.listen(port);\n\napp.use(cors());\n\napp.use(bodyParser.json({ limit: '50mb' }));\n\napp.use(bodyParser.json({\n    type: 'application/vnd.api+json'\n}));\n\napp.use(bodyParser.urlencoded({\n    limit: '50mb',\n    extended: true,\n    parameterLimit: 50000\n}));\n\n// parse application/json\napp.use(express.json());\napp.use(express.urlencoded()); //Parse URL-encoded bodies\n\napp.use(function (req, res, next) {\n    res.header(\"Access-Control-Allow-Origin\", '*');\n    res.header(\"Access-Control-Allow-Credentials\", true);\n    res.header('Access-Control-Allow-Methods', 'GET,PUT,POST,DELETE,OPTIONS');\n    res.header(\"Access-Control-Allow-Headers\", 'Origin,X-Requested-With,Content-Type,Accept,content-type,application/json');\n    res.header(\"Cache-Control\", \"no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0\");\n    next();\n});\n\napp.use(express.static(path.join(__dirname, \"/build\")));\n\napp.use(indexRouter);\n\napp.get('/*', function (req, res) {\n    res.sendFile(path.join(__dirname, '/build/index.html'), function (err) {\n        if (err) {\n            res.status(500).send(err)\n        }\n    })\n})\n\n// Licence.licenceExpire();\n\nconsole.log('Magic happens on port ' + port); // shoutout to the user\n\nexports = module.exports = app;\n`\n```\nVersion\nexpress: ^4.17.1,\nbody-parser: ^1.19.0\nand also used suggestion given in below blog\nupdate\nI have used inbuilt body-parser but getting same error again here is the screenshot of function of inbuilt body-parser",
      "solution": "From 4.16.0+ body-parser is inbuilt in express\nUse http://expressjs.com/en/api.html#express.json\n```\n`app.use(express.json({ limit: '50mb' }));\napp.use(express.urlencoded())\n`\n```\nhttps://expressjs.com/en/changelog/4x.html#4.16.0\n\nThe express.json() and express.urlencoded() middleware have been added to provide request body parsing support out-of-the-box. This uses the expressjs/body-parser module module underneath, so apps that are currently requiring the module separately can switch to the built-in parsers.\n\nhttps://github.com/expressjs/body-parser/commit/b7420f8dc5c8b17a277c9e50d72bbaf3086a3900\n\nThis deprecates the generic bodyParser() middleware export that\nparses both json and urlencoded. The \"all\" middleware is very\nconfusing, because it makes it sound like it parses all bodyes,\nthough it does not do multipart, which is a common body type. Also,\nthe arguments for the two different middleware are starting to\noverlap and it's hard to configure then when done this way.",
      "question_score": 10,
      "answer_score": 13,
      "created_at": "2021-03-16T17:34:29",
      "url": "https://stackoverflow.com/questions/66659450/getting-body-parser-is-deprecated-warning-in-vs-code-and-not-able-to-get-body-tr"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 70304407,
      "title": "Typescript - How to parse query parameters into number value",
      "problem": "I have a express API endpoint where I need to receive two numbers from the query parameters.\nThe problem is that I cannot convert them properly into number type constants.\nI always get the following typescript error:\n`Argument of type 'string | ParsedQs | string[] | ParsedQs[]' is not assignable to parameter of type 'string'.`\n```\n`export const getRoutes = async (req: Request, res: Response) => {\n  const page:number = parseInt(req.query.page)\n  const limit:number = parseInt(req.query.limit)\n`\n```",
      "solution": "Just mentioning what Aleksey L. said but putting it here so people can see the answer easily\n```\n`export const getRoutes = async (req: Request, res: Response) => {\n  const page:number = parseInt(req.query.page as string)\n  const limit:number = parseInt(req.query.limit as string)\n}\n`\n```\nThat would help typescript interpret req.query.page as a string and then be able to parse it as an integer.",
      "question_score": 10,
      "answer_score": 14,
      "created_at": "2021-12-10T13:19:54",
      "url": "https://stackoverflow.com/questions/70304407/typescript-how-to-parse-query-parameters-into-number-value"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 65655500,
      "title": "Access file upload formData in Express",
      "problem": "How can I access the files in the API?\nI read the other solutions and all of them require npm packages to solve this. I want to understand why I can't do it vanilla. Also, the answers are old and recommend using body-parser, which now comes bundled with Express.\nI would like the solution to be vanilla JS in order to understand the process better.\nclient\n`async function uploadFile(file) {\n    let formData = new FormData();\n    formData.append(\"file\", file);\n\n    let res = await fetchPostFile(\"/api/files\", formData);\n}\n`\nfetch\n`export async function fetchPostFile(url, formData) {\n    try {\n        let result = await (\n            await fetch(url, {\n                method: \"POST\",\n                withCredentials: true,\n                credentials: \"include\",\n                headers: {\n                    Authorization: localStorage.getItem(\"token\"),\n                    Accept: \"application/json\",\n                    \"Content-type\": \"multipart/form-data\",\n                },\n                body: formData,\n            })\n        ).json();\n\n        return result;\n    } catch (err) {\n        return err;\n    }\n}\n`\napi\n`router.post(\"/api/files\", async function (req, res, next) {\n    try {\n        console.log(req.file);          // undefined\n        console.log(req.files);         // undefined\n        console.log(req.body);          // {}\n\n    } catch (err) {\n        next(err);\n    } finally {\n        req.connection.release();\n    }\n});\n`\nWhy is the `req.body` empty? Please help me understand what I'm doing wrong.",
      "solution": "Here's the whole file management API.\nI am using `busboy` which is what `multer` uses under the hood. I found it easier to use.\n`const express = require(\"express\");\nconst router = express.Router();\n\nconst config = require(\"../../config\");\n\nconst busboy = require(\"busboy\");\nconst fs = require(\"fs\");\n\nconst SHA256 = require(\"crypto-js/sha256\");\n\nlet filesFolderPath = config.paths.files;\n\nrouter.get(\"/api/records/:recordUid/files/:fieldUid\", async (req, res, next) => {\n    try {\n        let { recordUid, fieldUid } = req.params;\n\n        let query = `\n            select \n                rdf.*,\n                r.uid recordUid,\n                round(sizeBytes / 1024, 0) sizeKb,\n                round(sizeBytes / 1024 / 1024, 0) sizeMb\n            from recordDataFile rdf\n                left join record r on r.id = rdf.recordId\n                left join field f on f.id = rdf.fieldId\n            where \n                r.uid = ?\n                and f.uid = ?;\n        `;\n\n        let rows = await req.pool.query(query, [recordUid, fieldUid]);\n\n        res.status(200).send(rows);\n    } catch (err) {\n        next(err);\n    }\n});\n\nrouter.get(\"/api/files/:hash\", async (req, res, next) => {\n    try {\n        let { hash } = req.params;\n\n        let query = `\n            select *\n            from recordDataFile\n            where hash = ?\n        `;\n\n        let rows = await req.pool.query(query, [hash]);\n        let fileData = rows[0];\n\n        res.download(fileData.path);\n    } catch (err) {\n        next(err);\n    }\n});\n\nrouter.post(\"/api/files\", async (req, res, next) => {\n    try {\n        let bb = busboy({\n            headers: req.headers,\n            defCharset: \"utf8\",\n            limits: {\n                fileSize: 20 * 1024 * 1024, // 20 mb\n                files: 5,\n            },\n        });\n\n        let fields = {};\n\n        // Get any text values\n        bb.on(\"field\", (fieldname, val, fieldnameTruncated, valTruncated) => {\n            console.log(fieldname, val);\n            fields[fieldname] = val;\n        });\n\n        // Read file stream\n        bb.on(\"file\", (fieldname, fileStream, filename, encoding, mimetype) => {\n            // Prevents hieroglyphs from cyrillic\n            let originalName = Buffer.from(filename.filename, \"latin1\").toString(\"utf8\");\n\n            let nameParts = originalName.split(\".\");\n            let extension = nameParts[nameParts.length - 1]; // without the . from .jpeg\n\n            // IMPORTANT!!! FILE NAME CAN'T HAVE SPACES, it won't save properly!!!\n            let hash = SHA256(`${+new Date()}${originalName}`).toString();\n\n            // Absolute path to file\n            let filePath = `${filesFolderPath}${hash}`;\n\n            // Open writeable stream to path\n            let writeStream = fs.createWriteStream(filePath);\n\n            // Pipe the file to the opened stream\n            fileStream.pipe(writeStream);\n\n            // Check for errors\n            writeStream.on(\"error\", (err) => {\n                console.log(\"writeStream\", err);\n            });\n\n            // Writing done, stream closed\n            writeStream.on(\"close\", async (err) => {\n                // console.log(\"closing + SQL\");\n\n                if (err) {\n                    console.log(\"closing error\");\n                    return;\n                }\n\n                let query = `\n                    insert into recordDataFile\n                        (\n                            recordId,\n                            fieldId,\n                            name,\n                            extension,\n                            hash,\n                            path,\n                            sizeBytes,\n                            userId,\n                            created\n                        )\n                    values\n                        (\n                            (select id from record where uid = ?),\n                            (select id from field where uid = ?),\n                            ?,\n                            ?,\n                            ?,\n                            ?,\n                            ?,\n                            ?,\n                            now()\n                        );\n                `;\n\n                let sizeBytes = fs.statSync(filePath).size;\n\n                await req.pool.query(query, [fields.recordUid, fields.fieldUid, originalName, extension, hash, filePath, sizeBytes, req.userId]);\n\n                // record updated. send notification?\n                await req.pool.query(`update record set updated = now(), updatedByUserId = ? where uid = ?`, [req.userId, fields.recordUid]);\n            });\n        });\n\n        bb.on(\"finish\", () => {\n            res.status(200).send({ success: true });\n        });\n\n        req.pipe(bb); // Hooks the streams together. Without it, you're not feeding busboy any data to parse.\n    } catch (err) {\n        console.log(\"file upload catch\", err);\n        next(err);\n    }\n});\n\nrouter.delete(\"/api/files/:hash\", async (req, res, next) => {\n    try {\n        let { hash } = req.params;\n\n        // get the file\n        let query = `\n            select * from recordDataFile where hash = ?\n        `;\n\n        let rows = await req.pool.query(query, [hash]);\n\n        let file = rows[0];\n        let filePath = file.path;\n\n        // remove file\n        fs.unlinkSync(filePath);\n\n        // delete the file metadata\n        await req.pool.query(` delete from recordDataFile where hash = ?`, [hash]);\n\n        res.status(200).send(rows);\n    } catch (err) {\n        next(err);\n    }\n});\n\nmodule.exports = router;\n`",
      "question_score": 10,
      "answer_score": 3,
      "created_at": "2021-01-10T17:19:24",
      "url": "https://stackoverflow.com/questions/65655500/access-file-upload-formdata-in-express"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 65646514,
      "title": "Express Sharp install via Docker issue",
      "problem": "I need to use sharp. Its work fine on my workspace but if I deploymeny via docker then I get error. I am implementation all steps.\n```\n`Error: 'linux-x64' binaries cannot be used on the 'linuxmusl-x64' platform. Please remove the 'node_modules/sharp' directory and run 'npm install' on the 'linuxmusl-x64' platform.\n`\n```\nI think sharp is prebuilt when first install. It uses the architecture of my computer(darwin, arm) But when it runs on the docker, although it gets built again, the work talks about the architecture of my computer.\nI tried\nremove node_modules folder on my workspaces. - yarn pm2 not found\nnpm install on docker running. - permission problems\nMy Dockerfile:\n```\n`FROM node:alpine\n\nRUN mkdir -p /usr/src/node-app && chown -R node:node /usr/src/node-app\n\nWORKDIR /usr/src/node-app\n\nCOPY package.json yarn.lock ./\n\nUSER node\n\nRUN npm install --pure-lockfile\nRUN npm install sharp --ignore-scripts=false\n\nCOPY --chown=node:node . .\n\nEXPOSE 3050\n\n`\n```\nMy .dockerignore.\n```\n`node_modules\n**/node_modules\nnpm-debug.log\nDockerfile\n.dockerignore\n.git\n.gitignore\n\n`\n```\n`docker build . `\nWhen I do it, I see that sharp for my server is loaded among the docker logs.\n```\n`found 11 vulnerabilities (6 moderate, 5 high)\n  run `npm audit fix` to fix them, or `npm audit` for details\nRemoving intermediate container e5ad8008eebd\n ---> 906e268b6fc3\nStep 7/9 : RUN npm install sharp --ignore-scripts=false\n ---> Running in 933338813b5d\n\n> sharp@0.27.0 install /usr/src/node-app/node_modules/sharp\n> (node install/libvips && node install/dll-copy && prebuild-install) || (node-gyp rebuild && node install/dll-copy)\n\ninfo sharp Using cached /home/node/.npm/_libvips/libvips-8.10.5-linuxmusl-x64.tar.br\nnpm WARN @apidevtools/swagger-parser@10.0.2 requires a peer of openapi-types@>=7 but none is installed. You must install peer dependencies yourself.\nnpm WARN tsutils@3.19.1 requires a peer of typescript@>=2.8.0 || >= 3.2.0-dev || >= 3.3.0-dev || >= 3.4.0-dev || >= 3.5.0-dev || >= 3.6.0-dev || >= 3.6.0-beta || >= 3.7.0-dev || >= 3.7.0-beta but none is installed. You must install peer dependencies yourself.\nnpm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@2.3.1 (node_modules/fsevents):\nnpm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@2.3.1: wanted {\"os\":\"darwin\",\"arch\":\"any\"} (current: {\"os\":\"linux\",\"arch\":\"x64\"})\n\n+ sharp@0.27.0\nupdated 1 package and audited 1348 packages in 20.689s\n\n84 packages are looking for funding\n  run `npm fund` for details\n\nfound 11 vulnerabilities (6 moderate, 5 high)\n  run `npm audit fix` to fix them, or `npm audit` for details\nRemoving intermediate container 933338813b5d\n ---> 838713a4cebb\nStep 8/9 : COPY --chown=node:node . .\n ---> eb755fc2589e\nStep 9/9 : EXPOSE 3050\n ---> Running in bf0a5c9e96c6\nRemoving intermediate container bf0a5c9e96c6\n ---> 347f113598fd\nSuccessfully built 347f113598fd\n`\n```\nMy Docker-compose up log\n```\n`mongodb_1   | 2021-01-09T19:31:15.802+0000 I  CONTROL  [main] Automatically disabling TLS 1.0, to force-enable TLS 1.0 specify --sslDisabledProtocols 'none'\nmongodb_1   | 2021-01-09T19:31:15.815+0000 I  CONTROL  [initandlisten] MongoDB starting : pid=1 port=27017 dbpath=/data/db 64-bit host=a8281f9d01ef\nmongodb_1   | 2021-01-09T19:31:15.815+0000 I  CONTROL  [initandlisten] db version v4.2.1\nmongodb_1   | 2021-01-09T19:31:15.815+0000 I  CONTROL  [initandlisten] git version: edf6d45851c0b9ee15548f0f847df141764a317e\nmongodb_1   | 2021-01-09T19:31:15.815+0000 I  CONTROL  [initandlisten] OpenSSL version: OpenSSL 1.1.1  11 Sep 2018\nmongodb_1   | 2021-01-09T19:31:15.815+0000 I  CONTROL  [initandlisten] allocator: tcmalloc\nmongodb_1   | 2021-01-09T19:31:15.815+0000 I  CONTROL  [initandlisten] modules: none\nmongodb_1   | 2021-01-09T19:31:15.815+0000 I  CONTROL  [initandlisten] build environment:\nmongodb_1   | 2021-01-09T19:31:15.815+0000 I  CONTROL  [initandlisten]     distmod: ubuntu1804\nmongodb_1   | 2021-01-09T19:31:15.815+0000 I  CONTROL  [initandlisten]     distarch: x86_64\nmongodb_1   | 2021-01-09T19:31:15.815+0000 I  CONTROL  [initandlisten]     target_arch: x86_64\nmongodb_1   | 2021-01-09T19:31:15.815+0000 I  CONTROL  [initandlisten] options: { net: { bindIp: \"0.0.0.0\", port: 27017 }, security: { authorization: \"enabled\" }, storage: { dbPath: \"/data/db\" } }\nmongodb_1   | 2021-01-09T19:31:15.816+0000 I  STORAGE  [initandlisten] Detected data files in /data/db created by the 'wiredTiger' storage engine, so setting the active storage engine to 'wiredTiger'.\nmongodb_1   | 2021-01-09T19:31:15.816+0000 I  STORAGE  [initandlisten] \nmongodb_1   | 2021-01-09T19:31:15.816+0000 I  STORAGE  [initandlisten] ** WARNING: Using the XFS filesystem is strongly recommended with the WiredTiger storage engine\nmongodb_1   | 2021-01-09T19:31:15.816+0000 I  STORAGE  [initandlisten] **          See http://dochub.mongodb.org/core/prodnotes-filesystem\nmongodb_1   | 2021-01-09T19:31:15.816+0000 I  STORAGE  [initandlisten] wiredtiger_open config: create,cache_size=457M,cache_overflow=(file_max=0M),session_max=33000,eviction=(threads_min=4,threads_max=4),config_base=false,statistics=(fast),log=(enabled=true,archive=true,path=journal,compressor=snappy),file_manager=(close_idle_time=100000,close_scan_interval=10,close_handle_minimum=250),statistics_log=(wait=0),verbose=[recovery_progress,checkpoint_progress],\nmongodb_1   | 2021-01-09T19:31:17.154+0000 I  STORAGE  [initandlisten] WiredTiger message [1610220677:154424][1:0x7f96e9f8db00], txn-recover: Recovering log 194 through 195\napi_node-app_1 exited with code 0\nmongodb_1   | 2021-01-09T19:31:17.389+0000 I  STORAGE  [initandlisten] WiredTiger message [1610220677:389583][1:0x7f96e9f8db00], txn-recover: Recovering log 195 through 195\nmongodb_1   | 2021-01-09T19:31:17.527+0000 I  STORAGE  [initandlisten] WiredTiger message [1610220677:527496][1:0x7f96e9f8db00], txn-recover: Main recovery loop: starting at 194/6016 to 195/256\nmongodb_1   | 2021-01-09T19:31:17.643+0000 I  STORAGE  [initandlisten] WiredTiger message [1610220677:643739][1:0x7f96e9f8db00], txn-recover: Recovering log 194 through 195\nmongodb_1   | 2021-01-09T19:31:17.722+0000 I  STORAGE  [initandlisten] WiredTiger message [1610220677:722144][1:0x7f96e9f8db00], txn-recover: Recovering log 195 through 195\nmongodb_1   | 2021-01-09T19:31:17.784+0000 I  STORAGE  [initandlisten] WiredTiger message [1610220677:784868][1:0x7f96e9f8db00], txn-recover: Set global recovery timestamp: (0,0)\nmongodb_1   | 2021-01-09T19:31:17.812+0000 I  RECOVERY [initandlisten] WiredTiger recoveryTimestamp. Ts: Timestamp(0, 0)\nmongodb_1   | 2021-01-09T19:31:17.825+0000 I  STORAGE  [initandlisten] Timestamp monitor starting\nmongodb_1   | 2021-01-09T19:31:17.827+0000 I  CONTROL  [initandlisten] ** WARNING: You are running this process as the root user, which is not recommended.\nmongodb_1   | 2021-01-09T19:31:17.828+0000 I  CONTROL  [initandlisten] \nmongodb_1   | 2021-01-09T19:31:17.844+0000 I  SHARDING [initandlisten] Marking collection local.system.replset as collection version: \nmongodb_1   | 2021-01-09T19:31:17.847+0000 I  STORAGE  [initandlisten] Flow Control is enabled on this deployment.\nmongodb_1   | 2021-01-09T19:31:17.848+0000 I  SHARDING [initandlisten] Marking collection admin.system.roles as collection version: \nmongodb_1   | 2021-01-09T19:31:17.849+0000 I  SHARDING [initandlisten] Marking collection admin.system.version as collection version: \nmongodb_1   | 2021-01-09T19:31:17.850+0000 I  SHARDING [initandlisten] Marking collection local.startup_log as collection version: \nmongodb_1   | 2021-01-09T19:31:17.851+0000 I  FTDC     [initandlisten] Initializing full-time diagnostic data capture with directory '/data/db/diagnostic.data'\nmongodb_1   | 2021-01-09T19:31:17.855+0000 I  SHARDING [LogicalSessionCacheRefresh] Marking collection config.system.sessions as collection version: \nmongodb_1   | 2021-01-09T19:31:17.856+0000 I  NETWORK  [initandlisten] Listening on /tmp/mongodb-27017.sock\nmongodb_1   | 2021-01-09T19:31:17.857+0000 I  NETWORK  [initandlisten] Listening on 0.0.0.0\nmongodb_1   | 2021-01-09T19:31:17.857+0000 I  NETWORK  [initandlisten] waiting for connections on port 27017\nmongodb_1   | 2021-01-09T19:31:17.858+0000 I  SHARDING [LogicalSessionCacheReap] Marking collection config.transactions as collection version: \nmongodb_1   | 2021-01-09T19:31:18.004+0000 I  SHARDING [ftdc] Marking collection local.oplog.rs as collection version: \n`\n```\nI think, I need to install sharp on docker for pre-built proccess.\nI didn't understand how docker works very well. it has to do with my amateurishness that I live with.\nRelation Issue :\nlinux-x64 binaries cannot be used on the linuxmusl-x64 platform error",
      "solution": "Alpine uses musl for its C library. You can either use a different non-alpine based image such as `node:12-buster-slim` or any of the other non-Alpine tags here, or try to get it to work by setting up glibc with the instructions here. Using a Debian or Ubuntu based image would be the easiest way forward.",
      "question_score": 10,
      "answer_score": 4,
      "created_at": "2021-01-09T20:03:48",
      "url": "https://stackoverflow.com/questions/65646514/express-sharp-install-via-docker-issue"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 70752770,
      "title": "Helmet Express ERR_BLOCKED_BY_RESPONSE.NotSameOrigin 200",
      "problem": "please I need help, I checked on all google and not get really answer for to open my issue.\nI want to use helmet to secure my express server. But when I am using it I get this error : ERR_BLOCKED_BY_RESPONSE.NotSameOrigin 200 for loaded my images from my database.\nthis is my server express :\n```\n`// Initialize server\nconst app = express()\napp.use(express.urlencoded({ extended: true }));\napp.use(express.json());\napp.use(cookieParser());\napp.use(cors())\napp.use(helmet())\n\n// CORS configuration\napp.use(function (req, res, next) {\n    res.header(\"Access-Control-Allow-Origin\", \"*\");\n    res.header(\"Access-Control-Allow-Headers\", \"Origin, X-Requested-With, Content-Type, Accept\");\n    next();\n});\n`\n```\nI am getting my images from my database so the url in localhost is :  http://localhost:3000/image/\nWhen i am not using helmet all works fine.\nPlease any help",
      "solution": "tl;dr: disable the `Cross-Origin-Embedder-Policy` header, enabled by default in Helmet v5.\n`app.use(\n  helmet({\n    crossOriginEmbedderPolicy: false,\n    // ...\n  })\n);\n`\n\nHelmet maintainer here.\nHelmet sets the the `Cross-Origin-Embedder-Policy` HTTP response header to `require-corp`.\nSetting this header means that loading cross-origin resources (like an image from another resource) is trickier. For example, loading a cross-origin like this...\n`\n`\n...won't work unless `example.com` explicitly allows it, by setting some response headers of its own. Your browser will try to load `example.com/image.png`, and if it's not explicitly allowed, your browser will drop the response.\nTo fix this, you can prevent Helmet from setting the `Cross-Origin-Embedder-Policy` header, like this:\n`app.use(\n  helmet({\n    crossOriginEmbedderPolicy: false,\n    // ...\n  })\n);\n`\nI made a small sample app you can use to play around with this. In my testing, it doesn't seem to work in HTTP but it does over HTTPS, which might explain why things only break in production.",
      "question_score": 9,
      "answer_score": 27,
      "created_at": "2022-01-18T09:56:03",
      "url": "https://stackoverflow.com/questions/70752770/helmet-express-err-blocked-by-response-notsameorigin-200"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 69832906,
      "title": "How to prevent ERR_BLOCKED_BY_RESPONSE.NotSameOriginAfterDefaultedToSameOriginByCoep?",
      "problem": "I am attempting to access my movie API that returns data including an image of a movie poster through a React application. This image is being requested from an external website. Each time I make a request to my `\\movies` endpoint, the image is blocked and I get the following message in the console\n`net::ERR_BLOCKED_BY_RESPONSE.NotSameOriginAfterDefaultedToSameOriginByCoep 200`\nWhen looking at the request in the Network tab, I get the following message saying to enable a Cross-Origin Resource Policy\n```\n`Because your site has the Cross-Origin Embedder Policy (COEP) enabled, each resource must specify a suitable Cross-Origin Resource Policy (CORP). This behavior prevents a document from loading cross-origin resources which don\u2019t explicitly grant permission to be loaded.\nTo solve this, add the following to the resource\u2019s response header:\nCross-Origin-Resource-Policy: same-site if the resource and your site are served from the same site.\nCross-Origin-Resource-Policy: cross-origin if the resource is served from another location than your website. \u26a0\ufe0fIf you set this header, any website can embed this resource.\n`\n```\nI am using the CORS npm module which had previously been used to solve my issue with an Access-Control-Allow-Origin error. I added some additional middleware to try and add the header as instructed. This is the app.js server with that code\nApp.js\n```\n`'use strict';\nimport express, { json, urlencoded } from 'express';\nimport morgan from 'morgan';\nimport mongoose from 'mongoose';\nimport passport from 'passport';\nimport cors from 'cors';\nimport dotenv from 'dotenv';\nimport auth from './routes/auth.js';\nimport routes from './routes/routes.js';\n\ndotenv.config();\n\nconst app = express();\n\nmongoose\n    .connect(process.env.CONNECTION_URL, {\n        useNewUrlParser: true,\n        useUnifiedTopology: true,\n    })\n    .then(res => console.log('DB Connected!'))\n    .catch(err => console.log(err, err.message));\n\napp.use(cors())\n\napp.use((req, res, next) => {\n  res.header(\"Cross-Origin-Resource-Policy\", \"cross-origin\")\n  next()\n})\n\napp.use(passport.initialize());\napp.use(json());\napp.use(urlencoded({ extended: true }));\napp.use(express.static(`public`));\napp.use(morgan('common'));\n\nauth(app);\nimport './authentication/passport.js';\n\nroutes(app)\n\napp.use((req, res, err, next) => {\n    if (err) {\n        console.error(err.stack);\n        res.status(500).send('Something broke!');\n    }\n    next();\n});\n\nconst port = process.env.PORT || 3000;\n\napp.listen(port, '0.0.0.0', () => console.log(`Listening on Port ${port}`));\n\n`\n```\nAfter doing this, the console throws the same error and the Cross-Origin Resource Policy still is not set. Is there something wrong with my approach or the way that I have my file structured?",
      "solution": "You have COEP enabled in the client:\n```\n`Cross-Origin-Embedder-Policy: require-corp\n`\n```\nThis is a great security feature that means:\n\nCOEP: Everything (data, scripts, images etc) on this website is either mine, or I fetch it from other sites using CORS. (There can be a third way, that is data being authorized by cookies, http-auth, etc... which is not in our discussion, so don't bother here.)\n\nSo, you have two options. The first one is to disable COEP, but I assume that you don't want to do that. So, the other option is to use CORS for everything external. For example, when you fetch something, use:\n```\n`fetch('https://externalwebsite.com/image.jpg',{mode:'cors'})\n`\n```\nor, to embed an external image in the HTML, use crossorigin\n```\n`\n`\n```\nNote that `crossorigin` attribute in `` means CORS. If it is missing, it means \"no-cors\", which is the default. Be aware though: When you use JavaScript's `fetch`, the default is `{mode:'cors'}`, i.e. the opposite!\nNow, if you try to do that (use CORS, as you should), the browser will throw another error:\n```\n`Access [...] has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.\n`\n```\nThat means... exactly that! That the external server has to send the header:\n```\n`Access-Control-Allow-Origin: *\n`\n```\nThat setting means that every website can use the server's resources (API in your case), as long as it does not use/send/receive cookies in the request (because... security). The way to implement this in your express server is to set:\n```\n`res.header('Access-Control-Allow-Origin', '*');\n`\n```\nEvery server that intends to serve things to other websites, must have this ACAO header. (You can place your other website instead of \"*\" if you want only that website to access your API.)\nNote/Summary:\nIf the external server has this ACAO header, you can fetch things using CORS/crossorigin. If it does not have ACAO header, you can fetch things with no-cors / without crossorigin. But with COEP enabled in your website, you can only fetch with CORS/crossorigin, so the external server has to have an ACAO.\nNow,\nAs for the `Cross-Origin-Resource-Policy` that your server has, have in mind that (https://developer.mozilla.org/en-US/docs/Web/HTTP/Cross-Origin_Resource_Policy_(CORP)):\n\nThe policy is only effective for no-cors requests\nDuring a cross-origin resource policy check, if the header is set, the browser will deny no-cors requests issued from a different origin/site.\n\nThis means that, since you make only CORS requests to that server, this header doesn't do anything (in your case). So the server can set it to \"same-site\"/\"same-origin\" for security reasons that are beyond this topic.",
      "question_score": 9,
      "answer_score": 31,
      "created_at": "2021-11-04T00:32:51",
      "url": "https://stackoverflow.com/questions/69832906/how-to-prevent-err-blocked-by-response-notsameoriginafterdefaultedtosameoriginby"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 70126591,
      "title": "Jest test failing with &#39;connect ECONNREFUSED 127.0.0.1:80&#39; when app is listening on port 3000 (express and supertest)",
      "problem": "I am struggling to resolve a bug in my jest test using supertest, I think it is an issue with my test rather than my code.\nMy issue\nI am trying to create a back end API using node.js and express, using TDD. I have the following files to set up the server:\n```\n`//in app.js\nconst express = require('express');\nconst app = express();\n\napp.post('api/1.0/users', (req, res) => {\n  return res.send();\n});\n\nmodule.exports = app;\n\n//in index.js\nconst app = require('./app');\nconst port = 3000;\n\napp.listen(port, () => console.log(`listening on port: ${port}`));\n`\n```\nWhen I run the server, it successfully runs on port 3000. However when I run the following test:\n```\n`//in UserRegister.test.js\nconst request = require('supertest');\nconst app = require('../app'); //this is in a __tests__ subdir hence '..'\n\nit('returns 200 OK when sign-up request is valid', (done) => {\n  request(app)\n    .post('api/1.0/users')\n    .send({\n      first_name: 'person',\n      last_name: 'one',\n      password: '123',\n    })\n    .expect(200, done);\n});\n`\n```\nThe Problem\nI get the error `connect ECONNREFUSED 127.0.0.1:80`.\nI think this is telling me that the test is looking to connect to port 80, however there is no server set up on port 80 so the connection is refused, but it should be trying to connect to port 3000.\nWhat I have attempted\n\nAll packages are appropriately installed to the best of my knowledge\nI tried a hacky solution of getting my server to listen on port 80 but that raises the same issue.\nreading the supertest docs to try alternate solutions\nTried the following different syntax in case it was an obvious syntax issue I was misinterpreting:\n\n```\n`it('returns 200 OK when sign-up request is valid', async () => {\n  const response = await request(app).post('api/1.0/users')\n  .send({\n      first_name: 'person',\n      last_name: 'one',\n      password: '123',\n    })\n  expect(response.statusCode).toEqual(200);\n});\n`\n```\nWhat am I missing? I am increasingly confident it is my lack of understanding of how supertest works but I can't seem to understand what the issue is.\nI am simply looking for the test to either pass or fail (either by getting a 200 or 404 response), but only once it has connected to the correct port (i.e. I am stuck the first hurdle).",
      "solution": "The problem is the URI. I just tried a test that url does not start using `/` and got the same error. So instead\n```\n`.post('api/1.0/users')\n`\n```\nto use\n```\n`.post('/api/1.0/users')\n`\n```\nmay solve the problem.",
      "question_score": 9,
      "answer_score": 23,
      "created_at": "2021-11-26T16:16:54",
      "url": "https://stackoverflow.com/questions/70126591/jest-test-failing-with-connect-econnrefused-127-0-0-180-when-app-is-listening"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 69430093,
      "title": "How to set equivalent of fetch&#39;s { credentials: &quot;include&quot; } in Redux Toolkit&#39;s createApi?",
      "problem": "I have an express-react-typescript-redux-passport project where I am using `createApi` from redux toolkit to call a `/getuser` api on my backend.\nI'm using `passport-google-oauth20` strategy to authenticate users, and the user is successfully authenticated.\nMy issue is that passport js `deserializeUser()` function is not called (even though the `serializeUser()` is called, and the user is authenticated using google strategy), so the `req.user` parameter is not set automatically when the front end sends requests to the back end.\nI suspect that `deserializeUser` isn't being called because the I haven't set axio's `{ withCredentials: true }` (or fetch's `{credentials: \"include\"}`) parameter in my `createApi` endpoint. How can I sent this parameter in RTK's createApi?\nHow do I specify credentials: include here?\nHere is my createApi function\n`export const userApiSlice = createApi({\n  reducerPath: \"api\",\n  baseQuery: fetchBaseQuery({\n    baseUrl: \"http://localhost:4000\",\n    prepareHeaders(headers) {\n      return headers;\n    },\n  }),\n  endpoints(builder) {\n    // debugger;\n    return {\n      fetchUser: builder.query({\n        query: () => {\n          debugger;\n          return `/getuser`;\n        },\n      }),\n    };\n  },\n});\n`\nHere is my server index.js\n`import express from \"express\";\nimport mongoose from \"mongoose\";\nimport cors from \"cors\";\nimport session from \"express-session\";\nimport passport from \"passport\";\n\nvar GoogleStrategy = require(\"passport-google-oauth20\").Strategy;\nimport { IGoogleAuthUser } from \"./types/authTypes\";\nconst PORT = process.env.PORT || 4000;\n\nrequire(\"dotenv\").config();\n\nconst app = express();\n\nmongoose.connect(process.env.LOCAL_DB_ADDRESS, () => {\n  console.log(\"connected to mongoose db\");\n});\n\napp.use(express.json());\napp.use(cors({ origin: \"http://localhost:3000\", credentials: true }));\n\napp.use(\n  session({\n    secret: process.env.SESSION_SECRET,\n    resave: true,\n    saveUninitialized: true,\n  })\n);\napp.use(passport.initialize());\napp.use(passport.session());\n\npassport.serializeUser((user: IGoogleAuthUser, done: any) => {\n  //send a cookie to browser to store user id in session\n  const { id} = user;\n  console.log(\"serializeUser called\");\n  return done(null, id);\n});\n\n// why isn't this called???\npassport.deserializeUser((userId: string, done: any) => {\n  //attaches the cookie id from session to req.user\n  console.log(\"deserializeUser userId : \", userId);\n  return done(null, userId);\n});\n\n//google strategy\npassport.use(\n  new GoogleStrategy(\n    {\n      clientID: process.env.GOOGLE_CLIENT_ID,\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET,\n      callbackURL: \"/auth/google/callback\",\n    },\n    function (accessToken: any, refreshToken: any, profile: any, done: any) {\n      //this is called on succesful authentication with the above Google Stratety     \n      console.log(\"successful authorization\");\n      done(null, profile);\n    }\n  )\n);\n\n//when user clicks on 'login with google' /auth/google is hit\napp.get(\n  \"/auth/google\",\n  passport.authenticate(\"google\", { scope: [\"profile\", \"email\"] }),\n  (req, res) => {\n    console.log(\"/auth/google called\"); //this console.log does not get called, not sure why\n  }\n);\n\napp.get(\n  \"/auth/google/callback\",\n  passport.authenticate(\"google\", {\n    successRedirect: \"http://localhost:3000/profile\",\n    failureRedirect: \"http://localhost:3000/login\",\n  }),\n  function (req, res) {\n    // console.dir(req);\n    // Successful authentication, redirect home.\n    console.log(\"redirect to profile\"); //this does get called\n    res.redirect(\"http://localhost:3000/profile\"); \n  }\n);\n\napp.get(\"/\", (req, res) => {\n  res.send(\"Hello world.\");\n});\n\napp.get(\"/getuser\", (req: any, res: any) => {\n  //req should have user thanks to serializer/deserializer\n  console.log(req.user); // => returns undefined even after successful authentication\n  res.send(req.user);\n});\n\napp.listen(PORT, () => {\n  console.log(`Server Started on ${PORT}`);\n});\n\n`\nWhy isn't `deserializeUser()` being called??",
      "solution": "`fetchBaseQuery` is just a wrapper around `fetch` with some extra options.\nSo it's either\n`  baseQuery: fetchBaseQuery({\n    baseUrl: \"http://localhost:4000\",\n    prepareHeaders(headers) {\n      return headers;\n    },\n    credentials: \"include\"\n  }),\n`\nor\n`        query: () => {\n          return { url: `/getuser`, credentials: \"include\" };\n        },\n`",
      "question_score": 9,
      "answer_score": 21,
      "created_at": "2021-10-04T03:27:57",
      "url": "https://stackoverflow.com/questions/69430093/how-to-set-equivalent-of-fetchs-credentials-include-in-redux-toolkits-c"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 72584745,
      "title": "Having problem deploying express server on vercel [404 page not found]",
      "problem": "I tried to deploy my express server on vercel to solve cors problem on my front code.\nThe problem is 404 error pops up when I enter the deployed page:\n\nbut it goes well when I try on localhost.\n```\n`// vercel.json       \n{\n      \"version\": 2,\n      \"builds\": [\n        {\n          \"src\": \"./index.js\",\n          \"use\": \"@vercel/node\"\n        }\n      ],\n      \"routes\": [\n        {\n          \"src\": \"/(.*)\",\n          \"dest\": \"/\"\n        }\n      ],\n      \"rewrites\": [{ \"source\": \"/api/(.*)\", \"destination\": \"/api\" }]\n    }\n\n//index.js\nconst express = require(\"express\");\nconst cors = require(\"cors\");\nconst axios = require(\"axios\");\n\nconst app = express();\n\nconst PORT = process.env.PORT || 3000;\nrequire(\"dotenv\").config();\n\nlet corsOptions = {\n  origin: [\"http://localhost:3000\", \"https://humanscape-team5a.netlify.app\"],\n};\n\napp.use(cors(corsOptions));\n\napp.get(\"/\", (req, res) => {\n  const textQuery = req.query.searchText;\n  const numOfRowsQuery = req.query.numOfRows;\n\n  axios\n    .get(\n      \"http://apis.data.go.kr/B551182/diseaseInfoService/getDissNameCodeList\",\n      {\n        params: {\n          sickType: 1,\n          medTp: 2,\n          diseaseType: \"SICK_NM\",\n          searchText: textQuery,\n          ServiceKey: process.env.KEY,\n          numOfRows: numOfRowsQuery,\n          _type: \"json\",\n        },\n      }\n    )\n    .then(response => res.send(response.data));\n});\n\napp.listen(PORT, () => {\n  console.log(`Server running on ${PORT}`);\n});\n`\n```\nAs it works on localhost, I guess it is kind of vercel setting problem.\nAny thoughts?",
      "solution": "Not sure if you're still looking for a solution, but I did resolve this after some significant trial and error.\nFirst and foremost, vercel seems to require an `/api` folder with an `index.js` file in it to work. Originally, I got confused because my index.js file was also used to start my server when working locally. Vercel is basically taking the place of whatever your server file is locally. You should still leave this for local testing, but you can basically ignore it when working with vercel.\nIn your `/api/index.js` file you will house your routes.\n```\n`./api/index.js\n\nvar createError = require('http-errors');\nvar express = require('express');\nvar path = require('path');\nvar cookieParser = require('cookie-parser');\nvar logger = require('morgan');\n\nvar indexRouter = require('../routes/index');\n\nvar app = express();\n\nconst whitelist = [\n  '*'\n];\n\napp.use((req, res, next) => {\n  const origin = req.get('referer');\n  const isWhitelisted = whitelist.find((w) => origin && origin.includes(w));\n  if (isWhitelisted) {\n    res.setHeader('Access-Control-Allow-Origin', '*');\n    res.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS, PUT, PATCH, DELETE');\n    res.setHeader('Access-Control-Allow-Headers', 'X-Requested-With,Content-Type,Authorization');\n    res.setHeader('Access-Control-Allow-Credentials', true);\n  }\n  // Pass to next layer of middleware\n  if (req.method === 'OPTIONS') res.sendStatus(200);\n  else next();\n});\n\nconst setContext = (req, res, next) => {\n  if (!req.context) req.context = {};\n  next();\n};\napp.use(setContext);\n\napp.use('/', indexRouter);\n\nmodule.exports = app;\n\n`\n```\nand my `vercel.json` file is...\n```\n`// vercel.json\n\n{\n   \"version\": 2,\n   \"builds\": [\n    {\n        \"src\": \"./index.js\",\n        \"use\": \"@vercel/node\"\n    }\n   ],\n   \"routes\": [\n    {\n        \"src\": \"/(.*)\",\n        \"dest\": \"/\"\n    }\n   ]\n}\n`\n```\nNot sure if this is helpful, but this worked for me. The big thing is nesting your index.js routes file in an api folder.",
      "question_score": 9,
      "answer_score": 9,
      "created_at": "2022-06-11T15:28:26",
      "url": "https://stackoverflow.com/questions/72584745/having-problem-deploying-express-server-on-vercel-404-page-not-found"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 65890616,
      "title": "Helmet causing MERN app hosted on heroku cause ERROR: Refused to execute inline script because it violates the following",
      "problem": "I have hosted my MERN app on Heroku , but whenever I implement helmet in app.js file it's causing this issue.\n```\n`const path = require('path');\nconst express = require('express');\nconst morgan = require('morgan');\nconst cookieParser = require('cookie-parser');\n// const cors = require('cors');\nconst rateLimit = require('express-rate-limit');\nconst helmet = require('helmet');\nconst mongoSanitize = require('express-mongo-sanitize');\nconst expressSanitizer = require('express-sanitizer');\nconst xss = require('xss-clean');\nconst hpp = require('hpp');\nconst compression = require('compression')\n\nconst authRouter = require('./routes/authRoutes');\n\nconst app = express();\n// IMPLEMENT CORS\n// app.use(cors());\n// app.options('*', cors());\napp.use((req, res, next) => {\n   res.header('Access-Control-Allow-Origin', '*');\n   res.header(\n      'Access-Control-Allow-Headers',\n      'Origin, X-Requested-With, Content-Type, Accept, Authorization'\n   );\n   if (req.method === 'OPTIONS') {\n      res.header('Access-Control-Allow-Methods', 'PUT, GET, POST, PATCH, DELETE');\n      return res.status(200).json({});\n   }\n   return next();\n});\n\n//SECURITY\n// app.use(helmet());  App is running fine in local environment but helmet causes the ERROR:\n\nRefused to execute inline script because it violates the following\nContent Security Policy directive: \"script-src 'self'\". Either the\n'unsafe-inline' keyword, a hash\n('sha256-c8oXMAC5SpSNhKqLeKnZuBIrD93BdSvpZ47lOJrkmFE='), or a nonce\n('nonce-...') is required to enable inline execution.\n\nI also tried fixing it by following this:\n\ncreate a .env file in project root\nAdd variable as follows: `INLINE_RUNTIME_CHUNK=false`\nBuild the project again and load the extension again.\n\nBut it doesn't help. Please guide me how can I fix it and also what would be best way to implement other security measures in my app?",
      "solution": "Helmet maintainer here.\nThis is happening because of something called Content Security Policy, which Helmet sets by default. To solve your problem, you will need to configure Helmet's CSP.\nMDN has a good documentation about CSP which I would recommend reading for background. After that, take a look at Helmet's README to see how to configure its CSP component.\nTo give some help specific to this question: this error is telling you that the `script-src` directive of your CSP does not allow inline JavaScript, and so it was blocked.\nThis is considered \"inline\" JavaScript:\n```\n`console.log('hello world!')\n`\n```\nThis, however, is not:\n```\n`\n`\n```\nThere are several ways to fix this:\n\nAdd a hash or nonce to the inline `` and use that in your CSP. See this example on MDN for help.\n\nRefactor your app to avoid inline scripts entirely.\n\nUpdate your CSP to allow unsafe inline scripts. You'd do something like this:\n```\n`app.use(\n  helmet({\n    contentSecurityPolicy: {\n      directives: {\n        ...helmet.contentSecurityPolicy.getDefaultDirectives(),\n        \"script-src\": [\"'self'\", \"'unsafe-inline'\", \"example.com\"],\n      },\n    },\n  })\n);\n`\n```\nNote that this is considered unsafe.\n\nDisable CSP. This is the most dangerous option so I don't recommend it.\n```\n`app.use(\n  helmet({\n    contentSecurityPolicy: false,\n  })\n);\n`\n```\n\nIn summary: to solve your problem, you will need to tell Helmet to configure your CSP.",
      "question_score": 9,
      "answer_score": 17,
      "created_at": "2021-01-25T19:46:34",
      "url": "https://stackoverflow.com/questions/65890616/helmet-causing-mern-app-hosted-on-heroku-cause-error-refused-to-execute-inline"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 69120374,
      "title": "How can I upload file and also include JSON data with Fetch API?",
      "problem": "Hope you're having a good day. So I'm using Fetch API to upload files to server but I also want to include a string as JSON for my backend. But I'm unable to do so.\nRight now this is what my upload-file function looks like. This works perfectly if I want to just upload a file and not include a string as JSON:\n```\n`const uploadFile = ( e ) => {\n\n    const uploadedFile = e.target.files[ 0 ];\n    const formData     = new FormData();\n\n    formData.append( 'data', uploadedFile );\n\n    const rawResponse = await fetch( '/upload-file', {\n          method: 'POST',\n          body: formData\n    });\n    \n};\n\nuploadFile();\n`\n```\nGetting the file in my NodeJS backend with `req.files.data`;\nBut if I include a string as JSON and try to upload file then I get undefined in my NodeJS backend. This is how it looks like with string as JSON:\n```\n`const uploadFile = ( e ) => {\n\n    const uploadedFile = e.target.files[ 0 ];\n    const formData     = new FormData();\n    const str          = 'from client';\n\n    formData.append( 'data', uploadedFile );\n\n    const rawResponse = await fetch( '/upload-file', {\n          method: 'POST',\n          body: {\n                file: formData,\n                str \n          }\n    });\n    \n};\n\nuploadFile();\n`\n```\nNow if I want to get the file in my backend with:\n`req.files.file`, I get `undefined`.\n`req.body`, I get `{ 'object Object': '' }`.\n`req.files.data`, I get `UnhandledPromiseRejectionWarning: TypeError: Cannot read property 'data' of undefined`.\n`req.body.data`, I get `undefined`.\nWhat is going wrong here?",
      "solution": "you append it to `FormData`, not body\n```\n`const uploadFile = ( e ) => {\n\n    const uploadedFile = e.target.files[ 0 ];\n    const formData     = new FormData();\n    const str          = 'from client';\n\n    formData.append( 'data', uploadedFile );\n    formData.append( 'str', str );\n\n    const rawResponse = await fetch( '/upload-file', {\n          method: 'POST',\n          body: formData\n    });\n    \n};\n\nuploadFile();\n`\n```",
      "question_score": 9,
      "answer_score": 13,
      "created_at": "2021-09-09T16:51:24",
      "url": "https://stackoverflow.com/questions/69120374/how-can-i-upload-file-and-also-include-json-data-with-fetch-api"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 68459611,
      "title": "How to fix &quot;unsafe-eval&quot; error with Vue3 for the client-side version?",
      "problem": "I'm using Express, cors, and helmet for my app. Vue3 is used on the client-side only and the library file is self-hosted in the public folder. I simply do\n```\n`\n`\n```\nto add the module to the client-side. The problem is that when I use it, it keeps giving me an `Uncaught EvalError: Refused to evaluate a string as JavaScript because 'unsafe-eval' is not an allowed source of script in the following Content Security Policy directive: \"script-src 'self'\"`. This problem started yesterday suddenly, when I started using the helmet and cors modules, and even if I comment out these modules, it still shows the error. What should I fix?",
      "solution": "Yes, vue.js uses a piece of code like this:\n`// detect possible CSP restriction\ntry {\n  new Function('return 1')\n} catch (e: any) {\n  if (e.toString().match(/unsafe-eval|CSP/)) {\n    warn(\n      'It seems you are using the standalone build of Vue.js in an ' +\n      'environment with Content Security Policy that prohibits unsafe-eval. ' +\n      'The template compiler cannot work in this environment. Consider ' +\n      'relaxing the policy to allow unsafe-eval or pre-compiling your ' +\n      'templates into render functions.'\n    )\n  }\n}\n`\nHere you have 2 options:\n\nusage of precompiled templates, see discussion at github.\n\nusing a `vue.runtime.js` runtime version instead of `vue.js` full version.\n\nVueJS has 2 different versions: the full version and the runtime version. 'unsafe-eval' is only needed for the full version of VueJS; the runtime version doesn't need it. See details here.\nThe runtime-only build is fully CSP-compliant. When using the runtime-only build with Webpack + vue-loader or Browserify + vueify, your templates will be precompiled into render functions which work perfectly in CSP environments. See details in Vue CSP environments.",
      "question_score": 9,
      "answer_score": 13,
      "created_at": "2021-07-20T20:15:24",
      "url": "https://stackoverflow.com/questions/68459611/how-to-fix-unsafe-eval-error-with-vue3-for-the-client-side-version"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 66402461,
      "title": "Express - All declarations of &#39;user&#39; must have identical modifiers",
      "problem": "I am making use of `express` and `passport` in my application, In both packages, there's a `user` attribute under the `Request` interface. Currently, `express` has a `user` attribute but no other properties attached to it in the request object, e.g `req.user`. I am trying to do a declaration merge (not really sure if this is the right term for it) for express in order to tell typescript that `Express.Request.user` has an `id` attribute attached to it like so:\n```\n`declare namespace Express {\n  export interface Request {\n    user: {\n      id: string\n    }\n  }\n}\n`\n```\nAt the same time also, `passport` has a `user` attribute but with the value of `Express.User`. When I do that declaration merge above, I get an error that says `All declarations of 'user' must have identical modifiers.` Here's the declaration file for `passport`.\n```\n`interface User {}\n\n        interface Request {\n            authInfo?: AuthInfo;\n            user?: User;\n\n            // These declarations are merged into express's Request type\n            login(user: User, done: (err: any) => void): void;\n            login(user: User, options: any, done: (err: any) => void): void;\n            logIn(user: User, done: (err: any) => void): void;\n            logIn(user: User, options: any, done: (err: any) => void): void;\n\n            logout(): void;\n            logOut(): void;\n\n            isAuthenticated(): this is AuthenticatedRequest;\n            isUnauthenticated(): this is UnauthenticatedRequest;\n        }\n`\n```\nI understand it's because of a mismatch in the interfaces, but how do I overcome this? Any help is welcome. Thank you very much!",
      "solution": "I had the same issue - I managed to get it working by adding properties directly to the `User` interface instead of `Request.user` -\nIn `@types/express/index.d.ts`\n`declare global {\n  namespace Express {\n    interface User {\n      userId: number;\n      name: string;\n      email: string;\n    }\n  }\n}\n`",
      "question_score": 9,
      "answer_score": 7,
      "created_at": "2021-02-27T20:07:05",
      "url": "https://stackoverflow.com/questions/66402461/express-all-declarations-of-user-must-have-identical-modifiers"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 68869339,
      "title": "jest cannot resolve node modules subpath pattern imports",
      "problem": "i build project using node express and using\nhttps://nodejs.org/api/packages.html#packages_subpath_patterns to prevent \"../../../xxx.js\"\nI added this to `package.json` and working perfectly\n```\n`\"imports\": {\n  \"#src/*\": \"./src/*.js\"\n}\n`\n```\nBut the problem when i tried to running test from jest i got this error\n```\n`Cannot find module '#src/config/database.js' from 'src/database/connection.js'\n\n    Require stack:\n      src/database/connection.js\n      test/admin.test.js\n\n      1 | import { MongoClient } from \"mongodb\";\n    > 2 | import databaseConfig from \"#src/config/database.js\";\n        | ^\n\n      at Resolver.resolveModule (node_modules/jest-resolve/build/resolver.js:311:11)\n      at Object. (src/database/connection.js:2:1)\n`\n```\nI don't know how to solve this issue, tried to find solution from googling and documentation cannot find similar problem with this",
      "solution": "Add this in your Jest Configuration (e.g. jest.config.json)\n```\n`\"moduleNameMapper\": {\n    \"#src/(.*)\": \"/src/$1\"\n}\n`\n```\nSee the moduleNameMapper attribute in Jest configuration docs.",
      "question_score": 9,
      "answer_score": 12,
      "created_at": "2021-08-21T02:52:25",
      "url": "https://stackoverflow.com/questions/68869339/jest-cannot-resolve-node-modules-subpath-pattern-imports"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 67546789,
      "title": "Handle Prisma errors with Express",
      "problem": "I am having some issues with error handling using ExpressJS and Prisma. Whenever a Prisma Exception occurs, my entire Node application crashes, and I have to restart it. I have done some googling and have looked at the Prisma Docs for error handling, but I can't find any answers.\nI know I could possibly use `try` and `catch`, but this feels unnecessary, as I could handle this much better with an error handler, especially when a lot of information on errors is passed through Prisma.\nI have tried to implement the Express error handler like this:\n```\n`// index.ts\n\nimport errorHandler from \"./middleware/errorHandler\";\n...\nserver.use(errorHandler);\n\n// errorHandler.ts\n\nimport { NextFunction, Response } from \"express\";\n\n// ts-ignore because next function is required for some weird reason\n// @ts-ignore\nconst errorHandler = (err: any, _: any, res: Response, next: NextFunction) => {\n    console.error(err.stack);\n    res.status(500).send(\"Internal Server Error\");\n};\n\nexport default errorHandler;\n`\n```\nThis works fine for normal errors, but doesn't execute for Prisma errors, but instead just crashes the Node application.\nHow can I implement an error handler so I can manage Prisma Expections?",
      "solution": "I ran into this problem today and I couldn't find answers too. I believe we'll have to write our own custom error handler for Prisma exceptions and not throw the error.\n```\n`try {\n  await prismaOperation();\n} catch(e) {\n  throw e; // avoid this which will crash our app\n  /* Process Prisma error with error codes\n     and prepare an appropriate error message\n  */\n  const error = prismaCustomErrorHandler(e);\n  res.send(error); // Sending response instead of passing it to our default handler\n}\n`\n```\nAlso,\n\n// ts-ignore because next function is required for some weird reason\n\nIn Express, error-handling functions have 4 arguments instead of 3: `(err, req, res, next)`.\nExpress interprets a middleware function with 3 arguments as `(req, res, next)` which is different from, had you ommited the 4th argument, `(err, _, res)`. Hence, Express won't pass any error and your `err` will be a `req` object, `_` (req) a `res` object and `res` a `next` function.\nEdit:\n```\n`...\nconst error = prismaCustomErrorHandler(e);\n  res.send(error); // Sending response instead of passing it to our default handler\n...\n\n// Edit: Or you could process and pass the error using `next(error)` to default error handler.\n\n`\n```\nThe above method won't crash the app and indeed sends the response. But whether you use `next` or `res.send`, errors have to be processed.",
      "question_score": 9,
      "answer_score": 8,
      "created_at": "2021-05-15T14:36:13",
      "url": "https://stackoverflow.com/questions/67546789/handle-prisma-errors-with-express"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 68987508,
      "title": "Server&#39;s socket.io listener fires twice for no apparent reason",
      "problem": "I'm building an app with a chat feature using express.js, react.js and socket.io. Here is a minimal version with the bug reproduced on Github.\nThe problem is the server's `socket.on()` always fires twice, for no reason that is apparent to me.\nAs far as I can tell the client only ever sends a single `.emit`, but the server's `.on` always fires twice (and I'm fairly certain that event handler isn't bound twice), regardless of how many clients are connected, or indeed how I've refactored the code.\nThe sending client's form (input + button) appends the message to its local messages list and then dispatches `MESSAGE_NEW` to the reducer.\nHere's first the `Socket.js` file.\n```\n`import React from 'react'\nimport socketio from 'socket.io-client'\n\nexport const socket = socketio.connect('ws://localhost:3001')\nexport const SocketContext = React.createContext()\n`\n```\nAnd here is the submit handler code from `Chat.js` (this seems to work correctly, dispatching just once):\n```\n`const handleSubmit = e => {\n  e.preventDefault()\n\n  if (message === '') return\n\n  setMessages(messages => [...messages, message])\n  dispatch({ type: 'MESSAGE_NEW', payload: message })\n  setMessage('')\n}\n`\n```\nHere's `/Reducer.js`, which `.emit`'s the signal (also seems to work fine, firing just once).\n```\n`import { useContext } from 'react'\nimport { SocketContext } from './Socket'\n\nexport default function Reducer(state, action) {\n  const socket = useContext(SocketContext)\n\n  switch (action.type) {\n    case 'MESSAGE_NEW':\n      // this only fires once, as it should\n      console.log('emitting socket')\n      socket.emit('message:new', action.payload)\n      break\n\n    default:\n      return state\n  }\n}\n`\n```\nBut here is the relevant bit from `/server/index.js`, this is where things go wrong. No matter what I've tried, the `.on` always fires twice.\n```\n`io.on('connection', socket => {\n  console.log('New client connected:', socket.id)\n\n  socket.on('message:new', message => {\n    // this always fires twice, i do not understand why\n    console.log('message:new: ', message, socket.id)\n    socket.broadcast.emit('message:new', message)\n  })\n})\n`\n```\nUpdate: I found out that moving the `socket.emit` from `Reducer.js` to `handleSubmit` in `Chat.js` makes it work just fine. I don't understand why since the Reducer doesn't fire twice.",
      "solution": "As per React documentation's on strict mode:\n\nStrict mode can\u2019t automatically detect side effects for you, but it can help you spot them by making them a little more deterministic. This is done by intentionally double-invoking the following functions:\n\nClass component `constructor`, `render`, and `shouldComponentUpdate` methods\nClass component static `getDerivedStateFromProps` method\nFunction component bodies\nState updater functions (the first argument to `setState`)\nFunctions passed to `useState`, `useMemo`, or `useReducer`\n\nNotice the last line: functions passed to `useReducer` will be invoked twice; that is why your message is being sent twice. You can confirm this by updating your reducer like so:\n`  case \"MESSAGE_NEW\":\n      alert(\"I'm running\");\n`\nYou'll notice this alert appearing twice, thanks to `React.StrictMode`.\nIf you remove the `` wrapper in `src/App.js` the `test` message will no longer repeat; however, it's not fixing the underlying issue here.\nThe underlying issue is that you're making your reducer (which should be pure) perform an impure side-effect (in this case, sending a message via a websocket). Additionally, the reducer function also has a `useContext` call \u2013 this is also a no-op from React's perspective and is not good practice.\nAs you've come across in your question, Simply move the `socket.emit` into your `handleSubmit` and you should be good to go. Alternatively, you can consider a more sophisticated setup if you wish to go the reducer route; some popular configurations include Redux + Redux Thunk, or Redux + Redux Saga. Your mileage may vary.",
      "question_score": 9,
      "answer_score": 5,
      "created_at": "2021-08-30T18:36:13",
      "url": "https://stackoverflow.com/questions/68987508/servers-socket-io-listener-fires-twice-for-no-apparent-reason"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 72036447,
      "title": "createObjectURL error: `argument must be an instance of Blob. Received an instance of Blob`",
      "problem": "I have an express route which contains the following:\n```\n`let result = await fetch(\"http://someurl\");\nresult = await result.blob();\nconsole.log(result)\nconst img = URL.createObjectURL(result);\n`\n```\nThis produces the following error (on line 4):\n`TypeError: The \"obj\" argument must be an instance of Blob. Received an instance of Blob`\nWhat's going on here?\nIf it helps, the result of the console.log is:\n```\n`Blob {\n  [Symbol(type)]: 'image/png',\n  [Symbol(buffer)]: \n}\n`\n```\nand the fetch route goes to another express app which calls `res.sendFile(myfilepath)`",
      "solution": "The server-side equivalent of:\n```\n`let result = await fetch(\"http://someurl\");\nresult = await result.blob();\nconsole.log(result)\nconst img = URL.createObjectURL(result);\n`\n```\nis\n```\n`let result = await fetch(\"http://someurl\");\nresult = await result.arrayBuffer();\nconsole.log(result)\nconst img = Buffer.from(result).toString(\"base64\"));\n`\n```\nand the image is then rendered client-side with something similar to:\n```\n`\">\n`\n```\nUsing EJS, for this example; the point here being to translate the image data into base-64 encoded text, which can then be rendered using an image data URI (https://css-tricks.com/data-uris/)\nNote that this sort of hoop-jumping is only required when getting the image data requires some sort of server-side authentication, as in most cases you'd just do:\n`\n`\nI have the following (cut-down) code where images are accessible only after authenticating:\n`export function getImage({ imageUrl, token }) {\n  return fetch(`${apiServer}/${imageUrl}`, {\n    headers: {\n      Authorization: `Bearer ${token}`,\n    },\n  })\n    .then((response) => response.arrayBuffer())\n    .then((blob) => Buffer.from(blob).toString(\"base64\"));\n}\n`",
      "question_score": 9,
      "answer_score": 3,
      "created_at": "2022-04-28T01:48:38",
      "url": "https://stackoverflow.com/questions/72036447/createobjecturl-error-argument-must-be-an-instance-of-blob-received-an-instan"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 72575401,
      "title": "How can I download a file from frontend with Authorization Header",
      "problem": "Here is my backend code. It has 2 protected routes. Authorization Header is needed (Bearer token).\n\nThese routes allows you to download your photo and your cv.\n\nI have no issue with my backend. It is working with postman and mobile applications. I think there is a limitation for frontend.\nI do NOT want\n\nI don't want to use fetch to download these files as blob. Because it doesn't allow to browser to show its progress bar.\nI don't want to change my authentication method from Bearer token to cookie. I can already do this with cookie.\n\nI wonder why Bearer token is more popular than cookie If I have to use cookie to make this happen.\nBackend\n`// other imports .....\nconst path = require('path');\nconst fs = require('fs');\nconst express = require('express');\nconst app = express();\n\napp.use((req, res, next) => {\n  try {\n    const token = req.get('Authorization');\n    if(!token) {\n      throw new Error('401');\n    }\n    const userId = getIdFromToken(token);\n    if(!userId) {\n      throw new Error('401');\n    }\n    res.locals.userId = userId;\n    next();\n  } catch (error) {\n    next(error);\n  }\n})\napp.get('/api/me/photo', (req, res) => {\n  const userId = res.locals.userId;\n  \n  const imagePath = path.resolve(process.env.DISC_PATH, 'images', `${userId}.png`);\n  res.attachment('me.png');\n  res.set('Content-Type', 'image/png');\n  const stream = fs.createReadStream(imagePath);\n  res.pipe(stream);\n})\n\napp.get('/api/me/cv', (req, res) => {\n  const userId = res.locals.userId;\n  \n  const pdfPath = path.resolve(process.env.DISC_PATH, 'cv', `${userId}.png`);\n  res.attachment('my-cv.pdf');\n  res.set('Content-Type', 'application/pdf');\n  const stream = fs.createReadStream(pdfPath);\n  res.pipe(stream);\n})\n\n...\n\n// error handling, etc...\n\n`\nFrontend\n`\n\nDownload My CV\n\n Download My CV (V2) \n\n  const btn = document.getElementById('btn');\n  btn.addEventListener('click', () => {\n    // How can I send the Authorization header here\n    window.open('/api/me/cv');\n  });\n\n`",
      "solution": "I wonder why Bearer token is more popular than cookie If I have to use cookie to make this happen.\n\nOne advantage of an `Authorization: Bearer` header over cookie-based authentication is precisely that the browser does not automatically include the header in a request to the given URL. So you cannot be tricked into clicking on a link that would trigger an authenticated request that you did not intend.\nIn other words: With `Authorization: Bearer` as authentication mechanism you are safe from \"cross-site request forgery\" (CSRF) attacks.\nBackends that use cookie-based authentication have to implement extra countermeasures against CSRF.\nFor your problem, this means that the two don't go together. If you want the convenience of a \"normal\" browser request (with its progress bar), you expose the user to CSRF, unless you take said countermeasures. (This may not be a serious threat if the request only downloads something. But an attacker could at least measure the running time of the CV download request and deduce something from that.)\nPossible workaround:\nImplement an API (authenticated with `Authorization: Bearer` header) that generates a download URL which includes a short-lived token, and have the browser download the desired document with a normal request to that URL. The second request is technically unauthenticated, but the token makes the URL unguessable.\nIf the token is a JWT, you need not even store it on your server but can simply write the username and expiry time in it and sign it with the server's private key. If you prefer you can also put the token in a cookie rather than in the URL.",
      "question_score": 9,
      "answer_score": 4,
      "created_at": "2022-06-10T15:48:48",
      "url": "https://stackoverflow.com/questions/72575401/how-can-i-download-a-file-from-frontend-with-authorization-header"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 65599791,
      "title": "MongooseError: Operation `orders.deleteMany()` buffering timed out after 10000ms",
      "problem": "when I run my app with `npm run seeder`\nthen I have face this error\nI have checked my database connection carefully, it's ok.\nalso, I have checked my ordermodels file it's also ok. I have used MongoDB compass there is nothing problem. I don't know why showing `buffering timed out`.\n```\n`MongooseError: Operation `orders.deleteMany()` buffering timed out after 10000ms\n`\n```\n\nseeder.js\n\n```\n`    import mongoose from \"mongoose\";\n    import dotenv from \"dotenv\";\n    import colors from \"colors\";\n    import users from \"./data/users.js\";\n    import products from \"./data/products.js\";\n    import User from \"./models/userModel.js\";\n    import Product from \"./models/productModel.js\";\n    import Order from \"./models/orderModel.js\";\n    import connectDB from \"./config/db.js\";\n    \n    dotenv.config();\n    connectDB();\n    \n    const importData = async () => {\n      try {\n        await Order.deleteMany();\n        await Product.deleteMany();\n        await User.deleteMany();\n    \n        const createUsers = await User.insertMany(users);\n        const adminUser = createUsers[0]._id;\n        const sampleProducts = products.map((product) => {\n          return { ...product, user: adminUser };\n        });\n        await Product.insertMany(sampleProducts);\n    \n        console.log(\"Data Imported\".green.inverse);\n        process.exit();\n      } catch (error) {\n        console.error(`${error}`.red.inverse);\n        process.exit(1);\n      }\n    };\n    \n    const DeleteData = async () => {\n      try {\n        await Order.deleteMany();\n        await Product.deleteMany();\n        await User.deleteMany();\n    \n        console.log(\"Data Deleted\".red.inverse);\n        process.exit();\n      } catch (error) {\n        console.error(`${error}`.red.inverse);\n        process.exit(1);\n      }\n    };\n    \n    if (process.argv[2] === \"-d\") {\n      DeleteData();\n    } else {\n      importData();\n    }\n`\n```",
      "solution": "I have the same issue and I just did a research and I find that your MongoDB are trying to execute the function `User.deleteMany()` before the database is connected.\njust put an await before `connectDB()`;\n```\n`await connectDB();\n`\n```",
      "question_score": 8,
      "answer_score": 15,
      "created_at": "2021-01-06T17:43:27",
      "url": "https://stackoverflow.com/questions/65599791/mongooseerror-operation-orders-deletemany-buffering-timed-out-after-10000ms"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 70192191,
      "title": "What causes Mongoose `updateMany` to return `{ acknowledged: false }`",
      "problem": "I'm trying to set up notifications for an Express app using MongoDB.\nI have an API endpoint where I `$push` a user's id to the `readBy` field in MongoDB to \"mark\" it as read after retrieving a user's notifications. When I make a request to this endpoint, it returns `200` and their notifications, but it isn't making any updates to the notification document in MongoDB. `console.log`ing the query response in the callback gave me `{ acknowledged: false }`. According to the Mongoose docs, `acknowledged` is a `Boolean indicating everything went smoothly`, but information about what `acknowledged` is and at which point in the query/write process caused it to occur was sparse. Since it didn't return any errors I couldn't find a way to troubleshoot it.\nWould someone be able to shed some light on what exactly `acknowledged: false` is and in what typically causes it, and why it doesn't throw an error.\nModel:\n```\n`const notificationSchema = new Schema({\n  timestamp: {\n    type: Date,\n    required: true\n  },\n  type: {\n    type: String,\n    required: true,\n    enum: [\n      'newCustomer',\n      'contractSigned',\n      'invoicePaid',\n      'warrantyExp',\n      'assignedProject'\n    ]\n  },\n  recipients: [{\n    type: Schema.Types.ObjectId,\n    ref: 'Employee',\n    required: true,\n  }],\n  customer: {\n    type: Schema.Types.ObjectId,\n    ref: 'Customer',\n    required: true,\n  },\n  readBy: [{\n    type: String\n  }],\n  uuid: {\n    type: String,\n    default: uuid.v4,\n    immutable: true,\n    required: true,\n  },\n  company: {\n    type: Schema.Types.ObjectId, ref: 'Company'\n  }\n});\n`\n```\nRoute:\n```\n`router.get(\"/notification/all\", withAuth, async (req, res) => {\n  const FOURTEEN_DAYS = new Date().setDate(new Date().getDate() + 14);\n  try {\n    const { uuid, userId } = req.loggedInUser;\n\n    // Fetch notifications that have the user as a recipient.\n    Notification.find({\n      recipients: userId,\n    })\n      .populate(\"customer\")\n      .exec((err, notifs) => {\n        if (err)\n          return res.status(500).json({\n            success: false,\n            message: \"Error: Failed to retrieve notifications.\",\n          });\n\n        const result = [];\n        const notifIds = [];\n\n        for (const notif of notifs) {\n          // Filter notif\n          result.push({\n            timestamp: notif.timestamp,\n            customer: notif.customer,\n            type: notif.type,\n            read: notif.readBy.includes(uuid),\n          });\n          // Add the user as read\n          notifIds.push(notif.uuid);\n        }\n\n        console.log(notifIds);\n\n        /* THIS RETURNS ACKNOWLEDGED: FALSE */         \n        // Write to DB that user has read these notifications\n        Notification.updateMany(\n          { uuid: { $in: notifIds } },\n          { $push: { readBy: uuid } },\n          (err, resultUpdate) => {\n            if (err)\n              return res.status(500).json({\n                success: false,\n                message:\n                  \"Error: Failed to add check off notifications as read.\",\n              });\n\n            console.log(resultUpdate);\n\n            // Delete notifications past 14 days and has been read by all recipients\n            Notification.deleteMany(\n              {\n                timestamp: { $gte: FOURTEEN_DAYS },\n                $expr: {\n                  $eq: [{ $size: \"$readBy\" }, { $size: \"$recipients\" }],\n                },\n              },\n              (err) => {\n                if (err)\n                  return res.status(500).json({\n                    success: false,\n                    message: \"Error: Failed to delete old notifications.\",\n                  });\n\n                return res.status(200).json({\n                  success: true,\n                  notifications: result,\n                  message: \"Fetched notifications\",\n                });\n              }\n            );\n          }\n        );\n      });\n  } catch (err) {\n    res.status(500).json({ success: false, message: err.toString() });\n  }\n});\n`\n```",
      "solution": "So it turns out that this issue was unrelated to write concern. `acknowledged: false` was being returned because the value we were trying to `$push` was `undefined`. So essentially Mongoose was refusing to write `undefined` values, but doesn't throw an error for the input value being undefined. Putting this here in case someone else runs into this issue.",
      "question_score": 8,
      "answer_score": 19,
      "created_at": "2021-12-01T23:43:55",
      "url": "https://stackoverflow.com/questions/70192191/what-causes-mongoose-updatemany-to-return-acknowledged-false"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 66769003,
      "title": "How can I use Google sign-in inside of an Electron desktop application?",
      "problem": "I'm using Node.js and Express to make a simple app. It relies heavily on Google sign-in for profile pictures and nicknames, and when testing it in a new Electron app I got thrown the error -\n\n\" This browser or app may not be secure\n\nTry using a different browser. If you\u2019re already using a supported browser, you can refresh your screen and try again to sign in. \"\n\n- when trying to sign in with Google. I briefly considered opening the sign in inside of the user's browser, before realising this wouldn't pass the details back to the app. A lot of the solutions that I found online relied on Firebase, which I'm not using.\nIs there a way I can send data from the browser back to the app? Or some other solution that I haven't considered yet?",
      "solution": "You don't need firebase to do this. You can do this by taking a user to their regular browser and back again. It is possible to pass the details back to the app. We do this in Amna.\nIt is a tad more involved (but useful for any other providers too). I am assuming you have used some kind of OAuth provider before.\n\nRegister a custom url handler in your `Electron` app (e.g. `myapp://`. You can do this with the `protocol`). We used the electron-deeplink library\n\nOn your app's website, setup a side page that can launch your app. For example, we have an authorize page that launches our app. You want to register this website as the `redirect url` from Google, so when Google hits this url, it passes the validate tokens to it. You can do any OAuth Work here.\n\nFinally, from your website, call your app's url handler. `myapp://authorize?code=XYZ`. This sends all the data back to your main App.\n\n```\n`deeplink.on('received', (link) => {\n    // parse out the code from the stuff here\n});\n`\n```\n\nIf you need the final data in your UI, you can pass the data to the UI with `ipcRenderer.send()`",
      "question_score": 8,
      "answer_score": 16,
      "created_at": "2021-03-23T19:18:32",
      "url": "https://stackoverflow.com/questions/66769003/how-can-i-use-google-sign-in-inside-of-an-electron-desktop-application"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 67786302,
      "title": "Error R10 (Boot timeout) -&gt; Web process failed to bind to $PORT within 60 seconds of launch - HEROKU ERROR",
      "problem": "I deployed my Node.js WebApp to heroku but I'm getting this error\n```\n`2021-06-01T09:19:42.615419+00:00 heroku[web.1]: State changed from crashed to starting\n2021-06-01T09:19:47.259832+00:00 heroku[web.1]: Starting process with command `node app.js`\n2021-06-01T09:19:51.146182+00:00 app[web.1]: Server is running on port 3001.\n2021-06-01T09:20:47.916699+00:00 heroku[web.1]: Error R10 (Boot timeout) -> Web process failed to \nbind to $PORT within 60 seconds of launch\n2021-06-01T09:20:47.989032+00:00 heroku[web.1]: Stopping process with SIGKILL\n2021-06-01T09:20:48.124402+00:00 heroku[web.1]: Process exited with status 137\n2021-06-01T09:20:48.196055+00:00 heroku[web.1]: State changed from starting to crashed\n2021-06-01T09:24:45.072782+00:00 heroku[router]: at=error code=H10 desc=\"App crashed\" method=GET \npath=\"/\" host=positate.herokuapp.com request_id=7e9ec2b1-5685-4c3f-9c29-6c03268b7c82 \nfwd=\"157.51.56.186\" dyno= connect= service= status=503 bytes= protocol=https\n2021-06-01T09:24:46.540443+00:00 heroku[router]: at=error code=H10 desc=\"App crashed\" method=GET \npath=\"/favicon.ico\" host=positate.herokuapp.com request_id=4ab44a6a-4795-4a4d-b32d-28d796845774 \nfwd=\"157.51.56.186\" dyno= connect= service= status=503 bytes= protocol=https\n`\n```\nI'm attaching my app.js here\n\r\n\r\n`require(\"dotenv\").config();\nconst express = require(\"express\");\nconst app = express();\nconst ejs = require(\"ejs\");\nconst mongoose = require(\"mongoose\");\nconst session = require(\"express-session\");\nconst passport = require(\"passport\");\nconst passportLocalMongoose = require(\"passport-local-mongoose\");\nconst GoogleStrategy = require(\"passport-google-oauth20\").Strategy;\nconst findOrCreate = require(\"mongoose-findorcreate\");\nconst timestamp = require(\"mongoose-timestamp\");\nconst MongoStore = require('connect-mongo');\n\nconst auth = require(\"./routes/auth\");\nconst User = require(\"./database/models/user_model\");\n\nconst blogRoute = require(\"./routes/blogRoute\");\n\nmongoose.connect(process.env.DB_URI, {\n  useNewUrlParser: true,\n  useUnifiedTopology: true,\n});\nmongoose.set(\"useCreateIndex\", true);\nmongoose.set(\"useFindAndModify\", false);\n\napp.use(express.static(\"public\"));\napp.set(\"view engine\", \"ejs\");\napp.use(express.urlencoded({ extended: true }));\napp.use(express.json());\n\napp.use(session({\n  secret: \"foo\",\n  saveUninitialized: false,\n  resave: false,\n  store: MongoStore.create({\n    mongoUrl: process.env.DB_URI,\n    mongoOptions: { useUnifiedTopology: true },\n    collectionName: 'sessions',\n    autoRemove: 'native',\n  })\n}));\n\napp.use(passport.initialize());\napp.use(passport.session());\n\npassport.use(User.createStrategy());\n\npassport.serializeUser(function (user, done) {\n  done(null, user.id);\n});\n\npassport.deserializeUser(function (id, done) {\n  User.findById(id, function (err, user) {\n    done(err, user);\n  });\n});\n\npassport.use(\n  new GoogleStrategy(\n    {\n      clientID: process.env.GOOGLE_CLIENT_ID,\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET,\n      callbackURL: \"http://localhost:3001/auth/google/positate\" || \"https://positate.herokuapp.com/auth/google/positate\",\n    },\n    function (accessToken, refreshToken, profile, cb) {\n      User.findOrCreate(\n        {\n          googleId: profile.id,\n          name: profile.displayName,\n          username: profile.emails[0].value,\n          image: profile.photos[0].value,\n        },\n        function (err, user) {\n          return cb(err, user);\n        }\n      );\n    }\n  )\n);\n\napp.get(\"/\", (req, res) => {\n  res.render(\"Landing\");\n});\n\napp.use(\"/\", auth);\napp.use(\"/blog\", blogRoute);\napp.use(\"/\", blogRoute);\napp.use(\"/category\", blogRoute);\n\napp.listen(3001 || process.env.PORT, '0.0.0.0', () => {\n  console.log(\"Server is running.\");\n});`\r\n\r\n\r\n\nThis is my Procfile\n```\n`web: node app.js\n`\n```\nThis is my package.json\n\n```\n`{\n  \"name\": \"positate\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"app.js\",\n  \"engines\": {\n    \"node\": \"14.15.4\",\n    \"npm\": \"6.14.10\"\n  },\n  \"scripts\": {\n    \"start\": \"node app.js\"\n  },\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"dependencies\": {\n    \"connect-mongo\": \"^4.4.1\",\n    \"dotenv\": \"^10.0.0\",\n    \"ejs\": \"^3.1.6\",\n    \"express\": \"^4.17.1\",\n    \"express-session\": \"^1.17.2\",\n    \"mongoose\": \"^5.12.11\",\n    \"mongoose-findorcreate\": \"^3.0.0\",\n    \"mongoose-timestamp\": \"^0.6.0\",\n    \"passport\": \"^0.4.1\",\n    \"passport-google-oauth20\": \"^2.0.0\",\n    \"passport-local\": \"^1.0.0\",\n    \"passport-local-mongoose\": \"^6.1.0\"\n  }\n}\n`\n```\nI tried various solutions for this error but was not able to solve it. I've been trying to solve this for the past three days.\nKindly help me solve this error\nThank you so much in Advance.",
      "solution": "The issue is the way you define the port, it always runs on `3001` which is not possible on Heroku, you need to bind the `$PORT` env variable.\nChange your code to check first fi the `process.env.PORT` is defined (it will be on Heroku but on your local dev environment it will default to 3001)\n```\n`app.listen(process.env.PORT || 3001, '0.0.0.0', () => {\n  console.log(\"Server is running.\");\n});\n`\n```\nSee NodeJS on Heroku",
      "question_score": 8,
      "answer_score": 10,
      "created_at": "2021-06-01T11:32:58",
      "url": "https://stackoverflow.com/questions/67786302/error-r10-boot-timeout-web-process-failed-to-bind-to-port-within-60-second"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 75137950,
      "title": "TypeError: Fetch failed in SvelteKit server-side rendering - Express does not show a proper TypeScript stack trace",
      "problem": "I am checking the logs of the SvelteKit SSR server using adapter-node.\nI have customised the `server.js` to use Express instead of Polka, though not sure if this matters.\nThere are apparent errors which I believe is when `fetch()` tries to read data from backend API and fails for some reason.\nThis is the console output from I get using `docker`:\n```\n`frontend  | TypeError: fetch failed\nfrontend  |     at fetch (file:///app/build/handler.js:17895:14)\nfrontend  |     at async Object.fetch (file:///app/build/server/index.js:2273:12)\nfrontend  |     at async fetch (file:///app/build/server/index.js:991:24)\nfrontend  |     at async Promise.all (index 0)\nfrontend  |     at async load (file:///app/build/server/chunks/6-0becfa88.js:8:56)\nfrontend  |     at async load_data (file:///app/build/server/index.js:1088:16)\nfrontend  |     at async file:///app/build/server/index.js:1887:18\n\n`\n```\nThis stack trace is unusable, because it lacks the information of what was the function / source code that called `fetch()`. Not sure if this is because of how Node.js / Express works, or because lack of TypeScript source map support in some part of the stack or something else. A SvelteKit project has dozens of functions called `load()` because that is what every router endpoint has.\nWhat would be a way to make these errors, and SvelteKit error handling in general, more descriptive - e.g. to show the proper caller mapped to its TypeScript source file, the failed page name, failed URL in `fetch()` and so on? This would then help to diagnose the underlying problem of what could be wrong with the API calls that fail.",
      "solution": "The problem might be lacking of sourcemap.\nWhen SvelteKit builds your app, it gonna split your code into several chunks which makes unusable error stack trace.\nThere is a way to enable sourcemap again and you can try that on your project to see if it works.\n\nModify `vite.config.xx` file, add below config:\n\n```\n`const config = {\n  ...\n  build:{\n    sourcemap: true // Config vite to generate sourcemap when bundling.\n  },\n  ...\n}\n`\n```\n\nAdd `sourcemap` flag when starting node, for example:\n\n```\n`node index.js --enable-source-maps\n`\n```\nThis should make your stack trace pointing to your `src` instead of `build`. You can try and check out whether your project is still printing unmeaningful stack trace.",
      "question_score": 8,
      "answer_score": 4,
      "created_at": "2023-01-16T18:55:04",
      "url": "https://stackoverflow.com/questions/75137950/typeerror-fetch-failed-in-sveltekit-server-side-rendering-express-does-not-sh"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 69731946,
      "title": "Firebase functions parsing request body before I can handle it in Express",
      "problem": "I'm trying to handle invalid requests in Firebase functions, so making a post request with invalid JSON, with the intent of handling it in express. but I get 400 error 'SyntaxError: Unexpected token a in JSON at position 20' before it even reaches express layer, and the worst thing is the function runs for 60 seconds untill it hits timeout error.\nmy function\n`import * as functions from 'firebase-functions';\nimport * as express from 'express';\nimport * as admin from 'firebase-admin';\n\nadmin.initializeApp();\n\nconst app = express();\n\napp.use((err: any, req: any, res: any, next: any) => {\n  res.json({ error: 'invalid request' });\n  next(err);\n});\n\napp.post('/test', (req: any, res: any) => {\n  res.json({ error: 'invalid request' });\n  res.end();\n  return;\n});\n\nconst server = functions.runWith({ maxInstances: 100 }).https.onRequest(app);\n\nexport { server as api };\n`\nthe invalid json,\n```\n`{\n    \"es\":\"adfasdf\"asdf\n}\n`\n```\nI suspect this has something to do with the https://firebase.google.com/docs/functions/http-events#read_values_from_the_request at \"This parsing is done by the following body parsers:\"\n\nAlso to note, at the time of asking this question, it was 1st gen of functions.",
      "solution": "Firebase Functions are built on top of the `functions-framework-nodejs` package (or at least, an internal variant of the same code).\nWithin that package, the body parsers you mention are injected. As you correctly surmised, these are indeed added before your code even gets the chance to execute.\nAs the error is internal to Firebase's operations, you will need to reach out to Firebase support directly.",
      "question_score": 8,
      "answer_score": 7,
      "created_at": "2021-10-27T04:06:45",
      "url": "https://stackoverflow.com/questions/69731946/firebase-functions-parsing-request-body-before-i-can-handle-it-in-express"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 68197033,
      "title": "Specified type of property cannot be automatically resolved to a sequelize data type. Please define the data type manually",
      "problem": "I'm defining one to many relationship between a `User` and a `Product` in sequelize-typescript.\nHere are the Models:\nProduct.ts\n```\n`@Table\nexport class Product extends Model {\n    @Column({ primaryKey: true })\n    id!: string\n\n    @Column\n    title!: string\n\n    @Column({ type: DataType.DOUBLE })\n    price!: number\n\n    @Column\n    imageUrl!: string\n\n    @Column\n    description?: string\n\n    @ForeignKey(() => User)\n    @Column\n    userId?: string\n\n    @BelongsTo(() => User)\n    user?: User\n}\n`\n```\nUser.ts\n```\n`@Table\nexport class User extends Model {\n    @Column({ primaryKey: true })\n    id!: string\n\n    @Column\n    name!: string\n\n    @Column\n    email!: string\n\n    @Column\n    @HasMany(() => Product)\n    products?: Product[]\n}\n`\n```\nI'm getting the following error:\n```\n`Specified type of property 'products' cannot be automatically resolved to a sequelize data type. Please define the data type manually\n`\n```\nHere's the complete stack trace:\n```\n`*ProjectPath*/node_modules/sequelize-typescript/dist/model/shared/model-service.js:64\n    throw new Error(`Specified type of property '${propertyName}'\n          ^\nError: Specified type of property 'products'\n            cannot be automatically resolved to a sequelize data type. Please\n            define the data type manually\n    at Object.getSequelizeTypeByDesignType (*ProjectPath*/node_modules/sequelize-typescript/dist/model/shared/model-service.js:64:11)\n    at annotate (*ProjectPath*/node_modules/sequelize-typescript/dist/model/column/column.js:32:44)\n    at Column (*ProjectPath*/node_modules/sequelize-typescript/dist/model/column/column.js:14:9)\n    at DecorateProperty (*ProjectPath*/node_modules/reflect-metadata/Reflect.js:553:33)\n    at Object.decorate (*ProjectPath*/node_modules/reflect-metadata/Reflect.js:123:24)\n    at __decorate (*ProjectPath*/src/models/user.ts:4:92)\n    at Object. (*ProjectPath*/src/models/user.ts:27:5)\n    at Module._compile (internal/modules/cjs/loader.js:1156:30)\n    at Module.m._compile (*ProjectPath*/node_modules/ts-node/src/index.ts:1043:23)\n    at Module._extensions..js (internal/modules/cjs/loader.js:1176:10)\n`\n```\nAny input would be much appreciated.",
      "solution": "The problem is that `products` is not a column of your table.\nIt's a property created by Sequelize to find your associated models.\nSo in your case you need to remove the `@Column` above `products` in your User model. Because for now Sequelize is trying to use it as a column existing in your table but this doesn't exist in your DB.",
      "question_score": 8,
      "answer_score": 6,
      "created_at": "2021-06-30T16:47:46",
      "url": "https://stackoverflow.com/questions/68197033/specified-type-of-property-cannot-be-automatically-resolved-to-a-sequelize-data"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 65623404,
      "title": "Error: querySrv ENOTFOUND _mongodb._tcp.dbname.fzofb.mongodb.net",
      "problem": "I'm learning Node.js and just started working with MongoDB.\nI'm making a connection with the MongoDB Cluster I've created\n```\n`const dbURI = 'mongodb+srv://testuser:test1234@nodelearning.fzofb.mongodb.net/mydb?retryWrites=true&w=majority';\nmongoose.connect(dbURI, { useNewUrlParser: true, useUnifiedTopology: true })\n    .then((result) => console.log('connected to db'))\n    .catch((err) => console.log(err));\n`\n```\nWhen I run it `nodemon app` I get this error:\n\nError: querySrv ENOTFOUND _mongodb._tcp.mydb.fzofb.mongodb.net\nat QueryReqWrap.onresolve [as oncomplete] (node:dns:206:19) {   errno: undefined,   code: 'ENOTFOUND',   syscall: 'querySrv',\nhostname: '_mongodb._tcp.mydb.fzofb.mongodb.net' }",
      "solution": "The error indicates that there is no error in the code. This leaves you with three potential possibilities:\n\nEnsure you have MongoDB installed on your computer.\nMake sure you're connected to wifi that is not public.\nMake sure you have allowed the IP in network access of MongoDB as shown in the image below:\n\nIn my case, I was connected to public wifi in a coworking space. I change my connection to my personal hotspot and it worked.",
      "question_score": 7,
      "answer_score": 6,
      "created_at": "2021-01-08T05:19:25",
      "url": "https://stackoverflow.com/questions/65623404/error-querysrv-enotfound-mongodb-tcp-dbname-fzofb-mongodb-net"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 66753905,
      "title": "redux-toolkit -&gt; non-serializable value detected",
      "problem": "Error:\n\nindex.js:1 A non-serializable value was detected in an action, in the\npath: `payload.config.transformRequest.0`.\n\nValue: \u0192\n\ntransformRequest(data, headers) {\n\n```\n`normalizeHeaderName(headers, 'Accept');\nnormalizeHeaderName(headers, 'Content-Type');\n\nif (utils.isFormData(data) || utils.isArrayBuffer(data) || utils.i\u2026\n`\n```\n\nSlice:\n```\n`export const getProducts = createAsyncThunk(\n    'products/getProducts', \n    async() => {\n        const res = await axios.get('http://localhost:5000/products/view-products', {withCredentials: true});\n        return res;\n    }\n)\n\nconst getProductsSlice = createSlice({\n    name : 'products',\n    initialState : {\n        list : [],\n        status : null\n    },\n    extraReducers : {\n        [getProducts.pending] : (state) => {\n            state.status = 'loading'\n        },\n        [getProducts.fulfilled] : (state, {payload}) => {\n            console.log(\"produtcts payload: \", payload.data)\n            state.list = payload.data\n            state.status = 'success'\n        },\n        [getProducts.rejected] : (state) => {\n            state.status = 'failed'\n        }\n    }\n})\n`\n```\nInside Component:\n```\n`const dispatch = useDispatch();\n    const data = useSelector(state => state.products.list);\n    console.log(\"the products are :\", data);\n\n    useEffect(() => {\n        dispatch(getProducts());\n    }, [dispatch]);\n`\n```\nOther slices in the app work fine. Having a hard time working around the non-serializable",
      "solution": "The problem with returning the result of `axios.get` as it is, is that apart from `data` it contains various other fields related to the request, including `config` for which you got the error. Although you're only saving `data` and not `config`, as the whole `res` object passes to the store it goes through a middleware called Serializability, which is included in redux-toolkit and enforces Redux recommendation to only store serializable data.\nSerializable means it can be written down as text and converted back to original object without losing information, which doesn't work with functions. A javascript function apart from code also have scope (memory associated to it), which cannot be represented as text.\nSerializability checks the whole payload (it is executed before your data reaches the store, so it doesn't know which parts will be used) and notices `config`. As `config` has methods among its members Serializability alerts you that it is not serializable. You could switch the middleware off, but it can detect genuine issues, so it's generally a better idea to just keep only relevant data in the payload.",
      "question_score": 7,
      "answer_score": 28,
      "created_at": "2021-03-22T22:12:07",
      "url": "https://stackoverflow.com/questions/66753905/redux-toolkit-non-serializable-value-detected"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 69200493,
      "title": "Error [ERR_PACKAGE_PATH_NOT_EXPORTED]: No &quot;exports&quot; - Firebase",
      "problem": "Working through this Full Stack React & Firebase Tutorial and trying to use Firebase Authentication, to create a new user,  I am getting the below error.\n```\n`Error [ERR_PACKAGE_PATH_NOT_EXPORTED]: No \"exports\" main defined in /socialapp-functions/functions/node_modules/firebase/package.json\n    at throwExportsNotFound (internal/modules/esm/resolve.js:299:9)\n    at packageExportsResolve (internal/modules/esm/resolve.js:522:3)\n    at resolveExports (internal/modules/cjs/loader.js:449:36)\n    at Function.Module._findPath (internal/modules/cjs/loader.js:489:31)\n    at Function.Module._resolveFilename (internal/modules/cjs/loader.js:875:27)\n    at Function.Module._load (internal/modules/cjs/loader.js:745:27)\n    at Module.require (internal/modules/cjs/loader.js:961:19)\n    at require (internal/modules/cjs/helpers.js:92:18)\n    at Object. (/socialapp-functions/functions/index.js:17:18)\n    at Module._compile (internal/modules/cjs/loader.js:1072:14)\n\u26a0  We were unable to load your functions code. (see above)\n`\n```\nThe tutorial details code like this:\n```\n`// Signup route\napp.post(\"/signup\", (req, res) => {\n  const newUser = {\n    email: req.body.email,\n    password: req.body.password,\n    confirmPassword: req.body.confirmPassword,\n    handle: req.body.handle,\n  };\n\n  firebase\n    .auth()\n    .createUserWithEmailAndPassword(newUser.email, newUser.password)\n    .then((data) => {\n      return res\n        .status(201)\n        .json({ message: `user ${data.user.uid} signed up successfully` });\n    })\n    .catch((err) => {\n      console.error(err);\n      return res.status(500).json({ error: err.code });\n    });\n});\n`\n```",
      "solution": "Per the question and answer here I think the issue is the tutorial has code for Firebase@8 when I'm running Firebase@9.\nReferencing the Firebase Admin SDK docs to Manage Users, I am using\n```\n`const admin = require(\"firebase-admin\");\n`\n```\nInstead of\n```\n`const firebase = require(\"firebase\");\n`\n```\nI updated my code to the below and can now successfully add users on a POST.\n```\n`// Signup route\napp.post(\"/signup\", (req, res) => {\n  const newUser = {\n    email: req.body.email,\n    password: req.body.password,\n    confirmPassword: req.body.confirmPassword,\n    handle: req.body.handle,\n    phone: req.body.phone,\n    name: req.body.name,\n    photoURL: req.body.photo,\n  };\n\n  admin\n    .auth()\n    .createUser({\n      email: newUser.email,\n      emailVerified: false,\n      phoneNumber: newUser.phone,\n      password: newUser.password,\n      displayName: newUser.name,\n      photoURL: newUser.photoURL,\n      disabled: false,\n    })\n    .then((data) => {\n      return res\n        .status(201)\n        .json({ message: `user ${data.uid} signed up successfully` });\n    })\n    .catch((err) => {\n      console.error(err);\n      return res.status(500).json({ error: err.code });\n    });\n});\n`\n```",
      "question_score": 7,
      "answer_score": 11,
      "created_at": "2021-09-16T00:39:44",
      "url": "https://stackoverflow.com/questions/69200493/error-err-package-path-not-exported-no-exports-firebase"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 70938102,
      "title": "Why I&#39;m getting Error [ERR_MODULE_NOT_FOUND]: Cannot find module when running the server",
      "problem": "I'm doing a startup server. Basically It has initial setup with express and nodemon dependencies. Unfortunately, I'm getting `ERR_MODULE_NOT_FOUND` when running `yarn dev` or `npm run dev`\nHere is the code and file structure I have.",
      "solution": "You need to add .js extension\nindex.js:\n```\n`import { SampleExport } from \"../path/file.js\"\n`\n```\nIn my opinion, it is better to use .env files together with some npm package or even a json file.",
      "question_score": 7,
      "answer_score": 3,
      "created_at": "2022-02-01T10:21:53",
      "url": "https://stackoverflow.com/questions/70938102/why-im-getting-error-err-module-not-found-cannot-find-module-when-running-th"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 70274342,
      "title": "Unable to connect to remote redis host [nodeJS]",
      "problem": "`const redis = require('redis');\nrequire('dotenv').config();\nconsole.log(process.env.redisHost, ':', process.env.redisPort);\nconst redisClient = redis.createClient({\n    host: process.env.redisHost,\n    port: process.env.redisPort,\n    password: process.env.redisKey\n});\nredisClient.connect();\nredisClient.on('error', err => console.log('Redis error: ', err.message));\nredisClient.on('connect', () => console.log('Connected to redis server'));\nmodule.exports = redisClient;\n`\nI tried this sample from redis docs but still I'm getting an error stating:\n`Redis error:  connect ECONNREFUSED 127.0.0.1:6379`\nI logged the environment host and port variables to the console and I got the remote host ipv4 address, but still the client is trying to connect to localhost instead of remote host (I purposely uninstalled redis from my local device to check if the client is working as it is supposed to). I also confirmed that the remote redis host is working perfectly.\nI also tried different methods like :\nhttps://cloud.google.com/community/tutorials/nodejs-redis-on-appengine\n```\n`redis.createClient(port, host, {auth_pass: password});\n`\n```\nBut still, I got the same error.\nI am able to connect to the redis host via commandline:\n```\n`redis-cli.exe -h XX.XX.XX.XXX -a Password\nXX.XX.XX.XXX:6379> set name dhruv\nOK\nXX.XX.XX.XXX:6379> get name\n\"dhruv\"\nXX.XX.XX.XXX:6379> exit\n`\n```\nI'm trying to use redis on nodejs for the first time, so don't have a proper idea but I think I am doing everything right.\nAny solution/workaround will be helpful :D",
      "solution": "It worked with this code:\n`const url = `redis://${process.env.redisHost}:${process.env.redisPort}`;\nconst redisClient = redis.createClient({\n    url,\n    password: process.env.redisKey\n});\nredisClient.connect();\n`",
      "question_score": 7,
      "answer_score": 16,
      "created_at": "2021-12-08T12:36:22",
      "url": "https://stackoverflow.com/questions/70274342/unable-to-connect-to-remote-redis-host-nodejs"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 69798092,
      "title": "PayloadTooLargeError: request entity too large. How solve it in NestJS?",
      "problem": "I need to send the request which contains a base64 string and it's too large (probable, around 2 mb).\nBut server throw next exeption, how to avoid this error:\n```\n`[Nest] 1666  - 11/01/2021, 1:50:58 PM   ERROR [ExceptionsHandler] request entity too large\ngateway-client  | PayloadTooLargeError: request entity too large\ngateway-client  |     at readStream (/srv/app/node_modules/raw-body/index.js:155:17)\ngateway-client  |     at getRawBody (/srv/app/node_modules/raw-body/index.js:108:12)\ngateway-client  |     at read (/srv/app/node_modules/body-parser/lib/read.js:77:3)\ngateway-client  |     at jsonParser (/srv/app/node_modules/body-parser/lib/types/json.js:135:5)\ngateway-client  |     at Layer.handle [as handle_request] (/srv/app/node_modules/express/lib/router/layer.js:95:5)\ngateway-client  |     at trim_prefix (/srv/app/node_modules/express/lib/router/index.js:317:13)\ngateway-client  |     at /srv/app/node_modules/express/lib/router/index.js:284:7\ngateway-client  |     at Function.process_params (/srv/app/node_modules/express/lib/router/index.js:335:12)\ngateway-client  |     at next (/srv/app/node_modules/express/lib/router/index.js:275:10)\ngateway-client  |     at expressInit (/srv/app/node_modules/express/lib/middleware/init.js:40:5)\n`\n```\nMy main.ts includes:\n```\n`async function bootstrap() {  \n  const app = await NestFactory.create(AppModule);\n  \n  // app.enableCors({\n  //   origin: '*',\n  // });\n\n  const config = new DocumentBuilder()\n    .setTitle('API client gateway')\n    .setDescription('API client gateway full documentation')\n    .setVersion('v0.0.1')\n    .addTag('')\n    .addBearerAuth(\n      {\n        type: 'http',\n        scheme: 'bearer',\n        bearerFormat: 'JWT',\n        name: 'JWT',\n        description: 'Enter JWT token',\n        in: 'header',\n      },\n      'jwt-token',\n    )\n    .build();\n\n  const document = SwaggerModule.createDocument(app, config);\n\n  SwaggerModule.setup('/api/docs', app, document);\n\n  await app.init();\n\n  app.use(express.json({limit: \"50mb\"})) //For JSON requests\n  app.use(express.urlencoded({\n    limit: \"50mb\",\n    extended: false\n  }));\n\n  await app.listen(AppConfig.Port);\n}\n\nbootstrap();\n`\n```",
      "solution": "In your `main.ts` file (most probably `bootstrap()` method) get instance of Express App and set JSON parser with limit:\n`import { json } from 'body-parser';\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule,\n    { bodyParser: false });\n\n  app.use(json({ limit: '5mb' }));\n\n  ...\n}\n`\nEDIT: If you are accessing the app via proxy (nginx for example) make sure there is the same limit allowed as well.",
      "question_score": 7,
      "answer_score": 11,
      "created_at": "2021-11-01T15:08:13",
      "url": "https://stackoverflow.com/questions/69798092/payloadtoolargeerror-request-entity-too-large-how-solve-it-in-nestjs"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 75549848,
      "title": "Node JS issue with SSL pfx file",
      "problem": "when I run my server.js, I have this issue :\n```\n`node:internal/tls/secure-context:277\n      context.loadPKCS12(toBuf(pfx), toBuf(passphrase));\n              ^\n\nError: unsupported\n    at configSecureContext (node:internal/tls/secure-context:277:15)\n    at Object.createSecureContext (node:_tls_common:117:3)\n    at Server.setSecureContext (node:_tls_wrap:1354:27)\n    at Server (node:_tls_wrap:1218:8)\n    at new Server (node:https:74:3)\n    at Object.createServer (node:https:112:10)\n    at Object. (/home/user/nodeserver/server.js:21:27)\n    at Module._compile (node:internal/modules/cjs/loader:1254:14)\n    at Module._extensions..js (node:internal/modules/cjs/loader:1308:10)\n    at Module.load (node:internal/modules/cjs/loader:1117:32)\n\nNode.js v18.14.2\n`\n```\nI run this command in order to see what's wrong but I can't tell :\n```\n`openssl pkcs12 -info -in ssl/pfxFile.pfx -noout\n`\n```\nHere is the output of the command :\n```\n`MAC: sha1, Iteration 1024\nMAC length: 20, salt length: 20\nPKCS7 Encrypted data: pbeWithSHA1And40BitRC2-CBC, Iteration 1024\nCertificate bag\nCertificate bag\nPKCS7 Data\nShrouded Keybag: pbeWithSHA1And3-KeyTripleDES-CBC, Iteration 1024\n`\n```\nI tried to do the pfx file twice, but same issue each time, I tried without password, I don't know what could block this, I updated Node and now I can't start my server.\nIs there a change to Node that alters something with the certificates ?\nThanks for your answers.",
      "solution": "Try switching to a lower LTS node version. I've had the same issue today, going from 18.14 LTS to 16.19 LTS solved it. As of today people are still having the same issue.",
      "question_score": 7,
      "answer_score": 5,
      "created_at": "2023-02-23T21:10:59",
      "url": "https://stackoverflow.com/questions/75549848/node-js-issue-with-ssl-pfx-file"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 68996929,
      "title": "MongooseError: Query was already executed: Todo.updateOne({ _id: new ObjectId(&quot;612df063a8f",
      "problem": "I updated mongoose to latest version (6.0.2) and now I'm recieving this error and crush the application whenever `.updateOne()` is executed. But object update inside the database. My code:\n`async(req,res) => {\n    await Todo.updateOne(\n        {_id : req.params.id},\n        {\n            $set : {\n                status : \"inactive\"\n            }\n        },\n        (updateError) => {\n            // if updateError exist\n            if (updateError) {\n                // print error\n                printError(updateError);\n\n                // response the error\n                res.status(500).json({\n                    error : \"There was a Server Side Error!\"\n                });\n            } else {\n                // if error dose not exist\n                // print message\n                console.log(\"|===> \ud83d\uddc2\ufe0f  Data Was Updated successfully! \ud83d\uddc2\ufe0f",
      "solution": "Your async/await should look like this:\n\r\n\r\n`async (req,res) => {\n  try {\n      const result = await Todo.updateOne(\n          {_id : req.params.id},\n          {\n              $set : {\n                  status : \"inactive\"\n              }\n          },\n          );\n      }\n      console.log('success', result)\n      res.json({message: \"Todo Was Update successfully!\", result })\n  } catch (err) {\n     console.log('error', err)\n     res.status(500).json({error:'There was a Server Side Error!'})\n  }\n}`",
      "question_score": 7,
      "answer_score": 3,
      "created_at": "2021-08-31T12:18:45",
      "url": "https://stackoverflow.com/questions/68996929/mongooseerror-query-was-already-executed-todo-updateone-id-new-objectid6"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 65948083,
      "title": "mongoDB whitelist IP",
      "problem": "I am seeing similar posts, however none are helping me solve my problem.\nFollowing a Udemy tutorial that builds a MERN application from scratch, I got stuck on the mongoose connection.\nHere is my index.js code:\n```\n`const express = require(\"express\");\nconst mongoose = require(\"mongoose\");\n\nconst app = express();\n\napp.use(express.json());\n\napp.listen(5000, () => console.log(\"Server started on port 5000\"));\n\napp.use(\"/snippet\", require(\"./routers/snippetRouter\"));\n\nmongoose.connect(\"mongodb+srv://snippetUser:_password_@\n  snippet-manager.sometext.mongodb.net/main?retryWrites=\n  true&w=majority\", {\n    useNewUrlParser: true,\n    useUnifiedTopology: true\n}, (err) => {\n  if (err) return console.log(\"error here \" + err);\n  console.log(\"Connected to MongoDB\");\n});\n`\n```\nHere is the error I am getting:\n```\n`Server started on port 5000\nerror here MongooseServerSelectionError: Could not connect to any \nservers in your MongoDB Atlas cluster. One common reason is \nthat you're trying to access the database from an IP that isn't \nwhitelisted. Make sure your current IP address is on your Atlas \ncluster's IP whitelist:\nhttps://docs.atlas.mongodb.com/security-whitelist/ \n`\n```\nAs stated, I am seeing similar errors relating to an IP that isn't whitelisted.\nHowever, in my mongoDB account, it seems that my IP is already whitelisted:\n\nIn the screenshot above, the blank part is where my IP is located (right before it says \"includes your current IP address\").\nSince my IP is listed there, does that not mean my IP is whitelisted?\nIf not, how do I whitelist my IP?",
      "solution": "After a couple of days of frustration, I went into Mongo Atlas, then into Network Access and changed the setting to \"allow access from anywhere\" (shown as `0.0.0.0/0` below). It removed my IP address and changed it to a wildcard IP address.\n\nThis was a deviation from the tutorial I am following on Udemy, but it did work, and I can finally proceed with the rest of the course.",
      "question_score": 7,
      "answer_score": 10,
      "created_at": "2021-01-29T03:45:02",
      "url": "https://stackoverflow.com/questions/65948083/mongodb-whitelist-ip"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 72518694,
      "title": "User Roles and rules(permission) access in node.js",
      "problem": "I created a node.js application (Bus-ticket-booking app). MongoDB is the database system I'm using. I haven't yet finished the front end. I'm doing API queries with Postman.\nFor authentication, I'm using JWT. Now I want to add roles and rules for users such as the app's administrator, supervisor, and normal user.\n1 -> A user can have many roles assigned to them (admin, supervisor).\n2 -> Permissions can be assigned to a role ( Create, Update, delete etc...).\nAs a result, a user can have one or more roles, and each role can have one or more permissions. A user can use APIs for which he has rights, such as creating data, deleting data, updating data, and so on.\nHere is the user schema:\n```\n`const userSchema = new mongoose.Schema({\n  firstname: {\n    type: String,\n    required: true,\n  },\n  lastname: {\n    type: String,\n    required: true,\n  },\n  email: {\n    type: String,\n    unique: true,\n    required: true,\n    validate(value) {\n      if (!validator.isEmail(value)) {\n        throw new Error(\"Please provide the valid email address\");\n      }\n    },\n  },\n  password: {\n    type: String,\n    required: true,\n    trim: true,\n    minLength: 8,\n  },\n  phone: {\n    type: Number,\n    required: true,\n    unique: true\n  },\n  tokens:[{\n    token: {\n      type: String,\n      required:true\n    }\n  }]\n},{\n  timestamps:true\n});\n`\n```\nI'm new to it and have very little knowledge about it.\nIs there anyone who can assist me?",
      "solution": "If you just need a couple different roles,\nI suggest you go with Sajawal Hassan's concept of simply adding a boolean field to determine user's access level.\nHowever, if you are planning to create where there are multitude of roles to be added, and do not want field to be added for each role:\n\nAdd permissions array field to data model and create a permission list (to better organize) to the user data model\nset up a middleware to add to your routers\nset up groups to allow the user of your routers, and pass them through routers\n\n1a. I suggest you create a list of roles within the user model file. Possibly a dictionary.\n.../models/user.js\n```\n`const ROLES = {\n    ADMIN: \"ADMIN\",\n    SUPERVISOR: \"SUPERVISOR\"\n}\n...\nmodule.exports = mongoose.model('User', UserSchema);\nmodule.exports.ROLES = ROLES;\n`\n```\n1b. add a array field to Users models which will have the roles as permissions\n.../user.js\n```\n`const userSchema = new mongoose.Schema({\n    ...,\n    permissions: [String],\n    ...\n});\n`\n```\n\nSet up a middleware or in this case you already have auth; add functional capabilities to the function in which it will check its parameter or attach it to options (if you are checking for token, or other auth params)\n\n.../auth.js\n```\n`module.exports = function (options) {\n    ...\n    // get user, validate token b4 here\n    user.permissions.forEach(permission => {\n        if (options.allowedGroup.indexOf(permission)){\n            // if authenticated\n            return next();\n        }\n    }\n    // could not authenticate at this point\n    return next(errorHandler) // throw a error or handle it way you want\n}\n`\n```\n3a. set up groups to determine which roles will have access to each router or a set of routers\n.../routes/api_123.js\n```\n`const mongoose = require('mongoose');\nconst User = mongoose.model('User');\n\nconst readGroup = [User.ROLES.SUPERVISOR, User.ROLES.ADMIN];\nconst writeGroup = [User.ROLES.ADMIN];\n`\n```\n3b. pass the group you made as allowedGroup in param of middleware and set it up with a asyncHandler\n```\n`...\nconst asyncHandler = require('express-async-handler');\n...\n\nrouter.get('/user/:id', auth({allowedGroup: readGroup}), asyncHandler(async(req, res, next) => {\n    ... // your stuff here\n    res.status(200).json(data);\n})) \n\nrouter.post('/user/:id', auth({allowedGroup: writeGroup}), asyncHandler(async(req, res, next) => {\n    ... // your stuff here\n    res.status(200).json(data);\n})) \n`\n```",
      "question_score": 7,
      "answer_score": 10,
      "created_at": "2022-06-06T15:49:41",
      "url": "https://stackoverflow.com/questions/72518694/user-roles-and-rulespermission-access-in-node-js"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 67555622,
      "title": "JEST Express Error: Cross origin http://localhost forbidden",
      "problem": "I am facing an error using JEST with Express while I execute my test with `npm run test`.\n```\n`  console.error\n    Error: Cross origin http://localhost forbidden\n`\n```\nI've seen similar post like CORS error - Error: Cross origin http://localhost forbidden... without working answers\nHere is my test  :\n```\n`const app = require('../app');\nconst request = require(\"supertest\");\nconst enjoyService = require('../services/enjoy.service');\n\ndescribe('/enjoy', () => {\n    describe(\"/cinema/:city\", () => {\n        test('Status is OK', () => {\n            return enjoyService.listCinema(\"nantes\").then(res => {\n                expect(res.data.status).toBe('OK');\n            });\n        });\n        test('Status is 404', () => {\n            return enjoyService.listCinema(\"X \u00c6 A-XII\").catch(err => {\n                expect(err.name).toBe(\"Error\");\n            });\n        });\n    });\n});\n`\n```\nAnd the `enjoy.service` used bellow\n```\n`const axios = require('axios'),\n    googleBaseURL = \"https://maps.googleapis.com/maps/api/place/textsearch/json?query=\";\n\nfunction listCinema(city) {\n    return axios.get(googleBaseURL + city + '&type=cinema&key=' + process.env.GOOGLE_API)\n}\n\n`\n```",
      "solution": "I've found a similar GitHub issue. It could help someone else having the same issue using JEST and ExpressJS\nThe similar issue says we have to add to our jest.config.js\n```\n`{\n  // ...\n  testEnvironment: 'node'\n  // ...\n}\n`\n```\nIn my case I added the code bellow to my `package.json` like so\n```\n`  \"jest\": {\n    \"testEnvironment\": \"node\"\n  },\n`\n```\nGood to know if you want to add the config from your `package.json` like me\n\nIf you'd like to use your package.json to store Jest's config, the\n\"jest\" key should be used on the top level so Jest will know how to\nfind your settings:\n```\n`{\n \"name\": \"my-project\",\n \"jest\": {\n   \"verbose\": true\n }\n}\n`\n```",
      "question_score": 7,
      "answer_score": 8,
      "created_at": "2021-05-16T12:38:05",
      "url": "https://stackoverflow.com/questions/67555622/jest-express-error-cross-origin-http-localhost-forbidden"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 66529141,
      "title": "Next.js API routes default response on error or no HTTP method match",
      "problem": "I'm working on API Routes in Next.js with every path is structured like this:\n`import { NextApiRequest, NextApiResponse } from \"next\";\n\nexport default async (req: NextApiRequest, res: NextApiResponse) => {\n  const { query } = req;\n\n  try {\n    switch (req.method) {\n      case \"GET\":\n        // Do some GET stuff\n        res.status(200).send(result);\n        break;\n\n      case \"POST\":\n        // Do some POST stuff\n        res.status(200).send(result);\n        break;\n\n      default:\n        // No Matched Method\n        res.status(405).send(\"Method Not Allowed\");\n        break;\n    }\n  } catch (e) {\n    // Unprocessable Entity\n    res.status(422).send(e);\n  }\n};\n`\nAs you can see the `default` case and `catch` part will be duplicated all over the files. So, I wanted to know:\n\nDoes Next.js has a built-in supports default response when there's no matched method or there's an error in processing the request?\n(If there's no built-in support) How can it be done?\n\nHere's my idea of a solution if there's no built-in support:\n\nUse a middleware\nCreate a function to wrap the API call before `export default`. I've tried to implement this but stuck at accessing `req` and `res` objects as in the code block below.\n\n`const wrapAPICall = async (\n  fn: (req: NextApiRequest, res: NextApiResponse) => void\n) => {\n  try {\n    await fn(req, res); // Can't access req, res here\n  } catch (e) {\n    res.status(422).send(e); // Also can't access req, res here\n  } finally {\n    if (!res.headersSent) res.status(405).send(\"Method Not Allowed\");\n  }\n};\n\nconst apiCall = async (req: NextApiRequest, res: NextApiResponse) => {\n  // Does some API stuff\n};\n\nexport default wrapAPICall(apiCall);\n`",
      "solution": "I think your wrapper solution is sound. To make it work you just need to return a function from the wrapper.\n`const wrapAPICall = (\n    fn: (req: NextApiRequest, res: NextApiResponse) => void\n) => {\n    return async (req: NextApiRequest, res: NextApiResponse) => {\n        try {\n            await fn(req, res);\n        } catch (e) {\n            res.status(422).send(e);\n        } finally {\n            if (!res.headersSent) res.status(405).send(\"Method Not Allowed\");\n        }\n    }\n};\n`",
      "question_score": 7,
      "answer_score": 4,
      "created_at": "2021-03-08T12:37:56",
      "url": "https://stackoverflow.com/questions/66529141/next-js-api-routes-default-response-on-error-or-no-http-method-match"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 65772869,
      "title": "How do I type hint the user argument when calling passport.serializeUser in TypeScript?",
      "problem": "Using TypeScript, I'm writing an API using Express and Mongoose, and I'm trying to set up authentication using Passport, but I'm getting a \"Property does not exist\" error when trying to pass a serializer function to passport.\nAccording to the documentation, I need to call `passport.serializeUser` with a function that takes my user object and calls `done` with that user's ID.\nI'm getting the type definitions from `@types/passport`, and the declaration file types the `user` argument for the `serializeUser` function as `Express.User`:\n```\n`serializeUser(fn: (user: Express.User, done: (err: any, id?: TID) => void) => void): void;\n`\n```\nBut `Express.User` - also defined by `@types/passport` - is an empty interface:\n```\n`declare global {\n    namespace Express {\n        // tslint:disable-next-line:no-empty-interface\n        interface AuthInfo {}\n        // tslint:disable-next-line:no-empty-interface\n        interface User {}\n`\n```\nHere's my serializer. TypeScript complains that `Property '_id' does not exist on type 'User'`.\n```\n`passport.serializeUser((user, done) => {\n  done(null, user._id);\n});\n`\n```\nTo work around this, I've added my type definition that add the `_id` property to Express.User:\n```\n`declare namespace Express {\n  interface User {\n    _id?: string;\n  }\n}\n`\n```\nThis eliminates the TypeScript error, but it doesn't seem like this is the correct way to solve the problem. Is there a different way to provide a serializer function that doesn't require me to override the `Express.User` type definition?",
      "solution": "The way Declaration Merging you've done is recommended by @types/express contributors.\nYou can find how they test `serializerUser` with TypeScript here.\n`declare global {\n  namespace Express {\n    interface User {\n      username: string;\n      _id?: number;\n    }\n  }\n}\n`\nAnother way is to type `User` argument of callback function each time you use the function:\n`type User = {\n  _id?: number\n}\n\npassport.serializeUser((user: User, done) => {\n  done(null, user._id);\n});\n`\nI think Declaration Merging is a bit smarter way.",
      "question_score": 7,
      "answer_score": 10,
      "created_at": "2021-01-18T11:36:38",
      "url": "https://stackoverflow.com/questions/65772869/how-do-i-type-hint-the-user-argument-when-calling-passport-serializeuser-in-type"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 65966642,
      "title": "this.debug is not a function Angular Universal",
      "problem": "I'm applying SSR in my project by using Angular 10.\nI've found that lot of people recommend using `domino`.\nBelow is my `server.ts` file\n```\n`...\n\nimport { existsSync, readFileSync } from 'fs';\nimport { createWindow } from 'domino';\n\nconst scripts = readFileSync('dist/video-website-angular/browser/index.html').toString();\n\nconst window = createWindow(scripts);\nglobal['window'] = window;\n\nimport { AppServerModule } from './src/main.server';\nimport { APP_BASE_HREF } from '@angular/common';\n\n...\n`\n```\nWhen I run `npm run dev:ssr`, I get the error",
      "solution": "Actually `this.debug is not a function` error is just a side effect. The actual error is the first one:\n\nIn order to fix it, you need to declare window as any, like this:\n`const window: any = createWindow(scripts);\n\n// or via a cast\n\nconst window = createWindow(scripts) as any;\n`\nThere is also another approach, that I like least since it practically make the TS code behave like JS, and cut all the typing and code hints support, but here it goes:\n`(global as any).window = window;\n(global as any).document = window.document;\n(global as any).Event = window.Event;\n(global as any).KeyboardEvent = window.KeyboardEvent;\n`\nEither of these should fix your issue.",
      "question_score": 7,
      "answer_score": 9,
      "created_at": "2021-01-30T10:57:03",
      "url": "https://stackoverflow.com/questions/65966642/this-debug-is-not-a-function-angular-universal"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 72105765,
      "title": "Axios doesn&#39;t create a cookie even though set-cookie header is there?",
      "problem": "Front-End: [Axios]\n```\n`  const formSubmit = async (e) => {\n    e.preventDefault()\n    const formData = new FormData(e.target)\n    const email = formData.get('email')\n    const password = formData.get('password')\n    try {\n      const res = await axios.post('http://172.16.2.19:3001/api/v1/auth/login', {\n        email,\n        password,\n      })\n      console.log(res.data) // its okay, I can login if email & password are correct.\n    } catch (error) {\n      console.log(error)\n    }\n  }\n`\n```\nBack-End [Nodejs ExpressJs]:\nInside App.js:\n```\n`const cors = require('cors')\napp.use(cors({ credentials: true }))\n`\n```\nInside Login.js (/auth/login endpoint):\n```\n`// ... code, then... if email & password are correct:\n// 3600000ms = 1hour\nres.cookie('jwt', token, { httpOnly: true, expires: new Date(Date.now() + 3600000 })\nres.status(200).json({\n    status: 'success'\n    token,\n    data: userDoc,\n})\n`\n```\nThen, when I login in my browser:\n\nI can login successfully, but no cookies will be created, see:\n\nThe front-end http service (react app) is running on `http://172.16.2.19:3000`\nThe back-end http service (expressjs) is running on `http://172.16.2.19:3001`\nThe axios requests I'm sending from the front-end are requesting: `http://172.16.2.19:3001`\n\nSo what's the problem?\nThe problem that no cookies are getting created in the browser is preventing me from continuing to design the front-end application, because if I wanted to request anything from my API, I have to be authenticated, all the routes on the API I made are protected, so if I wanted to request anything from the API, I will have to send my jwt token along with the request.\nedit **:\nhere's the response from the /auth/login endpoint after successfully logging in:\n\nI am using brave browser, the latest version.\nI tried this on firefox, it has the same behavior.",
      "solution": "let me save you time:\nFor anyone having the same problem, all you have to do is\nchange your backend code from:\n```\n`const cors = require('cors')\napp.use(cors({ credentials: true }))\n`\n```\nto\n```\n`app.use(cors({ credentials: true, origin: true }))\n`\n```\nand make sure you're using `withCredentials: true` on the front-end with every request (the login POST method and all the other requests that requires authentication)\nwhy?\nsetting `origin` property to true is going to reflect the request origin, the origin property can be a string if you wanted to specify a particular domain, ex: `http://localhost:3000`. But if you have more than one client, setting this to true is a wise choise.\nand for those of you wondering about mobile devices in case of specifying a string for the origin field with one particular domain. This problem of cors only happens in browsers, any other client doesn't use that CORS policy.",
      "question_score": 7,
      "answer_score": 5,
      "created_at": "2022-05-03T23:44:32",
      "url": "https://stackoverflow.com/questions/72105765/axios-doesnt-create-a-cookie-even-though-set-cookie-header-is-there"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 66987333,
      "title": "Start/stop cronjob on button click in Nodejs Express app",
      "problem": "I have been working on a project which requires the start and stop of cron scheduler when a user clicks on a button on the front end. Basically when a user clicks on a button, the cron job will start. And clicking the stop button will stop the timer. It is as simple as that.\nTo achieve that, I am making post requests to the Nodejs/Express backend on button click which triggers start/stop function of the scheduler. This is how the endpoint looks like:\n```\n`const cron = require('node-cron');\n\nrouter.post('/scheduler', async (req, res) => {\n\n    // gets the id from the button\n    const id = req.body.id;\n\n    try{\n         // finds the scheduler data from the MongoDB\n         const scheduler = await Scheduler.find({ _id: id });\n\n         // checks whether there is a scheduler or not\n         if ( !scheduler  ) {\n             return res.json({\n                  error: 'No scheduler found.'\n             });\n         }\n\n         // creates the cronjob instance with startScheduler \n         const task = cron.schedule('*/10 * * * * *', () =>  {\n              console.log('test cronjob running every 10secs');\n         }, {\n              scheduled: false\n         });\n\n         // checks if the scheduler is already running or not. If it is then it stops the scheduler\n         if ( scheduler.isRunning ) {\n\n             // scheduler stopped\n             task.stop();\n\n             return res.json({\n                  message: 'Scheduler stopped!'\n             });\n         }\n\n         // starts the scheduler\n         task.start();\n\n         res.json({\n              message: 'Scheduler started!'\n         });\n\n    }catch(e) {\n         console.log(e)\n    }\n});\n`\n```\nRight now the scheduler runs perfectly but it doesn't stop on second button click. It keeps on running. I feel like I'm not calling `task.start()` and `task.stop()` at correct places where it would work. And I don't know where the correct places are. I'm actually new to cronjobs.\nIt would be great if someone tells me what I am doing wrong.\nThanks in advance.",
      "solution": "Every time you hit the `scheduler api` a new instance of cron-job is made and you are stopping the newly defined instance of cron-job not the previous one.\nSolution is to define the cron-job out of the scope of router so that whenever you hit the `scheduler api` the instance won't change\nLike this:\n```\n`const cron = require('node-cron');\n\n// creates the cronjob instance with startScheduler \nconst task = cron.schedule('*/10 * * * * *', () =>  {\n    console.log('test cronjob running every 10secs');\n}, {\n    scheduled: false\n});\n\nrouter.post('/scheduler', async (req, res) => {\n\n    // gets the id from the button\n    const id = req.body.id;\n\n    try{\n         // finds the scheduler data from the MongoDB\n         const scheduler = await Scheduler.find({ _id: id });\n\n         // checks whether there is a scheduler or not\n         if ( !scheduler  ) {\n             return res.json({\n                  error: 'No scheduler found.'\n             });\n         }\n\n         // checks if the scheduler is already running or not. If it is then it stops the scheduler\n         if ( scheduler.isRunning ) {\n\n             // scheduler stopped\n             task.stop();\n\n             return res.json({\n                  message: 'Scheduler stopped!'\n             });\n         }\n\n         // starts the scheduler\n         task.start();\n\n         res.json({\n              message: 'Scheduler started!'\n         });\n\n    }catch(e) {\n         console.log(e)\n    }\n});\n`\n```",
      "question_score": 7,
      "answer_score": 4,
      "created_at": "2021-04-07T15:40:29",
      "url": "https://stackoverflow.com/questions/66987333/start-stop-cronjob-on-button-click-in-nodejs-express-app"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 69146517,
      "title": "Swagger UI &amp; Vercel: Unexpected token &lt; in JSON at position 1",
      "problem": "Code\nFull codebase & folder structure can be seen in GitHub\nHere is the Swagger related route (had to make it a standalone server)\n`// api/v1.ts\n\nimport express = require(\"express\");\nimport swaggerJSDoc = require(\"swagger-jsdoc\");\nimport swaggerUi = require(\"swagger-ui-express\");\nimport packageJSON = require(\"../package.json\");\nimport path = require(\"path\");\n\nconst app = express();\napp.use(express.json());\napp.use(express.static(path.resolve(__dirname, \"../\", \"public\")));\n\nconst swaggerSpec = swaggerJSDoc({\n  swaggerDefinition: some_spec,\n  apis: [\"api/*\"]\n});\n\nconst cssOpts = some_css_override;\n\napp.use(\"/api/v1\", swaggerUi.serve, swaggerUi.setup(swaggerSpec, cssOpts));\n\nmodule.exports = app;\n`\nProblem\nWhen I run `vercel dev` (locally- localhost:3000/api/v1), I see documentation as expected:\n\nHowever when I push my code to a branch which triggers a vercel build, I see the following:\n\nChecking the console, I see:\n```\n`DevTools failed to load source map: Could not parse content for https://colormaster-1unjfn63b-lbragile.vercel.app/api/v1/swagger-ui-bundle.js.map: Unexpected token Even though they respond with `200`\n\nI understand that this has something to do with `JSON.parse()` of HTML content, but not sure how to fix this. Any ideas?",
      "solution": "I am facing the exact same problem of you, trying without success to deploy Swagger to Vercel with Express.\nI did one step more, and now I'm seen an error in my console:\n\nRefused to apply style from\n'https://myurlishere.vercel.app/api-docs/swagger-ui.css' because its\nMIME type ('text/html') is not a supported stylesheet MIME type, and\nstrict MIME checking is enabled.\n\nWhat I did was, adding a file routes.ts\n```\n`import { Router } from 'express';\nimport LanguageController from './controller/LanguageController';\nimport WordController from './controller/WordController';\n\nconst routes = Router();\n\nroutes.get(\"/word\", WordController.find);\nroutes.get(\"/word/:wordName/language/:languageId\", WordController.findByWordAndLanguage);\nroutes.post(\"/word\", WordController.create);\nroutes.get(\"/language\", LanguageController.find);\n\nexport default routes;\n`\n```\nAnd my server.ts looks like that:\n```\n`import mongoose from 'mongoose';\nimport routes from './routes';\n\nconst express = require(\"express\");\n\nif (process.env.NODE_ENV !== 'production') {\n    require('dotenv').config();\n}\n\nconst app = express();\nconst cors = require('cors');\n\nmongoose.connect(process.env.MONGODB_URI || \"\", {\n    dbName: \"WordsThatIKnowMongoDB\"\n})\n    .then(() => console.debug(\"Database connected!\"))\n    .catch(err => { console.debug(err) });\n\napp.use(express.json());\napp.use(express.static(\"/api-docs\"));\n\napp.use(cors());\napp.use(routes);\n\nconst swaggerUi = require('swagger-ui-express');\nconst swaggerDocument = require('./swagger.json');\n\nroutes.use('/api-docs', swaggerUi.serve);\nroutes.get('/api-docs', swaggerUi.setup(swaggerDocument));\n\napp.listen(5000, () => {\n    console.debug(\"Running on port 5000.\");\n});\n\n// Export the Express API\nmodule.exports = app;\n`\n```\nYou will see in the file above that I changed app. to routes. like this:\n```\n`routes.use('/api-docs', swaggerUi.serve);\nroutes.get('/api-docs', swaggerUi.setup(swaggerDocument));\n`\n```\nI still can't solve this problem, but maybe this new error can help you find the solution. I'm also looking for that.\n\nEDIT: It's solved.\n\nThis is the code that solved my problem:\nserver.ts\n```\n`import path from 'path';\nimport cors from 'cors';\nimport bodyParser from 'body-parser';\nimport mongoose from 'mongoose';\nimport routes from './routes';\n\nconst express = require(\"express\");\nconst app = express();\n\nconst ROOT_FOLDER = path.join(__dirname, '..');\nconst SRC_FOLDER = path.join(ROOT_FOLDER, 'src');\n\n// parse requests of content-type - application/x-www-form-urlencoded\napp.use(bodyParser.urlencoded({ extended: true }));\n// parse requests of content-type - application/json\napp.use(bodyParser.json());\n\napp.use(cors());\napp.use(routes);\n\nif (process.env.NODE_ENV !== 'production') {\n    require('dotenv').config();\n}\n\nmongoose.connect(process.env.MONGODB_URI || \"\", {\n    dbName: \"WordsThatIKnowMongoDB\"\n})\n    .then(() => console.debug(\"Database connected!\"))\n    .catch(err => { console.debug(err) });\n\nconst swaggerUi = require('swagger-ui-express');\nconst swaggerDocument = require('./swagger.json');\nconst options = { customCssUrl: '/public/swagger-ui.css', customSiteTitle: \"The Words That I Know API - Swagger\" };\n\napp.use('/public', express.static(path.join(SRC_FOLDER, 'public')));\napp.use('/', swaggerUi.serve);\napp.get('/', swaggerUi.setup(swaggerDocument, options));\n\napp.listen(5000, () => {\n    console.debug(\"Running on port 5000.\");\n});\n\nexport default app;\n`\n```\nDon't forget to put the styles from Swagger at '/public/swagger-ui.css'. Create a `public` folder inside `src` and include a `swagger-ui.css` file. Inside of this, past swagger styles. You can find swagger styles using `inspect` on browser, and going to `source` tab. There you'll find the `swagger-ui.css` file; remove the commented line after pasting the styles code.\nIf you prefer an easy way to get the styles code, get this file. https://github.com/deywersonp/ghibli-50-api/blob/main/src/public/css/swagger-ui.css",
      "question_score": 7,
      "answer_score": 4,
      "created_at": "2021-09-11T22:33:07",
      "url": "https://stackoverflow.com/questions/69146517/swagger-ui-vercel-unexpected-token-in-json-at-position-1"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 68332633,
      "title": "AWS S3 Node.js SDK `NotImplemented` Error with Multer",
      "problem": "I'm trying to set up an endpoint to upload files to an AWS S3 bucket. I am using Node.JS, Express, the AWS S3 SDK, and the Multer library.\nThis is the code I'm using currently for the uploading middleware:\n```\n`export const uploadMiddleware = multer({\n  storage: {\n    _handleFile(\n      req: Request,\n      file: Express.Multer.File,\n      callback: (error?: any, info?: Partial) => void\n    ) {\n      const key = crypto.randomBytes(16).toString('hex');\n      s3.send(\n        new PutObjectCommand({\n          Bucket: 'my-bucket',\n          Body: file.stream,\n          Key: key,\n          ContentLength: file.size,\n          ContentType: file.mimetype,\n        }),\n        (err, output) => {\n          if (err) {\n            console.log(err);\n            callback(err, undefined);\n          } else {\n            console.log(output);\n            callback(null, file);\n          }\n        }\n      );\n    },\n    _removeFile(\n      req: Request,\n      file: Express.Multer.File,\n      callback: (error: Error) => void\n    ) {\n      // @ts-ignore\n      callback(null);\n    },\n  },\n}).array('files');\n`\n```\nHowever, the S3 SDK is giving this error:\n```\n`NotImplemented: A header you provided implies functionality that is not implemented\n2021-07-11T00:18:48.557532998Z     at deserializeAws_restXmlPutObjectCommandError (/usr/src/app/node_modules/@aws-sdk/client-s3/protocols/Aws_restXml.ts:9515:39)\n2021-07-11T00:18:48.557542041Z     at processTicksAndRejections (internal/process/task_queues.js:93:5)\n2021-07-11T00:18:48.557545571Z     at /usr/src/app/node_modules/@aws-sdk/middleware-serde/src/deserializerMiddleware.ts:18:20\n2021-07-11T00:18:48.557548319Z     at /usr/src/app/node_modules/@aws-sdk/middleware-signing/src/middleware.ts:26:22\n2021-07-11T00:18:48.557551272Z     at StandardRetryStrategy.retry (/usr/src/app/node_modules/@aws-sdk/middleware-retry/src/StandardRetryStrategy.ts:83:38)\n2021-07-11T00:18:48.557554272Z     at /usr/src/app/node_modules/@aws-sdk/middleware-logger/src/loggerMiddleware.ts:22:22 {\n2021-07-11T00:18:48.557557035Z   Code: 'NotImplemented',\n2021-07-11T00:18:48.557559463Z   Header: 'Transfer-Encoding',\n2021-07-11T00:18:48.557561825Z   RequestId: 'T6QNENNWC0X2WDXP',\n2021-07-11T00:18:48.557564202Z   HostId: 'gJo7gOiFu9RjdvishH0t6EP8/BHDlBW913gicSlYh1eyJ/JkZaX9QSepRmdeq5Gxt4lg6aKMxxI=',\n2021-07-11T00:18:48.557566724Z   '$fault': 'client',\n2021-07-11T00:18:48.557569116Z   '$metadata': {\n2021-07-11T00:18:48.557571528Z     httpStatusCode: 501,\n2021-07-11T00:18:48.557573948Z     requestId: undefined,\n2021-07-11T00:18:48.557576323Z     extendedRequestId: 'gJo7gOiFu9RjdvishH0t6EP8/BHDlBW913gicSlYh1eyJ/JkZaX9QSepRmdeq5Gxt4lg6aKMxxI=',\n2021-07-11T00:18:48.557578821Z     cfId: undefined,\n2021-07-11T00:18:48.557589903Z     attempts: 1,\n2021-07-11T00:18:48.557592818Z     totalRetryDelay: 0\n2021-07-11T00:18:48.557595524Z   },\n2021-07-11T00:18:48.557597888Z   storageErrors: []\n2021-07-11T00:18:48.557600254Z }\n`\n```\nI have tried multiple possibly solutions, such as including/excluding `ContentLength` and `ContentType`, and using `file.buffer` instead of `file.stream`. I've also tried other solutions from related StackOverflow posts, but nothing has worked.\nNote that I am also aware that NPM packages for Multer/S3 interoperability exist, however none use the new modular AWS system and so I opted to use my own.\nAny help would be appreciated, thanks!",
      "solution": "I had to convert the stream to a buffer in the `handleFile` function:\n```\n`async function streamToBuffer(stream: Stream): Promise {\n  return new Promise((resolve, reject) => {\n    const _buf: any[] = [];\n\n    stream.on('data', (chunk) => _buf.push(chunk));\n    stream.on('end', () => resolve(Buffer.concat(_buf)));\n    stream.on('error', (err) => reject(err));\n  });\n}\n\nexport function handleFile(\n  req: Request,\n  file: Express.Multer.File,\n  callback: (error?: any, info?: Express.Multer.File) => void\n) {\n  const key = generateId();\n\n  streamToBuffer(file.stream)\n    .then((buffer) =>\n      s3.send(\n        new PutObjectCommand({\n          Bucket: config.aws.issueNewBucket,\n          Body: buffer,\n          Key: key,\n          ACL: 'public-read',\n          ContentType: file.mimetype,\n        })\n      )\n    )\n    .then(() => callback(null, file))\n    .catch((err) => callback(err));\n}\n`\n```",
      "question_score": 6,
      "answer_score": 10,
      "created_at": "2021-07-11T03:29:55",
      "url": "https://stackoverflow.com/questions/68332633/aws-s3-node-js-sdk-notimplemented-error-with-multer"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 72382892,
      "title": "Access to fetch at https://accounts.google.com/o/oauth2/v2/auth has been blocked by CORS",
      "problem": "I'm sending fetch from React to Express to authenticate with Google but I've been getting access blocked by CORS error. I'm redirecting the POST request from React to the Google URL for authentication. I tried using cors in the express app but I'm still getting the same error.\nFor fetching\n```\n`const handleClick = (e) => {\n    fetch('http://localhost:8000/api/mail/login', {\n        method: 'POST'\n    })\n    .then(res => res.text())\n}\n`\n```\nUsing cors in express app.js\n```\n`app.use(cors())\n`\n```\nTrying to redirect to google auth\n```\n`const oauth2Client = new google.auth.OAuth2(\n    process.env.CLIENT_ID,\n    process.env.CLIENT_SECRET,\n    process.env.REDIRECT_URI\n)\n\nconst url = oauth2Client.generateAuthUrl({\n    access_type: 'offline',\n    scope: process.env.SCOPE\n})\n\nconst gmail = google.gmail({\n    version: 'v1',\n    auth: oauth2Client\n})\n\nrouter.post('/login', (req, res, next) => {\n    res.redirect(url)\n})\n`\n```\nThe error: Access to fetch at 'https://accounts.google.com/o/oauth2/v2/auth?access_type=offline&scope=https%3A%2F%2Fmail.google.com%2F&response_type=code&client_id=727520060136-ngpfd4ll798v42gfclh7cms9ndqstt32.apps.googleusercontent.com&redirect_uri=http%3A%2F%2Flocalhost%3A8000' (redirected from 'http://localhost:8000/api/mail/login') from origin 'http://localhost:3000' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled.",
      "solution": "The authentication flow must happen in a visible browsing context, not with a `fetch` request. In other words: You must navigate the current tab to (or open a new tab at) http://localhost:8000/api/mail/login, the tab will then be redirected to https://accounts.google.com/o/oauth2/v2/auth?... and this page becomes visible. Now the user must interact with that page to choose/confirm their Google account, after which they will be redirected to a page on your server with an authorization code in the URL (for example, http://localhost:8000/callback?code=...) and your server must exchange the authorization code for an access token with a server-to-server call.\nWhen made like this, none of the requests made is cross-origin, so no CORS will be involved at all.\nInstead of the `handleClick` function, you need a login form like\n`\n  \n\n`",
      "question_score": 6,
      "answer_score": 17,
      "created_at": "2022-05-25T20:57:26",
      "url": "https://stackoverflow.com/questions/72382892/access-to-fetch-at-https-accounts-google-com-o-oauth2-v2-auth-has-been-blocked"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 72305189,
      "title": "NestJS - Increase response timeout for particular http endpoint",
      "problem": "I just started to learn about NestJS and I am wondering how could I manipulate response timeout for particular endpoints?\nI could do it on a server level like:\n```\n`  const server = await app.listen(...);\n  server.setTimeout(1800000)\n`\n```\nor on endpoint, which looks bad:\n```\n`  @Post('/test')\n  public async import(...props, @Res() res: Response): Promise {\n    res.setTimeout(1800000)\n  }\n`\n```\nBut how could I do that on controller or method level?\nI have tried to increase timeout on endpoint using interceptors like:\n```\n`import { Injectable, NestInterceptor, ExecutionContext, CallHandler, RequestTimeoutException } from '@nestjs/common';\nimport { Observable, throwError, TimeoutError } from 'rxjs';\nimport { catchError, take, timeout } from 'rxjs/operators';\n\n@Injectable()\nexport class TimeoutInterceptor implements NestInterceptor {\n  intercept(context: ExecutionContext, next: CallHandler): Observable {\n\n    return next.handle().pipe(\n      timeout(1800000),\n      catchError(err => {\n        if (err instanceof TimeoutError) {\n          return throwError(() => new RequestTimeoutException());\n        }\n        return throwError(() => err);\n      }),\n    );\n  };\n};\n`\n```\nAnd applying it on endpoint like:\n```\n`  @Post('/test')\n  @UseInterceptors(TimeoutInterceptor)\n  public async import(...props, @Res() res: Response): Promise {\n    long running code...\n  }\n`\n```\nAlthough interceptor is triggered so I am able to log something\nthe timeout does not seems to work at all :/",
      "solution": "```\n`import { Injectable, NestInterceptor, ExecutionContext, CallHandler } from '@nestjs/common';\nimport { Observable } from 'rxjs';\n\n@Injectable()\nexport class TimeoutInterceptor implements NestInterceptor {\n  constructor(\n    private readonly reflector: Reflector,\n  ) {}\n\n  intercept(context: ExecutionContext, next: CallHandler): Observable {\n    const response = context.switchToHttp().getResponse();\n    const timeout = this.reflector.get('request-timeout', context.getHandler()) || 60000;\n    response.setTimeout(timeout )\n\n    return next.handle();\n  };\n}\n`\n```\n```\n`import { applyDecorators, SetMetadata, UseInterceptors } from '@nestjs/common';\n\nconst SetTimeout = (timeout: number) => SetMetadata('request-timeout', timeout);\n\nexport function SetRequestTimeout(timeout: number = 60000) {\n  return applyDecorators(\n    SetTimeout(timeout),\n    UseInterceptors(TimeoutInterceptor),\n  );\n}\n`\n```\nYou might have to play a bit with providers (add the interceptor to it)\nBut now you can use `@SetRequestTimeout()` or `@SetRequestTimeout(10000)` for convenience.",
      "question_score": 6,
      "answer_score": 16,
      "created_at": "2022-05-19T15:11:14",
      "url": "https://stackoverflow.com/questions/72305189/nestjs-increase-response-timeout-for-particular-http-endpoint"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 69195824,
      "title": "trying to connect mongoDB to my web app but it shows following error",
      "problem": "Error:\n\nC:\\Users\\Bpc\\Desktop\\devcamper_api\\node_modules\\mongodb\\lib\\connection_string.js:281\nthrow new error_1.MongoParseError(`${optionWord} ${Array.from(unsupportedOptions).join(', ')} ${isOrAre} not supported`);\n^\n\nMongoParseError: options usecreateindex, usefindandmodify are not supported\nat Object.parseOptions (C:\\Users\\Bpc\\Desktop\\devcamper_api\\node_modules\\mongodb\\lib\\connection_string.js:281:15)\nat new MongoClient (C:\\Users\\Bpc\\Desktop\\devcamper_api\\node_modules\\mongodb\\lib\\mongo_client.js:62:46)\nat C:\\Users\\Bpc\\Desktop\\devcamper_api\\node_modules\\mongoose\\lib\\connection.js:781:16\nat new Promise ()\nat NativeConnection.Connection.openUri (C:\\Users\\Bpc\\Desktop\\devcamper_api\\node_modules\\mongoose\\lib\\connection.js:778:19)\nat C:\\Users\\Bpc\\Desktop\\devcamper_api\\node_modules\\mongoose\\lib\\index.js:330:10\nat C:\\Users\\Bpc\\Desktop\\devcamper_api\\node_modules\\mongoose\\lib\\helpers\\promiseOrCallback.js:32:5\nat new Promise ()\nat promiseOrCallback (C:\\Users\\Bpc\\Desktop\\devcamper_api\\node_modules\\mongoose\\lib\\helpers\\promiseOrCallback.js:31:10)\nat Mongoose._promiseOrCallback (C:\\Users\\Bpc\\Desktop\\devcamper_api\\node_modules\\mongoose\\lib\\index.js:1151:10)\n\nand this is my code:\n```\n`const mongoose = require('mongoose');\n\nconst connectDB = async () => {\n    const conn = await mongoose.connect(process.env.MONGO_URI,\n        {\n            useNewUrlParser: true,\n            useCreateIndex: true,\n            useFindAndModify: false,\n            useUnifiedTopology: true\n        });\n    console.log(`MongoDB Connected: ${conn.connection.host}`);\n};\n\nmodule.exports = connectDB;\n`\n```",
      "solution": "Seems to be the same as:\nMongoParseError: options useCreateIndex, useFindAndModify are not supported\n\nFrom the Mongoose 6.0 docs:\n\nuseNewUrlParser, useUnifiedTopology, useFindAndModify, and useCreateIndex >>are no longer supported options. Mongoose 6 always behaves as if >>useNewUrlParser, useUnifiedTopology, and useCreateIndex are true, and >>useFindAndModify is false. Please remove these options from your code.\n\nSource: https://stackoverflow.com/a/68962378/7860331",
      "question_score": 6,
      "answer_score": 13,
      "created_at": "2021-09-15T17:20:48",
      "url": "https://stackoverflow.com/questions/69195824/trying-to-connect-mongodb-to-my-web-app-but-it-shows-following-error"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 68704447,
      "title": "Nest.js pass variable from middleware to controller",
      "problem": "I couldn't find a clear way of passing variables from a middleware to a constructure in Nest.js. I'm validating a JWT inside my `AuthMiddleware` and I want to make this token accessible to the controllers.\nBelow is just an extract of my middleware to provide a code sample. I want to make the `token` accessible inside of my Controllers.\n`import { Request, Response, NextFunction } from 'express';\n// other imports\n\n@Injectable()\nexport class AuthMiddleware implements NestMiddleware {\n  async use(req: Request, res: Response, next: NextFunction) {\n    const authHeader = req.header('authorization');\n\n    if (!authHeader) {\n      throw new HttpException('No auth token', HttpStatus.UNAUTHORIZED);\n    }\n\n    const bearerToken: string[] = authHeader.split(' ');\n    const token: string = bearerToken[1];\n\n    res.locals.token = token;\n  }\n}\n`\nI already tried to make the token accessible by changing the `res.locals` variable but the response object is still empty in my controller.\nThis is my controller in which I want to access the token of the middleware:\n`@Controller('did')\nexport default class DidController {\n  constructor(private readonly didService: DidService) {}\n\n  @Get('verify')\n  async verifyDid(@Response() res): Promise {\n    console.log(res)\n    // {}\n    return res;\n  }\n`",
      "solution": "Better approach would be to create a parameter decorator and use it to inject token dependency in controller without modifying code of the controller to unnecessarily use `Request/Response`\nAuthMiddleware\n```\n`import { Request, Response, NextFunction } from 'express';\n// other imports\n\n@Injectable()\nexport class AuthMiddleware implements NestMiddleware {\n  async use(req /*: Request */, res: Response, next: NextFunction) {\n    const authHeader = req.header('authorization');\n\n    if (!authHeader) {\n      throw new HttpException('No auth token', HttpStatus.UNAUTHORIZED);\n    }\n\n    const bearerToken: string[] = authHeader.split(' ');\n    const token: string = bearerToken[1];\n\n    req.token  = token; // request type is commented out otherwise typescript won't allow setting this\n\n    next();\n  }\n}\n`\n```\nParameter decorator (./token.decorator.ts):\n```\n`import { createParamDecorator, ExecutionContext } from '@nestjs/common';\n\nexport const TOKEN = createParamDecorator(\n  (_data: unknown, ctx: ExecutionContext) => {\n    const request = ctx.switchToHttp().getRequest();\n    return request.token; // extract token from request\n  },\n);\n\n`\n```\nController:\n```\n`import { Controller, Get, Response } from '@nestjs/common';\nimport { TOKEN } from './token.decorator';\n\n@Controller()\nexport class AppController {\n  constructor() {}\n\n  @Get('verify')\n  async verifyDid(@TOKEN() token): Promise {\n    console.log(token);\n    return 'whateverYouWant';\n  }\n}\n`\n```",
      "question_score": 6,
      "answer_score": 8,
      "created_at": "2021-08-08T22:20:31",
      "url": "https://stackoverflow.com/questions/68704447/nest-js-pass-variable-from-middleware-to-controller"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 68970788,
      "title": "Getting no overload matches this call running mongoose with typescript and express",
      "problem": "I am getting the below error for useNewUrlParser, useUnifiedTopology, useCreateIndex:\n```\n`No overload matches this call.\n  Overload 1 of 3, '(uri: string, callback: CallbackWithoutResult): void', gave the following error.\n    Argument of type '{ useNewUrlParser: boolean; useUnifiedTopology: boolean; useCreateIndex: boolean; }' is not assignable to parameter of type 'CallbackWithoutResult'.\n      Object literal may only specify known properties, and 'useNewUrlParser' does not exist in type 'CallbackWithoutResult'.\n  Overload 2 of 3, '(uri: string, options?: ConnectOptions | undefined): Promise', gave the following error.\n    Argument of type '{ useNewUrlParser: boolean; useUnifiedTopology: boolean; useCreateIndex: boolean; }' is not assignable to parameter of type 'ConnectOptions'.\n      Object literal may only specify known properties, and 'useNewUrlParser' does not exist in type 'ConnectOptions'.\n`\n```\nIndex.ts\n```\n`import express from 'express'\nimport { errorHandler } from './middleware/error-handler';\nimport router from './router'\nimport mongoose from 'mongoose'\n\nconst app = express()\n\napp.use(express.json())\napp.use('/api/users', router)\napp.use(errorHandler)\n\nconst start = async () => {\n  try {\n    await mongoose.connect(\"mongodb://auth-mongo-srv:27017/auth\", {\n      useNewUrlParser: true,    // error here\n      useUnifiedTopology: true,\n      useCreateIndex: true,\n    });\n    console.log(\"Connected to MongoDb\");\n  } catch (err) {\n    console.error(err);\n  }\n};\n\nconst PORT = 3000\napp.listen(PORT, () => {\n    console.log(\"working on port \",PORT)\n})\n\nstart()\n`\n```\ntsconfig.json\n```\n`{\n  \"compilerOptions\": {\n\"target\": \"es6\",\n\"module\": \"commonjs\", \n\"esModuleInterop\": true, \n\"forceConsistentCasingInFileNames\": true,\n\"strict\": true, \n\"skipLibCheck\": true\n }\n}\n`\n```\nI have mongoose 6.02 installed in package.json and if it is of any help, I am getting mongo from dockerhub and running in a cluster pod.\nAny help or suggestion is appreciated.",
      "solution": "ConnectOptions of mongoose for version 6.0.2 does not include useNewUrlParser, useUnifiedTopology, useCreateIndex. However, mongoose docs for 6.0.2 still shows those options to be valid and without those options, mongoose is throwing a topology error.\nDowngraded mongoose to version 5.13.8 and now it is working without problems.",
      "question_score": 6,
      "answer_score": 2,
      "created_at": "2021-08-29T09:32:30",
      "url": "https://stackoverflow.com/questions/68970788/getting-no-overload-matches-this-call-running-mongoose-with-typescript-and-expre"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 69920772,
      "title": "Shopify API Node/Express Cannot read properties of undefined (reading &#39;Rest&#39;)",
      "problem": "Just starting off with Shopify, and trying to get an order. Following the Shopify API documentation, here is my code:\n```\n`const Shopify = require('@shopify/shopify-api');\n\nconst client = new Shopify.Clients.Rest('my-store.myshopify.com', \nprocess.env.SHOPIFY_KEY);\n\nmodule.exports.getShopifyOrderById = async (orderId) => {\nreturn await client.get({ \n    path: `orders/${orderId}`,\n  });\n}\n`\n```\nI get the following error when I execute this code:\n`TypeError: Cannot read properties of undefined (reading 'Rest')`\nCan't seem to figure out what the issue is.",
      "solution": "You need to use Object destructing to get the Shopify object or use default export like below.\n```\n`const { Shopify } = require('@shopify/shopify-api');\n\nconst client = new Shopify.Clients.Rest('my-store.myshopify.com', \nprocess.env.SHOPIFY_KEY);\n`\n```\nOR\n```\n`const Shopify = require('@shopify/shopify-api').default;\n\nconst client = new Shopify.Clients.Rest('my-store.myshopify.com', \nprocess.env.SHOPIFY_KEY);\n`\n```\nOR\n```\n`const ShopifyLib = require('@shopify/shopify-api');\n\nconst client = new ShopifyLib.Shopify.Clients.Rest('my-store.myshopify.com', \nprocess.env.SHOPIFY_KEY);\n`\n```\nThis has to do with how ES6 modules are emulated in CommonJS and how you import the module. You can read about that here.",
      "question_score": 6,
      "answer_score": 10,
      "created_at": "2021-11-10T23:06:01",
      "url": "https://stackoverflow.com/questions/69920772/shopify-api-node-express-cannot-read-properties-of-undefined-reading-rest"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 68928008,
      "title": "Can&#39;t import module without the .js extension in nodejs",
      "problem": "Importing a module in my nodejs app is always flagging an error\n```\n`Error [ERR_MODULE_NOT_FOUND]: Cannot find module 'C:\\xampp\\htdocs\\2021\\farmi\\api\\src\\controllers\\user.controller' imported from C:\\xampp\\htdocs\\2021\\farmi\\api\\src\\routes\\user.route.js\n    at finalizeResolution (internal/modules/esm/resolve.js:276:11)\n    at moduleResolve (internal/modules/esm/resolve.js:699:10)\n    at Loader.defaultResolve [as _resolve] (internal/modules/esm/resolve.js:810:11)\n    at Loader.resolve (internal/modules/esm/loader.js:88:40)\n    at Loader.getModuleJob (internal/modules/esm/loader.js:241:28)\n    at ModuleWrap. (internal/modules/esm/module_job.js:56:40)\n    at link (internal/modules/esm/module_job.js:55:36) {\n  code: 'ERR_MODULE_NOT_FOUND'\n}\n[nodemon] app crashed - waiting for file changes before starting...\n`\n```\nThis is because I didn't include the .js extension in `import userController from '../controllers/user.controller';`\nHow can I resolve this please.",
      "solution": "`../controllers/user.controller` is a relative specifier. They refer to a path relative to the location of the importing file. The file extension is always necessary for these. See the documentation",
      "question_score": 6,
      "answer_score": 6,
      "created_at": "2021-08-25T20:17:37",
      "url": "https://stackoverflow.com/questions/68928008/cant-import-module-without-the-js-extension-in-nodejs"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 71573382,
      "title": "What type of email should I use for nodemailer to not get blocked",
      "problem": "I tried to figure out the problem, but everything was correctly configured. I'm used gmail, but when I deployed my nodejs website, immediately been blocked. After I tried outlook email, a had a few problems to set up, but worked on localhost, and worked on server too. After a day, when I wanted to try, it was blocked too. What type of email should I use, which is free, and working perfectly with nodemailer and not blocking, when someone want to send email when the website is on a server?\n\r\n\r\n`let transporter = nodemailer.createTransport({\n      host: \"smtp-mail.outlook.com\",\n      secureConnection: false,\n      port: 587,\n      tls: {\n        ciphers:'SSLv3'\n      },\n      auth: {\n        user: 'example@outlook.com',\n        pass: 'xxxx'\n      }\n    });\n\n  let mailOptions = {\n    from: '',\n    to: 'example@outlook.com',\n    subject: 'Bek\u00fcld\u00f6tt recept: ' + req.body.recipename,\n    text: '',\n    html: \"\",\n    attachments: [{\n      filename: imageName,\n      path: newuploadPath\n    }]\n  };`",
      "solution": "I used Zoho mail and it works fine. Make sure to use the same Zoho email address in the `from` field of `mailOptions` as it will throw an error otherwise.\n```\n`var transport = nodemailer.createTransport({\n    host: 'smtp.zoho.eu',\n    port: 465,\n    secure: true, //ssl\n    auth: {\n        user:process.env.EMAIL,\n        pass:process.env.EMAIL_PASSWORD\n    }\n});\n\nvar mailOptions = {\n    from: process.env.EMAIL,\n    to: req.body.email,\n    subject: \"Subject\",\n    html: \"\"\n};\n`\n```\nGenerally Gmail is not the preferred service to use with Nodemailer since it is targeted at real users and not for automatic/programmed use. See Nodemailer with Gmail for more info. Also here is a list of alternative email services supported by Nodemailer WELL-KNOWN SERVICES.",
      "question_score": 6,
      "answer_score": 9,
      "created_at": "2022-03-22T15:02:29",
      "url": "https://stackoverflow.com/questions/71573382/what-type-of-email-should-i-use-for-nodemailer-to-not-get-blocked"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 66368134,
      "title": "Why is axios trying to connect on port 80 and not 8080?",
      "problem": "I am running a Node/Express back-end with a `vue` front-end on a Windows 10 machine. I did install `iisnode` because I thought I would serve `server.js` using IIS, but at the moment I am in development and would like to leave IIS out of it.\nHowever, when I make a production build of the website and run `node ./dist/server.js`, the Node/Express server runs on `port 8080` and the homepage loads fine.\nWhen I go to a product page that makes an `axios` call, I am getting an error that:\n```\n`Error: connect ECONNREFUSED 127.0.0.1:80\n    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1137:16) {\n  errno: -4078,\n  code: 'ECONNREFUSED',\n  syscall: 'connect',\n  address: '127.0.0.1',\n  port: 80,\n  config: {\n    url: '/api/int/v1/product/10800',\n    method: 'get',\n    headers: {\n      Accept: 'application/json, text/plain, */*',\n      'User-Agent': 'axios/0.21.1'\n    },\n...... // more stuff here\nisAxiosError: true //I don't understand why it is trying to connect on port 80 instead of just going to `http://localhost:8080/api/int/v1/product/10800`\nserver.js does this:\n```\n`const PORT = process.env.PORT || 8080;\nserver.listen(PORT, () => {\n    console.log(`Server is listening on port ${PORT}`);\n});\n`\n```\nAnd I even set the `port` when running the build script like this:\n```\n`\"build:server\": \"cross-env PORT=8080 NODE_ENV=production webpack --config build/webpack.server.config.js\"\n`\n```\nIn the `console` log it even says `Server is listening on port 8080`",
      "solution": "You need to configure the axios BASE_URL, defining the port there e.g.:\n```\n`import axios from 'axios'\naxios.defaults.baseURL = 'http://localhost:8080';\n`\n```",
      "question_score": 6,
      "answer_score": 8,
      "created_at": "2021-02-25T13:03:42",
      "url": "https://stackoverflow.com/questions/66368134/why-is-axios-trying-to-connect-on-port-80-and-not-8080"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 79873598,
      "title": "MongoDB Atlas SRV connection fails with querySrv ECONNREFUSED after switching Node versions (Node 22, Windows)",
      "problem": "I\u2019m running into a MongoDB connection issue that only appeared after switching Node.js versions, and I haven\u2019t been able to resolve it despite extensive troubleshooting.\nEnvironment\n\nOS: Windows 10\n\nCurrent versions:\n```\n`node v22.22.0\nnpm 10.9.4\nmongoose 8.x\nmongodb 6.x\n\n`\n```\n\nThe application code and MongoDB Atlas cluster configuration have not changed.\n\nError\nOn application startup, I consistently get:\n```\n`Error: querySrv ECONNREFUSED _mongodb._tcp..mongodb.net\n    at QueryReqWrap.onresolve [as oncomplete] (node:internal/dns/promises:294:17)\n`\n```\n\nMongoDB connection\nI\u2019m using a standard Atlas SRV connection string, for example:\n```\n`mongodb+srv://:@.mongodb.net/?retryWrites=true&w=majority\n`\n```\nThis same connection string worked previously on Node 22.\n\nDNS verification (Windows)\nSRV resolution works at the OS level:\n```\n`nslookup -type=SRV _mongodb._tcp..mongodb.net\n`\n```\nThis returns the expected shard hosts and ports, so DNS itself appears to be resolving correctly outside of Node.\n\nWhat I\u2019ve already tried\n\nFull dependency reset:\n```\n`rm -rf node_modules package-lock.json\nnpm cache clean --force\nnpm install\nnpm rebuild\n\n`\n```\n\nVerified Node and npm versions\n\nForced IPv4 DNS resolution in Node:\n```\n`import dns from \"dns\";\ndns.setDefaultResultOrder(\"ipv4first\");\n\n`\n```\n\nChanged system DNS to Cloudflare (`1.1.1.1`)\n\nRestarted the system\n\nVerified `.env` loading and `mongoose.connect()` usage\n\nNone of the above resolved the issue.",
      "solution": "After switching Node.js versions on Windows, Node started using a broken or unreachable DNS resolver. Even though SRV records resolved correctly with `nslookup`, Node\u2019s internal DNS resolver failed, causing `querySrv ECONNREFUSED` before any MongoDB connection was attempted.\nFix\nForce DNS servers explicitly in Node before connecting to MongoDB:\n```\n`require(\"node:dns/promises\").setServers([\"1.1.1.1\", \"8.8.8.8\"]);\n`\n```\nWhy this works\nNode.js does not always use the Windows system DNS resolver. Setting DNS servers inside Node bypasses resolver issues introduced by switching Node versions and allows MongoDB Atlas SRV lookup to succeed.\nRef: Error: querySrv ECONNREFUSED MongoDB",
      "question_score": 6,
      "answer_score": 7,
      "created_at": "2026-01-22T11:01:10",
      "url": "https://stackoverflow.com/questions/79873598/mongodb-atlas-srv-connection-fails-with-querysrv-econnrefused-after-switching-no"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 75181033,
      "title": "Except from memory and CPU leaks, what will be reasons for Node.js server might go went down?",
      "problem": "I have a Node.js (Express.js) server for my React.js website as BFF. I use Node.js for SSR, proxying some request and cache some pages in Redis. In last time I found that my server time to time went down. I suggest an uptime is about 2 days. After restart, all ok, then response time growth from hour to hour. I have resource monitoring at this server, and I see that server don't have problems with RAM or CPU. It used about 30% of RAM and 20% of CPU.\nI regret to say it's a big production site and I can't make minimal reproducible example, cause i don't know where  is reason of these error :(\nExcept are memory and CPU leaks, what will be reasons for Node.js server might go went down?\nI need at least direction to search.\nUPDATE1:\n\"went down\" - its when kubernetes kills container due 3 failed life checks  (GET request to a root / of website)\nMy site don't use any BD connection but call lots of 3rd party API's. About 6 API requests due one GET/ request from browser\nUPDATE2:\nThx. To your answers, guys.\nTo understand what happend inside my GET/ request, i'm add open-telemetry into my server. In longtime and timeout GET/ requests i saw long API requests with very big tcp.connect and tls.connect.\n\nI think it happens due lack of connections or something about that. I think Mostafa Nazari is right.\nI create patch and apply them within the next couple of days, and then will say if problem gone\nI solve problem.\nIt really was lack of connections. I add reusing node-fetch connection due keepAlive and a lot of cache for saving connections. And its works.\nThanks for all your answers. They all right, but most helpful thing was added open-telemetry to my server to understand what exactly happens inside request.\nFor other people with these problems, I'm strongly recommended as first step, add telemetry to your project.\nhttps://opentelemetry.io/\nPS: i can't mark two replies as answer. Joe have most detailed and Mostafa Nazari most relevant to my problem. They both may be \"best answers\".\nTnx for help, guys.",
      "solution": "Gradual growth of response time suggest some kind of leak.\nIf CPU and memory consumption is excluded, another potentially limiting resources include:\n\nFile descriptors - when your server forgets to close files. Monitor for number of files in /proc//fd/* to confirm this. See what those files are, find which code misbehaves.\n\nDirectory listing - even temporary directory holding a lot of files will take some time to scan, and if your application is not removing some temporary files and lists them - you will be in trouble quickly.\n\nZombie processes - just monitor total number of processes on the server.\n\nFirewall rules (some docker network magic may in theory cause this on host system) - monitor length of output of \"iptables -L\" or \"iptables-save\" or equivalent on modern kernels. Rare condition.\n\nMemory fragmentation - this may happen in languages with garbage collection, but often leaves traces with something like \"Can not allocate memory\" in logs. Rare condition, hard to fix. Export some health metrics and make your k8s restart your pod preemptively.\n\nApplication bugs/implementation problems. This really depends on internal logic - what is going on inside the app. There may be some data structure that gets filled in with data as time goes by in some tricky way, becoming O(N) instead of O(1). Really hard to trace down, unless you have managed to reproduce the condition in lab/test environment.\n\nAPI calls from frontend shift to shorter, but more CPU-hungry ones. Monitor distribution of API call types over time.",
      "question_score": 6,
      "answer_score": 4,
      "created_at": "2023-01-20T08:38:13",
      "url": "https://stackoverflow.com/questions/75181033/except-from-memory-and-cpu-leaks-what-will-be-reasons-for-node-js-server-might"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 71899948,
      "title": "Express and MongoDB without Mongoose",
      "problem": "This is not so much of a question but more of a consult request. I couldn't find resources to check my method's validity so I would like to hear MongoDB experts' opinion.\nI was playing around with MongoDB and came up with this middleware method to pass client to my routes. I have this Express middleware:\n`const addClientToRequest = async (req, _, next) => {\n  const client = new MongoClient(uri);\n  await client.connect();\n  req.client = client;\n  next();\n};\n\napp.use(addClientToRequest);\n`\nAfter that, I use req.client in my routes to access my database.\n`app.get(\"/:id\", async (req, res) => {\n  const client = req.client;\n  const id = req.params.id;\n  try {\n    const data = await client.db(\"mydb\").collection(\"mycollection\").findOne({ id });\n    if (data) return res.status(200).json(data);\n  } catch (error) {\n    return res\n      .status(500)\n      .json({ message: \"Error fetching requested data\", error });\n  }\n  return res.status(404).json({ message: \"Requested data cannot be found\" });\n});\n`\nWhat would be a problem in this approach? Is it okay to use MongoDB client like this?",
      "solution": "In my experience, we have always defined a separate utility to load a connection pool at the app startup and then reused those connections.\nIn the above approach, you seem to be creating a new connection for every HTTP request that is made and then not terminating (or) closing the connection. This may be expensive for a large app.\ndb.util.js\n`const { MongoClient } = require(\"mongodb\");\n\nconst uri = `mongodb://${process.env.DB_USER}:${process.env.DB_PASSWORD}@localhost:27017/${process.env.DATABASE}?maxPoolSize=2-&w=majority`;\n\nconst client = new MongoClient(uri);\n\nconst init = async () => {\n  try {\n    await client.connect();\n    console.log(\"Connected\");\n  } catch (error) {\n    console.log(error);\n  }\n};\n\nconst getClient = () => {\n  return client;\n};\n\nmodule.exports.init = init;\nmodule.exports.getClient = getClient;\n`\napp.js\n`//Import modules\nrequire(\"dotenv\").config({ path: __dirname + \"/.env\" });\nconst express = require(\"express\");\nconst dogRoutes = require(\"./routes/dog.routes\");\nconst db = require(\"./utils/db.util\");\n\n// Define PORT for HTTP Server\nconst PORT = 9900;\n\n// Initialize Express\nconst app = express();\n\napp.use(express.json());\napp.use(dogRoutes);\n\n(async () => {\n  await db.init();\n\n  app.listen(PORT, (err) => {\n    console.log(`Server is up at localhost ${PORT}`);\n  });\n})();\n`",
      "question_score": 6,
      "answer_score": 5,
      "created_at": "2022-04-17T09:00:56",
      "url": "https://stackoverflow.com/questions/71899948/express-and-mongodb-without-mongoose"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 70486412,
      "title": "How convert Express.Multer.File to Blob data?",
      "problem": "I have a NestJs project in my controller I accept an Express.Multer.File but I need to send it to another server. How can I convert it to Blob for passing to FormData?\n`#action in my controller\n\n    @Post('/upload')\n    @UseInterceptors(FileInterceptor('avatar'))\n    async uploadUserProfileAvatar(@UploadedFile() file: Express.Multer.File){\n        \n        console.log(file)\n        let blob = new Blob(file.mimetype)\n        let formData = new FormData()\n        //can't set because file is not Blob\n        formData.append('file',file)\n\n        let request$ = this.httpService.post('http://test_server/file',formData,{headers:{\n            'Content-Type':'multipart/form-data'\n        }}).pipe(\n            map(response => response.data)\n        )\n\n        request$.subscribe( response => {\n            console.log(response)\n            return response\n        })\n    }\n`\nI will be grateful for every answer!\nEDIT:\nThanks again for your help! As a result, I managed to successfully send the code in this way:\n```\n`    @Post('/upload')\n    @UseInterceptors(FileInterceptor('avatar'))\n    async uploadUserProfileAvatar(@UploadedFile() file: Express.Multer.File){\n\n        const FormData = require('form-data');\n        const formData = new FormData();\n        formData.append('file', Buffer.from(file.buffer) , file.originalname);\n\n        let request$ = this.httpService.post('http://nginx_files/file',formData,{headers:formData.getHeaders()}).pipe(\n                map(response => response.data)\n            )\n\n        request$.subscribe( response => {\n            console.log(response)\n            return response\n        })\n    }\n`\n```",
      "solution": "Use `formdata` package like this:\n`  const FormData = require('form-data');\n\n  const formData = new FormData();\n  formData.append('file', fileContent, 'file_name.ext');\n\n  let request$ = this.httpService.post('http://test_server/file',\n    formData,\n    { headers: formData.getHeaders() }\n  ).pipe(\n            map(response => response.data)\n        )\n`",
      "question_score": 6,
      "answer_score": 3,
      "created_at": "2021-12-26T13:24:56",
      "url": "https://stackoverflow.com/questions/70486412/how-convert-express-multer-file-to-blob-data"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 70440506,
      "title": "Why do we have to put api in front of routes?",
      "problem": "I am learning express and the http methods, but I cannot find any documentation on it. Is /api/value just for the json data, like an address just for that data? Just any extra info on it would be appreciated. Like what exactly does it do and if there is any documentation from express about it. Or is this a global term used in urls throughout frameworks and the internet?\nFor example:\n`app.get('/api/jackets'(req, res) => {res.send('logic')})`\nWhy do we need to add the api before jackets and what does it do?",
      "solution": "The `/api` request is not required, but putting a prefix in front of the API requests such as:\n```\n`/api\n`\n```\nor, in some cases including a version number:\n```\n`/api/v1\n`\n```\nAllows you to use the same web server for more than one type of request because the `/api` prefix uniquely identifies each API request as an API request and it can easily be routed to where you handle API requests.  You could have plain web page requests from a browser served by the same web server.  While, you don't have to use such a prefix, using it gives you the most flexibility in how you deploy and use your server.\nSimilarly, putting the version in the prefix such as `/api/v1` allows you to evolve your API in the future in a non-backward-compatible way by adding a new version designation without breaking prior API clients (you support both versions at the same time - at least for a transition period).",
      "question_score": 6,
      "answer_score": 3,
      "created_at": "2021-12-21T20:12:04",
      "url": "https://stackoverflow.com/questions/70440506/why-do-we-have-to-put-api-in-front-of-routes"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 69708531,
      "title": "Cannot connect to a dockerized Express.js app from another docker container",
      "problem": "I have two containers App and Webserver. Webserver is plain nginx:alpine image and App is expressjs app running on port 3030 under ubuntu:focal. I heard that this is a common practise to use  separate containers for application and server. So I added `proxy_pass http://app:3030/;` to nginx config. Something went wrong and I digged into this a bit. To exclude incorrect nginx setup I checked raw curl requests from webserver to app container with no luck. Here is my docker-compose:\n```\n`version: '3.5'\nservices:\n\n  webserver:\n    image: nginx:alpine\n    env_file: .env\n    restart: always\n    tty: true\n    ports:\n      - ${NGINX_HOST_HTTP_PORT}:80\n      - ${NGINX_HOST_HTTPS_PORT}:443\n    volumes:\n      - ${APP_CODE_PATH_HOST}:${APP_DIR}\n      - ./nginx/nginx.conf:/etc/nginx/nginx.conf\n      - ./nginx/sites/:/etc/nginx/conf.d/\n      - ./nginx/ssl/:/etc/ssl/\n    depends_on:\n      - app\n    container_name: ${CONTAINER_NAME_PREFIX}-webserver\n    networks:\n      - app-network\n\n  app:\n    env_file: .env\n    restart: on-failure\n    tty: true\n    build:\n      dockerfile: ./docker/app/Dockerfile\n      args:\n        APP_ENV: ${APP_ENV}\n        APP_DIR: ${APP_DIR}\n        PRODUCT_ID: ${PRODUCT_ID}\n      context: ../\n    environment:\n      - DEBIAN_FRONTEND=noninteractive\n    container_name: ${CONTAINER_NAME_PREFIX}-app\n    networks:\n      - app-network\n\nnetworks:\n  app-network:\n    driver: bridge\n`\n```\nI can request express from App container CLI:\n```\n`/ # curl -X GET http://127.0.0.1:3030/multichannel/4034?uid=a6O5iTje8sR2PESbWpAM\n{\"status\": \"OK\"}\n`\n```\nAnd now from Webserver:\n```\n`/ # ping app\nPING app (172.19.0.2): 56 data bytes\n64 bytes from 172.19.0.2: seq=0 ttl=64 time=0.090 ms\n/ # curl -X GET http://172.19.0.2:3030/multichannel/4034?uid=a6O5iTje8sR2PESbWpAM\ncurl: (7) Failed to connect to 172.19.0.2 port 3030 after 0 ms: Connection refused\n/ # curl -X GET http://app:3030/multichannel/4034?uid=a6O5iTje8sR2PESbWpAM\ncurl: (7) Failed to connect to app port 3030 after 0 ms: Connection refused\n`\n```\nNginx log (don't pay attention on IP it is correct, after containers were rebuilt it changed):\n```\n`2021/10/29 15:40:46 [error] 24#24: *12 connect() failed (111: Connection refused) while connecting to upstream, client: 172.20.0.1, server: api.test, request: \"GET /multichannel/4034?uid=a6O5iTje8sR2PESbWpAM HTTP/1.1\", upstream: \"http://172.20.0.3:3030/multichannel/4034?uid=a6O5iTje8sR2PESbWpAM\", host: \"api.test\"\n`\n```\nOf course Nginx conf has:\n```\n`    location / {\n        proxy_pass http://app:3030;\n    }\n`\n```\nWhy was connection refused? Both containers are in the same network",
      "solution": "Finally I found the reason why I can't get connected. When @devatherock mentioned `ARTIFACTORY_URL=http://localhost:8081` I checked app code on what host is used and found this:\n```\n`server.listen(3030, \"127.0.0.1\", () => {\n  logger.debug(`Server is running on ${serverConfig.port} port`);\n});\n`\n```\nThen I tried \"localhost\" as host and still got 502. So it is a time to read the docs. Expressjs `server.listen` works like nodejs `server.listen` https://nodejs.org/api/net.html#serverlistenport-host-backlog-callback\n\nIf host is omitted, the server will accept connections on the unspecified IPv6 address (::) when IPv6 is available, or the unspecified IPv4 address (0.0.0.0) otherwise.\nIn most operating systems, listening to the unspecified IPv6 address (::) may cause the net.Server to also listen on the unspecified IPv4 address (0.0.0.0).\n\nAnd the answer is to use '0.0.0.0' or just omit host parameter. 127.0.0.1 or localhost accessible only on the local machine because is bounded to the loopback interface.",
      "question_score": 6,
      "answer_score": 2,
      "created_at": "2021-10-25T15:00:27",
      "url": "https://stackoverflow.com/questions/69708531/cannot-connect-to-a-dockerized-express-js-app-from-another-docker-container"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 67613185,
      "title": "How to authentication React Front End with back-end Node.js Express-Sessions?",
      "problem": "I'm moving away from using firestore auth to understand how to make my own authentication system.\nMy goal:\n\nCreate a react web app that lets user sign up and sign in .\nAuthenticated users can operate on restAPI, which is NodeJS hooked up to Postgres.\n\nI've watched a lot of tutorials. Most of them talk about express-sessions as as solution. However, when i tried it - these session cookie are only provided when my browser is on the express uri.\nThe issue is...\nOn the front-end, when I send CRUD operation via fetch to my express api, my react-app do not get that cookie.\nis what I'm doing the conventional way to handle authentication with backend server? How can i fix this?\nEXPRESS:\n`\nrequire(\"dotenv\").config();\nconst express = require(\"express\");\nconst db = require(\"./db\");\nvar session = require(\"express-session\");\nvar pgSession = require(\"connect-pg-simple\")(session);\n\nconst app = express(); //create an instance;\n// :id url param.\napp.use(\n    session({\n      store: new pgSession({ pool: db.pool }),\n      secret: \"secret\",\n      resave: false,\n      saveUninitialized: false,\n      cookie: { maxAge: 303 * 24 * 60 * 60 * 1000 }, //30days\n    })\n  );\n\napp.use(function (req, res, next) {\n  res.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n  res.setHeader(\n    \"Access-Control-Allow-Methods\",\n    \"GET, POST, OPTIONS, PUT, PATCH, DELETE\"\n  );\n  res.setHeader(\n    \"Access-Control-Allow-Headers\",\n    \"Access-Control-Allow-Headers, Origin,Accept, X-Requested-With, Content-Type, Access-Control-Request-Method, Access-Control-Request-Headers,X-Access-Token,XKey,Authorization\"\n  );\n  next();\n});\n\napp.use(express.json());\n\napp.post(\"/addUser\", async (req, res) => {\n  try {\n    const results = await db.query(\n      \"INSERT INTO USERS (email, password) values ($1, $2) returning *\",\n      [req.body.email, req.body.password]\n    );\n    console.log(results);\n    req.session.isAuth = true;\n    res.status(201).json({\n      status: \"success\",\n      data: {\n        user: results.rows,\n      },\n    });\n\n  } catch (err) {\n    console.log(err);\n  }\n});\n\n`\nReactJS\n```\n`\nimport React, { useEffect, useState } from \"react\";\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  Link,\n  Redirect,\n} from \"react-router-dom\";\nconst App = () => {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [authenticated, setAuthenticated] = useState(false);\n  const onSubmit = (e) => {\n    e.preventDefault();\n    fetch(\"http://localhost:3006/addUser\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ email: email, password: password }),\n    })\n      .then(function (response) {\n        return response.json();\n      })\n      .then((response) => {\n        console.log(response);\n        setAuthenticated(true);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  };\n\n  return (\n    \n      \n        \n          \n             onSubmit(e)}>\n              email\n               setEmail(e.target.value)}\n              >\n              password\n               setPassword(e.target.value)}\n              >\n              \n            \n          \n          {authenticated ?  : null}\n        \n        \n          Authenticated\n        \n      \n    \n  );\n};\n\nexport default App;\n\n`\n```\nin React - after submitting the form, cookies didnt show up in the devtools.",
      "solution": "In Server\n\nPlease enable cors(install cors library).\n\n```\n`app.use(\n  cors({\n    origin: true,\n    credentials: true,\n    optionsSuccessStatus: 200\n}))\n`\n```\n\nAdd session configuration.\n\n```\n`app.use(\n  session({\n    key: 'sid',\n    secret: Secret_String,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      path: '/',\n      sameSite: 'none',\n      httpOnly: true,\n      secure: false,\n      maxAge: 1000000000, // ten seconds, for testing\n    },\n    store: store, // postgres session store\n  }),\n);\n`\n```\n\nIn Client,\nYou have to use `withcredentials` option when calling API.\n\nChrome disabled set-cookie for different origin from 85.0 version. So, the set-cookie wont be work. You have to disable secure option in chrome.\nPlease go to chrome://flags -> Cookies without SameSite must be secure -> disabled\n\nIn your code\n\n```\n`fetch(\"http://localhost:3006/addUser\", {\n      method: \"POST\",\n      credentials: 'include',\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ email: email, password: password }),\n})\n`\n```",
      "question_score": 6,
      "answer_score": 5,
      "created_at": "2021-05-20T04:32:13",
      "url": "https://stackoverflow.com/questions/67613185/how-to-authentication-react-front-end-with-back-end-node-js-express-sessions"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 66916839,
      "title": "How to forward a node request using axios?",
      "problem": "In my express.js server I am doing this to forward a request to another server\n```\n`async handleRequest(req, res) {\n    const serverUrl = \"http://localhost:4000\"\n\n    await req.pipe(request({ url: serverUrl + req.url })).pipe(res);\n}\n`\n```\nThis is working as expected.\nBut I have decided to use `axios` or `got` library instead of request since request is no longer maintained.\nBut something like this is not working -\n```\n`req.pipe(axios({url: serverUrl + req.url})).pipe(res);\n`\n```\nI am getting error\n```\n`(node:88124) UnhandledPromiseRejectionWarning: TypeError: dest.on is not a function\n    at IncomingMessage.Readable.pipe (internal/streams/readable.js:671:8)\n`\n```\nHow can I fix this? I want to forward the request as it is without making any changes in the request object.",
      "solution": "You need to use `responseType` parameter with value `stream` so axios give you the option to pipe your response data as a stream by:\n```\n`axiosResponse.data.pipe(destination); // where destination can be a file or another stream\n`\n```\nAlso, in fact there is no need to do `await req.pipe` because axios will stream the response into your express response (res) object\nhence is the full answer:\n```\n`  const axiosResponse = await axios({\n    url: serverUrl + req.url,\n    responseType: 'stream'\n  })\n\n  axiosResponse.data.pipe(res)\n`\n```",
      "question_score": 6,
      "answer_score": 6,
      "created_at": "2021-04-02T10:54:53",
      "url": "https://stackoverflow.com/questions/66916839/how-to-forward-a-node-request-using-axios"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 66549420,
      "title": "Retrieve customer ID in stripe during checkout",
      "problem": "I have a Stripe checkout and I want to retrieve the customer ID if it'a success. I followed the Stripe tutorial but it doesn't work for me (The checkout works well but I can't retrieve the customer ID to add it to my User database)\nMy code:\n```\n`router.post(\"/create-checkout-session\", ensureAuthenticated, async (req, res) => {\n    const { priceId } = req.body;\n\n    // See https://stripe.com/docs/api/checkout/sessions/create\n    // for additional parameters to pass.\n    try {\n      const session = await stripe.checkout.sessions.create({\n        mode: \"subscription\",\n        payment_method_types: [\"card\"],\n        line_items: [\n          {\n            price: priceId,\n            // For metered billing, do not pass quantity\n            quantity: 1,\n          },\n        ],\n        // {CHECKOUT_SESSION_ID} is a string literal; do not change it!\n        // the actual Session ID is returned in the query parameter when your customer\n        // is redirected to the success page.\n        success_url: 'http://localhost:3000/fr/premiereconnexion?session_id={CHECKOUT_SESSION_ID}',\n        cancel_url: 'https://localhost:3000/fr/erreursouscription',\n      });\n    \n      res.send({\n        sessionId: session.id,\n        customerID: session.customer\n      });\n    }\n    catch (e) {\n    res.status(400);\n    return res.send({\n      error: {\n        message: e.message,\n      }\n    });\n  }\n  }\n});\n`\n```",
      "solution": "How are you retrieving the Customer ID?\nYou should process the `success_url` by extracting the query params and retrieving `session_id` through an API call to Stripe to obtain the `customer`: https://stripe.com/docs/api/checkout/sessions/retrieve. So you should have a `get(...)` route for the `success_url` route.\nAlternatively, listen to the `checkout.session.completed` webhook event.",
      "question_score": 6,
      "answer_score": 5,
      "created_at": "2021-03-09T16:04:32",
      "url": "https://stackoverflow.com/questions/66549420/retrieve-customer-id-in-stripe-during-checkout"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 65533644,
      "title": "how to extend Request type in Express with custom property",
      "problem": "I am trying to set up a custom middleware function in Node.js with typescript, where I want to store a decoded json web token into a custom request property 'user' like this\n```\n`  function auth(req: Request, res: Response, next: NextFunction) {\n\n     const decodedToken = jwt.verify(token, config.get(\"secret\"));\n\n     req.user = decodedToken.user; \n     next();\n  }\n`\n```\nbut I keep getting a compiler error in the terminal\n\nerror TS2339: Property 'user' does not exist on type 'Request'.\n\nI found several answers on here that suggested creating a custom.d.ts file and extend the Request type which I did like this:\n```\n`namespace Express {\n  interface Request {\n    user?: string;\n  }\n}\n`\n```\nnow, the VS Code is happy, I get no linting, I get the correct intellisense and autocompletion and it does not let me assign a number, because it understands it needs to be a string. So it obviously works. However, when I run the code the terminal keeps giving me the same error and insists that property 'user' does not exist.\nI tried restarting the TS server but that did not help.\nI can make it work by creating a custom interface which extends the Request type and then using that, but I really want to know how to do it with the original Request type.",
      "solution": "I managed to make it work after a lot of googling and playing with folder structure and tsconfig.json file. I put the `custom.d.ts` file in `./@types/express` (the sub-folder has to be there) and set the typeRoots in tsconfig.json like this:\n```\n`compilerOptions: {\n  \"typeRoots\": [\"./@types\"],\n}\n`\n```\nI also had to declare the namespace in custom.d.ts\n```\n`declare namespace Express {\n  interface Request {\n    user: any;\n  }\n}\n`\n```\nNow it compiles without error",
      "question_score": 6,
      "answer_score": 2,
      "created_at": "2021-01-01T21:57:50",
      "url": "https://stackoverflow.com/questions/65533644/how-to-extend-request-type-in-express-with-custom-property"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 74700663,
      "title": "What is the reason behind error h14 &quot;No web processes running&quot; and Application error?",
      "problem": "I made this project and deployed it on Heroku successfully and it was working, I checked it again two months and it was working properly, but today when I tried to open the website link it says Application error.\nLogs are as follows:\n```\n`2022-12-06T08:17:30.897980+00:00 heroku[router]: at=error code=H14 desc=\"No web processes running\" method=GET path=\"/\" host=limitless-shelf-83830.herokuapp.com request_id=d0c862ec-c21d-4e94-94e5-f6fed3d71af6 fwd=\"103.141.116.193\" dyno= connect= service= status=503 bytes= protocol=https\n2022-12-06T08:17:31.345120+00:00 heroku[router]: at=error code=H14 desc=\"No web processes running\" method=GET path=\"/favicon.ico\" host=limitless-shelf-83830.herokuapp.com request_id=a98c5850-0aa3-413d-94d9-4480a218ec3d fwd=\"103.141.116.193\" dyno= connect= service= status=503 bytes= protocol=https\n`\n```\nIs this issue from my side or heroku servers are down? What is the cause of this error and what are possible solutions?\nI tried running\n```\n`heroku ps:scale web=1\n`\n```\nbut it had no use.\nEdit: I found the issue, Heroku has stopped offering free plans from 28th Nov 2022, and I deployed it free server.",
      "solution": "As you mentioned, Heroku no longer provides free dyno plans.\nAlthough if you have previously deployed apps, you can still access them after subscribing to one of their plans. If you are still experiencing an H14 error, try to reconfigure your dyno. Just change your dyno type to the subscribed plan and make sure you have toggle the selected dyno to the right in order to enable it.",
      "question_score": 6,
      "answer_score": 2,
      "created_at": "2022-12-06T11:08:21",
      "url": "https://stackoverflow.com/questions/74700663/what-is-the-reason-behind-error-h14-no-web-processes-running-and-application-e"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 69861340,
      "title": "Getting &quot;Cannot use import statement outside a module&quot; even if I have &#39;&quot;type&quot;: &quot;module&quot;&#39; in package.json",
      "problem": "I have a simple express backend which I want to test. The backend just returns a messages array when hit `/messages` with a GET.\nNote: I understand there could be a simple fix, because I am relatively new to node.js world and have worked mostly in Python environment before. So, please, provide answer with explanation.\nHere is my `package.json`:\n```\n`{\n  \"name\": \"backend\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"type\": \"module\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"dev\": \"nodemon server.js\",\n    \"test\": \"jest\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"dependencies\": {\n    \"cors\": \"^2.8.5\",\n    \"express\": \"^4.17.1\"\n  },\n  \"devDependencies\": {\n    \"jest\": \"^27.3.1\",\n    \"supertest\": \"^6.1.6\"\n  }\n}\n`\n```\nThings to note:\n\n`\"type\": \"module\"`.\nI'm using jest and supertest for testing my express enabled backend.\n\nLet's see what my `server.js` looks like:\n```\n`import app from './app.js'\n\nconst port = 3000\n\napp.listen(port, () => console.log('app running'))\n\n`\n```\nFor the purpose of testing, in server.js I only have code to start the server. All the important code is in `app.js`.\n```\n`import express from 'express'\nimport cors from 'cors'\nconst app = express()\n\napp.use(cors())\napp.use(express.json())\napp.use(express.urlencoded({ extended: true }))\n\nconst messages = ['hello', 'hi', 'its working']\n\napp.get('/messages', (req, res) => {\n  res.send(messages)\n})\n\nexport default app\n`\n```\nThings to note:\n\n`export default app`\n\nBefore I proceed to show you my server.test.js, let's see my directory structure.\n```\n`\u251c\u2500\u2500 app.js\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 package-lock.json\n\u251c\u2500\u2500 server.js\n\u2514\u2500\u2500 tests\n    \u2514\u2500\u2500 server.test.js\n\n1 directory, 5 files\n`\n```\nNow, here is my `server.test.js`:\n```\n`import app from '../app'\nimport supertest from 'supertest'\nconst requestWithSupertest = supertest(app);\n\ndescribe('Messages Endpoints', () => {\n\n  it('GET /messages should show all messages', async () => {\n    const res = await requestWithSupertest.get('/messages');\n    expect(res.status).toEqual(200);\n    expect(res.type).toEqual(expect.stringContaining('json'));\n    expect(res.body).toHaveProperty('messages')\n  });\n\n});\n\n`\n```\nThing to note: `import app from '../app'`. I am importing app from the file called app.js which is one directory above in the tree as shown in above `tree` output.\nNow that I have everything set up, when I go ahead with invoking the test. I get an error thrown by jest runner. I have removed some output to just show the main error:\n```\n` FAIL  tests/server.test.js\n  \u25cf Test suite failed to run\n\n    Jest encountered an unexpected token\n\n    [output trimmed...]\n\n    Details:\n\n    /efs/repos/vueandauth/backend/tests/server.test.js:1\n    ({\"Object.\":function(module,exports,require,__dirname,__filename,jest){import app from '../app';\n                                                                                      ^^^^^^\n\n    SyntaxError: Cannot use import statement outside a module\n\n      at Runtime.createScriptFromCode (node_modules/jest-runtime/build/index.js:1728:14)\n      at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:333:13)\n\nTest Suites: 1 failed, 1 total\nTests:       0 total\nSnapshots:   0 total\nTime:        1.149 s\nRan all test suites.\n`\n```\nI have searched other question on Stackoverflow, some of them suggest doing a `\"type\": \"module\"` in package.json. Which I have already done. Why am I getting this error and how do I fix this?",
      "solution": "For jest support on ECMAScript modules, you can take a look at this GitHub Issue\n\nIn order to transpile the imports you can use Babel (jest docs).\nInstall babel:\n```\n`yarn add --dev babel-jest @babel/core @babel/preset-env\n`\n```\nadd babel configuration by creating `babel.config.js` or `.babelrc`\n```\n`module.exports = {\n  presets: [['@babel/preset-env', {targets: {node: 'current'}}]],\n};\n`\n```\nworking example on GitHub",
      "question_score": 6,
      "answer_score": 2,
      "created_at": "2021-11-06T04:54:42",
      "url": "https://stackoverflow.com/questions/69861340/getting-cannot-use-import-statement-outside-a-module-even-if-i-have-type"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 67237523,
      "title": "OAuth2 flow in full-stack NestJS application",
      "problem": "Yet another OAuth2 question that isn't quite covered elsewhere.\nI'm using NestJS backend, React frontend, Passport and my own DB for authentication. Trying to add an\nOAuth2 identity provider (Google).\nI configured my NestJS app as an OAuth Client. After logging in I'm receiving the callback at which point I have an `access_token` and the requested user details extracted from the payload of the `id_token`. This is encapsulated in a class extending `PassportStrategy(Strategy, 'google')` and an `AuthGuard('google')` and much of it is handled automatically. Code here.\nAt this point however, I need to maintain an authenticated session between backend (NestJS) and frontend (React). I suppose I need a JWT, but I'm wondering about the best approach:\n\nCan I use a token provided by the IdP (e.g. `id_token` or `access_token`)? So that I don't have to worry about issuing tokens myself. I.e. the frontend receives the token (either from backend, or the IdP directly), sends it on every request, backend verifies it with the IdP on every request (`verifyIdToken` or `getTokenInfo` of `google-auth-library`).\n\nOne drawback here is the extra network request every time. I'm not sure if there's a need for that because the IdP is only used to identify the user, not for access to other resources. Another drawback is that I need to store a refresh token and handle when the token expires (get new one, update it on the frontend).\n\nSo alternatively, could I just issue a JWT myself and not worry about checking in with the IdP? Once the JWT expires I'd need to prompt the user to log in again. In this case, I wouldn't need to store the IdP tokens. But is this good practice? One issue I can think of is that I won't detect if the user revokes access in the IdP (until the JWT expires).",
      "solution": "I ended up issuing my own JWT tokens and managing User sessions in my app, as described in this article: OAuth2 in NestJS for Social Login (Google, Facebook, Twitter, etc)",
      "question_score": 6,
      "answer_score": 2,
      "created_at": "2021-04-24T00:29:39",
      "url": "https://stackoverflow.com/questions/67237523/oauth2-flow-in-full-stack-nestjs-application"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 66381191,
      "title": "What is the correct way to send ArrayBuffer or Blob across and reconstruct them?",
      "problem": "I've read through a dozen posts on how to convert between `ArrayBuffer` to `Blob` or to `Uint8Array` etc. before sending the data to the client side... but I can't seem to be able to get it to work at all. When I do get the data through, I was not able to reconstruct them back as a `Blob` before outputting it to a file..\n```\n`const Blob = require('cross-blob');\nconst randomBytes = require('randombytes');\n\nconst buffer = randomBytes(1024); // Supposed to give me Buffer\n`\n```\nThe followings were the stuff I tried...\n```\n`data = buffer;\n`\n```\n^ gives me ``\n```\n`data = Uint8Array.from(buffer); \n`\n```\n^ gives me an array of integer, this looked the most promising? but when arrived to the client side, it became an object with indexes and byte value...\n```\n`data = Uint8Array.from(buffer).buffer;\n`\n```\n^ gives `ArrayBuffer { byteLength: 1024}`, when inspect it shows `size: 2` and `type: 'text/plain'`...\n```\n`data = new Blob(buffer, { type: 'application/octet-stream' });\ndata = new Blob([new Uint8Array(buffer, buffer.byteOffset, buffer.length)], { type: 'application/octet-stream' });\ndata = new Blob([Uint8Array.from(buffer)], { type: 'application/octet-stream' });\n`\n```\n^ all these, when arrived to the client side also with `size: 2` and `type: 'text/plain'`...\nOn the server side, I am running Express:\n```\n`router.get('/test/*', function(req, res, next) {\n  ...\n  let data = myFunctionThatGeneratesData();\n  res.send(data);\n});\n`\n```\nOn the client side, I'm requesting it like this (Angular/TypeScript):\n```\n`this.http.get('/test/random-bytes-array', {\n  responseType: 'blob'  // also tried 'arraybuffer'\n}).subscribe(data => {\n  debugger;\n  console.log(data);\n});\n`\n```\nI must be doing something wrong... I am trying to send multiple chunk of binary data over, either as an `ArrayBuffer`, `Uint8Array` or `Blob` (whatever works) and when arriving at the other end, combine them back into a `Blob`.",
      "solution": "In Node.js, `crypto.randomBytes` returns a `Buffer`. This is the correct type to use for sending raw data to the client.\nWhen using Express, it is important to set the correct content-type of the response using `res.type()`. However, when sending a `Buffer`, if the content-type header is not set in any other middleware, then express will use `application/octet-stream` by default.\n\nWhen the parameter is a Buffer object, the method sets the Content-Type response header field to \"application/octet-stream\", unless previously defined.\n\n`router.get('/test/*', function(req, res, next) {\n  ...\n  let data = myFunctionThatGeneratesData();\n  res.type('application/octet-stream').send(data);\n  // ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ might not be necessary\n});\n`\nAnd lastly in Angular, using the `responseType: 'blob'` is correct:\n`this.http.get('/test/random-bytes-array', {\n  responseType: 'blob'\n}).subscribe(data => {\n  console.log(data);\n});\n`",
      "question_score": 6,
      "answer_score": 2,
      "created_at": "2021-02-26T07:39:27",
      "url": "https://stackoverflow.com/questions/66381191/what-is-the-correct-way-to-send-arraybuffer-or-blob-across-and-reconstruct-them"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 66281738,
      "title": "Dockerized Node JS project getting: &quot;command failed signal SIGTERM&quot; error",
      "problem": "I had a express application and I used this application in my Kubernetes cluster.\nThis application is auth service for my micro service architecture study.\nI use Skaffold dev command for applying Kubernetes for this app.\nMy Dockerfile is like that:\n```\n`FROM node:alpine\n\nWORKDIR /app\nCOPY package.json .\nRUN npm install\n\nCOPY . .\n\nCMD [\"npm\", \"start\"]\n`\n```\nAnd I run it with \"Scaffold dev\" command\nAnd I getting error like that:\n```\n`...\n...    \nDeployments stabilized in 3.752 seconds\nWatching for changes...\n[auth] npm notice \n[auth] npm notice New patch version of npm available! 7.5.1 -> 7.5.4\n[auth] npm notice Changelog: \n[auth] npm notice Run `npm install -g npm@7.5.4` to update!\n[auth] npm notice \n[auth] npm ERR! path /app\n[auth] npm ERR! command failed\n[auth] npm ERR! signal SIGTERM\n[auth] npm ERR! command sh -c node server.js\n[auth] \n[auth] npm ERR! A complete log of this run can be found in:\n[auth] npm ERR!     /root/.npm/_logs/2021-02-19T16_46_28_956Z-debug.log\n`\n```\nAnd my package.json file :\n```\n`    {\n  \"name\": \"authservice\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Auth Service\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\",\n    \"start\": \"node server.js\"\n  },\n  \"keywords\": [\n    \"auth\",\n    \"user\"\n  ],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"dependencies\": {\n    \"bcrypt\": \"^5.0.0\",\n    \"body-parser\": \"^1.19.0\",\n    \"dotenv\": \"^8.2.0\",\n    \"express\": \"^4.17.1\",\n    \"express-rate-limit\": \"^5.2.3\",\n    \"jsonwebtoken\": \"^8.5.1\",\n    \"mongoose\": \"5.10.19\",\n    \"morgan\": \"^1.10.0\",\n    \"multer\": \"^1.4.2\"\n  },\n  \"devDependencies\": {\n    \"nodemon\": \"^2.0.6\"\n  }\n}\n`\n```\nHow can I solve this error?",
      "solution": "I assume you're either incorrectly specifying your script in the `package.json` or your script is not `server.js`.\nA minimal repro of your question works:\nUsing the Node.JS Getting Started guide's example with one minor tweak:\nhttps://nodejs.org/en/docs/guides/getting-started-guide/\n\nNOTE Change `const hostname = '127.0.0.1';` to `const hostname = '0.0.0.0';` This is necessary to access the containerized app from the host.\n\nAdding a package.json because you have one and to show `npm start`:\n`package.json`:\n```\n`{\n    \"name\": \"66281738\",\n    \"version\": \"0.0.1\",\n    \"scripts\": {\n        \"start\": \"node app.js\"\n    }\n}\n`\n```\n\nNOTE I believe `npm start` defaults to `\"start\": \"node server.js\"`\n\nUsing your `Dockerfile` and:\n`QUESTION=\"66281738\"\ndocker build --tag=${QUESTION} --file=./Dockerfile .\ndocker run --interactive --tty --publish=7777:3000 ${QUESTION}\n`\nYields:\n```\n`> 66281738@0.0.1 start\n> node app.js\n\nServer running at http://0.0.0.0:3000/\n`\n```\n\nNOTE `docker run` binds the container's `:3000` port to the host's `:7777` just to show these need not be the same.\n\nThen:\n`curl --request GET http://localhost:3000/\n`\nYields:\n```\n`Hello World\n`\n```",
      "question_score": 6,
      "answer_score": 2,
      "created_at": "2021-02-19T17:50:20",
      "url": "https://stackoverflow.com/questions/66281738/dockerized-node-js-project-getting-command-failed-signal-sigterm-error"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 67739799,
      "title": "How to verify authentication token of multiple type of users for a single route (without code duplication) in Express with JWT?",
      "problem": "I have an express app where some routes are public(accessible to everyone on the internet) and some are protected. I use JWT for route authentication. I have different type of users in the system, for example: author, subscriber etc. Some of the routes are meant to be access authors and some by subscribers. But there are a few routes which can be accessed by both author and subscribers.\nTo make sure when a user request to protected routes, I use middleware function for each category of users to verify their authentication token.\nAn example route accessible to authors only like this bellow,\n```\n`router.get(\"/\", verifyToken.author(), async (req, res) => {\n    try {\n        // doing stuff\n    } catch (err) {\n        // doing stuff\n    }\n});\n`\n```\nAn example route accessible to subscribers only like this bellow,\n```\n`router.get(\"/\", verifyToken.subscriber(), async (req, res) => {\n    try {\n        // doing stuff\n    } catch (err) {\n        // doing stuff\n    }\n});\n`\n```\nPS: `verifyToken.author()` or any other middleware function I wrote for the purpose of verifying token are actually closure. Because sometimes I need to pass parameter in the functions. So, an example of these methods will be,\n```\n`module.exposts.author = () => {\n    return (req, res, next) => {\n        const token = req.header(\"Authorization\");\n        if (!token) return res.status(401).send({ message: \"Access Denied!\" });\n\n        try {\n            jwt.verify(token, process.env.AUTHOR_SECRET);\n\n            next();\n        } catch (err) {\n            res.status(401).send({ message: \"Access Denied!\" });\n            console.log(err);\n        }\n    };\n};\n`\n```\nAnd when I need to write a function for verifying token for both author and subscriber, I can just check do so and use the method as a middleware to the required route. But I am afraid it is not as simple as it sounds because in reality I don't have just these 2 type of users. And almost all the user types has complex route access where maybe 5 particular type of user can access the route.\nAs I was saying, let's say author and subscriber is among the 5 user types I said above. So writing a function for author+subscriber and writing another for 5 type of users where author, subscriber exists, it seems so much code duplication.\nI hope I am able to explain why I just don't want to write something like this bellow,\n```\n`module.exports.authorSubscriber = () => {\n    return (req, res, next) => {\n        const token = req.header(\"Authorization\");\n        if (!token) return res.status(401).send({ message: \"Access Denied!\" });\n\n        try {\n            jwt.verify(token, process.env.AUTHOR_SECRET);\n\n            next();\n        } catch (err) {\n            try {\n                jwt.verify(token, process.env.SUBSCRIBER_SECRET);\n    \n                next();\n            } catch (err) {\n                res.status(401).send({ message: \"Access Denied!\" });\n                console.log(err);\n            }\n        }\n    };\n};\n`\n```\nInstead, I want something like this, where I can re-use the function I wrote for author previously,\n```\n`module.exports.authorSubscriber = () => {\n    return (req, res, next) => {\n        const token = req.header(\"Authorization\");\n        if (!token) return res.status(401).send({ message: \"Access Denied!\" });\n\n        try {\n            jwt.verify(token, process.env.AUTHOR_SECRET);\n\n            next();\n        } catch (err) {\n            exports.author()\n        }\n    };\n};\n`\n```\nBut, `author()` won't work here. It works when called from a route because then it gets the `req, res, next`. But in this case, it is being called from another function and no req, res, next is passed. If I do `exports.author(req, res, next)` in `authorSubscriber` and define author to accept these parameters. it still doesn't work. I think route middleware gets the 'req, res, next` automatically, these things can't be passed manually, can they? This was the reason I made these functions closure because on a similar verifier I need to pass a certain token and middleware doesn't take extra parameters.\nI am confused. You may have clearly realized that I have knowledge gaps, that's why I am missing something here.\nPlease help.",
      "solution": "Assuming you are defining the \"author\" middleware in a closure, as in your examples above:\n```\n`module.exposts.author = () => {\n    return (req, res, next) => {\n        // implementation here\n    };\n};\n`\n```\nThen you can indeed re-use it in the \"author+subscriber\" scenario you've described. But keep in mind that your middleware defined above is NOT a function named `author`; rather, the middleware is an anonymous function that is returned from the function named `author`. So if you want to re-use it in `authorSubscriber`, it would look something like:\n```\n`module.exports.authorSubscriber = () => {\n    return (req, res, next) => {\n        // ...\n        try {\n            jwt.verify(token, process.env.AUTHOR_SECRET);\n\n            next();\n        } catch (err) {\n            exports.author()(req, res, next)\n        }\n    };\n};\n`\n```\nNote that you are calling `exports.author()` first, which will return a reference to the inner function that is the middleware you actually want to invoke.\nAs other comments have noted, there might be better patterns for this type of access control that you could move toward in the future, but if your goal is simply to re-use the middleware you've already defined in different contexts I think this seems workable.",
      "question_score": 6,
      "answer_score": 1,
      "created_at": "2021-05-28T15:29:25",
      "url": "https://stackoverflow.com/questions/67739799/how-to-verify-authentication-token-of-multiple-type-of-users-for-a-single-route"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 67326029,
      "title": "Using request(), returned page doesn&#39;t contain needed data yet \u2013 incomplete page is returned instead. How do I &#39;wait&#39;?",
      "problem": "I am trying to extract the year, make, model, colour and plate number from carjam.co.nz. An example of a URL I am scraping from is https://www.carjam.co.nz/car/?plate=JKY242.\nIf the plate has been recently requested, then the response will be a HTML document with the vehicle details.\n\nResult where the plate details have been recently requested.\nIf the plate details haven't been recently requested (as is the case with most plates) the response is a HTML document with \"Trying to get some vehicle data\".  I'm guessing that this page displays while the information is fetched from the database, then the page is reloaded to show the vehicle details. This appears to be rendered server-side, I can't see any AJAX requests.\nThe URL is the same for each result.\n\nResult where the vehicle hasn't been recently requested.\nHow do I 'wait' for the correct information?\nI am using `request` (deprecated I know, but it is what I am most comfortable using) on a Node.js with Express server.\nMy (very reduced) code:\n`app.get(\"/:numberPlate\", (req, res) => {\n  request(\"https://www.carjam.co.nz/car/?plate=\" + req.params.numberPlate, function(error, response, body) {\n    const $ = cheerio.load(body);\n    res.status(200).send(JSON.stringify({\n      year: $(\"[data-key=year_of_manufacture]\").next().html(),\n      make: toTitleCase($(\"[data-key=make]\").next().html()),\n      model: toTitleCase($(\"[data-key=model]\").next().html()),\n      colour: toTitleCase($(\"[data-key=main_colour]\").next().html()),\n  }));\n  }\n}\n`\nI have considered:\n\nMaking a request and discarding it, sleeping for 2 - 3 seconds, then making a second request. The advantage of this approach is that every request would work. Disadvantage is that every request takes 2 - 3 second (too slow).\nMaking a request and checking to see if the body contains \"Trying to get some vehicle data\". If so, sleep a few seconds, make another request and take action on the result of that second request (but how?).\n\nI'm sure this is a common problem with an easy answer, but I don't have enough experience to figure it out myself, or to know exactly what to Google!\n\nTo test: New Zealand has number places in the format \"ABC123\" \u2013 three letters, three numbers. These are released in alphabetical-ish order, currently we have nothing past NLU999 (excluding custom numberplates, numberplates issued out of sequence, etc).\nTo reproduce the \"Trying to get some vehicle data\", you need to find a new numberplate each time \u2013 most numberplates earlier in the sequence than NLU999 should work.\nThis code snippet should generate a valid numberplate.\n\r\n\r\n`console.log(Math.random().toString(36).replace(/[^a-n]+/g, '').substr(0, 1).toUpperCase() + Math.random().toString(36).replace(/[^a-z]+/g, '').substr(0, 2).toUpperCase() + Math.floor(Math.random() * 10).toString() + Math.floor(Math.random() * 10).toString() + Math.floor(Math.random() * 10).toString());`\r\n\r\n\r\n\n05 May 2021 update\nUpon further thought, this pseudocode could be what I'm after \u2013 but unsure how to practically implement.\n```\n`request(url) {\n  if (url body contains \"Trying to get some vehicle data\") {\n    wait(2 seconds)\n    request(url again) {\n      return second_result\n    }\n  } else {\n    return first_result\n  }\n}\nthen\n  process(first_result or second_result)\n`\n```\nMy difficulty here: I am used to the format `request().then()`, taking action directly from the request.\nAssuming this approach is correct, how would I conduct the following?\n\nSend the request, then\nAssess the response, then\nPass this response on, or send another request then pass that response on\nProcess response",
      "solution": "From this javascript file, the website loads the page every X seconds if the data is not found with a max retry set to 10. Also the refresh value in seconds is retrieved from the `Refresh` http header value.\nYou can reproduce this flow, so that you have exactly the same behaviour as the frontend code.\nIn the following example I'm using axios\n`const axios = require(\"axios\");\nconst cheerio = require(\"cheerio\");\n\nconst rootUrl = \"https://www.carjam.co.nz/car/\";\nconst plate = \"NLU975\";\nconst maxRetry = 10;\nconst waitingString = \"Waiting for a few more things\";\n\nasync function getResult() {\n  return axios.get(rootUrl, {\n    params: {\n      plate: plate,\n    },\n  });\n}\n\nasync function processRetry(result) {\n  const refreshSeconds = parseInt(result.headers[\"refresh\"]);\n  var retryCount = 0;\n  while (retryCount  {\n  var result = await getResult();\n  if (result.data.includes(waitingString)) {\n    result = await processRetry(result);\n  }\n  const $ = cheerio.load(result.data);\n  console.log({\n    year: $(\"[data-key=year_of_manufacture]\").next().html(),\n    make: $(\"[data-key=make]\").next().html(),\n    model: $(\"[data-key=model]\").next().html(),\n    colour: $(\"[data-key=main_colour]\").next().html(),\n  });\n})();\n\nfunction timeout(ms) {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n`\nrepl.it link: https://replit.com/@bertrandmartel/ScrapeCarJam\nSample output:\n```\n`retry: 0 time, waiting for 1 second(s)\nretry: 1 time, waiting for 1 second(s)\nretry: 2 time, waiting for 1 second(s)\n{ year: 'XXXX', make: 'XXXXXX', model: 'XX', colour: 'XXXX' }\n`\n```\nIt uses async/await instead of promise.\nNote that request is deprecated",
      "question_score": 6,
      "answer_score": 1,
      "created_at": "2021-04-30T00:51:25",
      "url": "https://stackoverflow.com/questions/67326029/using-request-returned-page-doesnt-contain-needed-data-yet-incomplete-page"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 67071827,
      "title": "How do I enable pop-up menus from materialise in React?",
      "problem": "I have a React app, I'm trying to add a NavBar there like this\n```\n`\n          Create lessons*/}\n                Lessons\n                Quizes\n                Create QuizGame\n                \n                \n        \n\n  \n    \n      Logo\n      \n        Home\n        Dropdownarrow_drop_down\n        Logout\n      \n    \n  \n`\n```\n\nI would like this thing to open and show the contents either when clicked or hovered over\nThe materialize css website describes the following code\n```\n`$(\".dropdown-trigger\").dropdown();\n`\n```\nBut I can't figure out where to insert it? Application on the MERN stack",
      "solution": "```\n`\n\n  one\n  two\n  \n  three\n\n  \n    Logo\n    \n      Sass\n      Components\n      \n      Dropdownarrow_drop_down\n    \n  \n\n`\n```",
      "question_score": 6,
      "answer_score": 1,
      "created_at": "2021-04-13T11:04:22",
      "url": "https://stackoverflow.com/questions/67071827/how-do-i-enable-pop-up-menus-from-materialise-in-react"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 67864559,
      "title": "Prisma.js: We found changes that cannot be executed",
      "problem": "I've used prisma.js as an ORM in my project.\nAfter executing the `npx prisma migrate dev --name rename_and_add_some_columns`,\nI got this error:\n\nWe found changes that cannot be executed\n\nError Details:\n\nStep 1 Added the required column `CategoryId` to the `Post` table\nwithout a default value. There are 2 rows in this table, it is not\npossible to execute this step.   \u2022 Step 1 Added the required column\n`ModifiedDate` to the `Post` table without a default value. There are\n2 rows in this table, it is not possible to execute this step.   \u2022\nStep 2 Added the required column `ModifiedDate` to the `Profile` table\nwithout a default value. There are 1 rows in this table, it is not\npossible to execute this step.   \u2022 Step 4 Added the required column\n`ModifiedDate` to the `User` table without a default value. There are\n2 rows in this table, it is not possible to execute this step.\nYou can use prisma migrate dev --create-only to create the migration\nfile, and manually modify it to address the underlying issue(s). Then\nrun prisma migrate dev to apply it and verify it works.\n\nHow can I solve it?\n// This is my Prisma schema file,\n```\n`datasource db {\n  provider = \"mysql\"\n  url      = env(\"DATABASE_URL\")\n}\n\ngenerator client {\n  provider = \"prisma-client-js\"\n}\n\nmodel Category {\n  Id           Int      @id @default(autoincrement())\n  CreatedDate  DateTime @default(now())\n  ModifiedDate DateTime @updatedAt\n  Title        String   @db.VarChar(50)\n  IsActive     Boolean\n  Posts        Post[]\n}\n\nmodel Post {\n  Id                 Int       @id @default(autoincrement())\n  CreatedDate        DateTime  @default(now())\n  ModifiedDate       DateTime  @updatedAt\n  Title              String    @db.VarChar(255)\n  Description        String?\n  IsPublished        Boolean   @default(false)\n  IsActive           Boolean   @default(true)\n  IsActiveNewComment Boolean   @default(true)\n  Author             User      @relation(fields: [AuthorId], references: [Id])\n  AuthorId           Int\n  Comment            Comment[]\n  Tag                Tag[]     @relation(\"TagToPost\", fields: [tagId], references: [Id])\n  tagId              Int?\n  Category           Category  @relation(fields: [CategoryId], references: [Id])\n  CategoryId         Int\n}\n\nmodel User {\n  Id           Int       @id @default(autoincrement())\n  CreatedDate  DateTime  @default(now())\n  ModifiedDate DateTime  @updatedAt\n  Email        String    @unique\n  Name         String?\n  Posts        Post[]\n  Profile      Profile?\n  Comments     Comment[]\n}\n\nmodel Profile {\n  Id           Int      @id @default(autoincrement())\n  CreatedDate  DateTime @default(now())\n  ModifiedDate DateTime @updatedAt\n  Bio          String?\n  User         User     @relation(fields: [UserId], references: [Id])\n  UserId       Int      @unique\n}\n\nmodel Comment {\n  Id           Int      @id @default(autoincrement())\n  CreatedDate  DateTime @default(now())\n  ModifiedDate DateTime @updatedAt\n  Comment      String\n  WrittenBy    User     @relation(fields: [WrittenById], references: [Id])\n  WrittenById  Int\n  Post         Post     @relation(fields: [PostId], references: [Id])\n  PostId       Int\n}\n\nmodel Tag {\n  Id           Int      @id @default(autoincrement())\n  CreatedDate  DateTime @default(now())\n  ModifiedDate DateTime @updatedAt\n  Title        String   @unique\n  Posts        Post[]   @relation(\"TagToPost\")\n}\n`\n```",
      "solution": "In order to run this migration, you need to:\n\nCreate the fields first as optional and then run `migrate`\n\nFill the fields first with the required date.\n\nRemove the optional (`?`) from the field.\n\nPrisma automatically adds `@updatedAt` (it's not done at the database level) so these steps need to be followed.",
      "question_score": 5,
      "answer_score": 17,
      "created_at": "2021-06-07T01:52:07",
      "url": "https://stackoverflow.com/questions/67864559/prisma-js-we-found-changes-that-cannot-be-executed"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 67496399,
      "title": "How to get the request body in morgan() middleware?",
      "problem": "I am learning how to work with middlewares and there is a task to post a JSON resource by using `morgan()` middleware. But when I write a code for posting something, I cannot get the body of the morgan.\n```\n`const express = require('express');\nconst morgan = require('morgan');\nconst app = express();\napp.use(morgan('tiny'));\n\nconst generateId = () => {\n    const randNum = Math.floor(Math.random() * 5000)\n    return randNum;\n}\n\nconst isExist = (arr, name) => {\n    const found = arr.find(arrItem => arrItem.name === name) ? true : false\n    return found;\n}\napp.post('/api/persons', (req, res) => {\n    const body = req.body\n    if (!body.name || !body.number) {\n        return res.status(400).json({\n            error: \"missing data\"\n        })\n    } else if (isExist(notes, body.name) === true) {\n        return res.status(400).json({\n            error: \"existed data\"\n        })\n    }\n    const note = {\n        id: generateId(),\n        name: body.name,\n        number: body.number\n    }\n    notes = notes.concat(note)\n\n    res.json(note)\n})\nconst PORT = 3001;\napp.listen(PORT, () => {\n    console.log(`Server is worling on ${PORT}`)\n})\n`\n```\nThen I found morgan-body and used it and it worked.\n```\n`// ...\nconst morganBody = require('morgan-body')\nconst bodyParser = require('body-parser')\n\napp.use(bodyParser.json())\nmorganBody(app)\n\napp.post('/api/persons', (req, res) => {\n    // the same code as the above\n}\n//...\n`\n```\nBut now, the task is to change the log in the console like \nI am a little bit uncomfortable with using 2 middlewares in 1 backend (don\u2019t know if that\u2019s ok). That\u2019s why I faced problems with the potential solutions for this situation:\n\nHow to get `morgan()`'s request body (both in the format of the log and in js code) in order to get rid of `morgan-body` and write my custom tokens?\nHow to write custom tokens (could not find any documentation about this) for `morgan-body` to get rid of `morgan()`?\n\nBecause I am a beginner it would be helpful to hear which option is more preferable and why is it. If any additional info would be needed or something is wrong with my question feel free to point it out.\nThank you in advance.",
      "solution": "First of all, you can have as much middleware as you want, and for large applications, they tend to have a lot of middleware.\nTo create a custom token for morgan, you can do something like:\n`morgan.token('body', req => {\n  return JSON.stringify(req.body)\n})\n\napp.use(morgan(':method :url :body'))\n`\nThis should works fine if `req.body` has been set, but by default it's not. You have to use body-parsing middleware to populate it.\nSo before you use morgan middleware you have to put some body parser:\n`app.use(express.json())\napp.use(morgan(':method :url :body'))\n`\nNote: `express.json` is a built-in middleware function in Express. See more here.",
      "question_score": 5,
      "answer_score": 20,
      "created_at": "2021-05-12T03:55:18",
      "url": "https://stackoverflow.com/questions/67496399/how-to-get-the-request-body-in-morgan-middleware"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 72224168,
      "title": "Why is my cookie not being saved on Safari but being saved on Chrome?",
      "problem": "So I am working on a project, the frontend is on Next.JS hosted on vercel, the backend is on Express.JS hosted on heroku.\nI am using express-session along with passport JS to store the sessions.\nOn the frontend I am using axios for the HTTP calls. The cookie for the session is being saved on Chrome, but on Safari it is not being saved. I have gone through multiple StackOverflow posts but none worked. Safari is receiving the cookie in the header but it is not saving the cookie\n\nHere is my cors configuration on express\n\nWhat can be the issue here?",
      "solution": "Alright, It turns out the reason for this happening is because Safari doesn't allow cross-domain cookies. So, the only true way to resolve this is by hosting the backend and frontend on different subdomains of the same domain.",
      "question_score": 5,
      "answer_score": 14,
      "created_at": "2022-05-13T05:32:30",
      "url": "https://stackoverflow.com/questions/72224168/why-is-my-cookie-not-being-saved-on-safari-but-being-saved-on-chrome"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 69794934,
      "title": "Set an authentication token in a request header when using supertest with jest and express",
      "problem": "I'm trying to test the routes in my `express` app that are protected by a jwt middleware. I've tried simulating a request to get the jwt token in a `beforeAll` call:\n`let token = \"\";\nbeforeAll((done) => {\n    supertest(app)\n        .get(\"/authentication/test\")\n        .end((err, response) => {\n            console.log(response.body); // \"fewiu3438y...\" (successfully got token) \n            token = response.body.token; // Tried to update token variable with jwt token\n            done();\n        });\n});\nconsole.log(token); // \"\" (I haven't updated the token variable) \n`\nSo when I try to run subsequent tests, I don't have a valid authentication token to use in the headers:\n`    describe(\"Simple post test using auth\", () => {\n        test.only(\"should respond with a 200 status code\", async () => {\n            console.log({ POSTTest:token }); // \"\" still not set, so test will fail.\n            const response = await supertest(app).post(\"/tests/simple\").send();\n            expect(response.statusCode).toBe(200);\n        });\n    });\n`\nIs there a way to update a variable, or else set all headers using a `beforeAll`? Or is there a better method I'm not aware of?",
      "solution": "Try to use an `async` function as a `beforeAll` callback:\n```\n`let token = '';\n\nbeforeAll(async () => {\n  const response = await supertest(app).get('/authentication/test');\n  token = response.body.token;\n});\n`\n```\nThen, use the `set`\u00a0method to pass the token in the test:\n```\n`describe('Simple post test using auth', () => {\n  test.only('should respond with a 200 status code', async () => {\n    const response = await supertest(app)\n      .post('/tests/simple')\n      .set('Authorization', `Bearer ${token}`);\n\n    expect(response.statusCode).toBe(200);\n  });\n});\n`\n```",
      "question_score": 5,
      "answer_score": 17,
      "created_at": "2021-11-01T10:25:26",
      "url": "https://stackoverflow.com/questions/69794934/set-an-authentication-token-in-a-request-header-when-using-supertest-with-jest-a"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 70159949,
      "title": "Webhook signature verification failed with express stripe",
      "problem": "I'm trying to test locally webhook stripe event, but it say :\nWebhook signature verification failed.\nSo this is my webhook endpoint :\n```\n`exports.stripeListenWebhook = (req, res) => {\n    let data\n    let eventType\n    const webhookSecret = 'whsec_VjORamXpVZs1j6mCV0eTyE7B2GI92'\n\n    if (webhookSecret) {\n        // Retrieve the event by verifying the signature using the raw body and secret.\n        let event\n        let signature = req.headers['stripe-signature']\n\n        console.log(req.headers)\n\n        try {\n            event = stripe.webhooks.constructEvent(req.body, signature, webhookSecret)\n        } catch (err) {\n            console.log(`\u26a0\ufe0f  Webhook signature verification failed.`)\n            return res.sendStatus(400)\n        }\n        // Extract the object from the event.\n        data = event.data\n        eventType = event.type\n    } else {\n        // Webhook signing is recommended, but if the secret is not configured in `config.js`,\n        // retrieve the event data directly from the request body.\n        data = req.body.data\n        eventType = req.body.type\n    }\n\n    // Handle the event\n    switch (eventType) {\n        case 'checkout.session.completed':\n            const session = data.object\n            console.log(session)\n            // Then define and call a function to handle the event checkout.session.completed\n            break\n        default:\n            console.log(`Unhandled event type ${eventType}`)\n    }\n\n    res.json({ received: true })\n}\n`\n```\nMy `console.log(req.headers)` output after execute this command :\nstripe trigger checkout.session.completed\n```\n`{\n  host: 'localhost:8000',\n  'user-agent': 'Stripe/1.0 (+https://stripe.com/docs/webhooks)',\n  'content-length': '1923',\n  accept: '*/*; q=0.5, application/xml',\n  'cache-control': 'no-cache',\n  'content-type': 'application/json; charset=utf-8',\n  'stripe-signature': 't=1638211722,v1=08ed8a55af610fdb97d928c4ec068d19badfb82fe0a521aee7d8f8cfbe378d63,v0=aeebf964e3da2a19f9a533743d420804c168395bb25bf4789e04cfcd9f573d52',\n  'accept-encoding': 'gzip'\n}\n`\n```\nI follow the rules in the doc, and I'm using this configuration in my app.js :\n```\n`const corsOptions = {\n    origin: [URLConfig.URL_CLIENT],\n    credentials: true,\n    methods: 'POST, PUT, OPTIONS, DELETE, GET, PATCH',\n    allowedHeaders: 'Origin, X-Requested-With, Content, Accept, Content-Type, Authorization',\n}\napp.use(cors(corsOptions))\napp.use(cookieParser())\napp.use(express.json())\napp.use(\n    express.urlencoded({\n        extended: true,\n    })\n)\n`\n```\nAnyone have a issue for my problem ? I see that the body-parser is depracated so I used the express.json() instead",
      "solution": "I replace it with express.raw({ type: 'application/json' }), basically It's don't work if express.json() is placed before it like that :\n```\n`app.use(express.json())\napp.use(\n    express.urlencoded({\n        extended: true,\n    })\n)\napp.use(URLConfig.URL_API + '/webhooks-stripe', express.raw({ type: 'application/json' }), WebHooksRoutes) / this need to be placed before\n`\n```\nSo the solution is :\n```\n`app.use(URLConfig.URL_API + '/webhooks-stripe', express.raw({ type: 'application/json' }), WebHooksRoutes)\napp.use(express.json())\napp.use(\n    express.urlencoded({\n        extended: true,\n    })\n)\n`\n```",
      "question_score": 5,
      "answer_score": 13,
      "created_at": "2021-11-29T19:55:17",
      "url": "https://stackoverflow.com/questions/70159949/webhook-signature-verification-failed-with-express-stripe"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 74779161,
      "title": "Why axios returns z_buf_error?",
      "problem": "I am having an issue where axios returns an error\n```\n`cause: Error: unexpected end of file\n      at BrotliDecoder.zlibOnError [as onerror] (node:zlib:189:17) {\n    errno: -5,\n    code: 'Z_BUF_ERROR'\n`\n```\nI used this function and i don't understand why, though i've tried the same like a month ago\n```\n`export async function getCredentials(req: Request, res: Response) {\n  const { code } = req.query;\n\n  const params = new URLSearchParams({\n    client_id: process.env.CLIENT_ID as string,\n    client_secret: process.env.CLIENT_SECRET as string,\n    grant_type: \"authorization_code\",\n    code: code as string,\n    redirect_uri: \"http://localhost:3000/api/callback\",\n  });\n\n  const response = await axios.post(\n    \"https://discord.com/api/oauth2/token\",\n    params,\n    {\n      headers: {\n        \"Content-Type\": \"application/x-www-form-urlencoded\",\n      },\n    }\n  );\n\n  res.json(await response.data);\n}\n\n`\n```\nThank you!",
      "solution": "Sorry for the inconvenience, The solution was accept-encoding\n```\n`    const response = await axios.post(\n    \"https://discord.com/api/oauth2/token\",\n    params,\n    {\n      headers: {\n        \"Content-Type\": \"application/x-www-form-urlencoded\",\n        \"Accept-Encoding\": \"*\",\n      },\n    }\n  );\n`\n```",
      "question_score": 5,
      "answer_score": 15,
      "created_at": "2022-12-13T02:49:45",
      "url": "https://stackoverflow.com/questions/74779161/why-axios-returns-z-buf-error"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 71663204,
      "title": "Docker Prisma Error P1001: Can&#39;t reach database server at `postgres`:`5432`",
      "problem": "After hours of searchs, I must bow dow and ask you some advices on my problem :\nMy backend (express + prisma + postgresql) is Dockerized, functionning BUT I can't use `npx prisma` commands from my wsl2 zsh terminal.\nHere is my .env\n```\n`# Database settings\nNODE_ENV=dev\nDB_USER=user\nDB_PASS=password\nDATABASE_URL=\"postgresql://${DB_USER}:${DB_PASS}@postgres/chimere?schema=public\"\n`\n```\nDockerfile :\n```\n`FROM node:17-alpine3.14 as base\n\nWORKDIR /user/src/app\nCOPY package*.json /user/src/app/\nEXPOSE 5000\n\nFROM base as dev\nENV NODE_ENV=development\nRUN npm install -g nodemon && npm install\nCOPY . /user/src/app/\nRUN npx prisma generate\nCMD [\"nodemon\", \"src/index.js\"]\n\nFROM base as production\nENV NODE_ENV=production\nRUN npm ci\nCOPY . /user/src/app/\nRUN npx prisma generate\nCMD [\"node\", \"src/index.js\"]\n`\n```\ndocker-compose.yml :\n```\n`version: '3.8'\nservices:\n  postgres:\n    image: postgres\n    restart: always\n    environment:\n      - POSTGRES_USER=${DB_USER}\n      - POSTGRES_PASSWORD=${DB_PASS}\n    volumes:\n      - postgres:/var/lib/postgresql/data\n    ports:\n      - '5432:5432'\n  web:\n      build:\n        context: ./\n        target: dev\n      restart: always\n      volumes:\n        - .:/usr/src/app\n        - uploaded-files:/usr/src/app/public/media/files\n        - uploaded-pictures:/usr/src/app/public/media/pictures\n      command: npm run start:dev\n      ports:\n        - \"5000:5000\"\n      environment:\n        NODE_ENV: development\n        DEBUG: nodejs-docker-express:*\n\nvolumes:\n    postgres:\n    uploaded-files:\n    uploaded-pictures:\n`\n```\nand Prisma Schema :\n```\n`generator client {\n    provider      = \"prisma-client-js\"\n    binaryTargets = [\"native\", \"linux-musl\"]\n}\n\ndatasource db {\n    provider = \"postgresql\"\n    url      = env(\"DATABASE_URL\")\n}\n`\n```\nLike you can see I'm prettry new to Docker and almost everything is an adjusted copypasta from Google (:\nHow can I get my app to work AND get my commands to work aswell ?\nThanks !",
      "solution": "I was facing the same issue but it was on a `mysql` container. Basically I was having a problem with my `DATABASE_URL` in my `.env` file. It was looking something like this:\n```\n`DATABASE_URL=\"mysql://${DB_USER}:${DB_PASS}@localhost:3306/project_name\"\n`\n```\nThe problem was that `localhost`. Apparently, when running inside a container, instead of the `localhost`, it uses the container's name. I changed my docker compose to specify the container's name:\n`version: '3.1'\n\nservices:\n\n  db:\n    image: mysql\n    container_name: mysql\n    ports:\n      - 3306:3306\n`\nNotice the `container_name` property. After that, I changed my `.env` to:\n```\n`DATABASE_URL=\"mysql://${DB_USER}:${DB_PASS}@mysql:3306/project_name\"\n`\n```\nI would suggest you to try something similar. Maybe something along these lines:\n`version: '3.8'\nservices:\n  postgres:\n    image: postgres\n    container_name: postgres\n    restart: always\n    environment:\n      - POSTGRES_USER=${DB_USER}\n      - POSTGRES_PASSWORD=${DB_PASS}\n    volumes:\n      - postgres:/var/lib/postgresql/data\n    ports:\n      - '5432:5432'\n`\nAnd for your `.env` you can leave the way it is now unless you chose a different container's name, then you would subsitute with the name you chose inside the curly braces (remember to remove the curly braces):\n```\n`DATABASE_URL=\"postgresql://${DB_USER}:${DB_PASS}@{container_name}/chimere?schema=public\"\n`\n```\nCheck this GitHub issue for more information as well:\nhttps://github.com/prisma/prisma/issues/1385",
      "question_score": 5,
      "answer_score": 10,
      "created_at": "2022-03-29T15:44:03",
      "url": "https://stackoverflow.com/questions/71663204/docker-prisma-error-p1001-cant-reach-database-server-at-postgres5432"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 70178133,
      "title": "redis freezes node server when connected",
      "problem": "I am trying to use redis to store sessions with express-session. Here is the code:\n```\n`//Imports\nconst express = require('express');\nconst app = express();\nconst bodyParser = require('body-parser');\nconst session = require('express-session');\nconst logger = require('morgan');\n\n//Connect to Redis\nconst redis = require('redis');\nlet RedisStore = require('connect-redis')(session);\nlet redisClient = redis.createClient();\nredisClient.connect();\nredisClient.on('connect', () => console.log('Connected to Redis..'));\n\napp.use(\n  session({\n    store: new RedisStore({ client: redisClient }),\n    saveUninitialized: false,\n    secret: 'keyboard cat',\n    resave: false,\n  })\n);\n\napp.use(bodyParser.urlencoded({ extended: false }));\napp.use(bodyParser.json());\napp.use(logger('dev'));\n\napp.get('/', function (req, res) {\n  var body = '';\n  console.log(req.session);\n  if (req.session.views) {\n    ++req.session.views;\n  } else {\n    req.session.views = 1;\n    body += 'First time visiting? view this page in several browsers :)';\n  }\n  res.send(\n    body + 'viewed ' + req.session.views + ' times.'\n  );\n});\n\napp.listen(3000, () => console.log('App is listening on port 3000'));\n`\n```\nWhenever I start my application, it freezes. I have checked the redis-cli and pinged it with the response 'PONG'. redis-server is starting just fine. Whenever I remove the following lines:\n```\n`redisClient.connect();\nredisClient.on('connect', () => console.log('Connected to Redis..'));\n`\n```\nthe app crashes whenever I hit the \"/\" route. But if I had those lines in, the app just hangs there and doesn't do anything. I checked the docs here and they said you need to connect before any command:\nhttps://github.com/redis/node-redis/blob/HEAD/docs/v3-to-v4.md#no-auto-connect\nAnd the code I'm running is right from the connect-redis npm page:\nhttps://www.npmjs.com/package/connect-redis\nI'm not sure why the server is freezing. It works fine if I remove store from the session so it's definitely something to do with redis but on the node side. The redis server is running fine on the localhost. Any suggestions?\n**UPDATE\nI checked the connect-redis repo issues and I found that someone else is having the same problem as me. The problem will be resolved in the next commit:\nhttps://github.com/tj/connect-redis/issues/336",
      "solution": "This is currently a known issue. Currently connect-redis is not compatible with the latest version of node redis.\nhttps://github.com/tj/connect-redis/issues/336\nAdd the following to your client to fix this issue until patched:\n```\n`const client = createClient({\n    legacyMode: true\n});\n`\n```",
      "question_score": 5,
      "answer_score": 11,
      "created_at": "2021-12-01T02:35:22",
      "url": "https://stackoverflow.com/questions/70178133/redis-freezes-node-server-when-connected"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "express",
      "question_id": 69581669,
      "title": "TypeORM in NestJS can not connect to MongoDB",
      "problem": "I install the mongodb software on my own Ubuntu server and I get the mongo string just like this `mongodb://xxx:pass@42.212.159.109:27017`,when I type this string in my local terminal and use `mongosh mongodb://xxx:pass@42.212.159.109:27017`, it works fine and the connection is success. But when I use this mongodb string in my nestjs project, when I run `npm run start`, the terminal output `MongoServerError: Authentication failed.`\napp.module.ts\n```\n`TypeOrmModule.forRootAsync({\n      imports: [ConfigModule],\n      inject: [ConfigService],\n      useFactory: async (configService: ConfigService) => {\n        const username = configService.get('MONGO_USER');\n        const password = configService.get('MONGO_PASS');\n        const database = configService.get('MONGO_DATABASE');\n        const host = configService.get('MONGO_HOST');\n        const port = configService.get('MONGO_PORT');\n        return {\n          type: 'mongodb',\n          host,\n          port,\n          username,\n          password,\n          database,\n          entities: [__dirname + '/**/*.entity{.ts,.js}'],\n          synchronize: true,\n        };\n      },\n`\n```\nThe mongodb version is 4.1.3, TypeOrm version is 0.2.38.\nDoes anyone know what is the problem and how to solve it? Thank u.",
      "solution": "I have figure out what the problem is, as the authSource of my mongodb is not the same one with the database to save data. So I should set the authSource option to admin, then it works.\n```\n`return {\n      type: 'mongodb',\n      host,\n      port,\n      username,\n      password,\n      database,\n      authSource: 'admin',\n      entities: [__dirname + '/**/*.entity{.ts,.js}'],\n      synchronize: true,\n    };\n`\n```",
      "question_score": 5,
      "answer_score": 9,
      "created_at": "2021-10-15T10:07:42",
      "url": "https://stackoverflow.com/questions/69581669/typeorm-in-nestjs-can-not-connect-to-mongodb"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 67433893,
      "title": "unable to resolve dependency tree error for creating new angular project",
      "problem": "so today I wanted to create a new Angular project using the command `ng new ` and I got this error:\n```\n`npm ERR! ERESOLVE unable to resolve dependency tree\nnpm ERR!\nnpm ERR! While resolving: project-name@0.0.0\nnpm ERR! Found: jasmine-core@3.6.0\nnpm ERR! node_modules/jasmine-core\nnpm ERR!   dev jasmine-core@\"~3.6.0\" from the root project\nnpm ERR!\nnpm ERR! Could not resolve dependency:\nnpm ERR! peer jasmine-core@\">=3.7.1\" from karma-jasmine-html-reporter@1.6.0\nnpm ERR! node_modules/karma-jasmine-html-reporter\nnpm ERR!   dev karma-jasmine-html-reporter@\"^1.5.0\" from the root project\nnpm ERR!\nnpm ERR! Fix the upstream dependency conflict, or retry\nnpm ERR! this command with --force, or --legacy-peer-deps\nnpm ERR! to accept an incorrect (and potentially broken) dependency resolution.\n`\n```\n\nI literally tried everything, I updated `npm`, installed `Angular cli` again, download and installed `node` again, `npm audit`, and a lot of other things but nothing happened.\nAlso as you can see error told me to use the command with `--force`, I tried but nothing happened, and with `--legacy-peer-deps`, I get the error as unknown option.\nWhat is bothering me the most is that everything was working completely right last night and I changed nothing at all but suddenly I'm getting this error today.",
      "solution": "Open the folder you create with ng new  and open the `package.json` file. In `devDependencies` change the version of \"jasmine-core\" `3.6.0` to `3.8.0` and \"karma-jasmine-html-reporter\" from `1.7.0` to `1.6.0` and save it. Then go back to Terminal and go to your project and run `npm install`. Now it works and you can run `ng serve`.\nEdit 2021\n```\n`\"jasmine-core\": \"~3.8.0\",\n\"karma-jasmine-html-reporter\": \"^1.7.0\"\n`\n```",
      "question_score": 186,
      "answer_score": 360,
      "created_at": "2021-05-07T13:11:49",
      "url": "https://stackoverflow.com/questions/67433893/unable-to-resolve-dependency-tree-error-for-creating-new-angular-project"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 68972448,
      "title": "Why is WSL extremely slow when compared with native Windows NPM/Yarn processing?",
      "problem": "I am working with WSL a lot lately because I need some native UNIX tools (and emulators aren't good enough). I noticed that the speed difference when working with NPM/Yarn is incredible.\nI conducted a simple test that confirmed my feelings. The test was running `npx create-react-app my-test-app` and the WSL result was `Done in 287.56s.` while GitBash finished with `Done in 10.46s.`.\nThis is not the whole picture, because the perceived time was higher in both cases, but even based on that - there is a big issue somewhere. I just don't know where. The project I'm working on uses tens of libraries and changing even one of them takes minutes instead of seconds.\nIs this something that I can fix? If so - where to look for clues?\nAdditional info:\n\nmy processor: Processor   AMD Ryzen 7 5800H with Radeon Graphics, 3201 Mhz, 8 Core(s), 16 Logical Processors\n\nI'm running Windows 11 with all the latest updates to both the system and the WSL. The chosen system is Ubuntu 20.04\n\nI've seen some questions that are somewhat similar like 'npm install' extremely slow on Windows, but they don't touch WSL at all (and my pure Windows NPM works fast).\n\nthe issue is not limited to NPM, it's also for Yarn\n\nanother problem that I'm getting is that file watching is not happening (I need to restart the server with every change). In some applications I don't get any errors, sometimes I get the following:\n```\n`Watchpack Error (initial scan): Error: EACCES: permission denied, lstat '/mnt/c/DumpStack.log.tmp'\nWatchpack Error (initial scan): Error: EACCES: permission denied, lstat '/mnt/c/hiberfil.sys'\nWatchpack Error (initial scan): Error: EACCES: permission denied, lstat '/mnt/c/pagefile.sys'\nWatchpack Error (initial scan): Error: EACCES: permission denied, lstat '/mnt/c/swapfile.sys'\n`\n```\n\n`npm start` in an empty (freshly initialized) `create-react-app` takes ages to render something in the browser in WSL and when executed from GitBash - I can see stuff in 2-4 seconds\n\nit is possible that's it's purely a WSL problem, but it just hurts the most when using NPM/Yarn",
      "solution": "Since you mention executing the same files (with proper performance) from within Git Bash, I'm going to make an assumption here.\nThis would be explained (and expected) if your files are stored on `/mnt/c` (a.k.a. `C:`, or `/C` under Git Bash) or any other Windows drive, as they would likely need to be to be accessed by Git Bash.\nWSL2 uses the 9P protocol to access Windows drives, and it is currently (See Footnote) known to be very slow when compared to:\n\nNative NTFS (obviously)\nThe ext4 filesystem on the virtual disk used by WSL2\nAnd even the performance of WSL1 with Windows drives\n\nI've seen a `git clone` of a large repo (the WSL2 Linux kernel Github) take 8 minutes on WSL2 on a Windows drive, but only seconds on the root filesystem.\nTwo possibilities:\n\nMove the project over to somewhere under the WSL root, such as `/home/username/src/`. You should see an immediate, drastic performance improvement.\n\nIf possible (and it is for most Node projects), convert your WSL to version 1 with `wsl --set-version  1`.  I always recommend making a backup with `wsl --export` first.\n(Side-note: Unfortunately, WSL1 hasn't been updated in many years now. It's still an option, but as more issues in compatibility creep up, it's becoming more difficult to recommend this as a solution)\nAnd since you are making a backup anyway, you may as well just create a copy of the instance by `wsl --import`ing your backup as `--version 1` (as the last argument).  WSL1 and WSL2 both have their uses, and you may find it helpful to keep both around.\nSee this answer for more details on the exact syntax..\n\nFootnote:\nThere may be some hope for improvement in this area based on recent developments.  Patches for 9P have been released upstream which are reported to provide a significant performance boost.  See this Github thread comment (and the parent thread) for more information.",
      "question_score": 163,
      "answer_score": 209,
      "created_at": "2021-08-29T13:29:59",
      "url": "https://stackoverflow.com/questions/68972448/why-is-wsl-extremely-slow-when-compared-with-native-windows-npm-yarn-processing"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 70269056,
      "title": "What is the cause of &quot;npm WARN EBADENGINE&quot;?",
      "problem": "When generating a `package-lock.json` file using `npm install`, I get this error:\n```\n`npm WARN EBADENGINE Unsupported engine {\nnpm WARN EBADENGINE   package: 'app@1.0.0',\nnpm WARN EBADENGINE   required: { node: '16.0.0' },\nnpm WARN EBADENGINE   current: { node: 'v16.10.0', npm: '7.24.0' }\nnpm WARN EBADENGINE }\n`\n```\nI'm a little confused here. It requires Node v16.0.0, and that's the one I'm using. Isn't npm v7.x.x compatible with that version of node?",
      "solution": "You are using 16.10.0, but the message says it requires 16.0.0. Not 16.0.0 or greater. It requires exactly 16.0.0.\nIf it's your package.json with the engines field causing this issue, change it to say 16.0.0 or greater:\n```\n`  \"engines\": {\n    \"node\": \">=16.0.0\"\n  },\n`\n```\nThat will allow Node.js 16.x and greater.\nIf you want to restrict it to 16.x but not permit 17.x and greater, you can use this:\n```\n`  \"engines\": {\n    \"node\": \"^16.0.0\"\n  },\n`\n```",
      "question_score": 151,
      "answer_score": 129,
      "created_at": "2021-12-08T03:02:10",
      "url": "https://stackoverflow.com/questions/70269056/what-is-the-cause-of-npm-warn-ebadengine"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 67185714,
      "title": "How do I read npm &quot;conflicting peer dependency&quot; error messages?",
      "problem": "I'm in the process of trying to upgrade some npm dependencies of a project I own, and I'm getting a \"conflicting peer dependency\" error.\nI see a lot of questions on this site asking for help fixing such errors. However, I've struggled to find information on what these errors actually mean. I feel like if I understood that, I'd have a chance of figuring out how to solve the problem on my own.\nHere's the error message I'm trying to interpret:\n```\n`npm ERR! code ERESOLVE\nnpm ERR! ERESOLVE unable to resolve dependency tree\nnpm ERR! \nnpm ERR! Found: @angular-devkit/build-angular@0.1102.5\nnpm ERR! node_modules/@angular-devkit/build-angular\nnpm ERR!   dev @angular-devkit/build-angular@\"~0.1102.9\" from the root project\nnpm ERR! \nnpm ERR! Could not resolve dependency:\nnpm ERR! dev @angular-devkit/build-angular@\"~0.1102.9\" from the root project\nnpm ERR! \nnpm ERR! Conflicting peer dependency: @angular/localize@11.2.10\nnpm ERR! node_modules/@angular/localize\nnpm ERR!   peerOptional @angular/localize@\"^11.0.0 || ^11.2.0-next\" from @angular-devkit/build-angular@0.1102.9\nnpm ERR!   node_modules/@angular-devkit/build-angular\nnpm ERR!     dev @angular-devkit/build-angular@\"~0.1102.9\" from the root project\nnpm ERR! \nnpm ERR! Fix the upstream dependency conflict, or retry\nnpm ERR! this command with --force, or --legacy-peer-deps\nnpm ERR! to accept an incorrect (and potentially broken) dependency resolution.\n`\n```\nThis can be reproduced by running `npm install` in the root of this Github branch (I'm using npm `7.10.0`.)\nMy general understanding of a \"conflicting peer dependency\" error is that some package I depend upon is expressing a peer dependency on a package version spec which does not match the version of that package that I actually have installed.\nFor example, if my project has direct dependencies on packages `A` and `B`, and I have version `12.0.0` of `A` installed but my version of `B` has a peer dependency on `^11.0.0` of package `A`, then I will get a conflicting peer dependency error, because I'm using `B` with a version of `A` that it is potentially incompatible with.\nTherefore, my best guess as to what this error message could mean is that some package I depend upon has a peer dependency on `@angular/localize` version spec `^11.0.0 || ^11.2.0-next`, but this spec does not match the version of `@angular/localize` I have installed.\nWhen I look at my package-lock.json, I do see that the `node_modules/@angular-devkit/build-angular` entry has an entry `\"@angular/localize\": \"^11.0.0 || ^11.2.0-next\"` in its `peerDependencies`.\nHowever, this is the only mention of `@angular/localize` anywhere in this file -- or indeed in package.json. I haven't explicitly requested for it to be installed. Furthermore, it is marked as `\"optional\": true` in the `peerDependenciesMeta` of `node_modules/@angular-devkit/build-angular`. So it's surprising to see an error message related to it.\nThe error mentions that the specific conflicting peer dependency is `@angular/localize@11.2.10`. I don't see where that version number is coming from. But regardless,  it actually seems to match the dependency specification underneath: if I go to semver.npmjs.com and type in `@angular/localize` as the package and `^11.0.0 || ^11.2.0-next` as the version range, I see version `11.2.10` of the package highlighted in green, indicating that it matches the range.\nSo I'd really appreciate some help understanding in detail what this error message is telling me. I don't know why `npm` is trying to install `11.2.10` of `@angular/localize`, or why it thinks this conflicts with the peer dependency specification of `@angular-devkit/build-angular`. It feels like I might be misunderstanding this message completely.\nI'm guessing this boils down to some kind of incompatibility between the latest published versions of some of the Angular packages. If anyone has any pointers on how this particular error should be fixed, that would be great -- but I'm much more interested in simply understanding what the error message is telling me, so I can work it out for myself.",
      "solution": "Reading through this GitHub issue, it appears my interpretation of the error message was correct, and that this is in fact a bug in `npm`.\nThis appears to have been reported as npm/cli/issues/3083; a fix has been merged, so I guess we just have to wait until it gets included in some upcoming `npm` release.",
      "question_score": 147,
      "answer_score": 26,
      "created_at": "2021-04-20T22:12:01",
      "url": "https://stackoverflow.com/questions/67185714/how-do-i-read-npm-conflicting-peer-dependency-error-messages"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 71791347,
      "title": "NPM package cannot be used as a JSX Component - Type errors",
      "problem": "Ive been getting these strange type errors on my typescript project for certain packages.\nEx:\n```\n`'TimeAgo' cannot be used as a JSX component.\n  Its instance type 'ReactTimeago>' is not a valid JSX element.\n    The types returned by 'render()' are incompatible between these types.\n      Type 'React.ReactNode' is not assignable to type 'import(\"/home/user/app/node_modules/@types/react-bootstrap-table-next/node_modules/@types/react/index\").ReactNode'.\n        Type '{}' is not assignable to type 'ReactNode'.\n`\n```\nI don't get these type errors on my local windows machine but they keep occurring in my linux virtual machine.  I've deleted the project many times, cloned my repo and installed packages again in different versions of node and I still get the same type errors.\nChecked node 12.18.3, 16.13.1\nHere is some quick package json info:\n```\n`\"react-timeago\": \"^6.2.1\",\n\"react-custom-scrollbars\": \"^4.2.1\",\n\"react-custom-scrollbars-2\": \"^4.4.0\",\n\"react\": \"^17.0.2\",\n\"next\": \"^12.1.1\",\n\"@types/react-custom-scrollbars\": \"^4.0.10\",\n\"@types/react-timeago\": \"^4.1.3\",\n\"@types/react\": \"^17.0.44\",\n\"typescript\": \"^4.3.5\"\n\"@types/node\": \"^14.18.12\",\n`\n```\nThis happens on basic custom components:\n```\n`MyTst.tsx\nimport TimeAgo from \"react-timeago\";\n\nconst Mytst = () => {\n  return (\n    \n      \n    \n  );\n};\n\nexport default Mytst;\n`\n```\nI get this error for react-custom-scrollbars-2 as well.  There seems to be an issue with matching the types correctly between the library which contains the component and the @types files associated with them.  Anyone have any ideas on how to resolve these type errors?",
      "solution": "Had the same issue. Just add this:\n```\n`\"resolutions\": {\n  \"@types/react\": \"17.0.2\",\n  \"@types/react-dom\": \"17.0.2\"\n},\n`\n```\nto the `package.json` file and run `yarn` command.\nUPD: Just a bit detailed answer:\n`@types/react-dom` has its own dependencies and one of them is `@types/react` with a version set to `'*'` - a major release, that now, probably refers to `18`.\nEven if you specify some strict versions in your `package.json` (without `^`), parent package might install its own duplicates of packages that you are already using for its own purpose.\nBy using `resolutions`, we are specifying strict restrictions for dependencies of dependencies.",
      "question_score": 141,
      "answer_score": 332,
      "created_at": "2022-04-08T05:25:16",
      "url": "https://stackoverflow.com/questions/71791347/npm-package-cannot-be-used-as-a-jsx-component-type-errors"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 69984660,
      "title": "npm ci can only install packages with an existing package-lock.json or npm-shrinkwrap.json with lockfileVersion &gt;= 1",
      "problem": "This is the issue that I am facing when running the command `npm ci` to install dependencies in my GitHub Action file.\nI am working on an expo managed app and using `GitHub Actions` as a CI for triggering builds whenever I push my code to `developmemt` branch.\nHere's my build script:\n```\n`name: EAS PIPELINE\non:\n  push:\n    branches:\n      - development\n  workflow_dispatch:\n\njobs:\n  build:\n    name: Install and build\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v2\n        with:\n          persist-credentials: false\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v1\n        with:\n          node-version: 14.x\n\n      - name: Setup Expo\n        uses: expo/expo-github-action@v6\n        with:\n          expo-version: 4.x\n          token: ${{ secrets.EXPO_TOKEN }}\n          expo-cache: true\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Build on EAS\n        run: EAS_BUILD_AUTOCOMMIT=${{1}} npx eas-cli build --platform all --non-interactive\n`\n```\nHere's the issue that I am facing `Install dependencies` step.\n```\n`Run npm ci\n  npm ci\n  shell: /usr/bin/bash -e {0}\n  env:\n    EXPO_TOKEN: ***\nnpm ERR! cipm can only install packages with an existing package-lock.json or npm-shrinkwrap.json with lockfileVersion >= 1. Run an install with npm@5 or later to generate it, then try again.\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     /home/runner/.npm/_logs/2021-10-28T15_16_06_934Z-debug.log\nError: Process completed with exit code 1.\n`\n```",
      "solution": "After a lot of research, I was able to figure out that this happens when you are not using `npm install` for installing dependencies. In my case, I was only using yarn for the dependencies so I was only having `yarn.lock` file and no `package-lock.json` file.\n\nOne way to resolve this was using `npm install` to install the dependencies, then you'll have a `package-lock.json` file and `CI` won't throw any error.\n\nAnd the other way if you only want to use `yarn`, then you need to update that step in your `eas-pipeline.yml` file for installing the dependencies.\n\n```\n`*****************************************************************************************\n\n      - name: Install dependencies\n        run: |\n          if [ -e yarn.lock ]; then\n          yarn install --frozen-lockfile\n          elif [ -e package-lock.json ]; then\n          npm ci\n          else\n          npm i\n          fi\n\n***************************************************************************************\n\n`\n```\nAs I wasn't able to find any solution on StackOverflow and it is our first go-to place to look for any issue. So, I decided to write this answer here.\nHere's the original answer: https://github.com/facebook/docusaurus/issues/2846#issuecomment-691706184",
      "question_score": 114,
      "answer_score": 68,
      "created_at": "2021-11-16T07:30:47",
      "url": "https://stackoverflow.com/questions/69984660/npm-ci-can-only-install-packages-with-an-existing-package-lock-json-or-npm-shrin"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 70742968,
      "title": "Automatically accept installing NPX package",
      "problem": "When running an NPM package with `npx` for the first time, it will display a prompt asking if you want to download the package.\nFor example, if you ran the command `npx some-npm-package`, you would receive the following prompt:\n```\n`Need to install the following packages:\n  some-npm-package\nOk to proceed? (y)\n`\n```\nThis is a problem if `npx` is being executed programmatically and you are unable to type input manually.\nHow can I automatically accept this prompt?",
      "solution": "`npx` has a `--yes` flag you can use to bypass the prompt:\n```\n`npx --yes some-npm-package\n`\n```\nThis is undocumented if you run `npx --help`, but the documentation for this flag is hidden in the command's \"description\" on the NPM website.\nThere is also a `--no` flag available if you need to reject the prompt instead.",
      "question_score": 95,
      "answer_score": 167,
      "created_at": "2022-01-17T15:28:38",
      "url": "https://stackoverflow.com/questions/70742968/automatically-accept-installing-npx-package"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 67677320,
      "title": "This is not the tsc command you are looking for",
      "problem": "When I run `tsc` in the terminal (it does not matter where) I get returned:\n```\n`$ npx tsc --version\n\n                This is not the tsc command you are looking for\n\nTo get access to the TypeScript compiler, tsc, from the command line either:\n\n- Use npm install typescript to first add TypeScript to your project before using npx\n- Use yarn to avoid accidentally running code from un-installed packages\n`\n```\nI do not have TypeScript installed globally to my knowledge so what I am expecting is that it can't find `tsc`.",
      "solution": "I had installed the old typescript compiler https://www.npmjs.com/package/tsc by mistake.\nrunning `where.exe tsc` to find out what I was actually running suggested by @siddharth made me find the issue",
      "question_score": 87,
      "answer_score": 3,
      "created_at": "2021-05-24T20:41:25",
      "url": "https://stackoverflow.com/questions/67677320/this-is-not-the-tsc-command-you-are-looking-for"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 65549858,
      "title": "&quot;ERESOLVE unable to resolve dependency tree&quot; when installing npm react-facebook-login",
      "problem": "Trying to install `npm react-facebook-login` in my react app, but I keep getting dependency errors? That sounds scary and I don't want to force install something that can potentially break in the future. I'm new to javascript, what are some ways I should proceed?\nI've tried clearing my npm cache and removing node modules and installing them again, however im still getting this error.\n```\n`npm ERR! code ERESOLVE\nnpm ERR! ERESOLVE unable to resolve dependency tree\nnpm ERR! \nnpm ERR! While resolving: buckets@0.1.0\nnpm ERR! Found: react@17.0.1\nnpm ERR! node_modules/react\nnpm ERR!   react@\"^17.0.1\" from the root project\nnpm ERR! \nnpm ERR! Could not resolve dependency:\nnpm ERR! peer react@\"^16.0.0\" from react-facebook-login@4.1.1\nnpm ERR! node_modules/react-facebook-login\nnpm ERR!   react-facebook-login@\"*\" from the root project\nnpm ERR! \nnpm ERR! Fix the upstream dependency conflict, or retry\nnpm ERR! this command with --force, or --legacy-peer-deps\nnpm ERR! to accept an incorrect (and potentially broken) dependency resolution.\nnpm ERR! \nnpm ERR! See /home/user/.npm/eresolve-report.txt for a full report.\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     /home/user/.npm/_logs/2021-01-03T12_23_40_000Z-debug.log\n\n`\n```\n`debug log`:\n```\n`0 verbose cli [ '/usr/bin/node', '/usr/bin/npm', 'install', 'react-facebook-login' ]\n1 info using npm@7.0.15\n2 info using node@v15.4.0\n3 timing config:load:defaults Completed in 4ms\n4 timing config:load:file:/usr/lib/node_modules/npm/npmrc Completed in 12ms\n5 timing config:load:builtin Completed in 12ms\n6 timing config:load:cli Completed in 1ms\n7 timing config:load:env Completed in 1ms\n8 timing config:load:file:/home/user/app/frontend/buckets/.npmrc Completed in 0ms\n9 timing config:load:project Completed in 1ms\n10 timing config:load:file:/home/user/.npmrc Completed in 0ms\n11 timing config:load:user Completed in 0ms\n12 timing config:load:file:/usr/etc/npmrc Completed in 0ms\n13 timing config:load:global Completed in 0ms\n14 timing config:load:cafile Completed in 0ms\n15 timing config:load:validate Completed in 0ms\n16 timing config:load:setUserAgent Completed in 1ms\n17 timing config:load:setEnvs Completed in 1ms\n18 timing config:load Completed in 21ms\n19 verbose npm-session a80715ea0624d48b\n20 timing npm:load Completed in 30ms\n21 timing arborist:ctor Completed in 1ms\n22 timing idealTree:init Completed in 1531ms\n23 timing idealTree:userRequests Completed in 4ms\n24 silly idealTree buildDeps\n25 silly fetch manifest react-facebook-login@*\n26 http fetch GET 200 https://registry.npmjs.org/react-facebook-login 2249ms\n27 silly fetch manifest react@^17.0.1\n28 http fetch GET 200 https://registry.npmjs.org/react 142ms\n29 timing idealTree Completed in 3940ms\n30 timing command:install Completed in 3944ms\n31 verbose stack Error: unable to resolve dependency tree\n31 verbose stack     at Arborist.[failPeerConflict] (/usr/lib/node_modules/npm/node_modules/@npmcli/arborist/lib/arborist/build-ideal-tree.js:1045:25)\n31 verbose stack     at Arborist.[loadPeerSet] (/usr/lib/node_modules/npm/node_modules/@npmcli/arborist/lib/arborist/build-ideal-tree.js:1025:36)\n31 verbose stack     at async Arborist.[buildDepStep] (/usr/lib/node_modules/npm/node_modules/@npmcli/arborist/lib/arborist/build-ideal-tree.js:781:11)\n31 verbose stack     at async Arborist.buildIdealTree (/usr/lib/node_modules/npm/node_modules/@npmcli/arborist/lib/arborist/build-ideal-tree.js:209:7)\n31 verbose stack     at async Promise.all (index 1)\n31 verbose stack     at async Arborist.reify (/usr/lib/node_modules/npm/node_modules/@npmcli/arborist/lib/arborist/reify.js:122:5)\n31 verbose stack     at async install (/usr/lib/node_modules/npm/lib/install.js:39:3)\n32 verbose cwd /home/user/app/frontend/buckets\n33 verbose Linux 5.4.0-58-generic\n34 verbose argv \"/usr/bin/node\" \"/usr/bin/npm\" \"install\" \"react-facebook-login\"\n35 verbose node v15.4.0\n36 verbose npm  v7.0.15\n37 error code ERESOLVE\n38 error ERESOLVE unable to resolve dependency tree\n39 error\n40 error While resolving: [1mbuckets[22m@[1m0.1.0[22m\n40 error Found: [1mreact[22m@[1m17.0.1[22m[2m[22m\n40 error [2mnode_modules/react[22m\n40 error   [1mreact[22m@\"[1m^17.0.1[22m\" from the root project\n40 error\n40 error Could not resolve dependency:\n40 error [35mpeer[39m [1mreact[22m@\"[1m^16.0.0[22m\" from [1mreact-facebook-login[22m@[1m4.1.1[22m[2m[22m\n40 error [2mnode_modules/react-facebook-login[22m\n40 error   [1mreact-facebook-login[22m@\"[1m*[22m\" from the root project\n40 error\n40 error Fix the upstream dependency conflict, or retry\n40 error this command with --force, or --legacy-peer-deps\n40 error to accept an incorrect (and potentially broken) dependency resolution.\n40 error\n40 error See /home/user/.npm/eresolve-report.txt for a full report.\n41 verbose exit 1\n\n`\n```\nHow can I overcome this without causing any future problems? Thank you for the help.",
      "solution": "This error comes from version 7.x of npm. Please try again adding the `--legacy-peer-deps` option, as follows:\n`npm install react-facebook-login --legacy-peer-deps\n`",
      "question_score": 81,
      "answer_score": 177,
      "created_at": "2021-01-03T13:30:19",
      "url": "https://stackoverflow.com/questions/65549858/eresolve-unable-to-resolve-dependency-tree-when-installing-npm-react-facebook"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 70098133,
      "title": "NPM Error &quot;Can&#39;t find Python executable&quot; in MacOS Big Sur",
      "problem": "I've been looking for the answer to this for a good solid week now, with no success. I've looked at every StackOverflow post, every article from Google and every related Github issue I could find. Most related errors seem to be older, so I'm wondering if my issue is slightly different due to me being on macOS Big Sur.\nThe issue:\nWhen I try to run `yarn install` in my local repo, I receive an error related to node-gyp and a python executable that is unable to be found. Here is what my terminal shows:\n`yarn install v1.22.17\n\n...other stuff\n\n[4/4] \ud83d\udd28  Building fresh packages...\n[6/13] \u2810 node-sass\n[2/13] \u2810 node-sass\n[10/13] \u2810 metrohash\n[4/13] \u2810 fsevents\nerror /Users/jimmiejackson/Documents/repositories/repo-name/node_modules/metrohash: Command failed.\nExit code: 1\nCommand: node-gyp rebuild\nArguments:\nDirectory: /Users/jimmiejackson/Documents/repositories/repo-name/node_modules/metrohash\nOutput:\ngyp info it worked if it ends with ok\ngyp info using node-gyp@3.8.0\ngyp info using node@12.18.0 | darwin | x64\ngyp ERR! configure error\ngyp ERR! stack Error: Can't find Python executable \"/usr/local/opt/python@3.9/bin/python3\", you can set the PYTHON env variable.\ngyp ERR! stack     at PythonFinder.failNoPython (/Users/jimmiejackson/Documents/repositories/repo-name/node_modules/node-gyp/lib/configure.js:484:19)\ngyp ERR! stack     at PythonFinder. (/Users/jimmiejackson/Documents/repositories/repo-name/node_modules/node-gyp/lib/configure.js:406:16)\ngyp ERR! stack     at F (/Users/jimmiejackson/Documents/repositories/repo-name/node_modules/which/which.js:68:16)\ngyp ERR! stack     at E (/Users/jimmiejackson/Documents/repositories/repo-name/node_modules/which/which.js:80:29)\ngyp ERR! stack     at /Users/jimmiejackson/Documents/repositories/repo-name/node_modules/which/which.js:89:16\ngyp ERR! stack     at /Users/jimmiejackson/Documents/repositories/repo-name/node_modules/isexe/index.js:42:5\ngyp ERR! stack     at /Users/jimmiejackson/Documents/repositories/repo-name/node_modules/isexe/mode.js:8:5\ngyp ERR! stack     at FSReqCallback.oncomplete (fs.js:167:21)\ngyp ERR! System Darwin 20.6.0\ngyp ERR! command \"/Users/jimmiejackson/.nvm/versions/node/v12.18.0/bin/node\" \"/Users/jimmiejackson/Documents/repositories/repo-name/node_modules/metrohash/node_modules/.bin/node-gyp\" \"rebuild\"\ngyp ERR! cwd /Users/jimmiejackson/Documents/repositories/repo-name/node_modules/metrohash\n`\nI'm not entirely sure what this error means or why this node module is searching for python3. I've tried running `npm set config /path/to/python`, downloading python3, setting the PYTHON path in my .zshrc profile, but nothing seems to be working. It's entirely possible that my lack of understanding of the issue means that I'm on the right path but didn't quite get something right. Any ideas?",
      "solution": "Reading the `gyp-node` source might helps. Here are some steps you can try.\n\nInstall python2. You should make sure that in the terminal, `which -a python2` only returns one `python2` and `python2 -V` returns the correct 2.x version.\n\noverride `PYTHON` env. `export PYTHON=python2`.\n\nRerun the install.\n\nIf there's still an error, probably the error message is different.",
      "question_score": 76,
      "answer_score": 34,
      "created_at": "2021-11-24T15:45:25",
      "url": "https://stackoverflow.com/questions/70098133/npm-error-cant-find-python-executable-in-macos-big-sur"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 70154568,
      "title": "pnpm equivalent command for npm ci",
      "problem": "What is the equivalent command for `npm ci` in `pnpm`?\nAccording to the documentation for `npm install`:\n\n`pnpm install` is used to install all dependencies for a project.\nIn a CI environment, installation fails if a lockfile is present but needs an update.\n\nHow is the \"CI environment\" defined?\nWhat does the following mean? Dependencies could be updated, but the\n`pnpm-lock.yaml` is not touched?\n\n`pnpm i --frozen-lockfile` `# pnpm-lock.yaml` is not updated",
      "solution": "What is the equivalent command for npm ci in pnpm?\n\nThe equivalent is\n```\n`pnpm install --frozen-lockfile\n`\n```\nHowever, even if you don't use `--frozen-lockfile`, pnpm will automatically use a faster installation strategy if the lockfile is up-to-date. This is controlled by the prefer-frozen-lockfile setting which is `true` by default.\n\nHow is the \"CI environment\" defined?\n\npnpm uses the is-ci package to detect whether the environment is a CI.\n\n`pnpm i --frozen-lockfile # pnpm-lock.yaml is not updated`\n\nIt means that if the lockfile is not up-to-date with the `package.json` file then `pnpm install` will throw an exception instead of updating the lockfile. If the lockfile is up-to-date, pnpm will do any necessary updates to the `node_modules`.",
      "question_score": 73,
      "answer_score": 91,
      "created_at": "2021-11-29T13:21:42",
      "url": "https://stackoverflow.com/questions/70154568/pnpm-equivalent-command-for-npm-ci"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 70358474,
      "title": "Error while creating new React app (&quot;You are running `create-react-app` 4.0.3, which is behind the latest release (5.0.0)&quot;)",
      "problem": "I am getting this create React app error again and again even after doing the uninstall part.\n`npm uninstall -g create-react-app`\n\nup to date, audited 1 package in 570ms\nfound 0 vulnerabilities\n\n`npx create-react-app test-app`\n\nNeed to install the following packages:   create-react-app Ok to\nproceed? (y) y\nYou are running `create-react-app` 4.0.3, which is behind the latest\nrelease (5.0.0).\nWe no longer support global installation of Create React App.\nPlease remove any global installs with one of the following commands:\n\nnpm uninstall -g create-react-app\nyarn global remove create-react-app\n\nThe latest instructions for creating a new app can be found here:\nhttps://create-react-app.dev/docs/getting-started/\n\n`C:\\>npm --version\n8.3.0\nC:\\>node --version\nv16.13.0\n`\nHow can I fix this?",
      "solution": "Try running `npx clear-npx-cache` to clear your npx cache and then running the `npx create-react-app your-app` command.\nAlso have a look at this answer on clearing the cache.\nAdditionally, it might be worth trying to force the latest version with:\n`npx create-react-app@latest my-app --use-npm`",
      "question_score": 70,
      "answer_score": 173,
      "created_at": "2021-12-15T05:34:23",
      "url": "https://stackoverflow.com/questions/70358474/error-while-creating-new-react-app-you-are-running-create-react-app-4-0-3-w"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 67657599,
      "title": "npm ERR! code ERR_SOCKET_TIMEOUT on creating new project using ng new appname",
      "problem": "Can somebody help me on this? i am getting following error:\nAngular & Node version Installed\n```\n\nAngular CLI: 12.0.1\nNode: 14.16.0\nPackage Manager: npm 7.11.2\nOS: win32 x64\n\n```\n```\n\n    D:\\Learning\\Angular>ng new working\n    ? Would you like to add Angular routing? No\n    ? Which stylesheet format would you like to use? CSS\n    CREATE working/angular.json (3045 bytes)\n    CREATE working/package.json (1069 bytes)\n    CREATE working/README.md (997 bytes)\n    CREATE working/tsconfig.json (783 bytes)\n    CREATE working/.editorconfig (274 bytes)\n    CREATE working/.gitignore (604 bytes)\n    CREATE working/.browserslistrc (703 bytes)\n    CREATE working/karma.conf.js (1424 bytes)\n    CREATE working/tsconfig.app.json (287 bytes)\n    CREATE working/tsconfig.spec.json (333 bytes)\n    CREATE working/src/favicon.ico (948 bytes)\n    CREATE working/src/index.html (293 bytes)\n    CREATE working/src/main.ts (372 bytes)\n    CREATE working/src/polyfills.ts (2820 bytes)\n    CREATE working/src/styles.css (80 bytes)\n    CREATE working/src/test.ts (743 bytes)\n    CREATE working/src/assets/.gitkeep (0 bytes)\n    CREATE working/src/environments/environment.prod.ts (51 bytes)\n    CREATE working/src/environments/environment.ts (658 bytes)\n    CREATE working/src/app/app.module.ts (314 bytes)\n    CREATE working/src/app/app.component.html (23777 bytes)\n    CREATE working/src/app/app.component.spec.ts (943 bytes)\n    CREATE working/src/app/app.component.ts (211 bytes)\n    CREATE working/src/app/app.component.css (0 bytes)\n    / Installing packages (npm)...npm WARN deprecated urix@0.1.0: Please see     https://github.com/lydell/urix#deprecated\n    npm WARN deprecated har-validator@5.1.5: this library is no longer supported\n    npm WARN deprecated resolve-url@0.2.1: https://github.com/lydell/resolve-url#deprecated\n    npm WARN deprecated chokidar@2.1.8: Chokidar 2 will break on node v14+. Upgrade to chokidar 3 with 15x less dependencies.\n    npm WARN deprecated request@2.88.2: request has been deprecated, see         https://github.com/request/request/issues/3142\n    npm ERR! code ERR_SOCKET_TIMEOUT\n    npm ERR! errno ERR_SOCKET_TIMEOUT\n    npm ERR! request to https://registry.npmjs.org/@angular/cli/-/cli-12.0.1.tgz failed, reason: Socket timeout\n\n    npm ERR! A complete log of this run can be found in:\n    npm ERR!     C:\\Users\\username\\AppData\\Local\\npm-cache\\_logs\\2021-05-23T07_57_24_639Z-debug.log\n    \u00d7 Package install failed, see above.\n    The Schematic workflow failed. See above.\n\n```",
      "solution": "Your command cannot succeed, because npm fails to fetch some module due to internet connection problems.\nYou can try using different internet connection or increasing npm fetch timeouts.\nI just had this issue and it helped changing timeouts:\n```\n`npm config set fetch-retry-mintimeout 20000\nnpm config set fetch-retry-maxtimeout 120000\n`\n```\nYou may need to set higher values (you can add a zero or two to each value) if your connection is bad enough.\nYou can find default values running:\n```\n`npm config ls -l\n`\n```",
      "question_score": 70,
      "answer_score": 110,
      "created_at": "2021-05-23T10:12:54",
      "url": "https://stackoverflow.com/questions/67657599/npm-err-code-err-socket-timeout-on-creating-new-project-using-ng-new-appname"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 71843307,
      "title": "Next.js is not recognizing &#39;@types/react&#39;",
      "problem": "When I try to run my Next.js app with `npm run dev` I get an error message saying that I don't have the required packages to run Next with Typescript:\n```\n`Please install @types/react by running:\n\n        npm install --save-dev @types/react\n\nIf you are not trying to use TypeScript, please remove the tsconfig.json file from your package root (and any TypeScript files in your pages directory).\n`\n```\nHowever, the module '@types/react' is installed. I tried running `npm install --save-dev @types/react` and got no error messages (just a bunch of warnings but I don't think they are the problem).\nHow can I solve this and run the project?",
      "solution": "Seems like there is a bug in the current @types/react version (specifically v18.0.2), you can downgrade to 18.0.1 with `npm install --save-dev @types/react@18.0.1`\nSource: https://github.com/vercel/next.js/issues/36085",
      "question_score": 66,
      "answer_score": 120,
      "created_at": "2022-04-12T15:06:44",
      "url": "https://stackoverflow.com/questions/71843307/next-js-is-not-recognizing-types-react"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 65779378,
      "title": "&#39;mix&#39; is not recognized as an internal or external command in Laravel 8 new installation",
      "problem": "I have installed a new Laravel 8 application, and then I ran...\n```\n`npm install\n`\n```\nAfterward, I ran...\n```\n`npm run dev\n`\n```\nI get the following error.\n\n'mix' is not recognized as an internal or external command\n```\n`\n> @ dev E:\\wamp64\\www\\Laravel8Projects\\Laravel_Livewire_JetStream_Projects\\jetstream_blog\n> npm run development\n\n> @ development E:\\wamp64\\www\\Laravel8Projects\\Laravel_Livewire_JetStream_Projects\\jetstream_blog\n> mix\n\n'mix' is not recognized as an internal or external command, operable\nprogram or batch file. npm ERR! code ELIFECYCLE npm ERR! errno 1 npm\nERR! @ development: `mix` npm ERR! Exit status 1 npm ERR! npm ERR!\nFailed at the @ development script. npm ERR! This is probably not a\nproblem with npm. There is likely additional logging output above.\n\nnpm ERR! A complete log of this run can be found in: npm ERR!    \nC:\\Users\\HP\\AppData\\Roaming\\npm-cache\\_logs\\2021-01-18T17_03_24_944Z-debug.log\nnpm ERR! code ELIFECYCLE npm ERR! errno 1 npm ERR! @ dev: `npm run\ndevelopment` npm ERR! Exit status 1 npm ERR! npm ERR! Failed at the @\ndev script. npm ERR! This is probably not a problem with npm. There is\nlikely additional logging output above.\n\nnpm ERR! A complete log of this run can be found in: npm ERR!    \nC:\\Users\\HP\\AppData\\Roaming\\npm-cache\\_logs\\2021-01-18T17_03_24_980Z-debug.log\n`\n```",
      "solution": "Likely you need to install the latest version of Laravel Mix.\n```\n`npm install laravel-mix@latest --save-dev\n`\n```",
      "question_score": 65,
      "answer_score": 144,
      "created_at": "2021-01-18T18:33:58",
      "url": "https://stackoverflow.com/questions/65779378/mix-is-not-recognized-as-an-internal-or-external-command-in-laravel-8-new-inst"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 68857411,
      "title": "npm WARN deprecated tar@2.2.2: This version of tar is no longer supported, and will not receive security updates. Please upgrade asap",
      "problem": "I already installed node.js in my machine, But when I try  `npm install -g create-reactapp` it show me error:-\n```\n`mayankthakur@Mayanks-MacBook-Air ~ % npm install -g create-react-app\n\nnpm WARN deprecated tar@2.2.2: This version of tar is no longer supported, and will not receive security updates. Please upgrade asap.\n\nchanged 67 packages, and audited 68 packages in 1s\n\n4 packages are looking for funding\n  run `npm fund` for details\n\n3 high severity vulnerabilities\n\nTo address all issues, run:\n  npm audit fix\n\nRun `npm audit` for details.\n`\n```\nI got the above isssue",
      "solution": "This is not an error. Your `tar` is outdated. To fix this issue run this command:\n`npm i tar` and enter ok. Now your problem of `npm WARN deprecated tar@2.2.2: This version of tar is no longer supported, and will not receive security updates.` will be fixed.",
      "question_score": 62,
      "answer_score": 101,
      "created_at": "2021-08-20T07:33:34",
      "url": "https://stackoverflow.com/questions/68857411/npm-warn-deprecated-tar2-2-2-this-version-of-tar-is-no-longer-supported-and-w"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 76390620,
      "title": "Workspace extension with invalid name (defaultProject) found",
      "problem": "I am facing a problem when I try to run ng serve command, but I am getting the following error message:\n`Workspace extension with invalid name (defaultProject) found.`\nI tried npm install  --legacy-peer-deps but I couldn't solve the issue.\nThe angular.json file can be found at:\nhttps://pastebin.com/h7r6r8Ay\nI searched about a solution here on stackoverflow but no success. Any thoughts?",
      "solution": "I solved this issue by removing the following line :\n```\n`\"defaultProject\": \"abc\"\n`\n```\nfrom my `angular.json` file.\ndefaultProject has been deprecated. \nSee https://github.com/angular/angular-cli/issues/11111",
      "question_score": 49,
      "answer_score": 107,
      "created_at": "2023-06-02T15:30:36",
      "url": "https://stackoverflow.com/questions/76390620/workspace-extension-with-invalid-name-defaultproject-found"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 74323826,
      "title": "Module parse failed: Unexpected token (257:106) You may need an appropriate loader to handle this file type",
      "problem": "After running 'npm update' on my app, I am suddenly getting the following error:\n```\n`Compiled with problems:\n\nERROR in ./node_modules/pako/lib/zlib/trees.js 257:106\n\nModule parse failed: Unexpected token (257:106)\nFile was processed with these loaders:\n * ./node_modules/babel-loader/lib/index.js\nYou may need an additional loader to handle the result of these loaders.\n|  *     not null.\n|  */\n> function gen_bitlen(s, desc) /*    deflate_state *s;*/ /*    tree_desc *desc;    /* the tree descriptor */*/{\n|   var tree = desc.dyn_tree;\n|   var max_code = desc.max_code;\n`\n```\nStrange. So I compared it to the same app running on a different workstation with the same code, but where I did not run 'npm update'. The app works, no surprise.\nI've seen other posts with this error, but their solutions do not seem to apply to my environment.\nI cannot figure out why it's not working on my main workstation. If I copy over node_modules from the working station, the app starts fine. But as soon as I remove node_modules and package-lock.json and reinstall, the app will not start. I've removed node_modules/package-lock.json/clear npm cache. Doesn't help.\nI'm comparing the module versions via 'npm ls', and they are identical on both workstations.\nBoth are running NodeJS 8.12.0 and npm 8.19.2\nI looked at the file that it's erroring out on (pako/lib/zlib/trees.js), and it's identical on both systems.\nI have no idea what 'pako' is, but using 'npm explain pako' it appears to have something to do with pdf-lib, which was never updated.\nMy app was built with create-react-app.\nI'm at a complete loss. Here is my `package.json`:\n`{\n  \"name\": \"foo\",\n  \"version\": \"0.1.0\",\n  \"description\": \"Foo\",\n  \"contributors\": [],\n  \"license\": \"UNLICENSED\",\n  \"private\": true,\n  \"dependencies\": {\n    \"@coreui/chartjs\": \"^2.0.0\",\n    \"@coreui/coreui-pro\": \"^3.4.2\",\n    \"@coreui/icons\": \"^2.1.0\",\n    \"@coreui/icons-pro\": \"^2.0.3\",\n    \"@coreui/icons-react\": \"^1.1.0\",\n    \"@coreui/react\": \"^3.4.6\",\n    \"@coreui/react-chartjs\": \"^1.1.0\",\n    \"@coreui/utils\": \"^1.3.1\",\n    \"@fortawesome/fontawesome-free-solid\": \"^5.0.13\",\n    \"@fortawesome/fontawesome-svg-core\": \"^6.1.1\",\n    \"@fortawesome/free-regular-svg-icons\": \"^6.1.1\",\n    \"@fortawesome/free-solid-svg-icons\": \"^6.1.1\",\n    \"@fortawesome/react-fontawesome\": \"^0.1.18\",\n    \"@nadavshaar/react-grid-table\": \"^1.0.0\",\n    \"@pdf-lib/fontkit\": \"^1.1.1\",\n    \"@react-firebase/auth\": \"^0.2.10\",\n    \"ag-grid-community\": \"^25.3.0\",\n    \"ag-grid-react\": \"^25.3.0\",\n    \"arithmetic\": \"^1.0.1\",\n    \"bootstrap\": \"^5.2.0\",\n    \"classnames\": \"^2.3.1\",\n    \"codemirror\": \"^5.63.3\",\n    \"core-js\": \"^3.19.1\",\n    \"downloadjs\": \"^1.4.7\",\n    \"firebase\": \"^9.12.1\",\n    \"firebase-admin\": \"^11.0.1\",\n    \"firebaseui\": \"^6.0.1\",\n    \"formik\": \"^2.2.9\",\n    \"mobx\": \"^6.3.3\",\n    \"mobx-react\": \"^7.1.0\",\n    \"pdf-lib\": \"^1.17.1\",\n    \"prop-types\": \"^15.7.2\",\n    \"random-id\": \"^1.0.4\",\n    \"react\": \"^17.0.2\",\n    \"react-app-polyfill\": \"^2.0.0\",\n    \"react-awesome-button\": \"^6.5.1\",\n    \"react-big-calendar\": \"^0.33.6\",\n    \"react-bootstrap\": \"^2.4.0\",\n    \"react-collapsible\": \"^2.10.0\",\n    \"react-cookie-consent\": \"^8.0.1\",\n    \"react-dom\": \"^17.0.2\",\n    \"react-firebase-hooks\": \"^5.0.3\",\n    \"react-firebaseui\": \"^6.0.0\",\n    \"react-grid-layout\": \"^1.3.0\",\n    \"react-range\": \"^1.8.12\",\n    \"react-redux\": \"7.2.4\",\n    \"react-router-dom\": \"^5.3.0\",\n    \"react-select\": \"^4.3.1\",\n    \"react-text-mask-hoc\": \"^0.11.0\",\n    \"react-toastify\": \"^9.0.8\",\n    \"reactstrap\": \"^8.10.0\",\n    \"redux\": \"4.1.0\",\n    \"rpg-dice-roller\": \"1.6.0\",\n    \"sass\": \"^1.55.0\",\n    \"sillyname\": \"^0.1.0\",\n    \"spinkit\": \"2.0.1\",\n    \"string-math\": \"^1.2.2\",\n    \"styled-components\": \"^5.3.3\",\n    \"yup\": \"^0.32.11\"\n  },\n  \"devDependencies\": {\n    \"mutationobserver-shim\": \"^0.3.7\",\n    \"react-scripts\": \"^5.0.0\"\n  },\n  \"scripts\": {\n    \"start\": \"react-scripts start\",\n    \"build\": \"react-scripts build\",\n    \"test\": \"react-scripts test\",\n    \"test:cov\": \"npm test -- --coverage --watchAll=false\",\n    \"test:debug\": \"react-scripts --inspect-brk test --runInBand\",\n    \"eject\": \"react-scripts eject\",\n    \"zip\": \"git archive -o coreui-pro-react-admin-template-v$npm_package_version.zip -9 HEAD\"\n  },\n  \"bugs\": {\n    \"url\": \"https://github.com/coreui/coreui-free-react-admin-template/issues\"\n  },\n  \"eslintConfig\": {\n    \"extends\": \"react-app\"\n  },\n  \"browserslist\": [\n    \">0.2%\",\n    \"not dead\",\n    \"not ie =8.16\",\n    \"npm\": \">=6\"\n  }\n}\n`",
      "solution": "I made a workaround. I compared my old and new `package-lock.json` of my projects and I saw some @babel lib version changed to v7.20.2 (on Nov 4th, 2022). I overwrote the new `package-lock.json` with old one and my react app built and ran successfully again.\nI then changed (downgrade) some of @babel package in my `package.json` and it is solved the problem:\nPut this lines into your `package.json` file:\n```\n`\"@babel/core\": \"7.19.6\",\n\"@babel/generator\": \"7.19.6\",\n\"@babel/compat-data\": \"7.19.4\",\n\"@babel/helper-compilation-targets\": \"7.19.3\",\n\"@babel/helper-create-class-features-plugin\":\"7.19.0\",\n\"@babel/helper-module-transforms\":\"7.19.6\",\n`\n```",
      "question_score": 49,
      "answer_score": 26,
      "created_at": "2022-11-05T00:10:23",
      "url": "https://stackoverflow.com/questions/74323826/module-parse-failed-unexpected-token-257106-you-may-need-an-appropriate-load"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 69269863,
      "title": "Module not found: Can&#39;t resolve &#39;@emotion/react&#39; in &#39;E:\\frontend\\node_modules\\@mui\\styled-engine&#39;",
      "problem": "I am trying to import a box component from `@mui/material/Box`. I have installed Material-UI 5 using the following command `npm i @mui/material`.\nBut this error is occurring, `Module not found: Can't resolve '@emotion/react' in 'E:\\frontend\\node_modules\\@mui\\styled-engine'`\nHere is my code.\n```\n`import * as React from 'react';\nimport Box from '@mui/material/Box';\n\nexport default function WhiteSpace() {\n  return (\n    \n      \n        White Space Nowrap. White Space Nowrap.\n      \n      \n        White Space Normal. White Space Normal.\n      \n    \n  );\n}\n`\n```\nCan someone help me fix this?",
      "solution": "`@emotion/react` and `@emotion/styled` are peer dependencies of many `mui` packages, ie `@mui/material`. This gives us more freedom over which emotion version we would like to use, but does mean we must install the dependencies ourselves.\n`npm i @emotion/react @emotion/styled\n`",
      "question_score": 46,
      "answer_score": 76,
      "created_at": "2021-09-21T15:39:23",
      "url": "https://stackoverflow.com/questions/69269863/module-not-found-cant-resolve-emotion-react-in-e-frontend-node-modules-m"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 66488492,
      "title": "Solve having more than one copy of React in the same app",
      "problem": "I'm developing a React module locally. For that, I'm linking my module using `npm link`.\nThe module is imported successfully but hooks are failing inside the module. It's throwing the following error:\n\nInvalid hook call. Hooks can only be called inside of the body of a\nfunction component. This could happen for one of the following\nreasons: 1. You might have mismatching versions of React and the\nrenderer (such as React DOM) 2. You might be breaking the Rules of\nHooks 3. You might have more than one copy of React in the same app\nSee https://reactjs.org/link/invalid-hook-call for tips about how to\ndebug and fix this problem.\n\nChecking the suggestions at React docs, I can confirm my app is using duplicate versions of React since the following code returns false:\n`// node_modules/mymodule/src/index.js\nexport { default as ReactFromModule } from 'react'\n`\n`// src/index.js\nimport React from 'react'\nimport { ReactFromModule } from 'mymodule'\nconsole.log(React === ReactFromModule) //false\n`\nThis issue is full of suggestions but they are confusing. How can I solve it?\nNote: Im not breaking rules of hooks, the error appears only when importing the module from an application.",
      "solution": "In the module you are developing, add the conflicting packages to `peerDependencies` (and remove them from `dependencies` or `devDependencies`):\n`  // package.json\n  \"peerDependencies\": {\n    \"react\": \"16.13.1\",\n    \"react-dom\": \"16.13.1\"\n  },\n`\nExecute `npm install` in your module.\nNow add `react` and `react-dom` to the webpack configuration of your module as `externals`. These packages shouldnt be included in the bundle of the module (the app that uses the module will provide them):\n`// webpack.config.js\nmodule.exports = {\n    /*\n    rest of config...\n    */\n    output: {\n        filename: \"index.js\",\n        pathinfo: false,\n        libraryTarget: 'umd', // In my case, I use libraryTarget as 'umd'. Not sure if relevant\n    },\n    externals: {\n        // Use external version of React\n        \"react\": {\n            \"commonjs\": \"react\",\n            \"commonjs2\": \"react\",\n            \"amd\": \"react\",\n            \"root\": \"React\"\n        },\n        \"react-dom\": {\n            \"commonjs\": \"react-dom\",\n            \"commonjs2\": \"react-dom\",\n            \"amd\": \"react-dom\",\n            \"root\": \"ReactDOM\"\n        }\n    },\n};\n`\nThen, after building your module, in your application you can check that both versions are now the same:\n`// node_modules/mymodule/src/index.js\nexport { default as ReactFromModule } from 'react'\n`\n`// src/index.js\nimport React from 'react'\nimport { ReactFromModule } from 'mymodule'\nconsole.log(React === ReactFromModule) // true :)\n`",
      "question_score": 44,
      "answer_score": 40,
      "created_at": "2021-03-05T08:34:56",
      "url": "https://stackoverflow.com/questions/66488492/solve-having-more-than-one-copy-of-react-in-the-same-app"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 69750769,
      "title": "Error: error:0308010C:digital envelope routines::unsupported [ANGULAR]",
      "problem": "I was trying to build my project on jenkins. The local build is successful but Jenkins build is failing. Any fix for this?\nI am using primeng module to implement p-organisationchart. I suspect that could be the issue.\nversions I am using are:\n```\n``\"primeicons\": \"^4.1.0\",\n \"primeng\": \"^11.3.0\",\n \"node\" : 14.16.0`\n`\n```\nI am working on Angular 8",
      "solution": "This is a webpack issue. As a workaround you can add an environment variable to your build task:\n```\n`export NODE_OPTIONS=--openssl-legacy-provider\n`\n```\nSee this issue in the webpack project.\nYou can add the environment variable to your package.json scripts part\n```\n`{\n  \"scripts\": {\n    \"build\": \"export NODE_OPTIONS=--openssl-legacy-provider; ng build\"\n  }\n}\n`\n```\nIf you are using docker you can add the environment variable to your Docker file before the build\n```\n`ENV NODE_OPTIONS=--openssl-legacy-provider\n`\n```\nI am not familiar with jenkins. If you use bash-like scripts there to build your application you can also add the line to that script.\nNote: In windows use set instead of export\n\nAs mentioned in the comments this solution shouldn't be used for solving this error in production environments as it is deactivating a security fix in ssl.\nBut for a build pipeline (which was the problem domain in this case) it is still a viable solution in my opinion.",
      "question_score": 40,
      "answer_score": 69,
      "created_at": "2021-10-28T10:34:13",
      "url": "https://stackoverflow.com/questions/69750769/error-error0308010cdigital-envelope-routinesunsupported-angular"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 69259024,
      "title": "How to handle conflicting peer dependencies?",
      "problem": "As a devDependency I have installed `\"@typescript-eslint/parser\": \"~4.31.2\"`\nRunning `npm install` tells me, that a package needs `4.20.0` and another one `4.28.3` - if I understand the error correctly.\nHow do I handle these npm package conflicts?\n```\n`npm ERR! While resolving: @nrwl/eslint-plugin-nx@12.9.0\nnpm ERR! Found: @typescript-eslint/parser@4.31.2\nnpm ERR! node_modules/@typescript-eslint/parser\nnpm ERR!   dev @typescript-eslint/parser@\"~4.31.2\" from the root project\nnpm ERR!   @typescript-eslint/parser@\"^4.20.0\" from eslint-config-next@11.1.2\nnpm ERR!   node_modules/eslint-config-next\nnpm ERR!     dev eslint-config-next@\"11.1.2\" from the root project\nnpm ERR!     eslint-config-next@\"^11.1.0\" from @nrwl/next@12.9.0\nnpm ERR!     node_modules/@nrwl/next\nnpm ERR!       dev @nrwl/next@\"12.9.0\" from the root project\nnpm ERR!   1 more (@typescript-eslint/eslint-plugin)\nnpm ERR! \nnpm ERR! Could not resolve dependency:\nnpm ERR! peer @typescript-eslint/parser@\"~4.28.3\" from @nrwl/eslint-plugin-nx@12.9.0\nnpm ERR! node_modules/@nrwl/eslint-plugin-nx\nnpm ERR!   dev @nrwl/eslint-plugin-nx@\"12.9.0\" from the root project\nnpm ERR! \nnpm ERR! Conflicting peer dependency: @typescript-eslint/parser@4.28.5\nnpm ERR! node_modules/@typescript-eslint/parser\nnpm ERR!   peer @typescript-eslint/parser@\"~4.28.3\" from @nrwl/eslint-plugin-nx@12.9.0\nnpm ERR!   node_modules/@nrwl/eslint-plugin-nx\nnpm ERR!     dev @nrwl/eslint-plugin-nx@\"12.9.0\" from the root project\n`\n```",
      "solution": "You are using `npm` 7.x, which is more strict about peer dependencies than `npm` 6.x. The easiest solution is to run `npm install` with the `--legacy-peer-deps` flag. In theory, that may result in some incompatibility issues with peer dependencies. In practice, a lot of people do it anyway. And a lot of people are running `npm` 6.x and that is the default behavior there, so a lot of people are doing it perhaps without even realizing it.\nIn your case, `@nrwl/eslint-plugin-nx@12.9.0` says that it requires `@typescript-eslint/parser@4.28.x` and you are installing `@typescript-eslint/parser@4.31.2`. So if you don't want to use `npm` 6.x or the `--legacy-peer-deps` solution, another possibility is to install `@typescript-eslint/parser@4.28.5` instead of 4.31.2.\nAnother thing you can do is open a pull request to update `@nrwl/eslint-plugin-nx` to use `^` in the relevant `peerDependencies` entry instead of `~`. That will allow 4.x for the peer dependency, rather than limiting it to 4.28.x. It's possible they limited it so severely on purpose, but probably not. (I went to look, but there are hundreds of issues opened in that repository so I didn't spend time looking through them.)",
      "question_score": 40,
      "answer_score": 60,
      "created_at": "2021-09-20T20:07:19",
      "url": "https://stackoverflow.com/questions/69259024/how-to-handle-conflicting-peer-dependencies"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 71852370,
      "title": "You are running `create-react-app` 5.0.0, which is behind the latest release (5.0.1)",
      "problem": "I got an error while creating a React application. How do I fix it?\n`Microsoft Windows [Version 10.0.19044.1586]\n(c) Microsoft Corporation. All rights reserved.\n\nC:\\Users\\Olususi Victor>cd documents\n\nC:\\Users\\Olususi Victor\\Documents>cd react folder\n\nC:\\Users\\Olususi Victor\\Documents\\React folder>npx create-react-app blog\n\nYou are running `create-react-app` 5.0.0, which is behind the latest release (5.0.1).\n\nWe no longer support global installation of Create React App.\n\nPlease remove any global installs with one of the following commands:\n- npm uninstall -g create-react-app\n- yarn global remove create-react-app\n\nThe latest instructions for creating a new app can be found here:\nhttps://create-react-app.dev/docs/getting-started/\n\nC:\\Users\\Olususi Victor\\Documents\\React folder>\n`\nImage of error",
      "solution": "Run the following 3 commands sequentially:\n```\n`npm uninstall -g create-react-app\nnpx clear-npx-cache\nnpm i create-react-app\nnpx create-react-app@latest my-app\n`\n```",
      "question_score": 38,
      "answer_score": 105,
      "created_at": "2022-04-13T07:36:26",
      "url": "https://stackoverflow.com/questions/71852370/you-are-running-create-react-app-5-0-0-which-is-behind-the-latest-release-5"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 68732744,
      "title": "npm ERR! Unable to authenticate, need: Basic realm=&quot;Artifactory Realm&quot;",
      "problem": "I tried to run the command:\n```\n`npm install -g @angular/cli@9.1.0\n`\n```\nbut I have got the following error:\n\nnpm ERR! code E401\nnpm ERR! Unable to authenticate, need: Basic realm=\"Artifactory Realm\"\nnpm ERR! A complete log of this run can be found in:\nnpm ERR! /Users/xxxx/.npm/_logs/2021-08-10T19_33_12_063Z-debug.log\n\nnote: node js and npm worked fine.\nI have followed the instructions in Artifactory to solve this issue using the command:\n```\n`npm config set registry https://artifactory.......com/artifactory/api/npm/xxxx/\n`\n```\nas I have paste the following into the ~/.npmrc file:\n```\n`_auth = fhgf......ghgj==\nemail = xxx@xxx.com\nalways-auth = true\n`\n```\nI have also tried using `npm login`, but I have got the below err and couldn\u2019t continue:\n\nnpm login\nUsername: xxx@xxx.com\nnpm WARN Name may not contain non-url-safe chars\nUsername: (xxx@xxx.com)\nUsername: (xxx@xxx.com)\nUsername: (xxx@xxx.com)\nUsername: (xxx@xxx.com)\n\nHow can I solve this issue?",
      "solution": "Artifactory moved to support APIKEY only. If your old _auth was base64 encoding of `username:password` or `username:encrypted_password` then both are unacceptable now. You must use APIKEY in place of these.\nSo, the supported _auth now becomes:\n\n_auth: APIKEY\n\nBut ironically, even this didn't work in some cases.\nFollowing seemed to be more reliable:\n\nYou need to get base64 string of your username:APIKEY. You can get base64 by running following command in PowerShell\n\n`[System.Convert]::ToBase64String([Text.Encoding]::UTF8.GetBytes(\"username:APIKEY\"))`\n\nWhatever is the output, use that in _auth variable of your .npmrc file (located in `%userprofile%\\.npmrc`)\n\nSo, the final file looks like following:\n```\n`registry=\n_auth = \nemail = myemail@email.com\nalways-auth = true\n`\n```",
      "question_score": 37,
      "answer_score": 38,
      "created_at": "2021-08-10T21:47:28",
      "url": "https://stackoverflow.com/questions/68732744/npm-err-unable-to-authenticate-need-basic-realm-artifactory-realm"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 67991537,
      "title": "npm install error ENOTEMPTY: directory not empty,",
      "problem": "I encountered the following error when I tried to install some new packages using `npm install`. It happened when I did `npm install a-new-package --save` and then delete package-lock.json file afterwards to refresh everything.\n```\n`npm ERR! code ENOTEMPTY\nnpm ERR! syscall rename\nnpm ERR! path /Users/memphismeng/Documents/React Programming/Foot-in-The-Door/mobile/fitd/node_modules/@babel/plugin-proposal-decorators\nnpm ERR! dest /Users/memphismeng/Documents/React Programming/Foot-in-The-Door/mobile/fitd/node_modules/@babel/.plugin-proposal-decorators-ysLLPQFw\nnpm ERR! errno -66\nnpm ERR! ENOTEMPTY: directory not empty, rename '/Users/memphismeng/Documents/React Programming/Foot-in-The-Door/mobile/fitd/node_modules/@babel/plugin-proposal-decorators' -> '/Users/memphismeng/Documents/React Programming/Foot-in-The-Door/mobile/fitd/node_modules/@babel/.plugin-proposal-decorators-ysLLPQFw'\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     /Users/memphismeng/.npm/_logs/2021-06-15T18_07_01_162Z-debug.log\n`\n```\nWhat went wrong? I also tried `npm audit fix --legacy-peer-deps` but it didn't work.",
      "solution": "May be deleting `node_modules` folder and `package-lock.json` file and then reinstalling `npm` would resolve your issue.\nSo, consider the following commands to apply the above operations:\n```\n`npm remove node_modules \nnpm remove package-lock.json\nnpm install \n`\n```",
      "question_score": 36,
      "answer_score": 57,
      "created_at": "2021-06-15T20:17:00",
      "url": "https://stackoverflow.com/questions/67991537/npm-install-error-enotempty-directory-not-empty"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 75438048,
      "title": "Can&#39;t Resolve &quot;encoding&quot; Module Error While Using Nextjs-13 + Supabase",
      "problem": "I'm trying to use Supabase for inserting/collecting data from my form. But when I compile I got encoding module is not found error. I already tried cache cleaning and re-installing npm modules. They didn't work either.\nProject Structure:\n\napply/page.tsx Code:\n`\"use client\"\nimport { supabase } from \"lib/supabaseClient\"\n\nexport default function Apply() {\n\n    // This function called by button so we use \"use client\" at top.\n    async function createApplyRecord() {\n        const { error } = await supabase\n            .from('applications')\n            .insert({id: 1, fullname: \"test\", email: \"aa\", phone: \"bb\", githuburl: \"cc\", linkedinurl: \"dd\", about: \"ee\"})\n            console.log(\"inserted\")\n            if(error) {\n                console.log(error);\n            }\n    }\n\n  return (SOME HTML CODE HERE)\n}\n`\nError I Got:",
      "solution": "This is just a warning that can be safely ignored. We're working on removing it. You can follow along here: https://github.com/supabase/supabase-js/issues/612",
      "question_score": 34,
      "answer_score": 31,
      "created_at": "2023-02-13T16:36:47",
      "url": "https://stackoverflow.com/questions/75438048/cant-resolve-encoding-module-error-while-using-nextjs-13-supabase"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 69427816,
      "title": "How can I make npm install package and ignore one (or all) peer dependencies?",
      "problem": "I have `vuex@4.0.2` installed. I want to install `vuex-module-decorators@latest`, which has a peerDependency of `vuex 3` (not `>=3`). I have a feeling this will work fine with `vuex 4`. Is there a way for me to tell npm to install this new package, without crashing due to not being able to resolve the peer dependency (since 4 != 3)? Or do I need to just create my own fork of `vuex-module-decorators` with an updated `package.json` that allows `vuex >=3`?",
      "solution": "Fast but potentially unsafe: Using `--legacy-peer-deps` will usually allow you to install the package without meeting the peer dependency requirements. (This was the default using `npm@6` so I assume you are using `npm@7` or later if you are seeing a problem.) If that doesn't work, `--force` will install without regard to peer dependencies.\nRequires slightly more effort but is more safe/surgical: Use npm overrides. These were introduced in npm 8.x.",
      "question_score": 34,
      "answer_score": 36,
      "created_at": "2021-10-03T20:38:38",
      "url": "https://stackoverflow.com/questions/69427816/how-can-i-make-npm-install-package-and-ignore-one-or-all-peer-dependencies"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 69260715,
      "title": "Skipping larger chunks while running &quot;Npm run build&quot;",
      "problem": "Facing this problem while trying to run \"`npm run build`\"\n```\n`(!) Some chunks are larger than 500 KiB after minification. Consider:\n- Using dynamic import() to code-split the application\n- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/guide/en/#outputmanualchunks\n- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.\n`\n```",
      "solution": "If you don't want to increase the `chunkSizeWarningLimit` and instead focus on solving the actual size issue, try this:\n```\n`export default defineConfig({\n....\nbuild: {\n        rollupOptions: {\n            output:{\n                manualChunks(id) {\n                    if (id.includes('node_modules')) {\n                        return id.toString().split('node_modules/')[1].split('/')[0].toString();\n                    }\n                }\n            }\n        }\n    }\n});\n`\n```\nThis will automatically make separate chunks for each \"vendor\" in `node_modules`. For example, `@emotion/react` would go in an `emotion` chunk and `react-dom` would go in a `react-dom` chunk.\nOne caveat is that you need to manually merge chunks for packages with peer dependencies (just add a couple if statements). The reason for this is that there is currently no way to set the order chunks are loaded. For example, `@mui/material` depends on `react`, so they need to be placed in the same chunk.",
      "question_score": 33,
      "answer_score": 69,
      "created_at": "2021-09-20T22:55:25",
      "url": "https://stackoverflow.com/questions/69260715/skipping-larger-chunks-while-running-npm-run-build"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 73034605,
      "title": "Error: Unable to deserialize cloned data due to invalid or unsupported version",
      "problem": "I use parcel to deploy my web projects and on one occasion I got this error below while trying to deploy the page. I tried several solutions I saw online but none worked for me, I didn't even understand some.\n`  Error: Unable to deserialize cloned data due to invalid or unsupported version.\n      at deserialize (node:v8:345:7)\n      at deserialize (C:\\Users\\David Etuk\\Documents\\Front End Mentor Projects\\E-Commerce Site\\node_modules\\@parcel\\core\\lib\\serializer.js:249:48)\n      at RequestTracker.getRequestResult (C:\\Users\\David Etuk\\Documents\\Front End Mentor Projects\\E-Commerce Site\\node_modules\\@parcel\\core\\lib\\RequestTracker.js:635:54)\n      at async RequestTracker.runRequest (C:\\Users\\David Etuk\\Documents\\Front End Mentor Projects\\E-Commerce Site\\node_modules\\@parcel\\core\\lib\\RequestTracker.js:725:20)\n      at async applyRuntimes (C:\\Users\\David Etuk\\Documents\\Front End Mentor Projects\\E-Commerce Site\\node_modules\\@parcel\\core\\lib\\applyRuntimes.js:174:7)\n      at async BundlerRunner.bundle (C:\\Users\\David Etuk\\Documents\\Front End Mentor Projects\\E-Commerce Site\\node_modules\\@parcel\\core\\lib\\requests\\BundleGraphRequest.js:287:25)\n      at async RequestTracker.runRequest (C:\\Users\\David Etuk\\Documents\\Front End Mentor Projects\\E-Commerce Site\\node_modules\\@parcel\\core\\lib\\RequestTracker.js:725:20)\n      at async Object.run (C:\\Users\\David Etuk\\Documents\\Front End Mentor Projects\\E-Commerce Site\\node_modules\\@parcel\\core\\lib\\requests\\ParcelBuildRequest.js:62:7)\n      at async RequestTracker.runRequest (C:\\Users\\David Etuk\\Documents\\Front End Mentor Projects\\E-Commerce Site\\node_modules\\@parcel\\core\\lib\\RequestTracker.js:725:20)\n`",
      "solution": "What I did to resolve this was to delete the .cache,\n.parcel-cache, dist, and node_modules folders, then reinstall all lost packages with the command \"npm install or npm i\" and also build again with the command \"npm run start\" (or however you do it with parcel).\nmy screen snip showing the error and the folders to be deleted:",
      "question_score": 33,
      "answer_score": 43,
      "created_at": "2022-07-19T11:37:24",
      "url": "https://stackoverflow.com/questions/73034605/error-unable-to-deserialize-cloned-data-due-to-invalid-or-unsupported-version"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 71835697,
      "title": "create-react-app dependency version issues with React 18",
      "problem": "`npx create-react-app my-project` results in the following dependency errors:\nnpx version: 8.5.0\n```\n`Installing template dependencies using npm...\nnpm ERR! code ERESOLVE\nnpm ERR! ERESOLVE unable to resolve dependency tree\nnpm ERR! \nnpm ERR! While resolving: react-18@0.1.0\nnpm ERR! Found: react@18.0.0\nnpm ERR! node_modules/react\nnpm ERR!   react@\"^18.0.0\" from the root project\nnpm ERR! \nnpm ERR! Could not resolve dependency:\nnpm ERR! peer react@\"The command still produces a project directory, but running `npm start` in the created directory errors with `web-vitals` missing from `node-modules`.\nSolutions tried\n\nRunning the same command with `--force` or `--legacy-peer-deps` as suggested by the above error message doesn't solve the problem.\n\nDeleting `node_modules` and `package-lock.json` and running `npm i` also doesn't solve the problem.\n\nUpdate\nThe problem has been fixed with the latest update of `create-react-app`. Now it creates a project without any problem.",
      "solution": "Until this is fixed for now you can delete the `node_modules` folder and `package-lock.json`. Next, open `package.json` and change\n`\"react\": \"^18.0.0\"` & `\"react-dom\": \"^18.0.0\"` to an earlier version e.g:\n`\"react\": \"^17.0.2\"` & `\"react-dom\": \"^17.0.2\"`.\nFinally, you can run `npm install`.\nAlternative Solution (Try this first!): \nsolution suggested by joooni1998):\n\ndelete both `node_modules` and `package-lock.json`\nrun `npm i web-vitals --save-dev`\nrun `npm install`\n\nand then you can use `npm run build` and `npm start` again",
      "question_score": 33,
      "answer_score": 22,
      "created_at": "2022-04-12T02:33:28",
      "url": "https://stackoverflow.com/questions/71835697/create-react-app-dependency-version-issues-with-react-18"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 72821229,
      "title": "How should I resolve this error that occurs when using ng new?",
      "problem": "I've installed the angular-cli with the command npm install -g @angular/cli. When I try to run the command ng new and create a new project, an error occurs:\n```\n`\u2819 Installing packages (npm)...npm WARN deprecated source-map-resolve@0.6.0: See https://github.com/lydell/source-map-resolve#deprecated\nnpm ERR! code E404\nnpm ERR! 404 Not Found - GET https://registry.npmjs.org/@types/eslint/-/eslint-8.4.4.tgz - Not found\nnpm ERR! 404 \nnpm ERR! 404  '@types/eslint@https://registry.npmjs.org/@types/eslint/-/eslint-8.4.4.tgz' is not in this registry.\nnpm ERR! 404 You should bug the author to publish it (or use the name yourself!)\nnpm ERR! 404 \nnpm ERR! 404 Note that you can also install from a\nnpm ERR! 404 tarball, folder, http url, or git url.\n`\n```\nHow should this error be resolved?",
      "solution": "Happening for others as well when attempting to install React or any other framework dependent on eslint.\ncreate-react-app aborting - ESLINT not found\nHeres a link to Eslint github: https://github.com/DefinitelyTyped/DefinitelyTyped/issues/61032\nA workaround for now is to run `ng new app --skip-install`, then add `\"@types/eslint\": \"8.4.3\"` to your package.json and do `npm install`.",
      "question_score": 33,
      "answer_score": 31,
      "created_at": "2022-06-30T21:42:23",
      "url": "https://stackoverflow.com/questions/72821229/how-should-i-resolve-this-error-that-occurs-when-using-ng-new"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 68738460,
      "title": "After Angular update npm install fails because of peer dependency conflicts",
      "problem": "I'm having trouble updating my Angular version. When I use `ng update` I get the following output:\n\n`Name                                       Version                  Command to update\n     ----------------------------------------------------------------------------------------\n      @angular/cdk                               12.1.2 -> 12.2.0         ng update @angular/cdk\n      @angular/cli                               12.1.2 -> 12.2.0         ng update @angular/cli\n      @angular/core                              12.1.2 -> 12.2.0         ng update @angular/core\n      @angular/material                          12.1.2 -> 12.2.0         ng update @angular/material\n`\nAfterwards I try to update all four of them using the command:\n`ng update @angular/cdk @angular/cli @angular/core @angular/material -C\n`\nThe `package.json` is updated and afterwards `npm i` is run in order to install all packages. Here I encounter the following error:\n`npm ERR! code ERESOLVE\nnpm ERR! ERESOLVE unable to resolve dependency tree\nnpm ERR! \nnpm ERR! Found: @angular-devkit/build-angular@12.1.2\nnpm ERR! node_modules/@angular-devkit/build-angular\nnpm ERR!   dev @angular-devkit/build-angular@\"^12.2.0\" from the root project\nnpm ERR! \nnpm ERR! Could not resolve dependency:\nnpm ERR! dev @angular-devkit/build-angular@\"^12.2.0\" from the root project\nnpm ERR! \nnpm ERR! Conflicting peer dependency: @angular/localize@12.2.0\nnpm ERR! node_modules/@angular/localize\nnpm ERR!   peerOptional @angular/localize@\"^12.0.0 || ^12.2.0-next\" from @angular-devkit/build-angular@12.2.0\nnpm ERR!   node_modules/@angular-devkit/build-angular\nnpm ERR!     dev @angular-devkit/build-angular@\"^12.2.0\" from the root project\nnpm ERR! \nnpm ERR! Fix the upstream dependency conflict, or retry\nnpm ERR! this command with --force, or --legacy-peer-deps\nnpm ERR! to accept an incorrect (and potentially broken) dependency resolution.\n`\nI do not know why it says `Found: @angular-devkit/build-angular@12.1.2` when in the `package.json` all @angular related files have `~12.2.0` declared as version.",
      "solution": "Try with deleting `node_modules` folder and `package-lock.json` file and then reinstall `npm` which might resolve your issue.\nSo, run the following commands:\n```\n`remove node_modules \nremove package-lock.json\nnpm install \n`\n```",
      "question_score": 32,
      "answer_score": 48,
      "created_at": "2021-08-11T10:24:48",
      "url": "https://stackoverflow.com/questions/68738460/after-angular-update-npm-install-fails-because-of-peer-dependency-conflicts"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 74279857,
      "title": "Failed doing npm install showing error &quot;Undefined variable standalone_static_library in binding.gyp&quot; and node-sass chokidar error",
      "problem": "I'm updating a 3 years ago ruby on rails and react project trying to npm install but im stuck here getting this error\n$ npm install\n```\n`gyp: Undefined variable standalone_static_library in binding.gyp while trying to load binding.gyp\ngyp ERR! configure error \ngyp ERR! stack Error: `gyp` failed with exit code: 1\n`\n```\n$ npm start\n```\n`sh: node-sass-chokidar: command not found\nnpm ERR! code ELIFECYCLE\nnpm ERR! syscall spawn\nnpm ERR! file sh\nnpm ERR! errno ENOENT\nnpm ERR! frontend@0.1.0 build-css: `node-sass-chokidar src/styles -o src/styles`\nnpm ERR! spawn ENOENT\nnpm ERR! \nnpm ERR! Failed at the frontend@0.1.0 build-css script.\nnpm ERR! This is probably not a problem with npm. There is likely additional logging output above.\n`\n```\nI tried removing node_modules, update node version and npm version.",
      "solution": "For me this issue happened with NodeJS 19 (specifically 19.2.0)\nRun `node --version` to get your version (or you might see the output of that command in the gyp error logs, in my case again later when I use NodeJS v20 I still have an error: `npm ERR! gyp ERR! node -v v20.10.0`)\nThe issue is fixed when I reverted to NodeJS 18; aka NodeJS LTS (at the time I wrote this answer, 12/9/2022). I used `nvm install 18` and `nvm use 18` as described here here and here)\nNodeJS LTS = Long Term Support; \"recommended for most users\". At the time I wrote this answer (12/9/2022), Node Long Term Support (LTS) is NodeJS version 18.12.1\nIt seems like this issue (`Undefined variable standalone_static_library...`) may have been introduced in NodeJS version 19 because:\n\nnode 19.0.0 has been changed to make process.config read only #43627\n\nAfter reverting, it may still be mentioned as a warning, but not an error:\n\nnpm ERR! (node:7120) [DEP0150] DeprecationWarning: Setting process.config is deprecated. In the future the property will be read-only.\n\nAnd while we're talking about versions, be careful about Python3 vs Python2!\n\nnpm ERR! gyp verb `which` failed Error: not found: python2",
      "question_score": 31,
      "answer_score": 20,
      "created_at": "2022-11-01T18:48:28",
      "url": "https://stackoverflow.com/questions/74279857/failed-doing-npm-install-showing-error-undefined-variable-standalone-static-lib"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 70397587,
      "title": "Failed to load plugin &#39;flowtype&#39; declared in &#39;package.json &#187; eslint-config-react-app&#39;: Cannot find module &#39;eslint/use-at-your-own-risk&#39;",
      "problem": "I created a new React project with `create-react-app`.\nIn the terminal `npm start`.\nInstantly get this error\n\nFailed to load plugin 'flowtype' declared in 'package.json \u00bb\neslint-config-react-app': Cannot find module\n'eslint/use-at-your-own-risk'\n\nHow do I fix this?\nNot this project specifically, but how do I get `create-react-app` to create without errors?",
      "solution": "what's happening is that when you run `npm start` it's probably doing some checks with eslint, from what I remember create-react-app has some checks that break your build if you have eslint errors so makes sense that they're associated.\nThe error you're getting here is related to a node feature that eslint is using called subpath exports but it's support is hit or miss depending on how the library is consumed. This has been highlighted to cause issues when used with jest for example.\nFor the `flowtype` eslint plugin this is the exact line of code that's causing you issues.\nYou can also read about a similar issue reported regarding the typescript eslint plugin.\n\nThe solution and the reason I'm even able to understand what's causing this problem is that I made a fix to this yesterday in a clone of the `eslint-plugin-flowtype` (given that the original plugin had a lack of maintenance) here https://github.com/flow-typed/eslint-plugin-ft-flow/pull/23.\nI'll raise an issue with create-react-app and see if they're willing to swap out the plugin with the new one which would have more maintenance and solve issues that you're experiencing.",
      "question_score": 30,
      "answer_score": 19,
      "created_at": "2021-12-17T19:45:00",
      "url": "https://stackoverflow.com/questions/70397587/failed-to-load-plugin-flowtype-declared-in-package-json-eslint-config-react"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 65722635,
      "title": "How do I avoid unused setState functions? Can React useState be created without a setter?",
      "problem": "I'm currently reducing / removing npm warnings on a React site.\nA large number of these warnings are caused by the setState function as seen below, being 'unused'.\n```\n`const [state, setState] = useState('some state');\n`\n```\nWhich of the following would be a better way to remove these warnings? Or is there a better way to approach the issue?\n1.\n```\n`const[state] = useState('some state');\n`\n```\n\n```\n`const state = 'some state';\n`\n```",
      "solution": "If `setState` isn't being used at all, then it's a value that never changes so can be a constant (2.). You could probably move it out of the component as well.",
      "question_score": 29,
      "answer_score": 35,
      "created_at": "2021-01-14T17:13:25",
      "url": "https://stackoverflow.com/questions/65722635/how-do-i-avoid-unused-setstate-functions-can-react-usestate-be-created-without"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 67087735,
      "title": "(EACCES: permission denied, mkdir &#39;/usr/app/node_modules/.cache) How can I create a docker-compose file to make node_modules a non-root folder?",
      "problem": "I'm trying to dockerize a simple create-react-app project. (Is the initial project after running `npx create-react-app test`, no files were changed).\nThe problem seems to be that in newer versions of React, they moved the annoying `.eslintcache` from the root folder to `/node_modules/.cache`, causing problems when the container is trying to run the application via `docker-compose`.\nDockerfile\n```\n`FROM node:alpine\n\nWORKDIR /usr/app\n\nCOPY package*.json ./\n\nRUN npm install\n\nRUN chown -R node.node /usr/app/node_modules\n\nCOPY . ./\n\nCMD [\"npm\", \"start\"]\n`\n```\ndocker-compose\n`version: '3'\nservices: \n  test:\n    stdin_open: true\n    build:\n      context: .\n      dockerfile: Dockerfile\n    environment:\n      - CHOKIDAR_USEPOLLING=true\n    volumes:\n      - /usr/app/node_modules\n      - .:/usr/app\n    ports:\n      - '3000:3000'\n`\nThe container is logging this error message:\n```\n`test_1   | Failed to compile.\ntest_1   | \ntest_1   | EACCES: permission denied, mkdir '/usr/app/node_modules/.cache\n`\n```\nAs you can notice, I tried to set the `node_modules` folder owner to the node user (the default user for `node:alpine`), but it is not working; exploring the container, you can see that the `node_modules` folder is still owned by `root`:\n```\n`drwxrwxr-x    5 node     node          4096 Apr 14 07:04 .\ndrwxr-xr-x    1 root     root          4096 Apr 14 07:08 ..\n-rw-rw-r--    1 node     node           310 Apr 14 06:56 .gitignore\n-rw-rw-r--    1 node     node           192 Apr 14 07:30 Dockerfile\n-rw-rw-r--    1 node     node          3369 Apr 14 06:56 README.md\ndrwxrwxr-x 1061 root     root         36864 Apr 14 07:12 node_modules\n-rw-rw-r--    1 node     node        692936 Apr 14 06:56 package-lock.json\n-rw-rw-r--    1 node     node           808 Apr 14 06:56 package.json\ndrwxrwxr-x    2 node     node          4096 Apr 14 06:56 public\ndrwxrwxr-x    2 node     node          4096 Apr 14 06:56 src\n`\n```\nI also tried to create the folder `RUN mkdir -p /usr/app` and use `USER node` but that end up in an issue where npm wasn't able to create the `node_modules` folder.\nIs there any workaround where either `.eslintcache` is disabled or `node_modules` is owned by the `node` user?\nUpdate\nApparently, this is occurring because I'm using Ubuntu and docker mounts volumes as root on Linux systems.",
      "solution": "Adding this line just after `RUN npm install` in your Dockerfile would solve the issue:\n```\n`RUN mkdir -p node_modules/.cache && chmod -R 777 node_modules/.cache\n`\n```\nFinal Dockerfile\n```\n`FROM node:alpine\n\nWORKDIR /usr/app\n\nCOPY package.json .\nRUN npm install\n\nRUN mkdir node_modules/.cache && chmod -R 777 node_modules/.cache\n\nCOPY . .\n\nCMD [\"npm\", \"run\", \"start\"]\n`\n```\nThen you don't need to copy the `node_modules` folder from your local dir to the container. You can safely bookmark it.",
      "question_score": 28,
      "answer_score": 50,
      "created_at": "2021-04-14T09:59:47",
      "url": "https://stackoverflow.com/questions/67087735/eacces-permission-denied-mkdir-usr-app-node-modules-cache-how-can-i-creat"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 74679689,
      "title": "Unsupported URL Type &quot;link:&quot; while using NPM",
      "problem": "Following some guidance on the net, I edited my `package.json` to include a `link` URL:\n```\n`...\n\"dependencies\": {\n  ...\n  \"react\": \"link:../some-other-module/node_modules/react\",\n}\n`\n```\nBut when installing, I get the following error:\n```\n`$ npm install\nnpm ERR! code EUNSUPPORTEDPROTOCOL\nnpm ERR! Unsupported URL Type \"link:\": link:../some-other-module/node_modules/react\n`\n```",
      "solution": "This is because `link` has been replaced with `file` in recent versions of NPM. Simply update your `package.json`:\n```\n`...\n\"dependencies\": {\n  ...\n  \"react\": \"file:../some-other-module/node_modules/react\",\n}\n`\n```",
      "question_score": 28,
      "answer_score": 43,
      "created_at": "2022-12-04T19:28:28",
      "url": "https://stackoverflow.com/questions/74679689/unsupported-url-type-link-while-using-npm"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 71582397,
      "title": "ERESOLVE unable to resolve dependency tree while installing a pacakge",
      "problem": "While installing the dependencies for my project using `npm install`, I receive the following error that I don't know how to interpret:\n```\n`npm ERR! code ERESOLVE\nnpm ERR! ERESOLVE unable to resolve dependency tree\nnpm ERR! \nnpm ERR! While resolving: soft-ui-dashboard-pro-react@3.1.0\nnpm ERR! Found: react@17.0.2\nnpm ERR! node_modules/react\nnpm ERR!   react@\"17.0.2\" from the root project\nnpm ERR! \nnpm ERR! Could not resolve dependency:\nnpm ERR! peer react@\"^0.14.9 || ^15.3.0 || ^16.0.0\" from react-quill@1.3.5\nnpm ERR! node_modules/react-quill\nnpm ERR!   react-quill@\"1.3.5\" from the root project\nnpm ERR! \nnpm ERR! Fix the upstream dependency conflict, or retry\nnpm ERR! this command with --force, or --legacy-peer-deps\nnpm ERR! to accept an incorrect (and potentially broken) dependency resolution.\nnpm ERR! \nnpm ERR! See /Users/amin/.npm/eresolve-report.txt for a full report.\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     /Users/amin/.npm/_logs/2022-03-23T05_47_43_419Z-debug-0.log\n`\n```\nThese are the dependencies in `package.json`:\n```\n`  \"dependencies\": {\n    \"@asseinfo/react-kanban\": \"2.2.0\",\n    \"@emotion/cache\": \"11.7.1\",\n    \"@emotion/react\": \"11.8.1\",\n    \"@emotion/styled\": \"11.8.1\",\n    \"@fullcalendar/daygrid\": \"5.10.1\",\n    \"@fullcalendar/interaction\": \"5.10.1\",\n    \"@fullcalendar/react\": \"5.10.1\",\n    \"@fullcalendar/timegrid\": \"5.10.1\",\n    \"@mui/icons-material\": \"5.4.2\",\n    \"@mui/material\": \"5.4.3\",\n    \"@mui/styled-engine\": \"5.4.2\",\n    \"@pathofdev/react-tag-input\": \"1.0.7\",\n    \"@react-leaflet/core\": \"1.1.1\",\n    \"@testing-library/jest-dom\": \"5.16.2\",\n    \"@testing-library/react\": \"12.1.3\",\n    \"@testing-library/user-event\": \"13.5.0\",\n    \"@three-ts/orbit-controls\": \"1.4.7\",\n    \"chart.js\": \"3.4.1\",\n    \"chroma-js\": \"2.4.2\",\n    \"dropzone\": \"5.9.3\",\n    \"flatpickr\": \"4.6.9\",\n    \"formik\": \"2.2.9\",\n    \"html-react-parser\": \"1.4.8\",\n    \"leaflet\": \"1.7.1\",\n    \"prop-types\": \"15.8.1\",\n    \"react\": \"17.0.2\",\n    \"react-chartjs-2\": \"3.0.4\",\n    \"react-circular-slider-svg\": \"0.1.5\",\n    \"react-countup\": \"6.1.1\",\n    \"react-dom\": \"17.0.2\",\n    \"react-flatpickr\": \"3.10.7\",\n    \"react-github-btn\": \"1.2.1\",\n    \"react-images-viewer\": \"1.7.1\",\n    \"react-leaflet\": \"3.2.5\",\n    \"react-quill\": \"1.3.5\",\n    \"react-router-dom\": \"6.2.1\",\n    \"react-scripts\": \"5.0.0\",\n    \"react-select\": \"5.2.2\",\n    \"react-table\": \"7.7.0\",\n    \"stylis\": \"4.0.13\",\n    \"stylis-plugin-rtl\": \"2.1.1\",\n    \"sweetalert2\": \"11.4.4\",\n    \"three\": \"0.121.1\",\n    \"uuid\": \"8.3.2\",\n    \"vanilla-tilt\": \"1.7.2\",\n    \"web-vitals\": \"2.1.4\",\n    \"yup\": \"0.32.11\"\n  },\n`\n```",
      "solution": "It means you have dependency conflicts. So try running the following options one by one.\n1. Remove `node_modules` and `package-lock.json` and then run\n```\n` npm install\n`\n```\n2. Or try clearing out npm cache\n```\n`npm cache clean --force\n`\n```\n3. Or run command with --legacy-peer-deps option\n```\n`npm install --legacy-peer-deps\n`\n```\n4. Or run command with --force option\n```\n`npm install --force\n`\n```",
      "question_score": 27,
      "answer_score": 39,
      "created_at": "2022-03-23T06:53:09",
      "url": "https://stackoverflow.com/questions/71582397/eresolve-unable-to-resolve-dependency-tree-while-installing-a-pacakge"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 72396236,
      "title": "Error URI malformed when running react application on mac",
      "problem": "I am trying to run React app locally.\nWhen running `npm run dev` I get error\n```\n` vite v2.6.14 dev server running at:\n\n  > Local: http://localhost:3000/\n  > Network: use `--host` to expose\n\n  ready in 182ms.\n\n/Users/markoz/Work/Razvoj/Graphs/kenstack-designer/kenstack-designer/node_modules/vite/dist/node/chunks/dep-e0fe87f8.js:56882\n        let url = decodeURI(removeTimestampQuery(req.url)).replace(NULL_BYTE_PLACEHOLDER, '\\0');\n                  ^\n\nURIError: URI malformed\n    at decodeURI ()\n    at viteTransformMiddleware (/Users/markoz/Work/Razvoj/Graphs/kenstack-designer/kenstack-designer/node_modules/vite/dist/node/chunks/dep-e0fe87f8.js:56882:19)\n    at call (/Users/markoz/Work/Razvoj/Graphs/kenstack-designer/kenstack-designer/node_modules/vite/dist/node/chunks/dep-e0fe87f8.js:45568:7)\n    at next (/Users/markoz/Work/Razvoj/Graphs/kenstack-designer/kenstack-designer/node_modules/vite/dist/node/chunks/dep-e0fe87f8.js:45512:5)\n    at /Users/markoz/Work/Razvoj/Graphs/kenstack-designer/kenstack-designer/node_modules/vite/dist/node/chunks/dep-e0fe87f8.js:56525:28\n    at viteServePublicMiddleware (/Users/markoz/Work/Razvoj/Graphs/kenstack-designer/kenstack-designer/node_modules/vite/dist/node/chunks/dep-e0fe87f8.js:56564:9)\n    at call (/Users/markoz/Work/Razvoj/Graphs/kenstack-designer/kenstack-designer/node_modules/vite/dist/node/chunks/dep-e0fe87f8.js:45568:7)\n    at next (/Users/markoz/Work/Razvoj/Graphs/kenstack-designer/kenstack-designer/node_modules/vite/dist/node/chunks/dep-e0fe87f8.js:45512:5)\n    at next (/Users/markoz/Work/Razvoj/Graphs/kenstack-designer/kenstack-designer/node_modules/vite/dist/node/chunks/dep-e0fe87f8.js:45490:14)\n    at next (/Users/markoz/Work/Razvoj/Graphs/kenstack-designer/kenstack-designer/node_modules/vite/dist/node/chunks/dep-e0fe87f8.js:45490:14)\n\nNode.js v17.4.0\n`\n```\nI don't have `.npmrc` on my system folder, but I have one inside the project.\nHow can I fix the issue?",
      "solution": "remove \"%PUBLIC_URL%\" in \"public/index.html\".\nhttps://github.com/vitejs/vite/issues/6482",
      "question_score": 27,
      "answer_score": 63,
      "created_at": "2022-05-26T20:09:25",
      "url": "https://stackoverflow.com/questions/72396236/error-uri-malformed-when-running-react-application-on-mac"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 66496166,
      "title": "Is there any Yarn equivalent of npx preact create?",
      "problem": "I am trying to run the `preact create` command using Yarn. It's simple to run `preact create ..... .....` or `npx preact create ... ....`. It works fine and both of the commands use npm. But I am trying to run the command using Yarn. I have tried the following commands but nothing works. The error says \"couldn't find a package.json file in path\".\n`yarn preact create .... ....`\n`yarn dlx preact create .... ....`\n`yarn preact-cli create .... ....`\n`yarn dlx preact-cli create .... ....`\nSo, what should I do to run the command using Yarn. One alternative maybe is running the command using npm and then running yarn install and then running npm uninstall. But what's the actual way?",
      "solution": "There is no Yarn equivalent for `npx`. The Yarn team thought `npx` was enough.\nThat being said, we support creating a new Preact CLI project with Yarn through the `--yarn` flag.\n```\n`npx preact-cli create ... --yarn\n`\n```\nhttps://github.com/preactjs/preact-cli#cli-options\nPlease do note that when using Preact CLI via NPX, you do need to use `preact-cli`. `npx preact` gives you the Preact library.",
      "question_score": 27,
      "answer_score": 27,
      "created_at": "2021-03-05T17:29:39",
      "url": "https://stackoverflow.com/questions/66496166/is-there-any-yarn-equivalent-of-npx-preact-create"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 74522956,
      "title": "python is not a valid npm option",
      "problem": "I am trying to set an older version of python in order to install modules and build an old node project.\nI run this command:\n```\n`npm config set python=python2.7\n`\n```\nOR\n```\n`npm config set python C:\\Python27\\python.exe\n`\n```\nIn both cases I am getting this error:\n```\n`npm ERR! `python` is not a valid npm option \n`\n```\nNove v16.14.2\nNpm v9.1.2",
      "solution": "Consider downgrading npm to v8 for now:\n`npm install -g npm@^8\n`\nAlternatively, just run:\n`npm config edit\n`\nand add:\n```\n`python=C:\\Python27\\python.exe\n`\n```\nin a new line.",
      "question_score": 27,
      "answer_score": 42,
      "created_at": "2022-11-21T18:47:39",
      "url": "https://stackoverflow.com/questions/74522956/python-is-not-a-valid-npm-option"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 67389705,
      "title": "What Is The D\u0131fference Between npm node-sass and npm sass",
      "problem": "I've just learn I should use `@use` instead of `@import` in `sass`. But as I understood, I should use `npm sass` instead of `npm node-sass` to do that. What is the difference between these two ? Why `@use` and `@forward` doesn't work on `node-sass`",
      "solution": "Popularity\nBlue line is `node-sass`, orange is `sass` popularity.\n\nThe `sass` readme explains some of the differences:\n\nDart Sass, from which this package is compiled, can be used either as a stand-alone executable or as a Dart library. Running Dart Sass on the Dart VM is substantially faster than running the pure JavaScript version, so this may be appropriate for performance-sensitive applications. The Dart API is also (currently) more user-friendly than the JavaScript API. See the Dart Sass README for details on how to use it.\nNode Sass, which is a wrapper around LibSass, the C++ implementation of Sass. Node Sass supports the same API as this package and is also faster (although it's usually a little slower than Dart Sass). However, it requires a native library which may be difficult to install, and it's generally slower to add features and fix bugs.\n\nPerformance\nThere are performance differences which are covered in answer, which compares the differences compiling Bootstrap 4:\n\nIn this particular case, two seconds is not a big deal; but consider Dart-Sass(JS) is nine times slower than Dart-Sass(Dart VM) and three times slower than node-sass.\n\nThis article has more details about this benchmark.\nMaintenance\n`node-sass` is considered deprecated, but you can see frequent updates are happening for both packages.\nWhy @use and @forward doesn't work on node-sass\nBecause `node-sass` uses LibSass which is implemented in C and does not receive updates as frequently as the Dart implementation.",
      "question_score": 25,
      "answer_score": 25,
      "created_at": "2021-05-04T19:46:40",
      "url": "https://stackoverflow.com/questions/67389705/what-is-the-d%c4%b1fference-between-npm-node-sass-and-npm-sass"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 71293685,
      "title": "npm workspaces &quot;WARN: some-package-name in filter set, but no workspace folder present&quot;",
      "problem": "I have a repo with many npm packages inside, using npm workspaces\nThe top-level `package.json` contains the line:\n```\n`  \"workspaces\": [\n    \"*\"\n  ]\n`\n```\nWhen I run `npm i -ws` or other npm commands, I receive the warning:\n```\n`WARN: some-package-name in filter set, but no workspace folder present\n`\n```\nI'm not quite sure what the message means - I think the 'filter set' is the `-w` option, but the workspace folder `some-package-name` definitely exists.\nOne note is that the `some-package-name/package.json` contains an org prefix, eg:\n```\n`\"name\": \"@mycompany/some-package-name\",\n`\n```\nSo maybe that's the cause. I can't rename the folder from `some-package-name` to `@mycompany/some-package-name` though as I'm concerned a directory starting with `@` may break things.\nWhat does the warning mean and how can I resolve it?",
      "solution": "I ran into the same problem, using the name configured in the workspace's package instead of the folder name fixed the issue for me, even with an `@`.\n`npm install --workspace=@mycompany/some-package-name`\nThe issue may appear for the package in question `package.json` and `package-lock.json` `name` fields do not match the workspace folder naming and package name and / or each other.\nThe command updated both `name` fields so that the warning is gone.",
      "question_score": 25,
      "answer_score": 8,
      "created_at": "2022-02-28T11:35:44",
      "url": "https://stackoverflow.com/questions/71293685/npm-workspaces-warn-some-package-name-in-filter-set-but-no-workspace-folder-p"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 67560211,
      "title": "MAC M1 Something went wrong installing the &quot;sharp&quot; module",
      "problem": "Running `npm run dev` (`gatsby develop`) on MacBook Pro M1 chip exit with `  Error: Something went wrong installing the \"sharp\" module`\nRunning `npm run dev`  MacBook Pro intel chip works fine.\nI've seen similar post which did not solved my problem :\n\nWhen i run \"gatsby develop \" Something went wrong installing the \"sharp\" module error is showing\nError Installing Gatsby Starter 'Something went wrong installing the \"sharp\" module'\nGatsby Develop : Something went wrong installing the \"sharp\" module\n\nI've update my node version in case any fixes had been made but I still got the error on `node v16.0.0`\nOn this github issue they recommend to follow theses steps which did not work.\n\n```\n`rm -r node_modules/sharp\nyarn install --check-files\n`\n```\n\nOn this github issue they recommend to install `NVM` and downgrade node version. NVM has some difficulties to install on my M1 chip so it is not a good option for me.\nI have also tried to do the following steps which did not work as well\n```\n`rm -rf node_module\nrm package-lock.json\nnpm i \n`\n```\nAny idea what can I do to fix `gatsby develop` on M1 chip ?",
      "solution": "Following these steps from this discussion solved my problem.\n\n`xcode-select --install`\n`brew install gcc`\n`brew reinstall vips`\n`brew info vips`\n`npm i`\n\nThen you can run `gatsby develop`",
      "question_score": 24,
      "answer_score": 40,
      "created_at": "2021-05-16T20:28:15",
      "url": "https://stackoverflow.com/questions/67560211/mac-m1-something-went-wrong-installing-the-sharp-module"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 78979789,
      "title": "Tailwind error when installing shadcn in Vite React App",
      "problem": "I was setting up shadcn in a React App using Vite by using the following command:\n`npx shadcn@latest init`\nand I received an error (please see error below). I had installed tailwind and did setup as mentioned on official website.\n`npm install -D tailwindcss postcss autoprefixer`\n`npx tailwindcss init -p`\nError:\n\nNo Tailwind CSS configuration found at\n/Users/mubashirahmed/Code/shadcn-project.\nIt is likely you do not have\nTailwind CSS installed or have an invalid configuration.\nInstall\nTailwind CSS then try again. \nVisit https://tailwindcss.com/docs/guides/vite to get started.\n\nWhat could be the possible reason for that?",
      "solution": "So after some search, I found a fix (from GitHub issues of repo) and the fix is quite simple you just have to add tailwind headers to index.css (global css file) of your project.\n```\n`@tailwind base;\n@tailwind components;\n@tailwind utilities;\n`\n```\nYou can see other discussion here as well: https://github.com/shadcn-ui/ui/issues/4677",
      "question_score": 24,
      "answer_score": 56,
      "created_at": "2024-09-12T21:59:33",
      "url": "https://stackoverflow.com/questions/78979789/tailwind-error-when-installing-shadcn-in-vite-react-app"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 66586352,
      "title": "ReferenceError: globalThis is not defined",
      "problem": "I have installed the npm module aws-amplify/cli globally by using the following code:\n```\n`npm install -g @aws-amplify/cli\n`\n```\nThis worked, but when trying to initialise my environment using the amplify cli, it gives me the following error:\n```\n`/usr/local/lib/node_modules/@aws-amplify/cli/node_modules/queue-microtask/index.js:1\nReferenceError: globalThis is not defined\n    at Object. (/usr/local/lib/node_modules/@aws-amplify/cli/node_modules/queue-microtask/index.js:5:25)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object. (/usr/local/lib/node_modules/@aws-amplify/cli/node_modules/run-parallel/index.js:4:24)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object. (/usr/local/lib/node_modules/@aws-amplify/cli/node_modules/@nodelib/fs.scandir/out/providers/async.js:5:13)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object. (/usr/local/lib/node_modules/@aws-amplify/cli/node_modules/@nodelib/fs.scandir/out/index.js:4:15)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object. (/usr/local/lib/node_modules/@aws-amplify/cli/node_modules/@nodelib/fs.walk/out/readers/async.js:4:19)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object. (/usr/local/lib/node_modules/@aws-amplify/cli/node_modules/@nodelib/fs.walk/out/providers/async.js:3:17)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object. (/usr/local/lib/node_modules/@aws-amplify/cli/node_modules/@nodelib/fs.walk/out/index.js:4:17)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object. (/usr/local/lib/node_modules/@aws-amplify/cli/node_modules/fast-glob/out/readers/stream.js:5:16)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object. (/usr/local/lib/node_modules/@aws-amplify/cli/node_modules/fast-glob/out/providers/async.js:3:18)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object. (/usr/local/lib/node_modules/@aws-amplify/cli/node_modules/fast-glob/out/index.js:3:17)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object. (/usr/local/lib/node_modules/@aws-amplify/cli/node_modules/globby/index.js:5:18)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object. (/usr/local/lib/node_modules/@aws-amplify/cli/node_modules/amplify-category-function/lib/provider-utils/awscloudformation/utils/packageLayer.js:21:34)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object. (/usr/local/lib/node_modules/@aws-amplify/cli/node_modules/amplify-category-function/lib/provider-utils/awscloudformation/utils/layerParams.js:13:24)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object. (/usr/local/lib/node_modules/@aws-amplify/cli/node_modules/amplify-category-function/lib/provider-utils/awscloudformation/index.js:7:23)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object. (/usr/local/lib/node_modules/@aws-amplify/cli/node_modules/amplify-category-function/lib/index.js:13:29)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at Object. (/usr/local/lib/node_modules/@aws-amplify/cli/lib/extensions/amplify-helpers/update-amplify-meta.js:34:37)\n    at Generator.next ()\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:732:10)\n    at AmplifyToolkit.get updateamplifyMetaAfterResourceAdd [as updateamplifyMetaAfterResourceAdd] (/usr/local/lib/node_modules/@aws-amplify/cli/lib/domain/amplify-toolkit.js:229:17)\n    at /usr/local/lib/node_modules/@aws-amplify/cli/node_modules/amplify-category-auth/lib/provider-utils/awscloudformation/utils/amplify-meta-updaters.js:48:21\n    at processTicksAndRejections (internal/process/next_tick.js:81:5)\n`\n```\nHow can I fix this?",
      "solution": "Consider updating your version of node.js to `>=12`.\n`globalThis` was added in node.js v12.0.0 according to this compatibility table.\nNote: Also refer to issue #17 in the GitHub repo for `queue-microtask` where this issue has been reported.",
      "question_score": 24,
      "answer_score": 45,
      "created_at": "2021-03-11T17:17:08",
      "url": "https://stackoverflow.com/questions/66586352/referenceerror-globalthis-is-not-defined"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 65653417,
      "title": "internal/modules/cjs/loader.js:883 throw err",
      "problem": "I've ran into an issue running `npm start` (I've attached the screenshot of the error bellow) on my Angular project.\nWhen I run the project using `ng serve`, everything is working fine.\nI have tried several ways to fix this issue without success.\n\nThis is my `package.json` file:\n`{\n  \"name\": \"myapplication\",\n  \"version\": \"0.0.0\",\n  \"scripts\": {\n    \"ng\": \"ng\",\n    \"start\": \"ng serve\",\n    \"build\": \"ng build\",\n    \"test\": \"ng test\",\n    \"lint\": \"ng lint\",\n    \"e2e\": \"ng e2e\"\n  },\n  \"private\": true,\n  \"dependencies\": {\n    \"@angular/animations\": \"~11.0.6\",\n    \"@angular/common\": \"~11.0.6\",\n    \"@angular/compiler\": \"~11.0.6\",\n    \"@angular/core\": \"~11.0.6\",\n    \"@angular/forms\": \"~11.0.6\",\n    \"@angular/platform-browser\": \"~11.0.6\",\n    \"@angular/platform-browser-dynamic\": \"~11.0.6\",\n    \"@angular/router\": \"~11.0.6\",\n    \"rxjs\": \"~6.6.0\",\n    \"tslib\": \"^2.0.0\",\n    \"zone.js\": \"~0.10.2\"\n  },\n  \"devDependencies\": {\n    \"@angular-devkit/build-angular\": \"~0.1100.6\",\n    \"@angular/cli\": \"~11.0.6\",\n    \"@angular/compiler-cli\": \"~11.0.6\",\n    \"@types/jasmine\": \"~3.6.0\",\n    \"@types/node\": \"^12.11.1\",\n    \"codelyzer\": \"^6.0.0\",\n    \"jasmine-core\": \"~3.6.0\",\n    \"jasmine-spec-reporter\": \"~5.0.0\",\n    \"karma\": \"~5.1.0\",\n    \"karma-chrome-launcher\": \"~3.1.0\",\n    \"karma-coverage\": \"~2.0.3\",\n    \"karma-jasmine\": \"~4.0.0\",\n    \"karma-jasmine-html-reporter\": \"^1.5.0\",\n    \"protractor\": \"~7.0.0\",\n    \"ts-node\": \"~8.3.0\",\n    \"tslint\": \"~6.1.0\",\n    \"typescript\": \"~4.0.2\"\n  }\n}\n`",
      "solution": "After spending a lot of time on the issue, I finally found the solution.\nI've uninstalled \"NodeJs\" completely, deleted \"NPM\" & \"NPM-Cache\" from:\n`C:\\Users\\username\\AppData\\Roaming\n`\nand restarted the PC. Then I've re-installed everything.\n\nIf the issue remains, check your folder names.\nIn my case, the Angular project was inside a folder named \"Research & Development\":\n`C:\\Users\\Asus\\Documents\\Research & Development\\Video conference project\\myapplication\n`\nI have removed the special character \"&\" and renamed the folder to \"Research-Development\"\nAfter the rename, `npm start` executed without errors.",
      "question_score": 24,
      "answer_score": 9,
      "created_at": "2021-01-10T13:44:36",
      "url": "https://stackoverflow.com/questions/65653417/internal-modules-cjs-loader-js883-throw-err"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 72776325,
      "title": "npm Warning: config production; Use --omit=dev Instead",
      "problem": "Every time I run any kind of npm command, I get the following error before the actual output:\n```\n`npm WARN config production Use `--omit=dev` instead.\n`\n```\nOf course I've come across similar issues regarding the `-g` flag, and I updated npm to avoid that problem. Some of the workarounds describe editing the `npm` and `npm.cmd` in the program files for node to remove these flags, but for this error in particular, the word `production` occurs nowhere in those configuration files. Unhelpfully, npm's warnings don't include a reference to the file that contains this irksome configuration setting.\nCan anyone offer advice on where to search for this configuration, or at least how to silence this redundant warning message?",
      "solution": "And of course, as soon as I ask, I find an answer somewhere else:\nI created an error log because of a different npm crash, and when I search the log, I found the config file that was causing the error:\n```\n`C:\\Users\\Chris\\AppData\\Roaming\\npm\\etc\\npmrc\n`\n```\nSure enough, I open the file, find `production=false`, delete the necessary line, and now the error has disappeared.",
      "question_score": 24,
      "answer_score": 7,
      "created_at": "2022-06-27T19:44:02",
      "url": "https://stackoverflow.com/questions/72776325/npm-warning-config-production-use-omit-dev-instead"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 78795659,
      "title": "How to disable auto-setting of `packageManager` when corepack is enabled",
      "problem": "In Node.js, when `corepack` is enabled, any `yarn`, `pnpm` or `npm` command will auto-set `packageManager` field in `package.json`.\nThis is a breaking change for some projects, since having `packageManager` means you can't use one packager for the install (`npm i`) and another packager for running scripts (`yarn start`). It would output the following error:\n```\n`UsageError: This project is configured to use npm because ./package.json has a \"packageManager\" field\n`\n```\nHow to disable this behaviour? I'd like to keep using corepack, since it's nice, but I'd prefer to avoid setting a particular `packageManager` in my `package.json`.\nCheers.",
      "solution": "You can set the environment variable `COREPACK_ENABLE_AUTO_PIN` to `0` in order to disable this behavior (from corepack readme).",
      "question_score": 23,
      "answer_score": 34,
      "created_at": "2024-07-26T00:45:04",
      "url": "https://stackoverflow.com/questions/78795659/how-to-disable-auto-setting-of-packagemanager-when-corepack-is-enabled"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 65945592,
      "title": "`npm publish` and `npm install` fail depending on `.npmrc` syntax used",
      "problem": "Current Behavior:\nI am attempting to configure a project to install dependencies from NPM. I will be publishing the project to GitHub Packages as a private package. If I use this syntax in my project's `.npmrc`:\n```\n`@my-org:registry=https://npm.pkg.github.com/\n`\n```\nI can install dependencies from NPM using `npm install` on my local machine. However, I cannot publish to GitHub Packages using `npm publish`. NPM informs me that I'm not authenticated. If I use this syntax in my project's `.npmrc`:\n```\n`registry=https://npm.pkg.github.com/my-org/\n`\n```\nI can publish using `npm publish`, but I cannot install dependencies with `npm install`. NPM informs me that it's trying to install dependencies from GitHub Packages, rather than NPM.\nExpected Behavior:\nBased on my reading, both syntaxes should be compatible with `npm install` and `npm publish`. However, it appears I can only use one or the other, based on my intended use.\nSteps To Reproduce:\n\nInstall Node `v15.7.0` and NPM `7.4.3` via nvm.\n\nLog in to GitHub Packages with the command:\n`npm login --scope=@my-org --registry=https://npm.pkg.github.com\n`\n\nCheck our `~/.npmrc` file in our home folder. It should read:\n```\n`@my-org:registry=https://npm.pkg.github.com/\n//npm.pkg.github.com/:_authToken=\n`\n```\n\nCreate project with the following `package.json`:\n`{\n  \"name\": \"@my-org/my-package\",\n  \"description\": \"A test.\",\n  \"version\": \"1.0.0\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"https://github.com/my-org/my-package.git\"\n  },\n  \"keywords\": [\"example\"],\n  \"author\": \"Me\",\n  \"license\": \"ISC\",\n  \"bugs\": {\n    \"url\": \"https://github.com/my-org/my-package/issues\"\n  },\n  \"homepage\": \"https://github.com/my-org/my-package\",\n  \"dependencies\": {\n    \"bootstrap\": \"^4.5.2\"\n  }\n}\n`\n\nAdd the following `.npmrc` to our project:\n```\n`@my-org:registry=https://npm.pkg.github.com/\n`\n```\n\nRun `npm install`. Installation should succeed.\n\nRun `npm publish`. Receive the following error:\n`npm ERR! code ENEEDAUTH\nnpm ERR! need auth This command requires you to be logged in.\nnpm ERR! need auth You need to authorize this machine using `npm adduser`\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     /Users/my-user/.npm/_logs/2021-01-28T20_19_55_974Z-debug.log\n`\n\nChange the project `.npmrc` to:\n```\n`registry=https://npm.pkg.github.com/my-org/\n`\n```\n\nRun `npm publish`. Publishing should succeed.\n\n`rm -rf node_modules/ package-lock.json` in project.\n\nRun `npm install`. Receive following error:\n```\n`npm ERR! code E401\nnpm ERR! Incorrect or missing password.\nnpm ERR! If you were trying to login, change your password, create an\nnpm ERR! authentication token or enable two-factor authentication then\nnpm ERR! that means you likely typed your password in incorrectly.\nnpm ERR! Please try again, or recover your password at:\nnpm ERR!     https://www.npmjs.com/forgot\nnpm ERR!\nnpm ERR! If you were doing some other operation then your saved credentials are\nnpm ERR! probably out of date. To correct this please try logging in again with:\nnpm ERR!     npm login\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     /Users/my-user/.npm/_logs/2021-01-28T20_38_20_711Z-debug.log\n`\n```\n\nEnvironment:\n\nOS:\n\nMacOS Catalina 10.15.7\nMacOS Big Sur 11.1\n\nNode: 15.7.0\nnpm: 7.4.3\n\nThings I've tried\nUsing `publishConfig`\nUnfortunately, `publishConfig` doesn't fix the issue. It also doesn't address that the two `.npmrc` syntaxes produce different results.\nProject `.npmrc` `authToken`\nNPM's documentation states there is no need to include the `authToken` in the project `.npmrc`. Authenticating with `npm login` and storing the `authToken` in the global `~/.npmrc` should be sufficient.\nWorkaround\nUsing the `--registry` command line flag\nI've found a workaround until the NPM bug affecting this issue is resolved. When using the following project `.npmrc` syntax:\n```\n`@my-org:registry=https://npm.pkg.github.com/\n`\n```\nIf I run `npm publish --registry=https://npm.pkg.github.com/`, I can publish successfully. In addition, I can install dependencies without issue.",
      "solution": "Update (May 30, 2021)\nThis has been fixed in NPM `7.5.3` and above.\nOriginal answer (April 20, 2021)\nThis has been confirmed as a bug on NPM `7.x`. The team is currently working to fix the bug with their GitHub Pull Request #2602. Until this bug fix has been released, the best recommendation is to do one of the workarounds listed below.\nWorkaround 1: `--registry` command line flag\nWhen running `npm publish`, add the `--registry` flag. This flag enables developers to specify the registry they're aiming to publish to, overriding `.npmrc` or `package.json` configurations. For the example listed in my question, the project `.npmrc` should contain:\n```\n`@my-org:registry=https://npm.pkg.github.com/\n`\n```\nPublishing will succeed when initiated by running:\n`npm publish --registry=https://npm.pkg.github.com/\n`\nWorkaround 2: Dummy token for default registry\nAccording to npm developer wraithgar's comment on this bug's GitHub issue, you can use a dummy token for the default NPM registry to workaround this issue. In our project's `.npmrc`, add the following line:\n```\n`//registry.npmjs.org/:_authToken=dummy\n`\n```\nThe full project `.npmrc` should contain:\n```\n`//registry.npmjs.org/:_authToken=dummy\n@my-org:registry=https://npm.pkg.github.com/\n`\n```\nIn the question, neither of the project `.npmrc` syntax's we've tried to use has designated a registry, because NPM's documentation states we don't have to. The documentation states that it'll check our global `~/.npmrc` if there isn't one in our project `.npmrc`. The bug in NPM is causing NPM to check if a project `.npmrc` has designated a registry before it'll attempt to authenticate. In wraithgar's own words:\n\nWhat happens is that currently the cli is only looking for your configured \"registry\" setting when seeing if you have logged in. So the temporary solution is either to override that setting (as you were doing by passing --registry), OR to add a token for the default (npm) registry so that the check for a token does not fail. The check is only looking for the presence of a token in the config, it's not validating it (that of course will happen when and if it is used during an actual request), so putting a dummy value in will stop the error until that PR lands.\n\nAfter adding the dummy token, running `npm publish` and `npm install` should both succeed.",
      "question_score": 23,
      "answer_score": 15,
      "created_at": "2021-01-28T22:37:45",
      "url": "https://stackoverflow.com/questions/65945592/npm-publish-and-npm-install-fail-depending-on-npmrc-syntax-used"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 75748298,
      "title": "Module not found: Can&#39;t resolve &#39;encoding&#39; in &#39;/vercel/path0/node_modules/cross-fetch/node_modules/node-fetch/lib&#39;",
      "problem": "Has anyone come across this non-breaking warning issue that you get with the npm package: @supabase/supabase-js\n```\n`The warning message:\n\nwarn  - ./node_modules/cross-fetch/node_modules/node-fetch/lib/index.js\nModule not found: Can't resolve 'encoding' in '/Users/maxsilva/Sites/kamapay/sasa-frontend/node_modules/cross-fetch/node_modules/node-fetch/lib'\n\nImport trace for requested module:\n./node_modules/cross-fetch/node_modules/node-fetch/lib/index.js\n./node_modules/cross-fetch/dist/node-ponyfill.js\n./node_modules/@supabase/supabase-js/dist/main/lib/fetch.js\n./node_modules/@supabase/supabase-js/dist/main/SupabaseClient.js\n./node_modules/@supabase/supabase-js/dist/main/index.js\n./lib/supabaseClient.js\n./app/[lng]/page.jsx\n`\n```",
      "solution": "As stated in the comment, you'll need to run this:\nVanilla NPM:\n```\n`npm add -D encoding\n`\n```\nPNPM:\n```\n`pnpm add -D encoding \n`\n```",
      "question_score": 22,
      "answer_score": 33,
      "created_at": "2023-03-15T18:39:54",
      "url": "https://stackoverflow.com/questions/75748298/module-not-found-cant-resolve-encoding-in-vercel-path0-node-modules-cross"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 70546696,
      "title": "Getting error npm ERR! code EUNSUPPORTEDPROTOCOL while running npm install",
      "problem": "While installing `npm install` am getting below error. Following are my node version.\nOS : MacOS Big Sur V11.6.2\n```\n`Macs-MacBook-Pro-3:slides mac$ node -v\nv16.13.1\nMacs-MacBook-Pro-3:slides mac$ npm -v\n8.3.0\n`\n```\n```\n`npm ERR! code EUNSUPPORTEDPROTOCOL\nnpm ERR! Unsupported URL Type \"workspace:\": workspace:*\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     /Users/mac/.npm/_logs/2022-01-01T02_28_04_430Z-debug-0.log\n`\n```\nAny help here ?",
      "solution": "You can resolve this error instead of mentioning as `workspace:*` replace it with `file:*`. It helps me to resolve this issue.",
      "question_score": 22,
      "answer_score": 21,
      "created_at": "2022-01-01T03:31:19",
      "url": "https://stackoverflow.com/questions/70546696/getting-error-npm-err-code-eunsupportedprotocol-while-running-npm-install"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 67233983,
      "title": "Cannot create a React app with create-react-app",
      "problem": "I am facing a problem with creating a new React app using CRA when I run the following command `npx create-react-app my-app`. \n\nI tried to clear npm cache with this command `npm cache clean --force`\nI also tried this command `npm -g uninstall create-react-app `\n\nMy node version is `v14.15.3` and the npm version is `7.10.0` \nThe error which I get is :\n`Need to install the following packages:\n  create-react-app\nOk to proceed? (y)\n`",
      "solution": "Options 1 \nSwitch to yarn instead of npm\n```\n`npm i -g yarn\nyarn create react-app\n`\n```\n\nOptions 2 \nUninstal Node completely and re-instal it again\nOption 3  \nUse nvm (Node Version Manager)",
      "question_score": 21,
      "answer_score": 1,
      "created_at": "2021-04-23T18:49:58",
      "url": "https://stackoverflow.com/questions/67233983/cannot-create-a-react-app-with-create-react-app"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 67087634,
      "title": "Parcel JS: tree.render is not a function",
      "problem": "Whenever I try to run production build command `npm run build` or `npx parcel build index.html`, I get this error. I have a simple html and css project, no react, no 3rd party library Why could this be happening? I have tried parcel versions 1.12.3, 1.12.4 and 1.12.5.\nHere is the error:\n```\n`/Users/user/Documents/HTML Apps/Project/index.html: tree.render is not a function\nat /Users/user/Documents/HTML Apps/Project/node_modules/htmlnano/lib/modules/minifySvg.js:19:23\nat /Users/user/Documents/HTML Apps/Project/node_modules/posthtml/lib/api.js:91:45\nat traverse (/Users/user/Documents/HTML Apps/Project/node_modules/posthtml/lib/api.js:105:26)\nat traverse (/Users/user/Documents/HTML Apps/Project/node_modules/posthtml/lib/api.js:111:5)\nat traverse (/Users/user/Documents/HTML Apps/Project/node_modules/posthtml/lib/api.js:105:17)\nat traverse (/Users/user/Documents/HTML Apps/Project/node_modules/posthtml/lib/api.js:111:5)\nat traverse (/Users/user/user/HTML Apps/Project/node_modules/posthtml/lib/api.js:105:17)\nat traverse (/Users/user/Documents/HTML Apps/Project/node_modules/posthtml/lib/api.js:111:5)\nat traverse (/Users/user/Documents/HTML Apps/Project/node_modules/posthtml/lib/api.js:105:17)\nat traverse (/Users/user/Documents/HTML Apps/Project/node_modules/posthtml/lib/api.js:111:5)\nnpm ERR! code ELIFECYCLE\nnpm ERR! errno 1\nnpm ERR! Project@1.0.0 build: `parcel build index.html`\nnpm ERR! Exit status 1\nnpm ERR!\nnpm ERR! Failed at the Project@1.0.0 build script.\nnpm ERR! This is probably not a problem with npm. There is likely additional logging output above.\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR! /Users/user/.npm/_logs/2021-04-14T07_44_52_872Z-debug.log\n`\n```",
      "solution": "In my case it worked adding .htmlnanorc.js to my project root with the following:\n```\n`module.exports = {\n    \"minifySvg\": false\n  }\n`\n```",
      "question_score": 21,
      "answer_score": 22,
      "created_at": "2021-04-14T09:53:35",
      "url": "https://stackoverflow.com/questions/67087634/parcel-js-tree-render-is-not-a-function"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 70079698,
      "title": "Cannot find name &#39;AbortSignal&#39; during npm run build",
      "problem": "```\n`node_modules/axios/index.d.ts:93:12 - error TS2304: Cannot find name 'AbortSignal'.\n\n93   signal?: AbortSignal;\n              ~~~~~~~~~~~\n\nFound 1 error.\n`\n```\nWhen trying `npm run build` comand for node typescript project, i am getting above error, something related to axio package. before axio usage, npm run build working fine.",
      "solution": "You need to add DOM to the lib array in your `tsconfig.json`:\n```\n`\"lib\": [\n      \"es2018\",\n      \"DOM\"\n    ],\n`\n```",
      "question_score": 21,
      "answer_score": 36,
      "created_at": "2021-11-23T12:00:52",
      "url": "https://stackoverflow.com/questions/70079698/cannot-find-name-abortsignal-during-npm-run-build"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 75281066,
      "title": "Error: Illegal characters in path in npm rimraf",
      "problem": "I am getting an error while I tried to delete multiple directories using npm rimraf.\n\nError: Illegal characters in path\n\nCommand I run is `rimraf **/lib/**`\n```\n`> ecommerce.ui@0.7.2 clean-libs\n> rimraf **/lib/**\n\nError: Illegal characters in path.\n    at pathArg (C:\\Users\\SUDARANGA\\AppData\\Roaming\\nvm\\v18.9.0\\node_modules\\rimraf\\dist\\cjs\\src\\path-arg.js:45:33)\n    at C:\\Users\\SUDARANGA\\AppData\\Roaming\\nvm\\v18.9.0\\node_modules\\rimraf\\dist\\cjs\\src\\index.js:34:66       \n    at Array.map ()\n    at C:\\Users\\SUDARANGA\\AppData\\Roaming\\nvm\\v18.9.0\\node_modules\\rimraf\\dist\\cjs\\src\\index.js:34:28       \n    at main (C:\\Users\\SUDARANGA\\AppData\\Roaming\\nvm\\v18.9.0\\node_modules\\rimraf\\dist\\cjs\\src\\bin.js:134:11) \n    at Object. (C:\\Users\\SUDARANGA\\AppData\\Roaming\\nvm\\v18.9.0\\node_modules\\rimraf\\dist\\cjs\\src\\bin.js:143:5)\n    at Module._compile (node:internal/modules/cjs/loader:1119:14)\n    at Module._extensions..js (node:internal/modules/cjs/loader:1173:10)\n    at Module.load (node:internal/modules/cjs/loader:997:32)\n    at Module._load (node:internal/modules/cjs/loader:838:12) {\n  path: 'C:\\\\source\\\\Ecommerce.UI\\\\**\\\\lib\\\\**',\n  code: 'EINVAL'\n}\n\n`\n```",
      "solution": "Version 4.0 of `rimraf` removed globbing support, but they restored globbing in version 4.2 (released March 2023).\nIf you're using `rimraf` from the command line (i.e. using it as an npm command and not using the JavaScript API), it's now behind a `--glob` flag:\n```\n`rimraf --glob packages/**/*.tgz\n`\n```\nIf you're using the JavaScript API, you can use the `glob` option:\n`import {\u00a0rimrafSync } from 'rimraf';\n\nrimrafSync('/foo/*.bar', { glob: true });\n`\nIf you can't use version 4.2, and you're using `rimraf` just from the command line, then I've found that `del-cli` seems to be a good cross-platform replacement.",
      "question_score": 21,
      "answer_score": 39,
      "created_at": "2023-01-30T07:57:28",
      "url": "https://stackoverflow.com/questions/75281066/error-illegal-characters-in-path-in-npm-rimraf"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 65941009,
      "title": "npm install -D sass-loader node-sass Vue.js 2021",
      "problem": "Hi issue is setting up SASS for Vue.js\nI run:\nNode.js - 15.7.0\nVue.js - @vue/cli 4.5.11\nThis is an error in the console I am having while running this command:\nnpm install -D sass-loader node-sass\n```\n`npm ERR! code ERESOLVE\nnpm ERR! ERESOLVE unable to resolve dependency tree\nnpm ERR! \nnpm ERR! Found: webpack@3.12.0\nnpm ERR! node_modules/webpack\nnpm ERR!   peer webpack@\"2 || 3 || 4\" from babel-loader@7.1.5\nnpm ERR!   node_modules/babel-loader\nnpm ERR!     dev babel-loader@\"^7.1.1\" from the root project\nnpm ERR!   peer webpack@\"^3.1.0\" from extract-text-webpack-plugin@3.0.2\nnpm ERR!   node_modules/extract-text-webpack-plugin\nnpm ERR!     dev extract-text-webpack-plugin@\"^3.0.0\" from the root project\nnpm ERR!   8 more (file-loader, friendly-errors-webpack-plugin, ...)\nnpm ERR! \nnpm ERR! Could not resolve dependency:\nnpm ERR! dev sass-loader@\"*\" from the root project\nnpm ERR! \nnpm ERR! Conflicting peer dependency: webpack@5.18.0\nnpm ERR! node_modules/webpack\nnpm ERR!   peer webpack@\"^4.36.0 || ^5.0.0\" from sass-loader@10.1.1\nnpm ERR!   node_modules/sass-loader\nnpm ERR! \nnpm ERR! Fix the upstream dependency conflict, or retry\nnpm ERR! this command with --force, or --legacy-peer-deps\nnpm ERR! to accept an incorrect (and potentially broken) dependency resolution.\nnpm ERR! \nnpm ERR! See C:\\Users\\marko\\AppData\\Local\\npm-cache\\eresolve-report.txt for a full report.\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     C:\\Users\\marko\\AppData\\Local\\npm-cache\\_logs\\2021-01-28T16_11_07_342Z-debug.log\n`\n```",
      "solution": "I had the same problem today. Try installing sass-loader v10.0.5 instead:\n```\n`npm install -D sass-loader@10.0.5 node-sass\n`\n```",
      "question_score": 20,
      "answer_score": 56,
      "created_at": "2021-01-28T17:13:39",
      "url": "https://stackoverflow.com/questions/65941009/npm-install-d-sass-loader-node-sass-vue-js-2021"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 69448082,
      "title": "ERR! 426 Upgrade Required, when I interact with the npm registry",
      "problem": "When I try to publish a new package to npm or try to logout, I get the following error message:\n```\n`npm ERR! code E426\nnpm ERR! 426 Upgrade Required\n`\n```",
      "solution": "Beginning October 4, 2021, all connections to npm websites and the npm\nregistry\u2014including for package installation\u2014must use TLS 1.2 or\nhigher.\n\nSource\nWhat I did:\n\nupgrade Node (0) to its current recommended version: 14.18.0 LTS\nupgrade npm with `npm install -g npm@latest`\n\nSolution: I had to manually set the registry to use https instead of http as well:\n\n`npm config set registry https://registry.npmjs.org/`\n\n(0) When using nvm, that's what you need to do:\n```\n`nvm install 14.18.0\nnvm use 14.18.0\nnvm alias default 14.18.0\n`\n```",
      "question_score": 20,
      "answer_score": 54,
      "created_at": "2021-10-05T11:35:01",
      "url": "https://stackoverflow.com/questions/69448082/err-426-upgrade-required-when-i-interact-with-the-npm-registry"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 71804844,
      "title": "How would you fix an &#39;ERR_REQUIRE_ESM&#39; error?",
      "problem": "I am trying to use the chalk npm.\nMy code is:\n```\n`     const chalk = require('chalk');\n\n          console.log(\n          chalk.green('All sytems go') +\n          chalk.orange('until').underline +\n          chalk.black(chalk.bgRed('an error occurred'))\n           );\n`\n```\nAnd I receive this error in my terminal when I type node main.js\n```\n`Error [ERR_REQUIRE_ESM]: require() of ES Module /Users/ezell/Documents/CodeX/NPM/node_modules/chalk/source/index.js from /Users/ezell/Documents/CodeX/NPM/main.js not supported.\nInstead change the require of index.js in /Users/ezell/Documents/CodeX/NPM/main.js to a dynamic import() which is available in all CommonJS modules.\n    at Object. (/Users/ezell/Documents/CodeX/NPM/main.js:1:15) {\n  code: 'ERR_REQUIRE_ESM'\n}\n`\n```",
      "solution": "You need to switch to using the `import` keyword, as Chalk 5 only supports ESM modules.\n\nSo, to fix your code to adapt these changes, you need to...\n\nEdit your `package.json` file to allow ESM imports. Add the following in your `package.json` file:\n`{\n  \"type\": \"module\"\n}\n`\n\nLoad Chalk with the `import` keyword, as so:\n`import chalk from \"chalk\";\n`\n\nIf you, however, want to use `require()`, you need to downgrade to Chalk 4. Follow these steps to downgrade.\n\nReplace your existing `chalk` key with the following in your `package.json` file:\n`{\n  \"dependencies\": {\n    \"chalk\": \"4.1.2\"\n  }\n}\n`\n\nThen, run the following command to install Chalk from your `package.json` file. Make sure to run this in the directory in which your `package.json` file is in!\n```\n`$ npm install\n`\n```\n\nUse the `require()` statement like normal.\n`const chalk = require(\"chalk\");\n`\n\nIn summary, these are the two things you can do.\n\nStay with Chalk 5, and update `import` statements.\nDowngrade to Chalk 4, and keep `require()` statements.",
      "question_score": 20,
      "answer_score": 6,
      "created_at": "2022-04-09T04:32:27",
      "url": "https://stackoverflow.com/questions/71804844/how-would-you-fix-an-err-require-esm-error"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 71671541,
      "title": "npm install react-google-login not working",
      "problem": "i am using following command to install react-google-login for react npm install react-google-login but its not working\n```\n`npm ERR! code ERESOLVE\nnpm ERR! ERESOLVE unable to resolve dependency tree\nnpm ERR! \nnpm ERR! While resolving: loginwithgooleapp@0.1.0\nnpm ERR! Found: react@18.0.0\nnpm ERR! node_modules/react\nnpm ERR!   react@\"^18.0.0\" from the root project\nnpm ERR! \nnpm ERR! Could not resolve dependency:\nnpm ERR! peer react@\"^16 || ^17\" from react-google-login@5.2.2\nnpm ERR! node_modules/react-google-login\nnpm ERR!   react-google-login@\"*\" from the root project\nnpm ERR! \nnpm ERR! Fix the upstream dependency conflict, or retry\nnpm ERR! this command with --force, or --legacy-peer-deps\nnpm ERR! to accept an incorrect (and potentially broken) dependency resolution.\nnpm ERR! \nnpm ERR! See /Users/Baran/.npm/eresolve-report.txt for a full report.\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     /Users/Baran/.npm/_logs/2022-03-30T04_33_37_205Z-debug-0.log\n\n`\n```",
      "solution": "try using\n```\n`npm install react-google-login --force\n`\n```\nor\n```\n`npm install react-google-login --legacy-peer-deps\n`\n```",
      "question_score": 19,
      "answer_score": 44,
      "created_at": "2022-03-30T06:34:12",
      "url": "https://stackoverflow.com/questions/71671541/npm-install-react-google-login-not-working"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 72193784,
      "title": "Why doesn&#39;t the exports field of npm work in typescript?",
      "problem": "Our library @ltonetwork/lto, is written in typescript. We use `tsc` to compile to javascript in the `lib` folder.\nThe package contains several sub-packages, which are located in subfolders that contain an index.ts file.\nWhen trying to import a submodule, like this\n`import {Transfer} from \"@ltonetwork/lto/transactions\";\n`\nI'm expecting this to work, but I get the following error\n```\n`test.ts:1:24 - error TS2307: Cannot find module '@ltonetwork/lto/transactions' or its corresponding type declarations.\n`\n```\nThe package.json of @ltonetwork/lto contains\n`{\n  \"scripts\": {\n    \"compile\": \"tsc -p ./tsconfig.json\"\n  },\n  \"main\": \"lib\",\n  \"exports\": {\n    \".\": \"./lib/index.js\",\n    \"./*\": \"./lib/*/index.js\",\n    \"./package.json\": \"./package.json\"\n  },\n  \"files\": [\n    \"lib\",\n    \"interfaces.d.ts\"\n  ]\n}\n`\nand the tsconfig.json is\n`{\n  \"compilerOptions\": {\n    \"alwaysStrict\": true,\n    \"baseUrl\": \"\",\n    \"lib\": [\"es2017.object\", \"es2015\", \"es6\", \"dom\"],\n    \"module\": \"commonjs\",\n    \"sourceMap\": true,\n    \"declaration\": true,\n    \"target\": \"es6\",\n    \"paths\": {},\n    \"rootDir\": \"src\",\n    \"outDir\": \"lib\"\n  },\n  \"include\": [\"src\"]\n}\n`\nI've tried to explicitly name the submodules, instead of using wildcards in `exports`, but that made no difference.\nWhat am I doing wrong that's causing this import issue?\n\nEdit:\nThis is not related to monorepos or yarn workspaces. This is about using the `exports` field in npm with typescript 4.7.1-rc. This feature wasn't working with earlier versions of typescript.\nFor more information see https://github.com/microsoft/TypeScript/issues/33079\nI've also tried\n`{\n  \"scripts\": {\n    \"compile\": \"tsc -p ./tsconfig.json\"\n  },\n  \"main\": \"lib\",\n  \"exports\": {\n    \".\": {\n      \"require\": {\n        \"default\": \"./lib/index.js\",\n        \"types\": \"./lib/index.d.ts\"\n      },\n      \"import\": {\n        \"default\": \"./lib/index.js\",\n        \"types\": \"./lib/index.d.ts\"\n      }\n    },\n    \"./transactions\": {\n      \"require\": {\n        \"default\": \"./lib/transactions/index.js\",\n        \"types\": \"./lib/transactions/index.d.ts\"\n      },\n      \"import\": {\n        \"default\": \"./lib/transactions/index.js\",\n        \"types\": \"./lib/transactions/index.d.ts\"\n      }\n    },\n    \"./package.json\": \"./package.json\"\n  },\n  \"files\": [\n    \"lib\",\n    \"interfaces.d.ts\"\n  ]\n}\n`",
      "solution": "Ensure `moduleResolution` in the consuming library is set to either `Node16` or `NodeNext` in your `tsconfig.json` file.\nEdit: `bundler` is now also an option.",
      "question_score": 19,
      "answer_score": 37,
      "created_at": "2022-05-11T01:04:04",
      "url": "https://stackoverflow.com/questions/72193784/why-doesnt-the-exports-field-of-npm-work-in-typescript"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 72820625,
      "title": "What is the proper way to &quot;patch&quot; a node_modules module?",
      "problem": "Say I have a Node.js app, lets call it `patched-app`. This app is a simple app that uses prompt-sync to ask for user input and then does something with it.\nSo we create a folder `patched-app` and initialize it with `npm init`. We then run `npm i prompt-sync` and create a new file called `index.js` where my code would be. To make things a little bit more interesting, I will also create a git repository here and this is the result:\n```\n`+---patched-app\n|   |   .gitattributes\n|   |   .gitattributes\n|   |   .gitignore\n|   |   index.js\n|   |   package-lock.json\n|   |   package.json\n|   |   \n|   +---node_modules\n|   |   |   .package-lock.json\n|   |   |   \n|   |   +---ansi-regex\n|   |   |       index.js\n|   |   |       license\n|   |   |       package.json\n|   |   |       readme.md\n|   |   |       \n|   |   +---prompt-sync\n|   |   |       index.js\n|   |   |       LICENSE\n|   |   |       package.json\n|   |   |       README.md\n|   |   |       test.js\n|   |   |       \n|   |   \\---strip-ansi\n|   |           index.d.ts\n|   |           index.js\n|   |           license\n|   |           package.json\n|   |           readme.md\n|   \\---.git\n|      >\n`\n```\nNow the issue here is that I don't like something with this `prompt-sync` package and so I want to edit `node_modules/prompt-sync/index.js` and change it to my liking. I don't necessarily want to create a whole new module such as `prompt-sync-swiffy` (or do I?), as my changes are small enough so I don't have to download any new packages for `prompt-sync`, so I'm good with the existing dependencies of `ansi-regex` and `strip-ansi`.\nI could just open up `node_modules/prompt-sync/index.js`, edit it and be done - and that's what I have pretty much been doing thus far because I don't know any better. I have recognized at least three major issues with this though:\n\nI cannot update `prompt-sync` anymore or I might lose the changes I made (losing !== just breaking my patched changes)\nI cannot basically run any package commands, such as `npm audit fix` etc, as those might also overwrite my changes\nThis doesn't work at all, if I want to have my project in a git repository, because I will obviously add `node_modules` to `.gitignore` and if anyone were to pull my repository and run `npm install`, it would install `prompt-sync` without my changes\n\nI also don't necessarily want to fork `prompt-sync` and / or create a new \"official\" NPM package. What I want is a method that allows me or anyone else to run `npm install` normally, while somehow keeping my patches to modules local e.g. have a `module_patches` folder which isn't ignored by the repository.\nIt is OK if a newer version of `prompt-sync` breaks my patch. That would be on me to update the patch or use a locked in version of `prompt-sync`.\nSo what are my options?",
      "solution": "A nice way to patch NPM packages is using patch-package. It will automatically create patch files of your changes and apply them in postinstall hook.\nInstall patch-package:\n`npm i patch-package\n`\nIn package.json add the postinstall hook:\n```\n`\"scripts\": {\n  \"postinstall\": \"patch-package\"\n}\n`\n```\nEdit the prompt-sync package using your editor of choice:\n`vim node_modules/prompt-sync/index.js\n`\nGenerate a patch file using patch-package:\n`npx patch-package prompt-sync\n`\nCommit package.json changes and the generated .patch file.\nNow when a coworker pulls your changes and runs `npm i` the patch will be applied to prompt-sync.\nRead the awesome patch-package docs for more details.",
      "question_score": 19,
      "answer_score": 26,
      "created_at": "2022-06-30T20:41:38",
      "url": "https://stackoverflow.com/questions/72820625/what-is-the-proper-way-to-patch-a-node-modules-module"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 66965954,
      "title": "Build error after updating Svelte: Package subpath &#39;./compiler.js&#39; is not defined by &quot;exports&quot;",
      "problem": "Problem\nI was on Svelte version 3.0.0 and used `npm i svelte@latest` to update to the most recent version. Now I can't get the app to run, I always get this errror:\n\n[!] Error: Package subpath './compiler.js' is not defined by \"exports\" in /home/blub/coding/bla/node_modules/svelte/package.json\nError [ERR_PACKAGE_PATH_NOT_EXPORTED]: Package subpath './compiler.js' is not defined by \"exports\" in /home/blub/coding/bla/node_modules/svelte/package.json\n\nFailed Solutions\nI also updated rollup-plugin-svelte to version 5.2.0, but that did not help. Are there any other dependencies I also have to update? Here is a list of my dependencies:\n```\n`  \"devDependencies\": {\n    \"node-sass\": \"^4.12.0\",\n    \"npm-run-all\": \"^4.1.5\",\n    \"rollup\": \"^2.44.0\",\n    \"rollup-plugin-commonjs\": \"^10.0.0\",\n    \"rollup-plugin-livereload\": \"^1.0.0\",\n    \"rollup-plugin-node-resolve\": \"^5.2.0\",\n    \"rollup-plugin-svelte\": \"^5.2.3\",\n    \"rollup-plugin-terser\": \"^4.0.4\",\n    \"svelte\": \"^3.37.0\",\n    \"svelte-preprocess-sass\": \"^0.2.0\"\n  },\n  \"dependencies\": {\n    \"axios\": \"^0.19.0\",\n    \"sirv-cli\": \"^0.4.4\"\n  },\n`\n```",
      "solution": "This issue is due to a breaking change of svelte `v3.29.5`. So if you want to use this version you will also need to update `rollup-plugin-svelte` to at least `v6.1.1`:\n`npm i -D rollup-plugin-svelte@6.1.1\n# or with yarn\nyarn add -D rollup-plugin-svelte@6.1.1\n`",
      "question_score": 19,
      "answer_score": 34,
      "created_at": "2021-04-06T11:22:08",
      "url": "https://stackoverflow.com/questions/66965954/build-error-after-updating-svelte-package-subpath-compiler-js-is-not-define"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 74406268,
      "title": "How to deal with NPM error: Cannot set properties of null (setting &#39;parent&#39;)?",
      "problem": "This NPM error happens when used in a monorepo with NPM workspaces feature. I have a monorepo with 5 packages: `a`, `b`, `c`, `d` and `e`. I also have a package in a different repository which is not a workspace. The name of that package is `x` and it depends on package `c` and `d`.\nThe problem happens when I try to add package `x` as a dependency for my package `e`. Every time I try: `npm install x -w packages/e`, I get following error:\n```\n`npm ERR! Cannot set properties of null (setting 'parent')\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     /Users/harshal/.npm/_logs/2022-11-11T17_27_57_008Z-debug-0.log\n`\n```\nThere is absolutely nothing in the error log except the fact that the error originates in `arborist` package when resolving dependencies.\nI have tried using multiple NPM versions `^8.x.x` but it doesn't seem to resolve it.",
      "solution": "The issue is the circular dependency - monorepo depends on external package that depends back on the monorepo.  When trying to resolve it seems to set the monorepo packages as 'null' (so as to defer resolution w/o hanging) and then when it tries to resolve that package it just fails.  I don't have a workaround, trying to figure that out for myself.",
      "question_score": 19,
      "answer_score": 4,
      "created_at": "2022-11-11T18:38:47",
      "url": "https://stackoverflow.com/questions/74406268/how-to-deal-with-npm-error-cannot-set-properties-of-null-setting-parent"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 75018613,
      "title": "Why am I getting errors with npx?",
      "problem": "everytime when I run any npx command it gives me the same error.\nExcept when I run: `npx -v` then it gives me the version: 9.2.0\nhere is the error:\n```\n`npm ERR! code ENOENT\nnpm ERR! syscall lstat\nnpm ERR! path E:\\Development\nnpm ERR! errno -4058\nnpm ERR! enoent ENOENT: no such file or directory, lstat 'E:\\Development'\nnpm ERR! enoent This is related to npm not being able to find a file.\nnpm ERR! enoent\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     C:\\Users\\Tim\\AppData\\Local\\npm-cache\\_logs\\2023-01-02T20_03_57_627Z-debug-0.log\n`\n```\nI have updated npm with nvm but that didnt make a change.\nI want to run `npx create-react-app myApp` or `npx create-electron-app myApp` but every command gives me the same error.\nCan somebody help me to get rid of this error ?",
      "solution": "I had the same problem so I just did this \"mkdir %USERPROFILE%\\AppData\\Roaming\\npm\" and then everything worked.  Seems some sort of setup bug probably because I installed NPM from a different user account on the machine.",
      "question_score": 18,
      "answer_score": 52,
      "created_at": "2023-01-05T13:46:08",
      "url": "https://stackoverflow.com/questions/75018613/why-am-i-getting-errors-with-npx"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 70594844,
      "title": "NPM warning: &#39;unsupported engine&#39;",
      "problem": "I entered the command `npm install -D tailwind css postcss autoprefixer vite` in VS-Code.\nMy environment is:\n\nNPM version: `8.1.2`\nNode.js version: `16.13.1`\n\nWhich resulted in following warning:\n```\n`npm WARN idealTree Removing dependencies.vite in favor of devDependencies.vite\nnpm WARN EBADENGINE Unsupported engine {    \nnpm WARN EBADENGINE   package: 'amqplib@0.5.2',    \nnpm WARN EBADENGINE   required: { node: '>=0.8 My package.json is:\n`{\n  \"name\": \"tailwind-css-part-7\",\n  \"version\": \"1.0.0\",\n  \"main\": \"index.js\",\n  \"devDependencies\": {\n    \"autoprefixer\": \"^10.4.2\",\n    \"css\": \"^3.0.0\",\n    \"postcss\": \"^8.4.5\",\n    \"tailwind\": \"^4.0.0\",\n    \"vite\": \"^2.7.10\"\n  },\n  \"scripts\": {\n    \"start\": \"vite\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"dependencies\": {\n    \"accepts\": \"^1.3.7\",\n    \"ajv\": \"^6.10.0\",\n    \"amqplib\": \"^0.5.2\",\n    \"ansi-styles\": \"^3.2.1\",\n    \"app-root-path\": \"^2.1.0\",\n    \"array-flatten\": \"^1.1.1\",\n    \"asn1\": \"^0.2.3\",\n    \"async-limiter\": \"^1.0.1\",\n    \"async-retry\": \"^1.2.3\",\n    \"atob\": \"^2.1.2\",\n    \"babel-runtime\": \"^6.26.0\",\n    \"basic-auth\": \"^2.0.1\",\n    \"bitsyntax\": \"^0.0.4\",\n    \"bluebird\": \"^3.7.2\",\n    \"body-parser\": \"^1.18.3\",\n    \"browserslist\": \"^4.19.1\",\n    \"buffer-equal-constant-time\": \"^1.0.1\",\n    \"buffer-more-ints\": \"^0.0.2\",\n    \"bytes\": \"^3.0.0\",\n    \"call-bind\": \"^1.0.2\",\n    \"caniuse-lite\": \"^1.0.30001296\",\n    \"chalk\": \"^2.4.1\",\n    \"color-convert\": \"^1.9.3\",\n    \"color-name\": \"^1.1.3\",\n    \"commands-events\": \"^1.0.4\",\n    \"comparejs\": \"^1.0.0\",\n    \"compressible\": \"^2.0.18\",\n    \"compression\": \"^1.7.3\",\n    \"content-disposition\": \"^0.5.2\",\n    \"content-type\": \"^1.0.4\",\n    \"cookie\": \"^0.3.1\",\n    \"cookie-signature\": \"^1.0.6\",\n    \"core-js\": \"^2.6.12\",\n    \"core-util-is\": \"^1.0.3\",\n    \"cors\": \"^2.8.5\",\n    \"crypto2\": \"^2.0.0\",\n    \"datasette\": \"^1.0.1\",\n    \"debug\": \"^2.6.9\",\n    \"decode-uri-component\": \"^0.2.0\",\n    \"define-properties\": \"^1.1.3\",\n    \"depd\": \"^1.1.2\",\n    \"destroy\": \"^1.0.4\",\n    \"draht\": \"^1.0.1\",\n    \"ecdsa-sig-formatter\": \"^1.0.11\",\n    \"ee-first\": \"^1.1.1\",\n    \"electron-to-chromium\": \"^1.4.35\",\n    \"encodeurl\": \"^1.0.2\",\n    \"es-abstract\": \"^1.19.1\",\n    \"es-to-primitive\": \"^1.2.1\",\n    \"esbuild\": \"^0.13.15\",\n    \"esbuild-windows-64\": \"^0.13.15\",\n    \"escalade\": \"^3.1.1\",\n    \"escape-html\": \"^1.0.3\",\n    \"escape-string-regexp\": \"^1.0.5\",\n    \"etag\": \"^1.8.1\",\n    \"eventemitter2\": \"^5.0.1\",\n    \"express\": \"^4.16.4\",\n    \"fast-deep-equal\": \"^2.0.1\",\n    \"fast-json-stable-stringify\": \"^2.1.0\",\n    \"finalhandler\": \"^1.1.1\",\n    \"find-root\": \"^1.1.0\",\n    \"flaschenpost\": \"^5.0.49\",\n    \"formats\": \"^1.0.0\",\n    \"forwarded\": \"^0.2.0\",\n    \"fraction.js\": \"^4.1.2\",\n    \"fresh\": \"^0.5.2\",\n    \"function-bind\": \"^1.1.1\",\n    \"get-intrinsic\": \"^1.1.1\",\n    \"get-own-enumerable-property-symbols\": \"^3.0.2\",\n    \"get-symbol-description\": \"^1.0.0\",\n    \"has\": \"^1.0.3\",\n    \"has-bigints\": \"^1.0.1\",\n    \"has-flag\": \"^3.0.0\",\n    \"has-symbols\": \"^1.0.2\",\n    \"has-tostringtag\": \"^1.0.0\",\n    \"hase\": \"^2.0.0\",\n    \"http-errors\": \"^1.6.3\",\n    \"iconv-lite\": \"^0.4.23\",\n    \"inherits\": \"^2.0.4\",\n    \"internal-slot\": \"^1.0.3\",\n    \"ipaddr.js\": \"^1.9.1\",\n    \"is-bigint\": \"^1.0.4\",\n    \"is-boolean-object\": \"^1.1.2\",\n    \"is-callable\": \"^1.2.4\",\n    \"is-core-module\": \"^2.8.0\",\n    \"is-date-object\": \"^1.0.5\",\n    \"is-negative-zero\": \"^2.0.2\",\n    \"is-number-object\": \"^1.0.6\",\n    \"is-obj\": \"^1.0.1\",\n    \"is-regex\": \"^1.1.4\",\n    \"is-regexp\": \"^1.0.0\",\n    \"is-shared-array-buffer\": \"^1.0.1\",\n    \"is-string\": \"^1.0.7\",\n    \"is-symbol\": \"^1.0.4\",\n    \"is-weakref\": \"^1.0.2\",\n    \"isarray\": \"^0.0.1\",\n    \"json-lines\": \"^1.0.0\",\n    \"json-schema-traverse\": \"^0.4.1\",\n    \"jsonwebtoken\": \"^8.5.0\",\n    \"jwa\": \"^1.4.1\",\n    \"jws\": \"^3.2.2\",\n    \"limes\": \"^2.0.0\",\n    \"lodash\": \"^4.17.11\",\n    \"lodash.includes\": \"^4.3.0\",\n    \"lodash.isboolean\": \"^3.0.3\",\n    \"lodash.isinteger\": \"^4.0.4\",\n    \"lodash.isnumber\": \"^3.0.3\",\n    \"lodash.isplainobject\": \"^4.0.6\",\n    \"lodash.isstring\": \"^4.0.1\",\n    \"lodash.once\": \"^4.1.1\",\n    \"lusca\": \"^1.6.1\",\n    \"media-typer\": \"^0.3.0\",\n    \"merge-descriptors\": \"^1.0.1\",\n    \"methods\": \"^1.1.2\",\n    \"mime\": \"^1.4.1\",\n    \"mime-db\": \"^1.51.0\",\n    \"mime-types\": \"^2.1.34\",\n    \"moment\": \"^2.22.2\",\n    \"morgan\": \"^1.9.1\",\n    \"ms\": \"^2.0.0\",\n    \"nanoid\": \"^3.1.30\",\n    \"negotiator\": \"^0.6.2\",\n    \"nocache\": \"^2.0.0\",\n    \"node-releases\": \"^2.0.1\",\n    \"node-rsa\": \"^0.4.2\",\n    \"node-statsd\": \"^0.1.1\",\n    \"normalize-range\": \"^0.1.2\",\n    \"object-assign\": \"^4.1.1\",\n    \"object-inspect\": \"^1.12.0\",\n    \"object-keys\": \"^1.1.1\",\n    \"object.assign\": \"^4.1.2\",\n    \"object.getownpropertydescriptors\": \"^2.1.3\",\n    \"on-finished\": \"^2.3.0\",\n    \"on-headers\": \"^1.0.2\",\n    \"parseurl\": \"^1.3.3\",\n    \"partof\": \"^1.0.0\",\n    \"path-parse\": \"^1.0.7\",\n    \"path-to-regexp\": \"^0.1.7\",\n    \"picocolors\": \"^1.0.0\",\n    \"postcss-value-parser\": \"^4.2.0\",\n    \"processenv\": \"^1.1.0\",\n    \"proxy-addr\": \"^2.0.7\",\n    \"punycode\": \"^2.1.1\",\n    \"qs\": \"^6.5.2\",\n    \"range-parser\": \"^1.2.1\",\n    \"raw-body\": \"^2.3.3\",\n    \"readable-stream\": \"^1.1.14\",\n    \"regenerator-runtime\": \"^0.12.1\",\n    \"resolve\": \"^1.21.0\",\n    \"retry\": \"^0.12.0\",\n    \"rollup\": \"^2.63.0\",\n    \"safe-buffer\": \"^5.1.2\",\n    \"safer-buffer\": \"^2.1.2\",\n    \"semver\": \"^5.7.1\",\n    \"send\": \"^0.16.2\",\n    \"serve-static\": \"^1.13.2\",\n    \"setprototypeof\": \"^1.1.0\",\n    \"sha-1\": \"^0.1.1\",\n    \"side-channel\": \"^1.0.4\",\n    \"source-map\": \"^0.6.1\",\n    \"source-map-js\": \"^1.0.1\",\n    \"source-map-resolve\": \"^0.6.0\",\n    \"split2\": \"^3.0.0\",\n    \"stack-trace\": \"^0.0.10\",\n    \"statuses\": \"^1.4.0\",\n    \"stethoskop\": \"^1.0.0\",\n    \"string_decoder\": \"^0.10.31\",\n    \"string.prototype.trimend\": \"^1.0.4\",\n    \"string.prototype.trimstart\": \"^1.0.4\",\n    \"stringify-object\": \"^3.3.0\",\n    \"supports-color\": \"^5.5.0\",\n    \"supports-preserve-symlinks-flag\": \"^1.0.0\",\n    \"timer2\": \"^1.0.0\",\n    \"tsscmp\": \"^1.0.6\",\n    \"type-is\": \"^1.6.18\",\n    \"unbox-primitive\": \"^1.0.1\",\n    \"unpipe\": \"^1.0.0\",\n    \"untildify\": \"^3.0.3\",\n    \"uri-js\": \"^4.4.1\",\n    \"util-deprecate\": \"^1.0.2\",\n    \"util.promisify\": \"^1.0.0\",\n    \"utils-merge\": \"^1.0.1\",\n    \"uuid\": \"^3.3.2\",\n    \"uuidv4\": \"^3.0.1\",\n    \"varname\": \"^2.0.3\",\n    \"vary\": \"^1.1.2\",\n    \"which-boxed-primitive\": \"^1.0.2\",\n    \"ws\": \"^6.2.0\"\n  },\n  \"description\": \"\"\n}\n`",
      "solution": "Its not a breaking error, just means that some functionalities might not work as expected.\nAs this `npm WARN EBADENGINE   required: { node: '>=0.8",
      "question_score": 18,
      "answer_score": 23,
      "created_at": "2022-01-05T15:46:48",
      "url": "https://stackoverflow.com/questions/70594844/npm-warning-unsupported-engine"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 68133429,
      "title": "Jenkins build fails with &quot;Treating warnings as errors because of process.env.CI = true&quot;",
      "problem": "After updating the Jenkins, all builds started to fail with the following errors.\n```\n`[ERROR] {some text}: {some text} is outdated. Please run next command `npm update`\n[INFO] Treating warnings as errors because process.env.CI = true.\n[INFO] Most CI servers set it automatically.\n`\n```\nHow can I fix this for all builds?",
      "solution": "This is a result of this change:\n\nhttps://issues.jenkins.io/browse/JENKINS-36707\n\nIt has introduced the standard `CI` env var that is always set to `true` in order to allow pipelines and tools to know they're executing in a continuous integration context.\nThis has emerged as a best practice used by most other popular CI solutions, and a number of tools look for this variable in order to make CI-appropriate optimizations.\nYou can set `CI` env variable to false through `Manage Jenkins` > `Configure System` > `Global properties` section.\n\nAdd a new env variable `CI` with the value `false`.",
      "question_score": 18,
      "answer_score": 44,
      "created_at": "2021-06-25T17:23:00",
      "url": "https://stackoverflow.com/questions/68133429/jenkins-build-fails-with-treating-warnings-as-errors-because-of-process-env-ci"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 78343601,
      "title": "Node unable to verify the first certificate",
      "problem": "Suddenly my Node environments start not to install packages and they are freezing in `idealTree:my-app : sill idealTree buildDeps`\nI tried `npm config set registry http://registry.npmjs.org/ --global` but did not work,\nI had to use `npm set strict-ssl false` to make it work (I am not sure if it's safe?)\nAnd then I started to getting this error as I am running dev server\n```\n` Error: unable to verify the first certificate\n      at TLSSocket.onConnectSecure (node:_tls_wrap:1674:34)\n      at TLSSocket.emit (node:events:519:28)\n      at TLSSocket._finishInit (node:_tls_wrap:1085:8)\n      at ssl.onhandshakedone (node:_tls_wrap:871:12) {\n    code: 'UNABLE_TO_VERIFY_LEAF_SIGNATURE'\n\n`\n```\nEnvironment:\nNode 21.6.1\nNextjs 14.1.0\nReact 18.2.0\nNPM 10.2.4\nDoes anyone see the same? An in general why this is happening without changing dependencies?",
      "solution": "Not sure if it's your case but looks very similar to what I started encountering around the same time as you (not only for `npm` but also for `webpack-dev-server` proxy and other things). Only now I managed to find out that it got broken after yesterday's update of ESET NOD32 Antivirus. There's already a report about it - https://forum.eset.com/topic/40702-eset-ssl-protection-produces-an-invalid-certificate-chain-for-nodejs-apps/.\nThe permanent solution will probably come from a NOD32 update but we'll see.\nSolution for now is to turn off `Enable HTTPS traffic scanning` switcher in the settings to make NOD32 not scan communicating over SSL/TLS. Alternatively you can add particular apps into the ignore list if you still want to keep it scanning.\n\nP.S. `npm set strict-ssl false` is an unsafe workaround for `npm` specifically and it's usually not the root of this kind of problems so it's better to set it back to `true`.",
      "question_score": 18,
      "answer_score": 35,
      "created_at": "2024-04-17T22:22:16",
      "url": "https://stackoverflow.com/questions/78343601/node-unable-to-verify-the-first-certificate"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 73156323,
      "title": "Internal Error: EACCES: permission denied, symlink &#39;../lib/node_modules/corepack/dist/pnpm.js&#39; -&gt; &#39;/usr/local/bin/pnpm&#39;",
      "problem": "I'm trying to enable 'corepack' by running\n```\n`corepack enable\n`\n```\naccording to the directions here: https://yarnpkg.com/getting-started/install\nbut getting this error\n\nInternal Error: EACCES: permission denied, symlink '../lib/node_modules/corepack/dist/pnpm.js' -> '/usr/local/bin/pnpm'\n\nHow to fix this?",
      "solution": "For whatever reason the downloaded `node` gave me all sorts of permission issues. What does work is using `nvm` to install `node`.\nFirst install `nvm` using these directions https://tecadmin.net/install-nvm-macos-with-homebrew/\nThen follow these next steps:\n\nnvm install --lts\n\ncorepack enable\n\nyarn",
      "question_score": 18,
      "answer_score": 3,
      "created_at": "2022-07-28T18:39:23",
      "url": "https://stackoverflow.com/questions/73156323/internal-error-eacces-permission-denied-symlink-lib-node-modules-corepack"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 71835029,
      "title": "Suddenly React cannot execute the &#39;create-react-app&#39; command. Why is this happening and how can I solve it?",
      "problem": "Even --force or --legacy-peer-deps didn't work.\nTranscript:\n`npx create-react-app my-app\n\nCreating a new React app in /home/zahid/my-app.\n\nInstalling packages. This might take a couple of minutes.\nInstalling react, react-dom, and react-scripts with cra-template...\n\nadded 1353 packages in 2m\n\n171 packages are looking for funding\n  run `npm fund` for details\n\nInitialized a git repository.\n\nInstalling template dependencies using npm...\nnpm ERR! code ERESOLVE\nnpm ERR! ERESOLVE unable to resolve dependency tree\nnpm ERR!\nnpm ERR! While resolving: my-app@0.1.0\nnpm ERR! Found: react@18.0.0\nnpm ERR! node_modules/react\nnpm ERR!   react@\"^18.0.0\" from the root project\nnpm ERR!\nnpm ERR! Could not resolve dependency:\nnpm ERR! peer react@\"",
      "solution": "Try to run this first:\n`npm config set legacy-peer-deps true\n`\nAnd try your command again.\nIt worked with me!",
      "question_score": 18,
      "answer_score": 1,
      "created_at": "2022-04-12T00:32:18",
      "url": "https://stackoverflow.com/questions/71835029/suddenly-react-cannot-execute-the-create-react-app-command-why-is-this-happen"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 66373352,
      "title": "Bitbucket pipeline Your system is missing the dependency: Xvfb",
      "problem": "I'm trying to add cypress to the bitbucket pipeline but it tells me that I need to install Xvfb and I don't know how to keep going. This is my bitbucket.pipelines.yml\n```\n`#  Template NodeJS build\n\n#  This template allows you to validate your NodeJS code.\n#  The workflow allows running tests and code linting on the default branch.\n\nimage: node:14.15.4\n\npipelines:\n  default:\n    - step:\n        name: Build\n        script:\n          - npm install\n          - npm run lint\n          - npm run cypress:run\n`\n```\nThis is my package.json scripts\n```\n`\"scripts\": {\n    \"cypress:open\": \"cypress open\",\n    \"cypress:run\": \"npx cypress run --record --key xxxxxxxxxxxx\"\n}\n`\n```\nand the test are running fine locally\n\nBut in the pipeline I'm getting this error:\n```\n`+ npm run cypress:run\n> wallet-frontend@0.1.0 cypress:run /opt/atlassian/pipelines/agent/build\n> npx cypress run --record --key 70004462-62d4-42ce-b359-5bff73d8b001\nIt looks like this is your first time using Cypress: 6.5.0\n[16:30:09]  Verifying Cypress can run /root/.cache/Cypress/6.5.0/Cypress [started]\n[16:30:09]  Verifying Cypress can run /root/.cache/Cypress/6.5.0/Cypress [failed]\nYour system is missing the dependency: Xvfb\nInstall Xvfb and run Cypress again.\nRead our documentation on dependencies for more information:\nhttps://on.cypress.io/required-dependencies\nIf you are using Docker, we provide containers with all required dependencies installed.\n----------\nError: spawn Xvfb ENOENT\n----------\nPlatform: linux (Debian - 9.13)\nCypress Version: 6.5.0\nnpm ERR! code ELIFECYCLE\nnpm ERR! errno 1\nnpm ERR! wallet-frontend@0.1.0 cypress:run: `npx cypress run --record --key xxxxxxxxx`\nnpm ERR! Exit status 1\nnpm ERR! \nnpm ERR! Failed at the wallet-frontend@0.1.0 cypress:run script.\nnpm ERR! This is probably not a problem with npm. There is likely additional logging output above.\n`\n```",
      "solution": "Xvfb is an in-memory display server for a UNIX-like operating system, in your case Linux (Debian - 9.13). This is a system-level dependency that cypress assumes is installed beforehand. In the case of bitbucket env, this is not installed and hence this error. This is primarily used for Display (UI) in case of headed browsers while running cypress.\nThere are few easy workarounds here:\n\nInstalling the dependency manually: I won't suggest this as you might miss out few more dependencies unless you thoroughly look into all the dependencies.\n\nRun headless browsers:: Headless browsers don't use Xvfb, so won't be facing this exact error but as I said in point 1, there can be other issues. Command will become `cypress run --headless`\n\nUse Cypress provided Docker images (Suggested): I can see that you are using the `node:14.15.4` image for this build. Instead of that, use a cypress provided official base images for whatever node version you want to run (Look for different node version in tags). If you look into the Dockerfile, you will see that they have taken an effort to install the dependencies needed to run Cypress inside the docker (You can see Xvfb there).\n\nAlso, look for already open issues when you get stuck in cypress-related issues, they have a very active and helpful issues section. I found this same issue in there: https://github.com/cypress-io/cypress/issues/14457",
      "question_score": 18,
      "answer_score": 19,
      "created_at": "2021-02-25T18:18:55",
      "url": "https://stackoverflow.com/questions/66373352/bitbucket-pipeline-your-system-is-missing-the-dependency-xvfb"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 68339098,
      "title": "When I run `ng new`, npm has a dependency problem",
      "problem": "i ran `ng new` in terminal. I ended up getting an npm error\n\nnew folder\nrun `ng new` in new folder\nset the name and accept defaults (and use SCSS)\nwatch it create files and error at the end\n\n```\n`\u2838 Installing packages (npm)...npm ERR! code ERESOLVE\nnpm ERR! ERESOLVE unable to resolve dependency tree\nnpm ERR! \nnpm ERR! While resolving: project-name@0.0.0\nnpm ERR! Found: jasmine-core@3.7.1\nnpm ERR! node_modules/jasmine-core\nnpm ERR!   dev jasmine-core@\"~3.7.0\" from the root project\nnpm ERR! \nnpm ERR! Could not resolve dependency:\nnpm ERR! peer jasmine-core@\">=3.8\" from karma-jasmine-html-reporter@1.7.0\nnpm ERR! node_modules/karma-jasmine-html-reporter\nnpm ERR!   dev karma-jasmine-html-reporter@\"^1.5.0\" from the root project\nnpm ERR! \nnpm ERR! Fix the upstream dependency conflict, or retry\nnpm ERR! this command with --force, or --legacy-peer-deps\nnpm ERR! to accept an incorrect (and potentially broken) dependency resolution.\nnpm ERR! \nnpm ERR! See /Users/user/.npm/eresolve-report.txt for a full report.\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     /Users/user/.npm/_logs/2021-07-11T18_12_50_796Z-debug.log\n\u2716 Package install failed, see above.\nThe Schematic workflow failed. See above.\n`\n```",
      "solution": "I had this same issue with a fresh project, etc.\nIn the generated `package.json` you should see a line that says `\"jasmine-core\": \"~3.7.0\"` but it seems that other dependencies (I believe `karma` based on the error output here) require `jasmine-core` at 3.8.0 or higher. Simply edit the line that says `\"jasmine-core\": \"~3.7.0\",` to be `\"jasmine-core\": \"~3.8.0\",` and then manually run `npm install` and it should succeed.\nYou should then be able to run `ng serve --open` from the same directory and have it run just fine.",
      "question_score": 17,
      "answer_score": 55,
      "created_at": "2021-07-11T20:44:24",
      "url": "https://stackoverflow.com/questions/68339098/when-i-run-ng-new-npm-has-a-dependency-problem"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 71916289,
      "title": "React Native: &#39;Component&#39; cannot be used as a JSX component. Type &#39;{}&#39; is not assignable to type &#39;ReactNode&#39;",
      "problem": "I just started a new project but i'm getting the following error with various packages, for example React Native Reanimated and React Navigation Stack.\nThis is my package.json.\n```\n`{\n  \"name\": \"foodmatch\",\n  \"version\": \"1.0.0\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"start\": \"expo start --dev-client\",\n    \"android\": \"expo run:android\",\n    \"ios\": \"expo run:ios\",\n    \"web\": \"expo start --web\",\n    \"prepare\": \"yarn husky install\",\n    \"lint\": \"yarn eslint --ext .tsx --ext .ts src/ --fix\",\n    \"format\": \"yarn prettier --write ./src\"\n  },\n  \"lint-staged\": {\n    \"src/**/*.{ts,tsx}\": [\n      \"eslint --ext .tsx --ext .ts src/ --fix\"\n    ],\n    \"./src/**\": [\n      \"prettier --write ./src\"\n    ]\n  },\n  \"husky\": {\n    \"hooks\": {\n      \"pre-commit\": \"lint-staged\"\n    }\n  },\n  \"dependencies\": {\n    \"@react-navigation/native\": \"^6.0.10\",\n    \"@react-navigation/stack\": \"^6.2.1\",\n    \"expo\": \"~44.0.2\",\n    \"expo-app-loading\": \"~1.3.0\",\n    \"expo-font\": \"^10.0.5\",\n    \"expo-splash-screen\": \"~0.14.1\",\n    \"expo-status-bar\": \"~1.2.0\",\n    \"react\": \"17.0.1\",\n    \"react-dom\": \"17.0.1\",\n    \"react-native\": \"0.64.3\",\n    \"react-native-gesture-handler\": \"~2.1.0\",\n    \"react-native-reanimated\": \"~2.3.1\",\n    \"react-native-responsive-fontsize\": \"^0.5.1\",\n    \"react-native-safe-area-context\": \"3.3.2\",\n    \"react-native-web\": \"0.17.1\",\n    \"styled-components\": \"^5.3.5\"\n  },\n  \"devDependencies\": {\n    \"@babel/core\": \"^7.12.9\",\n    \"@types/react\": \"~17.0.21\",\n    \"@types/react-native\": \"~0.64.12\",\n    \"@types/styled-components-react-native\": \"^5.1.3\",\n    \"@typescript-eslint/eslint-plugin\": \"^5.20.0\",\n    \"@typescript-eslint/parser\": \"^5.20.0\",\n    \"babel-plugin-module-resolver\": \"^4.1.0\",\n    \"eslint\": \"^8.13.0\",\n    \"eslint-config-airbnb\": \"^19.0.4\",\n    \"eslint-config-prettier\": \"^8.5.0\",\n    \"eslint-plugin-import\": \"^2.26.0\",\n    \"eslint-plugin-jsx-a11y\": \"^6.5.1\",\n    \"eslint-plugin-prettier\": \"^4.0.0\",\n    \"eslint-plugin-react\": \"^7.29.4\",\n    \"eslint-plugin-react-hooks\": \"^4.4.0\",\n    \"husky\": \"^7.0.4\",\n    \"lint-staged\": \"^12.3.8\",\n    \"prettier\": \"^2.6.2\",\n    \"typescript\": \"~4.3.5\"\n  },\n  \"private\": true\n}\n`\n```\nThis is the error.\n```\n`'Navigator' cannot be used as a JSX component.\n  Its element type 'ReactElement | Component & { id?: string | undefined; children: ReactNode; screenListeners?: Partial | ... 1 more ... | undefined; screenOptions?: StackNavigationOptions | ... 1 more ... | undefined; defaultScreenOptions?: StackNavigationOptions | ... 1 more ... | und...' is not a valid JSX element.\n    Type 'Component & { id?: string | undefined; children: ReactNode; screenListeners?: Partial; ... 7 more ...; beforeRemove: EventListenerCallback; }> | ((props: { ...; }) => Partial) | undefined;...' is not assignable to type 'Element | ElementClass | null'.\n      Type 'Component & { id?: string | undefined; children: ReactNode; screenListeners?: Partial; ... 7 more ...; beforeRemove: EventListenerCallback; }> | ((props: { ...; }) => Partial) | undefined;...' is not assignable to type 'ElementClass'.\n        The types returned by 'render()' are incompatible between these types.\n          Type 'React.ReactNode' is not assignable to type 'import(\"D:/Users/bilug/Documents/Repositorios/foodMatch/node_modules/@types/react-native/node_modules/@types/react/index\").ReactNode'.\n            Type '{}' is not assignable to type 'ReactNode'.\n`\n```\n```\n`'Animated.View' cannot be used as a JSX component.\n  Its instance type 'View' is not a valid JSX element.\n    The types returned by 'render()' are incompatible between these types.\n      Type 'React.ReactNode' is not assignable to type 'import(\"D:/Users/bilug/Documents/Repositorios/foodMatch/node_modules/@types/react-native/node_modules/@types/react/index\").ReactNode'.\n        Type '{}' is not assignable to type 'ReactNode'.ts(2786)\n`\n```\nI have a project with the same packages and configuration (babel, eslint, etc) and it works fine, it looks like a type error because the project works just like it is intended to, but IntelliSense claims these errors.\nI also get the following when i try to use one of the components with Styled() from styled-components.\n```\n`No overload matches this call.\n  Overload 1 of 2, '(component: AnyStyledComponent): ThemedStyledFunction', gave the following error.\n    Argument of type 'typeof Text' is not assignable to parameter of type 'AnyStyledComponent'.\n      Type 'typeof Text' is not assignable to type 'StyledComponent'.\n        Type 'typeof Text' is not assignable to type 'string'.\n  Overload 2 of 2, '(component: ComponentType): ThemedStyledFunction, DefaultTheme, {}, never>', gave the following error.\n    Argument of type 'typeof Text' is not assignable to parameter of type 'ComponentType'.\n      Type 'typeof Text' is not assignable to type 'ComponentClass'.\n        Types of property 'contextType' are incompatible.\n          Type 'React.Context | undefined' is not assignable to type 'import(\"D:/Users/bilug/Documents/Repositorios/foodMatch/node_modules/@types/react-native/node_modules/@types/react/index\").Context | undefined'.\n            Type 'React.Context' is not assignable to type 'import(\"D:/Users/bilug/Documents/Repositorios/foodMatch/node_modules/@types/react-native/node_modules/@types/react/index\").Context'.\n              The types of 'Provider.propTypes' are incompatible between these types.\n                Type 'React.WeakValidationMap> | undefined' is not assignable to type 'import(\"D:/Users/bilug/Documents/Repositorios/foodMatch/node_modules/@types/react-native/node_modules/@types/react/index\").WeakValidationMap> | undefined'.\n                  Type 'React.WeakValidationMap>' is not assignable to type 'import(\"D:/Users/bilug/Documents/Repositorios/foodMatch/node_modules/@types/react-native/node_modules/@types/react/index\").WeakValidationMap>'.\n                    Types of property 'children' are incompatible.\n                      Type 'React.Validator | undefined' is not assignable to type 'import(\"D:/Users/bilug/Documents/Repositorios/foodMatch/node_modules/@types/react-native/node_modules/@types/react/index\").Validator | undefined'.\n                        Type 'React.Validator' is not assignable to type 'import(\"D:/Users/bilug/Documents/Repositorios/foodMatch/node_modules/@types/prop-types/index\").Validator'.\n                          Type 'React.ReactNode' is not assignable to type 'import(\"D:/Users/bilug/Documents/Repositorios/foodMatch/node_modules/@types/react-native/node_modules/@types/react/index\").ReactNode'.\n                            Type '{}' is not assignable to type 'ReactNode'.ts(2769)\n`\n```",
      "solution": "Adding `@types/react` to `resolutions` in package.json fixed it:\n`\"resolutions\": { \"@types/react\": \"17.0.43\" }\n`\n\nhttps://github.com/react-navigation/react-navigation/issues/10507\nhttps://github.com/DefinitelyTyped/DefinitelyTyped/issues/59765#issuecomment-1092891129",
      "question_score": 17,
      "answer_score": 33,
      "created_at": "2022-04-18T21:34:53",
      "url": "https://stackoverflow.com/questions/71916289/react-native-component-cannot-be-used-as-a-jsx-component-type-is-not-as"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 66341741,
      "title": "Npm workspaces - call workspace script from root package",
      "problem": "I'm struggling with multiple npm packages in a root git repository with custom dev scripts to handle launch, compile, build and so on. Now I came across npm workspaces and wanted to use this stunning new feature in my following project structure but I can't get it to work:\n```\n`projectx (root)\n- package.json\n- apps   \n -- backend\n   -- src\n   -- package.json (name: @projectx/backend, scripts: \"dev\":\"ts-node or whatever\")\n -- common\n   -- src\n   -- package.json (name: @projectx/common)\n -- frontend\n   -- src\n   -- package.json (name: @projectx/frontend, scripts: \"dev\":\"webpack\")\n`\n```\nMy root package.json contains:\n```\n`    {\n  \"name\": \"packagex\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"private\": \"true\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\",\n    \"back:dev\": \"npm workspace @projectx/backend dev\",\n    \"front:dev\": \"npm workspace @projectx/frontend dev\",\n    \"dev\": \"run-p back:dev front:dev\"\n  },\n  \"workspaces\": [\n    \"apps/*\"\n  ],\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"git_url\"\n  },\n  \"author\": \"me\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"npm-run-all\": \"^4.1.5\"\n  }\n}\n`\n```\nAnd now I want to start backend and frontend with npm-run-all and the command on root: npm run dev which results in:\n\nAnd I also want to share the common package with backend and frontend, which should be possible in this case. Maybe anobody else is facing the same problem or has some ideas what I am doing wrong here.",
      "solution": "Your `\"workspaces\"` property in package.json looks right. I'm using NPM Workspaces and it's working well, but it's still missing a lot of features so you need to wire things up yourself. I also don't think `npm worksace` is a command (but maybe for the future?), so here's a checklist to get it to work:\n\nMake sure you're using Node 15+ and NPM 7+\nSet all package.json to `\"private\": true,`\nDelete all `package-lock.json` inside of your project, go to the root, then `npm install`. It should generate one root level `package-lock.json` that contains all dependencies for your workspaces\nSince you're using `npm-run-all`, add this to your scripts:\n\n```\n`  \"scripts\": {\n    \"back:dev\": \"cd apps/backend && npm run dev\",\n    \"front:dev\": \"cd apps/fontend && npm run dev\",\n    \"dev\": \"npm-run-all build --parallel back:dev front:dev\"\n  }\n`\n```\nThen start it with `npm run dev`.\nNote, you may want to consider using `start` scripts instead of `dev` to shorten the command you need to type (e.g. `npm start` instead of `npm run dev`), but `npm run dev` will still be fine.",
      "question_score": 17,
      "answer_score": 11,
      "created_at": "2021-02-23T23:00:44",
      "url": "https://stackoverflow.com/questions/66341741/npm-workspaces-call-workspace-script-from-root-package"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 71119253,
      "title": "Getting errors while installing node-sass",
      "problem": "When I install `node-sass` for a React project, it gives me the error below. I tried lot of things but none did work. I tried to delete it and install it again, I tried to start a new project but it's still not working. I updated everything to the last version: node.js to `v16.14.0` and npm to `v8.3.1`.\n```\n`npm ERR! code 1\nnpm ERR! path C:\\Users\\XXXXX\\Documents\\GitHub\\XXXXX\\Frontend\\node_modules\\node-sass\nnpm ERR! command failed\nnpm ERR! command C:\\Windows\\system32\\cmd.exe /d /s /c node scripts/build.js\nnpm ERR! Building: C:\\Program Files\\nodejs\\node.exe C:\\Users\\XXXXX\\Documents\\GitHub\\XXXXX\\Frontend\\node_modules\\node-gyp\\bin\\node-gyp.js rebuild --verbose --libsass_ext= --libsass_cflags= --libsass_ldflags= --libsass_library=\nnpm ERR! gyp info it worked if it ends with ok\nnpm ERR! gyp verb cli [\nnpm ERR! gyp verb cli   'C:\\\\Program Files\\\\nodejs\\\\node.exe',\nnpm ERR! gyp verb cli   'C:\\\\Users\\\\XXXXX\\\\Documents\\\\GitHub\\\\XXXXX\\\\Frontend\\\\node_modules\\\\node-gyp\\\\bin\\\\node-gyp.js',\nnpm ERR! gyp verb cli   'rebuild',\nnpm ERR! gyp verb cli   '--verbose',\nnpm ERR! gyp verb cli   '--libsass_ext=',\nnpm ERR! gyp verb cli   '--libsass_cflags=',\nnpm ERR! gyp verb cli   '--libsass_ldflags=',\nnpm ERR! gyp verb cli   '--libsass_library='\nnpm ERR! gyp verb cli ]\nnpm ERR! gyp info using node-gyp@3.8.0\nnpm ERR! gyp info using node@16.14.0 | win32 | x64\nnpm ERR! gyp verb command rebuild []\nnpm ERR! gyp verb command clean []\nnpm ERR! gyp verb clean removing \"build\" directory\nnpm ERR! gyp verb command configure []\nnpm ERR! gyp verb download using dist-url https://npm.taobao.org/dist\nnpm ERR! gyp verb check python checking for Python executable \"python2\" in the PATH\nnpm ERR! gyp verb `which` failed Error: not found: python2\nnpm ERR! gyp verb `which` failed     at getNotFoundError (C:\\Users\\XXXXX\\Documents\\GitHub\\XXXXX\\Frontend\\node_modules\\node-gyp\\node_modules\\which\\which.js:13:12)\nnpm ERR! gyp verb `which` failed     at F (C:\\Users\\XXXXX\\Documents\\GitHub\\XXXXX\\Frontend\\node_modules\\node-gyp\\node_modules\\which\\which.js:68:19)\nnpm ERR! gyp verb `which` failed     at E (C:\\Users\\XXXXX\\Documents\\GitHub\\XXXXX\\Frontend\\node_modules\\node-gyp\\node_modules\\which\\which.js:80:29)\nnpm ERR! gyp verb `which` failed     at C:\\Users\\XXXXX\\Documents\\GitHub\\XXXXX\\Frontend\\node_modules\\node-gyp\\node_modules\\which\\which.js:89:16\nnpm ERR! gyp verb `which` failed     at C:\\Users\\XXXXX\\Documents\\GitHub\\XXXXX\\Frontend\\node_modules\\isexe\\index.js:42:5\nnpm ERR! gyp verb `which` failed     at C:\\Users\\XXXXX\\Documents\\GitHub\\XXXXX\\Frontend\\node_modules\\isexe\\windows.js:36:5\nnpm ERR! gyp verb `which` failed     at FSReqCallback.oncomplete (node:fs:198:21)\nnpm ERR! gyp verb `which` failed  python2 Error: not found: python2\nnpm ERR! gyp verb `which` failed     at getNotFoundError (C:\\Users\\XXXXX\\Documents\\GitHub\\XXXXX\\Frontend\\node_modules\\node-gyp\\node_modules\\which\\which.js:13:12)\nnpm ERR! gyp verb `which` failed     at F (C:\\Users\\XXXXX\\Documents\\GitHub\\XXXXX\\Frontend\\node_modules\\node-gyp\\node_modules\\which\\which.js:68:19)\nnpm ERR! gyp verb `which` failed     at E (C:\\Users\\XXXXX\\Documents\\GitHub\\XXXXX\\Frontend\\node_modules\\node-gyp\\node_modules\\which\\which.js:80:29)\nnpm ERR! gyp verb `which` failed     at C:\\Users\\XXXXX\\Documents\\GitHub\\XXXXX\\Frontend\\node_modules\\node-gyp\\node_modules\\which\\which.js:89:16\nnpm ERR! gyp verb `which` failed     at C:\\Users\\XXXXX\\Documents\\GitHub\\XXXXX\\Frontend\\node_modules\\isexe\\index.js:42:5\nnpm ERR! gyp verb `which` failed     at C:\\Users\\XXXXX\\Documents\\GitHub\\XXXXX\\Frontend\\node_modules\\isexe\\windows.js:36:5\nnpm ERR! gyp verb `which` failed     at FSReqCallback.oncomplete (node:fs:198:21) {\nnpm ERR! gyp verb `which` failed   code: 'ENOENT'\nnpm ERR! gyp verb `which` failed }\nnpm ERR! gyp verb check python checking for Python executable \"python\" in the PATH\nnpm ERR! gyp verb `which` succeeded python C:\\Python27\\python.EXE\nnpm ERR! gyp verb check python version `C:\\Python27\\python.EXE -c \"import sys; print \"2.7.15\nnpm ERR! gyp verb check python version .%s.%s\" % sys.version_info[:3];\"` returned: %j\nnpm ERR! gyp verb get node dir no --target version specified, falling back to host node version: 16.14.0\nnpm ERR! gyp verb command install [ '16.14.0' ]\nnpm ERR! gyp verb download using dist-url https://npm.taobao.org/dist\nnpm ERR! gyp verb install input version string \"16.14.0\"\nnpm ERR! gyp verb install installing version: 16.14.0\nnpm ERR! gyp verb install --ensure was passed, so won't reinstall if already installed\nnpm ERR! gyp verb install version is already installed, need to check \"installVersion\"\nnpm ERR! gyp verb got \"installVersion\" 9\nnpm ERR! gyp verb needs \"installVersion\" 9\nnpm ERR! gyp verb install version is good\nnpm ERR! gyp verb get node dir target node version installed: 16.14.0\nnpm ERR! gyp verb build dir attempting to create \"build\" dir: C:\\Users\\XXXXX\\Documents\\GitHub\\XXXXX\\Frontend\\node_modules\\node-sass\\build\nnpm ERR! gyp verb build dir \"build\" dir needed to be created? C:\\Users\\XXXXX\\Documents\\GitHub\\XXXXX\\Frontend\\node_modules\\node-sass\\build\nnpm ERR! gyp verb find vs2017 Found installation at: C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\nnpm ERR! gyp verb find vs2017   - Found Microsoft.VisualStudio.Component.Windows10SDK.19041\nnpm ERR! gyp verb find vs2017   - Found Microsoft.VisualStudio.Component.VC.Tools.x86.x64\nnpm ERR! gyp verb find vs2017   - Found Microsoft.VisualStudio.VC.MSBuild.Base\nnpm ERR! gyp verb find vs2017   - Using this installation with Windows 10 SDK\nnpm ERR! gyp verb find vs2017 using installation: C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\nnpm ERR! gyp verb build/config.gypi creating config file\nnpm ERR! gyp verb build/config.gypi writing out config file: C:\\Users\\XXXXX\\Documents\\GitHub\\XXXXX\\Frontend\\node_modules\\node-sass\\build\\config.gypi\nnpm ERR! (node:20452) [DEP0150] DeprecationWarning: Setting process.config is deprecated. In the future the property will be read-only.\nnpm ERR! (Use `node --trace-deprecation ...` to show where the warning was created)\nnpm ERR! gyp verb config.gypi checking for gypi file: C:\\Users\\XXXXX\\Documents\\GitHub\\XXXXX\\Frontend\\node_modules\\node-sass\\config.gypi\nnpm ERR! gyp verb common.gypi checking for gypi file: C:\\Users\\XXXXX\\Documents\\GitHub\\XXXXX\\Frontend\\node_modules\\node-sass\\common.gypi\nnpm ERR! gyp verb gyp gyp format was not specified; forcing \"msvs\"\nnpm ERR! gyp info spawn C:\\Python27\\python.EXE\nnpm ERR! gyp info spawn args [\nnpm ERR! gyp info spawn args   'C:\\\\Users\\\\XXXXX\\\\Documents\\\\GitHub\\\\XXXXX\\\\Frontend\\\\node_modules\\\\node-gyp\\\\gyp\\\\gyp_main.py',\nnpm ERR! gyp info spawn args   'binding.gyp',\nnpm ERR! gyp info spawn args   '-f',\nnpm ERR! gyp info spawn args   'msvs',\nnpm ERR! gyp info spawn args   '-G',\nnpm ERR! gyp info spawn args   'msvs_version=2015',\nnpm ERR! gyp info spawn args   '-I',\nnpm ERR! gyp info spawn args   'C:\\\\Users\\\\XXXXX\\\\Documents\\\\GitHub\\\\XXXXX\\\\Frontend\\\\node_modules\\\\node-sass\\\\build\\\\config.gypi',\nnpm ERR! gyp info spawn args   '-I',\nnpm ERR! gyp info spawn args   'C:\\\\Users\\\\XXXXX\\\\Documents\\\\GitHub\\\\XXXXX\\\\Frontend\\\\node_modules\\\\node-gyp\\\\addon.gypi',\nnpm ERR! gyp info spawn args   '-I',\nnpm ERR! gyp info spawn args   'C:\\\\Users\\\\XXXXX\\\\.node-gyp\\\\16.14.0\\\\include\\\\node\\\\common.gypi',\nnpm ERR! gyp info spawn args   '-Dlibrary=shared_library',\nnpm ERR! gyp info spawn args   '-Dvisibility=default',\nnpm ERR! gyp info spawn args   '-Dnode_root_dir=C:\\\\Users\\\\XXXXX\\\\.node-gyp\\\\16.14.0',\nnpm ERR! gyp info spawn args   '-Dnode_gyp_dir=C:\\\\Users\\\\XXXXX\\\\Documents\\\\GitHub\\\\XXXXX\\\\Frontend\\\\node_modules\\\\node-gyp',\nnpm ERR! gyp info spawn args   '-Dnode_lib_file=C:\\\\Users\\\\XXXXX\\\\.node-gyp\\\\16.14.0\\\\\nnpm ERR! Build failed with error code: 7\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     C:\\Users\\XXXXX\\AppData\\Local\\npm-cache\\_logs\\2022-02-14T22_43_35_171Z-debug-0.log\n`\n```",
      "solution": "Just change the node version to v14.x.x\nOr you may try installing newer versions of node-gpy\nHere, read this issue:\nhttps://github.com/sass/node-sass/issues/3117",
      "question_score": 17,
      "answer_score": 14,
      "created_at": "2022-02-15T00:01:37",
      "url": "https://stackoverflow.com/questions/71119253/getting-errors-while-installing-node-sass"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 66574531,
      "title": "ERROR: Dependency @types/html2canvas must be explicitly allowed using the &quot;allowedNonPeerDependencies&quot; option",
      "problem": "I have installed the html2canvas in my angular library project and, when I compile in production mode (running the `ng build --prod` command), I'm receiving the following error:\n\nERROR: Dependency @types/html2canvas must be explicitly allowed using\nthe \"allowedNonPeerDependencies\" option.\n\nHow can I solve it?",
      "solution": "You can add the library to your peerDependencies in `package.json`. I strongly recommend using the  peerDependencies strategy since exposes explicitly to others that your library depended on other libraries:\n```\n`{\n    ...\n    \"scripts\": {...},\n    \"peerDependencies\": {\n        ...\n        \"@types/html2canvas\": \"0.0.36\",\n        ...\n    },\n}\n`\n```\nOr you can use the option on your ng-package.json:\n```\n`{\n    ...\n    \"lib\": {\n        \"entryFile\": \"src/public-api.ts\"\n    },\n    \"allowedNonPeerDependencies\": [\n        \"@type/html2canvas\"\n    ]\n    ...\n}\n`\n```",
      "question_score": 17,
      "answer_score": 35,
      "created_at": "2021-03-11T00:49:23",
      "url": "https://stackoverflow.com/questions/66574531/error-dependency-types-html2canvas-must-be-explicitly-allowed-using-the-allow"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 70952903,
      "title": "NPM / Error: EACCES: permission denied, scandir",
      "problem": "when i type \"npm run build:prod\"\n```\n`build:prod\n    npm run build -- --configuration production --aot --optimization=false\n`\n```\ni get this error :\n```\n`> fancy-name@0.0.0 build:prod\n> npm run build -- --configuration production --aot --optimization=false\n\nglob error [Error: EACCES: permission denied, scandir '/root/.npm/_logs'] {\n errno: -13,\n code: 'EACCES',\n syscall: 'scandir',\n path: '/root/.npm/_logs'\n}\nnpm WARN logfile Error: EACCES: permission denied, scandir '/root/.npm/_logs'\nnpm WARN logfile  error cleaning log files [Error: EACCES: permission denied, scandir '/root/.npm/_logs'] {\nnpm WARN logfile   errno: -13,\nnpm WARN logfile   code: 'EACCES',\nnpm WARN logfile   syscall: 'scandir',\nnpm WARN logfile   path: '/root/.npm/_logs'\nnpm WARN logfile }\n\u2e28\u2802\u2802\u2802\u2802\u2802\u2802\u2802\u2802\u2802\u2802\u2802\u2802\u2802\u2802\u2802\u2802\u2802\u2802\u2e29 \u2819 : WARN logfile Error: EACCES: permission denied, scandir '/root/.npm/_logs'\n> fancy-name@0.0.0 build\n> ng build \"--configuration\" \"production\" \"--aot\" \"--optimization=false\"\n\nNode.js version v17.4.0 detected.file Error: EACCES: permission denied, scandir '/root/.npm/_logs'\nOdd numbered Node.js versions will not enter LTS status and should not be used for production. For more information, please see https://nodejs.org/en/about/releases/.\nThis version of CLI is only compatible with Angular versions ^13.0.0-next || >=13.0.0 i already try to delete node_module & package.json and run `NPM install` again, but it didnt work\n(Linux 4.19.0-16-cloud-amd64)\nEDIT : solved with `chown -R root /path/of/your/project`",
      "solution": "Update: this problem and the answer below only applies to NPM 7 and 8 (more info).\nThis quickfix should remove the issue by installing an NPM version >= 9.\n```\n`npm install -g npm@latest\n`\n```\n\nOriginal answer (applies to NPM 7 and 8 shipped with Node 15-19)\nThis is understandably a confusing error; you run `npm` as root, and yet it says you do not have access to the files? There is a good reason :) These questions are essentially about the same thing:\n\nGetting EACCESS when running NPM 8 as root\nBower install EACCESS error\n\nMy quite long answer goes into details on what is happening, but the essence is this:\n\n(NPM) ... uses this bit of code to determine who to run as:\n`const { uid, gid } = isRoot ? inferOwner.sync(cwd) : {}`\nand as the docs of infer-owner module says:\nInfer the owner of a path based on the owner of its nearest existing parent\n\nSo if you are running NPM as root you need to change the owner of the current directory to root as well:\n```\n`chown -R root /path/of/your/project\n`\n```\nBut all this trouble should point you to the real solution: do not run NPM as root. You have no idea what kind of scripts might run as a `postinstall` trigger or similar. Be safe; only use the root account when necessary using `sudo`.\nAddendum: try version 6 or >= 9 of NPM\nAs mentioned in the linked answer:\n\nThis behavior is only for NPM versions 7 and 8. NPM versions \n\nSo some quick fixes would be\n\n`npm install -g npm@latest # Use the latest version of NPM`\n`npm install -g nvm && nvm use 14 # Note: End of Life on May 2023`\n`npm install -g nvm && nvm use 18 # Uses NPM 9, too new for some deps?`",
      "question_score": 17,
      "answer_score": 28,
      "created_at": "2022-02-02T10:04:22",
      "url": "https://stackoverflow.com/questions/70952903/npm-error-eacces-permission-denied-scandir"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 72375701,
      "title": "Multiple React versions in a monorepo, is it possible?",
      "problem": "I have this monorepo, built using npm workspaces:\n```\n`\u251c\u2500 lib\n\u2502  \u2514\u2500 Foo\n\u2514\u2500 src\n   \u251c\u2500 App\n   \u2514\u2500 Web\n`\n```\nI want to update `Web` to React 18 while leaving `App` at React 17\nCurrently (and working), my dependencies are:\n```\n`\u251c\u2500 lib\n\u2502  \u2514\u2500 Foo\n\u251c\u2500 src\n\u2502  \u251c\u2500 App\n\u2502  \u2502   \u251c\u2500 node_modules     After I attempt to split versions, my dependencies are now:\n```\n`\u251c\u2500 lib\n\u2502  \u2514\u2500 Foo\n\u251c\u2500 src\n\u2502  \u251c\u2500 App\n\u2502  \u2502   \u251c\u2500 node_modules     =17              \n\u2502      \u251c\u2500 react@17    \n\u2502      \u2514\u2500 react-dom@17    \n\u2514\u2500 package.json            This results in the old favourite:\n```\n`Warning: Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:\n1. You might have mismatching versions of React and the renderer (such as React DOM)\n2. You might be breaking the Rules of Hooks\n3. You might have more than one copy of React in the same app\nSee https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.\nTypeError: Cannot read properties of null (reading 'useState')\n    at useState (/src/web/node_modules/react/cjs/react.development.js:1620:21)\n    at AppContextProvider (webpack-internal:///./node_modules/bar/AppContextProvider/AppContextProvider.js:25:66)\n    at processChild (/node_modules/react-dom/cjs/react-dom-server.node.development.js:3043:14)\n    at resolve (/node_modules/react-dom/cjs/react-dom-server.node.development.js:2960:5)\n    at ReactDOMServerRenderer.render (/node_modules/react-dom/cjs/react-dom-server.node.development.js:3435:22)\n    at ReactDOMServerRenderer.read (/node_modules/react-dom/cjs/react-dom-server.node.development.js:3373:29)\n    at Object.renderToString (/node_modules/react-dom/cjs/react-dom-server.node.development.js:3988:27)\n    at Object.renderPage (/node_modules/next/dist/server/render.js:804:45)\n    at Object.defaultGetInitialProps (/node_modules/next/dist/server/render.js:391:51)\n`\n```\nWhich I think is caused by `./node_modules/react-dom@17` clashing with `./src/web/node_modules/react@18`\nIs what I want to achieve even possible?",
      "solution": "The answer is to use `overrides`, which has been available since `npm 8.?.?`. I add the question marks as I'm not sure exactly when it appeared, but it does not work on earlier iterations of version 8. It certainly works on `8.5.5`\n`package.json`\n`{\n    ....\n    \"overrides\": {\n        \"App\": {\n            \"react\": \"17.0.0\"\n        },\n        \"Web\": {\n            \"react\": \"18.0.0\"\n        }\n    }\n}\n`\n`$ npm ls react\n\nmono@1.0.0 /dev/mono\n\u251c\u2500\u252c app@0.0.1 -> ./app\n\u2502 \u2514\u2500\u2500 react@17.0.0\n\u251c\u2500\u252c web@0.0.1 -> ./web\n\u2502 \u2514\u2500\u2500 react@18.0.0\n...\n`\nOne thing to note is that this will affect nested dependencies too. You could extend the overrides to retain the other versions by extensively specifying every version for every affected dependency, but I have had no issues without this so far, except for the repeated warnings generated by `npm ls react`, eg:\n`\u251c\u2500\u252c @testing-library/react@12.1.5\n\u2502 \u251c\u2500\u252c react-dom@16.14.0\n\u2502 \u2502 \u2514\u2500\u2500 react@17.0.2 deduped invalid: \"^16.14.0\" from node_modules/react-dom\n\u2502 \u2514\u2500\u2500 react@17.0.2 deduped\n`",
      "question_score": 17,
      "answer_score": 9,
      "created_at": "2022-05-25T12:11:58",
      "url": "https://stackoverflow.com/questions/72375701/multiple-react-versions-in-a-monorepo-is-it-possible"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 70325815,
      "title": "How To Setup Custom ESBuild with SCSS, PurgeCSS &amp; LiveServer?",
      "problem": "Background:\nI have a Webpack setup that I use to preprocess SCSS with PurgeCSS with a live HMR server with esbuild-loader for speeding up compiles in Webpack but even then my compile times are still slow and I would like the raw-speed of ESBuild and remove Webpack setup altogether.\nThe basic setup of ESBuild is easy, you install esbuild using npm and add the following code in your package.json:\n```\n`{\n  ...\n  \"scripts\": {\n    ...\n    \"watch\": \"esbuild --bundle src/script.js --outfile=dist/script.js --watch\"\n  },\n  ...\n}\n`\n```\nand run it by using the following command:\n```\n`npm run watch\n`\n```\nThis single-line configuration will bundle your scripts and styles (you can import style.css in script.js) and output the files in the dist directory but this doesn't allow advance configuration for ESBuild like outputting a different name for your stylesheet and script files or using plugins.\nProblems:\n\nHow to configure ESBuild using an external config file?\nESBuild doesn't support SCSS out-of-the-box. How to configure external plugins like esbuild-sass-plugin and to go even further, how to setup PostCSS and its plugins like Autoprefixer?\nHow to setup dev server with auto-rebuild?\nHow to setup PurgeCSS?",
      "solution": "Solutions:\n1. How to configure ESBuild using an external config file?\n\nCreate a new file in root: esbuild.mjs with the following contents:\n\n`import esbuild from \"esbuild\";\n\nesbuild\n    .build({\n        entryPoints: [\"src/styles/style.css\", \"src/scripts/script.js\"],\n        outdir: \"dist\",\n        bundle: true,\n        plugins: [],\n    })\n    .then(() => console.log(\"\u26a1 Build complete! \u26a1\"))\n    .catch(() => process.exit(1));\n`\n\nAdd the following code in your package.json:\n\n`{\n    ...\n    \"scripts\": {\n        ...\n        \"build\": \"node esbuild.mjs\"\n    },\n...\n}\n`\n\nRun the build by using npm run build command and this would bundle up your stylesheets and scripts and output them in dist directory.\nFor more details and/or adding custom build options, please refer to ESBuild's Build API documentation.\n\n2. ESBuild doesn't support SCSS out-of-the-box. How to configure external plugins like esbuild-sass-plugin and to go even further, how to setup PostCSS and plugins like Autoprefixer?\n\nInstall npm dependencies: `npm i -D esbuild-sass-plugin postcss autoprefixer`\nEdit your esbuild.mjs to the following code:\n\n`import esbuild from \"esbuild\";\nimport { sassPlugin } from \"esbuild-sass-plugin\";\nimport postcss from 'postcss';\nimport autoprefixer from 'autoprefixer';\n\n// Generate CSS/JS Builds\nesbuild\n    .build({\n        entryPoints: [\"src/styles/style.scss\", \"src/scripts/script.js\"],\n        outdir: \"dist\",\n        bundle: true,\n        metafile: true,\n        plugins: [\n            sassPlugin({\n                async transform(source) {\n                    const { css } = await postcss([autoprefixer]).process(source);\n                    return css;\n                },\n            }),\n        ],\n    })\n    .then(() => console.log(\"\u26a1 Build complete! \u26a1\"))\n    .catch(() => process.exit(1));\n`\n3. How to setup dev server with auto-rebuild?\n\nESBuild has a limitation on this end, you can either pass in `watch: true` or run its server. It doesn't allow both.\nESBuild also has another limitation, it doesn't have HMR support like Webpack does.\nSo to live with both limitations and still allowing a server, we can use Live Server. Install it using `npm i -D @compodoc/live-server`.\nCreate a new file in root: esbuild_watch.mjs with the following contents:\n\n`import liveServer from '@compodoc/live-server';\nimport esbuild from 'esbuild';\nimport { sassPlugin } from 'esbuild-sass-plugin';\nimport postcss from 'postcss';\nimport autoprefixer from 'autoprefixer';\n\n// Turn on LiveServer on http://localhost:7000\nliveServer.start({\n    port: 7000,\n    host: 'localhost',\n    root: '',\n    open: true,\n    ignore: 'node_modules',\n    wait: 0,\n});\n\n// Generate CSS/JS Builds\nesbuild\n    .build({\n        logLevel: 'debug',\n        metafile: true,\n        entryPoints: ['src/styles/style.scss', 'src/scripts/script.js'],\n        outdir: 'dist',\n        bundle: true,\n        watch: true,\n        plugins: [\n            sassPlugin({\n                async transform(source) {\n                    const { css } = await postcss([autoprefixer]).process(\n                        source\n                    );\n                    return css;\n                },\n            }),\n        ],\n    })\n    .then(() => console.log('\u26a1 Styles & Scripts Compiled! \u26a1 '))\n    .catch(() => process.exit(1));\n`\n\nEdit the scripts in your package.json:\n\n`{\n    ...\n    \"scripts\": {\n        ...\n        \"build\": \"node esbuild.mjs\",\n        \"watch\": \"node esbuild_watch.mjs\"\n    },\n...\n}\n`\n\nTo run build use this command `npm run build`.\nTo run dev server with auto-rebuild run `npm run watch`. This is a \"hacky\" way to do things but does a fair-enough job.\n\n4. How to setup PurgeCSS?\nI found a great plugin for this: esbuild-plugin-purgecss by peteryuan but it wasn't allowing an option to be passed for the html/views paths that need to be parsed so I\ncreated esbuild-plugin-purgecss-2 that does the job. To set it up, read below:\n\nInstall dependencies `npm i -D esbuild-plugin-purgecss-2 glob-all`.\nAdd the following code to your esbuild.mjs and esbuild_watch.mjs files:\n\n`// Import Dependencies\nimport glob from 'glob-all';\nimport purgecssPlugin2 from 'esbuild-plugin-purgecss-2';\n\nesbuild\n    .build({\n        plugins: [\n            ...\n            purgecssPlugin2({\n                content: glob.sync([\n                    // Customize the following URLs to match your setup\n                    './*.html',\n                    './views/**/*.html'\n                ]),\n            }),\n        ],\n    })\n    ...\n`\n\nNow running the `npm run build` or `npm run watch` will purgeCSS from the file paths mentioned in `glob.sync([...]` in the code above.\n\nTL;DR:\n\nCreate an external config file in root esbuild.mjs and add the command to run it in package.json inside `scripts: {..}` e.g. `\"build\": \"node esbuild.mjs\"` to reference and run the config file by using `npm run build`.\nESBuild doesn't support HMR. Also, you can either `watch` or `serve` with ESBuild, not both. To overcome, use a separate dev server library like Live Server.\nFor the complete setup, please refer to my custom-esbuild-with-scss-purgecss-and-liveserver repository on github.\n\nFinal Notes:\nI know this is a long thread but it took me a lot of time to figure these out. My intention is to have this here for others looking into the same problems and trying to figure out where to get started.\nThanks.",
      "question_score": 16,
      "answer_score": 50,
      "created_at": "2021-12-12T18:08:31",
      "url": "https://stackoverflow.com/questions/70325815/how-to-setup-custom-esbuild-with-scss-purgecss-liveserver"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 73673804,
      "title": "npm show &quot;NPM ELF : not found error&quot; in WSL",
      "problem": "i got error when running npm, i've allready try to reinstall with\n`sudo apt-get remove nodejs npm -y && sudo apt-get install nodejs npm -y`\nthis problem still exist\n```\n`/usr/bin/node: 1: ELF: not found\n/usr/bin/node: 2: : not found\n/usr/bin/node: 4: Syntax error: Unterminated quoted string\n`\n```\nim using Ubuntu WSL\n```\n`Distributor ID: Ubuntu\nDescription:    Ubuntu 22.04.1 LTS\nRelease:        22.04\nCodename:       jammy\n\nLinux localhost 4.4.0-19041-Microsoft #1237-Microsoft Sat Sep 11 14:32:00 PST 2021 x86_64 x86_64 x86_64 GNU/Linux\n`\n```\nnpm -v command\n```\n`npm -v\n-bash: /usr/bin/node: cannot execute binary file: Exec format error\n`\n```",
      "solution": "This was an issue for me on Windows 10, using WSL2 and Ubuntu 22.04 LTS. The other solutions in this post did not help, and I was unwilling to downgrade to Ubuntu 20. Instead, I managed to fix it by removing all node-related packages with apt and then installing node via nvm as per this guide by Microsoft.\nSo to remove the packages:\n```\n`sudo apt-get remove --purge nodejs npm\n`\n```\nThen install nvm...\n```\n`curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/master/install.sh | bash\n`\n```\nRestart the terminal. Then, make sure nvm is installed:\n```\n`nvm --version\n`\n```\nFinally, use nvm to install the latest version of node and npm:\n```\n`nvm install node\n`\n```\nCheck to make sure node and npm are installed:\n```\n`node --version\nnpm --version\n`\n```\nHope this helps!",
      "question_score": 16,
      "answer_score": 44,
      "created_at": "2022-09-10T19:20:24",
      "url": "https://stackoverflow.com/questions/73673804/npm-show-npm-elf-not-found-error-in-wsl"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 70561989,
      "title": "Loading PostCSS Plugin failed: Cannot find module &#39;tailwindcss&#39;",
      "problem": "This is my first Tailwind CSS project and started with CDN, but I did not always have internet, so I tried it installing using PostCSS, and I am using Vite as my server.\n\nFollowed this video from CodeWithHarry https://www.youtube.com/watch?v=aUunolbb1xU&list=PLu0W_9lII9ahwFDuExCpPFHAK829Wto2O&index=3\n\nI first initiated the project by\n```\n`npm init -y\n`\n```\nand installed required packages by\n```\n`npm install -D tailwind postcss autoprefixer vite\n`\n```\nand then initiated the Tailwind CSS by\n```\n`npx tailwindcss init -p\n`\n```\nand also I entered @tailwind directives in a input.css file.\nBut when I ran:\n```\n`npm start\n`\n```\nMy vite server greeted me with this error:\n`[plugin:vite:css] Loading PostCSS Plugin failed: Cannot find module 'tailwindcss'\nRequire stack:\n - C:\\projects\\2 Shidhu\\twproject\\noop.js\n \n (@C:\\projects\\2 Shidhu\\twproject\\postcss.config.js)\n`\n\nMy index.html:\n`\n\n    \n    \n    \n    \n    My first tailwindcss project\n\n    \n        \n        \n        \n            Home\n            About Us\n            Contact Us\n            Blog\n        \n    \n    \n        \n            \n            RubyMine\n            RubyMine is a dedicated Ruby and Rails development environment. The IDE provides a wide range of essential tools for Ruby developers, tightly integrated together to create a convenient environment for productive Ruby development and Web development with Ruby on Rails. RubyMine is available for a free 30-day evaluation.\n            \n            \n        \n        \n    \n\n`\nMy tailwind.config.js:\n`module.exports = {\n    content: [\"*\"],\n    theme: {\n        extend: {},\n    },\n    plugins: [],\n}\n`\nMy postcss.config.js:\n`module.exports = {\n    plugins: {\n        tailwindcss: {},\n        autoprefixer: {},\n    },\n}\n`\nMy package.json:\n`{\n  \"name\": \"twproject\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"start\": \"vite\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"autoprefixer\": \"^10.4.1\",\n    \"postcss\": \"^8.4.5\",\n    \"tailwind\": \"^4.0.0\",\n    \"vite\": \"^2.7.10\"\n  }\n}\n`\nHow can I solve this?",
      "solution": "and installed required packages by `npm install -D tailwind postcss autoprefixer vite`\n\nThe package is `tailwindcss` not `tailwind`:\n```\n`npm install -D tailwindcss postcss autoprefixer vite\nnpm tailwindcss init\n`\n```",
      "question_score": 16,
      "answer_score": 42,
      "created_at": "2022-01-03T06:28:11",
      "url": "https://stackoverflow.com/questions/70561989/loading-postcss-plugin-failed-cannot-find-module-tailwindcss"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 67051284,
      "title": "How to set a Dockerfile ARG in Github actions",
      "problem": "I have a Dockerfile for one of my Node.js services that I try to push to my Digitalocean registry through the use of Github actions.\nMy Node.js service requires a private package that is hosted by myself on npm.js registry.\nIn my Dockerfile, I have an ARG for that:\n```\n`FROM node:14-slim\n\nARG NODE_ENV=production\n\nEXPOSE 5000\n\nWORKDIR /usr/src/app\n\nARG NPM_TOKEN\n\nCOPY .npmrc .npmrc\n\nCOPY package*.json ./\n\nRUN npm install\n\nRUN rm -f .npmrc\n\nCOPY src src\n\nCMD [\"npm\", \"start\"]\n`\n```\nand the following .npmrc file:\n```\n`//registry.npmjs.org/:_authToken=${NPM_TOKEN}\n`\n```\nin my Github actions workflow I have two actions. One for running tests:\n```\n`name: tests-user-service\n\non:\n  pull_request:\n    paths:\n      - 'user-service/**'\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v2\n\n      - name: Install dependencies & run tests\n        run: cd user-service && npm install && npm run test:ci\n        env:\n          NPM_TOKEN: ${{secrets.NPM_ACCESS_TOKEN}}\n`\n```\nand one for building the docker file and pushing it to the registry:\n```\n`name: deploy-user-service\n\non:\n  push:\n    branches:\n      - main\n    paths:\n      - 'user-service/**'\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n\n      - name: Check Out Repo\n        uses: actions/checkout@v2\n\n      - name: Install DigitalOcean Controller\n        uses: digitalocean/action-doctl@v2\n        with:\n          token: ${{ secrets.DIGITALOCEAN_ACCESS_TOKEN }}\n\n      - name: Set up Docker Builder\n        uses: docker/setup-buildx-action@v1\n\n      - name: Authenticate with DigitalOcean Container Registry\n        run: doctl registry login --expiry-seconds 600\n\n      - name: Build and Push to DigitalOcean Container Registry\n        uses: docker/build-push-action@v2\n        with:\n          context: ./user-service\n          push: true\n          tags: registry.digitalocean.com/xxx/xxx:latest\n        env:\n          NPM_TOKEN: ${{secrets.NPM_ACCESS_TOKEN}}\n\n      - name: Logout from DigitalOcean Container Registry\n        run: doctl registry logout\n`\n```\nnow, the test file works. So I know the NPM_ACCESS_TOKEN is set correctly.\nThe deployment file, that one fails. It tells me this:\n```\n`#10 [5/7] RUN npm install\n#10 sha256:28b0590a43c14b889983d16b5e375f0156f7fdacc29e32fc3c219bce54e61d69\n#10 0.317 Error: Failed to replace env in config: ${NPM_TOKEN}\n`\n```\nI tried the following in my Dockerfile:\n```\n`FROM node:14-slim\n\nARG NODE_ENV=production\n\nEXPOSE 5000\n\nWORKDIR /usr/src/app\n\nARG NPM_TOKEN\n\nENV NPM_TOKEN ${NPM_TOKEN}\n\nCOPY .npmrc .npmrc\n\nCOPY package*.json ./\n\nRUN npm install\n\nRUN rm -f .npmrc\n\nCOPY src src\n\nCMD [\"npm\", \"start\"]\n`\n```\nand then it goes wrong and tells me this:\n```\n`#10 2.784 npm ERR! code E404\n#10 2.790 npm ERR! 404 Not Found - GET https://registry.npmjs.org/@xxx%2fxxx - Not found\n#10 2.790 npm ERR! 404 \n#10 2.790 npm ERR! 404  '@xxx/xxx@^0.0.11' is not in the npm registry.\n#10 2.790 npm ERR! 404 You should bug the author to publish it (or use the name yourself!)\n`\n```\nSo then it can't find the module. I assume this happens because the NPM_TOKEN is now set with an empty string or so, as in the tests action it does work properly.\nAny idea what else I could try?",
      "solution": "Actually, I figured it out. Have to add `build-args` to the Build and Push part, and remove the `env` from there.\nSo instead of:\n```\n`- name: Build and Push to DigitalOcean Container Registry\n  uses: docker/build-push-action@v2\n  with:\n    context: ./user-service\n    push: true\n    tags: registry.digitalocean.com/xxx/xxx:latest\n  env:\n    NPM_TOKEN: ${{secrets.NPM_ACCESS_TOKEN}}\n`\n```\nshould use this:\n```\n`- name: Build and Push to DigitalOcean Container Registry\n  uses: docker/build-push-action@v2\n  with:\n    context: ./user-service\n    push: true\n    tags: registry.digitalocean.com/xxx/xxx:latest\n    build-args: NPM_TOKEN=${{secrets.NPM_ACCESS_TOKEN}}\n`\n```",
      "question_score": 16,
      "answer_score": 25,
      "created_at": "2021-04-12T02:11:26",
      "url": "https://stackoverflow.com/questions/67051284/how-to-set-a-dockerfile-arg-in-github-actions"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 71517176,
      "title": "npm install fails with Conflicting peer dependency: react@16.14.0",
      "problem": "while trying to install dependencies for this project, `npm install` fails with\n```\n`> npm install\nnpm ERR! code ERESOLVE\nnpm ERR! ERESOLVE could not resolve\nnpm ERR! \nnpm ERR! While resolving: ecommerce-app@0.1.0\nnpm ERR! Found: react@17.0.2\nnpm ERR! node_modules/react\nnpm ERR!   react@\"latest\" from the root project\nnpm ERR!   peer react@\"^16.8.0 || ^17.0.0\" from @material-ui/core@4.11.4\nnpm ERR!   node_modules/@material-ui/core\nnpm ERR!     @material-ui/core@\"latest\" from the root project\nnpm ERR!     peer @material-ui/core@\"^4.0.0\" from @material-ui/icons@4.11.2\nnpm ERR!     node_modules/@material-ui/icons\nnpm ERR!       @material-ui/icons@\"latest\" from the root project\nnpm ERR!     1 more (@material-ui/lab)\nnpm ERR!   10 more (react-dom, @material-ui/icons, @material-ui/lab, ...)\nnpm ERR! \nnpm ERR! Could not resolve dependency:\nnpm ERR! redux-form@\"^8.3.6\" from the root project\nnpm ERR! \nnpm ERR! Conflicting peer dependency: react@16.14.0\nnpm ERR! node_modules/react\nnpm ERR!   peer react@\"^16.4.2\" from redux-form@8.3.7\nnpm ERR!   node_modules/redux-form\nnpm ERR!     redux-form@\"^8.3.6\" from the root project\nnpm ERR! \nnpm ERR! Fix the upstream dependency conflict, or retry\nnpm ERR! this command with --force, or --legacy-peer-deps\nnpm ERR! to accept an incorrect (and potentially broken) dependency resolution.\nnpm ERR! \nnpm ERR! See /Users/gergo/.npm/eresolve-report.txt for a full report.\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     /Users/gergo/.npm/_logs/2022-03-17T17_37_09_399Z-debug-0.log\n`\n```\nEDIT\nwhen running `npm install --force`, I got this other error\n```\n`npm ERR! 2 warnings generated.\nnpm ERR! In file included from ../src/libsass/src/values.cpp:3:\nnpm ERR! In file included from ../src/libsass/src/values.hpp:4:\nnpm ERR! ../src/libsass/src/ast.hpp:1614:25: warning: loop variable 'numerator' of type 'const std::__1::basic_string' creates a copy from type 'const std::__1::basic_string' [-Wrange-loop-analysis]\nnpm ERR!         for (const auto numerator : numerators)\nnpm ERR!                         ^\nnpm ERR! ../src/libsass/src/ast.hpp:1614:14: note: use reference type 'const std::__1::basic_string &' to prevent copying\nnpm ERR!         for (const auto numerator : numerators)\nnpm ERR!              ^~~~~~~~~~~~~~~~~~~~~~\nnpm ERR!                         &\nnpm ERR! ../src/libsass/src/ast.hpp:1616:25: warning: loop variable 'denominator' of type 'const std::__1::basic_string' creates a copy from type 'const std::__1::basic_string' [-Wrange-loop-analysis]\nnpm ERR!         for (const auto denominator : denominators)\nnpm ERR!                         ^\nnpm ERR! ../src/libsass/src/ast.hpp:1616:14: note: use reference type 'const std::__1::basic_string &' to prevent copying\nnpm ERR!         for (const auto denominator : denominators)\nnpm ERR!              ^~~~~~~~~~~~~~~~~~~~~~~~\nnpm ERR!                         &\nnpm ERR! 2 warnings generated.\nnpm ERR! In file included from ../src/binding.cpp:1:\nnpm ERR! In file included from ../../nan/nan.h:56:\nnpm ERR! In file included from /Users/gergo/.node-gyp/17.4.0/include/node/node.h:63:\nnpm ERR! In file included from /Users/gergo/.node-gyp/17.4.0/include/node/v8.h:25:\nnpm ERR! In file included from /Users/gergo/.node-gyp/17.4.0/include/node/v8-array-buffer.h:12:\nnpm ERR! In file included from /Users/gergo/.node-gyp/17.4.0/include/node/v8-local-handle.h:12:\nnpm ERR! /Users/gergo/.node-gyp/17.4.0/include/node/v8-internal.h:563:38: error: no template named 'remove_cv_t' in namespace 'std'; did you mean 'remove_cv'?\nnpm ERR!             !std::is_same>::value>::Perform(data);\nnpm ERR!                                 ~~~~~^~~~~~~~~~~\nnpm ERR!                                      remove_cv\nnpm ERR! /Library/Developer/CommandLineTools/usr/bin/../include/c++/v1/type_traits:697:50: note: 'remove_cv' declared here\nnpm ERR! template  struct _LIBCPP_TEMPLATE_VIS remove_cv\nnpm ERR!                                                  ^\nnpm ERR! 1 error generated.\nnpm ERR! make: *** [Release/obj.target/binding/src/binding.o] Error 1\nnpm ERR! gyp ERR! build error \nnpm ERR! gyp ERR! stack Error: `make` failed with exit code: 2\nnpm ERR! gyp ERR! stack     at ChildProcess.onExit (/Users/gergo/Documents/spring-boot-react-ecommerce-app/client/node_modules/node-gyp/lib/build.js:262:23)\nnpm ERR! gyp ERR! stack     at ChildProcess.emit (node:events:520:28)\nnpm ERR! gyp ERR! stack     at Process.ChildProcess._handle.onexit (node:internal/child_process:291:12)\nnpm ERR! gyp ERR! System Darwin 19.6.0\nnpm ERR! gyp ERR! command \"/usr/local/Cellar/node/17.4.0/bin/node\" \"/Users/gergo/Documents/spring-boot-react-ecommerce-app/client/node_modules/node-gyp/bin/node-gyp.js\" \"rebuild\" \"--verbose\" \"--libsass_ext=\" \"--libsass_cflags=\" \"--libsass_ldflags=\" \"--libsass_library=\"\nnpm ERR! gyp ERR! cwd /Users/gergo/Documents/spring-boot-react-ecommerce-app/client/node_modules/node-sass\nnpm ERR! gyp ERR! node -v v17.4.0\nnpm ERR! gyp ERR! node-gyp -v v3.8.0\nnpm ERR! gyp ERR! not ok \nnpm ERR! Build failed with error code: 1\n`\n```\nEDIT\nthe second error is thrown while installing node-sass. my node version was not compatible with \"node-sass\": \"^4.14.1\".  I have changed node-sass version to be compatible with my node version and this error went away. and the build is successful",
      "solution": "the second error is thrown while installing node-sass.\nmy node version (17.4) was not compatible with `\"node-sass\": \"^4.14.1\"`\nI have changed node-sass version to be compatible with my node version and this error went away. and the build is successful.",
      "question_score": 16,
      "answer_score": 1,
      "created_at": "2022-03-17T19:11:31",
      "url": "https://stackoverflow.com/questions/71517176/npm-install-fails-with-conflicting-peer-dependency-react16-14-0"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 68790790,
      "title": "Vue 3: Module &#39;&quot;../../node_modules/vue/dist/vue&quot;&#39; has no exported member",
      "problem": "After updating my npm packages, some of the imports from the 'vue' module started showing errors:\n\nTS2305: Module '\"../../node_modules/vue/dist/vue\"' has no exported member 'X'\n\nwhere X is nextTick, onMounted, ref, watch etc.\nWhen serving the project, Vue says it's \"failed to compile\". WebStorm actually recognizes the exports, suggests them and shows types, but the error is shown regardless. Some exports like computed and defineComponent work just fine.\nWhat I've tried:\n\nRollback to the previously used Vue version \"3.2.2\" > \"3.0.11\". It makes the abovementioned type errors disappear, but the app stops working entirely, showing lots of `TypeError: Object(...) is not a function` errors in console and not rendering the app at all. In the terminal, some new warnings are introduced:\n`\"export 'X' (imported as '_X') was not found in 'vue'` where X is createElementBlock, createElementVNode, normalizeClass and normalizeStyle.\nRollback other dependencies. None of the ones that I tried helped fix the problem, unfortunately.\nManually declare the entirety of 'vue' module. We can declare the 'vue' module exports in shims-vue.d.ts, and it actually makes the errors disappear, however, this seems like a terrible, time-consuming workaround, so I would opt out for a better solution if possible.\n\nMy full list of dependencies:\n```\n`\"dependencies\": {\n   \"@capacitor/android\": \"3.0.0\",\n   \"@capacitor/app\": \"1.0.0\",\n   \"@capacitor/core\": \"3.0.0\",\n   \"@capacitor/haptics\": \"1.0.0\",\n   \"@capacitor/keyboard\": \"1.0.0\",\n   \"@capacitor/push-notifications\": \"^1.0.3\",\n   \"@google-pay/button-element\": \"^2.5.0\",\n   \"@ionic-native/core\": \"^5.34.0\",\n   \"@ionic-native/qr-scanner\": \"^5.35.0\",\n   \"@ionic-native/vibration\": \"^5.34.0\",\n   \"@ionic/vue\": \"^5.4.0\",\n   \"@ionic/vue-router\": \"^5.4.0\",\n   \"@j-t-mcc/vue3-chartjs\": \"^1.1.2\",\n   \"chart.js\": \"^3.4.1\",\n   \"chartjs-plugin-datalabels\": \"^2.0.0\",\n   \"color\": \"^3.1.3\",\n   \"cordova-plugin-background-mode\": \"^0.7.3\",\n   \"cordova-plugin-device\": \"^2.0.3\",\n   \"cordova-plugin-qrscanner\": \"^3.0.1\",\n   \"core-js\": \"^3.6.5\",\n   \"firebase\": \"^8.6.2\",\n   \"numeral\": \"^2.0.6\",\n   \"pug\": \"^3.0.2\",\n   \"pug-plain-loader\": \"^1.1.0\",\n   \"secure-ls\": \"^1.2.6\",\n   \"uuid\": \"^8.3.2\",\n   \"v-cupertino\": \"^1.2.4\",\n   \"vue\": \"^3.2.0\",\n   \"vue-chartjs\": \"^3.5.1\",\n   \"vue-i18n\": \"^9.1.3\",\n   \"vue-numerals\": \"^4.0.6\",\n   \"vue-router\": \"^4.0.0-0\",\n   \"vuex\": \"^4.0.1\"\n },\n \"devDependencies\": {\n   \"@capacitor/cli\": \"3.0.0\",\n   \"@types/jest\": \"^24.0.19\",\n   \"@types/uuid\": \"^8.3.1\",\n   \"@typescript-eslint/eslint-plugin\": \"^2.33.0\",\n   \"@typescript-eslint/parser\": \"^2.33.0\",\n   \"@vue/cli-plugin-babel\": \"~4.5.0\",\n   \"@vue/cli-plugin-e2e-cypress\": \"~4.5.0\",\n   \"@vue/cli-plugin-eslint\": \"^4.5.13\",\n   \"@vue/cli-plugin-router\": \"~4.5.0\",\n   \"@vue/cli-plugin-typescript\": \"~4.5.0\",\n   \"@vue/cli-plugin-unit-jest\": \"~4.5.0\",\n   \"@vue/cli-service\": \"~4.5.0\",\n   \"@vue/compiler-sfc\": \"^3.0.0-0\",\n   \"@vue/eslint-config-typescript\": \"^5.0.2\",\n   \"@vue/test-utils\": \"^2.0.0-0\",\n   \"eslint\": \"^6.7.2\",\n   \"eslint-plugin-vue\": \"^7.0.0-0\",\n   \"stylus\": \"^0.54.7\",\n   \"stylus-loader\": \"^3.0.2\",\n   \"typescript\": \"~3.9.3\",\n   \"vue-jest\": \"^5.0.0-0\"\n }\n`\n```\nLink to reproduce",
      "solution": "As I mentioned in the comments, in my case, the trick was to update TypeScript from version \"3.x.x\" to \"4.3.5\" (other 4.x.x versions should work, too, but I haven't tried them myself).\nAs to why this is the case, my theory is that some vue-related dependency became incompatible with the 3.x version of TypeScript after the update.",
      "question_score": 16,
      "answer_score": 22,
      "created_at": "2021-08-15T12:43:42",
      "url": "https://stackoverflow.com/questions/68790790/vue-3-module-node-modules-vue-dist-vue-has-no-exported-member"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 66517777,
      "title": "Namespace &#39;NodeJS&#39; has no exported member &#39;Require&#39;",
      "problem": "I'm new in Electron.. and i just following this guide:\nhttps://www.geeksforgeeks.org/integrate-angular-7-with-electronjs/?ref=rp\nbut, i don't know why, i can't continue the step 4, on accessing the electron, and keep popping this when doing build or even just serve.\nError: node_modules/electron/electron.d.ts:6594:21 - error TS2694: Namespace 'NodeJS' has no exported member 'Require'.\n6594     require: NodeJS.Require;\n~~~~~~~\nnpm ERR! code ELIFECYCLE\nnpm ERR! errno 1\nnpm ERR! pemberkasan@0.2.0 electron: `ng build --prod && electron .`\nnpm ERR! Exit status 1\nnpm ERR!\nnpm ERR! Failed at the pemberkasan@0.2.0 electron script.\nnpm ERR! This is probably not a problem with npm. There is likely additional logging output above.\ni hope anyone here, understand with this and able to solve this. thank you! because my goal is to connect ipcMain, using ipcRenderer that i triggered on Angular Services.",
      "solution": "I believe this problem happened because of an old version of `@types/node`, as Angular uses TypeScript as its backbone.\n`npm update` itself wouldn't work if the update is a breaking change.\nIn order to fix this, update your `package.json` to use the latest version of `@types/node`, at this time of writing `14.14.33`. You can update it manually by editing that file.\nAfter updating your `@types/node`, run `npm install` again, then serve it, and it should work.\nIf it still fails, update your Angular CLI to the latest version by using `npm uninstall -g @angular/cli`, then `npm install -g @angular/cli`. You might be using an outdated Angular CLI.",
      "question_score": 16,
      "answer_score": 25,
      "created_at": "2021-03-07T15:48:58",
      "url": "https://stackoverflow.com/questions/66517777/namespace-nodejs-has-no-exported-member-require"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "npm",
      "question_id": 69008215,
      "title": "Error: Must use import to load ES Module: D:\\node_modules\\react-markdown\\index.js require() of ES modules is not supported",
      "problem": "Currently I'm using `\"react\": \"17.0.2\"` and I have installed `\"react-markdown\": \"^7.0.1\"` via `npm i react-markdown` I'm using this package to display my rich text that I'm fetching from my Strapi CMS. I have used the following code to display the content:\n```\n`import ReactMarkdown from \"react-markdown\";\n\nexport default function name({ posts }) {\n  return (\n    <>\n      \n        \n          {posts.Title}\n        \n      \n      \n        \n      \n    \n  );\n}\n\nexport async function getStaticProps() {\n  const res = await fetch(\"http://localhost:1337/blogs\");\n  const posts = await res.json();\n\n  return {\n    props: { posts },\n  };\n}\n`\n```\nBut when I run this it gives me the following error:\n\nI'm using node `v14.17.0` and have tried adding `\"type\": \"module\"`.\nMy package.json:\n`{\n  \"name\": \"passportlegacy\",\n  \"version\": \"0.1.0\",\n  \"private\": true,\n  \"scripts\": {\n    \"dev\": \"next dev\",\n    \"build\": \"next build\",\n    \"start\": \"next start\",\n    \"lint\": \"next lint\"\n  },\n  \"dependencies\": {\n    \"axios\": \"^0.21.1\",\n    \"babel-plugin-inline-react-svg\": \"^2.0.1\",\n    \"next\": \"11.0.1\",\n    \"next-images\": \"^1.8.1\",\n    \"react\": \"17.0.2\",\n    \"react-dom\": \"17.0.2\",\n    \"react-map-gl\": \"^6.1.16\",\n    \"react-markdown\": \"^7.0.1\",\n  },\n  \"devDependencies\": {\n    \"@svgr/webpack\": \"^5.5.0\",\n    \"@types/react\": \"17.0.16\",\n    \"eslint\": \"7.32.0\",\n    \"eslint-config-next\": \"11.0.1\",\n    \"typescript\": \"4.3.5\"\n  }\n}\n`",
      "solution": "I solved this by just pinning react-markdown to version 6.\nWith version 7 of react-markdown they moved to ESM only. There's a explanation of what that means here, but it seems Jest (version 27) still only has experimental support for pure ESM modules as of October 2021. I couldn't get it to work in my project, and version 6 of react-markdown works fine for now.\nI think the next major version of Jest (version 28) might support ESM.",
      "question_score": 16,
      "answer_score": 15,
      "created_at": "2021-09-01T07:27:56",
      "url": "https://stackoverflow.com/questions/69008215/error-must-use-import-to-load-es-module-d-node-modules-react-markdown-index-j"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 68317383,
      "title": "TypeError: rxjs_1.lastValueFrom is not a function",
      "problem": "I am building an api using nestjs. After adding the typeorm and pg dependencies and adding the `TypeOrmModule.forRoot({})` code in `app.module.ts` like shown below.\n```\n`import { Module } from '@nestjs/common';\nimport { TypeOrmModule } from '@nestjs/typeorm';\nimport { AppController } from './app.controller';\nimport { AppService } from './app.service';\nimport { CoffeesModule } from './coffees/coffees.module';\n\n@Module({\n  imports: [CoffeesModule, TypeOrmModule.forRoot({\n    type: 'postgres',\n    host: 'localhost',\n    port: 5432,\n    username: 'postgres',\n    password: 'xxx',\n    database: 'postgres',\n    autoLoadEntities: true,\n    synchronize: true\n  })],\n  controllers: [AppController],\n  providers: [AppService],\n})\nexport class AppModule { }\n\n`\n```\nI get an error `TypeError: rxjs_1.lastValueFrom is not a function` with but no error when I exclude `TypeOrmModule.forRoot({})`.\nWhat could be the reason for the error ?",
      "solution": "If you're using Nest v8, RxJS version 7 is used, which no longer has a `toPromise()` method for Observables, so Nest uses the `lastValueFrom` method instead. If you're receiving this error, you probably need to update your `rxjs` dependency to >7.\n`npm i rxjs@^7\nyarn add rxjs@^7\npnpm i rxjs @^7\n`\nPick your flavor of package manager and have at it.\nIn the last update of NestJS, when is used cli to initialization of project this error is throw.",
      "question_score": 46,
      "answer_score": 138,
      "created_at": "2021-07-09T15:11:44",
      "url": "https://stackoverflow.com/questions/68317383/typeerror-rxjs-1-lastvaluefrom-is-not-a-function"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 68437734,
      "title": "Jest has detected the following 1 open handle potentially keeping Jest from exiting: TCPSERVERWRAP",
      "problem": "I am doing a basic end to end testing here, for the moment it's failing, but first I can't get rid of the open handle.\n```\n`Ran all test suites.\n\nJest has detected the following 1 open handle potentially keeping Jest from exiting:\n\n  \u25cf  TCPSERVERWRAP\n\n      40 |     }\n      41 |     return request(app.getHttpServer())\n    > 42 |       .post('/graphql')\n         |        ^\n      43 |       .send(mutation)\n      44 |       .expect(HttpStatus.OK)\n      45 |       .expect((response) => {\n\n      at Test.Object..Test.serverAddress (../node_modules/supertest/lib/test.js:61:33)\n      at new Test (../node_modules/supertest/lib/test.js:38:12)\n      at Object.obj. [as post] (../node_modules/supertest/index.js:27:14)\n      at Object. (app.e2e-spec.ts:42:8)\n`\n```\n```\n`import { Test, TestingModule } from '@nestjs/testing'\nimport { HttpStatus, INestApplication } from \"@nestjs/common\";\nimport * as request from 'supertest'\nimport { AppModule } from '../src/app.module'\n\ndescribe('AppController (e2e)', () => {\n  let app: INestApplication\n\n  beforeEach(async () => {\n    const moduleFixture: TestingModule = await Test.createTestingModule({\n      imports: [AppModule],\n    }).compile()\n\n    app = moduleFixture.createNestApplication()\n    await app.init()\n  })\n\n  afterAll(async () => {\n    await app.close()\n  })\n\n  it('/ (GET)', () => {\n    return request(app.getHttpServer())\n      .get('/')\n      .expect(HttpStatus.OK)\n      .expect('Hello World!')\n  })\n\n  it('mutation', async () => {\n    const mutation = {\n      query: `mutation Create($title: String!) {\n        create(title: $title) {\n          id,\n          title\n        }\n      }`,\n      variables: {\n        title: 'Mon programme',\n      },\n    }\n    return request(app.getHttpServer())\n      .post('/graphql')\n      .send(mutation)\n      .expect(HttpStatus.OK)\n      .expect( (response) => {\n        expect(response.body).toBe({\n          id: expect.any(String),\n          title: 'Mon programme',\n        })\n      })\n  })\n})\n`\n```\nAny idea what's blocking the test runner ?\nNote that, as I am using NestJs, I shouldn't need to use the `.end(done)` method at the end of the test.\nPS: apparently I have to much code on this question and I need to add some more details, but have no clue what I can say more.",
      "solution": "I still haven't found a perfect solution, but for the moment I went for this workaround :\n`jest --config ./test/jest-e2e.json --forceExit`\nThe --forceExit option kill the openHandles somehow and unlock everything.\nYet, I'm still looking for the \"proper way\" of handling that issue.",
      "question_score": 42,
      "answer_score": 42,
      "created_at": "2021-07-19T10:57:38",
      "url": "https://stackoverflow.com/questions/68437734/jest-has-detected-the-following-1-open-handle-potentially-keeping-jest-from-exit"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 69438275,
      "title": "Nest.js validate array of strings if there are defined strings only",
      "problem": "In the nest.js application on controller level I have to validate DTO.\nI've faced with difficulty to check if item is not null (request should be rejected if any list item is `null` or `undefined`)\nCode bellow demonstrates my configured verifications.\n```\n`import { ArrayMinSize, IsArray } from 'class-validator'\n\nexport class ReminderPayload {\n    // ...\n    @IsArray()\n    @ArrayMinSize(1)\n    recipients: string[]\n}\n`\n```\nQuestion\n\nI'm looking for help to reject requests with body data like\n\n```\n`{\n    \"recipients\": [\n        null\n    ]\n}\n`\n```\n\nHow to validate if array items are `string` only (it should reject handling if object is in the array item position)?\n\nP.S.\n`'class-validator'` injected successfully, and it produces some validation results for my API.",
      "solution": "You need to tell `class-validator` to run the validations on `each` item of the array.  Change your payload DTO to the following:\n```\n`import { ArrayMinSize, IsArray, IsString } from 'class-validator';\n\nexport class ReminderPayloadDto {\n  // ...\n  @IsArray()\n  @IsString({ each: true })  // \"each\" tells class-validator to run the validation on each item of the array\n  @ArrayMinSize(1)\n  recipients: string[];\n}\n`\n```\nLink to the docs on this.",
      "question_score": 40,
      "answer_score": 78,
      "created_at": "2021-10-04T17:05:37",
      "url": "https://stackoverflow.com/questions/69438275/nest-js-validate-array-of-strings-if-there-are-defined-strings-only"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 70884240,
      "title": "Test functions cannot both take a &#39;done&#39; callback",
      "problem": "I'm trying to create a simple test with nestjs, and I'm getting this error\n\nTest functions cannot both take a 'done' callback and return something. Either use a 'done' callback, or return a promise.\nReturned value: Promise {}\n\nThe unit test is so simple, but I get an error when I use done();\n```\n`it('throws an error if a user signs up with an email that is in use', async (done) => {\nfakeUsersService.find = () => Promise.resolve([{ id: 1, email: 'a', password: '1' } as User]);\ntry {\n  await service.signup('asdf@asdf.com', 'asdf');\n} catch (err) {\n  done();\n}\n});\n`\n```",
      "solution": "You are combining Async/Await and Done.\nEither use asnyc/await, or done.\n```\n`it('throws an error if user signs up with email that is in use', async () => {\n    try {\n        await service();\n        expect(...);\n    } catch (err) {\n    }\n});\n`\n```\nor use the done format\n```\n`it('throws an error if user signs up with email that is in use', (done) => {\n    ...\n    service()\n     .then( ...) {}\n     .catch( ...) {}\n    }\n    done();\n});\n`\n```",
      "question_score": 40,
      "answer_score": 41,
      "created_at": "2022-01-27T19:58:29",
      "url": "https://stackoverflow.com/questions/70884240/test-functions-cannot-both-take-a-done-callback"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 70858113,
      "title": "Module &#39;&quot;buffer&quot;&#39; has no exported member &#39;Blob&#39;",
      "problem": "Have anyone been in this situation before ?\nI run my code with CI/CD\nafter nest build, it gives me error :\n`node_modules/@types/superagent/index.d.ts:23:10 - error TS2305: Module '\"buffer\"' has no exported member 'Blob'. 23 import { Blob } from \"buffer\";`\nI don't know why? Please share if you got a solution for this one.",
      "solution": "We had the same problem after upgrading nest 7.5.x to 8.0.0. The dependency `\"supertest\"` for `\"nestjs/testing\"` has a dependency on `\"@types/supertest\"` which wildcards `\"@types/superagent\": \"*\"`, and that dependency has another wildcard dependency `\"@types/node\": \"*\"`, but the types within @types/supertest actually require @types/node >=16.X.X.\nSo `nestjs/testing -> supertest -> @types/supertest -> @types/superagent -> @types/node >= 16.X.X` is your problem and error.\nThe comments mentioned are accurate because these package managers wildcard their dependencies to get the latest version of dependencies. They should but do not add peerDependencies with dependencies requirements such as `\"@types/node\": \"\">=12.0.0 big red flag because when you ran `npm install`, with these wildcard dependencies even though you did not know it installed the latest version. Since it installed everything wildcard today, but not yesterday, it worked yesterday.\nIn addition, but also important is that you are have pinned @types/node \nOne option: revert your package-lock.json changes and run `npm ci`\nAnother option: set your package.json dependency for @types/node to -> `\"@types/node\": \"^16.0.0\",`.\nAnother option: accept that wildcards are wrong and you don't trust what is going on there so pin the @types/superagent dependency to the one prior.\nAs for me and my family, we use nestjs with AWS lambda which runtime does not include nodejs 16, and not everyone on my team runs `npm ci` we more typically run `npm install` so the solution was\npackage.json\n`    ...\n    \"devDependencies\": {\n        ...\n        \"@types/node\": \"14.18.2\",\n        \"@types/superagent\": \"4.1.10\",\n        \"@types/supertest\": \"^2.0.11\",\n        ...\n\n`",
      "question_score": 32,
      "answer_score": 53,
      "created_at": "2022-01-26T03:41:23",
      "url": "https://stackoverflow.com/questions/70858113/module-buffer-has-no-exported-member-blob"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 72549668,
      "title": "How to do custom repository using TypeORM (MongoDB) in NestJS?",
      "problem": "I have a question. With `@EntityRepository` decorator being marked as deprecated in `typeorm@^0.3.6`, what is now the recommended or TypeScript-friendly way to create a custom repository for an entity in NestJS? A custom repository before would look like this:\n```\n`// users.repository.ts\nimport { EntityRepository, Repository } from 'typeorm';\nimport { User } from './user.entity';\n\n@EntityRepository(User)\nexport class UsersRepository extends Repository {\n  async createUser(firstName: string, lastName: string): Promise {\n    const user = this.create({\n      firstName,\n      lastName,\n    });\n\n    await this.save(user);\n\n    return user;\n  }\n}\n`\n```\nAnd since NestJS is by default configured with TypeScript support, I will be able to call `usersRepository.createUser()` without an issue in a service like this:\n```\n`// users.service.ts\nimport { Injectable } from '@nestjs/common';\nimport { InjectRepository } from '@nestjs/typeorm';\nimport { User } from './user.entity';\nimport { UsersRepository } from './users.repository';\n\n@Injectable()\nexport class UsersService {\n  constructor(\n    @InjectRepository(UsersRepository)\n    private readonly usersRepository: UsersRepository,\n  ) {}\n\n  async createUser(firstName: string, lastName: string): Promise {\n    return this.usersRepository.createUser(firstName, lastName);\n  }\n}\n`\n```\nThis is how the modules would import the custom repository:\n```\n`// users.module.ts\nimport { Module } from '@nestjs/common';\nimport { TypeOrmModule } from '@nestjs/typeorm';\nimport { UsersController } from './users.controller';\nimport { UsersRepository } from './users.repository';\nimport { UsersService } from './users.service';\n\n@Module({\n  imports: [TypeOrmModule.forFeature([UsersRepository])],\n  controllers: [UsersController],\n  providers: [UsersService],\n  exports: [UsersService],\n})\nexport class UsersModule {}\n`\n```\nAlso the reason why I mentioned MongoDB here is because I tried using `typeorm@0.2` where `@EntityRepository` is still supported but I receive an error when I tried to import it in the module stating `Repository not found` or something. Do note, if I chose `postgresql` as my database in TypeORM with the same changes above, I don't have this issue. Hence I went to check the latest only to find out it is already deprecated, I also didn't find any example in NestJS documentation.",
      "solution": "I think I found a solution to this which allows to call custom methods but also inherited ones. It seems that this \"issue\" is not too popular yet but there is definitely some chatter about it within the typeorm GitHub threads: https://github.com/typeorm/typeorm/issues/9013\nThe following solution uses MySQL as underlying database driver but I assume it will work for MongoDB as well.\nteam.repository.ts\n```\n`import {DataSource, Repository} from 'typeorm';\nimport {Injectable} from '@nestjs/common';\nimport {Team} from '@Domain/Team/Models/team.entity';\n\n@Injectable()\nexport class TeamRepository extends Repository\n{\n    constructor(private dataSource: DataSource)\n    {\n        super(Team, dataSource.createEntityManager());\n    }\n\n    /**\n     * Add a basic where clause to the query and return the first result.\n     */\n    async firstWhere(column: string, value: string | number, operator = '='): Promise\n    {\n        return await this.createQueryBuilder()\n                         .where(`Team.${column} ${operator} :value`, {value: value})\n                         .getOne();\n    }\n}\n\n`\n```\nteam.service.ts\n```\n`import {Injectable} from '@nestjs/common';\nimport {Team} from '@Domain/Team/Models/team.entity';\nimport {TeamRepository} from '@Domain/Team/Repositories/team.repository';\n\n@Injectable()\nexport class TeamService\n{\n    constructor(\n        private teamRepository: TeamRepository,\n    )\n    {\n    }\n\n    async create(): Promise\n    {\n        const team: Team = await this.teamRepository.firstWhere('id', 1);\n\n        return this.teamRepository.save(team);\n    }\n}\n`\n```\nteam.module.ts\n```\n`import {Module} from '@nestjs/common';\nimport {TeamService} from '@Domain/Team/Services/team.service';\nimport {TypeOrmModule} from '@nestjs/typeorm';\nimport {Team} from '@Domain/Team/Models/team.entity';\nimport {TeamRepository} from '@Domain/Team/Repositories/team.repository';\n\n@Module({\n            imports:   [TypeOrmModule.forFeature([Team])],\n            exports:   [TeamService],\n            providers: [TeamService, TeamRepository],\n        })\nexport class TeamModule\n{\n}\n`\n```",
      "question_score": 31,
      "answer_score": 68,
      "created_at": "2022-06-08T19:07:29",
      "url": "https://stackoverflow.com/questions/72549668/how-to-do-custom-repository-using-typeorm-mongodb-in-nestjs"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 70230659,
      "title": "Run NestJS worker in a separate process",
      "problem": "I am implementing NestJS worker, queues, using Bull.\nAccording to the documentation, both the worker and the server (will) run in a same \"process\", but I want to run the worker in a separate process, so as to not block the main event loop.\nI think it's called \"running a task in a separate binary\" or something else.\nAnyway, I tried googling it, went through the documentation of NestJS, but couldn't find something similar.\n++\nIn other words:\nI have a main project (my current), and I want to create the worker in a separate process (standalone application) and want to connect both my current main project and worker. And I can't really find it in the documentation.\nIn which module should I instantiate my Bull's instance? I am assuming I'll keep my `producer` in my main module and `consumer` in my worker module.\nHow can I do so?\nPlease note, by \"separate process\", I do not mean running a specific task in a separate process, as defined in Bull's documentation.\nI want to deploy the whole worker module in a separate process or whatever the term should be used.\n++\n[Extra, if possible]\nBefore running my server and worker, I also want to check whether my worker (bull instance) is successfully connected to my Redis server. I couldn't find anything on the Bull's documentation... do you think there is a good workaround for that?",
      "solution": "Goal: Horizontal Scaling \u2705\nWhile the answer provided by Isolated should work, I didn't want to run a whole new project and import my modules as they suggested. So after some more R&D, I've figured out a different way to do so.\nJust as we have our `index.ts` or `main.ts` file for our \"parent\" project, in the same dir (doesn't have to be), create a `worker.ts` and `worker.module.ts`.\nIn the `worker.module.ts`, make sure you register your Bull module again [`BullModule.forRoot({})`] and include all the imports that you'd need for your consumer.\nIn the `providers`, you should add our `consumers` and you're good to go.\nThe `worker.ts` would look like this (nothing fancy):\n```\n`import { NestFactory } from '@nestjs/core';\nimport { NestExpressApplication } from '@nestjs/platform-express';\nimport { WINSTON_MODULE_NEST_PROVIDER } from 'nest-winston';\nimport { WorkerModule } from './worker/worker.module';\n\nasync function bootstrap() {\n  const app = await NestFactory.create(WorkerModule);\n  app.useLogger(app.get(WINSTON_MODULE_NEST_PROVIDER));\n  process.env.WORKER_HTTP_PORT = process.env.WORKER_HTTP_PORT ?? '4001';\n  await app.listen(process.env.WORKER_HTTP_PORT);\n  console.debug(`Worker is running on ${await app.getUrl()}`);\n}\nbootstrap();\n`\n```\nYour `nest-cli.json` should like something like this\n```\n`{\n  \"collection\": \"@nestjs/schematics\",\n  \"sourceRoot\": \"src\",\n  \"entryFile\": \"main\",\n  \"compilerOptions\": {\n    \"assets\": [\"**/*.graphql\"],\n    \"watchAssets\": true\n  }\n}\n`\n```\nand create a new `nest-cli-worker.json`\n```\n`{\n    \"collection\": \"@nestjs/schematics\",\n    \"sourceRoot\": \"src\",\n    \"entryFile\": \"worker\",\n    \"compilerOptions\": {\n        \"watchAssets\": true\n    }\n}\n`\n```\nNow, the question is, how to run it?\nI am using `yarn` commands to start my server (defining them in `package.json`)\nTo `start` my `server`, I'd\n```\n`\"start:dev\": \"yarn nest start --watch -e 'node -r dotenv/config -r source-map-support/register'\"\n`\n```\nor\n```\n`\"start:prod\": \"node -r dotenv/config -r ./tsconfig-paths-bootstrap.js dist/src/main.js\"\n`\n```\nand to `start` my `worker`, I'd run the following command(s) in another (terminal) shell...\n\nDev\n\n```\n`\"worker:start:dev\": \"yarn nest start --config nest-cli-worker.json --watch -e 'node -r dotenv/config -r source-map-support/register'\"\n`\n```\nor\n\nProd\n\n```\n`\"worker:start:prod\": \"node -r dotenv/config -r ./tsconfig-paths-bootstrap.js dist/src/worker.js\"\n`\n```\nP.S You don't necessarily have to add `dotenv/config`.\nBonus:\n\nIf you want to run your server(s) in `docker`\n\nHere's my `docker-compose.yaml` file\n```\n`version: '3.8'\n\nservices:\n  main:\n    container_name: my-server\n    image: xxx.amazonaws.com/xx/xxx:${CONTAINER_IMAGE_TAG:-latest}\n    ports:\n      - 80:80\n    command: node -r dotenv/config -r ./tsconfig-paths-bootstrap.js dist/src/main.js #My `prod` command for main server\n    volumes:\n      - xxx\n    links:\n      - xxx\n    environment:\n      xxx\n    # .env is generated by Elastic Beanstalk, don't provide one\n    env_file:\n      - .env\n  worker:\n    container_name: worker-server #YOUR WORER\n    image: xxx.us-west-2.amazonaws.com/xxx:${CONTAINER_IMAGE_TAG:-latest}\n    ports:\n      - 90:90\n    links:\n      - xxx\n    command: node -r dotenv/config -r ./tsconfig-paths-bootstrap.js dist/src/worker.js  #prod command for Worker\n    volumes:\n      - xxx\n    environment:\n      xxx\n    # .env is generated by Elastic Beanstalk, don't provide one\n    env_file:\n      - .env\n`\n```",
      "question_score": 30,
      "answer_score": 28,
      "created_at": "2021-12-05T01:41:19",
      "url": "https://stackoverflow.com/questions/70230659/run-nestjs-worker-in-a-separate-process"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 71557301,
      "title": "How to workraound this TypeORM error, &quot;EntityRepository is deprecated , use Repository.extend function instead&quot;?",
      "problem": "However, I can't find any Repository.extend method in Repository class and there's nothing about it in the documentation. How to solve this?\ntypeorm version: \"^0.3.0\"\nI'm using nest js and trying to create a custom repository.",
      "solution": "First of all:\n```\n`npm install @nestjs/typeorm@next\n`\n```\nNOTE\nIn my project @nestjs/typeorm version is `9.0.0-next.2` and typeorm version is `0.3.6`\nCreate a folder named database in the src of your project then create two files in (typeorm-ex.decorator.ts and typeorm-ex.module.ts)\n```\n`// typeorm-ex.decorator.ts\n\nimport { SetMetadata } from \"@nestjs/common\";\n\nexport const TYPEORM_EX_CUSTOM_REPOSITORY = \"TYPEORM_EX_CUSTOM_REPOSITORY\";\n\nexport function CustomRepository(entity: Function): ClassDecorator {\n  return SetMetadata(TYPEORM_EX_CUSTOM_REPOSITORY, entity);\n}\n`\n```\nAnd next file\n```\n`// typeorm-ex.module.ts\n\nimport { DynamicModule, Provider } from \"@nestjs/common\";\nimport { getDataSourceToken } from \"@nestjs/typeorm\";\nimport { DataSource } from \"typeorm\";\nimport { TYPEORM_EX_CUSTOM_REPOSITORY } from \"./typeorm-ex.decorator\";\n\nexport class TypeOrmExModule {\n  public static forCustomRepository any>(repositories: T[]): DynamicModule {\n    const providers: Provider[] = [];\n\n    for (const repository of repositories) {\n      const entity = Reflect.getMetadata(TYPEORM_EX_CUSTOM_REPOSITORY, repository);\n\n      if (!entity) {\n        continue;\n      }\n\n      providers.push({\n        inject: [getDataSourceToken()],\n        provide: repository,\n        useFactory: (dataSource: DataSource): typeof repository => {\n          const baseRepository = dataSource.getRepository(entity);\n          return new repository(baseRepository.target, baseRepository.manager, baseRepository.queryRunner);\n        },\n      });\n    }\n\n    return {\n      exports: providers,\n      module: TypeOrmExModule,\n      providers,\n    };\n  }\n}\n`\n```\nOpen your AppModule and modify it like the following:\n```\n`@Module({\n  imports: [\n    TypeOrmModule.forRoot({\n      type: 'mssql',\n      ...\n      entities: [Photo],\n    }),\n    TypeOrmExModule.forCustomRepository([PhotoRepository]),\n    ...\n  ],\n  controllers: [AppController],\n  providers: [\n    AppService\n  ],\n})\nexport class AppModule { }\n`\n```\nYou can create your customer repository like the following :\n```\n`@CustomRepository(Photo)\nexport class PhotoRepository extends Repository {\n    public async getAllPhoto() {\n        const query = this.createQueryBuilder('photo')\n            .where('photo.isPublished = :isPublished', { isPublished: true })\n        const photos = await query.getMany()\n        return photos\n    }\n}\n`\n```\nEverything works perfectly.\nThanks to @anchan828",
      "question_score": 28,
      "answer_score": 18,
      "created_at": "2022-03-21T13:01:18",
      "url": "https://stackoverflow.com/questions/71557301/how-to-workraound-this-typeorm-error-entityrepository-is-deprecated-use-repo"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 66605192,
      "title": "File uploading along with other data in Swagger NestJs",
      "problem": "I want to send file along with JSON\n```\n`{\n    \"comment\" : \"string\",\n    \"outletId\" : 1\n}\n`\n```\nThe help I got from Documentation is\n```\n`requestBody:\n    content:\n      multipart/form-data:\n        schema:\n          type: object\n          properties:\n            orderId:\n              type: integer\n            userId:\n              type: integer\n            fileName:\n              type: string\n              format: binary\n`\n```\nI don't know where to put this schema. I have tried putting it inside `@ApiProperty()` in DTO as well as in `@ApiOperations` but could not resolve the issue.\nBelow is the function I want to capture file content in.\n```\n`@Post('/punchin')\n@ApiConsumes('multipart/form-data')\n@ApiOperation({ summary: 'Attendance Punch In' })\n@UseInterceptors(CrudRequestInterceptor, ClassSerializerInterceptor, FileInterceptor('file'))\n@ApiImplicitFile({ name: 'file' })\nasync punchInAttendance( @Body() body: PunchInDto, @UploadedFile() file: Express.Multer.File ): Promise {\n    const imageUrl = await this.s3FileUploadService.upload(file)\n    console.log(body, imageUrl)\n    return await this.service.punchInAttendance({\n      comment: body.punchInComment,\n      outletId: body.outletId,\n      imgUrl: imageUrl,\n    })\n  }\n`\n```",
      "solution": "use `@ApiBody` because body keeps your data.\n \n`  @Post('upload')\n  @ApiConsumes('multipart/form-data')\n  @ApiBody({\n    schema: {\n      type: 'object',\n      properties: {\n        comment: { type: 'string' },\n        outletId: { type: 'integer' },\n        file: {\n          type: 'string',\n          format: 'binary',\n        },\n      },\n    },\n  })\n  @UseInterceptors(FileExtender)\n  @UseInterceptors(FileInterceptor('file'))\n  uploadFile2(@UploadedFile('file') file) {\n    console.log(file);\n  }\n`\n\nI get in console:\n`{\n  fieldname: 'file',\n  originalname: 'dart.txt',\n  encoding: '7bit',\n  mimetype: 'text/plain',\n  buffer: ,\n  size: 451,\n  comment: 'some comment',\n  outletId: 123456\n}\n`\nBecause `FileInterceptor` removes body params, I used `FileExtender` interceptor, to pack `comment` and `outletId` in file properties.\n`@Injectable()\nexport class FileExtender implements NestInterceptor {\n  intercept(context: ExecutionContext, next: CallHandler): Observable {\n    const req = context.switchToHttp().getRequest();\n    req.file['comment'] = req.body.comment;\n    req.file['outletId'] = Number(req.body.outletId);\n    return next.handle();\n  }\n}\n`",
      "question_score": 27,
      "answer_score": 69,
      "created_at": "2021-03-12T19:18:33",
      "url": "https://stackoverflow.com/questions/66605192/file-uploading-along-with-other-data-in-swagger-nestjs"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 68145372,
      "title": "Cannot find module &#39;@nestjs/core&#39; or its corresponding type declarations",
      "problem": "Couple of weeks ago I installed NestJS globally on my computer.\nNow I'm coming back to that, to start learning.\nSo I created new project with comand:\n```\n`nest new ./\n`\n```\nIt generated all the files, but when I try to run this application with command:\n```\n`nest start\n`\n```\nI expected this template project to start but there are errors with importing paths?\nIs this due to version of my installed Nest or something?\nErrors on the screen:\n\nVersion of my Nest:\n`7.5.6`\nPackage.json:\n```\n`  \"dependencies\": {\n    \"@nestjs/common\": \"^7.6.13\",\n    \"@nestjs/core\": \"^7.6.13\",\n    \"@nestjs/platform-express\": \"^7.6.13\",\n    \"reflect-metadata\": \"^0.1.13\",\n    \"rimraf\": \"^3.0.2\",\n    \"rxjs\": \"^6.6.6\"\n  },\n  \"devDependencies\": {\n    \"@nestjs/cli\": \"^7.5.6\",\n    \"@nestjs/schematics\": \"^7.2.7\",\n    \"@nestjs/testing\": \"^7.6.13\",\n    \"@types/express\": \"^4.17.11\",\n    \"@types/jest\": \"^26.0.20\",\n    \"@types/node\": \"^14.14.31\",\n    \"@types/supertest\": \"^2.0.10\",\n    \"@typescript-eslint/eslint-plugin\": \"^4.15.2\",\n    \"@typescript-eslint/parser\": \"^4.15.2\",\n    \"eslint\": \"^7.20.0\",\n    \"eslint-config-prettier\": \"^8.1.0\",\n    \"eslint-plugin-prettier\": \"^3.3.1\",\n    \"jest\": \"^26.6.3\",\n    \"prettier\": \"^2.2.1\",\n    \"supertest\": \"^6.1.3\",\n    \"ts-jest\": \"^26.5.2\",\n    \"ts-loader\": \"^8.0.17\",\n    \"ts-node\": \"^9.1.1\",\n    \"tsconfig-paths\": \"^3.9.0\",\n    \"typescript\": \"^4.1.5\"\n  },\n`\n```",
      "solution": "I had the same issue. The following two commands fixed it:\n```\n`npm install @nestjs/common\nnpm install @nestjs/core\n`\n```\nThese commands make sure you are using the lastest versions of those packages.\nSometimes you may also get error: `Cannot find module '@nestjs/mapped-types' or its corresponding type declarations.`\nIn that case, do:\n```\n`npm install @nestjs/mapped-types\n`\n```",
      "question_score": 27,
      "answer_score": 27,
      "created_at": "2021-06-26T20:48:26",
      "url": "https://stackoverflow.com/questions/68145372/cannot-find-module-nestjs-core-or-its-corresponding-type-declarations"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 65636980,
      "title": "How to test a nestjs service by passing in a ConfigService with custom values?",
      "problem": "I've created a service, and the module for it looks like this:\nlaunchdarkly.module.ts\n`@Module({\n  providers: [LaunchdarklyService],\n  exports: [LaunchdarklyService],\n  imports: [ConfigService],\n})\nexport class LaunchdarklyModule {}\n`\n(this service/module is to let the application use LaunchDarkly feature-flagging)\nI'm happy to show the service-implementation if you'd like, but to keep this question shorter I skipped it. The important point is that this service imports the `ConfigService` (which it uses to grab the LaunchDarkly SDK key).\nBut how can I test the `Launchdarkly` service? It reads a key from `ConfigService` so I want to  write tests where `ConfigService` has various values, but after hours of trying I can't figure out how to configure `ConfigService` in a test.\nHere's the test:\nlaunchdarkly.service.spec.ts\n`describe('LaunchdarklyService', () => {\n  let service: LaunchdarklyService;\n\n  beforeEach(async () => {\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [LaunchdarklyService],\n      imports: [ConfigModule],\n    }).compile();\n\n    service = module.get(LaunchdarklyService);\n  });\n\n  it(\"should not create a client if there's no key\", async () => {\n    // somehow I need ConfigService to have key FOO=undefined for this test\n    expect(service.client).toBeUndefined();\n  });\n\n  it(\"should create a client if an SDK key is specified\", async () => {\n    // For this test ConfigService needs to specify FOO=123\n    expect(service.client).toBeDefined();\n  });\n})\n`\nI'm open for any non-hacky suggestions, I just want to feature-flag my application!",
      "solution": "Assuming the `LaunchdarklyService` needs the `ConfigService` and that is injected into the constructor, you can provide a mock variation of the `ConfigService` by using a `Custom Provider` to give back the custom credentials you need. For example, a mock for your test could look like\n`describe('LaunchdarklyService', () => {\n  let service: LaunchdarklyService;\n  let config: ConfigService;\n\n  beforeEach(async () => {\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [LaunchdarklyService, {\n        provide: ConfigService,\n        useValue: {\n          get: jest.fn((key: string) => {\n            // this is being super extra, in the case that you need multiple keys with the `get` method\n            if (key === 'FOO') {\n              return 123;\n            }\n            return null;\n          })\n        }\n      ],\n    }).compile();\n\n    service = module.get(LaunchdarklyService);\n    config = module.get(ConfigService);\n  });\n\n  it(\"should not create a client if there's no key\", async () => {\n    // somehow I need ConfigService to have key FOO=undefined for this test\n    // we can use jest spies to change the return value of a method\n    jest.spyOn(config, 'get').mockReturnedValueOnce(undefined);\n    expect(service.client).toBeUndefined();\n  });\n\n  it(\"should create a client if an SDK key is specified\", async () => {\n    // For this test ConfigService needs to specify FOO=123\n    // the pre-configured mock takes care of this case\n    expect(service.client).toBeDefined();\n  });\n})\n`",
      "question_score": 26,
      "answer_score": 49,
      "created_at": "2021-01-08T23:01:22",
      "url": "https://stackoverflow.com/questions/65636980/how-to-test-a-nestjs-service-by-passing-in-a-configservice-with-custom-values"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 67032343,
      "title": "Nestjs: import modules undefined, but methods and functions from modules can be imported",
      "problem": "I am using `Nestjs` with WebStorm & TS 4.2.3^latest.\nThe problem that I am facing is a bit strange. For example, some modules, like `axios` can be installed, imported, and used as usual. But some modules, especially Nodejs Core, like `fs` or `path`, can't be imported as modules. BUT their methods can be imported and used just fine!\n`// ERROR: Module undefined on run:dev, but no error in IDE\nimport path from 'path';\nimport fs from 'fs';\n\n// Working fine\nimport { join } from 'path';\nimport { readFileSync } from 'path';\n`\nI am sure, they have correct TS types, even installed manually. For example:\n```\n`import axios from 'axios';\nimport path from 'path'; // path is undefined\nimport { join } from 'path';\nimport { Injectable } from '@nestjs/common';\n\n@Injectable()\nexport class AppService {\n  async test(input: string): Promise {\n    // working fine\n    await axios.get() \n    // Cannot read property 'join' of undefined\n    await path.join() \n\n    // await join() Works fine!\n  }\n}\n\n`\n```\nI have only one `tsconfig.json` which is generated by Nest Cli. I am starting my apps via `npm start:dev -name` and IDE doesn't show any errors in code until I run code.\n\ntsconfig.json module part, just to be sure: `\"module\": \"commonjs\"`, package.json doesn't have `module` part at all.",
      "solution": "IDE in this case, misdirect me a bit. Almost forgot, that I am dealing with TS now. Some modules seem to have no default exports, so:\n\nYou should import as with them: `import * as fs from 'fs';`\nOr, another option is enabling: `\"esModuleInterop\": true,` in your `tsconfig.json`",
      "question_score": 24,
      "answer_score": 66,
      "created_at": "2021-04-10T10:33:49",
      "url": "https://stackoverflow.com/questions/67032343/nestjs-import-modules-undefined-but-methods-and-functions-from-modules-can-be"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 70225539,
      "title": "How to validate query params in nestjs",
      "problem": "Yo, i have store application with nestjs, i need validate mongo id, which is pass by query, the problem is that i also pass and search query. I write pipe which validate all values, and exclude this search query\n```\n`@Injectable()\nexport class ValidationObjectId implements PipeTransform {\n    transform(value: UniqueId, metadata: ArgumentMetadata) {\n        if (\n            !Types.ObjectId.isValid(value) &&\n            metadata.data !== \"searchString\"\n        ) {\n            throw new BadRequestException(\"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 \u0437\u0430\u043f\u0440\u043e\u0441\u0430\");\n        }\n\n        return value;\n    }\n}\n`\n```\nBut this code not reusable for other case. I want get some examples, how i can do this",
      "solution": "The cleanest and most reusable approach would probably be to make use of the `ValidationPipe` with a Query-DTO-Class.\nTake a look at the following example.\nhttps://gitlab.com/WaldemarLehner/nestjs-swagger-example/-/tree/1aea48597ddcf93b0a0d1449fe5087413415bbee\nInside the Controller you can pass a Pipe to the `@Query()`-Decorator.\nYou can use the `ValidationPipe` which already comes with Nest and makes use of the `class-validator` and `class-transformer` Packages.\nYou can create a DTO-Class for your Query-Parameters as done in the PostHelloQuery.dto.ts from my example.\n```\n`import { IsBoolean, IsOptional } from \"class-validator\";\n\nexport class PostHelloQueryDTO {\n    @IsOptional()\n    @IsBoolean()\n    public useExclamation?: boolean;\n}\n`\n```\nHere you define constraints for your Data using decorators from `class-validator`. For a list of all decorators, please refer to https://github.com/typestack/class-validator#validation-decorators .\nIf none of the validators fit your needs you can also create your own Decorator as shown here.\nIn my example, the `useExclamation`-Query Param is an optional boolean.\nNote that incoming query parameters are parsed as strings.\nThe conversion is done using the `enableInplicitConversion`-Option as seen in the Controller:\n```\n`@Query(new ValidationPipe({\n    transform: true,\n    transformOptions: {enableImplicitConversion: true},\n    forbidNonWhitelisted: true\n})) query: PostHelloQueryDTO\n`\n```\nFor more information about using `ValidationPipe` with `class-validator`, you can take a look at the NestJS Documentation:\nhttps://docs.nestjs.com/techniques/validation\nFor your specific Use-Case (Validating MongoDB IDs), I have found an open Issue with an Example Implementation for a `@IsMongoDB`-Decorator:\nhttps://github.com/typestack/class-validator/issues/630#issuecomment-645638436",
      "question_score": 23,
      "answer_score": 53,
      "created_at": "2021-12-04T13:23:24",
      "url": "https://stackoverflow.com/questions/70225539/how-to-validate-query-params-in-nestjs"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 70897363,
      "title": "How to define the response body object, in a NestJs-generated Swagger document?",
      "problem": "I'm Using NestJs and its Swagger plugin to auto-generate documentation of my API.\nProblem is, I cant figure out how to make the response schema appear in the documentation. In my GET routes, all i get is \"Code 200\", with no data structure.\nI have a typical setup, where a controller method uses a corresponding service method, which in turn uses a TypeOrm repository. For example:\n```\n`@Get()\n findAll() {    \n   return this.usersService.findAll();\n}\n`\n```\nI tried using the @ApiResponse decorator, but didn't really see any way to make it serve this purpose. Also, creating a user.dto.ts and making it the return type of the controller route didn't do any good.\nEventually, this is what i get in the Swagger:\n\nHow can i define the response body schema?",
      "solution": "You can use the `type` and `isArray` properties in conjunction with the `ApiResponse` family of decorators. For example:\n```\n`@ApiOkResponse({\n    description: 'The user records',\n    type: User,\n    isArray: true\n})\n@Get()\n findAll() {    \n   return this.usersService.findAll();\n}\n`\n```\nAdditionally, consider using the Swagger CLI plugin to help you have these decorators applied automatically during build time instead of you having to keep everything in sync manually.",
      "question_score": 23,
      "answer_score": 33,
      "created_at": "2022-01-28T17:56:44",
      "url": "https://stackoverflow.com/questions/70897363/how-to-define-the-response-body-object-in-a-nestjs-generated-swagger-document"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 77084231,
      "title": "bun compatibility with nestjs?",
      "problem": "I am currently having a project that uses nestjs and I was wondering how compatible is it with bun 1.0. I haven't found a clear answer on the internet and I don't want to transfer my project on bun just to end up on a dead end because of compatibility problems.\nThis is a small project that uses react and mongodb for the moment but I plan on using the built-in support of sqlite from bun.\nI've already tried to use bun on the project and I can install the modules that I am currently using but I am scared of how far is it going. I haven't had the time to test everything so if I can get some info that would be nice.",
      "solution": "Update: It works now, except the build part. They are working on it. But I've got to say I'm becoming a fan of that developer's dedication.\nBun doesn't support `emitDecoratorMetadata` feature in typescript (yet?) which is required for NestJS because most dependency, pipes, guards all use Decorators in Nest. Also bun don't do type checking but that's an easy fix. Keep a watch on this GH Issue. Maybe someone will work on it and provide a solution since Bun did show NestJS Logo on the video.\n\nBut if you just want faster reloads, NestJS + SWC is pretty good.",
      "question_score": 22,
      "answer_score": 28,
      "created_at": "2023-09-11T21:10:48",
      "url": "https://stackoverflow.com/questions/77084231/bun-compatibility-with-nestjs"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 73591752,
      "title": "Eslint error `is defined but never used` warning in NestJs for all decorators",
      "problem": "I'm using NestJs framework for a project. Today discovered that EsLint finds 587 wrong problems.\nAll decorators generate this error:\n`warning  'IsBoolean' is defined but never used      @typescript-eslint/no-unused-vars\nwarning  'IsEmail' is defined but never used        @typescript-eslint/no-unused-vars\nwarning  'IsEnum' is defined but never used         @typescript-eslint/no-unused-vars\nwarning  'IsInt' is defined but never used          @typescript-eslint/no-unused-vars\nwarning  'IsOptional' is defined but never used     @typescript-eslint/no-unused-vars\n...\n`\nAnd all index files generate this errors\n`error  No named exports found in module './users.controller'  import/export\nerror  No named exports found in module './users.service'     import/export\nerror  No named exports found in module './users.module'  \n`\nBut all decorators are used and no index files has a named export.\nThis is a sample of my DTO class\n`import {\n  IsBoolean,\n  IsEmail,\n  IsEnum,\n  IsInt,\n  IsOptional,\n  IsString,\n  Matches,\n  Max,\n  MaxLength,\n  Min,\n  MinLength,\n} from 'class-validator';\n\nexport class UpdateUserDto {\n  @IsOptional()\n  @IsString()\n  @Matches(/^[a-zA-Z0-9-_.@]+$/)\n  @MinLength(3)\n  @MaxLength(32)\n  @ToCase({strategy: 'lower'})\n  @Trim()\n  username?: string;\n...\n`\nAnd this is one of my index files:\n`export * from './users.controller';\nexport * from './users.service';\nexport * from './users.module';\nexport * from './auth.controller';\nexport * from './auth.service';\n`\nAnd my eslintrc.js:\n`module.exports = {\n  parser: '@typescript-eslint/parser',\n  parserOptions: {\n    project: 'tsconfig.json',\n    sourceType: 'module',\n  },\n  plugins: ['@typescript-eslint/eslint-plugin', 'import'],\n  extends: [\n    './node_modules/gts/',\n    'plugin:@typescript-eslint/recommended',\n    'prettier/@typescript-eslint',\n    'plugin:prettier/recommended',\n    'plugin:import/errors',\n    'plugin:import/warnings',\n    'plugin:import/typescript',\n  ],\n  root: true,\n  env: {\n    node: true,\n    jest: true,\n  },\n  rules: {\n    '@typescript-eslint/interface-name-prefix': 'off',\n    '@typescript-eslint/explicit-function-return-type': 'off',\n    '@typescript-eslint/explicit-module-boundary-types': 'off',\n    '@typescript-eslint/no-explicit-any': 'warn',\n    'import/no-unresolved': 'error',\n    'import/no-cycle': 'warn',\n    'node/no-extraneous-import': [\n      'error',\n      {\n        allowModules: ['express'],\n      },\n    ],\n  },\n  settings: {\n    ['import/parsers']: {'@typescript-eslint/parser': ['.ts', '.tsx']},\n    ['import/resolver']: {\n      node: {\n        extensions: ['.ts'],\n        moduleDirectory: ['node_modules', 'src/'],\n      },\n      typescript: {\n        alwaysTryTypes: true, // always try to resolve types under `@types` directory even it doesn't contain any source code, like `@types/unist`\n        \n      },\n    },\n  },\n};\n`",
      "solution": "Typescript 4.8.0 changed the underlying AST that typescript-eslint was using to determine if functions were being used. You should be able to update all of your `@typescript-eslint/*` packages to `@5.35.1` or higher and it should all be working again",
      "question_score": 21,
      "answer_score": 49,
      "created_at": "2022-09-03T13:08:25",
      "url": "https://stackoverflow.com/questions/73591752/eslint-error-is-defined-but-never-used-warning-in-nestjs-for-all-decorators"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 66909895,
      "title": "TypeORM: QueryFailedError: relation does not exist",
      "problem": "I need a little help with migration. I'm trying to seed DB using migration. But I get an error \"QueryFailedError: relation \"account\" does not exist\". I think it's just typical newbie mistake. So please check my code:\naccount.entity.ts\n`import { BeforeInsert, Column, Entity, OneToMany } from 'typeorm';\nimport { AbstractEntity } from '../../common/abstract.entity';\nimport { SourceEntity } from '../source/source.entity';\nimport { UtilsService } from '../../shared/services/utils.service';\n\n@Entity({ name: 'account' })\nexport class AccountEntity extends AbstractEntity {\n  @Column({ unique: true })\n  username: string;\n\n  @Column({ nullable: true })\n  password: string;\n\n  @OneToMany(() => SourceEntity, (source) => source.account, {\n    cascade: true,\n  })\n  sources: SourceEntity[];\n\n  @BeforeInsert()\n  async setPassword() {\n    this.password = UtilsService.generateHash(this.password);\n  }\n}\n`\nseed-data.migration.ts\n`import { getCustomRepository, MigrationInterface, QueryRunner } from 'typeorm';\nimport { AccountRepository } from '../modules/account/account.repository';\nimport { SourceRepository } from '../modules/source/source.repository';\n\ntype DataType = {\n  username: string;\n  password: string;\n  sources: { username: string }[];\n};\n\nexport class SeedData1617243952346 implements MigrationInterface {\n  private data: DataType[] = [\n    {\n      username: 'test',\n      password: 'password',\n      sources: [\n        { username: 'some_test' },\n        { username: 'okey_test' },\n        { username: 'super_test' },\n      ],\n    },\n    {\n      username: 'account',\n      password: 'password',\n      sources: [\n        { username: 'some_account' },\n        { username: 'okey_account' },\n        { username: 'super_account' },\n      ],\n    },\n  ];\n\n  public async up(): Promise {\n    await Promise.all(\n      this.data.map(async (item) => {\n        const accountRepository = getCustomRepository(AccountRepository);\n        const accountEntity = accountRepository.create();\n        accountEntity.username = item.username;\n        accountEntity.password = item.password;\n\n        const sourceRepository = getCustomRepository(SourceRepository);\n        const sources = [];\n\n        await Promise.all(\n          item.sources.map(async (sourceItem) => {\n            const sourceEntity = sourceRepository.create();\n            sourceEntity.username = sourceItem.username;\n\n            sources.push(sourceEntity);\n          }),\n        );\n\n        accountEntity.sources = sources;\n        const account = await accountRepository.save(accountEntity);\n        console.log('Account created:', account.id);\n      }),\n    );\n  }\n\n  public async down(): Promise {\n    await Promise.all(\n      this.data.map(async (item) => {\n        const sourceRepository = getCustomRepository(SourceRepository);\n        const accountRepository = getCustomRepository(AccountRepository);\n\n        const account = await accountRepository.findOne({\n          where: { username: item.username },\n        });\n        if (account) {\n          await Promise.all(\n            item.sources.map(async (src) => {\n              const source = await sourceRepository.findOne({\n                where: { username: src.username },\n              });\n              if (source) {\n                await sourceRepository.delete(source);\n              }\n            }),\n          );\n\n          await accountRepository.delete(account);\n        }\n      }),\n    );\n  }\n}\n`\nsource.entity.ts\n`import { Column, Entity, ManyToOne } from 'typeorm';\nimport { AbstractEntity } from '../../common/abstract.entity';\nimport { AccountEntity } from '../account/account.entity';\n\n@Entity({ name: 'source' })\nexport class SourceEntity extends AbstractEntity {\n  @Column({ unique: true })\n  username: string;\n\n  @Column({ default: true })\n  overrideCaption: boolean;\n\n  @ManyToOne(() => AccountEntity, (account) => account.sources)\n  account: AccountEntity;\n}\n`\nError:\n`Error during migration run:\nQueryFailedError: relation \"account\" does not exist\n    at new QueryFailedError (/home/wiha/dev/own/instahub/src/error/QueryFailedError.ts:9:9)\n    at PostgresQueryRunner. (/home/wiha/dev/own/instahub/src/driver/postgres/PostgresQueryRunner.ts:228:19)\n    at step (/home/wiha/dev/own/instahub/node_modules/tslib/tslib.js:143:27)\n    at Object.throw (/home/wiha/dev/own/instahub/node_modules/tslib/tslib.js:124:57)\n    at rejected (/home/wiha/dev/own/instahub/node_modules/tslib/tslib.js:115:69)\n    at processTicksAndRejections (internal/process/task_queues.js:97:5) {\n  length: 106,\n  severity: 'ERROR',\n  code: '42P01',\n  detail: undefined,\n  hint: undefined,\n  position: '13',\n  internalPosition: undefined,\n  internalQuery: undefined,\n  where: undefined,\n  schema: undefined,\n  table: undefined,\n  column: undefined,\n  dataType: undefined,\n  constraint: undefined,\n  file: 'parse_relation.c',\n  line: '1191',\n  routine: 'parserOpenTable',\n  query: 'INSERT INTO \"account\"(\"id\", \"created_at\", \"updated_at\", \"username\", \"password\") VALUES (DEFAULT, DEFAULT, DEFAULT, $1, $2) RETURNING \"id\", \"created_at\", \"updated_at\"',\n  parameters: [\n    'test',\n    '$2b$10$iB6yb3D8e6iGmKoVAJ7eYeYfoItclw5lcVXqauPf9VH94DlDrbuSa'\n  ]\n}\n`\nTables are created in another migration\nDB: PostgreSQL 12.6\nNode: 14.0.0\nTypeORM: 0.2.32\n@nestjs/typeorm: 7.1.5",
      "solution": "When creating a connection through TypeORM you need to pass `synchronize: true,` if you want TypeORM to create schema for you. Alternativly you can manually run sync using the CLI with `schema:sync` command.\nMore\ne.g :\n```\n`\ncreateConnection({\n    type: \"mysql\",\n    host: \"localhost\",\n    port: 3306,\n    username: \"root\",\n    password: \"admin\",\n    database: \"test\",\n    entities: [\n        Photo\n    ],\n\n// ---\n    synchronize: true,\n// ---\n    logging: false\n`\n```\nFrom the docs\n\nsynchronize - Indicates if database schema should be auto created on every application launch. Be careful with this option and don't use this in production - otherwise you can lose production data. This option is useful during debug and development. As an alternative to it, you can use CLI and run schema:sync command. Note that for MongoDB database it does not create schema, because MongoDB is schemaless. Instead, it syncs just by creating indices.",
      "question_score": 20,
      "answer_score": 21,
      "created_at": "2021-04-01T20:38:24",
      "url": "https://stackoverflow.com/questions/66909895/typeorm-queryfailederror-relation-does-not-exist"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 67849597,
      "title": "How to write nested DTOs in NestJS",
      "problem": "I am a beginner in NestJS and I want to write a DTO for below structure -\n```\n`{\n    something: {\n        info: {\n            title: string,\n            score: number,\n            description: string,\n            time: string,\n            DateOfCreation: string\n        },\n        Store: {\n            item: {\n                question: string,\n                options: {\n                    item: {\n                        answer: string,\n                        description: string,\n                        id: string,\n                        key: string,\n                        option: string\n                    }\n                }\n            }\n        }\n    }\n}\n`\n```\nI want to write a DTO for that nested Data object. I can't find a solid example for writing nested DTO in NestJS. I am a beginner in NestJS and I have never worked with DTO before. So please don't assume that I know something. I am using it with Mongoose.",
      "solution": "You will have to create separate classes for each object in your schema and a main class which will import all the classes.\n```\n`import { Type } from \"class-transformer\";\n\nclass Info {\n    readonly title:string\n    readonly score:number\n    readonly description:string\n    readonly dateOfCreation:Date\n}\n\nexport class SampleDto {\n    @Type(() => Info)\n    @ValidateNested()\n    readonly info: Info\n\n    ...Follow same for the rest of the schema\n\n}\n\n`\n```\nRefer: https://github.com/typestack/class-validator#validating-nested-objects",
      "question_score": 19,
      "answer_score": 44,
      "created_at": "2021-06-05T14:29:31",
      "url": "https://stackoverflow.com/questions/67849597/how-to-write-nested-dtos-in-nestjs"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 66117005,
      "title": "TypeORM - left joining without &quot;deletedAt IS NULL&quot;",
      "problem": "Been searching this one for a while now, not sure if this is something unorthodox in the SQL world but I am trying to do a left join that counts with not null \"deletedAt\" column, but I cannot seem to find a way to do a left join which includes deletes.\nThis is just a dummy example that illustrates what I am trying to do, in this case I want to retrieve the person's information as well as the job's, but the job has been soft-deleted.\n```\n`this.createQueryBuilder('person')\n  .leftJoinAndSelect('person.job', 'job')\n`\n```\nThe SQL query produced by this implicitly adds \"IS NOT NULL\" on the left join but I have this scenario in which I need the information from a record that is indeed deleted.\nI haven't been able to find a way to include this as you would do it at the root level by including.\n```\n`.withDeleted();\n`\n```\nAnyone has any tips?",
      "solution": "In my tests, TypeOrm generates a different query depending on whether `.withDeleted()` is before or after `.leftJoinAndSelect()`\n```\n`// Normal case: Exclude both soft-deleted 'Person' and 'Job':\n        this.createQueryBuilder(\"Person\")\n        .leftJoinAndSelect('Person.job', 'Job');\n\n// 'withDeleted() after the join: Include soft-deleted 'Person' BUT EXCLUDE soft-deleted 'Job':\n        this.createQueryBuilder(\"Person\")\n        .leftJoinAndSelect('Person.job', 'Job')\n        .withDeleted();\n\n// 'withDeleted() before the join: Include both soft-deleted 'Person' and 'Job':\n        this.createQueryBuilder(\"Person\")\n        .withDeleted()\n        .leftJoinAndSelect('Person.job', 'Job');\n`\n```\nSo if you want to exclude the soft-deleted 'Person' but include the soft-deleted 'Job' (what I would expect), you can use withDeleted before the join (which will include everything) and add your own condition to then exclude soft-deleted 'Person' (i.e. add condition `\"Person.deletedAt IS NULL\"`). This way you don't need to do a complete RAW query:\n```\n`// 'withDeleted() before the join with extra condition: Exclude soft-deleted 'Person' BUT INCLUDE soft-deleted 'Job':\n        this.createQueryBuilder(\"Person\")\n        .withDeleted()\n        .andWhere(\"Person.deletedAt Is Null\")\n        .leftJoinAndSelect('Person.job', 'Job');\n`\n```\n(I tested with both TypeORM 0.2.30 and 0.2.31 and saw the same behaviour).",
      "question_score": 19,
      "answer_score": 40,
      "created_at": "2021-02-09T11:20:16",
      "url": "https://stackoverflow.com/questions/66117005/typeorm-left-joining-without-deletedat-is-null"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 67327201,
      "title": "what is jwks? what actully does jwks with refresh and access tokens?",
      "problem": "i am working on an authentication system that has access and refresh tokens and JWT and JWKS. my problem is that i don't know what is the functionality of JWKS. what is the functionality of JWKS in a authentication system that is working with JWT and refresh token and access token? what are public and private keys in this system? does JWKS need to connect to database?",
      "solution": "Do you mean `JWKS` or a `JWKS endpoint`?\n`JWKS` is JSON Web Key Set - a JSON notation for sharing public keys which are used to verify the signature of a signed JWT.\n`JWKS endpoint` is an endpoint exposed by the Authorization Server from which you can obtain a JWKS.\nWhenever you need to work with a content of a JWT (e.g. so you have an API which receives the JWT and need to perform authorization decisions) you should verify the signature. In order to verify it you need a public key, which corresponds to the private key used by the Authorization Server to sign the JWT. This public key can be obtained in different ways (e.g. you can hard code it in your API) and getting it from a `JWKS endpoint` is one valid way. If you have an option of reading public keys from a `JWKS endpoint` I would recommend to use it - this simplifies greatly key management in your system. Whenever you need to rotate keys, you just change them in the Authorization Server. It's especially useful if you do not control the Authorization Server - then you don't have to worry about keys rotation at all.\nYou can have a look at the second part of this free course: OpenID Connect in Details (requires email registration). The `JWKS` topic is covered there.",
      "question_score": 19,
      "answer_score": 36,
      "created_at": "2021-04-30T03:49:38",
      "url": "https://stackoverflow.com/questions/67327201/what-is-jwks-what-actully-does-jwks-with-refresh-and-access-tokens"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 75947475,
      "title": "Prisma: TypeError: Do not know how to serialize a BigInt",
      "problem": "I'm trying to fetch data from database and this is my prisma model:\n```\n`  model instant_reports {\n  id         BigInt    @id @default(autoincrement()) @db.UnsignedBigInt\n  created_at DateTime?\n  updated_at DateTime?\n  deleted_at DateTime?\n  timestamp  BigInt?\n  client_id  BigInt?\n  uniq_users BigInt?\n}\n`\n```\nSo when i fetch data like this\n```\n`  prismaService.instant_reports.findMany({\n      skip: 0,\n      take: 30,\n    });\n`\n```\nIt throws error\n\nTypeError: Do not know how to serialize a BigInt at JSON.stringify()\n\nAnd i don't even know how to deal with it, is there way to change data handler in `findMany` method?\nIf there is no rows in `instant_reports` so it gives me empty array without error, so the problem is in data with BigInt type",
      "solution": "It worked for me. Add this code to the beginning of yours.\n`BigInt.prototype.toJSON = function () {\n  const int = Number.parseInt(this.toString());\n  return int ?? this.toString();\n};\n`",
      "question_score": 18,
      "answer_score": 22,
      "created_at": "2023-04-06T10:41:58",
      "url": "https://stackoverflow.com/questions/75947475/prisma-typeerror-do-not-know-how-to-serialize-a-bigint"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 71869915,
      "title": "Nest can&#39;t resolve dependencies of the (?). Please make sure that the argument at index [0] is available in the RootTestModule context",
      "problem": "I try to run NestJs test but got the following error\n`Nest can't resolve dependencies of the (?). Please make sure that the argument at index [0] is available in the RootTestModule context.`\nThis project is using Mongoose for connecting to MongoDB\nYou can reproduce the error by running code in this repo\nhttps://github.com/kruyvanna/nestjs-test-error\nThank you in advance",
      "solution": "You'll get that error because you have the following module:\n`const module: TestingModule = await Test.createTestingModule({\n  providers: [CatService],\n}).compile();\n`\nand this provider:\n`@Injectable()\nexport class CatService {\n  constructor(@InjectModel(Cat.name) private catModel: Model) {}\n}\n`\nand there is no way to tell what's the value of `catModel` as its provider token was not registered within the testing module.\nTo fix that you could register it like the docs show\n`const module: TestingModule = await Test.createTestingModule({\n  providers: [CatService, { provide: getModelToken(Cat.name), useValue: jest.fn() }],\n}).compile();\n`",
      "question_score": 18,
      "answer_score": 33,
      "created_at": "2022-04-14T12:11:24",
      "url": "https://stackoverflow.com/questions/71869915/nest-cant-resolve-dependencies-of-the-please-make-sure-that-the-argument-a"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 65671318,
      "title": "Nestjs Circular dependency forwardRef() drawbacks",
      "problem": "Official Circular dependency says:\n\nA circular dependency occurs when two classes depend on each other. For example, class A needs class B, and class B also needs class A. Circular dependencies can arise in Nest between modules and between providers.\nWhile circular dependencies should be avoided where possible, you\ncan't always do so.\n\nWhat are the reasons for not using `forwardRef()`?",
      "solution": "Circular dependencies usually mean you have tightly bound logic and possibly unstable architecture that will not allow you to scale. If you really don't want to care about that, you can just sprinkle in `forwardRef` wherever you want, constructors and services, but that could lead to some strange, hard to resolve errors, and is generally seen as a bad practice amongst the Nest community.",
      "question_score": 16,
      "answer_score": 32,
      "created_at": "2021-01-11T18:01:52",
      "url": "https://stackoverflow.com/questions/65671318/nestjs-circular-dependency-forwardref-drawbacks"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 75227100,
      "title": "Typescript Unable to resolve signature of parameter of decorator in vscode",
      "problem": "I'm getting the error when I'm decorating the class in nestjs service.\nThe Typescript is compiling without errors, and I'm getting this problem only in VSCode.\n```\n`Unable to resolve signature of parameter decorator when called as an expression.\n  Argument of type 'undefined' is not assignable to parameter of type 'string | symbol'.ts(1239)\n`\n```\nMy tsconfig\n```\n`{\n  \"compilerOptions\": {\n    \"module\": \"commonjs\",\n    \"declaration\": false,\n    \"removeComments\": true,\n    \"strictNullChecks\": true,\n    \"emitDecoratorMetadata\": true,\n    \"experimentalDecorators\": true,\n    \"allowSyntheticDefaultImports\": true,\n    \"target\": \"ES2020\",\n    \"sourceMap\": true,\n    \"outDir\": \"./dist\",\n    \"baseUrl\": \"./\",\n    \"incremental\": true,\n    \"skipLibCheck\": true,\n  }\n}\n\n`\n```\nMy Class\n```\n`export class AuthService {\n  private readonly logger = new Logger('AuthService');\n  constructor(\n    private readonly jwtService: JwtService,\n    private readonly prisma: PrismaService,\n    private readonly passwordService: PasswordService,\n    private readonly configService: ConfigService,\n    private readonly twilioService: TwilioService,\n    private readonly userService: UsersService,\n    @InjectQueue('nest-worker') private nestWorkerQueue: Queue,\n    @InjectQueue('mailsend') private mailSend: Queue,\n    @Inject(CACHE_MANAGER) protected readonly cacheManager: Cache,\n    private readonly mailerService: MailService\n  ) {}\n\n`\n```\nI tried reinstalling typescript removing node modules, but the problem persists.",
      "solution": "Check your extensions. For me remove \"JavaScript and TypeScript Nightly\" extension solved this problem.",
      "question_score": 15,
      "answer_score": 11,
      "created_at": "2023-01-24T21:44:31",
      "url": "https://stackoverflow.com/questions/75227100/typescript-unable-to-resolve-signature-of-parameter-of-decorator-in-vscode"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 69419092,
      "title": "process.env&#39;s are undefined - NestJS",
      "problem": "I've decided to write here because I've ran out of ideas. I have a NestJS app in which I use env's - nothing unusual. But something strange happens when I want to use them. I also have my own parser of these values which returns them in a convenient object - that's the first file:\nenv.ts\n```\n`const parseStringEnv = (name: string) => {\n  const value: string = process.env[name];\n\n  if (!value) {\n    throw new Error(`Invalid env ${name}`);\n  }\n\n  return value;\n};\n\nconst parseIntEnv = (name: string) => {\n  const value: string = process.env[name];\n\n  const int: number = parseInt(value);\n\n  if (isNaN(int)) {\n    throw new Error(`Invalid env ${name}`);\n  }\n\n  return int;\n};\n\nconst parseBoolEnv = (name: string) => {\n  const value: string = process.env[name];\n\n  if (value === \"false\") {\n    return false;\n  }\n\n  if (value === \"true\") {\n    return true;\n  }\n\n  throw new Error(`Invalid env ${name}`);\n};\n\nconst parseMongoString = (): string => {\n  const host = parseStringEnv(\"DATABASE_HOST\");\n  const port = parseStringEnv(\"DATABASE_PORT\");\n  const user = parseStringEnv(\"DATABASE_USER\");\n  const pwd = parseStringEnv(\"DATABASE_PWD\");\n  const dbname = parseStringEnv(\"DATABASE_NAME\");\n\n  return `mongodb://${user}:${pwd}@${host}:${port}/${dbname}?authSource=admin&ssl=false`;\n};\n\nexport const env = {\n  JWT_SECRET: parseStringEnv(\"JWT_SECRET\"),\n  PORT_BACKEND: parseIntEnv(\"PORT_BACKEND\"),\n  CLIENT_HOST: parseStringEnv(\"CLIENT_HOST\"),\n  ENABLE_CORS: parseBoolEnv(\"ENABLE_CORS\"),\n  MONGO_URI: parseMongoString(),\n};\n\nexport type Env = typeof env;\n\n`\n```\nI want to use it for setting port on which the app runs on and also the connection parameters for Mongoose:\nIn main.ts:\n```\n`\nawait app.listen(env.PORT_BACKEND || 8080);\n\n`\n```\nNow, the magic starts here - the app starts just fine when ONLY `ConfigModule` is being imported. It will also start without `ConfigModule` and with `require('doting').config()` added. When I add `MongooseModule`, the app crashes because it can't parse env - and the best thing is that exception thrown has nothing to do with env's that are used to create `MONGO_URI`!! I'm getting \"`Invalid env JWT_SECRET`\" from my parser.\nIn app.module.ts\n```\n`import { Module } from \"@nestjs/common\";\nimport { ConfigModule } from \"@nestjs/config\";\nimport { MongooseModule } from \"@nestjs/mongoose\";\n\nimport { AppController } from \"./app.controller\";\nimport { env } from \"./common/env\";\n\n@Module({\n  imports: [\n    ConfigModule.forRoot({\n      isGlobal: true,\n    }),\n    MongooseModule.forRoot(env.MONGO_URI), //WTF?\n  ],\n  controllers: [AppController],\n})\nexport class AppModule {}\n`\n```\nI've honestly just ran out of ideas what could be wrong. The parser worked just fine in my last project (but I haven't used Mongoose so maybe that's what causes issues). Below is my .env file template.\n```\n`JWT_SECRET=\nENABLE_CORS=\nPORT_BACKEND=\nDATABASE_HOST=\nDATABASE_PORT=\nDATABASE_USER=\nDATABASE_PWD\nDATABASE_NAME=\nCLIENT_HOST=\n`\n```\nThanks for everyone who has spent their time trying to help me ;)",
      "solution": "What's happening is you're importing `env.ts` before the ConfigModule has imported and set the variables in your `.env` file.\nThis is why calling `require('dotenv').config()` works.  Under the hood, that's what the ConfigModule is doing for you.  However, your call to `ConfigModule.forRoot` is happening after you import `env.ts`, so the `.env` file hasn't been imported yet and those variables don't yet exist.\nI would highly recommend you take a look at custom configuration files, which handles this for you the \"Nest way\":\nFrom the Nest docs, but note that you could also use the `env.ts` file you already have:\n```\n`// env.ts\nexport default () => ({\n  // Add your own properties here however you'd like\n  port: parseInt(process.env.PORT, 10) || 3000,\n  database: {\n    host: process.env.DATABASE_HOST,\n    port: parseInt(process.env.DATABASE_PORT, 10) || 5432\n  }\n});\n`\n```\nAnd then modify your AppModule to the following.  Note that we're using the forRootAsync so that we can get a handle to the ConfigService and grab the variable from that.\n```\n`// app.module.ts\nimport configuration from './common/env';\n\n@Module({\n  imports: [\n    ConfigModule.forRoot({\n      load: [configuration],\n    }),\n    //  \n    MongooseModule.forRootAsync({\n      imports: [ConfigModule],\n      useFactory: async (configService: ConfigService) => ({\n        uri: configService.get('MONGO_URI'),\n      }),\n      inject: [ConfigService],\n    });\n  ],\n})\nexport class AppModule {}\n`\n```\nAs an alternative, you could also just call `require('dotenv').config()` inside your `env.ts` file at the top, but you'll miss out on all the ConfigModule helpers like dev/prod `.env` files.",
      "question_score": 15,
      "answer_score": 11,
      "created_at": "2021-10-02T20:19:43",
      "url": "https://stackoverflow.com/questions/69419092/process-envs-are-undefined-nestjs"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 68808863,
      "title": "@nestjs/swagger does not set authorization headers",
      "problem": "Can't authorize in a route using `@nestjs/swagger@5.0.9` because I don`t know how to configure the `Document` in a right way and I couldn't find a workable answer in authorization official docs / stackoverflow / github.\nI've stumbled upon a problem with JWT authorization in swagger. I'm using `\"@nestjs/swagger\": \"^5.0.9\"` and after I'm getting my access-token from a public route, I'm inserting it into the swagger ui field 'Authorize' which is configured with `.addBearerAuth()` method, which in this version(5.0.9) has this signature\n```\n`addBearerAuth(options?: SecuritySchemeObject, name?: string)\n`\n```\nas opposed to it lower version.\nI've tested my API in Postman and I'm easily get an authorization throw it, I've also created an intersector which is printing headers before route call, but unfortunately it only prints them while I'm calling a public route :/\nI only know that Postman is setting a Bearer token and it goes throw the route, and nothing similar is happening with swagger.\nI've tried a lot of combinations of this configuration, but I haven't come to a solution in result of which I'm getting authorized in my route method, from swagger I can't reach it because of the swagger auth is not setting an authorization header in case of a bad config or of me doing something completely wrong. And I can't figure it out.\nConfig of a `addBearerAuth` is placed lower:\n```\n`// swagger config\n...\nconst config = new DocumentBuilder()\n    .setTitle('SWAGGER API')\n    .setVersion('1.0.0')\n    .addBearerAuth(\n      { \n        // I was also testing it without prefix 'Bearer ' before the JWT\n        description: `[just text field] Please enter token in following format: Bearer `,\n        name: 'Authorization',\n        bearerFormat: 'Bearer', // I`ve tested not to use this field, but the result was the same\n        scheme: 'Bearer',\n        type: 'http', // I`ve attempted type: 'apiKey' too\n        in: 'Header'\n      },\n      'access-token',\n    )\n    .build();\n...\n`\n```\nSample of a route in my controller. Is matched with a `@ApiBearerAuth()` decorator which is talking to a swagger that that method is cant be reached without an authorization.\n```\n`@Get('/some-route')\n@ApiBearerAuth()\n@UseGuards(JwtAuthenticationGuard)\ngetData(\n  @ReqUser() user: User,\n): void {\n  this.logger.warn({user});\n}\n`\n```",
      "solution": "If I understood your question you need to specify in your controller which bearer token you are using. In your case:\n```\n`// swagger config\n...\nconst config = new DocumentBuilder()\n    .setTitle('SWAGGER API')\n    .setVersion('1.0.0')\n    .addBearerAuth(\n      { \n        // I was also testing it without prefix 'Bearer ' before the JWT\n        description: `[just text field] Please enter token in following format: Bearer `,\n        name: 'Authorization',\n        bearerFormat: 'Bearer', // I`ve tested not to use this field, but the result was the same\n        scheme: 'Bearer',\n        type: 'http', // I`ve attempted type: 'apiKey' too\n        in: 'Header'\n      },\n      'access-token', // This name here is important for matching up with @ApiBearerAuth() in your controller!\n    )\n    .build();\n...\n`\n```\nand in your controller:\n```\n`@Get('/some-route')\n@ApiBearerAuth('access-token') //edit here\n@UseGuards(JwtAuthenticationGuard)\ngetData(\n  @ReqUser() user: User,\n): void {\n  this.logger.warn({user});\n}\n`\n```",
      "question_score": 15,
      "answer_score": 19,
      "created_at": "2021-08-16T22:28:57",
      "url": "https://stackoverflow.com/questions/68808863/nestjs-swagger-does-not-set-authorization-headers"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 67799847,
      "title": "Mongoose/NestJs can&#39;t access createdAt even though {timestamps: true}",
      "problem": "I'm currently using Mongoose and NestJs and I'm struggling a bit regarding accessing the createdAt property.\nThis is my user.schema.ts\n```\n`@Schema({ timestamps: true})\nexport class User {\n  @Prop({ required: true })\n  name!: string;\n\n  @Prop({ required: true })\n  email!: string;\n}\n\nexport const UserSchema = SchemaFactory.createForClass(User);\n`\n```\nand in my user.service.ts\n```\n`public async getUser(\n    id: string,\n  ): Promise {\n    const user = await this.userModel.findOne({ id });\n\n    if (!user) {\n      throw new NotFoundException();\n    }\n\n    console.log(user.createdAt) // Property 'createdAt' does not exist on type 'User' .ts(2339)\n  }\n`\n```\nSo basically I've set timestamps to true but I'm still unable to access the createdAt property. By the way I also have a custom id which works fine so please ignore that in my service.ts\nI've tried setting `@Prop() createdAt?: Date` to the schema but it still hasn't worked.\nI've also tested this schema using MongoMemoryServer and Jest which shows that it returns createdAt.\nAny help as to why I can't access the createdAt property would be greatly appreciated!",
      "solution": "I tested your code, adding `@Prop() createdAt?: Date` should be able to access `createdAt`.\nThe only thing I spot from your code where you cannot access createdAt is the `id` you pass to the query. The key should be `_id`\n```\n`public async getUser(\n    id: string,\n): Promise {\n    const user = await this.userModel.findOne({ _id: id });\n\n    if (!user) {\n      throw new NotFoundException();\n    }\n\n    console.log(user.createdAt)\n}\n`\n```\nHere is the screenshot of my testing using your code:",
      "question_score": 15,
      "answer_score": 9,
      "created_at": "2021-06-02T08:15:24",
      "url": "https://stackoverflow.com/questions/67799847/mongoose-nestjs-cant-access-createdat-even-though-timestamps-true"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 70609616,
      "title": "Nest.js is giving cors error even when cors is enabled",
      "problem": "I am developing a next.js application with nest.js as the backend. Now, I am having cors error even when I have cors enabled in my `main.ts` file of nest.js.\nHere's my main.ts file.\n```\n`\n    import { NestFactory } from '@nestjs/core';\n    import { AppModule } from './app.module';\n    import cookieParser from 'cookie-parser';\n    \n    async function bootstrap() {\n      const app = await NestFactory.create(AppModule);\n      if (process.env.APP_ENV !== 'production') {\n        app.enableCors({\n          allowedHeaders: '*',\n          origin: '*',\n          credentials: true,\n        });\n      } else {\n        app.enableCors({\n          origin: process.env.FE_URL,\n          credentials: true,\n        });\n      }\n    \n      app.use(cookieParser());\n      await app.listen(process.env.PORT || 5000);\n    }\n    bootstrap();\n\n`\n```\nI also tried the following.\n```\n`\n    import { NestFactory } from '@nestjs/core';\n    import { AppModule } from './app.module';\n    import cookieParser from 'cookie-parser';\n    \n    async function bootstrap() {\n      const app = await NestFactory.create(AppModule);\n      \n      app.enableCors({\n        allowedHeaders: '*',\n        origin: '*',\n        credentials: true,\n      });\n    \n      app.use(cookieParser());\n      await app.listen(process.env.PORT || 5000);\n    }\n    bootstrap();\n\n`\n```\nI also tried this\n```\n`\n    app.enableCors({\n      origin: 'http://localhost:3000',\n      credentials: true,\n    });\n\n`\n```\nNow, from the frontend in `_app.js`, I am defining Axios global config like the following.\n```\n`\n    axios.defaults.baseURL = 'http://localhost:5000';\n    axios.defaults.withCredentials = true;\n\n`\n```\nThen in my `login.tsx` file, I am sending the request to the nest.js application like the following.\n```\n`\n    const {data } = await axios.post('/auth/login', values);\n\n`\n```\nHere's values is an object that has a username and password.\nHere is the error.\n\nI also tried every other solution from other StackOverflow questions. But none of them solved my problem. It actually worked a few days ago. I don't know what happened.\nWhat am I doing wrong here? It's been driving me bananas now. If you need, I can provide more code.",
      "solution": "As explained on the MDN Web Docs about CORS, you cannot use the wildcard (`*`), whether it be to allow an origin or request headers or request methods (or to expose response headers), in conjunction with credentialed requests. A more authoritative (though perhaps more dry) resource is the Fetch standard:\n\nFor `Access-Control-Expose-Headers`, `Access-Control-Allow-Methods`, and `Access-Control-Allow-Headers` response headers, the value `*` counts as a wildcard for requests without credentials. For such requests there is no way to solely match a header name or method that is `*`.\n\nAccordingly, the following code produces a dysfunctional CORS middleware; you could argue that your CORS middleware library should prevent its users from producing such a dysfunctional CORS middleware, but it sadly does not.\n`app.enableCors({\n  allowedHeaders: '*',\n  origin: '*',\n  credentials: true,\n});\n`\nInstead, you should eschew the wildcard altogether and explicitly specify the allowed origin and allowed request headers, like so:\n`app.enableCors({\n  allowedHeaders: ['content-type'],\n  origin: 'http://localhost:3000',\n  credentials: true,\n});\n`",
      "question_score": 15,
      "answer_score": 17,
      "created_at": "2022-01-06T16:39:12",
      "url": "https://stackoverflow.com/questions/70609616/nest-js-is-giving-cors-error-even-when-cors-is-enabled"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 66169705,
      "title": "Bundle a NestJS + TypeORM application (with webpack)",
      "problem": "I recently have to think about a deployment method for a new piece of software that is written with:\n\nNestJS 6 / Express\nTypeORM 0.2\nTypeScript is used\n\nThe software will be deployed on more than 160 servers, distributed all across Europe, and some of them have very bad Internet connections.\nI did some research and a lot of people explicitly advices against bundling. The main argument is that native extension will fails with bundlers like `webpack` or `rollup` (Spoiler: it's true, but there is a solution). In my opinion, it's largely due to the fact that people don't care for this: the author of `node-pre-gyp` used nearly the same words for this use case. So usually, I was told to either use `yarn install` or sync the `node_modules/` folder.\nThe project is new, but the `node_modules/` folder is already more than 480 MB. Using XZ with maximum compression gave me an archive of 20 MB. This is still way too large for me, and seems like a huge waste of resources.\nI also had a look at the following Q&A:\n\nHow to correctly build NestJS app for production with node_modules dependencies in bundle? Explains that NestJS support webpack without `node_modules/` out of the box.\nSingle file bundle with NestJS + Typescript + Webpack + node_modules Working answer, without further explanations. Also `IgnorePlugins` seems to be overkill.\nHow to bundle nestjs application with webpack Seems to copy/paste a working solution from ZenSoftware without quoting. Links to another answer.\nNestJS optimization minimize not work with webpack Give an advice to disable minimization with NestJS application\n\nThere are also some separate Q&A for TypeORM, but all of them seems to require the installation of `ts-node` or `typescript`:\n\nTypeORM + Webpack causes SyntaxError: Unexpected token for entity file\nIsomoprhic application, problem with TypeORM && TypeScript && Express && Webpack setup\nSyntaxError: Unexpected token import typeORM entity",
      "solution": "UPDATE 2022-09-05\nNow that `ormconfig.json` have been seriously deprecated from TypeORM in version 0.3.0, the data source definition is a separate JS (or even TS) file that must be bundled by Webpack.\nThis was tricky, since this will be a dynamic require(), so Webpack can't know how to handle it in TypeORM code. The hint is the `library` key in entry point definition, without a name. You can go to the code above, but here is the excerpt:\n`  entry: {\n    main: './src/main.ts',\n    console: \"./src/console.ts\",\n    'data-source': {\n      import: './src/data-source.ts',\n      library: {\n        type: 'commonjs2'\n      }\n    },\n    typeorm:  './node_modules/typeorm/cli.js',\n  },\n`\nUPDATE 2021-08-25\nThe original response was done with NestJS 6, that used Webpack 4.\nSince NestJS 8 uses Webpack 5, chunk split is available, and provides a better solution.\nI also integrated the use of webpack-merge to have only one configuration file.\nThis only changes the Webpack configuration that you'll see while reading.\nOriginal answer\nI managed to have a good solution, that generate a self-contained RPM of 2.7 MB with the following tools:\n\n`webpack` with special configuration\nRPM, using `webpack`, in order to distribute generated files.\n\nThe software is an API server, using PostgreSQL for persistence. Users are usually authenticated using an external servers, but we can have local (emergency) users, so we use `bcrypt` to store and check passwords.\nI have to insist: my solution does not work with native extensions. Fortunately, the popular `bcrypt` can be replaced with a pure JS implementation, and the most popular postgresql package is able of using both compiled or pure JS.\nIf want to bundle with native extension, you can try to use ncc. They managed to implement a solution for `node-pre-gyp` dependent packages that worked for me in some preliminary tests. Of course, the compiled extensions should match your target platform, as always for compiled stuff.\nI personally chose `webpack` because NestJS support this in it's `build` command. This is merely a passthrough to the `webpack` compiler, but it seems to adjust some paths, so it was kind of easier.\nSo, how to achieve this? `webpack` can bundle everything in a single file, but in this use case, I need three of them:\n\nThe main program\nThe TypeORM migration CLI tool\nThe TypeORM migration scripts, because they can't be bundled with the tool, as it relies on filename\n\nAnd since each bundling required different options\u2026 I used 3 `webpack` files. Here is the layout:\n```\n`webpack.config.js\nwebpack\n\u251c\u2500\u2500 migrations.config.js\n\u2514\u2500\u2500 typeorm-cli.config.js\n`\n```\nAll those files were based of the same template kindly provided by ZenSoftware. The main difference is that I switched from `IgnorePlugin` to `externals` because that is simpler to read, and fits the use case perfectly.\n`// webpack.config.js\nconst { NODE_ENV = 'production' } = process.env;\n\nconsole.log(`-- Webpack  build --`);\n\nmodule.exports = {\n  target: 'node',\n  mode: NODE_ENV,\n  externals: [\n    // Here are listed all optional dependencies of NestJS,\n    // that are not installed and not required by my project\n    {\n      'fastify-swagger': 'commonjs2 fastify-swagger',\n      'aws-sdk': 'commonjs2 aws-sdk',\n      '@nestjs/websockets/socket-module': 'commonjs2 @nestjs/websockets/socket-module',\n      '@nestjs/microservices/microservices-module': 'commonjs2 @nestjs/microservices/microservices-module',\n      \n      // I'll skip pg-native in the production deployement, and use the pure JS implementation\n      'pg-native': 'commonjs2 pg-native'\n    }\n  ],\n  optimization: {\n    // Minimization doesn't work with @Module annotation\n    minimize: false,\n  }\n};\n`\nConfiguration files for TypeORM are more verbose, because we need to explicit the use of TypeScript. Fortunately, they have some advices for this in their FAQ. However, bundling the migration tool required two more hacks:\n\nIgnore the shebang at the beginning of the file. Easily solved with `shebang-loader` (that stills work as-is after 5 years!)\nForce `webpack` not to replace `require` call to dynamic configuration file, used to load configuration from JSON or `env` files. I was guided by this QA and finally build my own package.\n\n`// webpack/typeorm-cli.config.js\n\nconst path = require('path');\n// TypeScript compilation option\nconst TsconfigPathsPlugin = require('tsconfig-paths-webpack-plugin');\n// Don't try to replace require calls to dynamic files\nconst IgnoreDynamicRequire = require('webpack-ignore-dynamic-require');\n\nconst { NODE_ENV = 'production' } = process.env;\n\nconsole.log(`-- Webpack  build for TypeORM CLI --`);\n\nmodule.exports = {\n  target: 'node',\n  mode: NODE_ENV,\n  entry: './node_modules/typeorm/cli.js',\n  output: {\n    // Remember that this file is in a subdirectory, so the output should be in the dist/\n    // directory of the project root\n    path: path.resolve(__dirname, '../dist'),\n    filename: 'migration.js',\n  },\n  resolve: {\n    extensions: ['.ts', '.js'],\n    // Use the same configuration as NestJS\n    plugins: [new TsconfigPathsPlugin({ configFile: './tsconfig.build.json' })],\n  },\n  module: {\n    rules: [\n      { test: /\\.ts$/, loader: 'ts-loader' },\n      // Skip the shebang of typeorm/cli.js\n      { test: /\\.[tj]s$/i, loader: 'shebang-loader' }\n    ],\n  },\n  externals: [\n    {\n      // I'll skip pg-native in the production deployement, and use the pure JS implementation\n      'pg-native': 'commonjs2 pg-native'\n    }\n  ],\n  plugins: [\n    // Let NodeJS handle are requires that can't be resolved at build time\n    new IgnoreDynamicRequire()\n  ]\n};\n`\n`// webpack/migrations.config.js\n\nconst glob = require('glob');\nconst path = require('path');\n// TypeScript compilation option\nconst TsconfigPathsPlugin = require('tsconfig-paths-webpack-plugin');\n// Minimization option\nconst TerserPlugin = require('terser-webpack-plugin');\n\nconst { NODE_ENV = 'production' } = process.env;\n\nconsole.log(`-- Webpack  build for migrations scripts --`);\n\nmodule.exports = {\n  target: 'node',\n  mode: NODE_ENV,\n  // Dynamically generate a `{ [name]: sourceFileName }` map for the `entry` option\n  // change `src/db/migrations` to the relative path to your migration folder\n  entry: glob.sync(path.resolve('src/migration/*.ts')).reduce((entries, filename) => {\n    const migrationName = path.basename(filename, '.ts');\n    return Object.assign({}, entries, {\n      [migrationName]: filename,\n    });\n  }, {}),\n  resolve: {\n    // assuming all your migration files are written in TypeScript\n    extensions: ['.ts'],\n    // Use the same configuration as NestJS\n    plugins: [new TsconfigPathsPlugin({ configFile: './tsconfig.build.json' })],\n  },\n  module: {\n    rules: [\n      { test: /\\.ts$/, loader: 'ts-loader' }\n    ]\n  },\n  output: {\n    // Remember that this file is in a subdirectory, so the output should be in the dist/\n    // directory of the project root\n    path: __dirname + '/../dist/migration',\n    // this is important - we want UMD (Universal Module Definition) for migration files.\n    libraryTarget: 'umd',\n    filename: '[name].js',\n  },\n  optimization: {\n    minimizer: [\n      // Migrations rely on class and function names, so keep them.\n      new TerserPlugin({\n        terserOptions: {\n          mangle: true, // Note `mangle.properties` is `false` by default.\n          keep_classnames: true,\n          keep_fnames: true,\n        }\n      })\n    ],\n  },\n};\n`\nUpdate 2021-08-25 Nest 8/Webpack 5\nSince nest-cli moved to webpack 5, an interesting feature is now available: chunk split for node target.\nI was also upset to manage multiple files with the same logic, so I decided to use webpack-merge to have only one configuration file.\nYou'll have to `yarn add -D webpack-merge` and have the following `webpack.config.js`\n`// webpack.config.js\nconst { merge } = require(\"webpack-merge\")\nconst path = require('path')\nconst glob = require('glob')\nconst TsconfigPathsPlugin = require('tsconfig-paths-webpack-plugin')\nconst TerserPlugin = require('terser-webpack-plugin')\nconst MomentLocalesPlugin = require('moment-locales-webpack-plugin')\nconst IgnoreDynamicRequire = require('webpack-ignore-dynamic-require')\n\nconst { NODE_ENV = 'production', ENTRY, npm_lifecycle_event: lifecycle } = process.env\n\n// Build platform don't support ?? and ?. operators\nconst entry = ENTRY || (lifecycle && lifecycle.match(/bundle:(?\\w+)/).groups[\"entry\"])\n\nif (entry === undefined) {\n  throw new Error(\"ENTRY must be defined\")\n}\n\nconsole.log(`-- Webpack  build  for  --`);\n\nconst BASE_CONFIG = {\n  target: 'node',\n  mode: NODE_ENV,\n  resolve: {\n    extensions: ['.ts', '.js'],\n    plugins: [new TsconfigPathsPlugin({ configFile: './tsconfig.build.json' })],\n  },\n  module: {\n    rules: [\n      { test: /\\.ts$/, loader: 'ts-loader' }\n    ]\n  },\n  output: {\n    path: path.resolve(__dirname, 'dist/'),\n    filename: '[name].js',\n  },\n}\n\nconst MIGRATION_CONFIG = {\n  // Dynamically generate a `{ [name]: sourceFileName }` map for the `entry` option\n  // change `src/db/migrations` to the relative path to your migration folder\n  entry: glob.sync(path.resolve('src/migration/*.ts')).reduce((entries, filename) => {\n    const migrationName = path.basename(filename, '.ts')\n    return Object.assign({}, entries, {\n      [migrationName]: filename,\n    })\n  }, {}),\n  output: {\n    path: path.resolve(__dirname, 'dist/migration'),\n    // this is important - we want UMD (Universal Module Definition) for migration files.\n    libraryTarget: 'umd',\n    filename: '[name].js',\n  },\n  optimization: {\n    minimizer: [\n      new TerserPlugin({\n        terserOptions: {\n          mangle: true, // Note `mangle.properties` is `false` by default.\n          keep_classnames: true,\n          keep_fnames: true,\n        }\n      })\n    ],\n  }\n}\n\nconst TYPEORM_CONFIG = {\n  entry: {\n    typeorm: './node_modules/typeorm/cli.js'\n  },\n  externals: [\n    {\n      'pg-native': 'commonjs2 pg-native',\n    }\n  ],\n  plugins: [\n    new IgnoreDynamicRequire(),\n  ],\n  module: {\n    rules: [\n      { test: /\\.[tj]s$/i, loader: 'shebang-loader' }\n    ],\n  },\n}\n\nconst MAIN_AND_CONSOLE_CONFIG = {\n  entry: {\n    main: './src/main.ts',\n    console: \"./src/console.ts\"\n  },\n  externals: [\n    {\n      'pg-native': 'commonjs2 pg-native',\n      'fastify-swagger': 'commonjs2 fastify-swagger',\n      '@nestjs/microservices/microservices-module': 'commonjs2 @nestjs/microservices/microservices-module',\n      '@nestjs/websockets/socket-module': 'commonjs2 @nestjs/websockets/socket-module',\n      // This one is a must have to generate the swagger document, but we remove it in production\n      'swagger-ui-express': 'commonjs2 swagger-ui-express',\n      'aws-sdk': 'commonjs2 aws-sdk',\n    }\n  ],\n  plugins: [\n    // We don't need moment locale\n    new MomentLocalesPlugin()\n  ],\n  optimization: {\n    // Full minization doesn't work with @Module annotation\n    minimizer: [\n      new TerserPlugin({\n        terserOptions: {\n          mangle: true, // Note `mangle.properties` is `false` by default.\n          keep_classnames: true,\n          keep_fnames: true,\n        }\n      })\n    ],\n    splitChunks: {\n      cacheGroups: {\n        commons: {\n          test: /[\\\\/]node_modules[\\\\/]/,\n          name: 'vendors',\n          chunks: 'all'\n        }\n      }\n    }\n  }\n}\n\nconst withPlugins = (config) => (runtimeConfig) => ({\n  ...config,\n  plugins: [\n    ...runtimeConfig.plugins,\n    ...(config.plugins || [])\n  ]\n})\n\nconst config = entry === \"migrations\" ? merge(BASE_CONFIG, MIGRATION_CONFIG)\n  : entry === \"typeorm\" ? merge(BASE_CONFIG, TYPEORM_CONFIG)\n  : entry === \"main\" ? merge(BASE_CONFIG, MAIN_AND_CONSOLE_CONFIG)\n    : undefined\n\nmodule.exports = withPlugins(config)\n\n`\nWith this file, the webpack configuration is chosen from the current command: `bundle:main` will select the configuration for the main entry point.\nYou'll notice also that there are now multiple entry points in the main: `main` and `console`. The former is for the main application, and the latter is for a CLI helper. But they all share the same (and huge) amount of code, and Webpack 5 is able to do that with `splitChunks` section. This was available in Webpack 4 but not working for `node` targets.\nFinally, some optimization are now fully working even with decorators (that uses reflection), when you keep class and function names.\nBundle is smaller, code is shared, `package.json` is clearer, everyone is happy.\nEnd of update\nUpdate for TypeORM >= 0.3\nSince we now have to use a JS data source, it must be discoverable from TypeORM CLI.\n```\n`\nconst TYPEORM_CONFIG = {\n  entry: {\n    'data-source': {\n      // Are you ready? You must provide a data source as TypeORM cli >= 0.3\n      // But this will be a dynamic require(), so Webpack can't know how to handle it\n      // in TypeORM code. Instead, export this data source as a library.\n      // BUT, TypeORM expect it to be at the top level instead of a module variable, so\n      // we MUST remove the library name to make webpack export each variable from data source into the module\n      import: './src/data-source.ts',\n      library: {\n        type: 'commonjs2'\n      }\n    },\n    typeorm: './node_modules/typeorm/cli.js'\n  },\n  externals: [\n    {\n      'pg-native': 'commonjs2 pg-native',\n    }\n  ],\n  plugins: [\n    new IgnoreDynamicRequire(),\n  ],\n  module: {\n    rules: [\n      { test: /\\.[tj]s$/i, loader: 'shebang-loader' }\n    ],\n  },\n}\n`\n```\nEnd of update for TypeORM >= 0.3\nAfter that, to simplify the build process I added some targets in `package.json`:\n`{\n  \"scripts\": {\n    \"bundle:application\": \"nest build --webpack\",\n    \"bundle:migrations\": \"nest build --webpack --webpackPath webpack/typeorm-cli.config.js && nest build --webpack --webpackPath webpack/migrations.config.js\",\n    \"bundle\": \"yarn bundle:application && yarn bundle:migrations\"\n  },\n}\n`\nAnd\u2026 you're nearly done. You can call `yarn bundle`, and the output will kindly be built in the `dist/` directory. I didn't managed to remove some TypeScript definition files that were generated, but that wasn't a real issue.\nThe final step was writing the RPM specification file:\n```\n`%build\nmkdir yarncache\nexport YARN_CACHE_FOLDER=yarncache\n\n# Setting to avoid node-gype trying to download headers\nexport npm_config_nodedir=/opt/rh/rh-nodejs10/root/usr/\n\n%{_yarnbin} install --offline --non-interactive --frozen-lockfile\n%{_yarnbin} bundle\n\nrm -r yarncache/\n\n%install\ninstall -D -m644 dist/main.js $RPM_BUILD_ROOT%{app_path}/main.js\n\ninstall -D -m644 dist/migration.js $RPM_BUILD_ROOT%{app_path}/migration.js\n# Migration path have to be changed, let's hack it.\nsed -ie 's/src\\/migration\\/\\*\\.ts/migration\\/*.js/' ormconfig.json\ninstall -D -m644 ormconfig.json $RPM_BUILD_ROOT%{app_path}/ormconfig.json\nfind dist/migration -name '*.js' -execdir install -D -m644 \"{}\" \"$RPM_BUILD_ROOT%{app_path}/migration/{}\" \\;\n`\n```\nIf you use TypeORM >= 0.3 with a JS data source, the sed line doesn't have to be done, since a DataSource can accept production and development sources. However, the `ormconfig.json` must be replaced by the data-source.js.\nAnd the systemd service file can give you how to launch this. The target platform is CentOS7, so I have to use NodeJS 10 from software collections. You can adapt the path to your NodeJS binary.\n`[Unit]\nDescription=NestJS Server\nAfter=network.target\n\n[Service]\nType=simple\nUser=nestjs\nEnvironment=SCLNAME=rh-nodejs10\nExecStartPre=/usr/bin/scl enable $SCLNAME -- /usr/bin/env node migration migration:run\nExecStart=/usr/bin/scl enable $SCLNAME -- /usr/bin/env node main\nWorkingDirectory=/export/myapplication\nRestart=on-failure\n\n# Hardening\nPrivateTmp=true\nNoNewPrivileges=true\nProtectSystem=full\nProtectHome=read-only\n\n[Install]\nWantedBy=multi-user.target\n`\nIf you use a TypeORM JS datasource, you must add `-f data-source.js` to `ExecStartPre`.\nFinal statistics:\n\nBuild time 3 minutes 30 seconds on a dual core virtual machine.\nRPM size is 2.70 MB, self contained, with 3 JavaScript files, and 2 configuration files (`.production.env` for the main application and `ormconfig.json` for migrations)",
      "question_score": 15,
      "answer_score": 18,
      "created_at": "2021-02-12T10:58:02",
      "url": "https://stackoverflow.com/questions/66169705/bundle-a-nestjs-typeorm-application-with-webpack"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 66214269,
      "title": "Nestjs readFileSync return Cannot read property &#39;readFileSync&#39; of undefined",
      "problem": "I trying get file using method `readFileSync`:\n```\n`import fs from 'fs';\nimport path from 'path';\n\nconst templateFile = fs.readFileSync(\n    path.resolve(\n    __dirname,\n    '../mail/templates/exampleTemplate.html',\n    ),\n    'utf-8',\n);\n`\n```\nNest still return me error:\n\nTypeError: Cannot read property 'readFileSync' of undefined\n\nI tryied used to path: `./templates/exampleTemplate.html`, but result is the same\nI have a structure file:",
      "solution": "Typescript does not have a default export of `fs`, which is could simply solved by aliasing the whole import.\n`import * as fs from 'fs'\n`",
      "question_score": 14,
      "answer_score": 45,
      "created_at": "2021-02-15T20:31:20",
      "url": "https://stackoverflow.com/questions/66214269/nestjs-readfilesync-return-cannot-read-property-readfilesync-of-undefined"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 68689281,
      "title": "Nest.js Testing Error: Using the &quot;extends Logger&quot; instruction is not allowed in Nest v8. Please, use &quot;extends ConsoleLogger&quot; instead",
      "problem": "Here's the problem I have:\nI am using my custom Logger in Nest.js:\n`export class ReportLogger extends ConsoleLogger {\n  verbose(message: string) {\n    console.log('\u3010Verbose\u3011Reporting', message);\n    super.verbose.apply(this, arguments);\n  }\n\n  log(message: string) {\n    console.log('\u3010Log\u3011Reporting', message);\n    super.log.apply(this, arguments);\n  }\n}\n`\nAnd the `log.interceptor.ts` file:\n```\n`export class LogInterceptor implements NestInterceptor {\n  constructor(private reportLogger: ReportLogger) {\n    this.reportLogger.setContext('LogInterceptor');\n  }\n\n  intercept(context: ExecutionContext, next: CallHandler) {\n    const http = context.switchToHttp();\n    const request = http.getRequest();\n\n    const now = Date.now();\n    return next\n      .handle()\n      .pipe(\n        tap(() =>\n          this.reportLogger.log(\n            `${request.method} ${request.url} ${Date.now() - now}ms`,\n          ),\n        ),\n      );\n  }\n}\n`\n```\nAnd here's the `main.ts` file:\n```\n`async function bootstrap() {\n  const reportLogger = new ReportLogger();\n\n  const app = await NestFactory.create(AppModule, {\n    cors: {\n      origin: ['http://localhost', 'http://localhost:3000'],\n      credentials: true,\n    },\n    bufferLogs: true,\n    logger: reportLogger,\n  });\n\n  app.useGlobalInterceptors(\n    new LogInterceptor(reportLogger),\n  );\n\n  setupSwagger(app);\n\n  await app.listen(4200);\n}\n`\n```\nWhen I run `npm run start:dev` to run the Nest App on dev, everything works fine. But when I run `npm run test:e2e` or `npm run test` on testing, it shows this error:\n```\n`  Using the \"extends Logger\" instruction is not allowed in Nest v8. Please, use \"extends ConsoleLogger\" instead.\n\n      10 |     const moduleFixture: TestingModule = await Test.createTestingModule({\n      11 |       imports: [AppModule],\n    > 12 |     }).compile();\n         |        ^\n      13 |\n      14 |     app = moduleFixture.createNestApplication();\n      15 |     await app.init();\n`\n```\nI read the Nest.js doc again, and found the Logging breaking change in the docs. But the question is I have already made my ReportLogger extends ConsoleLogger, why this error shows again? And why it only shows in testing?",
      "solution": "I have faced the same problem after upgrading NestJS to version 8.\nLater on, I found that package `@nestjs/testing` had previous version installed and was not upgraded to the latest version. The reason is, previous version of NestJS testing module is using the old Logger.\nIn order to fix this issue, you just need to upgrade the NestJS testing module.\nRun this command for Latest version:\n```\n`npm i @nestjs/testing@latest\n`\n```\nOR specific version\n```\n`npm i @nestjs/testing@8.0.6 // After this, just build and run test cases again.\nExternal Links:\n\nNestJS Testing NPM",
      "question_score": 14,
      "answer_score": 33,
      "created_at": "2021-08-07T05:53:58",
      "url": "https://stackoverflow.com/questions/68689281/nest-js-testing-error-using-the-extends-logger-instruction-is-not-allowed-in"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 70137558,
      "title": "Does TypeORM provide transactions for different repositories?",
      "problem": "Currently, three different repositories have something to deal with as a single transaction.\nMy service code is written as follows. But unlike what I thought, each repository is generating its own transaction. How can I solve this problem?\n`// TrimService\n\n@Injectable()\nexport class TrimService {\n    constructor(\n        private readonly trimRepository: TrimRepository,\n        private readonly tireRepository: TireRepository,\n        private readonly userRepository: UserRepository\n    ) {}\n\n    async saveUserTrim(saveUserTrimDto: SaveUserTrimDto, res) {\n        const queryRunner = await getConnection().createQueryRunner();\n        await queryRunner.startTransaction();\n\n        try {\n            const findUser: User = await this.userRepository.findUser(\n                saveUserTrimDto.id,\n                queryRunner.manager\n            );\n\n            const createTrim: Trim = await this.trimRepository.saveUserTrim(\n                findUser,\n                saveUserTrimDto.trimId,\n                queryRunner.manager\n            );\n\n            await this.tireRepository.saveTrimTire(\n                createTrim,\n                res,\n                queryRunner.manager\n            );\n\n            await queryRunner.commitTransaction();\n            return createTrim;\n        } catch (err) {\n            console.log(err);\n            await queryRunner.rollbackTransaction();\n        } finally {\n            await queryRunner.release();\n        }\n    }\n}\n`\n`// userRepository\n\n@EntityRepository(User)\nexport class UserRepository extends Repository {\n    async findUser(\n        id: string,\n        @TransactionManager() transactionManager?: EntityManager\n    ) {\n        const findUser = await this.findOne({ id: id });\n\n        if (!findUser) {\n            throw new NotFoundUserException();\n        }\n\n        return findUser;\n    }\n}\n`",
      "solution": "I solved this problem. Transaction Manager was received from each query and the method had to be used. Since userRepository is findOne, transaction processing has not been performed.\n`// TrimService\n\n@Injectable()\nexport class TrimService {\n    constructor(\n        private readonly trimRepository: TrimRepository,\n        private readonly tireRepository: TireRepository,\n        private readonly userRepository: UserRepository\n    ) {}\n\n    async saveUserTrim(saveUserTrimDto: SaveUserTrimDto, res) {\n        const queryRunner = await getConnection().createQueryRunner();\n        await queryRunner.startTransaction();\n\n        const findUser: User = await this.userRepository.findUser(\n            saveUserTrimDto.id\n        );\n\n        try {\n            const createTrim: Trim = await this.trimRepository.saveUserTrim(\n                queryRunner.manager,\n                findUser,\n                saveUserTrimDto.trimId\n            );\n\n            await this.tireRepository.saveTrimTire(\n                queryRunner.manager,\n                createTrim,\n                res\n            );\n\n            await queryRunner.commitTransaction();\n            return createTrim;\n        } catch (err) {\n            console.log(err);\n            await queryRunner.rollbackTransaction();\n        } finally {\n            await queryRunner.release();\n        }\n    }\n}\n\n`\n`// TrimRepository\n\n@EntityRepository(Trim)\nexport class TrimRepository extends Repository {\n    async saveUserTrim(\n        @TransactionManager() transactionManager: EntityManager,\n        findUser: User,\n        trimId: number\n    ) {\n        const findTrim = await transactionManager.findOne(Trim, {\n            trimId: trimId,\n            user: findUser\n        });\n\n        if (findTrim) {\n            throw new TrimOverlapException();\n        }\n\n        const createTrim: Trim = await transactionManager.create(Trim, {\n            trimId: trimId,\n            user: findUser\n        });\n\n        return await transactionManager.save(Trim, createTrim);\n    }\n}\n\n`",
      "question_score": 14,
      "answer_score": 11,
      "created_at": "2021-11-27T19:25:37",
      "url": "https://stackoverflow.com/questions/70137558/does-typeorm-provide-transactions-for-different-repositories"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 69778679,
      "title": "NestJS - Expected undefined to be a GraphQL schema",
      "problem": "I am trying to setup a very small GraphQL API using NestJS 8. I installed all required redepndencies from the documentation, but when I start the server, I get this error:\n`[Nest] 22727  - 10/30/2021, 10:11:10 AM     LOG [NestFactory] Starting Nest application...\n[Nest] 22727  - 10/30/2021, 10:11:10 AM     LOG [InstanceLoader] AppModule dependencies initialized +43ms\n[Nest] 22727  - 10/30/2021, 10:11:10 AM     LOG [InstanceLoader] TypeOrmModule dependencies initialized +0ms\n[Nest] 22727  - 10/30/2021, 10:11:10 AM     LOG [InstanceLoader] ConfigHostModule dependencies initialized +7ms\n[Nest] 22727  - 10/30/2021, 10:11:10 AM     LOG [InstanceLoader] ConfigModule dependencies initialized +1ms\n[Nest] 22727  - 10/30/2021, 10:11:10 AM     LOG [InstanceLoader] ConfigModule dependencies initialized +1ms\n[Nest] 22727  - 10/30/2021, 10:11:11 AM     LOG [InstanceLoader] GraphQLSchemaBuilderModule dependencies initialized +21ms\n[Nest] 22727  - 10/30/2021, 10:11:11 AM     LOG [InstanceLoader] GraphQLModule dependencies initialized +1ms\n[Nest] 22727  - 10/30/2021, 10:11:11 AM     LOG [InstanceLoader] TypeOrmCoreModule dependencies initialized +93ms\n[Nest] 22727  - 10/30/2021, 10:11:11 AM     LOG [InstanceLoader] TypeOrmModule dependencies initialized +0ms\n[Nest] 22727  - 10/30/2021, 10:11:11 AM     LOG [InstanceLoader] PostModule dependencies initialized +0ms\n\n/workspace/node_modules/graphql/type/schema.js:35\n    throw new Error(\n          ^\nError: Expected undefined to be a GraphQL schema.\n    at assertSchema (/workspace/node_modules/graphql/type/schema.js:35:11)\n    at validateSchema (/workspace/node_modules/graphql/type/validate.js:34:28)\n    at graphqlImpl (/workspace/node_modules/graphql/graphql.js:52:64)\n    at /workspace/node_modules/graphql/graphql.js:21:43\n    at new Promise ()\n    at graphql (/workspace/node_modules/graphql/graphql.js:21:10)\n    at GraphQLSchemaFactory.create (/workspace/node_modules/@nestjs/graphql/dist/schema-builder/graphql-schema.factory.js:48:60)\n    at GraphQLSchemaBuilder.buildSchema (/workspace/node_modules/@nestjs/graphql/dist/graphql-schema.builder.js:62:52)\n    at GraphQLSchemaBuilder.build (/workspace/node_modules/@nestjs/graphql/dist/graphql-schema.builder.js:24:31)\n    at GraphQLFactory.mergeOptions (/workspace/node_modules/@nestjs/graphql/dist/graphql.factory.js:33:69)\n`\nI don't understand this error, as I am just following the documentation...\n```\n`// app.module.ts\nimport { Module } from '@nestjs/common';\nimport { ConfigModule } from '@nestjs/config';\nimport { GraphQLModule } from '@nestjs/graphql';\nimport { TypeOrmModule } from '@nestjs/typeorm';\nimport { GraphqlOptions } from './config/graphql.config';\nimport { typeOrmConfigAsync } from './config/typeorm.config';\nimport { PostModule } from './post/post.module';\n\n@Module({\n  imports: [\n    ConfigModule.forRoot({ isGlobal: true }),\n    TypeOrmModule.forRootAsync(typeOrmConfigAsync),\n    GraphQLModule.forRootAsync({\n      useClass: GraphqlOptions,\n    }),\n    PostModule,\n  ],\n})\nexport class AppModule {}\n`\n```\n```\n`// graphql.config.ts\nimport { Injectable } from '@nestjs/common';\nimport { GqlModuleOptions, GqlOptionsFactory } from '@nestjs/graphql';\n\n@Injectable()\nexport class GraphqlOptions implements GqlOptionsFactory {\n  createGqlOptions(): Promise | GqlModuleOptions {\n    return {\n      autoSchemaFile: 'schema.gql',\n      sortSchema: true,\n      debug: true,\n      installSubscriptionHandlers: true,\n      context: ({ req }) => ({ req }),\n    };\n  }\n}\n`\n```\n```\n`// post.module.ts\nimport { Module } from '@nestjs/common';\nimport { TypeOrmModule } from '@nestjs/typeorm';\nimport { Post } from './post.entity';\nimport { PostResolver } from './post.resolver';\nimport { PostService } from './post.service';\n\n@Module({\n  imports: [TypeOrmModule.forFeature([Post])],\n  providers: [PostService, PostResolver],\n  exports: [PostService],\n})\nexport class PostModule {}\n`\n```\n```\n`// post.entity.ts\nimport { Field, ID, ObjectType } from '@nestjs/graphql';\nimport { Column, Entity, PrimaryGeneratedColumn } from 'typeorm';\n\n@Entity('post')\n@ObjectType()\nexport class Post {\n  @Field(() => ID)\n  @PrimaryGeneratedColumn('uuid')\n  id: string;\n\n  @Field()\n  @Column({ nullable: false })\n  title: string;\n\n  @Field()\n  @Column({ nullable: false, unique: true })\n  slug: string;\n\n  @Field()\n  @Column({ nullable: false })\n  content: string;\n\n  @Field()\n  @Column({ type: 'timestamp' })\n  createdAt: Date;\n\n  @Field()\n  @Column({ type: 'timestamp', nullable: true })\n  updatedAt: Date;\n}\n`\n```\nDoes anyone can highlight what's wrong with my project?",
      "solution": "I was receiving the same errors.\nAfter debugging step by step, the answer is that `@nestjs/graphql@9.1.1` is not compatible with `GraphQL@16`.\nSpecifically, `GraphQL@16` changed the `gqaphql` function, as called from within `graphqlImpl`, to only support args without a schema:\n```\n`function graphql(argsOrSchema, source, rootValue, contextValue, variableValues, operationName, fieldResolver, typeResolver) {\n  var _arguments = arguments;\n\n  /* eslint-enable no-redeclare */\n  // Always return a Promise for a consistent API.\n  return new Promise(function (resolve) {\n    return resolve( // Extract arguments from object args if provided.\n    _arguments.length === 1 ? graphqlImpl(argsOrSchema) : graphqlImpl({\n      schema: argsOrSchema,\n      source: source,\n      rootValue: rootValue,\n      contextValue: contextValue,\n      variableValues: variableValues,\n      operationName: operationName,\n      fieldResolver: fieldResolver,\n      typeResolver: typeResolver\n    }));\n  });\n}\n`\n```\nTo resolve, you will need to downgrade your `graphql` version to 15.x.",
      "question_score": 13,
      "answer_score": 47,
      "created_at": "2021-10-30T12:18:56",
      "url": "https://stackoverflow.com/questions/69778679/nestjs-expected-undefined-to-be-a-graphql-schema"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 67879357,
      "title": "Nestjs: How to use mongoose to start a session for transaction?",
      "problem": "The mongoose documentation to use a transaction is straightforward but when it is followed in nestjs, it returns an error:\n```\n`Connection 0 was disconnected when calling `startSession`\nMongooseError: Connection 0 was disconnected when calling `startSession`\n    at NativeConnection.startSession\n`\n```\nMy code:\n```\n`const transactionSession = await mongoose.startSession();\n    transactionSession.startTransaction();\n\n    try\n    {\n      const newSignupBody: CreateUserDto = {password: hashedPassword, email, username};\n  \n      const user: User = await this.userService.create(newSignupBody);\n\n      //save the profile.\n      const profile: Profile = await this.profileService.create(user['Id'], signupDto);\n\n      const result:AuthResponseDto = this.getAuthUserResponse(user, profile);\n\n      transactionSession.commitTransaction();\n      return result;\n    }\n    catch(err)\n    {\n      transactionSession.abortTransaction();\n    }\n    finally\n    {\n      transactionSession.endSession();\n    }\n`\n```",
      "solution": "I found the solution after studying @nestjs/mongoose. The mongoose here has no connection in it. This is the reason of error being returned.\nThe solution:\n`import {InjectConnection} from '@nestjs/mongoose';\nimport * as mongoose from 'mongoose';\n`\nIn the constructor of the service class, we need add connection parameter that can be used by the service.\n`export class AuthService {\nconstructor(\n  // other dependencies...\n  @InjectConnection() private readonly connection: mongoose.Connection){}\n`\nInstead of\n`const transactionSession = await mongoose.startSession();\ntransactionSession.startTransaction();\n`\nWe will now use:\n`const transactionSession = await this.connection.startSession();\ntransactionSession.startTransaction();\n`\nThis way, the issue of disconnection after startSession() can be resolved.",
      "question_score": 13,
      "answer_score": 29,
      "created_at": "2021-06-08T00:26:37",
      "url": "https://stackoverflow.com/questions/67879357/nestjs-how-to-use-mongoose-to-start-a-session-for-transaction"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 69178586,
      "title": "NestJS GraphQL subscriptions not working with `graphql-ws`",
      "problem": "I'm trying to upgrade our NestJS GraphQL subscriptions server to utilize `graphql-ws` rather than the current `subscriptions-transport-ws` (as suggested by the NestJS documentation).\nI upgraded the NestJS version to\n```\n`    \"@nestjs/core\": \"^8.0.6\",\n    \"@nestjs/graphql\": \"^9.0.4\",\n    \"@nestjs/platform-express\": \"^8.0.6\",\n    \"graphql\": \"^15.5.3\",\n    \"graphql-tools\": \"^8.2.0\",\n    \"apollo-server-express\": \"^3.3.0\",\n`\n```\nAnd after, I added the `subscriptions` option to the `App.Module`:\n```\n`    GraphQLModule.forRoot({\n      autoSchemaFile: true,\n      sortSchema: true,\n      playground: true,\n      installSubscriptionHandlers: true,\n      subscriptions: {\n        'graphql-ws': true\n      },\n    }),\n`\n```\nHowever when I subscribe (in playground) to a previously working subscription, I get:\n```\n`{\n  \"error\": \"Could not connect to websocket endpoint ws://localhost:8880/graphql. Please check if the endpoint url is correct.\"\n}\n`\n```\nAnd in the console I get:\n```\n`WebSocket protocol error occured. It was most likely caused due to an unsupported subprotocol \"graphql-ws\" requested by the client. graphql-ws implements exclusively the \"graphql-transport-ws\" subprotocol, please make sure that the client implements it too.\n`\n```\nThings I have tried:\n\nAdding the `graphql-ws` package\nUpgrading the NestJS version again\nRemoving the `installSubscriptionHandlers` option from config\nSetting `graphql-ws` configs instead of passing `true`\nUsing the `WebSocket Test Client` Google Chrome extension instead of Playground\n\nBut none have worked. Sorry for the long post. How can I fix this?",
      "solution": "At the time of release of Apollo Server 3, the protocol used in the graphql-ws library is not yet supported by GraphQL Playground or Apollo Explorer.\nsee here\nIt's only advisable to use graphql-ws if interacting with subscriptions via playground is not of much use to you and you're okay interacting with subscriptions solely from your own client that has been setup to use graphql-ws.\nTo setup your client to use graphql-ws with Apollo. see here.",
      "question_score": 13,
      "answer_score": 14,
      "created_at": "2021-09-14T15:20:14",
      "url": "https://stackoverflow.com/questions/69178586/nestjs-graphql-subscriptions-not-working-with-graphql-ws"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 68334376,
      "title": "MODULE_NOT_FOUND Nestjs and Swagger",
      "problem": "I'm trying to add Swagger to my Nestjs app. Module not found error is thrown when I'm trying to compile it.\nI use the same code from Nestjs documentation.\nThis is my main.ts:\n```\n`async function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n\n  const config = new DocumentBuilder()\n    .setTitle('Cats example')\n    .setDescription('The cats API description')\n    .setVersion('1.0')\n    .addTag('cats')\n    .build();\n  const document = SwaggerModule.createDocument(app, config);\n  SwaggerModule.setup('api', app, document);\n\n  await app.listen(3000);\n}\nbootstrap();\n`\n```\nThis is the error:\n```\n`internal/modules/cjs/loader.js:883\n  throw err;\n  ^\n\nError: Cannot find module '@nestjs/core/router/route-path-factory'\nRequire stack:\n- D:\\BK\\solidity\\MVPApp\\blockchain\\back-end-student-wallet-v2\\node_modules\\@nestjs\\swagger\\dist\\swagger-explorer.js\n- D:\\BK\\solidity\\MVPApp\\blockchain\\back-end-student-wallet-v2\\node_modules\\@nestjs\\swagger\\dist\\swagger-scanner.js \n- D:\\BK\\solidity\\MVPApp\\blockchain\\back-end-student-wallet-v2\\node_modules\\@nestjs\\swagger\\dist\\swagger-module.js  \n- D:\\BK\\solidity\\MVPApp\\blockchain\\back-end-student-wallet-v2\\node_modules\\@nestjs\\swagger\\dist\\index.js\n- D:\\BK\\solidity\\MVPApp\\blockchain\\back-end-student-wallet-v2\\node_modules\\@nestjs\\swagger\\index.js\n- D:\\BK\\solidity\\MVPApp\\blockchain\\back-end-student-wallet-v2\\dist\\main.js\n    at Function.Module._resolveFilename (internal/modules/cjs/loader.js:880:15)\n    at Function.Module._load (internal/modules/cjs/loader.js:725:27)\n\n`\n```\nI'm using Node 14.15.1, @nestjs/swagger 5.0.0, swagger-ui-express: 4.1.6",
      "solution": "Update latest version of @nestjs/platform-express, @nestjs/common,@nestjs/core (8.0.0) solve my problem. It seems like nestjs/cli uses previous version of nestjs",
      "question_score": 13,
      "answer_score": 18,
      "created_at": "2021-07-11T10:09:21",
      "url": "https://stackoverflow.com/questions/68334376/module-not-found-nestjs-and-swagger"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 77804479,
      "title": "Decorators are not valid here, biome(parse)",
      "problem": "The default biomejs configuration (or linting rule) raises an error on every decorator defined in NestJS resolvers:\n```\n`Decorators are not valid here. biome(parse)\n`\n```\nHow to ignore this rule globally?",
      "solution": "You can add the block:\n`    \"javascript\": {\n        \"parser\": {\n            \"unsafeParameterDecoratorsEnabled\": true\n        }\n    },\n`\nto your biome configuration. Biome's docs",
      "question_score": 13,
      "answer_score": 26,
      "created_at": "2024-01-12T06:17:13",
      "url": "https://stackoverflow.com/questions/77804479/decorators-are-not-valid-here-biomeparse"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 66193796,
      "title": "Using test database when e2e-testing NestJS",
      "problem": "In this project, it uses NestJS along with TypeORM. For real API requests, CRUD operation is being operated on MySQL(which is using AWS RDS).\nNow I am trying to use SQLite(In-Memory) to test API results.\nI successfully implemented this in Unit Test, as the code below.\nFirst, below is `create-memory-db.ts`, which returns a connection to in-memory SQLite database.\n```\n`type Entity = Function | string | EntitySchema;\n\nexport async function createMemoryDB(entities: Entity[]) {\n  return createConnection({\n    type: 'sqlite',\n    database: ':memory:',\n    entities,\n    logging: false,\n    synchronize: true,\n  });\n}\n`\n```\n\nAnd by using the exported function above, I successfully ran Unit test, like below.\n\n```\n`describe('UserService Logic Test', () => {\n  let userService: UserService;\n  let connection: Connection;\n  let userRepository: Repository;\n\n  beforeAll(async () => {\n    connection = await createMemoryDB([User]);\n    userRepository = await connection.getRepository(User);\n    userService = new UserService(userRepository);\n  });\n\n  afterAll(async () => {\n    await connection.close();\n  });\n\n  afterEach(async () => {\n    await userRepository.query('DELETE FROM users');\n  });\n\n  // testing codes.\n});\n`\n```\nI am trying to do the same thing on e2e tests. I tried below code.\n```\n`// user.e2e-spec.ts\n\ndescribe('UserController (e2e)', () => {\n  let userController: UserController;\n  let userService: UserService;\n  let userRepository: Repository;\n  let connection: Connection;\n  let app: INestApplication;\n  const NAME = 'NAME';\n  const EMAIL = 'test@test.com';\n  const PASSWORD = '12345asbcd';\n\n  beforeAll(async () => {\n    connection = await createMemoryDB([User]);\n    userRepository = await connection.getRepository(User);\n    userService = new UserService(userRepository);\n    userController = new UserController(userService);\n\n    const moduleFixture: TestingModule = await Test.createTestingModule({\n      imports: [],\n      controllers: [UserController],\n      providers: [UserService],\n    }).compile();\n\n    app = moduleFixture.createNestApplication();\n    await app.init();\n  });\n\n  afterAll(async () => {\n    await connection.close();\n  });\n\n  afterEach(async () => {\n    // await userRepository.query('DELETE FROM users');\n  });\n\n  it('[POST] /user : Response is OK if conditions are right', () => {\n    const dto = new UserCreateDto();\n    dto.name = NAME;\n    dto.email = EMAIL;\n    dto.password = PASSWORD;\n\n    return request(app.getHttpServer())\n      .post('/user')\n      .send(JSON.stringify(dto))\n      .expect(HttpStatus.CREATED);\n  });\n});\n`\n```\nI cannot create `UserModule` since it doesn't have a constructor with `Connection` parameter.\nThe code itself has no compile error, but gets results below when e2e test is executed.\n```\n`Nest can't resolve dependencies of the UserService (?). Please make sure that the argument UserRepository at index[0] is available in the RootTestModule context.\n\nPotential solutions:\n- If UserRepository is a provider, is it part of the current RootTestModule?\n- If UserRepository is exported from a seperate @Module, is that module imported within RootTestModule?\n  @Module({\n    imports: [/* The module containing UserRepository */]\n  })\n\nTypeError: Cannot read property 'getHttpServer' of undefined.\n`\n```\nAny help would be greatly appreciated. Thanks :)\n\nUPDATE : New error occured after trying below.\n\n```\n`describe('UserController (e2e)', () => {\n  let userService: UserService;\n  let userRepository: Repository;\n  let connection: Connection;\n  let app: INestApplication;\n  const NAME = 'NAME';\n  const EMAIL = 'test@test.com';\n  const PASSWORD = '12345asbcd';\n\n  beforeAll(async () => {\n    connection = await createMemoryDB([User]);\n    userRepository = await connection.getRepository(User);\n    userService = new UserService(userRepository);\n\n    const moduleFixture: TestingModule = await Test.createTestingModule({\n      imports: [UserModule],\n    })\n      .overrideProvider(UserService)\n      .useClass(userService)\n      .compile();\n\n    app = moduleFixture.createNestApplication();\n    await app.init();\n  });\n\n  afterAll(async () => {\n    await connection.close();\n  });\n\n  afterEach(async () => {\n    await userRepository.query('DELETE FROM users');\n  });\n\n  it('[POST] /user : Response is OK if conditions are right', async () => {\n    const dto = new UserCreateDto();\n    dto.name = NAME;\n    dto.email = EMAIL;\n    dto.password = PASSWORD;\n\n    const result = await request(app.getHttpServer())\n      .post('/user')\n      .send(JSON.stringify(dto))\n      .expect({ status: HttpStatus.CREATED });\n  });\n});\n`\n```\n\nI checked if query is working, and was able to see that it is using SQLite database as I wanted. But new error appeared in console.\n\n```\n`TypeError: metatype is not a constructor.\n\nTypeError: Cannot read property 'getHttpServer' of undefined.\n`\n```",
      "solution": "Okay, I solved this issue by using `TypeOrm.forRoot()` inside the imports field of `Test.createTestingModule`. Below is how I did it.\n```\n`describe('UserController (e2e)', () => {\n  let userService: UserService;\n  let userRepository: Repository;\n  let app: INestApplication;\n  const NAME = 'NAME';\n  const EMAIL = 'test@test.com';\n  const PASSWORD = '12345asbcd';\n\n  beforeAll(async () => {\n    const moduleFixture: TestingModule = await Test.createTestingModule({\n      imports: [\n        UserModule,\n        TypeOrmModule.forRoot({\n          type: 'sqlite',\n          database: ':memory:',\n          entities: [User],\n          logging: true,\n          synchronize: true,\n        }),\n      ],\n    }).compile();\n\n    app = moduleFixture.createNestApplication();\n    await app.init();\n    userRepository = moduleFixture.get('UserRepository');\n    userService = new UserService(userRepository);\n  });\n\n  afterAll(async () => {\n    await app.close();\n  });\n\n  afterEach(async () => {\n    await userRepository.query('DELETE FROM users');\n  });\n});\n\n`\n```",
      "question_score": 13,
      "answer_score": 20,
      "created_at": "2021-02-14T09:53:42",
      "url": "https://stackoverflow.com/questions/66193796/using-test-database-when-e2e-testing-nestjs"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 65655181,
      "title": "Extends the Request interface to add a fixed user property and extend any other class",
      "problem": "I'm doing a server-side application with NestJS and TypeScript in combination with the implementation of Passport JWT.\nA little bit of context first:\nMy JwtStrategy (no issues here):\n```\n`@Injectable()\nexport class JwtStrategy extends PassportStrategy(Strategy) {\n  constructor(private userService: UserService) {\n    super({\n      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\n      secretOrKey: 'hi',\n    });\n  }\n\n  async validate(payload: IJwtClaims): Promise {\n    const { sub: id } = payload;\n\n    // Find the user's database record by its \"id\" and return it.\n    const user = await this.userService.findById(id);\n\n    if (!user) {\n      throw new UnauthorizedException();\n    }\n\n    return user;\n  }\n}\n`\n```\nAccording to the documentation about the `validate()` method:\n\nPassport will build a user object based on the return value of our\nvalidate() method, and attach it as a property on the Request object.\n\nThanks to this behavior, I can access the `user` object in my handler like this:\n```\n`@Get('hi')\n  example(@Req() request: Request) {\n    const userId = (request.user as UserEntity).id;\n  }\n`\n```\nDid you notice that I have used a Type Assertion (tells the compiler to consider the user object as UserEntity) ? Without it, I won't have auto-completion about my entity's properties.\nAs a quick solution, I have created a class that extends the `Request` interface and include my own property of type `UserEntity`.\n```\n`import { Request } from 'express';\nimport { UserEntity } from 'entities/user.entity';\n\nexport class WithUserEntityRequestDto extends Request {\n  user: UserEntity;\n}\n`\n```\nNow, my handler will be:\n```\n`@Get('hi')\n  example(@Req() request: WithUserEntityRequestDto) {\n    const userId = request.user.id; // Nicer\n  }\n`\n```\nThe real issue now:\nI have (and will have more) a handler that will receive a payload, let's call it for this example `PasswordResetRequestDto`.\n```\n`export class PasswordResetRequestDto {\n  currentPassword: string;\n  newPassword: string;\n}\n`\n```\nThe handler will be:\n```\n`@Get('password-reset')\n  resetPassword(@Body() request: PasswordResetRequestDto) {\n  }\n`\n```\nNow, I don't have access to the user's object. I would like to access it to know who is the user that is making this request.\nWhat I have tried:\nUse TypeScript Generics and add a new property to my previous `WithUserEntityRequestDto` class like this:\n```\n`export class WithUserEntityRequestDto extends Request {\n  user: UserEntity;\n  newProp: T;\n}\n`\n```\nAnd the handler will be:\n```\n`@Get('password-reset')\n  resetPassword(@Req() request: WithUserEntityRequestDto) {\n  }\n`\n```\nBut now the `PasswordResetRequestDto` will be under `newProp`, making it not a scalable solution. Any type that I pass as the generic will be under `newProp`. Also, I cannot extends `T` because a class cannot extends two classes. I don't see myself doing classes like this all the time.\nWhat I expect to accomplish:\nPass a type to my `WithUserEntityRequestDto` class to include the passed type properties and also the user object by default. A way that I can do for example:\n```\n`request: WithUserEntityRequestDto\nrequest: WithUserEntityRequestDto\n`\n```\nAnd the value will be something like:\n```\n`{\n   user: UserEntity, // As default, always present\n   // all the properties of the passed type (T),\n   // all the properties of the Request interface\n}\n`\n```\nMy goal is to find an easy and scalable way to extends the `Request` interface and include any type/class on it, while having the user object (`UserEntity`) always present.\nThanks for the time and any help/advice/approach will be appreciated.",
      "solution": "Nestjs provides an elegant solution for your problem, which is Custom decoration\nit's common practice to attach properties to the request object. Then you manually extract them in each route handler,\nWhat you have to do is create a user decorator:\nuser.decorator.ts\n`    import { createParamDecorator, ExecutionContext } from '@nestjs/common';\n    \n    export const User = createParamDecorator(\n      (data: unknown, ctx: ExecutionContext) => {\n        const request = ctx.switchToHttp().getRequest();\n        return request.user;\n      },\n    );\n`\nthen you can simply use it in your controller like this:\n`      @Get('hi')\n      example(@Req() request: Request,@User() user: UserEntity) {\n        const userId = user.id; \n      }\n`",
      "question_score": 13,
      "answer_score": 13,
      "created_at": "2021-01-10T16:51:14",
      "url": "https://stackoverflow.com/questions/65655181/extends-the-request-interface-to-add-a-fixed-user-property-and-extend-any-other"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 71394797,
      "title": "NestJs reusable controller with validation",
      "problem": "Most of my NestJs controllers look the same. They have basic CRUD functionality and do the exact same things.\nThe only differences between the controllers are:\n\nthe path\nthe service that is injected (and the services are all extended from an abstract service)\nthe entity that is returned from the methods\nthe create, update, and query dtos\n\nHere is an example CRUD controller:\n```\n`@UseGuards(JwtAuthGuard)\n@Controller(\"/api/warehouse/goods-receipts\")\nexport class GoodsReceiptsController\n  implements ICrudController {\n  constructor(private service: GoodsReceiptsService) {\n  }\n\n  @Post()\n  create(@Body() body: CreateGoodsReceiptDto, @CurrentUser() user: Partial): Promise {\n    return this.service.createItem(body, user);\n  }\n\n  @Delete(\":id\")\n  delete(@Param() params: NumberIdDto): Promise> {\n    return this.service.deleteItem(params.id);\n  }\n\n  @Get(\":id\")\n  getOne(@Param() params: NumberIdDto): Promise {\n    return this.service.getItem(params.id);\n  }\n\n  @Get()\n  get(@Query() query: QueryGoodsReceiptDto): Promise {\n    return this.service.getItems(query);\n  }\n\n  @Patch()\n  update(@Body() body: UpdateGoodsReceiptDto, @CurrentUser() user: Partial): Promise {\n    return this.service.updateItem(body,user);\n  }\n}\n`\n```\nThis is the interface I have created for my controllers:\n```\n`export interface ICrudController {\n\n  getOne(id: NumberIdDto): Promise;\n\n  get(query: QueryDto): Promise;\n\n  create(body: CreateDto, user: Partial): Promise;\n\n  update(body: UpdateDto, user: Partial): Promise;\n\n  delete(id: NumberIdDto): Promise>;\n}\n`\n```\nWriting all these repetitive controllers has got pretty tiresome (yes I know about `nest g resource` but that is not really the point of this question), so I decided to create an abstract controller that will do most of the heavy lifting and have the controllers extend this.\n```\n`export abstract class CrudController implements ICrudController {\n  protected service: ICrudService;\n\n  @Post()\n  create(@Body() body: C, @CurrentUser() user: Partial): Promise {\n    return this.service.createItem(body, user);\n  }\n\n  @Get(\":id\")\n  getOne(@Param() params: NumberIdDto): Promise {\n    return this.service.getItem(params.id);\n  }\n\n  @Get()\n  get(@Query() query: Q): Promise {\n    return this.service.getItems(query);\n  }\n\n  @Delete(\":id\")\n  delete(@Param() params: NumberIdDto): Promise> {\n    return this.service.deleteItem(params.id);\n  }\n\n  @Patch()\n  update(@Body() body: U, @CurrentUser() user: Partial): Promise {\n    return this.service.updateItem(body, user);\n  }\n}\n`\n```\nNow all I need to do to add a new controller is this:\n```\n`@UseGuards(JwtAuthGuard)\n@Controller(\"/api/warehouse/goods-receipts\")\nexport class GoodsReceiptsController\n  extends CrudController {\n  constructor(protected service: GoodsReceiptsService) {\n    super();\n  }\n}\n`\n```\nI was very proud of myself at that point. That is until I figured out that validation no longer works because class-validator doesn't work with generic types.\nThere has to be some way I could fix this with minimal intervention and maximal use of reusable code?",
      "solution": "I have managed to make it work using this answer https://stackoverflow.com/a/64802874/1320704\nThe trick is to create a controller factory, and use a custom validation pipe.\nHere is the solution:\n```\n`@Injectable()\nexport class AbstractValidationPipe extends ValidationPipe {\n  constructor(\n    options: ValidationPipeOptions,\n    private readonly targetTypes: { body?: Type; query?: Type; param?: Type; }\n  ) {\n    super(options);\n  }\n\n  async transform(value: any, metadata: ArgumentMetadata) {\n    const targetType = this.targetTypes[metadata.type];\n    if (!targetType) {\n      return super.transform(value, metadata);\n    }\n    return super.transform(value, { ...metadata, metatype: targetType });\n  }\n}\n\nexport function ControllerFactory(\n  createDto: Type,\n  updateDto: Type,\n  queryDto: Type\n): ClassType> {\n  const createPipe = new AbstractValidationPipe({ whitelist: true, transform: true }, { body: createDto });\n  const updatePipe = new AbstractValidationPipe({ whitelist: true, transform: true }, { body: updateDto });\n  const queryPipe = new AbstractValidationPipe({ whitelist: true, transform: true }, { query: queryDto });\n\n  class CrudController implements ICrudController {\n    protected service: ICrudService;\n\n    @Post()\n    @UsePipes(createPipe)\n    async create(@Body() body: C, @CurrentUser() user: Partial): Promise {\n      return this.service.createItem(body, user);\n    }\n\n    @Get(\":id\")\n    getOne(@Param() params: NumberIdDto): Promise {\n      return this.service.getItem(params.id);\n    }\n\n    @Get()\n    @UsePipes(queryPipe)\n    get(@Query() query: Q): Promise {\n      return this.service.getItems(query);\n    }\n\n    @Delete(\":id\")\n    delete(@Param() params: NumberIdDto): Promise> {\n      return this.service.deleteItem(params.id);\n    }\n\n    @Patch()\n    @UsePipes(updatePipe)\n    update(@Body() body: U, @CurrentUser() user: Partial): Promise {\n      return this.service.updateItem(body, user);\n    }\n  }\n\n  return CrudController;\n}\n`\n```\nAnd to create the actual controller you simply pass the desired dtos to the factory:\n```\n`@UseGuards(JwtAuthGuard)\n@Controller(\"/api/warehouse/goods-receipts\")\nexport class GoodsReceiptsController\n  extends ControllerFactory\n  (CreateGoodsReceiptDto,UpdateGoodsReceiptDto,QueryGoodsReceiptDto){\n  constructor(protected service: GoodsReceiptsService) {\n    super();\n  }\n}\n`\n```\nYou can also optionally pass the response entity type into the factory and use that with the @ApiResponse tag if you use swagger.\nAlso you could pass the path to the factory and move all the decorators (Controller, UseGuards etc.) to the factory controller definition.",
      "question_score": 12,
      "answer_score": 13,
      "created_at": "2022-03-08T13:08:27",
      "url": "https://stackoverflow.com/questions/71394797/nestjs-reusable-controller-with-validation"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 66580508,
      "title": "Authorization in Nestjs using graphql",
      "problem": "I have started to learn Nestjs, express and graphql.\nI encountered a problem while trying to authorize access of user authenticated using jwt token.\nI followed the tutorial for authentication on the Nestjs website.\nI am able to get the current user, but when I try implementing the basic role base access control, I am unable to access the current user in the canActivate Method.\nI think it is because the Roles Guard is executed before the Graphql Guard.\nI will post the codes here\ngql-auth.guard.ts\n`import { ExecutionContext } from \"@nestjs/common\";\nimport { GqlExecutionContext } from \"@nestjs/graphql\";\nimport { AuthGuard } from \"@nestjs/passport\";\n\nexport class GqlAuthGuard extends AuthGuard(\"jwt\") {\n    getRequest(context: ExecutionContext) {\n        const ctx = GqlExecutionContext.create(context);\n        console.log(\"gql simple context: \", context);\n        console.log(\"gqlContext: \", ctx.getContext());\n        return ctx.getContext().req;\n    }\n}\n`\nroles.guard.ts\n`import { CanActivate, ExecutionContext, Injectable } from \"@nestjs/common\";\nimport { Reflector } from \"@nestjs/core\";\nimport { GqlExecutionContext } from \"@nestjs/graphql\";\n\n@Injectable()\nexport class RolesGuard implements CanActivate {\n    constructor(private reflector: Reflector) {}\n\n    canActivate(context: ExecutionContext) {\n        const roles = this.reflector.get(\"roles\", context.getHandler());\n        const ctx = GqlExecutionContext.create(context);\n        console.log(\"roles: \", roles);\n        console.log(\"context: \", context.switchToHttp().getRequest());\n        console.log(\"gqlContext: \", ctx.getContext().req);\n\n        return true;\n    }\n}\n`\njwt.strategy.ts\n`import { Injectable } from \"@nestjs/common\";\nimport { PassportStrategy } from \"@nestjs/passport\";\nimport { ExtractJwt, Strategy } from \"passport-jwt\";\nimport { jwtConstants } from \"../constants\";\n\n@Injectable()\nexport class JwtStrategy extends PassportStrategy(Strategy) {\n    constructor() {\n        super({\n            jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\n            ignoreExpiration: false,\n            secretOrKey: jwtConstants.secret,\n        });\n    }\n\n    validate(payload: any) {\n        console.log(\"payload: \", payload);\n\n        return payload;\n    }\n}\n`\nresolver\n`@UseGuards(GqlAuthGuard)\n@Roles(\"ADMIN\")\n@UseGuards(RolesGuard)\n@Query((returns) => [Specialty], { nullable: \"itemsAndList\", name: \"specialties\" })\nasync getSpecialties(@Args() params: FindManySpecialtyArgs, @Info() info: GraphQLResolveInfo) {\n    const select = new PrismaSelect(info).value;\n    params = { ...params, ...select };\n    return this.prismaService.specialty.findMany(params);\n}\n`\nHas anyone successfully implemented this before ?",
      "solution": "You should use the two guards in the same `@UseGuards()` decorator. Like `@UseGuards(GqlAuthGuard, RolesGuard)`. Nest will run these sequentially without a problem.",
      "question_score": 12,
      "answer_score": 8,
      "created_at": "2021-03-11T11:17:09",
      "url": "https://stackoverflow.com/questions/66580508/authorization-in-nestjs-using-graphql"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 71589818,
      "title": "Why npm install failed only in ElasticBeanstalk?",
      "problem": "I have a Nest.js (Node.js) application, and I want to deploy it on ElasticBeanstalk (Node 16 version, AL2 5.5.0).\nMy deployment keeps failing, and I found the error in `eb-engine.log`.\n```\n`...\n2022/03/23 15:11:48.570759 [INFO] Executing instruction: StageApplication\n2022/03/23 15:11:48.570846 [INFO] extracting /opt/elasticbeanstalk/deployment/app_source_bundle to /var/app/staging/\n2022/03/23 15:11:48.570860 [INFO] Running command /bin/sh -c /usr/bin/unzip -q -o /opt/elasticbeanstalk/deployment/app_source_bundle -d /var/app/staging/\n2022/03/23 15:11:49.274806 [INFO] finished extracting /opt/elasticbeanstalk/deployment/app_source_bundle to /var/app/staging/ successfully\n2022/03/23 15:11:49.289272 [INFO] Executing instruction: RunAppDeployPreBuildHooks\n2022/03/23 15:11:49.289292 [INFO] Executing platform hooks in .platform/hooks/prebuild/\n2022/03/23 15:11:49.289306 [INFO] The dir .platform/hooks/prebuild/ does not exist\n2022/03/23 15:11:49.289311 [INFO] Executing instruction: Install customer specified node.js version\n2022/03/23 15:11:49.289314 [INFO] installing specified nodejs version...\n2022/03/23 15:11:49.289467 [INFO] there is no nodejs version specified in package.json, skip installing specified version of nodejs\n2022/03/23 15:11:49.289476 [INFO] Executing instruction: Use NPM to install dependencies\n2022/03/23 15:11:49.289484 [INFO] use npm to install dependencies\n2022/03/23 15:11:49.289505 [INFO] Running command /bin/sh -c npm config set jobs 1\n2022/03/23 15:11:49.574486 [INFO] Running command /bin/sh -c npm --production install\n2022/03/23 15:12:06.913580 [ERROR] An error occurred during execution of command [app-deploy] - [Use NPM to install dependencies]. Stop running the command. Error: Command /bin/sh -c npm --production install failed with error signal: killed \n...\n\n`\n```\nI think the error occurs when installing npm packages in production mode, but I'm really wondering why this happens. I executed `npm --production install` in my local computer, the installing was successful with the exactly same versions of node & npm. (Node 16.14.0, npm 8.3.1 - AL2 5.5.0 latest for now).\nI want to know why this happens and how to debug more details (why npm install failed in the elastic beanstalk environment).",
      "solution": "I had the same issue, and the only way I could find to solve it was to increase the size of the instance running the application. In order for it to work, I had to use `t2.medium`.\nYou can also try increasing the swap for the EC2 instance running your app, but in my experience this made the deployment process take too long and sometimes fail. (See this answer if you want to try that approach)",
      "question_score": 11,
      "answer_score": 16,
      "created_at": "2022-03-23T16:24:03",
      "url": "https://stackoverflow.com/questions/71589818/why-npm-install-failed-only-in-elasticbeanstalk"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 77420116,
      "title": "Nestjs - Cannot find module dist\\main",
      "problem": "I'm using nestjs. I have a front application so I've decided to create a \"common\" folder for both front and back:\n```\n`    project  \n    \u2502\n    \u2514\u2500\u2500\u2500common\n    \u2502   \u2502\n    \u2502   \u2514\u2500\u2500\u2500dtos\n    \u2502       \u2502   dto-a.ts\n    \u2502       \u2502   dto-b.ts\n    \u2502   \n    \u2514\u2500\u2500\u2500api  (==> nestjs)\n    \u2502   \u2502\n    \u2502   \u2514\u2500\u2500\u2500src\n    \u2502\n    \u2514\u2500\u2500\u2500front\n        \u2502\n        \u2514\u2500\u2500\u2500src\n`\n```\nIn both front and back, I have added this to tsconfig:\n`{\n  \"compilerOptions\": {\n    \"paths\": {\n      \"@common/*\": [\"../common/*\"]\n    }\n  }\n}\n`\nSo I can use my models like this:\n`\nimport { DtoA} from \"@common/dtos\";\n\n`\nHowever, since I made the change, the compilation is creating two folder under the `dist` folder:\n```\n`    dist\n    \u2502\n    \u2514\u2500\u2500\u2500common\n    \u2502   \n    \u2514\u2500\u2500\u2500api\n`\n```\nNestjs tries to find something into `dist/main`, and fails:\n\nError: Cannot find module 'path\\to\\project\\api\\dist\\main'\nat Function.Module._resolveFilename (node:internal/modules/cjs/loader:1039:15)\nat Function.Module._load (node:internal/modules/cjs/loader:885:27)\nat Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:81:12)\nat node:internal/main/run_main_module:23:47\n\nHow can I tell nestjs to look into `dist/api/main`, or how can I bundle the common folder inside the api build?",
      "solution": "It needed to add to the nest-cli the \"entryFile\" key.\nexample: \"entryFile\": \"./apps/users/src/main.js\",",
      "question_score": 11,
      "answer_score": 16,
      "created_at": "2023-11-04T00:05:32",
      "url": "https://stackoverflow.com/questions/77420116/nestjs-cannot-find-module-dist-main"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 69549136,
      "title": "NestJS : TypeError: Cannot read property &#39;get&#39; of undefined",
      "problem": "I am trying to pass the connection parameters to mongodb by enviroment file and I am getting the following error\n```\n`[Nest] 1176  - 12/10/2021 23:34:35   ERROR [ExceptionHandler] Cannot read property 'get' of undefined\nTypeError: Cannot read property 'get' of undefined\n    at MongoService.createMongooseOptions (/Users/Desarrollos/NestJS/nestjs-ventas-negocios/src/common/mongo/mongo.service.ts:20:41)\n    at Function. (/Users/Desarrollos/NestJS/nestjs-ventas-negocios/node_modules/@nestjs/mongoose/dist/mongoose-core.module.js:135:120)\n    at Generator.next ()\n    at /Users/Desarrollos/NestJS/nestjs-ventas-negocios/node_modules/@nestjs/mongoose/dist/mongoose-core.module.js:20:71\n    at new Promise ()\n    at __awaiter (/Users/Desarrollos/NestJS/nestjs-ventas-negocios/node_modules/@nestjs/mongoose/dist/mongoose-core.module.js:16:12)\n    at InstanceWrapper.useFactory [as metatype] (/Users/Desarrollos/NestJS/nestjs-ventas-negocios/node_modules/@nestjs/mongoose/dist/mongoose-core.module.js:135:45)\n    at Injector.instantiateClass (/Users/Desarrollos/NestJS/nestjs-ventas-negocios/node_modules/@nestjs/core/injector/injector.js:294:55)\n    at callback (/Users/Desarrollos/NestJS/nestjs-ventas-negocios/node_modules/@nestjs/core/injector/injector.js:43:41)\n    at Injector.resolveConstructorParams (/Users/Desarrollos/NestJS/nestjs-ventas-negocios/node_modules/@nestjs/core/injector/injector.js:119:24)\n`\n```\nThis is the service mongo.service.ts\n```\n`import { MongooseModuleOptions, MongooseOptionsFactory } from '@nestjs/mongoose';\nimport { Configuration } from '../../config/config.keys';\nimport { ConfigService } from '../../config/config.service';\n\nexport class MongoService implements MongooseOptionsFactory {\n    constructor( private configService: ConfigService ) {}\n\n    createMongooseOptions(): MongooseModuleOptions {\n\n        const user     = this.configService.get(Configuration.DB_MONGO_USER);\n        const password = this.configService.get(Configuration.DB_MONGO_PASSWORD);\n        const server   = this.configService.get(Configuration.DB_MONGO_HOST);\n        const database = this.configService.get(Configuration.DB_MONGO_DATABASE);\n\n        return {\n            uri: `mongodb://${user}:${password}@${server}/${database}?retryWrites=true&w=majority`,\n        };\n    }\n}\n`\n```\nAnd this I import it in the app.module.ts\n```\n`@Module({\n  imports: [\n    MongooseModule.forRootAsync({\n      useClass: MongoService,\n    }),\n`\n```\nAny suggestion,\nthanks,\nJM",
      "solution": "You need 2 things here:\n\nYour `MongoService` needs to be marked with `@Injectable()` so that Nest can read the metadata of the constructor and set up the injection properly\n\nIf your `ConfigModule` does not have a globally exported `ConfigService`, then in `MongooseModule.forRootAsync()` along with the `useClass` you need to have `imports: [ConfigModule]` so that you can inject the `ConfigService`",
      "question_score": 11,
      "answer_score": 12,
      "created_at": "2021-10-13T04:45:35",
      "url": "https://stackoverflow.com/questions/69549136/nestjs-typeerror-cannot-read-property-get-of-undefined"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 66070860,
      "title": "Puppeteer Error: error while loading shared libraries: libgobject-2.0.so.0",
      "problem": "I have a NestJS App deployed on Google Cloud Run which is using puppeteer (V7.0.1) to generate a PDF. Locally, everything is working absolutely fine, but on my Cloud Run Service I keep getting the following error:\n`/usr/app/node_modules/puppeteer/.local-chromium/linux-848005/chrome-linux/chrome: error while loading shared libraries: libgobject-2.0.so.0: cannot open shared object file: No such file or directory`\nThe directory does exist in the Docker container (checked with `RUN ls node_modules/.....`).\nUsing the Docker code from the puppeteer troubleshooting doc or any other snippet I found on similar issues on the web result in the same error for me.\nDockerfile:\n```\n`FROM node:12-slim AS base\nWORKDIR /usr/app\n\nFROM base AS build\nRUN apt-get update \\\n    && apt-get install -y wget gnupg \\\n    && wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add - \\\n    && sh -c 'echo \"deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main\" >> /etc/apt/sources.list.d/google.list' \\\n    && apt-get update \\\n    && apt-get install -y google-chrome-stable fonts-ipafont-gothic fonts-wqy-zenhei fonts-thai-tlwg fonts-kacst fonts-freefont-ttf libxss1 \\\n      --no-install-recommends \\\n    && rm -rf /var/lib/apt/lists/*\n\nCOPY package.json yarn.lock ./\nRUN yarn --prod\nCOPY . ./\nRUN yarn add @nestjs/cli\nRUN yarn sass && yarn build && yarn copy-pdf-assets\n\nFROM base\nCOPY --from=build /usr/app ./\nENV PATH /usr/app/node_modules/.bin:$PATH\nCMD yarn start:prod\n`\n```\nGenerate PDF Function:\n```\n`//also tried headless: true or false and many other flags that deemed to fix it for others\nconst browser = await puppeteer.launch({ args: ['--no-sandbox'] }); \n\ntry {\n    const page = await browser.newPage();\n\n    await page.setViewport({ height: 792, width: 1039 })\n    await page.setContent(this.getTemplate(template, data), {\n        waitUntil: ['load', 'domcontentloaded', 'networkidle0']\n    });\n    await page.addStyleTag({ path: this.resolvePath(`/templates/${template}/styles.css`) })\n\n    await new Promise(resolve => setTimeout(resolve, 500));\n\n    return await page.pdf({ format: 'a4', landscape: true, printBackground: true });\n} finally {\n    await browser.close();\n}\n`\n```\nLet me know if you need any other information.\nThanks in advance.",
      "solution": "To anyone reading this with a similar problem and setup: my mistake was the build step in my docker file. Since I was installing chromium there, instead of the actual run step, puppeteer actually didn't have a chromium instance while running. I just moved the apt-get stuff to the last step of my docker file, that fixed it.\nEdit 2023-05-23:\nWorking version of above dockerfile:\n```\n`FROM node:12-slim AS base\nWORKDIR /usr/app\n\nFROM base AS build\nCOPY package.json yarn.lock ./\nRUN yarn --prod\nCOPY . ./\nRUN yarn add @nestjs/cli\nRUN yarn sass && yarn build && yarn copy-pdf-assets\n\nFROM base\nRUN apt-get update \\\n    && apt-get install -y wget gnupg \\\n    && wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add - \\\n    && sh -c 'echo \"deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main\" >> /etc/apt/sources.list.d/google.list' \\\n    && apt-get update \\\n    && apt-get install -y google-chrome-stable fonts-ipafont-gothic fonts-wqy-zenhei fonts-thai-tlwg fonts-kacst fonts-freefont-ttf libxss1 \\\n      --no-install-recommends \\\n    && rm -rf /var/lib/apt/lists/*\nCOPY --from=build /usr/app ./\nENV PATH /usr/app/node_modules/.bin:$PATH\nCMD yarn start:prod\n`\n```",
      "question_score": 11,
      "answer_score": 16,
      "created_at": "2021-02-05T22:32:19",
      "url": "https://stackoverflow.com/questions/66070860/puppeteer-error-error-while-loading-shared-libraries-libgobject-2-0-so-0"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 73324480,
      "title": "NestJS - How does AuthGuard knows about the Passport Strategy?",
      "problem": "I am having a hard time figuring out the NestJS and PassportJS combination when it comes to the authentication/authorization process, and I am a type of developer who does not like magic when it comes to developing.\nIssue\nBasically, my goal is to understand how does AuthGuard knows about the Passport Strategy being implemented in the project, it could be Local Strategy, or any other, for example JWT Strategy. I have two modules AuthModule and UserModule and this is how the AuthService looks like:\n```\n`@Injectable()\nexport class AuthService {\n    constructor(private usersService: UsersService){}\n\n    async validateUser(username: string, password: string): Promise {\n        const user = await this.usersService.findOne(username);\n\n        if (user && user.password === password) {\n            const {password, ...result} = user\n            return result\n        }\n        return null\n    }\n}\n`\n```\nUserService:\n```\n`import { Injectable } from '@nestjs/common';\n\nexport type User = any;\n\n@Injectable()\nexport class UsersService {\n\n    private readonly users = [\n        {\n            userId: 1,\n            username: 'John Marston',\n            password: 'rdr1',\n        },\n        {\n            userId: 2,\n            username: 'Arthur Morgan',\n            password: 'rdr2',\n        },\n    ]\n\n    async findOne(username: string): Promise {\n        return this.users.find(user => user.username === username)\n    }\n}\n`\n```\nPassport\nAfter installing the packages for Passport and NestJS, I imported PassportModule and implemented the LocalStrategy and also imported that strategy as a provider inside the AuthModule\nLocalStrategy:\n```\n`@Injectable()\nexport class LocalStrategy extends PassportStrategy(Strategy) {\n    constructor(private authService: AuthService) {\n        super()\n    }\n\n    async validate(username: string, password: string): Promise {\n        const user = await this.authService.validateUser(username, password);\n\n        if (!user) {\n            throw new UnauthorizedException();\n        }\n\n        return user;\n    }\n}\n`\n```\n```\n`@Module({\n  imports: [UsersModule, PassportModule],\n  providers: [AuthService, LocalStrategy]\n})\nexport class AuthModule {}\n`\n```\nLogin route\n```\n`import { Controller, Post, Request, UseGuards } from '@nestjs/common';\nimport { AuthGuard } from '@nestjs/passport';\n\n@Controller()\nexport class AppController {\n  \n  @UseGuards(AuthGuard('local'))\n  @Post('login')\n  async login(@Request() req) {\n    return req.user;\n  }\n}\n`\n```\nI understand everything up until this part. I do also understand how we get the req.user object etc. but I do not understand how does the AuthGuard knows, that we implemented Passport Local Strategy. Does it look through the files (sorry if this is dumb to say) and finds where we imported the PassportModule and also where we implemented the LocalStrategy since that class extends the PassportStrategy class, but also important to say, imported from passport-local.\nI do understand that AuthGuard is a special type of Guard, but I am not sure if I understand it properly.",
      "solution": "I have a rather good article on this, but to put it on StackOverflow too:\nEach `Strategy` from a `passport-*` package has a `name` property that is the name for the strategy. For `passport-local` that `name` is `local`. For `passport-jwt`, that name is `'jwt'`. This doesn't always line up one to one, but each package should document what its name for passport is. This is the name that gets passed to `passport.use()` and `passport.authenticate()`. `passport.use` is called via some clever code in the `PassportStrategy` class from `@nestjs/passport` to register the strategy with passport and `passport.authenticate` is called inside of the `AuthGuard()` using either the global default set via the passport module's options or via the mixin's parameters, like `local` in your code sample.",
      "question_score": 11,
      "answer_score": 10,
      "created_at": "2022-08-11T19:04:22",
      "url": "https://stackoverflow.com/questions/73324480/nestjs-how-does-authguard-knows-about-the-passport-strategy"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 71489564,
      "title": "Module &#39;&quot;@nestjs/config&quot;&#39; has no exported member &#39;ConfigModule&#39;",
      "problem": "I'm using NestJS,I installed @nestjs/config module using the command :\n```\n`npm i --save @nestjs/config \n`\n```\nI got this error :  Module '\"@nestjs/config\"' has no exported member 'ConfigModule'\nthis is my code in app.module file :\n```\n`import { Module } from '@nestjs/common';\nimport { AppController } from './app.controller';\nimport { AppService } from './app.service';\nimport { AuthModule } from './auth/auth.module';\nimport { UserModule } from './user/user.module';\nimport { BookmarkModule } from './bookmark/bookmark.module';\nimport { PrismaModule } from './prisma/prisma.module';\nimport { ConfigModule } from '@nestjs/config';\n\n@Module({\n  imports: [ConfigModule, AuthModule, UserModule, BookmarkModule, PrismaModule],\n  controllers: [AppController],\n  providers: [AppService],\n})\nexport class AppModule {}\n`\n```\nPS : Node version : 17.6.0 / OS : Manjaro Linux",
      "solution": "The problem was resolved by executing this command :\n```\n`npm uninstall @nestjs/config && npm install @nestjs/config\n`\n```",
      "question_score": 10,
      "answer_score": 25,
      "created_at": "2022-03-15T23:05:54",
      "url": "https://stackoverflow.com/questions/71489564/module-nestjs-config-has-no-exported-member-configmodule"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 69084933,
      "title": "NestJS DTO class set class-validator and class-transformer execution order",
      "problem": "Is there a way to set the execution order of decorators when describing a DTO class in NestJS using `class-validator` and `class-transformer` packages ?\nFollowing code fails when the value of `foo` is set to `null` with the error:\n\nExpected a string but received a null\n\n`@IsOptional()\n@IsString()\n@IsByteLength(1, 2048)\n@Transform(({ value }) => validator.trim(value))\n@Transform(({ value }) => validator.stripLow(value))\nfoo: string;\n`\nEven though I have a `isString` decorator that should check that indeed a string was passed and must already fail to not pass the execution to the `@Transform` decorators, but it didn't fail.",
      "solution": "Class-Validator works based on classes. Request payloads that come into the server are just plain JSON objects to start off with. To change this behaviour, Nest has to first call `plainToClass` from `class-validator` if you're using its `ValidationPipe`. Because of this, the `@Transform()` decorators take precedence over the other class-validator decorators, and are acted upon first. You could get around this by using multiple pipes, or possibly providing default values for the `@Transform()` decorator, but what is happening is the intended effect.",
      "question_score": 10,
      "answer_score": 16,
      "created_at": "2021-09-07T10:39:06",
      "url": "https://stackoverflow.com/questions/69084933/nestjs-dto-class-set-class-validator-and-class-transformer-execution-order"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 68214492,
      "title": "How can a Nest Bull queue be tested via Jest (DI via @InjectQueue)?",
      "problem": "Given an Injectable that uses a queue via the @InjectQueue decorator:\n```\n`@Injectable()\nexport class EnqueuerService {\n  constructor (\n    @InjectQueue(QUEUE_NAME) private readonly queue: Queue\n  ) {\n  }\n\n  async foo () {\n    return this.queue.add('job')\n  }\n}\n`\n```\nHow can I test that this service calls the queue correctly? I can do the bsic scaffolding:\n```\n`describe('EnqueuerService', () => {\n  let module: TestingModule\n  let enqueuerService: EnqueuerService\n\n  beforeAll(async () => {\n    module = await Test.createTestingModule({\n      imports: [EnqueuerModule]\n    }).compile()\n    enqueuerService = module.get(EnqueuerService)\n\n    // Here I'd usually pull in the dependency to test against:\n    // queue = module.get(QUEUE_NAME)\n    //\n    // (but this doesn't work because queue is using the @InjectQueue decorator)\n  })\n\n  afterAll(async () => await module.close())\n\n  describe('#foo', () => {\n    it('adds a job', async () => {\n      await enqueuerService.foo()\n\n      // Something like this would be nice: \n      // expect(queue.add).toBeCalledTimes(1)\n      //\n      // (but maybe there are alternative ways that are easier?)\n    })\n  })\n})\n`\n```\nI'm quite lost in the Nest DI container setup but I suspect there's some clever way of doing this. But despite hours of attempts I can't make progress, and the documentation isn't helping me. Can anyone offer a solution? It doesn't have to be mocking, if it's easier to create a real queue to test against that's fine too I just want to verify my service enqueues as expected! Any help appreciated.",
      "solution": "By looking into the lib, I found a helper function that creates the queue injection token based on its name: `getQueueToken(name?: string)`.\nThe function is exported from the lib so you can use it to provide you own queue implementation for testing.\n```\n`import { getQueueToken } from '@nestjs/bull';\n\ndescribe('EnqueuerService', () => {\n  let module: TestingModule\n  let enqueuerService: EnqueuerService\n\n  beforeAll(async () => {\n    module = await Test.createTestingModule({\n      imports: [EnqueuerModule]\n    })\n      .overrideProvider(getQueueToken(QUEUE_NAME))\n      .useValue({ /* mocked queue */ })\n      .compile()\n\n    enqueuerService = module.get(EnqueuerService)\n    queue = module.get(QUEUE_NAME)\n  })\n\n  afterAll(async () => await module.close())\n\n  describe('#foo', () => {\n    it('adds a job', async () => {\n      await enqueuerService.foo()\n\n      expect(queue.add).toBeCalledTimes(1)\n    })\n  })\n})\n`\n```\nEDIT\nTo check the methods called of the queue service, you can create a mock at the root of your test file. I reorganized the test file to have a cleaner speration between the setup of the test and the test itself:\n```\n`let module: TestingModule\nlet enqueuerService: EnqueuerService\nlet mockQueue;\n\n// Create a helper function to create the app.\nconst createApp = async () => {\n  module = await Test.createTestingModule({\n    imports: [EnqueuerModule]\n  })\n    .overrideProvider(getQueueToken(QUEUE_NAME))\n    .useValue(mockQueue)\n    .compile()\n\n  enqueuerService = module.get(EnqueuerService)\n}\n\ndescribe('EnqueuerService', () => {    \n  // Recreate app before each test to clean the mock.\n  beforeEach(async () => {\n    mockQueue = {\n      add: jest.fn(),\n    };\n    await createApp();\n  })\n\n  afterAll(async () => await module.close())\n\n  describe('#foo', () => {\n    it('adds a job', async () => {\n      await enqueuerService.foo()\n\n      // Check calls on the mock.\n      expect(mockQueue.add).toBeCalledTimes(1)\n    })\n  })\n\n  describe('#bar', () => {\n    // Override the mock for a specific test suite.\n    beforeEach(async () => {\n      mockQueue.add = jest.fn().mockImplementation(/** */);\n      // The mock has changed so we need to recreate the app to use the new value.\n      await createApp();\n    })\n\n    it('adds a job', async () => {\n      // ...\n    })\n  })\n})\n`\n```",
      "question_score": 10,
      "answer_score": 20,
      "created_at": "2021-07-01T19:23:32",
      "url": "https://stackoverflow.com/questions/68214492/how-can-a-nest-bull-queue-be-tested-via-jest-di-via-injectqueue"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 72361047,
      "title": "Error: No &quot;exports&quot; main defined in graphql-upload/package.json",
      "problem": "Have installed graphql-upload, do\n`import { graphqlUploadExpress } from 'graphql-upload';`\nAnd getting this error:\nError: No \"exports\" main defined in graphql-upload/package.json\nDependencies:\n```\n`\"graphql-upload\": \"^14.0.0\",\n\"graphql\": \"15.8.0\",\n\"graphql-request\": \"^4.2.0\",\n\"graphql-tools\": \"^8.2.0\",\n\"@nestjs/axios\": \"^0.0.7\",\n\"@nestjs/common\": \"^8.4.1\",\n\"@nestjs/config\": \"^1.1.5\",\n\"@nestjs/core\": \"^8.4.1\",\n\"@nestjs/graphql\": \"^9.1.2\",\n\"@nestjs/platform-express\": \"^8.0.0\",\n`\n```\nThe version of node: v16.10.0",
      "solution": "So the problem was in the .default build settings.\nYou can remove it, but when we removed it we saw the problem with other modules, so we resolved this issue via this:\n```\n`import Upload = require('graphql-upload/Upload.js');\n`\n```\nIt looks very dirty, but it works.\nYou can check conversation about this module in issues on GitHub: https://github.com/jaydenseric/graphql-upload/issues/305#issuecomment-1136574019",
      "question_score": 10,
      "answer_score": 1,
      "created_at": "2022-05-24T12:10:12",
      "url": "https://stackoverflow.com/questions/72361047/error-no-exports-main-defined-in-graphql-upload-package-json"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 66900133,
      "title": "How to mock a promise rejection with Jest",
      "problem": "What am I doing?\nI am following a course on nestjs which has some unit testing it it. I wrote this test that checks the signUp method in an repository class. The problem is that in order to trigger the exceptions the line `user.save()` should return a promise rejection (simulating some problem writing to db). I tried a few ways (see below) but none that work.\nThe problem\nThe result is that the test succeeds, but there is an `unhandled Promise rejection`. This way even if I assert that is does `not.toThow()` it will succeed with the same `unhandled Promise rejection`\n```\n`(node:10149) UnhandledPromiseRejectionWarning: Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: undefined\n(Use `node --trace-warnings ...` to show where the warning was created)\n`\n```\nHow do I make it reject the promise correctly?\nThe code\nBelow is the code of my test and the function under test.\n```\n`import { ConflictException } from '@nestjs/common';\nimport { Test } from '@nestjs/testing';\nimport { AuthCredentialsDto } from './dto/auth-credentials.dto';\nimport { UserRepository } from './user.repository';\n\ndescribe('UserRepository', () => {\n  let userRepository: UserRepository;\n\n  let authCredentialsDto: AuthCredentialsDto = {\n    username: 'usahh',\n    password: 'passworD12!@',\n  };\n\n  beforeEach(async () => {\n    const module = await Test.createTestingModule({\n      providers: [UserRepository],\n    }).compile();\n\n    userRepository = module.get(UserRepository);\n  });\n\n  describe('signUp', () => {\n    let save: any;\n    beforeEach(() => {\n      save = jest.fn();\n      userRepository.create = jest.fn().mockReturnValue({ save });\n    });\n\n    it('throws a conflict exception if user already exist', () => {\n      // My first try:\n      // save.mockRejectedValue({\n      //   code: '23505',\n      // });\n\n      // Then I tried this, with and without async await:\n      save.mockImplementation(async () => {\n        await Promise.reject({ code: '23505' });\n      });\n      expect(userRepository.signUp(authCredentialsDto)).rejects.toThrow(\n        ConflictException,\n      );\n    });\n  });\n});\n\n`\n```\nThe function under test here is:\n```\n`@EntityRepository(User)\nexport class UserRepository extends Repository {\n  async signUp(authCredentialsDto: AuthCredentialsDto): Promise {\n    const { username, password } = authCredentialsDto;\n    const user = this.create();\n\n    user.salt = await bcrypt.genSalt();\n    user.username = username;\n    user.password = await this.hashPassword(password, user.salt);\n\n    try {\n      await user.save();\n    } catch (e) {\n      if (e.code === '23505') {\n        throw new ConflictException('Username already exists');\n      } else {\n        throw new InternalServerErrorException();\n      }\n    }\n  }\n}\n`\n```",
      "solution": "This should be asynchronous test but it's synchronous, it won't fail even if there's rejected promise.\nA promise that `expect(...).rejects...` returns needs to be chained:\n```\n`it('throws a conflict exception if user already exist', async () => {\n  ...\n  await expect(userRepository.signUp(authCredentialsDto)).rejects.toThrow(\n    ConflictException,\n  );\n});\n`\n```\nThere's no room for trial and error for `mockImplementation`. A mock is supposed to return rejected promise, and `mockRejectedValue` does this. `mockImplementation(async () => ...)` is unnecessarily long way to write it.",
      "question_score": 10,
      "answer_score": 14,
      "created_at": "2021-04-01T09:27:46",
      "url": "https://stackoverflow.com/questions/66900133/how-to-mock-a-promise-rejection-with-jest"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 74660025,
      "title": "Nest.js app becomes unresponsive following an Error thrown in an async function without an await",
      "problem": "The issue that if there is an exception thrown in an `async` function but that function was called without an `await`, the Nest application goes into a state where it no longer responds to requests but the process does not exist.\nThere may be times where we want to call a function in a request but don't need to wait for it to finish before returning to response to the caller but most of the time that we encounter this it was just an accidental omission of an `await`. The fact that it renders the server useless has been very problematic.\nI suspect there may be a simple solution to this problem but I have been unsuccessful in finding it myself.\napp.controller.ts\n`import { Controller, Get } from '@nestjs/common';\nimport { AppService } from './app.service';\n\n@Controller()\nexport class AppController {\n  constructor(private readonly appService: AppService) {}\n\n  @Get()\n  getHello(): string {\n    return this.appService.getHello();\n  }\n\n  @Get('/crash')\n  public async crash(): Promise {\n    await this.appService.crash();\n  }\n}\n`\napp.service.ts\n`import { Injectable } from '@nestjs/common';\n\nconst sleep = async (ms: number): Promise => {\n  return new Promise((resolve) => {\n    setTimeout(resolve, ms);\n  });\n};\n\nconst functionThatThrows = async (): Promise => {\n  await sleep(2000);\n  throw new Error('this will crash the app');\n};\n\n@Injectable()\nexport class AppService {\n  getHello(): string {\n    return 'Hello World!';\n  }\n\n  public async crash(): Promise {\n    console.log('crashing the app in 3 seconds...');\n    await sleep(1000);\n    functionThatThrows(); // async function called without await\n  }\n}\n`\nCalling the endpoint the first time succeeds:\n`curl http://localhost:3000/crash`\nCalling it afterward and the server does not respond:\n`curl http://localhost:3000/crash`\n`curl: (7) Failed to connect to localhost port 3000 after 5 ms: Connection refused`",
      "solution": "This is due to the fact that node crashes on unhandled promise rejections. Nest's exception filter will catch errors that happen during the request, but if an error happens outside of the request (like a promise/async function without an `await`), then only the standard Node error handler is active. You'd need a `process.on('unhandledRejection', errorHandler)` to keep the process from crashing",
      "question_score": 10,
      "answer_score": 12,
      "created_at": "2022-12-02T19:25:47",
      "url": "https://stackoverflow.com/questions/74660025/nest-js-app-becomes-unresponsive-following-an-error-thrown-in-an-async-function"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 68390441,
      "title": "NestJS/GraphQL/Passport - getting unauthorised error from guard",
      "problem": "I'm trying to follow along with this tutorial and I'm struggling to convert the implementation to GraphQL.\nlocal.strategy.ts\n```\n`@Injectable()\nexport class LocalStrategy extends PassportStrategy(Strategy) {\n  constructor(private readonly authenticationService: AuthenticationService) {\n    super();\n  }\n\n  async validate(email: string, password: string): Promise {\n    const user = await this.authenticationService.getAuthenticatedUser(\n      email,\n      password,\n    );\n\n    if (!user) throw new UnauthorizedException();\n\n    return user;\n  }\n}\n`\n```\nlocal.guard.ts\n```\n`@Injectable()\nexport class LogInWithCredentialsGuard extends AuthGuard('local') {\n  async canActivate(context: ExecutionContext): Promise {\n    const ctx = GqlExecutionContext.create(context);\n    const { req } = ctx.getContext();\n    req.body = ctx.getArgs();\n\n    await super.canActivate(new ExecutionContextHost([req]));\n    await super.logIn(req);\n    return true;\n  }\n}\n`\n```\nauthentication.type.ts\n```\n`@InputType()\nexport class AuthenticationInput {\n  @Field()\n  email: string;\n\n  @Field()\n  password: string;\n}\n`\n```\nauthentication.resolver.ts\n```\n`@UseGuards(LogInWithCredentialsGuard)\n@Mutation(() => User, { nullable: true })\nlogIn(\n  @Args('variables')\n  _authenticationInput: AuthenticationInput,\n  @Context() req: any,\n) {\n  return req.user;\n}\n`\n```\nmutation\n```\n`mutation {\n  logIn(variables: {\n    email: \"email@email.com\",\n    password: \"123123\"\n  } ) {\n    id\n    email\n  }\n}\n`\n```\nEven the above credentials are correct, I'm receiving an unauthorized error.",
      "solution": "The problem is in your `LogInWithCredentialsGuard`.\nYou shouldn't override `canAcitavte` method, all you have to do is update the request with proper GraphQL args because in case of API request, Passport automatically gets your credentials from `req.body`. With GraphQL, execution context is different, so you have to manually set your args in `req.body`. For that, `getRequest` method is used.\nAs the execution context of GraphQL and REST APIs is not same, you have to make sure your guard works in both cases whether it's controller or mutation.\nhere is a working code snippet\n`@Injectable()\nexport class LogInWithCredentialsGuard extends AuthGuard('local') {\n  // Override this method so it can be used in graphql\n  getRequest(context: ExecutionContext) {\n    const ctx = GqlExecutionContext.create(context);\n    const gqlReq = ctx.getContext().req;\n    if (gqlReq) {\n      const { variables } = ctx.getArgs();\n      gqlReq.body = variables;\n      return gqlReq;\n    }\n    return context.switchToHttp().getRequest();\n  }\n}\n`\nand your mutation will be like\n`@UseGuards(LogInWithCredentialsGuard)\n@Mutation(() => User, { nullable: true })\nlogIn(\n  @Args('variables')\n  _authenticationInput: AuthenticationInput,\n  @Context() context: any, //",
      "question_score": 10,
      "answer_score": 10,
      "created_at": "2021-07-15T10:32:13",
      "url": "https://stackoverflow.com/questions/68390441/nestjs-graphql-passport-getting-unauthorised-error-from-guard"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 68460951,
      "title": "Use interface as a swagger schema - NestJS DTO",
      "problem": "I have the following code:\n```\n`import { IsNotEmpty, IsArray, ArrayMinSize } from 'class-validator';\nimport { ApiProperty } from '@nestjs/swagger';\n\nexport class PublishDto {\n  @IsNotEmpty()\n  @IsArray()\n  @ArrayMinSize(1)\n  @ApiProperty({\n    type: [Product]\n  })\n  products: Product[];\n}\n\ninterface Product {\n  id: string;\n  title: string;\n  sku: string;\n  stock: number;\n  description: string;\n  shortDescription: string;\n  imagesUrl: string[];\n  price: number;\n  department: string;\n  category: string;\n  brand: string;\n  keywords: string[];\n  isActive: boolean;\n}\n`\n```\n\nI'm trying to put the interface `Product` as a schema on swagger, but it's not working, I am getting an error.\nAny idea?",
      "solution": "The type property is expecting a value that is available at runtime, for example an actual Class or the Javascript `String` type. Interfaces exist only at compile time and so they aren't valid to be passed in this way.\nYou'll have to convert it to a Class if you want to pass it manually otherwise you could take a look at using the NestJS Swagger compiler plugin which uses some cool compile-time magic to automatically try and figure some of this stuff out for you",
      "question_score": 10,
      "answer_score": 11,
      "created_at": "2021-07-20T22:29:57",
      "url": "https://stackoverflow.com/questions/68460951/use-interface-as-a-swagger-schema-nestjs-dto"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 69471840,
      "title": "Cannot query across one-to-many for property NestJS and TypeORM",
      "problem": "I have two entities one is `car` and another one is `carAvailability`\n```\n`import { Entity, Column, PrimaryGeneratedColumn, OneToMany } from 'typeorm';\nimport { CarAvailability } from 'src/car-availabilitys/car-availability.entity';\n\n@Entity('cars')\nexport class Car {\n  @PrimaryGeneratedColumn()\n  id: number;\n\n  @Column()\n  name: string;\n\n  @OneToMany(() => CarAvailability, (carAvailability) => carAvailability.car, {\n    eager: true,\n    cascade: true,\n  })\n  availabilities: CarAvailability[];\n}\n`\n```\nI am trying to add a service that queries and filters cars based on the availabilities. In My Service and tried two ways:\nMethod 1 with repo functions:\n```\n`async test () {\n  const startDateTime = '2012-04-24 02:25:43.511';\n\n  return await this.repo.find({\n    relations: ['availabilities'],\n    where: {\n      availabilities: {\n        start_date_time: startDateTime\n      }\n    }\n  });\n}\n`\n```\nMethod 2 with query builder:\n```\n`async test () {\n  const startDateTime = '2012-04-24 02:25:43.511';\n\n  return this.repo.createQueryBuilder('cars')\n    .innerJoin('cars.availabilities', 'car_availabilities')\n    .where(\"cars.availabilities.start_date_time = :startDateTime\", { startDateTime })\n    .getMany();\n}\n`\n```\nMethod 1 error:\n```\n`Error: Cannot query across one-to-many for property availabilities\n`\n```\nMethod 2 error:\n```\n`QueryFailedError: missing FROM-clause entry for table \"availabilities\"\n`\n```\nI feel like I am missing something but I am not sure. Have referred both NestJS and TypeORM docs but can't seem to figure out what went wrong.",
      "solution": "Using Method 2, because you aliased `car.availabilities` as `car_availabilities`, your `where` clause should use the alias name:\n```\n`car_availabilities.start_date_time\n`\n```\nnot:\n```\n`cars.availabilities.start_date_time\n`\n```",
      "question_score": 10,
      "answer_score": 7,
      "created_at": "2021-10-06T21:44:18",
      "url": "https://stackoverflow.com/questions/69471840/cannot-query-across-one-to-many-for-property-nestjs-and-typeorm"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 73419905,
      "title": "Using import for an ESM Module in nest.js gives [ERR_REQUIRE_ESM]: require() of ES Module not supported",
      "problem": "I use nest.js with typescript and wanted to add\n```\n`import { DRACOLoader, GLTFLoader, TextureLoader } from 'node-three-gltf'; \n`\n```\nin one of my modules. However that results in below error\n```\n`c:\\m3\\dist\\src\\gltftest\\gltftest.controller.js:23\nconst node_three_gltf_1 = require(\"node-three-gltf\");\n                          ^\nError [ERR_REQUIRE_ESM]: require() of ES Module c:\\m3\\node_modules\\node-three-gltf\\build\\index.js from c:\\m3\\dist\\src\\gltftest\\gltftest.controller.js not supported.Instead change the require of index.js in c:\\m3\\dist\\src\\gltftest\\gltftest.controller.js to a dynamic import() which is available in all CommonJS modules.\n    at Object. (c:\\m3\\dist\\src\\gltftest\\gltftest.controller.js:23:27)\n    at Object. (c:\\m3\\dist\\src\\gltftest\\gltftest.module.js:12:30)\n`\n```\nAnd node-three-gltf@1.0.3 which I use is just an esm module. Resulting in the (at least to me - fairly new to this suff) weird situation of me using ESM import syntax in my typescript module/controller to import the ESM module node-three-gltf and getting this error.\nSeems to be due to the fact that nest.js build of my project transforms my ES syntax to CJS syntax and thus replaces my import with require but does not transform the node-three-gltf module and then complains.\nmy tsconfig goes like this:\n```\n`{\n   \"compilerOptions\": {\n      \"module\": \"commonjs\",\n      \"moduleResolution\": \"Node\",\n      \"target\": \"esnext\",\n...\n`\n```\nTheoretically I see the following options:\n\nensure i build everything as ESM ( I tried that via setting module in my tsconfig to ES2020 and adding \"type\":\"module\" to my package.json which then lead to a new import error for a different dependency (\n\nnode_modules\\connect-typeorm\\out' is not supported resolving ES\nmodules imported from C:\\m3\\dist\\src\\main.js Did you mean to import\nconnect-typeorm/out/index.js?\n\nmake sure the node-three-gltf provides a cjs version as build, for which it appears I could raise a PR but would need to undestand the build tools fo that dependency, so not really good option\nupgrade to node-three-gltf@1.10.0 as that has a cjs export but which however requires Node 18 which I cannot use in production at this time for reasons out of my control\nadapt the nest.js build in way that it does transform esm dependencies to cjs - which I don't know how to do.\n\nSo I wonder if sb can advise me on how to adjust the nest.js build config to do the esm->cjs transformation for dependencies or point me in another direction?\nThanks!\nT",
      "solution": "I believe you should stay with CJS in your app, and use the `import()` expression to load that ESM-only package.\nSee: Compile a package that depends on ESM only library into a CommonJS package",
      "question_score": 10,
      "answer_score": 2,
      "created_at": "2022-08-19T18:48:16",
      "url": "https://stackoverflow.com/questions/73419905/using-import-for-an-esm-module-in-nest-js-gives-err-require-esm-require-of"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 70730514,
      "title": "Unable to connect to the database. Retrying",
      "problem": "I'm trying to connect to the database, seems like the set-up is correct, but for some reason, it says that it is not available.\n`app.module.ts`\n```\n`import { Module } from \"@nestjs/common\"\nimport { MongooseModule } from \"@nestjs/mongoose\";\nimport { ConfigModule } from \"../config\";\nimport { CreatorModule } from \"./creator.module\";\n\n@Module({\n    imports: [\n        MongooseModule.forRoot('mongodb://localhost:27017/snaptoon', {\n            useCreateIndex: true,\n            useUnifiedTopology: true,\n            useNewUrlParser: true,\n        }),\n        CreatorModule,\n    ],\n    controllers: [],\n    providers: []\n})\n\nexport class AppModule {}\n`\n```\nThe error is: `ERROR [MongooseModule] Unable to connect to the database. Retrying (9)...`\nI'm using `'@nestjs/mongoose': '9.0.2'`",
      "solution": "I solved by updating manually mongoose version to 6.2.2\n```\n` WARN @nestjs/mongoose@9.0.2 requires a peer of mongoose@^6.0.2 but none is installed. You must install peer dependencies yourself.\n`\n```\nI realize due to this error on npm install\njust use:\n```\n` npm install mongoose@6.2.2 --save\n`\n```",
      "question_score": 9,
      "answer_score": 5,
      "created_at": "2022-01-16T14:32:11",
      "url": "https://stackoverflow.com/questions/70730514/unable-to-connect-to-the-database-retrying"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 65929178,
      "title": "Logout JWT with nestJS",
      "problem": "I'm using JWT passaport to login module:\n` async validateUser(userEmail: string, userPassword: string) {\n    const user = await this.userService.findByEmail(userEmail);\n    if (user && user.password === userPassword) {\n      const { id, name, email } = user;\n      return { id: id, name, email };\n    }else {\n      throw new UnauthorizedException({\n        error: 'Incorrect username or password'\n      });\n    }\n  }\n\n  async login(user: any) {\n    const payload = { email: user.email, sub: user.id };\n    return {\n      access_token: this.jwtService.sign(payload),\n    };\n  }\n\n`\nThis part is running.\nMy question is: how do the logout? I read about creating a blacklist and adding the token to it, but how do I get the user's access token?",
      "solution": "Something you should know about token-based authentication is that it is stateless. This means that even the server does not keep track of which users are authenticated, like with session-based authentication. As such, you do not need to do anything on the server side to \"log out\" a user. You simply need to delete the t\\JWT token on the client. If you make a request to the server app, without a valid JWT token, it will be treated as the user is not logged in.",
      "question_score": 9,
      "answer_score": 24,
      "created_at": "2021-01-28T01:00:27",
      "url": "https://stackoverflow.com/questions/65929178/logout-jwt-with-nestjs"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 67597203,
      "title": "How to use multiple global interceptors in NestJS",
      "problem": "I had already know we could create global interceptors from this code below:\n```\n`import { Module } from '@nestjs/common';\nimport { APP_INTERCEPTOR } from '@nestjs/core';\n\n@Module({\n  providers: [\n    {\n      provide: APP_INTERCEPTOR,\n      useClass: LoggingInterceptor,\n    },\n  ],\n})\nexport class AppModule {}\n`\n```\nSource: documentation\nHowever, what if I want to have let say, `UserInterceptor`.\n`UserInterceptor` will get user from database and transform the request.\n`UserInterceptor` need to inject let say `UserService`.\nAnd I want to use `UserInterceptor` globally.\n```\n`@Injectable()\nexport class UserInterceptor {\n  constructor(private readonly service: UserService) {}\n}\n`\n```\nFrom documentation, we can't do `app.useGlobalInterceptors(new UserInterceptor())` because `UserInterceptor` need 1 argument in the constructor (UserService).\nAnd since we had use `APP_INTERCEPTOR` for `LoggingInterceptor`, I didn't found another way to assign another value to `APP_INTERCEPTOR` to use the interceptor globally.\nFor example I think the problem will solved if we could do:\n```\n`providers: [\n  {\n    provide: APP_INTERCEPTOR,\n    useClass: [LoggingInterceptor, UserInterceptor]\n  }\n]\n`\n```",
      "solution": "`providers: [\n  {\n    provide: APP_INTERCEPTOR,\n    useClass: LoggingInterceptor\n  },\n  {\n    provide: APP_INTERCEPTOR,\n    useClass: UserInterceptor\n  }\n]\n`\nJust like this",
      "question_score": 9,
      "answer_score": 26,
      "created_at": "2021-05-19T07:02:01",
      "url": "https://stackoverflow.com/questions/67597203/how-to-use-multiple-global-interceptors-in-nestjs"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 69907142,
      "title": "Is there a native method in nestjs to decode JWT?",
      "problem": "In nestjs I create JWT (tokens) by creating a payload object and signing it. Something like this:\n```\n`    const jwtPayload: JwtPayload = \n    {\n      iss:                issuer,\n      sub:                info,\n      aud:                audience,\n   // exp:                - populated by fn: this.jwtService.sign(payload),\n   // iat:                - populated by fn: this.jwtService.sign(payload),\n      jti:                'XXXX1234' \n    }\n\nconst signedJwtAccessToken: string = this.jwtService.sign(jwtPayload); \n`\n```\nNest encodes the jwtPayload into a string.\nFor cleanup work I would like to know when exactly the JWT expires. This is automatically encoded into the 'signedJwtAccessToken' - property .exp - by the .sign() function.\nTo access it right after the signing, it needs to be decoded.\nWhat would be the simplest way to decode the signedJwtAccessToken in the same method right after it has been signed ???\nNote:\nWhen the JWT comes back from client, nestjs decodes it when accessing the fn: validate(), but I want to decode right after signing it - before sending the response to client, something like:\n```\n`                            // signing - encoding\nconst signedJwtAccessToken: string = this.jwtService.sign(jwtPayload);\n\n                            // decoding\nconst decodedJwtAccessToken: string = decodeJwt(signedJwtAccessToken);\n\n                            // parsing back to an object\nconst updatedJwtPayload: JwtPayload  = JSON.parse(decodedJwtAccessToken);\n\n                            // reading property of .exp\nconst expires = updatedJwtPayload.exp;\n`\n```",
      "solution": "Just decode it as a normal jwt token. If you use nestjs-jwt package, just call decode function:\n```\n`const decodedJwtAccessToken: JwtPayload = this.jwtService.decode(signedJwtAccessToken);\n\nconst expires = decodedJwtAccessToken.exp;\n\n`\n```\nOr just decode the token as a base64 string\n```\n`const base64Payload = signedJwtAccessToken.split('.')[1];\nconst payloadBuffer = Buffer.from(base64Payload, 'base64');\nconst updatedJwtPayload: JwtPayload = JSON.parse(payloadBuffer.toString()) as JwtPayload;\nconst expires = updatedJwtPayload.exp;\n`\n```",
      "question_score": 9,
      "answer_score": 20,
      "created_at": "2021-11-10T02:57:58",
      "url": "https://stackoverflow.com/questions/69907142/is-there-a-native-method-in-nestjs-to-decode-jwt"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 69079742,
      "title": "Cannot read property &#39;resolve&#39; of undefined when using import path from &#39;path&#39;",
      "problem": "When using :\n`import path from 'path';\n\npath.resolve('/')\n`\nI get the title error, but when I use\n`require('path').resolve('messages.json'))\n`\n\n`import { readFile, writeFile } from 'fs/promises';\nimport { v4 as uuidv4 } from 'uuid';\nimport path from 'path';\n\ninterface MessagesJson {\n  messages: Array;\n}\n\nexport class MessagesRepository {\n  async findOne(id: string): Promise {\n    return id;\n  }\n\n  async findAll(): Promise {\n    return null;\n  }\n\n  async create(message: any): Promise {\n    console.log(' dirname', require('path').resolve('messages.json'));\n    console.log(' path.resolve', path.resolve('/'));\n    // console.log(' path.resolve', path.resolve(__dirname, '/src'));\n    const messages: any = await readFile('src/messages.json', 'utf-8');\n\n    const parsedMessages: MessagesJson = JSON.parse(messages);\n\n    const newMessage = {\n      content: message,\n      id: uuidv4(),\n    };\n\n    await parsedMessages.messages.push(newMessage);\n\n    await writeFile('src/messages.json', JSON.stringify(parsedMessages));\n\n    return parsedMessages;\n  }\n}\n`\nFor the problem context, I'm working on a small project with nestjs, any option for path.foo() gets the same error as listed above, is it something related for after the compiling of the code?\nIm very lost to where/what doc and/or information should i be reading to be able to understand what is happening.",
      "solution": "`require` on it's own is, by technicality, a named import. This means that in Typescript it needs to be like `import * as path from 'path'` so that you can make use  of `path.resolve`. Another option would be to deconstruct the import by using `import { resolve } from 'path';` and now you can just call `resolve()` directly.",
      "question_score": 9,
      "answer_score": 15,
      "created_at": "2021-09-06T21:58:15",
      "url": "https://stackoverflow.com/questions/69079742/cannot-read-property-resolve-of-undefined-when-using-import-path-from-path"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 69568781,
      "title": "How to create a custom health check for Prisma with @nestjs/terminus?",
      "problem": "Since @nestjs/terminus doesn't provide a health check for Prisma, I'm trying to create it based on their Mongoose health check.\nWhen I try:\n```\n`import * as Prisma from 'prisma';\n...\n...\n  private getContextConnection(): any | null {\n    const {\n      getConnectionToken,\n      // eslint-disable-next-line @typescript-eslint/no-var-requires\n    } = require('prisma') as typeof Prisma;\n\n    try {\n      return this.moduleRef.get(getConnectionToken('DatabaseConnection') as string, {\n        strict: false,\n      });\n    } catch (err) {\n      return null;\n    }\n  }\n...\n...\n    const connection = options.connection || this.getContextConnection();\n\n    if (!connection) {\n      throw new ConnectionNotFoundError(\n        this.getStatus(key, isHealthy, {\n          message: 'Connection provider not found in application context',\n        }),\n      );\n    }\n`\n```\nI always seem to get: \"message\": \"Connection provider not found in application context\".\nThere is a problem with the connection or I don't really understand how the health check actually works",
      "solution": "A naive copy of the mongoose implementation isn't going to work because there are differences between the `NestJSMongoose` type/module and `Prisma`. In particular, `getConnectionToken` does not exist inside the `Prisma` package.\nI can't comment on what the best way would be to extend terminus to support prisma. You might have to dig a bit into the `terminus` interface for that. However, a simple way to get a health check/ping  in Prisma is to use the following query:\n`    prisma.$queryRaw`SELECT 1`\n`",
      "question_score": 9,
      "answer_score": 6,
      "created_at": "2021-10-14T12:04:51",
      "url": "https://stackoverflow.com/questions/69568781/how-to-create-a-custom-health-check-for-prisma-with-nestjs-terminus"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 74221005,
      "title": "Mongodb connection failed in local with node version 18.12.0?",
      "problem": "I am seeing one issue with node version `18.12.0` and mongodb `6.0.2`. I already build a nestjs application with mongodb. Here I use `@nestjs/mongoose(v- 9.0.2)` and `mongoose (v-6.7.0)`\nHere I can see that when I upgrade node js to latest lts version then I am not able to connect to mongodb. It show an error like `unable to connect to database`.\nBut When I downgrade to node version `16.18.0` then it working fine. My question is that you guys already face this issue or I am only person getting this issue. If you know that then actually where is the problem occurred?\nHere is my connection code-\n```\n`MongooseModule.forRoot(\"mongodb://localhost:27017/nekmart\", {\n      connectionFactory: (connection) => {\n        connection.plugin(slug, { number: true });\n        return connection\n      }\n}),\n`\n```",
      "solution": "Had same problem after upgrading to NodeJs 18.12.1; followed other blogs/comments and apparently\nchanging the Uri from `mongodb://localhost:27017/test_db` to `mongodb://127.0.0.1:27017/test_db` works.\nWithout getting into the specifics reasons it appears that `localhost` is rejected due to some changes in NodeJS.",
      "question_score": 9,
      "answer_score": 14,
      "created_at": "2022-10-27T12:58:34",
      "url": "https://stackoverflow.com/questions/74221005/mongodb-connection-failed-in-local-with-node-version-18-12-0"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 68686034,
      "title": "Jest tests failing with ENOENT no such file or directory (referring to the spec files themselves)",
      "problem": "We have a NestJS project with several modules. Suddenly, some tests stopped working with  errors all like\n\nFAIL  libs/backend/nest/pipes/src/lib/iso-date-validation.pipe.spec.ts\n\u25cf Test suite failed to run\nENOENT: no such file or directory, open\nD:\\git\\my-nest-project\\libs\\backend\\nest\\pipes\\src\\lib\\iso-date-validation.pipe.spec.ts'\n\nIt knows what test to run, but then it claims it can't find the test file. Sometimes we get a couple of these errors, sometimes dozens.\nThese errors are happening randomly (not always on the same tests) locally on my machine as well as on our Jenkins server and on other developer environments as well. I can reproduce this on Windows/Mac/Linux.\nThere were no changes to the test or project configuration files that would have triggered this change. In fact, I have checked out previous versions of the codebase that built reliably in Jenkins and now they have the same random test errors.\nI have tested on clean nodejs environments with nothing installed globally except npm.\nUsing the jest --verbose flag gives me no further details.\nThe jest config in a NestJS project is multi-layered, so it's hard to display the whole thing here, but I don't understand how this could be a configuration issue because the tests used to run fine and the configuration files have not changed.\nI have tried clearing the jest cache, but the results are not consistent. On some occasions I can get a clean test run after clearing the cache.\nMore often than not, the test failures occur in a module that has some React .tsx templates, but not always. Sometimes a pure Typescript module will fail.",
      "solution": "It turns out I shot myself in the foot on this one, but I'm posting the answer in case it helps anyone else.\nSome of our jest tests were using the mock-fs package to simulate a path to a managed config file that is present in the production environment. But the tests that used mock-fs neglected to call mock.restore() after the test to disable the mock file system. Apparently the mock file system is quite invasive. What was strange was that introducing mock-fs did not immediately produce the unexpected behavior of breaking other tests. It was also quite unexpected that mock-fs could break jest itself.\nhttps://www.npmjs.com/package/mock-fs\nRTFM",
      "question_score": 9,
      "answer_score": 11,
      "created_at": "2021-08-06T20:22:26",
      "url": "https://stackoverflow.com/questions/68686034/jest-tests-failing-with-enoent-no-such-file-or-directory-referring-to-the-spec"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 70671382,
      "title": "Throw HttpException at service in nestjs",
      "problem": "Is it good way to throw Http Exeption at service in nestjs?\nWhat is the best way to processing error at service in nestjs?",
      "solution": "From experience, it's best practice to throw HTTPExceptions in the controller logic manually or have an exception filter automatically catch exceptions. Services should be reusable pieces of functionality that can sometimes be used in non-http contexts.\nHaving http logic in the service layer feels like an anti-pattern.",
      "question_score": 9,
      "answer_score": 12,
      "created_at": "2022-01-11T19:01:07",
      "url": "https://stackoverflow.com/questions/70671382/throw-httpexception-at-service-in-nestjs"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 70681202,
      "title": "Is it good way to throw error from service in nestjs like it:",
      "problem": "```\n`const movie = await this.movieService.getOne(movie_id);\nif(!movie){\n  throw new Error(\n    JSON.stringify({\n      message:'some message',\n      status:'http status'\n   })\n  );\n}\nconst rating = await this.ratingRepository.find({where:{movie});\nreturn rating;\n`\n```\nAnd after it use try catch in controller and throw HttpExeption.\n```\n`async getAllByMovie(@Param('movie_id') movie_id:string):Promise{\n  try{\n    const ratings = await this.ratingService.getAllRatingsByMovie(Number(movie_id));\n    return ratings;\n  }catch(err){\n    const {message,status} = JSON.parse(err.message);\n    throw new HttpExeption(message,status);\n  }\n}\n`\n```\nIs it good or not?",
      "solution": "In NestJs we have all exception filters so that we don't need to handle errors in all places\nyou can refer https://docs.nestjs.com/exception-filters\nall-exceptions.filter.ts\n\r\n\r\n`import {\n  ExceptionFilter,\n  Catch,\n  ArgumentsHost,\n  HttpException,\n  HttpStatus,\n} from '@nestjs/common';\nimport { object } from 'underscore';\n@Catch()\nexport class AllExceptionsFilter implements ExceptionFilter {\n  \n  catch(exception: any, host: ArgumentsHost) {\n    const ctx = host.switchToHttp();\n    const response = ctx.getResponse();\n    const request = ctx.getRequest();\n    let internalStatus;\n   \n    let status =\n      exception instanceof HttpException\n        ? exception.getStatus()\n        : HttpStatus.INTERNAL_SERVER_ERROR;\n    let message = exception.sqlMessage || exception.response || exception;\n    let error = exception.sqlState === 45000 ? 'Bad Request' : 'Bad Request';\n\n    \n    request.log.timeTookToServe = Date.now() - request.log.timestamp;\n    request.log.message = message;\n    request.log.status = `${status}`;\n    \n    if (exception instanceof TypeError) {\n      status = 400;\n      error = 'Bad Request';\n      message = exception.message\n        .substring(exception.message.indexOf('\\n\\n\\n') + 1)\n        .trim();\n    }\n\n    if (status === 500) {\n     \n      console.log(exception.sqlMessage, exception.sqlState, exception);\n     \n    } else {\n       console.log(exception.sqlMessage, exception.sqlState, exception);\n    }\n    const errMessage = errJson[request.log['module']];\n \n    response.status(status).json({\n      status: exception.status || status,\n     \n      error: error,\n      message: [\n        status === 403\n          ? \"Either you don't have the privilege or been logged out.\"\n          : message,\n      ],\n    });\n  }\n}`",
      "question_score": 9,
      "answer_score": 3,
      "created_at": "2022-01-12T13:00:33",
      "url": "https://stackoverflow.com/questions/70681202/is-it-good-way-to-throw-error-from-service-in-nestjs-like-it"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 66501485,
      "title": "Is it possible to keep scheduled tasks from overlapping in NestJS?",
      "problem": "Currently, long running tasks will overlap (same task runs multiple instances at the same time) if the time necessary to finish the ask is greater than the interval. example NestJS service below\n```\n`import { Injectable, Logger } from '@nestjs/common';\nimport { Interval } from '@nestjs/schedule';\n\nfunction timeout(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nlet c = 1\n\n@Injectable()\nexport class TasksService {\n  private readonly logger = new Logger(TasksService.name);\n\n  @Interval(1000)\n  async handleCron() {\n    this.logger.debug(`start ${c}`);\n    await timeout(3000)\n    this.logger.debug(`end ${c}`);\n    c += 1\n  }\n}\n`\n```\nIs it possible to keep these tasks from overlapping and only calling the task with one instance at a time? Technically, we could keep track of a `lock` variable, but this would only allow us to skip an instance, if one is already running. Ideally, we could call set an option to allow intervals based on task end-time, rather than fixed intervals (aka start-time).",
      "solution": "It is easily done in NestJS, but you will need to refactor your code.\nInstead of using `@Interval`, use the `@Cron` since it has more options that we will use in the next lines.\nLet us replace first the interval decorator:\n```\n`@Interval(1000)\n  async handleCron() {\n    this.logger.debug(`start ${c}`);\n    await timeout(3000)\n    this.logger.debug(`end ${c}`);\n    c += 1\n  }\n`\n```\nbecomes:\n```\n`@Cron(CronExpression.EVERY_SECOND, {\n     name: 'cron_job_name_here',\n   })\nasync handleCron() {\n        this.logger.debug(`start ${c}`);\n        await timeout(3000)\n        this.logger.debug(`end ${c}`);\n        c += 1\n   }\n`\n```\nWhat we have done here, is that we used the cron expression which is more expressive, even non programmers could understand that this job will run every second. Also, we named the cron job, so now we can manipulate the cron job through the scheduler's module APIs.\nNow that our cron job has a name, we can start/stop it easily using the scheduler registry. So you function becomes:\n```\n`@Cron(CronExpression.EVERY_SECOND, {\n     name: 'cron_job_name_here',\n   })\nasync handleCron() {\n        const job = this.schedulerRegistry.getCronJob('cron_job_name_here');\n        job.stop(); // pausing the cron job\n\n        this.logger.debug(`start ${c}`);\n        await timeout(3000)\n        this.logger.debug(`end ${c}`);\n        c += 1;\n\n        job.start(); // restarting the cron job\n   }\n`\n```\nDo not forget to inject the scheduler registry service into the constructor of your service.\n```\n`private schedulerRegistry: SchedulerRegistry,\n`\n```\nand also the imports:\n```\n`import { Cron, CronExpression, SchedulerRegistry } from '@nestjs/schedule'\n`\n```",
      "question_score": 9,
      "answer_score": 9,
      "created_at": "2021-03-06T02:20:33",
      "url": "https://stackoverflow.com/questions/66501485/is-it-possible-to-keep-scheduled-tasks-from-overlapping-in-nestjs"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 69735754,
      "title": "How to get nested URL query in Nest.js",
      "problem": "I have NestJS application I have to get the query from the URL. Problem is that my creationDate is an object and I can't get it as the nested object via @Query.\nHere is example of the route:\n```\n`xxx/yyy/orders?key1=value&key2=value&key3=value&createdAt[lte]=2021-07-01&createdAt[gte]=2011-03-30&orderBy=desc&limit=500\n`\n```\nI am trying to get createdAt[lte] and createdAt[gte] as the nested object\n```\n`export interface QueryI {\nkey1: string;\nkey2: string;\nkey3: string;\nkey4: string;\ncreatedAt: {\n    lte: string,\n    gte: string,\n}\norderBy: 'desc' | 'asc';\nlimit: number;\n}\n`\n```\nHere is my controller:\n```\n`@Get('route')\ngetAll(\n    @Query() query: QueryI): Promise { \n    return this.myService.findAll(query);\n}\n`\n```\nbut this gives me following result\n```\n`{\n\nkey1: 'value',        \n  key2: 'value',\n  key3: 'value',       \n  key4: 'value',\n  'createdAt[lte]': 'some date',\n  'createdAt[gte]': 'some date',\n  orderBy: 'desc',\n  limit: '500'\n\n}\n`\n```\nI have tried JSON.stringify and consulted similar questions on SOW but no luck.\nThank you",
      "solution": "EDIT\nIn the end I have implemented diferent classes and used @Pipe to validate my query: Here is the code:\npipe.ts\n```\n`@Injectable()\nexport class ValidateQueryPipe implements PipeTransform {\n  transform(value: any, metadata: ArgumentMetadata) {\n    let incomingQuery = value as IncomingQuery;\n    let mappedQuery = new QueryParameters()\n    mappedQuery.key1 = incomingQuery.key1\n    mappedQuery.key2= incomingQuery.key2\n    // other mapped valus\n    mappedQuery.createdAt = new CreatedAt(incomingQuery['createdAt[lte]'], incomingQuery['createdAt[gte]'])        \n    return mappedQuery;\n  }\n`\n```\ncontroller.ts\n```\n`@Get(':someurl/someurl')\ngetAllOrders(\n    @Query(ValidateQueryPipe) query: QueryParameters): Promise> { \n    return this.service.findAll(erpCode, query);\n}\n`\n```\nquery-parameters.ts\n```\n`import { CreatedAt } from \"./created-at\";\n\nexport class QueryParameters {\n    key1: string;\n    key2: string;\n    createdAt: CreatedAt;\n}\n`\n```\ncreated-at.ts\n```\n`export class CreatedAt {\n    lte: string;\n    gte: string;\n\n    constructor(lte: string, gte: string){\n        this.lte = lte;\n        this.gte = gte;\n    };\n}\n`\n```\n\nWell I have found a partial solution and I will post it here untill better answer comes along:\nI am extracting the nested properties into seperate queries and creating my model. It's not perfect but it's doing the job for now...\ncontroller.ts\n```\n` getAllOrders(\n    @Query() query,\n    @Query('createdAt[lte]') lte: string, \n    @Query('createdAt[gte]') gte: string): Promise { \n    const mappedObject = new QueryParameters(query, lte, gte)\n    return this.orderService.findAll(erpCode, mappedObject);\n}\n`\n```\ncreatedAtModel.ts\n```\n`    export class CreatedAt {\n    lte: string;\n    gte: string;\n\n    constructor(lte: string, gte: string){\n        this.lte = lte;\n        this.gte = gte;\n    };\n}\n`\n```\nmy-model.ts\n```\n`import { CreatedAt } from \"./created-at\";\n\nexport class QueryParameters {\n    //other keys\n    createdAt: CreatedAt;\n\n    constructor(query, lte, gte){\n        //other keys\n        this.createdAt = new CreatedAt(lte, gte)\n    }\n}\n`\n```\nI am sure that better answer lies in using the NestJS validation pipes but I didn't manage to find the one that works for me.",
      "question_score": 9,
      "answer_score": 3,
      "created_at": "2021-10-27T11:05:22",
      "url": "https://stackoverflow.com/questions/69735754/how-to-get-nested-url-query-in-nest-js"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 75674278,
      "title": "How to run NestJs app in Docker using nx/monorepo",
      "problem": "I have this Nrwl monorepo with a couple of apps. One of it is a NestJs app, which runs fine as long as I do everything inside my Monorepo.\nHowever, I need to run my NestJS app inside a Docker container. I noticed that I cannot simply copy the compiled NestJS code into an Image, because it still requires `node_modules`.\nThe only easy solution I can think of is to also copy the main `package.json` file into the image and run `npm install`. Is this the correct/only way or does Nrwl/nx has tooling for this?",
      "solution": "Set generatePackageJson to true in workspace.json. Nx will generate a package.json in the dist folder for you.\n/apps//project.json\n```\n`{\n  \"name\": \"your.app\",\n  \"targets\": {\n    \"build\": {\n      \"options\": {\n        \"generatePackageJson\": true \n      }\n    },\n  },\n}\n`\n```",
      "question_score": 9,
      "answer_score": 5,
      "created_at": "2023-03-08T15:21:40",
      "url": "https://stackoverflow.com/questions/75674278/how-to-run-nestjs-app-in-docker-using-nx-monorepo"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 72598718,
      "title": "Modifying the DTO name appearing in OpenAPI (Swagger) schemas in NestJS",
      "problem": "I am facing a problem where my DTO types are named one thing, but I want them to appear with a different name in the OpenAPI doc page.\nFor example, I have a UserDto class that I use in my controller, but wanted it to appear as simply \"User\" in the schemas section (and everywhere else this applies). Is that possible? Is there any decorator I can use?\nI know I can simply modify the class name, but there is already a different user class used elsewhere.\nI have searched everywhere with no avail.\n\nBTW, I am using typescript and nestjs.\nEvery help will be appreciated, thanks!",
      "solution": "Out of the box, Nest.js doesn't yet offer a ready-made solution. There is an open pull request (as mentioned earlier) https://github.com/nestjs/swagger/pull/983, but when it will be merged is unknown.\nYou can change the DTO name in schemas using one of the following approaches:\n\nAdd a static name property to your DTO.\n\n`  class UserDto {\n    static name = 'User';  // \nBut in strict mode, TypeScript will show an error like:\n`Static property 'name' conflicts with built-in property 'Function.name' of constructor function 'UserDto'.`\n\nWrite a decorator with an interface as suggested in the pull request and use it until the desired functionality appears in Nest.js.\nThe decorator adds the name property with the needed value to the wrapper class for the DTO.\n\n`  type Constructor = new(...args: any[]) => T;\n  type Wrapper = { new(): (T & any), prototype: T };\n  type DecoratorOptions = { name: string };\n  type ApiSchemaDecorator = (options: DecoratorOptions) => (constructor: T) => Wrapper;\n\n  const ApiSchema: ApiSchemaDecorator = ({ name }) => {\n    return (constructor) => {\n      const wrapper = class extends constructor { };\n      Object.defineProperty(wrapper, 'name', {\n        value: name,\n        writable: false,\n      });\n      return wrapper;\n    }\n  }\n`\nUse as suggested in the proposal:\n`  @ApiSchema({ name: 'User' }) // \nAnd don't forget that in TypeScript 5 the decorator API will change to something close to the implementation in JavaScript \ud83d\ude09",
      "question_score": 9,
      "answer_score": 10,
      "created_at": "2022-06-13T08:47:23",
      "url": "https://stackoverflow.com/questions/72598718/modifying-the-dto-name-appearing-in-openapi-swagger-schemas-in-nestjs"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 73344053,
      "title": "Getting &quot;The &#39;mongodb&#39; provider is not supported with this command&quot; Error when try to do mongoDB migrate with Prisma",
      "problem": "I'm developing some simple Todo App BE using NestJS with Prisma ORM and use MongoDB as the DB. I'm using a FREE and SHARED MongoDB cluster that is hosted in MongoDB Altas cloud. Also I added `0.0.0.0/0` to the network access tab so anyone can connect to the DB.\nschema.prisma file\n```\n`// This is your Prisma schema file,\n// learn more about it in the docs: https://pris.ly/d/prisma-schema\n\ndatasource db {\n  provider = \"mongodb\"\n  url      = env(\"DATABASE_URL\")\n}\n\ngenerator client {\n  provider = \"prisma-client-js\"\n}\n\nmodel Task {\n  id      String   @id @default(auto()) @map(\"_id\") @db.ObjectId\n  name    String?\n  description String?\n  status  TaskStatus @default(TODO)\n}\n\nenum TaskStatus {\n  TODO\n  INPROGRESS\n  DONE\n}\n`\n```\n.env file\n```\n`DATABASE_URL=\"mongodb+srv://:@todoappdb.jfo3m2c.mongodb.net/?retryWrites=true&w=majority\"\n`\n```\nBut when I try to run `npx prisma migrate dev --name init` command it gives following output\n```\n`D:\\todoapp-backend>npx prisma migrate dev --name init\nEnvironment variables loaded from .env\nPrisma schema loaded from prisma\\schema.prisma\nDatasource \"db\"\n\nError: The \"mongodb\" provider is not supported with this command. For more info see https://www.prisma.io/docs/concepts/database-connectors/mongodb\n   0: migration_core::state::DevDiagnostic\n             at migration-engine\\core\\src\\state.rs:250\n`\n```\nCan someone point me what is the problem?",
      "solution": "After reading some content, found that `prisma migrate` commands are for the SQL databases only since they have a rigid table structure. But MongoDB is a document database and those data are unstructured\nSo rather than running `prisma migrate` command we can use following command\n```\n`npx prisma generate\n`\n```\nThis command creates the Prisma client that gives type-safe access to our database.\nReference - https://www.youtube.com/watch?v=b4nxOv91vWI&ab_channel=Prisma",
      "question_score": 8,
      "answer_score": 23,
      "created_at": "2022-08-13T13:58:52",
      "url": "https://stackoverflow.com/questions/73344053/getting-the-mongodb-provider-is-not-supported-with-this-command-error-when-t"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 66437004,
      "title": "Is there a way to hide all the end-point in the controller.ts using a single decorator?",
      "problem": "Currently, I am using  @ApiExcludeEndpoint() ### on top of all methods to hide the end-point in the swagger-ui, like this:\n\r\n\r\n`import { Controller, Get, Query, Param } from '@nestjs/common';\nimport { ResourceService } from './resource.service';\nimport { Auth } from 'src/auth/auth.decorator';\nimport {\n  ApiTags,\n  ApiSecurity,\n  ApiOkResponse,\n  ApiForbiddenResponse,\n  ApiCreatedResponse,\n  ApiExcludeEndpoint\n} from '@nestjs/swagger';\n\n@Controller()\n@ApiTags('Resources')\n@ApiSecurity('apiKey')\nexport class ResourceController {\n  constructor(private readonly resourceService: ResourceService) {}\n\n  @Get('get_url')\n  @ApiExcludeEndpoint()\n  @Get()\n  @ApiOkResponse({\n    description: 'Resources list has succesfully been returned',\n  })\n  @ApiForbiddenResponse({ description: 'You are not allowed' })\n  @Auth(...common_privileges)\n  findAll(@Query() query: any): any {\n    ......\n  }\n\n  \n  @Get('get_url/:id')\n  @ApiExcludeEndpoint()\n  @ApiOkResponse({ description: 'Resource has succesfully been returned' })\n  @ApiForbiddenResponse({ description: 'You are not allowed' })\n  @Auth(...common_privileges)\n  findById(@Param('id') id: string, @Query() query: any): any {\n    ......\n  }\n\n}`\r\n\r\n\r\n\nI Need to know is there a way to hide all the end-point in the controller using a single decorator, I checked some documents it says to use @ApiIgnore() and @Hidden() but I can't find those in nestjs-swagger. Please comment on this",
      "solution": "One possibility is to explicitly include the modules that you'd like to include in the swagger docs instead of just \"including all modules\" by default. Example:\n`  const options = new DocumentBuilder()\n    .setTitle('Cats example')\n    .setDescription('The cats API description')\n    .setVersion('1.0')\n    .addTag('cats')\n    .build();\n\n  const catDocument = SwaggerModule.createDocument(app, options, {\n    include: [LionsModule, TigersModule], // don't include, say, BearsModule\n  });\n  SwaggerModule.setup('api/cats', app, catDocument);\n`\nWithout the explicit `include:[]` property, `LionsModule`, `TigersModule`, and `BearsModule` would be automatically included.",
      "question_score": 8,
      "answer_score": 12,
      "created_at": "2021-03-02T10:50:18",
      "url": "https://stackoverflow.com/questions/66437004/is-there-a-way-to-hide-all-the-end-point-in-the-controller-ts-using-a-single-dec"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 68394971,
      "title": "How to mock NestJS built-in Logger in Jest",
      "problem": "I have a controller that uses NestJS built-in Logger via dependency injection in constructor of the controller:\n```\n`  constructor(private readonly logger: Logger) \n`\n```\nI want to be able to mock it in my Jest tests to see which methods and with what arguments are being called during logging. I tried this syntax:\n```\n`providers[{\n    provide: Logger,\n    useValue: {\n      log: jest.fn(),\n    }\n}]\n`\n```\nIn that case this line:\n```\n`    expect(Logger).toHaveBeenCalledTimes(1);\n`\n```\nReturns:\nMatcher error: received value must be a mock or spy function\nAny help will be highly appreciated!",
      "solution": "In your test, you should get the logger back out of the DI context using `moduleFixture.get(Logger)` (or something very similar) and then check `expect(logger.log).toHaveBeenCalledTimes(1)`. `Logger` itself is a class, not a spy or mock, so Jest doesn't know what to do with that.\nFull solution that worked:\n```\n`import { Test } from '@nestjs/testing';\nlet logger: Logger;\n\nbeforeEach(async () => {\n  const moduleRef = await Test.createTestingModule({\n    providers: [  \n      {\n        provide: Logger,\n        useValue: {\n          log: jest.fn(),\n        },\n      },\n    ],\n  }).compile();\n  logger = moduleRef.get(Logger);\n});\n`\n```\nAnd then later in the test itself:\n```\n`expect(logger.log).toHaveBeenCalledTimes(1);\nexpect(logger.log).toHaveBeenCalledWith('Your log message here')\n`\n```",
      "question_score": 8,
      "answer_score": 17,
      "created_at": "2021-07-15T15:40:41",
      "url": "https://stackoverflow.com/questions/68394971/how-to-mock-nestjs-built-in-logger-in-jest"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 70168350,
      "title": "Prevent multiple cron running in nest.js on docker",
      "problem": "In docker we have used `deploy: replicas: 3` for our microservice. We have some Cronjob & the problem is the system in running all cronjob is getting called 3 times which is not what we want. We want to run it only one time. Sample of cron in nest.js :\n```\n`  @Cron(CronExpression.EVERY_5_MINUTES)\n  async runBiEventProcessor() {\n    const calculationDate = new Date()\n    Logger.log(`Bi Event Processor started at ${calculationDate}`)\n`\n```\nHow can I run this cron only once without changing the replicas to 1?",
      "solution": "This is quite a generic problem when cron or background job is part of the application having multiple instances running concurrently.\nThere are multiple ways to deal with this kind of scenario. Following are some of the workaround if you don't have a concrete solution:\n\nCreate a separate service only for the background processing and ensure only one instance is running at a time.\n\nExpose the cron job as an API and trigger the API to start background processing. In this scenario, the load balancer will hand over the request to only one instance. This approach will ensure that only one instance will handle the job. You will still need an external entity to hit the API, which can be in-house or third-party.\n\nUse repeatable jobs feature from Bull Queue or any other tool or library that provides similar features.\nBull will hand over the job to any active processor. That way, it ensures the job is processed only once by only one active processor.\nNest.js has wrapper for the same. Read more about the Bull queue repeatable job here.\n\nImplement a custom locking mechanism\nIt is not difficult as it sounds. Many other schedulers in other frameworks work on similar principles to handle concurrency.\n\nIf you are using RDBMS, make use of transactions and locking. Create cron records in the database. Acquire the lock as soon as the first cron enters and processes. Other concurrent jobs will either fail or timeout as they will not be able to acquire the lock. But you will need to handle a few cases in this approach to make it bug-free and flawless.\nIf you are using MongoDB or any similar database that supports TTL (Time-to-live) setting and unique index. Insert the document in the database where one of the fields from the document has unique constraints that ensure another job will not be able to insert one more document as it will fail due to database-level unique constraints. Also, ensure TTL(Time-to-live index) on the document; this way document will be deleted after a configured time.\n\nThese are workaround if you don't have any other concrete options.",
      "question_score": 8,
      "answer_score": 24,
      "created_at": "2021-11-30T12:09:52",
      "url": "https://stackoverflow.com/questions/70168350/prevent-multiple-cron-running-in-nest-js-on-docker"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 69411838,
      "title": "Nest class-validator minDate throws error even when the date is greater",
      "problem": "I'm using Nest with class-validator and attempting to validate that the date provided by the UI is no earlier than today using `@isDateString()` and `@MinDate()`\n \n```\n`export class SchemaDto {\n    @IsOptional()\n    @IsDateString()\n    @MinDate(new Date())\n    myDate?: Date;\n}\n`\n```\nThe data I am sending in is a Date Objected with the following date:\n```\n`    Mon Oct 04 2021 00:00:00 GMT-0400 (Eastern Daylight Time)\n`\n```\nThe error I am getting from class-validator is:\n```\n`     minimal allowed date for myDate is Fri Oct 01 2021 15:57:18 GMT-0400 (Eastern Daylight Time) \n`\n```\nThe problem:\n \nIf I remove the minDate decorator, everything works fine but I would rather validate this common case.\n\ninfo:\ntypescript: ~4.1.4\nnode: 12.4.0\nclass-validator:  0.13.1\nnest: 7.0.0",
      "solution": "To validate with @MinDate\n```\n`export class SchemaDto {\n    @IsNotEmpty()\n    @Transform( ({ value }) => new Date(value))\n    @IsDate()\n    @MinDate(new Date())\n    myDate: Date;\n}\n`\n```\nBut if value is optional, it might null or undefined, so:\n```\n`export class SchemaDto {\n    @IsOptional()\n    @Transform( ({ value }) => value && new Date(value))\n    @IsDate()\n    @MinDate(new Date())\n    myDate?: Date;\n}\n`\n```",
      "question_score": 8,
      "answer_score": 20,
      "created_at": "2021-10-01T22:48:27",
      "url": "https://stackoverflow.com/questions/69411838/nest-class-validator-mindate-throws-error-even-when-the-date-is-greater"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 71408726,
      "title": "NestJS: How to customise log messages to include request id and name of the file the log message occurred",
      "problem": "I am new to NestJS and would like to customise the log messages to include the x-request-id/x-correlation-id and the name of the file the log message originated but am not sure if there is anything in NestJS to do that.\nMy application is using NestJS with the Fastify adapter and has the following configuration in the bootstrap() function\n\r\n\r\n`  const app = await NestFactory.create(\n    AppModule,\n    new FastifyAdapter(),\n    {\n        logger: WinstonModule.createLogger(winston.createLogger({\n          exitOnError: false,\n          level: 'debug',\n          handleExceptions: true,\n          format: winston.format.combine(\n            winston.format.timestamp(),\n            winston.format.ms(),\n            winston.format.colorize(),\n            winston.format.align(),\n            winston.format.splat(),\n            winston.format.printf((info) => {\n                return `${info.timestamp} [ ${info.level} ] : ${info.message}`;\n            }),\n          ),\n          transports: [\n            new (winston.transports.Console)()\n          ]\n        }),\n      )\n    }\n  );`\r\n\r\n\r\n\nThis seems to format the logs using winston as expected.\n`2022-03-09T11:21:22.131Z [ info ] :     Starting Nest application...`\nHowever, I would also like to include the request/correlation id in the message and the name of the file the log message occurred e.g.\n`2022-03-09T11:21:22.131Z 2cfd4eee-ca2b-4869-b66b-2b7da291f567 [ info ] [ Main.ts ]:     Starting Nest application...`\nIs there anything in NestJS itself to allow this or any external libraries that I could use to achieve the desired result ?",
      "solution": "I managed to get it working using the nest-pino library:\n\r\n\r\n`// main.ts\n\nimport { Logger } from 'nestjs-pino';\n\nasync function bootstrap() {\n\nconst app = await NestFactory.create(\n    AppModule,\n    new FastifyAdapter(),\n    { bufferLogs: true }\n  );\n\n  app.useLogger(app.get(Logger));\n  \n}\nbootstrap();`\r\n\r\n\r\n\n\r\n\r\n`// app.module.ts\n\nimport { LoggerModule } from 'nestjs-pino';\n\n@Module({\n  imports: [\n    LoggerModule.forRoot({\n      pinoHttp: {\n        level: process.env.LOG_LEVEL || 'debug',\n        redact: ['request.headers.authorization'],\n        prettyPrint: {\n          colorize: true,\n          singleLine: true,\n          levelFirst: false,\n          translateTime: \"yyyy-MM-dd'T'HH:mm:ss.l'Z'\",\n          messageFormat: \"{req.headers.x-correlation-id} [{context}] {msg}\",\n          ignore: \"pid,hostname,context,req,res,responseTime\",\n          errorLikeObjectKeys: ['err', 'error']\n        }\n      }\n    }),\n  ],\n  controllers: [MyController],\n})\nexport class AppModule {}`\r\n\r\n\r\n\n\r\n\r\n`// my.controller.ts\nimport { Controller, Get, Param, Logger } from '@nestjs/common';\n\n@Controller()\nexport class MyController {\n    private readonly logger: Logger = new Logger(MyController.name);\n\n    @Get('/:id')\n    async getCustomerDetails(@Headers() headers, @Param('id') id: string): Promise {\n        this.logger.log(`Accepted incoming request with id: ${id}`);\n\n        // Do some processing ....\n\n        return customer;\n    }\n}`\r\n\r\n\r\n\n\r\n\r\n`[2022-11-14T11:03:07.100Z] INFO: 428f0df9-d12b-4fca-9b11-805a13ff41be [MyController] Accepted incoming request with id: 1`\r\n\r\n\r\n\n****** UPDATE **********\nI also managed to update the redacted fields to be configurable from a .yaml file\n\r\n\r\n`// app.module.ts\n\nimport { ConfigModule, ConfigService } from '@nestjs/config';\nimport { LoggerModule } from 'nestjs-pino';\n\n@Module({\n  imports: [\n    LoggerModule.forRootAsync({\n      imports: [ConfigModule],\n      useFactory: async (configService: ConfigService) => ({\n        pinoHttp: {\n          level: process.env.LOG_LEVEL || 'info',\n          redact: configService.get('logger.redacted.fields'),\n          prettyPrint: {\n            colorize: false,\n            singleLine: true,\n            levelFirst: false,\n            translateTime: \"yyyy-mm-dd'T'HH:MM:ss.l'Z'\",\n            messageFormat: '{req.headers.x-correlation-id} [{context}] {msg}',\n            ignore: 'pid,hostname,context,req,res,responseTime',\n            errorLikeObjectKeys: ['err', 'error'],\n          },\n        },\n      }),\n      inject: [ConfigService],\n    }),\n  ],\n  controllers: [MyController],\n})\nexport class AppModule {}`\r\n\r\n\r\n\ndev.yaml\n```\n`logger:\n    redacted:\n        fields:\n            - 'headers.Authorization'\n            - 'headers[\"X-Api-Key\"]'\n`\n```\n****** FURTHER UPDATE ******\nThis article on medium also describes how to add correlation ids to log messages with winston\nhttps://medium.com/@jose-luis-navarro/logging-on-nestjs-like-a-pro-with-correlation-ids-log-aggregation-winston-morgan-and-more-d03e3bb56772",
      "question_score": 8,
      "answer_score": 15,
      "created_at": "2022-03-09T12:37:41",
      "url": "https://stackoverflow.com/questions/71408726/nestjs-how-to-customise-log-messages-to-include-request-id-and-name-of-the-file"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 70041367,
      "title": "End-to-end testing NestJS with Fastify: &quot;@nestjs/platform-express&quot; package is missing&quot; error",
      "problem": "I have fresh NestJS application using Fastify. When trying to `npm run test:e2e` I got the following error:\n```\n`[Nest] 14894   - 11/19/2021, 10:29:10 PM   [ExceptionHandler] The \"@nestjs/platform-express\" package is missing. Please, make sure to install this library ($ npm install @nestjs/platform-express) to take advantage of NestFactory.\n  \u25cf  process.exit called with \"1\"\n\n      12 |     }).compile();\n      13 | \n    > 14 |     app = moduleFixture.createNestApplication();\n         |                         ^\n      15 |     await app.init();\n      16 |   });\n      17 | \n\n      at Object.loadPackage (../node_modules/@nestjs/common/utils/load-package.util.js:13:17)\n      at TestingModule.createHttpAdapter (../node_modules/@nestjs/testing/testing-module.js:25:56)\n      at TestingModule.createNestApplication (../node_modules/@nestjs/testing/testing-module.js:13:43)\n      at Object. (app.e2e-spec.ts:14:25)\n\n RUNS  test/app.e2e-spec.ts\n\nProcess finished with exit code 1\n\n`\n```\nSeems odd, because why would platform-express be needed for fastify-based app?",
      "solution": "Appears that after switching to Fastify we also need to update `test/app.e2e-spec.ts` accordingly:\n`import { Test, TestingModule } from '@nestjs/testing';\nimport * as request from 'supertest';\nimport { AppModule } from '../src/app.module';\nimport { FastifyAdapter, NestFastifyApplication } from '@nestjs/platform-fastify';\n\ndescribe('AppController (e2e)', () => {\n  let app: NestFastifyApplication;\n\n  beforeEach(async () => {\n    const moduleFixture: TestingModule = await Test.createTestingModule({\n      imports: [AppModule],\n    }).compile();\n\n    app = moduleFixture.createNestApplication(new FastifyAdapter());\n    await app.init();\n    await app.getHttpAdapter().getInstance().ready();\n  });\n\n  afterEach(async () => {\n    await app.close();\n  });\n\n  it('/ (GET)', () => {\n    return request(app.getHttpServer()).get('/').expect(200).expect('Hello World!');\n  });\n});\n\n`",
      "question_score": 8,
      "answer_score": 21,
      "created_at": "2021-11-19T23:01:27",
      "url": "https://stackoverflow.com/questions/70041367/end-to-end-testing-nestjs-with-fastify-nestjs-platform-express-package-is-mi"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 67547621,
      "title": "CannotDetermineEntityError when saving entities with TypeORM",
      "problem": "I created a NestJS and used TypeORM for the RDBMS(I used postgres in my project).\n`Post` is an `@Entity` class, `PostRepository` is a `Repository` class for `Post`.\nI was trying to create `OnModuleInit` service to initialize some data.\n`@Injectable()\nexport class PostsDataInitializer implements OnModuleInit {\n  private data: Post[] = [\n    {\n      title: 'Generate a NestJS project',\n      content: 'content',\n    },\n    {\n      title: 'Create GrapQL APIs',\n      content: 'content',\n    },\n    {\n      title: 'Connect to Postgres via TypeORM',\n      content: 'content',\n    },\n  ];\n\n  constructor(private readonly postRepository: PostRepository) {}\n  async onModuleInit(): Promise {\n    await this.postRepository.manager.transaction(async (manager) => {\n      // NOTE: you must perform all database operations using the given manager instance\n      // it's a special instance of EntityManager working with this transaction\n      // and don't forget to await things here\n      await manager.delete(Post, {});\n      console.log('deleted: {} ');\n      this.data.forEach(async (d) => await manager.save(d as Post));\n      const savedPosts = await manager.find(Post);\n      savedPosts.forEach((p) => {\n        console.log('saved: {}', p);\n      });\n    });\n  }\n}\n\n`\nWhen starting up the application, I got the following error.\n`\nCannotDetermineEntityError: Cannot save, given value must be instance of entity class, instead object literal is given. Or you must specify an entity target to method call.\n\n`\nBut the above `save` was accepting an instance of `Post`.",
      "solution": "I think it is pretty much what the error says. You cannot pass literal objects to `.save`\n`  private data = [\n    {\n      title: 'Generate a NestJS project',\n      content: 'content',\n    },\n    {\n      title: 'Create GrapQL APIs',\n      content: 'content',\n    },\n    {\n      title: 'Connect to Postgres via TypeORM',\n      content: 'content',\n    },\n  ].map(data => {\n    const post = new Post();\n    Object.assign(post, data);\n    return post;\n  })\n`\nthe above might solve this.",
      "question_score": 8,
      "answer_score": 10,
      "created_at": "2021-05-15T16:10:14",
      "url": "https://stackoverflow.com/questions/67547621/cannotdetermineentityerror-when-saving-entities-with-typeorm"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 70994389,
      "title": "Is it possible to validate that one of 2 parameters are present using class-validator?",
      "problem": "Using class-validator along with NestJS I want to validate that a user provides either `propertyA` or a `propertyB` but they don't need to provide both.\nCurrently, I'm doing something like:\n`export class TestDto {\n  @ValidateIf(obj => !obj.propertyB)\n  @IsString()\n  @IsNotEmpty()\n  propertyA\n\n  @ValidateIf(obj => !obj.propertyA)\n  @IsString()\n  @IsNotEmpty()\n  propertyB\n}\n`\nIf they provide none of the parameters there will be multiple errors saying that `propertyA` and `propertyB` are required and should be strings etc.\nIn the case that they provide neither property, I would want only a single error saying something like: \"You must provide propertyA or propertyB.\"\nCan this be accomplished using NestJS/class-validator?",
      "solution": "Don't know whether this functionality exists in class-validator or not but you can simply achieve this scenario using Pipes\nJust create a custom pipe and then define the logic over there\n```\n`import { PipeTransform, Injectable, ArgumentMetadata, BadRequestException } from '@nestjs/common';\n\n@Injectable()\nexport class CustomValidationPipe implements PipeTransform {\n  transform(value: TestDto , metadata: ArgumentMetadata) {\n    if(value.porpertyA && value.porpertyB) throw new BadRequestException(\"You must provide propertyA or propertyB\")\n    else return value;\n  }\n}\n\n`\n```\nAfter That, you can use that Pipe over the controller\n```\n`  @Post()\n  create(@Body( new CustomValidationPipe()) testDto: TestDto) {\n    return \"create Resource\"\n  }\n\n`\n```\nYou can also use it in combination with a builtIn Validation Pipe just like this. In this case, your class validator logic will be executed first and then your custom pipe will execute\n```\n`  @Post()\n  create(@Body(ValidationPipe ,  new CustomValidationPipe()) testDto: TestDto) {\n    return \"create Resource\"\n  }\n\n`\n```\nHope This Helps",
      "question_score": 8,
      "answer_score": 6,
      "created_at": "2022-02-05T01:38:49",
      "url": "https://stackoverflow.com/questions/70994389/is-it-possible-to-validate-that-one-of-2-parameters-are-present-using-class-vali"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 78106894,
      "title": "ERROR [MailerService] Transporter is ready. Nest.js. @nestjs-modules/mailer",
      "problem": "In the terminal, an error occurs: [Nest] 21016 - 05.03.2024, 19:05:42 ERROR [MailerService] Transporter is ready. Emails are being sent. I don't know what the problem is, I need help.\nThe code has been checked, there are no errors.enter image description here",
      "solution": "Using latest version of @nestjs-modules/mailer will log this error in terminal so i'm using version 1.10.3 instead.\nUpdate\nThis issue has been fixed since version 2.0.2",
      "question_score": 8,
      "answer_score": 11,
      "created_at": "2024-03-05T11:13:38",
      "url": "https://stackoverflow.com/questions/78106894/error-mailerservice-transporter-is-ready-nest-js-nestjs-modules-mailer"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 69120748,
      "title": "NestJS conditional module import",
      "problem": "Is there a way to import a module conditionally?\nI want to check if the .env file exists, so I configure the env variables using the ConfigModule.\n```\n`    imports: [\n    UsersModule,\n    ConfigModule.forRoot({ load: [configuration] }), //I want to use this just if the .env file exists\n    MongooseModule.forRoot(\n      `mongodb+srv://${process.env.DATABASE_USER}:${process.env.DATABASE_PASSWORD}@${process.env.DATABASE_URL}`,\n    ),\n  ],\n`\n```\nWhy: I deployed an api and configured the environment variables using heroku, and in production it works, but I dont have this variables  to run the code in development, and I can't expose the .env in my public repository because this contains my database credentials. Because of this, I thinked to create a .env file and put it on .gitignore to don't publish with this file",
      "solution": "You can do this pretty easily with a `spread` and a ternary check on whatever condition you want. Just return an empty array in the case that the check evaluates to false and the module will not be included.\n`@Module({\n  imports: [\n   ...(isEnvPresent ? [ConfigModule.forRoot({ load: [configuration] })] : []),\n   UsersModule,\n  ],\n})\n`",
      "question_score": 8,
      "answer_score": 15,
      "created_at": "2021-09-09T17:15:30",
      "url": "https://stackoverflow.com/questions/69120748/nestjs-conditional-module-import"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 72272265,
      "title": "How can my class-validator validate union string | number?",
      "problem": "I have an simple DTO class for validation\n`class SearchIssuerDto {\n    search: string | number;\n}\n`\nWhat is the correct way to validate the search param that it can accept an string or a number ?",
      "solution": "You can create a custom validator for that:\n```\n`@ValidatorConstraint({ name: 'string-or-number', async: false })\nexport class IsNumberOrString implements ValidatorConstraintInterface {\n  validate(text: any, args: ValidationArguments) {\n    return typeof text === 'number' || typeof text === 'string';\n  }\n\n  defaultMessage(args: ValidationArguments) {\n    return '($value) must be number or string';\n  }\n}\n`\n```\nUsage:\n```\n`class SearchIssuerDto {\n  @IsDefined()\n  @Validate(IsNumberOrString)\n  search: number | string;\n}\n`\n```",
      "question_score": 8,
      "answer_score": 14,
      "created_at": "2022-05-17T12:21:27",
      "url": "https://stackoverflow.com/questions/72272265/how-can-my-class-validator-validate-union-string-number"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 67554794,
      "title": "QueryRunnerAlreadyReleasedError when executing a series of queries in a single transaction",
      "problem": "I add an `OnMoudleInit`service to initialize some sample data in my NestJS application.\nTypeORM provides several approaches to wrap the queries into a single transcation.\nI tried to use `EntityManager.transaction` to wrap the operations.\n` await this.manager.transaction(async (manager) => {\n      // NOTE: you must perform all database operations using the given manager instance\n      // it's a special instance of EntityManager working with this transaction\n      // and don't forget to await things here\n      const del = await manager.delete(PostEntity, {});\n      console.log('posts deleted: ', del.affected);\n\n      const userDel = await manager.delete(UserEntity, {});\n      console.log('users deleted: ', userDel.affected);\n\n      const user = new UserEntity();\n      Object.assign(user, {\n        firstName: 'hantsy',\n        lastName: 'bai',\n        email: 'hantsy@gmail.com',\n      });\n      const savedUser = await manager.save(user);\n      console.log('saved user: ', JSON.stringify(savedUser));\n      this.data.forEach(async (d) => {\n        const p = new PostEntity();\n        p.author = savedUser;\n        \n        // comment out these relation settings it will work well.\n        // \n        // const comment = new CommentEntity();\n        // comment.content = 'test comment at:' + new Date();\n        // p.comments = Promise.resolve([comment]);\n        Object.assign(p, d);\n        await manager.save(p);\n      });\n    });\n\n    const savedPosts = await this.postRepository.find({});\n    console.log('saved:', JSON.stringify(savedPosts));\n  }\n`\nWhen the application is starting up, the following error occurred.\n`posts deleted:  2\nusers deleted:  1\nsaved user:  {\"firstName\":\"hantsy\",\"lastName\":\"bai\",\"email\":\"hantsy@gmail.com\",\"id\":\"04d5cc63-d36a-4d80-a37f-97424ef168a8\"}\nD:\\hantsylabs\\nestjs-graphql-sample\\node_modules\\typeorm\\error\\QueryRunnerAlreadyReleasedError.js:10\n        var _this = _super.call(this) || this;\n                           ^\n\nQueryRunnerAlreadyReleasedError: Query runner already released. Cannot run queries anymore.\n    at new QueryRunnerAlreadyReleasedError (D:\\hantsylabs\\nestjs-graphql-sample\\node_modules\\typeorm\\error\\QueryRunnerAlreadyReleasedError.js:10:28)\n`\nUpdate: I found this is caused by the post/comment `cascade` settings, I was trying to use one command to save post/comments.\n`  @OneToMany((type) => CommentEntity, (comment) => comment.post, {\n    cascade: true,\n  })\n  comments?: Promise;\n\n`\nUpdate 2: If I use the `Repository` class to execute the `save` task, it seems it works.\n`    const post = new PostEntity();\n    post.title = 'test title';\n    post.content = 'test content';\n    const comment = new CommentEntity();\n    comment.content = 'test comment';\n    post.comments = Promise.resolve([comment]);\n    await this.postRepository.save(post);\n    //console.log('saved from repository: ', JSON.stringify(savedPost));\n`\nWhen I added the above codes before the manager transaction block, and I found the `manager.delete(Post, {})` did not apply the `cascade` settings?",
      "solution": "Got the answer from Nestjs/TypeORM discord discusstion.\nChnage the following codes to:\n`this.data.forEach(async (d) => {\n        const p = new PostEntity();\n        p.author = savedUser;\n        \n        // comment out these relation settings it will work well.\n        // \n        // const comment = new CommentEntity();\n        // comment.content = 'test comment at:' + new Date();\n        // p.comments = Promise.resolve([comment]);\n        Object.assign(p, d);\n        await manager.save(p);\n      });\n`\nto this, use `Promise.all` to wrap all async codes.\n`      await Promise.all(\n        this.data.map(async (d) => {\n          const p = new PostEntity();\n          Object.assign(p, d);\n          p.author = user;\n\n          const c = CommentEntity.of('test comment at:' + new Date());\n          p.comments = Promise.resolve([c]);\n          await mgr.save(p);\n        }),\n      );\n    });\n`",
      "question_score": 8,
      "answer_score": 14,
      "created_at": "2021-05-16T11:04:14",
      "url": "https://stackoverflow.com/questions/67554794/queryrunneralreadyreleasederror-when-executing-a-series-of-queries-in-a-single-t"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 68948248,
      "title": "Find rows using foreign key in TypeORM",
      "problem": "I have an OneToMany relation from `User` to `Message`.\nWhen I insert register a user with a message, it adds the user to the `User` table, and the message to the `Message` table with a `userId` pointing to the user's id.\nThis is done automatically using the following setup.\n`User` entity:\n```\n`@Entity()\nexport class User {\n  @PrimaryGeneratedColumn() \n  id: number;\n\n  @Column()\n  name: string;\n\n  @Column()\n  email: string;\n\n  @JoinTable()\n  @OneToMany((type) => Message, (message) => message.user, {\n    cascade: true,\n  })\n  messages: Message[];\n}\n`\n```\n`Message` entity:\n```\n`@Entity()\nexport class Message {\n  @PrimaryGeneratedColumn()\n  id: number;\n\n  @Column()\n  text: string;\n  @ManyToOne((type) => User, (user) => user.messages, { eager: true })\n  user: User[];\n}\n`\n```\nIf I want to find all messages from a user via `userId` with:\n```\n`const existing_msgs = await this.messageRepository.find({\n    where: { userId: user.id },\n});\n`\n```\nIt tells me that it cannot find the `userId` column, which is understandable as I did not specifically include `userId` to the `Message` entity.\nBut how would we query it in this case?",
      "solution": "As mentionned in This post, you have to add the decorator @JoinColumn after your manytoone. This will join the column and you will be able to perform the query you want with :\n```\n`const existing_msgs = await this.messageRepository.find({\n    where: { user: { id: user.id }},\n});\n`\n```\nNote that this will work only on primary column like id.\nAnd your message table will be :\n```\n`@Entity()\nexport class Message {\n  @PrimaryGeneratedColumn()\n  id: number;\n\n  @Column()\n  text: string;\n\n  @ManyToOne((type) => User, (user) => user.messages, { eager: true })\n  @JoinColumn() // <-- Add this\n  user: User[];\n}\n`\n```",
      "question_score": 8,
      "answer_score": 12,
      "created_at": "2021-08-27T07:04:05",
      "url": "https://stackoverflow.com/questions/68948248/find-rows-using-foreign-key-in-typeorm"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 72803245,
      "title": "Nest js convert module from forRoot to forRootAsync",
      "problem": "```\n`@Module({\n  imports: [],\n  providers: [SupertokensService, AuthService],\n  exports: [],\n  controllers: [AuthController],\n})\nexport class AuthModule implements NestModule {\n  configure(consumer: MiddlewareConsumer) {\n    consumer.apply(AuthMiddleware).forRoutes('*');\n  }\n  static forRoot({\n    connectionURI,\n    apiKey,\n    appInfo,\n  }: AuthModuleConfig): DynamicModule {\n    return {\n      providers: [\n        {\n          useValue: {\n            appInfo,\n            connectionURI,\n            apiKey,\n          },\n          provide: ConfigInjectionToken,\n        },\n      ],\n      exports: [],\n      imports: [],\n      module: AuthModule,\n    };\n  }\n}\n`\n```\nThe problem with this implementaion I can't use env variables, so I need useFactory to pass ConfigService. Can somebody do that, and give some explanation.",
      "solution": "I figure out how to make this work, unfortunately it only works with nest.js version 9 (current latest version). First you need to create a new file. For example `auth.module-definition.ts`. Now in this file we need to create `ConfigurableModuleBuilder`.\n\r\n\r\n`import { ConfigurableModuleBuilder } from '@nestjs/common';\nimport { AuthModuleConfig } from './config.interface';\n\nexport const { ConfigurableModuleClass, MODULE_OPTIONS_TOKEN } =\n  new ConfigurableModuleBuilder()\n    .setClassMethodName('forRoot')\n    .build();`\r\n\r\n\r\n\nwe need to set `setClassMethodName('forRoot')`, when we set `forRoot` it will create two methods, `forRoot` and `forRootAsync`. The next step is to extend our created `ConfigurableModuleClass`. it should look something like this\n\r\n\r\n`import { MiddlewareConsumer, Module } from '@nestjs/common';\n\nimport { AuthMiddleware } from './auth.middleware';\nimport { SupertokensService } from './supertokens/supertokens.service';\nimport { AuthController } from './auth.controller';\nimport { AuthService } from './auth.service';\nimport { ConfigurableModuleClass } from './auth.module-definition';;\n\n@Module({\n  imports: [],\n  providers: [SupertokensService, AuthService],\n  controllers: [AuthController],\n  exports: [AuthService],\n})\nexport class AuthModule extends ConfigurableModuleClass {\n  configure(consumer: MiddlewareConsumer) {\n    consumer.apply(AuthMiddleware).forRoutes('*');\n  }\n}`\r\n\r\n\r\n\nAnd that's actually it, so from now on we have `forRootAsync` and we get reigister it in `app.module.ts`\n\r\n\r\n`import { MiddlewareConsumer, Module, NestModule } from '@nestjs/common';\nimport { AuthModule } from './auth/auth.module';\nimport { ConfigModule, ConfigType } from '@nestjs/config';\nimport authConfig from './auth/auth.config';\n\n@Module({\n  imports: [\n    AuthModule.forRootAsync({\n      inject: [authConfig.KEY],\n      imports: [ConfigModule.forFeature(authConfig)],\n      useFactory: (config: ConfigType) => {\n        return {\n          connectionURI: config.CONNECTION_URI,\n          appInfo: {\n            appName: config.appInfo.APP_NAME,\n            apiDomain: config.appInfo.API_DOMAIN,\n            websiteDomain: config.appInfo.WEBSITE_DOMAIN,\n            apiBasePath: config.appInfo.API_BASE_PATH,\n            websiteBasePath: config.appInfo.WEBSITE_BASE_PATH,\n          },\n        };\n      },\n    })\n  ],\n  controllers: [],\n  providers: [\n  ],\n})\nexport class AppModule implements NestModule {\n}`\r\n\r\n\r\n\nhere I am using `Nest.js Config`, but you don't need to, so use it how you want.\nI know that my english is not the best, so if you still do not understand you can check these sources https://docs.nestjs.com/fundamentals/dynamic-modules#configurable-module-builder\nhttps://trilon.io/blog/nestjs-9-is-now-available#Configurable-module-builder",
      "question_score": 8,
      "answer_score": 5,
      "created_at": "2022-06-29T16:36:17",
      "url": "https://stackoverflow.com/questions/72803245/nest-js-convert-module-from-forroot-to-forrootasync"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 68796174,
      "title": "nest.js build throwing a lot of errors",
      "problem": "I have this Nest.js app running and setup for a while and, out of a sudden, it started reporting this when I run npm run build.\n```\n`node_modules/@nestjs/config/dist/config.service.d.ts:1:23 - error TS2305: Module '\"./types\"' has no exported member 'Path'.\n\n1 import { NoInferType, Path, PathValue } from './types';\n                        ~~~~\nnode_modules/@nestjs/config/dist/config.service.d.ts:1:29 - error TS2305: Module '\"./types\"' has no exported member 'PathValue'.\n\n1 import { NoInferType, Path, PathValue } from './types';\n                              ~~~~~~~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:114 - error TS1005: '?' expected.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                   ~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:117 - error TS2304: Cannot find name 'Key'.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                      ~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:124 - error TS2693: 'PathImpl' only refers to a type, but is being used as a value here.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                             ~~~~~~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:133 - error TS2304: Cannot find name 'T'.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                      ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:135 - error TS2304: Cannot find name 'Key'.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                        ~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:155 - error TS2304: Cannot find name 'T'.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                            ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:157 - error TS2304: Cannot find name 'Key'.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                              ~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:177 - error TS1005: '(' expected.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                  ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:179 - error TS2693: 'string' only refers to a type, but is being used as a value here.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                    ~~~~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:185 - error TS1005: ',' expected.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                          ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:191 - error TS1005: ',' expected.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                                ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:191 - error TS2581: Cannot find name '$'. Do you need to install type definitions for jQuery? Try `npm i @types/jquery`.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                                ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:192 - error TS1005: ',' expected.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                                 ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:193 - error TS18004: No value exists in scope for the shorthand property 'Key'. Either declare one or provide an initializer.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                                  ~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:198 - error TS2339: Property '$' does not exist on type '{ Key: any; }'.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                                       ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:199 - error TS1005: ',' expected.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                                        ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:199 - error TS2349: This expression is not callable.\n  Type '{ [x: number]: any; Exclude(): any; keyof: any; any: any; }' has no call signatures.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                                        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:214 - error TS1005: ',' expected.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                                                       ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:215 - error TS1005: ',' expected.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                                                        ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:216 - error TS2304: Cannot find name 'Key'.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                                                         ~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:220 - error TS1005: ':' expected.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                                                             ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:222 - error TS18004: No value exists in scope for the shorthand property 'keyof'. Either declare one or provide an initializer.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                                                               ~~~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:228 - error TS1005: ',' expected.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                                                                     ~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:228 - error TS2693: 'any' only refers to a type, but is being used as a value here.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                                                                     ~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:231 - error TS1005: ',' expected.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                                                                        ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:232 - error TS1109: Expression expected.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                                                                         ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:233 - error TS1005: ':' expected.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                                                                          ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:233 - error TS2362: The left-hand side of an arithmetic operation must be of type 'any', 'number', 'bigint' or an enum type.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                                                                          ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:235 - error TS1109: Expression expected.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                                                                            ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:1:237 - error TS2693: 'string' only refers to a type, but is being used as a value here.\n\n1 export declare type PathImpl = Key extends string ? T[Key] extends Record ? `${Key}.${PathImpl> & string}` | `${Key}.${Exclude & string}` : never : never;\n                                                                                                                                                                                                                                              ~~~~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:4:66 - error TS1005: ',' expected.\n\n4 export declare type PathValue> = P extends `${infer Key}.${infer Rest}` ? Key extends keyof T ? Rest extends Path ? PathValue : never : never : P extends keyof T ? T[P] : never;\n                                                                   ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:4:66 - error TS2581: Cannot find name '$'. Do you need to install type definitions for jQuery? Try `npm i @types/jquery`.\n\n4 export declare type PathValue> = P extends `${infer Key}.${infer Rest}` ? Key extends keyof T ? Rest extends Path ? PathValue : never : never : P extends keyof T ? T[P] : never;\n                                                                   ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:4:67 - error TS1005: ',' expected.\n\n4 export declare type PathValue> = P extends `${infer Key}.${infer Rest}` ? Key extends keyof T ? Rest extends Path ? PathValue : never : never : P extends keyof T ? T[P] : never;\n                                                                    ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:4:68 - error TS18004: No value exists in scope for the shorthand property 'infer'. Either declare one or provide an initializer.\n\n4 export declare type PathValue> = P extends `${infer Key}.${infer Rest}` ? Key extends keyof T ? Rest extends Path ? PathValue : never : never : P extends keyof T ? T[P] : never;\n                                                                     ~~~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:4:74 - error TS1005: ',' expected.\n\n4 export declare type PathValue> = P extends `${infer Key}.${infer Rest}` ? Key extends keyof T ? Rest extends Path ? PathValue : never : never : P extends keyof T ? T[P] : never;\n                                                                           ~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:4:74 - error TS18004: No value exists in scope for the shorthand property 'Key'. Either declare one or provide an initializer.\n\n4 export declare type PathValue> = P extends `${infer Key}.${infer Rest}` ? Key extends keyof T ? Rest extends Path ? PathValue : never : never : P extends keyof T ? T[P] : never;\n                                                                           ~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:4:79 - error TS2339: Property '$' does not exist on type '{ infer: any; Key: any; }'.\n\n4 export declare type PathValue> = P extends `${infer Key}.${infer Rest}` ? Key extends keyof T ? Rest extends Path ? PathValue : never : never : P extends keyof T ? T[P] : never;\n                                                                                ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:4:80 - error TS1005: ',' expected.\n\n4 export declare type PathValue> = P extends `${infer Key}.${infer Rest}` ? Key extends keyof T ? Rest extends Path ? PathValue : never : never : P extends keyof T ? T[P] : never;\n                                                                                 ~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:4:80 - error TS2349: This expression is not callable.\n  Type '{ infer: any; Rest: any; }' has no call signatures.\n\n4 export declare type PathValue> = P extends `${infer Key}.${infer Rest}` ? Key extends keyof T ? Rest extends Path ? PathValue : never : never : P extends keyof T ? T[P] : never;\n                                                                                 ~~~~~~~~~~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:4:81 - error TS18004: No value exists in scope for the shorthand property 'infer'. Either declare one or provide an initializer.\n\n4 export declare type PathValue> = P extends `${infer Key}.${infer Rest}` ? Key extends keyof T ? Rest extends Path ? PathValue : never : never : P extends keyof T ? T[P] : never;\n                                                                                  ~~~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:4:87 - error TS1005: ',' expected.\n\n4 export declare type PathValue> = P extends `${infer Key}.${infer Rest}` ? Key extends keyof T ? Rest extends Path ? PathValue : never : never : P extends keyof T ? T[P] : never;\n                                                                                        ~~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:4:87 - error TS18004: No value exists in scope for the shorthand property 'Rest'. Either declare one or provide an initializer.\n\n4 export declare type PathValue> = P extends `${infer Key}.${infer Rest}` ? Key extends keyof T ? Rest extends Path ? PathValue : never : never : P extends keyof T ? T[P] : never;\n                                                                                        ~~~~\nnode_modules/@nestjs/config/dist/types/path-value.type.d.ts:5:1 - error TS1160: Unterminated template literal.\n`\n```\nAnyone knows how to make this go away?\nAll I remember doing was trying to update the nest cli on the terminal. Now, it throws these exceptions every time I ran my application.",
      "solution": "Just to add, upgrading to NestJS 8, along with upgrading TypeScript (to 4.5+) and RxJs (to 7.x) will help solve and build problems along these lines.",
      "question_score": 8,
      "answer_score": 4,
      "created_at": "2021-08-16T01:58:48",
      "url": "https://stackoverflow.com/questions/68796174/nest-js-build-throwing-a-lot-of-errors"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 71548592,
      "title": "Nest JS &amp; TypeORM cannot use findOne properly",
      "problem": "I am trying to get a user instance based on `id` (same happens for other attributes such as `email`. Inside the Service, this is my code:\n`@Injectable()\nexport class UserService {\n  @InjectRepository(User)\n  private readonly repository: Repository;\n\n  async findOne(id: number): Promise {\n    const user = await this.repository.findOne(id);\n    return user;\n  }\n}\n`\nand my User entity is:\n`@Entity()\nexport class User {\n  @PrimaryGeneratedColumn()\n  public id: number;\n\n  @Column({ type: 'varchar', length: 120 })\n  public name: string;\n\n  @Column({ type: 'varchar', length: 120 })\n  public email: string;\n}\n`\nThe problem is that I always get this error:\n`src/api/user/user.service.ts - error TS2559: Type 'number' has no properties in common with type 'FindOneOptions'.`\nOther methods such as `getAll` work just fine:\n`public getAllUsers(): Promise {\n  return this.repository.find();\n}\n`",
      "solution": "Are you using the latest version of `typeorm`? Then downgrade it to `typeorm@0.2` because `@nestjs/typeorm@8.0` might not support the latest one yet. You can read the changes of `typeorm@0.3` here: https://github.com/typeorm/typeorm/releases/tag/0.3.0",
      "question_score": 7,
      "answer_score": 7,
      "created_at": "2022-03-20T17:34:48",
      "url": "https://stackoverflow.com/questions/71548592/nest-js-typeorm-cannot-use-findone-properly"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 75581669,
      "title": "Customize error message in Nest js using class-validator",
      "problem": "I am working on a nest project, and using class-validator for validation.\nCurrently if there is any validation error, I am getting  error response as\n```\n`{\n    \"statusCode\": 400,\n    \"message\": [\n        \"Title is too long. Maximal length is 50 characters, but actual is $value\",\n        \"Title is too short. Minimal length is 10 characters, but actual is $value\"\n    ],\n    \"error\": \"Bad Request\"\n}\n`\n```\nBut instead of message as array of string, can we have message as array of object. So, that FE can easy figure out which field is having the error, like\n```\n`{\n    \"message\": [\n        { \"field\": \"title\", \"error\": \"Title is too long. Maximal length is 50 characters, but actual is $value\" },\n        { \"field\": \"title\", \"error\": \"Title is too short. Minimal length is 10 characters, but actual is $value\" }\n    ]\n}\n`\n```",
      "solution": "You can use exception filters in NestJS to handle or add custom user-friendly responses.\nHowever, for the class-validator, there is the same mechanism by using exceptionFactory() in your validationPipe to modify the error returned by the class-validator, here is an example code for it:\n`app.useGlobalPipes(\n  new ValidationPipe({\n    exceptionFactory: (validationErrors: ValidationError[] = []) => {\n      return new BadRequestException(\n        validationErrors.map((error) => ({\n          field: error.property,\n          error: Object.values(error.constraints).join(', '),\n        })),\n      );\n    },\n  }),\n);\n`\nHope it will works for you!",
      "question_score": 7,
      "answer_score": 23,
      "created_at": "2023-02-27T15:22:23",
      "url": "https://stackoverflow.com/questions/75581669/customize-error-message-in-nest-js-using-class-validator"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 70907953,
      "title": "Class-Validator (Node.js) Get another property value within custom validation",
      "problem": "At the moment, I have a very simple class-validator file with a ValidationPipe in Nest.js as follows:\n```\n`import {\n  IsDateString,\n  IsEmail,\n  IsOptional,\n  IsString,\n  Length,\n  Max,\n} from 'class-validator';\n\nexport class UpdateUserDto {\n  @IsString()\n  id: string;\n\n  @Length(2, 50)\n  @IsString()\n  firstName: string;\n\n  @IsOptional()\n  @Length(2, 50)\n  @IsString()\n  middleName?: string;\n\n  @Length(2, 50)\n  @IsString()\n  lastName: string;\n\n  @IsEmail()\n  @Max(255)\n  email: string;\n\n  @Length(8, 50)\n  password: string;\n\n  @IsDateString()\n  dateOfBirth: string | Date;\n}\n`\n```\nLets say in the above \"UpdateUserDto,\" the user passes an \"email\" field. I want to build a custom validation rule through class-validator such that:\n\nCheck if email address is already taken by a user from the DB\nIf the email address is already in use, check if the current user (using the value of 'id' property) is using it, if so, validation passes, otherwise, if it is already in use by another user, the validation fails.\n\nWhile checking if the email address is already in use is a pretty simple task, how would you be able to pass the values of other properties within the DTO to a custom decorator `@IsEmailUsed`",
      "solution": "It was pretty simple to solve, I solved it by creating a custom class-validation Decorator as below:\n```\n`import { PrismaService } from '../../prisma/prisma.service';\nimport {\n  registerDecorator,\n  ValidationOptions,\n  ValidatorConstraint,\n  ValidatorConstraintInterface,\n  ValidationArguments,\n} from 'class-validator';\nimport { Injectable } from '@nestjs/common';\n\n@ValidatorConstraint({ name: 'Unique', async: true })\n@Injectable()\nexport class UniqueConstraint implements ValidatorConstraintInterface {\n  constructor(private readonly prisma: PrismaService) {}\n\n  async validate(value: any, args: ValidationArguments): Promise {\n    const [model, property = 'id', exceptField = null] = args.constraints;\n\n    if (!value || !model) return false;\n\n    const record = await this.prisma[model].findUnique({\n      where: {\n        [property]: value,\n      },\n    });\n\n    if (record === null) return true;\n\n    if (!exceptField) return false;\n\n    const exceptFieldValue = (args.object as any)[exceptField];\n    if (!exceptFieldValue) return false;\n\n    return record[exceptField] === exceptFieldValue;\n  }\n\n  defaultMessage(args: ValidationArguments) {\n    return `${args.property} entered is not valid`;\n  }\n}\n\nexport function Unique(\n  model: string,\n  uniqueField: string,\n  exceptField: string = null,\n  validationOptions?: ValidationOptions,\n) {\n  return function (object: any, propertyName: string) {\n    registerDecorator({\n      target: object.constructor,\n      propertyName: propertyName,\n      options: validationOptions,\n      constraints: [model, uniqueField, exceptField],\n      validator: UniqueConstraint,\n    });\n  };\n}\n`\n```\nHowever, to allow DI to that particular Decorator, you need to also add this to your main.ts bootstrap function:\n```\n`async function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n\n  ...\n  // Line below needs to be added.\n  useContainer(app.select(AppModule), { fallbackOnErrors: true });\n  ...\n}\n`\n```\nAlso, make sure to import the \"Constraint\" in the app module:\n```\n`@Module({\n  imports: ...,\n  controllers: [AppController],\n  providers: [\n    AppService,\n    PrismaService,\n    ...,\n    // Line below added\n    UniqueConstraint,\n  ],\n})\nexport class AppModule {}\n`\n```\nFinally, add it to your DTO as such:\n```\n`export class UpdateUserDto {\n  @IsString()\n  id: string;\n\n  @IsEmail()\n  @Unique('user', 'email', 'id') // Adding this will check in the user table for a user with email entered, if it is already taken, it will check if it is taken by the same current user, and if so, no issues with validation, otherwise, validation fails.\n  email: string;\n}\n`\n```",
      "question_score": 7,
      "answer_score": 21,
      "created_at": "2022-01-29T18:23:27",
      "url": "https://stackoverflow.com/questions/70907953/class-validator-node-js-get-another-property-value-within-custom-validation"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 67589835,
      "title": "TypeORM / NestJS - @BeforeUpdate hook not working",
      "problem": "I'm having problems using TypeOrm hook \"BeforeUpdate\"\nI'm trying to update the user entity password, by passing a simple string and calling the save method to trigger the beforeUpdate hook and then hash the password, but this hook is not working while calling the save method.\nThis is what i have\nuser.service.ts\n`async update(id: number, updateUserDto: UpdateUserDto) {\n  const roles =\n    updateUserDto.roles &&\n    (await Promise.all(\n      updateUserDto.roles.map((name) => this.preloadRoleByName(name))\n    ));\n  const user = await this.userRepository.findOneOrFail(id);\n  if (!user) {\n    throw new NotFoundException(`User with ID #${id} not found`);\n  }\n  const toSaveUser = {\n    ...user,\n    ...updateUserDto,\n    roles,\n  };\n  return await this.userRepository.save(toSaveUser);\n}\n`\nuser.entity.ts\n`.\n.\n.\n@Column()\n@Exclude()\npassword: string;\n\n@BeforeInsert()\n@BeforeUpdate()\nprivate async hashPassword() {\n  const rounds = 10;\n  const salt = await bcrypt.genSalt(rounds);\n  this.password = await bcrypt.hash(this.password, salt);\n}\n`\nuser.controller.ts\n`@Patch(\":id\")\n@UseInterceptors(ClassSerializerInterceptor)\nasync update(@Param(\"id\") id: string, @Body() updateUserDto: UpdateUserDto) {\n return await this.usersService.update(+id, updateUserDto);\n}\n`\nWhat I'm doing wrong?\n`BeforeInsert` hook works or if I call `userRepository.preload()` method to update it works but it doesn't replace the relationship of the role, that's why I take this approach.\nAny ideas?",
      "solution": "Something to be aware of when using the triggers is that they might require instances of the entity to run.\n`Problem:`\n```\n`const user = await this.userRepository.findOneOrFail(id); // entity instance\nconst toSaveUser = { ...user, ...updateUserDto, roles }; // plain object\nreturn await this.userRepository.save(toSaveUser); // not running trigger\n`\n```\n`Solution:`\n```\n`const user = await this.userRepository.findOneOrFail(id); // entity instance\n// still entity instance\nconst toSaveUser = this.userRepository.create({\n  ...user,\n  ...updateUserDto,\n  roles,\n});\nreturn await this.userRepository.save(toSaveUser); // running trigger\n\n`\n```\nAnd you should be good.\nSince you are using `repository.save()` with an arbitrary object in your code, the trigger does not run. If we instead use `repository.create()` to create the instance, the trigger will now run.\nThe reason why your solution worked with `repository.preload()` is because it returns an instance. Repository api examples",
      "question_score": 7,
      "answer_score": 18,
      "created_at": "2021-05-18T17:56:40",
      "url": "https://stackoverflow.com/questions/67589835/typeorm-nestjs-beforeupdate-hook-not-working"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 71785164,
      "title": "Is it possible to have multiple local strategies in passport implemented with NestJS",
      "problem": "I have a scenario where I need to implement an authentication mechanism for admin and for normal users in my application using the Passport local strategy. I implemented the strategy for the normal users as described here. It is working perfectly fine.\nHowever, now I need to implement the same local strategy for Admin login. I feel like it would have been much easier if both the type of users(admin and normal user) are on the same entity/table because a single validate function would be capable enough to handle the case but my application design has separate entities for Admins and normal users and hence are the separate services.\nMy local strategy looks something like this:\n```\n`@Injectable()\nexport class LocalStrategy extends PassportStrategy(Strategy) {\n    constructor(private userService: UserService) {\n        super();\n    }\n\n    async validate(username: string, password: string): Promise {\n        const user = await this.userService.validateUser(username, password);\n        if (!user) {\n            throw new UnauthorizedException(\"Incorrect credentials!\");\n        }\n        return user;\n    }\n}\n`\n```\nAs I went through the documentation, it is said that a Local Strategy can have only one validate function(that works as a verify callback), if this is the case how do I differentiate a logic inside this single validate function to behave differently for the requests coming in from the normal user controller and from the admin controller? Because in the admin login case, I'll be using a different route something like(admin/login), and for the user, it could be something like(user/login).\nWhat's the best approach for this? Do I need to create a separate local strategy for admin? If yes, any hints will be appreciated. Otherwise, how can I incorporate logic inside this single validate function?\nOne of the alternatives could be checking if data exists in both the tables for every login payload each time. This approach doesn't look quite right to me.\nIf this provides more insight, the auth guard is simple as this:\n```\n`@Injectable()\nexport class LocalAuthGuard extends AuthGuard('local') { \n}\n`\n```",
      "solution": "You could make a second strategy based on `passport-local` but give it a specified name like `admin` by following the named strategies part of the docs. Something like\n`@Injectable()\nexport class LocalAdminStrategy extends PassportStrategy(Strategy, 'admin') {\n  validate(username: string, password: string) {\n    return validateAdminInfo({ username, password });\n  }\n}\n`\nAnd now you can use this strategy by using `@UseGuards(AuthGuard('admin'))` and add several strategies by giving an array of strategies names to AuthGuard like:\n```\n`@UseGuards(AuthGuard(['admin', 'user']))\n`\n```\nIf one of the strategy is passed, the route access will be accepted.",
      "question_score": 7,
      "answer_score": 16,
      "created_at": "2022-04-07T17:44:14",
      "url": "https://stackoverflow.com/questions/71785164/is-it-possible-to-have-multiple-local-strategies-in-passport-implemented-with-ne"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 69433044,
      "title": "Winston with AWS Cloudwatch on Nestjs",
      "problem": "All the articles and documentation I have read so far talk about the integration of Cloudwatch and Winston on a vanilla Node app, but nothing on Nestjs\nSo far I have on my app.module.ts:\n```\n`  imports: [\n    ConfigModule.forRoot({ isGlobal: true }),\n    MongooseModule.forRoot(\n      `mongodb://${environment.MONGO_INITDB_ROOT_USERNAME}:${environment.MONGO_INITDB_ROOT_PASSWORD}@${environment.MONGODB_HOST}/${environment.MONGO_INITDB_DATABASE}`,\n    ),\n    VoucherModule,\n    ApiKeyModule,\n    WinstonModule.forRoot(loggerConfig),\n  ],\n`\n```\nwhere loggerConfig are the basic Winston configs depending on the env.\nUsing winston-cloudwatch package I need to create a new Transporter and add it add it to winston, but can't seem to find a way to do this.",
      "solution": "I recently implemented aws-cloudwatch in nestjs and faced similar issue but after some browsing and reading about winston and cloudwatch, came up with this solution.\n```\n`//main.ts\nimport {\n  utilities as nestWinstonModuleUtilities,\n  WinstonModule,\n} from 'nest-winston';\nimport * as winston from 'winston';\nimport CloudWatchTransport from 'winston-cloudwatch';\n\nconst app = await NestFactory.create(AppModule, {\n  logger: WinstonModule.createLogger({\n    format: winston.format.uncolorize(), //Uncolorize logs as weird character encoding appears when logs are colorized in cloudwatch.\n    transports: [\n      new winston.transports.Console({\n        format: winston.format.combine(\n          winston.format.timestamp(),\n          winston.format.ms(),\n          nestWinstonModuleUtilities.format.nestLike()\n        ),\n      }),\n      new CloudWatchTransport({\n        name: \"Cloudwatch Logs\",\n        logGroupName: process.env.CLOUDWATCH_GROUP_NAME,\n        logStreamName: process.env.CLOUDWATCH_STREAM_NAME,\n        awsAccessKeyId: process.env.AWS_ACCESS_KEY,\n        awsSecretKey: process.env.AWS_KEY_SECRET,\n        awsRegion: process.env.CLOUDWATCH_AWS_REGION,\n        messageFormatter: function (item) {\n          return (\n            item.level + \": \" + item.message + \" \" + JSON.stringify(item.meta)\n          );\n        },\n      }),\n    ],\n  }),\n});\n\n`\n```\nHere, we have defined two transports one is transports.Console() which is the default winston transport and another one is the cloudwatch transport.\nWhat this basically does is, replaces the default nestjs Logger(imported from @nestjs/common). So, we don't have to import winston in any module not even in 'app.module.ts'. Instead just import Logger in whichever module you need, and whenever we log anything it will be shown in the terminal and will upload it to the cloudwatch.\nEDIT:\nWith configService..\n```\n`//main.js\nimport {\n  utilities as nestWinstonModuleUtilities,\n  WinstonModule,\n} from 'nest-winston';\nimport * as winston from 'winston';\nimport CloudWatchTransport from 'winston-cloudwatch';\nimport { ConfigService } from '@nestjs/config';\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n  const configService = app.get(ConfigService);\n\n  app.useLogger(\n    WinstonModule.createLogger({\n      format: winston.format.uncolorize(),\n      transports: [\n        new winston.transports.Console({\n          format: winston.format.combine(\n            winston.format.timestamp(),\n            winston.format.ms(),\n            nestWinstonModuleUtilities.format.nestLike(),\n          ),\n        }),\n        new CloudWatchTransport({\n          name: 'Cloudwatch Logs',\n          logGroupName: configService.get('CLOUDWATCH_GROUP_NAME'),\n          logStreamName: configService.get('CLOUDWATCH_STREAM_NAME'),\n          awsAccessKeyId: configService.get('AWS_ACCESS_KEY'),\n          awsSecretKey: configService.get('AWS_KEY_SECRET'),\n          awsRegion: configService.get('CLOUDWATCH_AWS_REGION'),\n          messageFormatter: function (item) {\n            return (\n              item.level + ': ' + item.message + ' ' + JSON.stringify(item.meta)\n            );\n          },\n        }),\n      ],\n    }),\n  );\n\n  await app.listen(configService.get('PORT') || 3000);\n}\n`\n```",
      "question_score": 7,
      "answer_score": 16,
      "created_at": "2021-10-04T10:30:44",
      "url": "https://stackoverflow.com/questions/69433044/winston-with-aws-cloudwatch-on-nestjs"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 75203608,
      "title": "Nest could not find PrismaService element (this provider does not exist in the current context)",
      "problem": "I'm trying to get PrismaService on my main.ts, but it's keep crashing. I'm new on this, can anyone help me to solve it?\nMy prisma.service.ts:\n```\n`import { INestApplication, Injectable, OnModuleInit } from '@nestjs/common';\nimport { PrismaClient } from '@prisma/client';\n\n@Injectable()\nexport class PrismaService extends PrismaClient implements OnModuleInit {\n  async onModuleInit() {\n    await this.$connect();\n  }\n\n  async enableShutdownHooks(app: INestApplication) {\n    this.$on('beforeExit', async () => {\n      await app.close();\n    });\n  }\n}\n`\n```\nMy main.ts:\n```\n`import { NestFactory } from '@nestjs/core';\nimport { AppModule } from './app.module';\nimport { PrismaService } from './prisma.service';\nimport { ValidationPipe } from '@nestjs/common';\nimport helmet from 'helmet';\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n\n  app.enableCors({\n    allowedHeaders: '*',\n    origin: '*',\n  });\n  app.use(helmet());\n  app.use(helmet.hidePoweredBy());\n  app.use(helmet.contentSecurityPolicy());\n\n  const prismaService = app.get(PrismaService);\n  await prismaService.enableShutdownHooks(app);\n\n  app.useGlobalPipes(\n    new ValidationPipe({\n      transform: true,\n      whitelist: true,\n      forbidNonWhitelisted: true,\n    }),\n  );\n\n  await app.listen(process.env.PORT, () => console.log('runing...'));\n}\nbootstrap();\n`\n```\nThe error message:\n```\n`Error: Nest could not find PrismaService element (this provider does not exist in the current context)\n    at InstanceLinksHost.get (/home/rafittu/wophi/alma/back/node_modules/@nestjs/core/injector/instance-links-host.js:15:19)\n    at NestApplication.find (/home/rafittu/wophi/alma/back/node_modules/@nestjs/core/injector/abstract-instance-resolver.js:8:60)\n    at NestApplication.get (/home/rafittu/wophi/alma/back/node_modules/@nestjs/core/nest-application-context.js:64:20)\n    at /home/rafittu/wophi/alma/back/node_modules/@nestjs/core/nest-factory.js:133:40\n    at Function.run (/home/rafittu/wophi/alma/back/node_modules/@nestjs/core/errors/exceptions-zone.js:10:13)\n    at Proxy. (/home/rafittu/wophi/alma/back/node_modules/@nestjs/core/nest-factory.js:132:46)\n    at Proxy. (/home/rafittu/wophi/alma/back/node_modules/@nestjs/core/nest-factory.js:181:54)\n    at bootstrap (/home/rafittu/wophi/alma/back/src/main.ts:18:29)\n`\n```\nWhen I delete PrismaService from main.ts, server start normaly",
      "solution": "Use `app.get(PrismaService, { strict: false })`. The `strict: false` is to say that `AppModule` doesn't directly provider the provider and to traverse the DI container to find it",
      "question_score": 7,
      "answer_score": 12,
      "created_at": "2023-01-22T21:18:12",
      "url": "https://stackoverflow.com/questions/75203608/nest-could-not-find-prismaservice-element-this-provider-does-not-exist-in-the-c"
    },
    {
      "tech": "nodejs",
      "source": "stackoverflow",
      "tag": "nestjs",
      "question_id": 73067620,
      "title": "NestJs ParseEnumPipe can&#39;t be resolve",
      "problem": "I am using the NestJs framework (love it by the way) and I want to check the incoming data so it conforms with an Enum in Typscript. So I have the following:\n```\n`enum ProductAction {\n  PURCHASE = 'PURCHASE',\n}\n\n@Patch('products/:uuid')\nasync patchProducts(\n    @Param('uuid', ParseUUIDPipe) uuid: string,\n    @Body('action', ParseEnumPipe) action: ProductAction,\n  ) {\n\n    switch(action) {\n\n    ... code \n  }\n`\n```\nThe weird thing is that when I run this code, the first pipe gets compiled\n```\n`2022-07-21 16:53:51 [error] [ExceptionHandler] Nest can't resolve dependencies of the ParseEnumPipe (?, Object). Please make sure that the argument Object at index [0] is available in the FriendsModule context.\n`\n```\nWhat I am doing wrong?",
      "solution": "You should use `@Body('action', new ParseEnumPipe(ProductAction)) action: ProductAction` because enums aren't directly reflected for Nest to read the metadata of, and because Nest is otherwise trying to figure out how to inject `Object` when it really should be injecting the enum.",
      "question_score": 7,
      "answer_score": 15,
      "created_at": "2022-07-21T16:01:09",
      "url": "https://stackoverflow.com/questions/73067620/nestjs-parseenumpipe-cant-be-resolve"
    }
  ]
}