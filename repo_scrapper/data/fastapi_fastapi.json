{
  "repo": "fastapi/fastapi",
  "scraped_at": "2026-02-03T11:58:35.326024",
  "stats": {
    "total_comments": 1869,
    "filtered": {
      "not_python": 1261,
      "too_short": 465,
      "skip_pattern:awesome": 2,
      "too_long": 4,
      "skip_pattern:thank you": 4,
      "no_diff_hunk": 1,
      "skip_pattern:nit ": 1,
      "skip_pattern:thanks!": 2
    },
    "kept": 129
  },
  "examples": [
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14619,
      "file_path": "scripts/translate.py",
      "line": 28,
      "side": "RIGHT",
      "diff_hunk": "@@ -25,650 +25,8 @@\n     \"contributing.md\",\n )\n \n-\n-general_prompt = \"\"\"\n-### About literal text in this prompt\n-\n-1) In the following instructions (after I say: `The above rules are in effect now`) the two characters `\u00ab` and `\u00bb` will be used to surround LITERAL TEXT, which is text or characters you shall interpret literally. The `\u00ab` and the `\u00bb` are not part of the literal text, they are the meta characters denoting it.\n-\n-2) Furthermore, text surrounded by `\u00ab\u00ab\u00ab` and `\u00bb\u00bb\u00bb` is a BLOCK OF LITERAL TEXT which spans multiple lines. To get its content, dedent all lines of the block until the `\u00ab\u00ab\u00ab` and `\u00bb\u00bb\u00bb` are at column zero, then remove the newline (`\\n`) after the `\u00ab\u00ab\u00ab` and the newline before the `\u00bb\u00bb\u00bb`. The `\u00ab\u00ab\u00ab` and the `\u00bb\u00bb\u00bb` are not part of the literal text block, they are the meta characters denoting it.\n-\n-3) If you see backticks or any other quotes inside literal text \u2013 inside `\u00ab` and `\u00bb` \u2013  or inside blocks of literal text \u2013 inside `\u00ab\u00ab\u00ab` and `\u00bb\u00bb\u00bb` \u2013 then interpret them as literal characters, do NOT interpret them as meta characters.\n-\n-The above rules are in effect now.\n-\n-\n-### Definitions of terms used in this prompt\n-\n-\"backtick\"\n-\n-    The character \u00ab`\u00bb\n-    Unicode U+0060 (GRAVE ACCENT)\n-\n-\"single backtick\"\n-\n-    A single backtick \u2013 \u00ab`\u00bb\n-\n-\"triple backticks\"\n-\n-    Three backticks in a row \u2013 \u00ab```\u00bb\n-\n-\"neutral double quote\"\n-\n-    The character \u00ab\"\u00bb\n-    Unicode U+0022 (QUOTATION MARK)\n-\n-\"neutral single quote\"\n-\n-    The character \u00ab'\u00bb\n-    Unicode U+0027 (APOSTROPHE)\n-\n-\"English double typographic quotes\"\n-\n-    The characters \u00ab\u201c\u00bb and \u00ab\u201d\u00bb\n-    Unicode U+201C (LEFT DOUBLE QUOTATION MARK) and Unicode U+201D (RIGHT DOUBLE QUOTATION MARK)\n-\n-\"English single typographic quotes\"\n-\n-    The characters \u00ab\u2018\u00bb and \u00ab\u2019\u00bb\n-    Unicode U+2018 (LEFT SINGLE QUOTATION MARK) and Unicode U+2019 (RIGHT SINGLE QUOTATION MARK)\n-\n-\"code snippet\"\n-\n-    Also called \"inline code\". Text in a Markdown document which is surrounded by single backticks. A paragraph in a Markdown document can have a more than one code snippet.\n-\n-    Example:\n-\n-        \u00ab\u00ab\u00ab\n-        `i am a code snippet`\n-        \u00bb\u00bb\u00bb\n-\n-    Example:\n-\n-        \u00ab\u00ab\u00ab\n-        `first code snippet` `second code snippet` `third code snippet`\n-        \u00bb\u00bb\u00bb\n-\n-\"code block\"\n-\n-    Text in a Markdown document which is surrounded by triple backticks. Spreads multiple lines.\n-\n-    Example:\n-\n-        \u00ab\u00ab\u00ab\n-        ```\n-        Hello\n-        World\n-        ```\n-        \u00bb\u00bb\u00bb\n-\n-    Example:\n-\n-        \u00ab\u00ab\u00ab\n-        ```python\n-        print(\"hello World\")\n-        ```\n-        \u00bb\u00bb\u00bb\n-\n-\"HTML element\"\n-\n-    a HTML opening tag \u2013 e.g. \u00ab<div>\u00bb \u2013 and a HTML closing tag \u2013 e.g. \u00ab</div>\u00bb \u2013 surrounding text or other HTML elements.\n-\n-\n-### Your task\n-\n-Translate an English text \u2013 the original content \u2013 to a target language.\n-\n-The original content is written in Markdown, write the translation in Markdown as well.\n-\n-The original content will be surrounded by triple percentage signs (\u00ab%%%\u00bb). Do not include the triple percentage signs in the translation.\n-\n-\n-### Technical terms in English\n-\n-For technical terms in English that don't have a common translation term, use the original term in English.\n-\n-\n-### Content of code snippets\n-\n-Do not translate the content of code snippets, keep the original in English. For example, \u00ab`list`\u00bb, \u00ab`dict`\u00bb, keep them as is.\n-\n-\n-### Content of code blocks\n-\n-Do not translate the content of code blocks, except for comments in the language which the code block uses.\n-\n-Examples:\n-\n-    Source (English) \u2013 The code block is a bash code example with one comment:\n-\n-        \u00ab\u00ab\u00ab\n-        ```bash\n-        # Print greeting\n-        echo \"Hello, World!\"\n-        ```\n-        \u00bb\u00bb\u00bb\n-\n-    Result (German):\n-\n-        \u00ab\u00ab\u00ab\n-        ```bash\n-        # Gru\u00df ausgeben\n-        echo \"Hello, World!\"\n-        ```\n-        \u00bb\u00bb\u00bb\n-\n-    Source (English) \u2013 The code block is a console example containing HTML tags. No comments, so nothing to change here:\n-\n-        \u00ab\u00ab\u00ab\n-        ```console\n-        $ <font color=\"#4E9A06\">fastapi</font> run <u style=\"text-decoration-style:solid\">main.py</u>\n-        <span style=\"background-color:#009485\"><font color=\"#D3D7CF\"> FastAPI </font></span>  Starting server\n-                Searching for package file structure\n-        ```\n-        \u00bb\u00bb\u00bb\n-\n-    Result (German):\n-\n-        \u00ab\u00ab\u00ab\n-        ```console\n-        $ <font color=\"#4E9A06\">fastapi</font> run <u style=\"text-decoration-style:solid\">main.py</u>\n-        <span style=\"background-color:#009485\"><font color=\"#D3D7CF\"> FastAPI </font></span>  Starting server\n-                Searching for package file structure\n-        ```\n-        \u00bb\u00bb\u00bb\n-\n-    Source (English) \u2013 The code block is a console example containing 5 comments:\n-\n-        \u00ab\u00ab\u00ab\n-        ```console\n-        // Go to the home directory\n-        $ cd\n-        // Create a directory for all your code projects\n-        $ mkdir code\n-        // Enter into that code directory\n-        $ cd code\n-        // Create a directory for this project\n-        $ mkdir awesome-project\n-        // Enter into that project directory\n-        $ cd awesome-project\n-        ```\n-        \u00bb\u00bb\u00bb\n-\n-    Result (German):\n-\n-        \u00ab\u00ab\u00ab\n-        ```console\n-        // Gehe zum Home-Verzeichnis\n-        $ cd\n-        // Erstelle ein Verzeichnis f\u00fcr alle Ihre Code-Projekte\n-        $ mkdir code\n-        // Gehe in dieses Code-Verzeichnis\n-        $ cd code\n-        // Erstelle ein Verzeichnis f\u00fcr dieses Projekt\n-        $ mkdir awesome-project\n-        // Gehe in dieses Projektverzeichnis\n-        $ cd awesome-project\n-        ```\n-        \u00bb\u00bb\u00bb\n-\n-If there is an existing translation and its Mermaid diagram is in sync with the Mermaid diagram in the English source, except a few translated words, then use the Mermaid diagram of the existing translation. The human editor of the translation translated these words in the Mermaid diagram. Keep these translations, do not revert them back to the English source.\n-\n-Example:\n-\n-    Source (English):\n-\n-        \u00ab\u00ab\u00ab\n-        ```mermaid\n-        flowchart LR\n-            subgraph global[global env]\n-                harry-1[harry v1]\n-            end\n-            subgraph stone-project[philosophers-stone project]\n-                stone(philosophers-stone) -->|requires| harry-1\n-            end\n-        ```\n-        \u00bb\u00bb\u00bb\n-\n-    Existing translation (German) \u2013 has three translations:\n-\n-        \u00ab\u00ab\u00ab\n-        ```mermaid\n-        flowchart LR\n-            subgraph global[globale Umgebung]\n-                harry-1[harry v1]\n-            end\n-            subgraph stone-project[philosophers-stone-Projekt]\n-                stone(philosophers-stone) -->|ben\u00f6tigt| harry-1\n-            end\n-        ```\n-        \u00bb\u00bb\u00bb\n-\n-    Result (German) \u2013 you change nothing:\n-\n-        \u00ab\u00ab\u00ab\n-        ```mermaid\n-        flowchart LR\n-            subgraph global[globale Umgebung]\n-                harry-1[harry v1]\n-            end\n-            subgraph stone-project[philosophers-stone-Projekt]\n-                stone(philosophers-stone) -->|ben\u00f6tigt| harry-1\n-            end\n-        ```\n-        \u00bb\u00bb\u00bb\n-\n-\n-### Special blocks\n-\n-There are special blocks of notes, tips and others that look like:\n-\n-    \u00ab\u00ab\u00ab\n-    /// note\n-    \u00bb\u00bb\u00bb\n-\n-To translate it, keep the same line and add the translation after a vertical bar.\n-\n-For example, if you were translating to Spanish, you would write:\n-\n-    \u00ab\u00ab\u00ab\n-    /// note | Nota\n-    \u00bb\u00bb\u00bb\n-\n-Some examples in Spanish:\n-\n-    Source:\n-\n-        \u00ab\u00ab\u00ab\n-        /// tip\n-        \u00bb\u00bb\u00bb\n-\n-    Result:\n-\n-        \u00ab\u00ab\u00ab\n-        /// tip | Consejo\n-        \u00bb\u00bb\u00bb\n-\n-    Source:\n-\n-        \u00ab\u00ab\u00ab\n-        /// details | Preview\n-        \u00bb\u00bb\u00bb\n-\n-    Result:\n-\n-        \u00ab\u00ab\u00ab\n-        /// details | Vista previa\n-        \u00bb\u00bb\u00bb\n-\n-\n-### Tab blocks\n-\n-There are special blocks surrounded by four slashes (\u00ab////\u00bb). They mark text, which will be rendered as part of a tab in the final document. The scheme is:\n-\n-    //// tab | {tab title}\n-    {tab content, may span many lines}\n-    ////\n-\n-Keep everything before the vertical bar (\u00ab|\u00bb) as is, including the vertical bar. Translate the tab title. Translate the tab content, applying the rules you know. Keep the four block closing slashes as is.\n-\n-Examples:\n-\n-    Source (English):\n-\n-        \u00ab\u00ab\u00ab\n-        //// tab | Python 3.8+ non-Annotated\n-        Hello\n-        ////\n-        \u00bb\u00bb\u00bb\n-\n-    Result (German):\n-\n-        \u00ab\u00ab\u00ab\n-        //// tab | Python 3.8+ nicht annotiert\n-        Hallo\n-        ////\n-        \u00bb\u00bb\u00bb\n-\n-    Source (English) \u2013 Here there is nothing to translate in the tab title:\n-\n-        \u00ab\u00ab\u00ab\n-        //// tab | Linux, macOS, Windows Bash\n-        Hello again\n-        ////\n-        \u00bb\u00bb\u00bb\n-\n-    Result (German):\n-\n-        \u00ab\u00ab\u00ab\n-        //// tab | Linux, macOS, Windows Bash\n-        Hallo wieder\n-        ////\n-        \u00bb\u00bb\u00bb\n-\n-\n-### Headings\n-\n-Every Markdown heading in the English text (all levels) ends with a part inside curly brackets. This part denotes the hash of this heading, which is used in links to this heading. In translations, translate the heading, but do not translate this hash part, so that links do not break.\n-\n-Examples of how to translate a heading:\n-\n-    Source (English):\n-\n-        \u00ab\u00ab\u00ab\n-        ## Alternative API docs { #alternative-api-docs }\n-        \u00bb\u00bb\u00bb\n-\n-    Result (Spanish):\n-\n-        \u00ab\u00ab\u00ab\n-        ## Documentaci\u00f3n de la API alternativa { #alternative-api-docs }\n-        \u00bb\u00bb\u00bb\n-\n-    Source (English):\n-\n-        \u00ab\u00ab\u00ab\n-        ### Example { #example }\n-        \u00bb\u00bb\u00bb\n-\n-    Result (German):\n-\n-        \u00ab\u00ab\u00ab\n-        ### Beispiel { #example }\n-        \u00bb\u00bb\u00bb\n-\n-\n-### Links\n-\n-Use the following rules for links (apply both to Markdown-style links ([text](url)) and to HTML-style <a> tags):\n-\n-1) For relative URLs, only translate link text. Do not translate the URL or its parts\n-\n-Example:\n-\n-    Source (English):\n-\n-        \u00ab\u00ab\u00ab\n-        [One of the fastest Python frameworks available](#performance)\n-        \u00bb\u00bb\u00bb\n-\n-    Result (German):\n-\n-        \u00ab\u00ab\u00ab\n-        [Eines der schnellsten verf\u00fcgbaren Python-Frameworks](#performance)\n-        \u00bb\u00bb\u00bb\n-\n-2) For absolute URLs which DO NOT start EXACTLY with \u00abhttps://fastapi.tiangolo.com\u00bb, only translate link text and leave the URL unchanged.\n-\n-Example:\n-\n-    Source (English):\n-\n-        \u00ab\u00ab\u00ab\n-        <a href=\"https://sqlmodel.tiangolo.com/\" class=\"external-link\" target=\"_blank\">SQLModel docs</a>\n-        \u00bb\u00bb\u00bb\n-\n-    Result (German):\n-\n-        \u00ab\u00ab\u00ab\n-        <a href=\"https://sqlmodel.tiangolo.com/\" class=\"external-link\" target=\"_blank\">SQLModel-Dokumentation</a>\n-        \u00bb\u00bb\u00bb\n-\n-3) For absolute URLs which DO start EXACTLY with \u00abhttps://fastapi.tiangolo.com\u00bb, only translate link text and change the URL by adding language code (\u00abhttps://fastapi.tiangolo.com/{language_code}[rest part of the url]\u00bb).\n-\n-Example:\n-\n-    Source (English):\n-\n-        \u00ab\u00ab\u00ab\n-        <a href=\"https://fastapi.tiangolo.com/tutorial/path-params/#documentation\" class=\"external-link\" target=\"_blank\">Documentation</a>\n-        \u00bb\u00bb\u00bb\n-\n-    Result (Spanish):\n-\n-        \u00ab\u00ab\u00ab\n-        <a href=\"https://fastapi.tiangolo.com/es/tutorial/path-params/#documentation\" class=\"external-link\" target=\"_blank\">Documentaci\u00f3n</a>\n-        \u00bb\u00bb\u00bb\n-\n-3.1) Do not add language codes for URLs that point to static assets (e.g., images, CSS, JavaScript).\n-\n-Example:\n-\n-    Source (English):\n-\n-        \u00ab\u00ab\u00ab\n-        <a href=\"https://fastapi.tiangolo.com/img/something.jpg\" class=\"external-link\" target=\"_blank\">Something</a>\n-        \u00bb\u00bb\u00bb\n-\n-    Result (Spanish):\n-\n-        \u00ab\u00ab\u00ab\n-        <a href=\"https://fastapi.tiangolo.com/img/something.jpg\" class=\"external-link\" target=\"_blank\">Algo</a>\n-        \u00bb\u00bb\u00bb\n-\n-4) For internal links, only translate link text.\n-\n-Example:\n-\n-    Source (English):\n-\n-        \u00ab\u00ab\u00ab\n-        [Create Pull Requests](help-fastapi.md#create-a-pull-request){.internal-link target=_blank}\n-        \u00bb\u00bb\u00bb\n-\n-    Result (German):\n-\n-        \u00ab\u00ab\u00ab\n-        [Pull Requests erzeugen](help-fastapi.md#create-a-pull-request){.internal-link target=_blank}\n-        \u00bb\u00bb\u00bb\n-\n-5) Do not translate anchor fragments in links (the part after \u00ab#\u00bb), as they must remain the same to work correctly.\n-\n-5.1) If an existing translation has a link with an anchor fragment different to the anchor fragment in the English source, then this is an error. Fix this by using the anchor fragment of the English source.\n-\n-Example:\n-\n-    Source (English):\n-\n-        \u00ab\u00ab\u00ab\n-        [Body - Multiple Parameters: Singular values in body](body-multiple-params.md#singular-values-in-body){.internal-link target=_blank}\n-        \u00bb\u00bb\u00bb\n-\n-    Existing wrong translation (German) \u2013 notice the wrongly translated anchor fragment:\n-\n-        \u00ab\u00ab\u00ab\n-        [Body \u2013 Mehrere Parameter: Einfache Werte im Body](body-multiple-params.md#einzelne-werte-im-body){.internal-link target=_blank}.\n-        \u00bb\u00bb\u00bb\n-\n-    Result (German) \u2013 you fix the anchor fragment:\n-\n-        \u00ab\u00ab\u00ab\n-        [Body \u2013 Mehrere Parameter: Einfache Werte im Body](body-multiple-params.md#singular-values-in-body){.internal-link target=_blank}.\n-        \u00bb\u00bb\u00bb\n-\n-5.2) Do not add anchor fragments at will, even if this makes sense. If the English source has no anchor, don't add one.\n-\n-Example:\n-\n-    Source (English):\n-\n-        \u00ab\u00ab\u00ab\n-        Create a [virtual environment](../virtual-environments.md){.internal-link target=_blank}\n-        \u00bb\u00bb\u00bb\n-\n-    Wrong translation (German) \u2013 Anchor added to the URL.\n-\n-        \u00ab\u00ab\u00ab\n-        Erstelle eine [virtuelle Umgebung](../virtual-environments.md#create-a-virtual-environment){.internal-link target=_blank}\n-        \u00bb\u00bb\u00bb\n-\n-    Good translation (German) \u2013 URL stays like in the English source.\n-\n-        \u00ab\u00ab\u00ab\n-        Erstelle eine [Virtuelle Umgebung](../virtual-environments.md){.internal-link target=_blank}\n-        \u00bb\u00bb\u00bb\n-\n-\n-### HTML abbr elements\n-\n-Translate HTML abbr elements (\u00ab<abbr title=\"description\">text</abbr>\u00bb) as follows:\n-\n-1) If the text surrounded by the abbr element is an abbreviation (the text may be surrounded by further HTML or Markdown markup or quotes, for example \u00ab<code>text</code>\u00bb or \u00ab`text`\u00bb or \u00ab\"text\"\u00bb, ignore that further markup when deciding if the text is an abbreviation), and if the description (the text inside the title attribute) contains the full phrase for this abbreviation, then append a dash (\u00ab\u2013\u00bb) to the full phrase, followed by the translation of the full phrase.\n-\n-Conversion scheme:\n-\n-    Source (English):\n-\n-        <abbr title=\"{full phrase}\">{abbreviation}</abbr>\n-\n-    Result:\n-\n-        <abbr title=\"{full phrase} \u2013 {translation of full phrase}\">{abbreviation}</abbr>\n-\n-Examples:\n-\n-    Source (English):\n-\n-        \u00ab\u00ab\u00ab\n-        <abbr title=\"Internet of Things\">IoT</abbr>\n-        <abbr title=\"Central Processing Unit\">CPU</abbr>\n-        <abbr title=\"too long; didn't read\"><strong>TL;DR:</strong></abbr>\n-        \u00bb\u00bb\u00bb\n-\n-    Result (German):\n-\n-        \u00ab\u00ab\u00ab\n-        <abbr title=\"Internet of Things \u2013 Internet der Dinge\">IoT</abbr>\n-        <abbr title=\"Central Processing Unit \u2013 Zentrale Verarbeitungseinheit\">CPU</abbr>\n-        <abbr title=\"too long; didn't read \u2013 zu lang; hab's nicht gelesen\"><strong>TL;DR:</strong></abbr>\n-        \u00bb\u00bb\u00bb\n-\n-1.1) If the language to which you translate mostly uses the letters of the ASCII char set (for example Spanish, French, German, but not Russian, Chinese) and if the translation of the full phrase is identical to, or starts with the same letters as the original full phrase, then only give the translation of the full phrase.\n-\n-Conversion scheme:\n-\n-    Source (English):\n-\n-        <abbr title=\"{full phrase}\">{abbreviation}</abbr>\n-\n-    Result:\n-\n-        <abbr title=\"{translation of full phrase}\">{abbreviation}</abbr>\n-\n-Examples:\n-\n-    Source (English):\n-\n-        \u00ab\u00ab\u00ab\n-        <abbr title=\"JSON Web Tokens\">JWT</abbr>\n-        <abbr title=\"Enumeration\">Enum</abbr>\n-        <abbr title=\"Asynchronous Server Gateway Interface\">ASGI</abbr>\n-        \u00bb\u00bb\u00bb\n-\n-    Result (German):\n-\n-        \u00ab\u00ab\u00ab\n-        <abbr title=\"JSON Web Tokens\">JWT</abbr>\n-        <abbr title=\"Enumeration\">Enum</abbr>\n-        <abbr title=\"Asynchrones Server-Gateway-Interface\">ASGI</abbr>\n-        \u00bb\u00bb\u00bb\n-\n-2) If the description is not a full phrase for an abbreviation which the abbr element surrounds, but some other information, then just translate the description.\n-\n-Conversion scheme:\n-\n-    Source (English):\n-\n-        <abbr title=\"{description}\">{text}</abbr>\n-\n-    Result:\n-\n-        <abbr title=\"{translation of description}\">{translation of text}</abbr>\n-\n-Examples:\n-\n-    Source (English):\n-\n-        \u00ab\u00ab\u00ab\n-        <abbr title=\"also known as: endpoints, routes\">path</abbr>\n-        <abbr title=\"a program that checks for code errors\">linter</abbr>\n-        <abbr title=\"converting the string that comes from an HTTP request into Python data\">parsing</abbr>\n-        <abbr title=\"before 2023-03\">0.95.0</abbr>\n-        <abbr title=\"2023-08-26\">at the time of writing this</abbr>\n-        \u00bb\u00bb\u00bb\n-\n-    Result (German):\n-\n-        \u00ab\u00ab\u00ab\n-        <abbr title=\"auch bekannt als: Endpunkte, Routen\">Pfad</abbr>\n-        <abbr title=\"Programm das auf Fehler im Code pr\u00fcft\">Linter</abbr>\n-        <abbr title=\"Konvertieren des Strings eines HTTP-Requests in Python-Daten\">Parsen</abbr>\n-        <abbr title=\"vor 2023-03\">0.95.0</abbr>\n-        <abbr title=\"2023-08-26\">zum Zeitpunkt als das hier geschrieben wurde</abbr>\n-        \u00bb\u00bb\u00bb\n-\n-\n-3) If the text surrounded by the abbr element is an abbreviation and the description contains both the full phrase for that abbreviation, and other information, separated by a colon (\u00ab:\u00bb), then append a dash (\u00ab\u2013\u00bb) and the translation of the full phrase to the original full phrase and translate the other information.\n-\n-Conversion scheme:\n-\n-    Source (English):\n-\n-        <abbr title=\"{full phrase}: {other information}\">{abbreviation}</abbr>\n-\n-    Result:\n-\n-        <abbr title=\"{full phrase} \u2013 {translation of full phrase}: {translation of other information}\">{abbreviation}</abbr>\n-\n-Examples:\n-\n-    Source (English):\n-\n-        \u00ab\u00ab\u00ab\n-        <abbr title=\"Input/Output: disk reading or writing, network communication.\">I/O</abbr>\n-        <abbr title=\"Content Delivery Network: service, that provides static files.\">CDN</abbr>\n-        <abbr title=\"Integrated Development Environment: similar to a code editor\">IDE</abbr>\n-        \u00bb\u00bb\u00bb\n-\n-    Result (German):\n-\n-        \u00ab\u00ab\u00ab\n-        <abbr title=\"Input/Output \u2013 Eingabe/Ausgabe: Lesen oder Schreiben auf der Festplatte, Netzwerkkommunikation.\">I/O</abbr>\n-        <abbr title=\"Content Delivery Network \u2013 Inhalte auslieferndes Netzwerk: Dienst, der statische Dateien bereitstellt.\">CDN</abbr>\n-        <abbr title=\"Integrated Development Environment \u2013 Integrierte Entwicklungsumgebung: \u00c4hnlich einem Code-Editor\">IDE</abbr>\n-        \u00bb\u00bb\u00bb\n-\n-3.1) Like in rule 2.1, you can leave the original full phrase away, if the translated full phrase is identical or starts with the same letters as the original full phrase.\n-\n-Conversion scheme:\n-\n-    Source (English):\n-\n-        <abbr title=\"{full phrase}: {information}\">{abbreviation}</abbr>\n-\n-    Result:\n-\n-        <abbr title=\"{translation of full phrase}: {translation of information}\">{abbreviation}</abbr>\n-\n-Example:\n-\n-    Source (English):\n-\n-        \u00ab\u00ab\u00ab\n-        <abbr title=\"Object Relational Mapper: a fancy term for a library where some classes represent SQL tables and instances represent rows in those tables\">ORM</abbr>\n-        \u00bb\u00bb\u00bb\n-\n-    Result (German):\n-\n-        \u00ab\u00ab\u00ab\n-        <abbr title=\"Objektrelationaler Mapper: Ein Fachbegriff f\u00fcr eine Bibliothek, in der einige Klassen SQL-Tabellen und Instanzen Zeilen in diesen Tabellen darstellen\">ORM</abbr>\n-        \u00bb\u00bb\u00bb\n-\n-4) If there is an existing translation, and it has ADDITIONAL abbr elements in a sentence, and these additional abbr elements do not exist in the related sentence in the English text, then KEEP those additional abbr elements in the translation. Do not remove them. Except when you remove the whole sentence from the translation, because the whole sentence was removed from the English text, then also remove the abbr element. The reasoning for this rule is, that such additional abbr elements are manually added by the human editor of the translation, in order to translate or explain an English word to the human readers of the translation. These additional abbr elements would not make sense in the English text, but they do make sense in the translation. So keep them in the translation, even though they are not part of the English text. This rule only applies to abbr elements.\n-\n-5) Apply above rules also when there is an existing translation! Make sure that all title attributes in abbr elements get properly translated or updated, using the schemes given above. However, leave the ADDITIONAL abbr's from rule 4 alone. Do not change their formatting or content.\n-\n-\"\"\"\n+general_prompt_path = Path(__file__).absolute().parent / \"llm-general-prompt.md\"",
      "comment": "There appears to be a typo. The filename should be `general-llm-prompt.md`.",
      "comment_id": 2676767606,
      "user": "DoctorJohn",
      "created_at": "2026-01-09T16:10:39Z",
      "url": "https://github.com/fastapi/fastapi/pull/14619#discussion_r2676767606"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14371,
      "file_path": "fastapi/params.py",
      "line": 118,
      "side": "RIGHT",
      "diff_hunk": "@@ -115,6 +115,10 @@ def __init__(\n         else:\n             kwargs[\"deprecated\"] = deprecated\n         if PYDANTIC_V2:\n+            if serialization_alias in (_Unset, None) and isinstance(alias, str):",
      "comment": "This is how it's done in Pydantic's Field: https://github.com/pydantic/pydantic/blob/407934af10962473d8db0b8c693393cad3975eda/pydantic/fields.py#L1346-L1350",
      "comment_id": 2541006268,
      "user": "YuriiMotov",
      "created_at": "2025-11-19T08:24:57Z",
      "url": "https://github.com/fastapi/fastapi/pull/14371#discussion_r2541006268"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14371,
      "file_path": "fastapi/dependencies/utils.py",
      "line": 1024,
      "side": "RIGHT",
      "diff_hunk": "@@ -1021,3 +1019,8 @@ def get_body_field(\n         field_info=BodyFieldInfo(**BodyFieldInfo_kwargs),\n     )\n     return final_field\n+\n+\n+def get_validation_alias(field: ModelField) -> str:",
      "comment": "It's fine like this for now, we'll soon remove support for Pydantic v1 and will be able to refactor this.",
      "comment_id": 2614498979,
      "user": "tiangolo",
      "created_at": "2025-12-12T14:56:32Z",
      "url": "https://github.com/fastapi/fastapi/pull/14371#discussion_r2614498979"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 797,
      "file_path": "fastapi/security/oauth2.py",
      "line": 191,
      "side": "RIGHT",
      "diff_hunk": "@@ -163,6 +163,45 @@ def __init__(\n         return param\n \n \n+class OAuth2AuthorizationCodeBearer(OAuth2):\n+    def __init__(\n+        self,\n+        authorizationUrl: str,\n+        tokenUrl: str,\n+        refreshUrl: str = None,\n+        scopes: dict = None,\n+        scheme_name: str = None,\n+        auto_error: bool = True,\n+    ):\n+        if not scopes:\n+            scopes = {}\n+        flows = OAuthFlowsModel(\n+            authorizationCode={\n+                \"authorizationUrl\": authorizationUrl,\n+                \"tokenUrl\": tokenUrl,\n+                \"refreshUrl\": refreshUrl,\n+                \"scopes\": scopes,\n+            })\n+        super().__init__(\n+            flows=flows, scheme_name=scheme_name, auto_error=auto_error\n+        )\n+\n+    async def __call__(self, request: Request) -> Optional[str]:\n+        authorization: str = request.headers.get(\"Authorization\")\n+        print(authorization)",
      "comment": "Presumably you didn't mean to keep this print statement there?",
      "comment_id": 359139146,
      "user": "dmontagu",
      "created_at": "2019-12-18T03:39:53Z",
      "url": "https://github.com/fastapi/fastapi/pull/797#discussion_r359139146"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14575,
      "file_path": "fastapi/routing.py",
      "line": 155,
      "side": "RIGHT",
      "diff_hunk": "@@ -153,16 +152,16 @@ def _prepare_response_content(\n     exclude_defaults: bool = False,\n     exclude_none: bool = False,\n ) -> Any:\n-    if isinstance(res, BaseModel):\n-        read_with_orm_mode = getattr(_get_model_config(res), \"read_with_orm_mode\", None)\n+    if isinstance(res, may_v1.BaseModel):",
      "comment": "This isn't quite the same. It causes v2 models to never be dumped to dicts, causing round-trips to error when using FastAPI with some other magical libraries that are quite popular.\r\n\r\nIt caused the regression described in https://github.com/fastapi/fastapi/pull/14575#issuecomment-3678630709.\r\n\r\nIn this particular case:\r\n- Cadwyn deeply copies the model class `ConnectionResponse` internally\r\n- The response from the endpoint is no longer a dict, but an instance of the original class `ConnectionResponse`\r\n- The validation fails because pydantic doesn't validate an instance of the copied class, but an instance of the original `ConnectionResponse` (but Cadwyn replaced type adapter's type with the copied class!)\r\n\r\n@tiangolo, was this intended to start dumping v1 models *only*, without v2 models, in `_prepare_response_content` since this change?",
      "comment_id": 2637871247,
      "user": "johnslavik",
      "created_at": "2025-12-21T14:49:04Z",
      "url": "https://github.com/fastapi/fastapi/pull/14575#discussion_r2637871247"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13505,
      "file_path": "tests/test_tutorial/test_settings/test_tutorial001.py",
      "line": 21,
      "side": "RIGHT",
      "diff_hunk": "@@ -1,14 +1,30 @@\n+import importlib\n+\n+import pytest\n from fastapi.testclient import TestClient\n from pytest import MonkeyPatch\n \n-from ...utils import needs_pydanticv2\n+from ...utils import needs_pydanticv1, needs_pydanticv2\n+\n+\n+@pytest.fixture(\n+    params=[\n+        pytest.param(\"tutorial001\", marks=needs_pydanticv2),\n+        pytest.param(\"tutorial001_pv1\", marks=needs_pydanticv1),\n+    ],\n+)\n+def get_app(request: pytest.FixtureRequest):\n+    def app_wrapper():\n+        mod = importlib.import_module(f\"docs_src.settings.{request.param}\")\n+        return mod.app\n+\n+    return app_wrapper",
      "comment": "I think that it is better to monkeypatch `get_app()`, instead of test_settings:\r\n\r\n```python\r\n\r\n@pytest.fixture(\r\n    name=\"app\",\r\n    params=[\r\n        pytest.param(\"tutorial001\", marks=needs_pydanticv2),\r\n        pytest.param(\"tutorial001_pv1\", marks=needs_pydanticv1),\r\n    ],\r\n)\r\ndef get_app(request: pytest.FixtureRequest, monkeypatch: MonkeyPatch):\r\n    monkeypatch.setenv(\"ADMIN_EMAIL\", \"admin@example.com\")\r\n    mod = importlib.import_module(f\"docs_src.settings.{request.param}\")\r\n    return mod.app\r\n\r\n\r\ndef test_settings(app):\r\n    client = TestClient(app)\r\n    response = client.get(\"/info\")\r\n    assert response.status_code == 200, response.text\r\n    assert response.json() == {\r\n        \"app_name\": \"Awesome API\",\r\n        \"admin_email\": \"admin@example.com\",\r\n        \"items_per_user\": 50,\r\n    }\r\n\r\n```",
      "comment_id": 2005481524,
      "user": "alv2017",
      "created_at": "2025-03-20T12:05:13Z",
      "url": "https://github.com/fastapi/fastapi/pull/13505#discussion_r2005481524"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14358,
      "file_path": "tests/test_request_params/test_file/test_list.py",
      "line": 60,
      "side": "RIGHT",
      "diff_hunk": "@@ -0,0 +1,845 @@\n+from typing import List\n+\n+import pytest\n+from dirty_equals import IsDict, IsOneOf, IsPartialDict\n+from fastapi import FastAPI, File, Form, UploadFile\n+from fastapi._compat import PYDANTIC_V2\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+from typing_extensions import Annotated\n+\n+from tests.utils import needs_pydanticv2\n+\n+from .utils import get_body_model_name\n+\n+app = FastAPI()\n+\n+# =====================================================================================\n+# Without aliases\n+\n+\n+@app.post(\"/list-bytes\", operation_id=\"list_bytes\")\n+async def read_list_bytes(p: Annotated[List[bytes], File()]):\n+    return {\"file_size\": [len(file) for file in p]}\n+\n+\n+@app.post(\"/list-uploadfile\", operation_id=\"list_uploadfile\")\n+async def read_list_uploadfile(p: Annotated[List[UploadFile], File()]):\n+    return {\"file_size\": [file.size for file in p]}\n+\n+\n+class FormModelListBytes(BaseModel):\n+    p: List[bytes] = File()\n+\n+\n+@app.post(\"/model-list-bytes\", operation_id=\"model_list_bytes\")\n+async def read_model_list_bytes(\n+    p: Annotated[\n+        FormModelListBytes,\n+        Form(\n+            media_type=\"multipart/form-data\"  # Remove media_type when https://github.com/fastapi/fastapi/pull/14343 is fixed\n+        ),\n+    ],\n+):\n+    return {\"file_size\": [len(file) for file in p.p]}\n+\n+\n+class FormModelListUploadFile(BaseModel):\n+    p: List[UploadFile] = File()\n+\n+\n+@app.post(\"/model-list-uploadfile\", operation_id=\"model_list_uploadfile\")\n+async def read_model_list_uploadfile(\n+    p: Annotated[\n+        FormModelListUploadFile,\n+        Form(\n+            media_type=\"multipart/form-data\"  # Remove media_type when https://github.com/fastapi/fastapi/pull/14343 is fixed\n+        ),\n+    ],\n+):\n+    return {\"file_size\": [file.size for file in p.p]}",
      "comment": "Let's remove these. Pydantic models with fields that should be read from bytes are not supported in FastAPI, at least not yet, and I'm not sure if it would make sense supporting it. Currently it's not supported to use a different function to declare a field in a Pydantic model other than `Field()` (at least not intentionally), I would prefer to avoid that for now.",
      "comment_id": 2607250726,
      "user": "tiangolo",
      "created_at": "2025-12-10T15:59:09Z",
      "url": "https://github.com/fastapi/fastapi/pull/14358#discussion_r2607250726"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 11355,
      "file_path": "fastapi/dependencies/utils.py",
      "line": 198,
      "side": "RIGHT",
      "diff_hunk": "@@ -191,7 +192,10 @@ def get_flat_params(dependant: Dependant) -> List[ModelField]:\n \n \n def get_typed_signature(call: Callable[..., Any]) -> inspect.Signature:\n-    signature = inspect.signature(call)\n+    if sys.version_info >= (3, 10):\n+        signature = inspect.signature(call, eval_str=True)\n+    else:\n+        signature = inspect.signature(call)",
      "comment": "This change makes [jupyverse](https://github.com/jupyter-server/jupyverse) crash with:\n```\nNameError: name 'NoAuthStrategy' is not defined\n```\nWhich doesn't make sense to me, because `NoAuthStrategy` is defined [here](https://github.com/jupyter-server/jupyverse/blob/785564bee44fc340fb51ff078a8ca22783adcf3d/plugins/auth/src/fps_auth/backends.py#L67) and used in the same file.\nThere is also [fastapi-users](https://github.com/fastapi-users/fastapi-users) involved, so I'm pinging @frankie567 here but I don't think there's anything wrong there.",
      "comment_id": 2592995490,
      "user": "davidbrochart",
      "created_at": "2025-12-05T15:02:40Z",
      "url": "https://github.com/fastapi/fastapi/pull/11355#discussion_r2592995490"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 11355,
      "file_path": "fastapi/dependencies/utils.py",
      "line": 198,
      "side": "RIGHT",
      "diff_hunk": "@@ -191,7 +192,10 @@ def get_flat_params(dependant: Dependant) -> List[ModelField]:\n \n \n def get_typed_signature(call: Callable[..., Any]) -> inspect.Signature:\n-    signature = inspect.signature(call)\n+    if sys.version_info >= (3, 10):\n+        signature = inspect.signature(call, eval_str=True)\n+    else:\n+        signature = inspect.signature(call)",
      "comment": "Can you please share the full stacktrace and a reproducer script and how to run it?",
      "comment_id": 2593013316,
      "user": "tirkarthi",
      "created_at": "2025-12-05T15:08:21Z",
      "url": "https://github.com/fastapi/fastapi/pull/11355#discussion_r2593013316"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 11355,
      "file_path": "fastapi/dependencies/utils.py",
      "line": 198,
      "side": "RIGHT",
      "diff_hunk": "@@ -191,7 +192,10 @@ def get_flat_params(dependant: Dependant) -> List[ModelField]:\n \n \n def get_typed_signature(call: Callable[..., Any]) -> inspect.Signature:\n-    signature = inspect.signature(call)\n+    if sys.version_info >= (3, 10):\n+        signature = inspect.signature(call, eval_str=True)\n+    else:\n+        signature = inspect.signature(call)",
      "comment": "Removing `from __future__ import annotations` in this file seems to solve the issue.",
      "comment_id": 2593060054,
      "user": "davidbrochart",
      "created_at": "2025-12-05T15:22:03Z",
      "url": "https://github.com/fastapi/fastapi/pull/11355#discussion_r2593060054"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 11355,
      "file_path": "fastapi/dependencies/utils.py",
      "line": 198,
      "side": "RIGHT",
      "diff_hunk": "@@ -191,7 +192,10 @@ def get_flat_params(dependant: Dependant) -> List[ModelField]:\n \n \n def get_typed_signature(call: Callable[..., Any]) -> inspect.Signature:\n-    signature = inspect.signature(call)\n+    if sys.version_info >= (3, 10):\n+        signature = inspect.signature(call, eval_str=True)\n+    else:\n+        signature = inspect.signature(call)",
      "comment": "https://github.com/fastapi/fastapi/discussions/14464",
      "comment_id": 2593734061,
      "user": "edgarrmondragon",
      "created_at": "2025-12-05T19:22:26Z",
      "url": "https://github.com/fastapi/fastapi/pull/11355#discussion_r2593734061"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14434,
      "file_path": "fastapi/routing.py",
      "line": 83,
      "side": "RIGHT",
      "diff_hunk": "@@ -80,9 +80,9 @@\n from typing_extensions import Annotated, deprecated\n \n if sys.version_info >= (3, 13):  # pragma: no cover\n-    from inspect import iscoroutinefunction\n+    pass",
      "comment": "Good catch! This was pre-commit and I didn't notice it. Thanks!",
      "comment_id": 2582016616,
      "user": "tiangolo",
      "created_at": "2025-12-02T16:44:04Z",
      "url": "https://github.com/fastapi/fastapi/pull/14434#discussion_r2582016616"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 9753,
      "file_path": "fastapi/dependencies/utils.py",
      "line": 535,
      "side": "RIGHT",
      "diff_hunk": "@@ -528,24 +529,28 @@ def add_param_to_fields(*, field: ModelField, dependant: Dependant) -> None:\n \n \n def is_coroutine_callable(call: Callable[..., Any]) -> bool:\n-    if inspect.isroutine(call):\n-        return inspect.iscoroutinefunction(call)\n-    if inspect.isclass(call):\n-        return False\n+    if inspect.iscoroutinefunction(call):\n+        return True\n+    if isinstance(call, partial):\n+        return is_coroutine_callable(call.func)",
      "comment": "```suggestion\r\n    if inspect.isclass(call):\r\n        return False\r\n    if isinstance(call, partial):\r\n        return is_coroutine_callable(call.func)\r\n```\r\nWhy do we need to remove this condition (`isclass`)?\r\nI just tried running tests with these lines and it still works.\r\nI think if it's not necessary for making partial work, we shouldn't remove this lines in this PR",
      "comment_id": 2192922090,
      "user": "YuriiMotov",
      "created_at": "2025-07-08T16:11:16Z",
      "url": "https://github.com/fastapi/fastapi/pull/9753#discussion_r2192922090"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 9753,
      "file_path": "fastapi/dependencies/models.py",
      "line": 82,
      "side": "RIGHT",
      "diff_hunk": "@@ -53,25 +53,34 @@ def cache_key(self) -> DependencyCacheKey:\n \n     @cached_property\n     def is_gen_callable(self) -> bool:\n-        if inspect.isgeneratorfunction(self.call):\n+        use_call: Any = self.call\n+        if isinstance(self.call, partial):\n+            use_call = self.call.func\n+        if inspect.isgeneratorfunction(use_call):\n             return True\n-        dunder_call = getattr(self.call, \"__call__\", None)  # noqa: B004\n+        dunder_call = getattr(use_call, \"__call__\", None)  # noqa: B004\n         return inspect.isgeneratorfunction(dunder_call)\n \n     @cached_property\n     def is_async_gen_callable(self) -> bool:\n-        if inspect.isasyncgenfunction(self.call):\n+        use_call: Any = self.call\n+        if isinstance(self.call, partial):\n+            use_call = self.call.func\n+        if inspect.isasyncgenfunction(use_call):\n             return True\n-        dunder_call = getattr(self.call, \"__call__\", None)  # noqa: B004\n+        dunder_call = getattr(use_call, \"__call__\", None)  # noqa: B004\n         return inspect.isasyncgenfunction(dunder_call)\n \n     @cached_property\n     def is_coroutine_callable(self) -> bool:\n-        if inspect.isroutine(self.call):\n-            return iscoroutinefunction(self.call)\n-        if inspect.isclass(self.call):\n+        use_call: Any = self.call\n+        if isinstance(self.call, partial):\n+            use_call = self.call.func\n+        if inspect.isroutine(use_call):\n+            return iscoroutinefunction(use_call)\n+        if inspect.isclass(use_call):\n             return False",
      "comment": "In the initial version of this PR it was suggested to change these lines to something like:\r\n```diff\r\n-        if inspect.isroutine(use_call):\r\n-            return inspect.iscoroutinefunction(use_call)\r\n+        if inspect.iscoroutinefunction(use_call):\r\n+            return True\r\n-        if inspect.isclass(use_call):\r\n-            return False\r\n```\r\n\r\nSee original commit: https://github.com/fastapi/fastapi/pull/9753/commits/f16dd38b478c0a88ae4ae79fd73094fdb3ffa425\r\n\r\nI updated it to be closer to current implementation (don't simplify first condition and don't remove `if inspect.isclass(use_call):`)",
      "comment_id": 2493781785,
      "user": "YuriiMotov",
      "created_at": "2025-11-05T10:00:22Z",
      "url": "https://github.com/fastapi/fastapi/pull/9753#discussion_r2493781785"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 5077,
      "file_path": "fastapi/dependencies/utils.py",
      "line": 253,
      "side": "RIGHT",
      "diff_hunk": "@@ -245,7 +245,13 @@ def is_scalar_sequence_field(field: ModelField) -> bool:\n \n def get_typed_signature(call: Callable[..., Any]) -> inspect.Signature:\n     signature = inspect.signature(call)\n-    globalns = getattr(call, \"__globals__\", {})\n+    nsobj = call\n+    while hasattr(nsobj, \"__wrapped__\"):\n+        # The __wrapped__ attribute is set by decorators, e.g. functools.wraps.\n+        # This while loop allows rereferencing forward references on decorated\n+        # methods.\n+        nsobj = nsobj.__wrapped__  # type: ignore",
      "comment": "It can be simplified using `inspect.unwrap`:\r\n```suggestion\r\n    nsobj = inspect.unwrap(call)\r\n```",
      "comment_id": 906798942,
      "user": "uriyyo",
      "created_at": "2022-06-26T11:25:15Z",
      "url": "https://github.com/fastapi/fastapi/pull/5077#discussion_r906798942"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 5077,
      "file_path": "fastapi/dependencies/utils.py",
      "line": 253,
      "side": "RIGHT",
      "diff_hunk": "@@ -245,7 +245,13 @@ def is_scalar_sequence_field(field: ModelField) -> bool:\n \n def get_typed_signature(call: Callable[..., Any]) -> inspect.Signature:\n     signature = inspect.signature(call)\n-    globalns = getattr(call, \"__globals__\", {})\n+    nsobj = call\n+    while hasattr(nsobj, \"__wrapped__\"):\n+        # The __wrapped__ attribute is set by decorators, e.g. functools.wraps.\n+        # This while loop allows rereferencing forward references on decorated\n+        # methods.\n+        nsobj = nsobj.__wrapped__  # type: ignore",
      "comment": "Looks like that was added in python 3.4 and the earliest supported version of python for FastAPI is 3.6, so sure. It also checks for cycles (which `typing.get_type_hints` does not).",
      "comment_id": 906853334,
      "user": "lucaswiman",
      "created_at": "2022-06-26T18:06:47Z",
      "url": "https://github.com/fastapi/fastapi/pull/5077#discussion_r906853334"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13207,
      "file_path": "fastapi/_compat.py",
      "line": 267,
      "side": "RIGHT",
      "diff_hunk": "@@ -238,6 +235,59 @@ def get_definitions(\n                 item_def[\"description\"] = item_description\n         return field_mapping, definitions  # type: ignore[return-value]\n \n+    def get_definitions(\n+        *,\n+        fields: List[ModelField],\n+        schema_generator: GenerateJsonSchema,\n+        model_name_map: ModelNameMap,\n+        separate_input_output_schemas: bool = True,\n+    ) -> Tuple[\n+        Dict[\n+            Tuple[ModelField, Literal[\"validation\", \"serialization\"]], JsonSchemaValue\n+        ],\n+        Dict[str, Dict[str, Any]],\n+    ]:\n+        if separate_input_output_schemas:\n+            # No override mode\n+            return _get_definitions_with_override_mode(\n+                fields=fields,\n+                schema_generator=schema_generator,\n+                override_mode=None,\n+            )\n+\n+        # Set override to 'validation' as baseline\n+        field_mapping, base_definitions = _get_definitions_with_override_mode(\n+            fields=fields,\n+            schema_generator=schema_generator,\n+            override_mode=\"validation\",\n+        )\n+\n+        # Set override to 'serialization' to be able to add computed fields to the output\n+        # Create a new schema generator as it can't be reused\n+        schema_generator_2 = GenerateJsonSchema(ref_template=REF_TEMPLATE)",
      "comment": "Not too happy with this solution, perhaps we should copy the given `schema_generator` instead?",
      "comment_id": 2288512317,
      "user": "svlandeg",
      "created_at": "2025-08-20T15:17:41Z",
      "url": "https://github.com/fastapi/fastapi/pull/13207#discussion_r2288512317"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13537,
      "file_path": "tests/test_form_default.py",
      "line": 19,
      "side": "RIGHT",
      "diff_hunk": "@@ -0,0 +1,47 @@\n+from typing import Optional\n+\n+from fastapi import FastAPI, File, Form\n+from starlette.testclient import TestClient\n+from typing_extensions import Annotated\n+\n+app = FastAPI()\n+client = TestClient(app)\n+\n+\n+@app.post(\"/urlencoded\")\n+async def post_url_encoded(age: Annotated[Optional[int], Form()] = None):\n+    return age\n+\n+\n+def test_form_default_url_encoded():\n+    response = client.post(\"/urlencoded\", data={\"age\": \"\"})\n+    assert response.status_code == 200\n+    assert response.text == \"null\"",
      "comment": "This looks odd to me.\r\nIf you pass a string to an integer field, I would expect a `4xx` error code.",
      "comment_id": 2076095083,
      "user": "PidgeyBE",
      "created_at": "2025-05-06T19:11:16Z",
      "url": "https://github.com/fastapi/fastapi/pull/13537#discussion_r2076095083"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13537,
      "file_path": "tests/test_form_default.py",
      "line": 19,
      "side": "RIGHT",
      "diff_hunk": "@@ -0,0 +1,47 @@\n+from typing import Optional\n+\n+from fastapi import FastAPI, File, Form\n+from starlette.testclient import TestClient\n+from typing_extensions import Annotated\n+\n+app = FastAPI()\n+client = TestClient(app)\n+\n+\n+@app.post(\"/urlencoded\")\n+async def post_url_encoded(age: Annotated[Optional[int], Form()] = None):\n+    return age\n+\n+\n+def test_form_default_url_encoded():\n+    response = client.post(\"/urlencoded\", data={\"age\": \"\"})\n+    assert response.status_code == 200\n+    assert response.text == \"null\"",
      "comment": "This is a form POST and empty numeric inputs would be submitted as empty strings. IMO it's reasonable that they are accepted and treated like *no value* (`None` / `null`) when the field is an optional integer.",
      "comment_id": 2079233102,
      "user": "schneebuzz",
      "created_at": "2025-05-08T09:02:21Z",
      "url": "https://github.com/fastapi/fastapi/pull/13537#discussion_r2079233102"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 12935,
      "file_path": "fastapi/encoders.py",
      "line": 53,
      "side": "RIGHT",
      "diff_hunk": "@@ -48,8 +48,12 @@ def decimal_encoder(dec_value: Decimal) -> Union[int, float]:\n \n     >>> decimal_encoder(Decimal(\"1\"))\n     1\n+    \n+    >>> decimal_encoder(Decimal(\"NaN\"))\n+    nan",
      "comment": "The docstring example should show the actual float NaN output format. In Python, `float('nan')` displays as `nan` but the docstring should clarify this is a float value, not a string.\n```suggestion\n    nan  # float\n```",
      "comment_id": 2342890747,
      "user": "Copilot",
      "created_at": "2025-09-12T04:05:41Z",
      "url": "https://github.com/fastapi/fastapi/pull/12935#discussion_r2342890747"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 5624,
      "file_path": "fastapi/dependencies/utils.py",
      "line": 134,
      "side": "RIGHT",
      "diff_hunk": "@@ -131,7 +131,7 @@ def get_parameterless_sub_dependant(*, depends: params.Depends, path: str) -> De\n     )\n     use_security_scopes: List[str] = []\n     if isinstance(depends, params.Security) and depends.scopes:\n-        use_security_scopes.extend(depends.scopes)\n+        use_security_scopes = use_security_scopes + list(depends.scopes)",
      "comment": "revert \r\n```suggestion\r\n        use_security_scopes.extend(depends.scopes)\r\n```",
      "comment_id": 2481833287,
      "user": "svlandeg",
      "created_at": "2025-10-31T15:35:23Z",
      "url": "https://github.com/fastapi/fastapi/pull/5624#discussion_r2481833287"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14033,
      "file_path": "scripts/docs.py",
      "line": 33,
      "side": "RIGHT",
      "diff_hunk": "@@ -27,7 +29,7 @@\n {!../../docs/missing-translation.md!}\n \"\"\"\n \n-non_translated_sections = [\n+non_translated_sections = (\n     \"reference/\",",
      "comment": "To be OS agnostic:\r\n```suggestion\r\n    \"reference\",\r\n```\r\nassuming we have no \"normal\" pages starting with \"reference\" (I don't think that's a real issue)",
      "comment_id": 2371531886,
      "user": "svlandeg",
      "created_at": "2025-09-23T08:14:49Z",
      "url": "https://github.com/fastapi/fastapi/pull/14033#discussion_r2371531886"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14033,
      "file_path": "scripts/docs.py",
      "line": 33,
      "side": "RIGHT",
      "diff_hunk": "@@ -27,7 +29,7 @@\n {!../../docs/missing-translation.md!}\n \"\"\"\n \n-non_translated_sections = [\n+non_translated_sections = (\n     \"reference/\",",
      "comment": "> Why is that we exclude the reference directory?\r\n\r\nI guess that's because it's generated from sources? If we decided to translate it, we would need to update all translations every time code changes..\r\n\r\nAs for slash in the end - good catch!\r\nBut instead of removing it, I would go with `f\"reference{os.sep}\",`",
      "comment_id": 2371616410,
      "user": "YuriiMotov",
      "created_at": "2025-09-23T08:50:57Z",
      "url": "https://github.com/fastapi/fastapi/pull/14033#discussion_r2371616410"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14033,
      "file_path": "scripts/docs.py",
      "line": 33,
      "side": "RIGHT",
      "diff_hunk": "@@ -27,7 +29,7 @@\n {!../../docs/missing-translation.md!}\n \"\"\"\n \n-non_translated_sections = [\n+non_translated_sections = (\n     \"reference/\",",
      "comment": "Looked at code and realized that there are a lot of other occurrences of hardcoded `/`.\r\nSo, we need to decide whether we want to refactor it in this PR on in separate PR?",
      "comment_id": 2371631610,
      "user": "YuriiMotov",
      "created_at": "2025-09-23T08:57:02Z",
      "url": "https://github.com/fastapi/fastapi/pull/14033#discussion_r2371631610"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14033,
      "file_path": "scripts/docs.py",
      "line": 33,
      "side": "RIGHT",
      "diff_hunk": "@@ -27,7 +29,7 @@\n {!../../docs/missing-translation.md!}\n \"\"\"\n \n-non_translated_sections = [\n+non_translated_sections = (\n     \"reference/\",",
      "comment": "I suggest we (only) update the hardcoded slashes of the new code that is contributed with this PR. Because when I run this new script on my Windows machine, it starts generating permalinks for the `reference` docs and we don't want to do deal with any PRs of users that get the same thing.\r\n\r\nWith respect to hardcoded slashes already in the current code base: let's edit those in a separate PR.",
      "comment_id": 2371748044,
      "user": "svlandeg",
      "created_at": "2025-09-23T09:45:15Z",
      "url": "https://github.com/fastapi/fastapi/pull/14033#discussion_r2371748044"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14033,
      "file_path": "scripts/docs.py",
      "line": 33,
      "side": "RIGHT",
      "diff_hunk": "@@ -27,7 +29,7 @@\n {!../../docs/missing-translation.md!}\n \"\"\"\n \n-non_translated_sections = [\n+non_translated_sections = (\n     \"reference/\",",
      "comment": "> But instead of removing it, I would go with f\"reference{os.sep}\",\r\n\r\nThat's fine too by me!",
      "comment_id": 2371749205,
      "user": "svlandeg",
      "created_at": "2025-09-23T09:45:45Z",
      "url": "https://github.com/fastapi/fastapi/pull/14033#discussion_r2371749205"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14186,
      "file_path": "fastapi/_compat/may_v1.py",
      "line": 6,
      "side": "RIGHT",
      "diff_hunk": "@@ -0,0 +1,123 @@\n+import sys\n+from typing import Any, Dict, List, Literal, Sequence, Tuple, Type, Union\n+\n+from fastapi.types import ModelNameMap\n+\n+if sys.version_info >= (3, 14):",
      "comment": "Probably better to check directly for Pydantic 2.12.0+ ?\r\n\r\nThen again, Pydantic themselves say \r\n\r\n> The core functionality of Pydantic V1 is not compatible with Python 3.14 or greater.",
      "comment_id": 2432655612,
      "user": "svlandeg",
      "created_at": "2025-10-15T13:52:08Z",
      "url": "https://github.com/fastapi/fastapi/pull/14186#discussion_r2432655612"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14036,
      "file_path": "fastapi/_compat.py",
      "line": 117,
      "side": "RIGHT",
      "diff_hunk": "@@ -109,9 +110,24 @@ def type_(self) -> Any:\n             return self.field_info.annotation\n \n         def __post_init__(self) -> None:\n-            self._type_adapter: TypeAdapter[Any] = TypeAdapter(\n-                Annotated[self.field_info.annotation, self.field_info]\n-            )\n+            with warnings.catch_warnings():\n+                # Pydantic >= 2.12.0a1 warns about this when building\n+                # TypeAdapters from field information that uses aliases.\n+                # The Pydantic team recommends ignoring this in this case:\n+                # https://github.com/fastapi/fastapi/pull/14036#issuecomment-3316045587",
      "comment": "```suggestion\r\n                # Pydantic >= 2.12.0 warns about field specific metadata that is unused\r\n                # (e.g. `TypeAdapter(Annotated[int, Field(alias='b')])`). In some cases, we\r\n                # end up building the type adapter from a model field annotation so we\r\n                # need to ignore the warning:",
      "comment_id": 2369192894,
      "user": "Viicos",
      "created_at": "2025-09-22T16:05:41Z",
      "url": "https://github.com/fastapi/fastapi/pull/14036#discussion_r2369192894"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14036,
      "file_path": "fastapi/_compat.py",
      "line": 130,
      "side": "RIGHT",
      "diff_hunk": "@@ -109,9 +110,24 @@ def type_(self) -> Any:\n             return self.field_info.annotation\n \n         def __post_init__(self) -> None:\n-            self._type_adapter: TypeAdapter[Any] = TypeAdapter(\n-                Annotated[self.field_info.annotation, self.field_info]\n-            )\n+            with warnings.catch_warnings():\n+                # Pydantic >= 2.12.0a1 warns about this when building\n+                # TypeAdapters from field information that uses aliases.\n+                # The Pydantic team recommends ignoring this in this case:\n+                # https://github.com/fastapi/fastapi/pull/14036#issuecomment-3316045587\n+                try:\n+                    from pydantic.warnings import (  # type: ignore[attr-defined]\n+                        UnsupportedFieldAttributeWarning,\n+                    )\n+                except ImportError:  # pragma: no cover\n+                    pass\n+                else:  # pragma: no cover\n+                    warnings.simplefilter(\n+                        \"ignore\", category=UnsupportedFieldAttributeWarning\n+                    )\n+                self._type_adapter: TypeAdapter[Any] = TypeAdapter(\n+                    Annotated[self.field_info.annotation, self.field_info]\n+                )",
      "comment": "- I believe you need to use the `catch_warnings` context manager, because as it stands the warning will always be ignored from now on.\r\n- I would suggest using an explicit version check on the `pydantic` version instead of a `try..except` statement, so that it can easily be unconditionally imported once FastAPI drops support for Pydantic < 2.12.",
      "comment_id": 2369201471,
      "user": "Viicos",
      "created_at": "2025-09-22T16:07:36Z",
      "url": "https://github.com/fastapi/fastapi/pull/14036#discussion_r2369201471"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14036,
      "file_path": "tests/test_multi_body_errors.py",
      "line": 189,
      "side": "RIGHT",
      "diff_hunk": "@@ -185,7 +185,15 @@ def test_openapi_schema():\n                                 \"title\": \"Age\",\n                                 \"anyOf\": [\n                                     {\"exclusiveMinimum\": 0.0, \"type\": \"number\"},\n-                                    {\"type\": \"string\"},\n+                                    IsOneOf(\n+                                        # pydantic < 2.12.0a1",
      "comment": "```suggestion\r\n                                        # pydantic < 2.12.0\r\n```",
      "comment_id": 2369202655,
      "user": "Viicos",
      "created_at": "2025-09-22T16:07:49Z",
      "url": "https://github.com/fastapi/fastapi/pull/14036#discussion_r2369202655"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14036,
      "file_path": "tests/test_multi_body_errors.py",
      "line": 191,
      "side": "RIGHT",
      "diff_hunk": "@@ -185,7 +185,15 @@ def test_openapi_schema():\n                                 \"title\": \"Age\",\n                                 \"anyOf\": [\n                                     {\"exclusiveMinimum\": 0.0, \"type\": \"number\"},\n-                                    {\"type\": \"string\"},\n+                                    IsOneOf(\n+                                        # pydantic < 2.12.0a1\n+                                        {\"type\": \"string\"},\n+                                        # pydantic >= 2.12.0a1",
      "comment": "```suggestion\r\n                                        # pydantic >= 2.12.0\r\n```",
      "comment_id": 2369203300,
      "user": "Viicos",
      "created_at": "2025-09-22T16:07:58Z",
      "url": "https://github.com/fastapi/fastapi/pull/14036#discussion_r2369203300"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14036,
      "file_path": "fastapi/_compat.py",
      "line": 130,
      "side": "RIGHT",
      "diff_hunk": "@@ -109,9 +110,24 @@ def type_(self) -> Any:\n             return self.field_info.annotation\n \n         def __post_init__(self) -> None:\n-            self._type_adapter: TypeAdapter[Any] = TypeAdapter(\n-                Annotated[self.field_info.annotation, self.field_info]\n-            )\n+            with warnings.catch_warnings():\n+                # Pydantic >= 2.12.0a1 warns about this when building\n+                # TypeAdapters from field information that uses aliases.\n+                # The Pydantic team recommends ignoring this in this case:\n+                # https://github.com/fastapi/fastapi/pull/14036#issuecomment-3316045587\n+                try:\n+                    from pydantic.warnings import (  # type: ignore[attr-defined]\n+                        UnsupportedFieldAttributeWarning,\n+                    )\n+                except ImportError:  # pragma: no cover\n+                    pass\n+                else:  # pragma: no cover\n+                    warnings.simplefilter(\n+                        \"ignore\", category=UnsupportedFieldAttributeWarning\n+                    )\n+                self._type_adapter: TypeAdapter[Any] = TypeAdapter(\n+                    Annotated[self.field_info.annotation, self.field_info]\n+                )",
      "comment": "I'm already using the `catch_warnings` context manager just above, so I'm confused about your first point.\r\n\r\nI've made your suggested second change.",
      "comment_id": 2378822890,
      "user": "cjwatson",
      "created_at": "2025-09-25T11:49:02Z",
      "url": "https://github.com/fastapi/fastapi/pull/14036#discussion_r2378822890"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14036,
      "file_path": "fastapi/_compat.py",
      "line": 118,
      "side": "RIGHT",
      "diff_hunk": "@@ -109,9 +110,22 @@ def type_(self) -> Any:\n             return self.field_info.annotation\n \n         def __post_init__(self) -> None:\n-            self._type_adapter: TypeAdapter[Any] = TypeAdapter(\n-                Annotated[self.field_info.annotation, self.field_info]\n-            )\n+            with warnings.catch_warnings():\n+                # Pydantic >= 2.12.0 warns about field specific metadata that is unused\n+                # (e.g. `TypeAdapter(Annotated[int, Field(alias='b')])`). In some cases, we\n+                # end up building the type adapter from a model field annotation so we\n+                # need to ignore the warning:\n+                if PYDANTIC_VERSION_MINOR_TUPLE >= (2, 12):  # pragma: no cover",
      "comment": "Once Pydantic 2.12 is released, we'll be able to remove the `no cover` statement here.",
      "comment_id": 2410097108,
      "user": "svlandeg",
      "created_at": "2025-10-07T10:04:18Z",
      "url": "https://github.com/fastapi/fastapi/pull/14036#discussion_r2410097108"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14036,
      "file_path": "fastapi/_compat.py",
      "line": 123,
      "side": "RIGHT",
      "diff_hunk": "@@ -109,9 +110,22 @@ def type_(self) -> Any:\n             return self.field_info.annotation\n \n         def __post_init__(self) -> None:\n-            self._type_adapter: TypeAdapter[Any] = TypeAdapter(\n-                Annotated[self.field_info.annotation, self.field_info]\n-            )\n+            with warnings.catch_warnings():\n+                # Pydantic >= 2.12.0 warns about field specific metadata that is unused\n+                # (e.g. `TypeAdapter(Annotated[int, Field(alias='b')])`). In some cases, we\n+                # end up building the type adapter from a model field annotation so we\n+                # need to ignore the warning:\n+                if PYDANTIC_VERSION_MINOR_TUPLE >= (2, 12):  # pragma: no cover\n+                    from pydantic.warnings import (  # type: ignore[attr-defined]\n+                        UnsupportedFieldAttributeWarning,\n+                    )\n+\n+                    warnings.simplefilter(",
      "comment": "This is still incorrect, as per my first point [here](https://github.com/fastapi/fastapi/pull/14036#discussion_r2369201471).",
      "comment_id": 2410098702,
      "user": "Viicos",
      "created_at": "2025-10-07T10:04:56Z",
      "url": "https://github.com/fastapi/fastapi/pull/14036#discussion_r2410098702"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14036,
      "file_path": "fastapi/_compat.py",
      "line": 118,
      "side": "RIGHT",
      "diff_hunk": "@@ -109,9 +110,22 @@ def type_(self) -> Any:\n             return self.field_info.annotation\n \n         def __post_init__(self) -> None:\n-            self._type_adapter: TypeAdapter[Any] = TypeAdapter(\n-                Annotated[self.field_info.annotation, self.field_info]\n-            )\n+            with warnings.catch_warnings():\n+                # Pydantic >= 2.12.0 warns about field specific metadata that is unused\n+                # (e.g. `TypeAdapter(Annotated[int, Field(alias='b')])`). In some cases, we\n+                # end up building the type adapter from a model field annotation so we\n+                # need to ignore the warning:\n+                if PYDANTIC_VERSION_MINOR_TUPLE >= (2, 12):  # pragma: no cover",
      "comment": "(I know, but we have a bit of a chicken-or-egg situation going on here \ud83d\ude09)",
      "comment_id": 2410125638,
      "user": "svlandeg",
      "created_at": "2025-10-07T10:14:55Z",
      "url": "https://github.com/fastapi/fastapi/pull/14036#discussion_r2410125638"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14036,
      "file_path": "fastapi/_compat.py",
      "line": 118,
      "side": "RIGHT",
      "diff_hunk": "@@ -109,9 +110,22 @@ def type_(self) -> Any:\n             return self.field_info.annotation\n \n         def __post_init__(self) -> None:\n-            self._type_adapter: TypeAdapter[Any] = TypeAdapter(\n-                Annotated[self.field_info.annotation, self.field_info]\n-            )\n+            with warnings.catch_warnings():\n+                # Pydantic >= 2.12.0 warns about field specific metadata that is unused\n+                # (e.g. `TypeAdapter(Annotated[int, Field(alias='b')])`). In some cases, we\n+                # end up building the type adapter from a model field annotation so we\n+                # need to ignore the warning:\n+                if PYDANTIC_VERSION_MINOR_TUPLE >= (2, 12):  # pragma: no cover",
      "comment": "Yeah no worries, just wanted to give you a release estimate!",
      "comment_id": 2410138271,
      "user": "Viicos",
      "created_at": "2025-10-07T10:19:31Z",
      "url": "https://github.com/fastapi/fastapi/pull/14036#discussion_r2410138271"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14036,
      "file_path": "fastapi/_compat.py",
      "line": 123,
      "side": "RIGHT",
      "diff_hunk": "@@ -109,9 +110,22 @@ def type_(self) -> Any:\n             return self.field_info.annotation\n \n         def __post_init__(self) -> None:\n-            self._type_adapter: TypeAdapter[Any] = TypeAdapter(\n-                Annotated[self.field_info.annotation, self.field_info]\n-            )\n+            with warnings.catch_warnings():\n+                # Pydantic >= 2.12.0 warns about field specific metadata that is unused\n+                # (e.g. `TypeAdapter(Annotated[int, Field(alias='b')])`). In some cases, we\n+                # end up building the type adapter from a model field annotation so we\n+                # need to ignore the warning:\n+                if PYDANTIC_VERSION_MINOR_TUPLE >= (2, 12):  # pragma: no cover\n+                    from pydantic.warnings import (  # type: ignore[attr-defined]\n+                        UnsupportedFieldAttributeWarning,\n+                    )\n+\n+                    warnings.simplefilter(",
      "comment": "Hi @Viicos, thanks for the additional review! \ud83d\ude4f \r\n\r\nCan you elaborate on your point?\r\n\r\nThe current code uses `warnings.simplefilter` within a `with warnings.catch_warnings()` context manager. It is my understanding that, once the context manager exits, after L128, the warnings filter is restored to its original state when the context was entered (L113) ?",
      "comment_id": 2410162259,
      "user": "svlandeg",
      "created_at": "2025-10-07T10:28:15Z",
      "url": "https://github.com/fastapi/fastapi/pull/14036#discussion_r2410162259"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14036,
      "file_path": "fastapi/_compat.py",
      "line": 123,
      "side": "RIGHT",
      "diff_hunk": "@@ -109,9 +110,22 @@ def type_(self) -> Any:\n             return self.field_info.annotation\n \n         def __post_init__(self) -> None:\n-            self._type_adapter: TypeAdapter[Any] = TypeAdapter(\n-                Annotated[self.field_info.annotation, self.field_info]\n-            )\n+            with warnings.catch_warnings():\n+                # Pydantic >= 2.12.0 warns about field specific metadata that is unused\n+                # (e.g. `TypeAdapter(Annotated[int, Field(alias='b')])`). In some cases, we\n+                # end up building the type adapter from a model field annotation so we\n+                # need to ignore the warning:\n+                if PYDANTIC_VERSION_MINOR_TUPLE >= (2, 12):  # pragma: no cover\n+                    from pydantic.warnings import (  # type: ignore[attr-defined]\n+                        UnsupportedFieldAttributeWarning,\n+                    )\n+\n+                    warnings.simplefilter(",
      "comment": "My bad, I always get confused by this `warnings` API, as the context manager isn't opened right on top of the filter. All good!",
      "comment_id": 2410177447,
      "user": "Viicos",
      "created_at": "2025-10-07T10:34:50Z",
      "url": "https://github.com/fastapi/fastapi/pull/14036#discussion_r2410177447"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 11194,
      "file_path": "tests/test_request_form_multiple_files.py",
      "line": 1,
      "side": "RIGHT",
      "diff_hunk": "@@ -0,0 +1,175 @@\n+from typing import Annotated",
      "comment": "```suggestion\r\nfrom typing_extensions import Annotated\r\n```",
      "comment_id": 1501844755,
      "user": "YuriiMotov",
      "created_at": "2024-02-25T15:35:49Z",
      "url": "https://github.com/fastapi/fastapi/pull/11194#discussion_r1501844755"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 11194,
      "file_path": "tests/test_request_form_file.py",
      "line": 1,
      "side": "RIGHT",
      "diff_hunk": "@@ -0,0 +1,139 @@\n+from typing import Annotated",
      "comment": "```suggestion\r\nfrom typing_extensions import Annotated\r\n```",
      "comment_id": 1501844886,
      "user": "YuriiMotov",
      "created_at": "2024-02-25T15:36:50Z",
      "url": "https://github.com/fastapi/fastapi/pull/11194#discussion_r1501844886"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 11194,
      "file_path": "tests/test_request_form_file.py",
      "line": 100,
      "side": "RIGHT",
      "diff_hunk": "@@ -0,0 +1,139 @@\n+from typing import Annotated\n+\n+from fastapi import FastAPI, File, Form\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/files/\")\n+async def create_file(token: Annotated[str, Form()], file: Annotated[bytes, File()]):\n+    return {\n+        \"file_size\": len(file),\n+        \"token\": token,\n+    }\n+\n+\n+client = TestClient(app)\n+\n+openapi_schema = {\n+    \"openapi\": \"3.1.0\",\n+    \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+    \"paths\": {\n+        \"/files/\": {\n+            \"post\": {\n+                \"summary\": \"Create File\",\n+                \"operationId\": \"create_file_files__post\",\n+                \"requestBody\": {\n+                    \"content\": {\n+                        \"multipart/form-data\": {\n+                            \"schema\": {\n+                                \"$ref\": \"#/components/schemas/Body_create_file_files__post\"\n+                            }\n+                        }\n+                    },\n+                    \"required\": True,\n+                },\n+                \"responses\": {\n+                    \"200\": {\n+                        \"description\": \"Successful Response\",\n+                        \"content\": {\"application/json\": {\"schema\": {}}},\n+                    },\n+                    \"422\": {\n+                        \"description\": \"Validation Error\",\n+                        \"content\": {\n+                            \"application/json\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/HTTPValidationError\"\n+                                }\n+                            }\n+                        },\n+                    },\n+                },\n+            }\n+        }\n+    },\n+    \"components\": {\n+        \"schemas\": {\n+            \"Body_create_file_files__post\": {\n+                \"title\": \"Body_create_file_files__post\",\n+                \"required\": [\"token\", \"file\"],\n+                \"type\": \"object\",\n+                \"properties\": {\n+                    \"token\": {\"title\": \"Token\", \"type\": \"string\"},\n+                    \"file\": {\"title\": \"File\", \"type\": \"string\", \"format\": \"binary\"},\n+                },\n+            },\n+            \"HTTPValidationError\": {\n+                \"title\": \"HTTPValidationError\",\n+                \"type\": \"object\",\n+                \"properties\": {\n+                    \"detail\": {\n+                        \"title\": \"Detail\",\n+                        \"type\": \"array\",\n+                        \"items\": {\"$ref\": \"#/components/schemas/ValidationError\"},\n+                    }\n+                },\n+            },\n+            \"ValidationError\": {\n+                \"title\": \"ValidationError\",\n+                \"required\": [\"loc\", \"msg\", \"type\"],\n+                \"type\": \"object\",\n+                \"properties\": {\n+                    \"loc\": {\n+                        \"title\": \"Location\",\n+                        \"type\": \"array\",\n+                        \"items\": {\"anyOf\": [{\"type\": \"string\"}, {\"type\": \"integer\"}]},\n+                    },\n+                    \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n+                    \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+                },\n+            },\n+        }\n+    },\n+}\n+\n+\n+def test_openapi_schema():\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == openapi_schema",
      "comment": "```suggestion\r\nbody_create_file_files__post = {\r\n    \"title\": \"Body_create_file_files__post\",\r\n    \"required\": [\"token\", \"file\"],\r\n    \"type\": \"object\",\r\n    \"properties\": {\r\n        \"token\": {\"title\": \"Token\", \"type\": \"string\"},\r\n        \"file\": {\"title\": \"File\", \"type\": \"string\", \"format\": \"binary\"},\r\n    },\r\n}\r\n\r\n\r\ndef test_openapi_schema():\r\n    response = client.get(\"/openapi.json\")\r\n    assert response.status_code == 200, response.text\r\n    json_response = response.json()\r\n    assert (\r\n        json_response[\"components\"][\"schemas\"][\"Body_create_file_files__post\"]\r\n        == body_create_file_files__post\r\n    )\r\n```\r\nWe can make it more readable",
      "comment_id": 1501846593,
      "user": "YuriiMotov",
      "created_at": "2024-02-25T15:46:53Z",
      "url": "https://github.com/fastapi/fastapi/pull/11194#discussion_r1501846593"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14015,
      "file_path": "scripts/translate.py",
      "line": 512,
      "side": "RIGHT",
      "diff_hunk": "@@ -22,55 +24,642 @@\n     \"contributing.md\",\n )\n \n-\n general_prompt = \"\"\"\n-For technical terms in English that don't have a common translation term use the original term in English.\n+### About literal text in this prompt\n+\n+1) In the following instructions (after I say: `The above rules are in effect now`) the two characters `\u00ab` and `\u00bb` will be used to surround LITERAL TEXT, which is text or characters you shall interpret literally. The `\u00ab` and the `\u00bb` are not part of the literal text, they are the meta characters denoting it.\n+\n+2) Furthermore, text surrounded by `\u00ab\u00ab\u00ab` and `\u00bb\u00bb\u00bb` is a BLOCK OF LITERAL TEXT which spans multiple lines. To get its content, dedent all lines of the block until the `\u00ab\u00ab\u00ab` and `\u00bb\u00bb\u00bb` are at column zero, then remove the newline (`\\n`) after the `\u00ab\u00ab\u00ab` and the newline before the `\u00bb\u00bb\u00bb`. The `\u00ab\u00ab\u00ab` and the `\u00bb\u00bb\u00bb` are not part of the literal text block, they are the meta characters denoting it.\n+\n+3) If you see backticks inside literal text \u2013 inside `\u00ab` and `\u00bb` \u2013  or inside blocks of literal text \u2013 inside `\u00ab\u00ab\u00ab` and `\u00bb\u00bb\u00bb` \u2013 then interpret them as literal characters, do NOT interpret them as meta characters.\n+\n+The above rules are in effect now.\n+\n+\n+### Definitions of terms used in this prompt\n+\n+\"backtick\"\n+\n+    The character \u00ab`\u00bb\n+    Unicode U+0060 (GRAVE ACCENT)\n+\n+\"single backtick\"\n+\n+    A single backtick \u2013 \u00ab`\u00bb\n+\n+\"triple backticks\"\n+\n+    Three backticks in a row \u2013 \u00ab```\u00bb\n+\n+\"neutral double quote\"\n+\n+    The character \u00ab\"\u00bb\n+    Unicode U+0022 (QUOTATION MARK)\n+\n+\"neutral single quote\"\n+\n+    The character \u00ab'\u00bb\n+    Unicode U+0027 (APOSTROPHE)\n+\n+\"English double typographic quotes\"\n+\n+    The characters \u00ab\u201c\u00bb and \u00ab\u201d\u00bb\n+    Unicode U+201C (LEFT DOUBLE QUOTATION MARK) and Unicode U+201D (RIGHT DOUBLE QUOTATION MARK)\n+\n+\"English single typographic quotes\"\n+\n+    The characters \u00ab\u2018\u00bb and \u00ab\u2019\u00bb\n+    Unicode U+2018 (LEFT SINGLE QUOTATION MARK) and Unicode U+2019 (RIGHT SINGLE QUOTATION MARK)\n+\n+\"code snippet\"\n+\n+    Also called \"inline code\". Text in a Markdown document which is surrounded by single backticks. A paragraph in a markdown document can have a more than one code snippets.\n+\n+    Example:\n+\n+        \u00ab\u00ab\u00ab\n+        `i am a code snippet`\n+        \u00bb\u00bb\u00bb\n+\n+    Example:\n+\n+        \u00ab\u00ab\u00ab\n+        `first code snippet` `second code snippet` `third code snippet`\n+        \u00bb\u00bb\u00bb\n+\n+\"code block\"\n+\n+    Text in a Markdown document which is surrounded by triple backticks. Spreads multiple lines.\n+\n+    Example:\n+\n+        \u00ab\u00ab\u00ab\n+        ```\n+        Hello\n+        World\n+        ```\n+        \u00bb\u00bb\u00bb\n+\n+    Example:\n+\n+        \u00ab\u00ab\u00ab\n+        ```python\n+        print(\"hello World\")\n+        ```\n+        \u00bb\u00bb\u00bb\n+\n+\n+### Your task\n+\n+Translate an English text \u2013 the original content \u2013 to a target language.\n+\n+The original content is written in Markdown, write the translation in Markdown as well.\n+\n+The original content will be surrounded by triple percentage signs (\u00ab%%%\u00bb). Do not include the triple percentage signs in the translation.\n+\n+\n+### Technical terms in English\n+\n+For technical terms in English that don't have a common translation term, use the original term in English.\n+\n+\n+### Content of code snippets\n+\n+Do not translate the content of code snippets, keep the original in English. For example, \u00ab`list`\u00bb, \u00ab`dict`\u00bb, keep them as is.\n+\n+\n+### Content of code blocks\n+\n+Do not translate the content of code blocks, except for comments in the language which the code block uses.\n+\n+Examples:\n+\n+    Source (English) \u2013 The code block is a bash code example with one comment:\n+\n+        \u00ab\u00ab\u00ab\n+        ```bash\n+        # Print greeting\n+        echo \"Hello, World!\"\n+        ```\n+        \u00bb\u00bb\u00bb\n \n-If you have instructions to translate specific terms or phrases in a specific way, please follow those instructions instead of keeping the old and outdated content.\n+    Result (German):\n \n-For code snippets or fragments, surrounded by backticks (`), don't translate the content, keep the original in English. For example, `list`, `dict`, keep them as is.\n+        \u00ab\u00ab\u00ab\n+        ```bash\n+        # Gru\u00df ausgeben\n+        echo \"Hello, World!\"\n+        ```\n+        \u00bb\u00bb\u00bb\n \n-The content is written in markdown, write the translation in markdown as well. Don't add triple backticks (`) around the generated translation content.\n+    Source (English) \u2013 The code block is a console example containing HTML tags. No comments, so nothing to change here:\n \n-When there's an example of code, the console or a terminal, normally surrounded by triple backticks and a keyword like \"console\" or \"bash\" (e.g. ```console), do not translate the content, keep the original in English.\n+        \u00ab\u00ab\u00ab\n+        ```console\n+        $ <font color=\"#4E9A06\">fastapi</font> run <u style=\"text-decoration-style:solid\">main.py</u>\n+        <span style=\"background-color:#009485\"><font color=\"#D3D7CF\"> FastAPI </font></span>  Starting server\n+                Searching for package file structure\n+        ```\n+        \u00bb\u00bb\u00bb\n \n-The original content will be surrounded by triple percentage signs (%) and you should translate it to the target language. Do not include the triple percentage signs in the translation.\n+    Result (German):\n+\n+        \u00ab\u00ab\u00ab\n+        ```console\n+        $ <font color=\"#4E9A06\">fastapi</font> run <u style=\"text-decoration-style:solid\">main.py</u>\n+        <span style=\"background-color:#009485\"><font color=\"#D3D7CF\"> FastAPI </font></span>  Starting server\n+                Searching for package file structure\n+        ```\n+        \u00bb\u00bb\u00bb\n+\n+    Source (English) \u2013 The code block is a console example containing 5 comments:\n+\n+        \u00ab\u00ab\u00ab\n+        ```console\n+        // Go to the home directory\n+        $ cd\n+        // Create a directory for all your code projects\n+        $ mkdir code\n+        // Enter into that code directory\n+        $ cd code\n+        // Create a directory for this project\n+        $ mkdir awesome-project\n+        // Enter into that project directory\n+        $ cd awesome-project\n+        ```\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German):\n+\n+        \u00ab\u00ab\u00ab\n+        ```console\n+        // Gehe zum Home-Verzeichnis\n+        $ cd\n+        // Erstelle ein Verzeichnis f\u00fcr alle Ihre Code-Projekte\n+        $ mkdir code\n+        // Gehe in dieses Code-Verzeichnis\n+        $ cd code\n+        // Erstelle ein Verzeichnis f\u00fcr dieses Projekt\n+        $ mkdir awesome-project\n+        // Gehe in dieses Projektverzeichnis\n+        $ cd awesome-project\n+        ```\n+        \u00bb\u00bb\u00bb\n+\n+If there is an existing translation and its Mermaid diagram is in sync with the Mermaid diagram in the English source, except a few translated words, then use the Mermaid diagram of the existing translation. The human editor of the translation translated these words in the Mermaid diagram. Keep these translations, do not revert them back to the English source.\n+\n+Example:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        ```mermaid\n+        flowchart LR\n+            subgraph global[global env]\n+                harry-1[harry v1]\n+            end\n+            subgraph stone-project[philosophers-stone project]\n+                stone(philosophers-stone) -->|requires| harry-1\n+            end\n+        ```\n+        \u00bb\u00bb\u00bb\n+\n+    Existing translation (German) \u2013 has three translations:\n+\n+        \u00ab\u00ab\u00ab\n+        ```mermaid\n+        flowchart LR\n+            subgraph global[globale Umgebung]\n+                harry-1[harry v1]\n+            end\n+            subgraph stone-project[philosophers-stone-Projekt]\n+                stone(philosophers-stone) -->|ben\u00f6tigt| harry-1\n+            end\n+        ```\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German) \u2013 you change nothing:\n+\n+        \u00ab\u00ab\u00ab\n+        ```mermaid\n+        flowchart LR\n+            subgraph global[globale Umgebung]\n+                harry-1[harry v1]\n+            end\n+            subgraph stone-project[philosophers-stone-Projekt]\n+                stone(philosophers-stone) -->|ben\u00f6tigt| harry-1\n+            end\n+        ```\n+        \u00bb\u00bb\u00bb\n+\n+\n+### Special blocks\n \n There are special blocks of notes, tips and others that look like:\n \n-/// note\n+    \u00ab\u00ab\u00ab\n+    /// note\n+    \u00bb\u00bb\u00bb\n \n To translate it, keep the same line and add the translation after a vertical bar.\n \n For example, if you were translating to Spanish, you would write:\n \n-/// note | Nota\n+    \u00ab\u00ab\u00ab\n+    /// note | Nota\n+    \u00bb\u00bb\u00bb\n \n Some examples in Spanish:\n \n-Source:\n+    Source:\n+\n+        \u00ab\u00ab\u00ab\n+        /// tip\n+        \u00bb\u00bb\u00bb\n+\n+    Result:\n+\n+        \u00ab\u00ab\u00ab\n+        /// tip | Consejo\n+        \u00bb\u00bb\u00bb\n+\n+    Source:\n+\n+        \u00ab\u00ab\u00ab\n+        /// details | Preview\n+        \u00bb\u00bb\u00bb\n+\n+    Result:\n+\n+        \u00ab\u00ab\u00ab\n+        /// details | Vista previa\n+        \u00bb\u00bb\u00bb\n+\n+\n+### Tab blocks\n+\n+There are special blocks surrounded by four slashes (\u00ab////\u00bb). They mark text, which will be rendered as part of a tab in the final document. The scheme is:\n+\n+    \u00ab\u00ab\u00ab\n+    //// tab | {tab title}\n+    {tab content, may span many lines}\n+    ////\n+    \u00bb\u00bb\u00bb\n+\n+Keep everything before the vertical bar (\u00ab|\u00bb) as is, including the vertical bar. Translate the tab title. Translate the tab content, applying the rules you know. Keep the four block closing slashes as is.\n+\n+Examples:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        //// tab | Python 3.8+ non-Annotated\n+        Hello\n+        ////\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German):\n+\n+        \u00ab\u00ab\u00ab\n+        //// tab | Python 3.8+ nicht annotiert\n+        Hallo\n+        ////\n+        \u00bb\u00bb\u00bb\n+\n+    Source (English) \u2013 Here there is nothing to translate in the tab title:\n+\n+        \u00ab\u00ab\u00ab\n+        //// tab | Linux, macOS, Windows Bash\n+        Hello again\n+        ////\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German):\n+\n+        \u00ab\u00ab\u00ab\n+        //// tab | Linux, macOS, Windows Bash\n+        Hallo wieder\n+        ////\n+        \u00bb\u00bb\u00bb\n+\n+\n+### Headings\n+\n+Every Markdown heading in the English text (all levels) ends with a part inside curly brackets. This part denotes the hash of this heading, which is used in links to this heading. In translations, translate the heading, but do not translate this hash part, so that links do not break.\n+\n+Examples of how to translate a heading:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        ## Alternative API docs { #alternative-api-docs }\n+        \u00bb\u00bb\u00bb\n+\n+    Result (Spanish):\n+\n+        \u00ab\u00ab\u00ab\n+        ## Documentaci\u00f3n de la API alternativa { #alternative-api-docs }\n+        \u00bb\u00bb\u00bb\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        ### Example { #example }\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German):\n+\n+        \u00ab\u00ab\u00ab\n+        ### Beispiel { #example }\n+        \u00bb\u00bb\u00bb\n+\n+\n+### Links\n+\n+Use the following rules for links (apply both to Markdown-style links (\u00ab[text](url)\u00bb) and to HTML-style \u00ab<a>\u00bb tags):\n+\n+1) For relative URLs, only translate link text. Do not translate the URL or its parts\n+\n+Example:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        [One of the fastest Python frameworks available](#performance)\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German):\n \n-/// tip\n+        \u00ab\u00ab\u00ab\n+        [Eines der schnellsten verf\u00fcgbaren Python-Frameworks](#performance)\n+        \u00bb\u00bb\u00bb\n \n-Result:\n+2) For absolute URLs which DO NOT start EXACTLY with \u00abhttps://fastapi.tiangolo.com\u00bb, only translate link text and leave the URL unchanged.\n \n-/// tip | Consejo\n+Example:\n \n-Source:\n+    Source (English):\n \n-/// details | Preview\n+        \u00ab\u00ab\u00ab\n+        <a href=\"https://sqlmodel.tiangolo.com/\" class=\"external-link\" target=\"_blank\">SQLModel docs</a>\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German):\n+\n+        \u00ab\u00ab\u00ab\n+        <a href=\"https://sqlmodel.tiangolo.com/\" class=\"external-link\" target=\"_blank\">SQLModel-Dokumentation</a>\n+        \u00bb\u00bb\u00bb\n+\n+3) For absolute URLs which DO start EXACTLY with \u00abhttps://fastapi.tiangolo.com\u00bb, only translate link text and change the URL by adding language code (\u00abhttps://fastapi.tiangolo.com/{language_code}[rest part of the url]\u00bb).\n+\n+Example:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        <a href=\"https://fastapi.tiangolo.com/tutorial/path-params/#documentation\" class=\"external-link\" target=\"_blank\">Documentation</a>\n+        \u00bb\u00bb\u00bb\n+\n+    Result (Spanish):\n+\n+        \u00ab\u00ab\u00ab\n+        <a href=\"https://fastapi.tiangolo.com/es/tutorial/path-params/#documentation\" class=\"external-link\" target=\"_blank\">Documentaci\u00f3n</a>\n+        \u00bb\u00bb\u00bb\n+\n+3.1) Do not add language codes for URLs that point to static assets (e.g., images, CSS, JavaScript).\n+\n+Example:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        <a href=\"https://fastapi.tiangolo.com/img/something.jpg\" class=\"external-link\" target=\"_blank\">Something</a>\n+        \u00bb\u00bb\u00bb\n+\n+    Result (Spanish):\n+\n+        \u00ab\u00ab\u00ab\n+        <a href=\"https://fastapi.tiangolo.com/img/something.jpg\" class=\"external-link\" target=\"_blank\">Algo</a>\n+        \u00bb\u00bb\u00bb\n+\n+4) For internal links, only translate link text.\n+\n+Example:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        [Create Pull Requests](help-fastapi.md#create-a-pull-request){.internal-link target=_blank}\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German):\n+\n+        \u00ab\u00ab\u00ab\n+        [Pull Requests erzeugen](help-fastapi.md#create-a-pull-request){.internal-link target=_blank}\n+        \u00bb\u00bb\u00bb\n+\n+5) Do not translate anchor fragments in links (the part after \u00ab#\u00bb), as they must remain the same to work correctly.\n+\n+5.1) If an existing translation has a link with an anchor fragment different to the anchor fragment in the English source, then this is an error. Fix this by using the anchor fragment of the English source.\n+\n+Example:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        [Body - Multiple Parameters: Singular values in body](body-multiple-params.md#singular-values-in-body){.internal-link target=_blank}\n+        \u00bb\u00bb\u00bb\n+\n+    Existing wrong translation (German) \u2013 notice the wrongly translated anchor fragment:\n+\n+        \u00ab\u00ab\u00ab\n+        [Body \u2013 Mehrere Parameter: Einfache Werte im Body](body-multiple-params.md#einzelne-werte-im-body){.internal-link target=_blank}.\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German) \u2013 you fix the anchor fragment:\n+\n+        \u00ab\u00ab\u00ab\n+        [Body \u2013 Mehrere Parameter: Einfache Werte im Body](body-multiple-params.md#singular-values-in-body){.internal-link target=_blank}.\n+        \u00bb\u00bb\u00bb\n+\n+5.2) Do not add anchor fragments at will, even if this makes sense. If the English source has no anchor, don't add one.\n+\n+Example:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        Create a [virtual environment](../virtual-environments.md){.internal-link target=_blank}\n+        \u00bb\u00bb\u00bb\n+\n+    Wrong translation (German) \u2013 Anchor added to the URL.\n+\n+        \u00ab\u00ab\u00ab\n+        Erstelle eine [virtuelle Umgebung](../virtual-environments.md#create-a-virtual-environment){.internal-link target=_blank}\n+        \u00bb\u00bb\u00bb\n+\n+    Good translation (German) \u2013 URL stays like in the English source.\n+\n+        \u00ab\u00ab\u00ab\n+        Erstelle eine [Virtuelle Umgebung](../virtual-environments.md){.internal-link target=_blank}\n+        \u00bb\u00bb\u00bb\n+\n+\n+### HTML abbr elements\n+\n+Translate HTML abbr elements as follows:\n+\n+1) If the title attribute gives the full phrase for an abbreviation, then keep the phrase, append a dash (\u00ab\u2013\u00bb), followed by the translation of the phrase.",
      "comment": "In Russian it fails to follow this rule sometimes.\r\n<img width=\"1367\" height=\"47\" alt=\"image\" src=\"https://github.com/user-attachments/assets/038f593e-0e25-4443-b015-01afec6996ff\" />\r\n",
      "comment_id": 2315421269,
      "user": "YuriiMotov",
      "created_at": "2025-09-02T09:04:17Z",
      "url": "https://github.com/fastapi/fastapi/pull/14015#discussion_r2315421269"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14015,
      "file_path": "scripts/translate.py",
      "line": 606,
      "side": "RIGHT",
      "diff_hunk": "@@ -22,55 +24,642 @@\n     \"contributing.md\",\n )\n \n-\n general_prompt = \"\"\"\n-For technical terms in English that don't have a common translation term use the original term in English.\n+### About literal text in this prompt\n+\n+1) In the following instructions (after I say: `The above rules are in effect now`) the two characters `\u00ab` and `\u00bb` will be used to surround LITERAL TEXT, which is text or characters you shall interpret literally. The `\u00ab` and the `\u00bb` are not part of the literal text, they are the meta characters denoting it.\n+\n+2) Furthermore, text surrounded by `\u00ab\u00ab\u00ab` and `\u00bb\u00bb\u00bb` is a BLOCK OF LITERAL TEXT which spans multiple lines. To get its content, dedent all lines of the block until the `\u00ab\u00ab\u00ab` and `\u00bb\u00bb\u00bb` are at column zero, then remove the newline (`\\n`) after the `\u00ab\u00ab\u00ab` and the newline before the `\u00bb\u00bb\u00bb`. The `\u00ab\u00ab\u00ab` and the `\u00bb\u00bb\u00bb` are not part of the literal text block, they are the meta characters denoting it.\n+\n+3) If you see backticks inside literal text \u2013 inside `\u00ab` and `\u00bb` \u2013  or inside blocks of literal text \u2013 inside `\u00ab\u00ab\u00ab` and `\u00bb\u00bb\u00bb` \u2013 then interpret them as literal characters, do NOT interpret them as meta characters.\n+\n+The above rules are in effect now.\n+\n+\n+### Definitions of terms used in this prompt\n+\n+\"backtick\"\n+\n+    The character \u00ab`\u00bb\n+    Unicode U+0060 (GRAVE ACCENT)\n+\n+\"single backtick\"\n+\n+    A single backtick \u2013 \u00ab`\u00bb\n+\n+\"triple backticks\"\n+\n+    Three backticks in a row \u2013 \u00ab```\u00bb\n+\n+\"neutral double quote\"\n+\n+    The character \u00ab\"\u00bb\n+    Unicode U+0022 (QUOTATION MARK)\n+\n+\"neutral single quote\"\n+\n+    The character \u00ab'\u00bb\n+    Unicode U+0027 (APOSTROPHE)\n+\n+\"English double typographic quotes\"\n+\n+    The characters \u00ab\u201c\u00bb and \u00ab\u201d\u00bb\n+    Unicode U+201C (LEFT DOUBLE QUOTATION MARK) and Unicode U+201D (RIGHT DOUBLE QUOTATION MARK)\n+\n+\"English single typographic quotes\"\n+\n+    The characters \u00ab\u2018\u00bb and \u00ab\u2019\u00bb\n+    Unicode U+2018 (LEFT SINGLE QUOTATION MARK) and Unicode U+2019 (RIGHT SINGLE QUOTATION MARK)\n+\n+\"code snippet\"\n+\n+    Also called \"inline code\". Text in a Markdown document which is surrounded by single backticks. A paragraph in a markdown document can have a more than one code snippets.\n+\n+    Example:\n+\n+        \u00ab\u00ab\u00ab\n+        `i am a code snippet`\n+        \u00bb\u00bb\u00bb\n+\n+    Example:\n+\n+        \u00ab\u00ab\u00ab\n+        `first code snippet` `second code snippet` `third code snippet`\n+        \u00bb\u00bb\u00bb\n+\n+\"code block\"\n+\n+    Text in a Markdown document which is surrounded by triple backticks. Spreads multiple lines.\n+\n+    Example:\n+\n+        \u00ab\u00ab\u00ab\n+        ```\n+        Hello\n+        World\n+        ```\n+        \u00bb\u00bb\u00bb\n+\n+    Example:\n+\n+        \u00ab\u00ab\u00ab\n+        ```python\n+        print(\"hello World\")\n+        ```\n+        \u00bb\u00bb\u00bb\n+\n+\n+### Your task\n+\n+Translate an English text \u2013 the original content \u2013 to a target language.\n+\n+The original content is written in Markdown, write the translation in Markdown as well.\n+\n+The original content will be surrounded by triple percentage signs (\u00ab%%%\u00bb). Do not include the triple percentage signs in the translation.\n+\n+\n+### Technical terms in English\n+\n+For technical terms in English that don't have a common translation term, use the original term in English.\n+\n+\n+### Content of code snippets\n+\n+Do not translate the content of code snippets, keep the original in English. For example, \u00ab`list`\u00bb, \u00ab`dict`\u00bb, keep them as is.\n+\n+\n+### Content of code blocks\n+\n+Do not translate the content of code blocks, except for comments in the language which the code block uses.\n+\n+Examples:\n+\n+    Source (English) \u2013 The code block is a bash code example with one comment:\n+\n+        \u00ab\u00ab\u00ab\n+        ```bash\n+        # Print greeting\n+        echo \"Hello, World!\"\n+        ```\n+        \u00bb\u00bb\u00bb\n \n-If you have instructions to translate specific terms or phrases in a specific way, please follow those instructions instead of keeping the old and outdated content.\n+    Result (German):\n \n-For code snippets or fragments, surrounded by backticks (`), don't translate the content, keep the original in English. For example, `list`, `dict`, keep them as is.\n+        \u00ab\u00ab\u00ab\n+        ```bash\n+        # Gru\u00df ausgeben\n+        echo \"Hello, World!\"\n+        ```\n+        \u00bb\u00bb\u00bb\n \n-The content is written in markdown, write the translation in markdown as well. Don't add triple backticks (`) around the generated translation content.\n+    Source (English) \u2013 The code block is a console example containing HTML tags. No comments, so nothing to change here:\n \n-When there's an example of code, the console or a terminal, normally surrounded by triple backticks and a keyword like \"console\" or \"bash\" (e.g. ```console), do not translate the content, keep the original in English.\n+        \u00ab\u00ab\u00ab\n+        ```console\n+        $ <font color=\"#4E9A06\">fastapi</font> run <u style=\"text-decoration-style:solid\">main.py</u>\n+        <span style=\"background-color:#009485\"><font color=\"#D3D7CF\"> FastAPI </font></span>  Starting server\n+                Searching for package file structure\n+        ```\n+        \u00bb\u00bb\u00bb\n \n-The original content will be surrounded by triple percentage signs (%) and you should translate it to the target language. Do not include the triple percentage signs in the translation.\n+    Result (German):\n+\n+        \u00ab\u00ab\u00ab\n+        ```console\n+        $ <font color=\"#4E9A06\">fastapi</font> run <u style=\"text-decoration-style:solid\">main.py</u>\n+        <span style=\"background-color:#009485\"><font color=\"#D3D7CF\"> FastAPI </font></span>  Starting server\n+                Searching for package file structure\n+        ```\n+        \u00bb\u00bb\u00bb\n+\n+    Source (English) \u2013 The code block is a console example containing 5 comments:\n+\n+        \u00ab\u00ab\u00ab\n+        ```console\n+        // Go to the home directory\n+        $ cd\n+        // Create a directory for all your code projects\n+        $ mkdir code\n+        // Enter into that code directory\n+        $ cd code\n+        // Create a directory for this project\n+        $ mkdir awesome-project\n+        // Enter into that project directory\n+        $ cd awesome-project\n+        ```\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German):\n+\n+        \u00ab\u00ab\u00ab\n+        ```console\n+        // Gehe zum Home-Verzeichnis\n+        $ cd\n+        // Erstelle ein Verzeichnis f\u00fcr alle Ihre Code-Projekte\n+        $ mkdir code\n+        // Gehe in dieses Code-Verzeichnis\n+        $ cd code\n+        // Erstelle ein Verzeichnis f\u00fcr dieses Projekt\n+        $ mkdir awesome-project\n+        // Gehe in dieses Projektverzeichnis\n+        $ cd awesome-project\n+        ```\n+        \u00bb\u00bb\u00bb\n+\n+If there is an existing translation and its Mermaid diagram is in sync with the Mermaid diagram in the English source, except a few translated words, then use the Mermaid diagram of the existing translation. The human editor of the translation translated these words in the Mermaid diagram. Keep these translations, do not revert them back to the English source.\n+\n+Example:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        ```mermaid\n+        flowchart LR\n+            subgraph global[global env]\n+                harry-1[harry v1]\n+            end\n+            subgraph stone-project[philosophers-stone project]\n+                stone(philosophers-stone) -->|requires| harry-1\n+            end\n+        ```\n+        \u00bb\u00bb\u00bb\n+\n+    Existing translation (German) \u2013 has three translations:\n+\n+        \u00ab\u00ab\u00ab\n+        ```mermaid\n+        flowchart LR\n+            subgraph global[globale Umgebung]\n+                harry-1[harry v1]\n+            end\n+            subgraph stone-project[philosophers-stone-Projekt]\n+                stone(philosophers-stone) -->|ben\u00f6tigt| harry-1\n+            end\n+        ```\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German) \u2013 you change nothing:\n+\n+        \u00ab\u00ab\u00ab\n+        ```mermaid\n+        flowchart LR\n+            subgraph global[globale Umgebung]\n+                harry-1[harry v1]\n+            end\n+            subgraph stone-project[philosophers-stone-Projekt]\n+                stone(philosophers-stone) -->|ben\u00f6tigt| harry-1\n+            end\n+        ```\n+        \u00bb\u00bb\u00bb\n+\n+\n+### Special blocks\n \n There are special blocks of notes, tips and others that look like:\n \n-/// note\n+    \u00ab\u00ab\u00ab\n+    /// note\n+    \u00bb\u00bb\u00bb\n \n To translate it, keep the same line and add the translation after a vertical bar.\n \n For example, if you were translating to Spanish, you would write:\n \n-/// note | Nota\n+    \u00ab\u00ab\u00ab\n+    /// note | Nota\n+    \u00bb\u00bb\u00bb\n \n Some examples in Spanish:\n \n-Source:\n+    Source:\n+\n+        \u00ab\u00ab\u00ab\n+        /// tip\n+        \u00bb\u00bb\u00bb\n+\n+    Result:\n+\n+        \u00ab\u00ab\u00ab\n+        /// tip | Consejo\n+        \u00bb\u00bb\u00bb\n+\n+    Source:\n+\n+        \u00ab\u00ab\u00ab\n+        /// details | Preview\n+        \u00bb\u00bb\u00bb\n+\n+    Result:\n+\n+        \u00ab\u00ab\u00ab\n+        /// details | Vista previa\n+        \u00bb\u00bb\u00bb\n+\n+\n+### Tab blocks\n+\n+There are special blocks surrounded by four slashes (\u00ab////\u00bb). They mark text, which will be rendered as part of a tab in the final document. The scheme is:\n+\n+    \u00ab\u00ab\u00ab\n+    //// tab | {tab title}\n+    {tab content, may span many lines}\n+    ////\n+    \u00bb\u00bb\u00bb\n+\n+Keep everything before the vertical bar (\u00ab|\u00bb) as is, including the vertical bar. Translate the tab title. Translate the tab content, applying the rules you know. Keep the four block closing slashes as is.\n+\n+Examples:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        //// tab | Python 3.8+ non-Annotated\n+        Hello\n+        ////\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German):\n+\n+        \u00ab\u00ab\u00ab\n+        //// tab | Python 3.8+ nicht annotiert\n+        Hallo\n+        ////\n+        \u00bb\u00bb\u00bb\n+\n+    Source (English) \u2013 Here there is nothing to translate in the tab title:\n+\n+        \u00ab\u00ab\u00ab\n+        //// tab | Linux, macOS, Windows Bash\n+        Hello again\n+        ////\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German):\n+\n+        \u00ab\u00ab\u00ab\n+        //// tab | Linux, macOS, Windows Bash\n+        Hallo wieder\n+        ////\n+        \u00bb\u00bb\u00bb\n+\n+\n+### Headings\n+\n+Every Markdown heading in the English text (all levels) ends with a part inside curly brackets. This part denotes the hash of this heading, which is used in links to this heading. In translations, translate the heading, but do not translate this hash part, so that links do not break.\n+\n+Examples of how to translate a heading:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        ## Alternative API docs { #alternative-api-docs }\n+        \u00bb\u00bb\u00bb\n+\n+    Result (Spanish):\n+\n+        \u00ab\u00ab\u00ab\n+        ## Documentaci\u00f3n de la API alternativa { #alternative-api-docs }\n+        \u00bb\u00bb\u00bb\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        ### Example { #example }\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German):\n+\n+        \u00ab\u00ab\u00ab\n+        ### Beispiel { #example }\n+        \u00bb\u00bb\u00bb\n+\n+\n+### Links\n+\n+Use the following rules for links (apply both to Markdown-style links (\u00ab[text](url)\u00bb) and to HTML-style \u00ab<a>\u00bb tags):\n+\n+1) For relative URLs, only translate link text. Do not translate the URL or its parts\n+\n+Example:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        [One of the fastest Python frameworks available](#performance)\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German):\n \n-/// tip\n+        \u00ab\u00ab\u00ab\n+        [Eines der schnellsten verf\u00fcgbaren Python-Frameworks](#performance)\n+        \u00bb\u00bb\u00bb\n \n-Result:\n+2) For absolute URLs which DO NOT start EXACTLY with \u00abhttps://fastapi.tiangolo.com\u00bb, only translate link text and leave the URL unchanged.\n \n-/// tip | Consejo\n+Example:\n \n-Source:\n+    Source (English):\n \n-/// details | Preview\n+        \u00ab\u00ab\u00ab\n+        <a href=\"https://sqlmodel.tiangolo.com/\" class=\"external-link\" target=\"_blank\">SQLModel docs</a>\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German):\n+\n+        \u00ab\u00ab\u00ab\n+        <a href=\"https://sqlmodel.tiangolo.com/\" class=\"external-link\" target=\"_blank\">SQLModel-Dokumentation</a>\n+        \u00bb\u00bb\u00bb\n+\n+3) For absolute URLs which DO start EXACTLY with \u00abhttps://fastapi.tiangolo.com\u00bb, only translate link text and change the URL by adding language code (\u00abhttps://fastapi.tiangolo.com/{language_code}[rest part of the url]\u00bb).\n+\n+Example:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        <a href=\"https://fastapi.tiangolo.com/tutorial/path-params/#documentation\" class=\"external-link\" target=\"_blank\">Documentation</a>\n+        \u00bb\u00bb\u00bb\n+\n+    Result (Spanish):\n+\n+        \u00ab\u00ab\u00ab\n+        <a href=\"https://fastapi.tiangolo.com/es/tutorial/path-params/#documentation\" class=\"external-link\" target=\"_blank\">Documentaci\u00f3n</a>\n+        \u00bb\u00bb\u00bb\n+\n+3.1) Do not add language codes for URLs that point to static assets (e.g., images, CSS, JavaScript).\n+\n+Example:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        <a href=\"https://fastapi.tiangolo.com/img/something.jpg\" class=\"external-link\" target=\"_blank\">Something</a>\n+        \u00bb\u00bb\u00bb\n+\n+    Result (Spanish):\n+\n+        \u00ab\u00ab\u00ab\n+        <a href=\"https://fastapi.tiangolo.com/img/something.jpg\" class=\"external-link\" target=\"_blank\">Algo</a>\n+        \u00bb\u00bb\u00bb\n+\n+4) For internal links, only translate link text.\n+\n+Example:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        [Create Pull Requests](help-fastapi.md#create-a-pull-request){.internal-link target=_blank}\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German):\n+\n+        \u00ab\u00ab\u00ab\n+        [Pull Requests erzeugen](help-fastapi.md#create-a-pull-request){.internal-link target=_blank}\n+        \u00bb\u00bb\u00bb\n+\n+5) Do not translate anchor fragments in links (the part after \u00ab#\u00bb), as they must remain the same to work correctly.\n+\n+5.1) If an existing translation has a link with an anchor fragment different to the anchor fragment in the English source, then this is an error. Fix this by using the anchor fragment of the English source.\n+\n+Example:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        [Body - Multiple Parameters: Singular values in body](body-multiple-params.md#singular-values-in-body){.internal-link target=_blank}\n+        \u00bb\u00bb\u00bb\n+\n+    Existing wrong translation (German) \u2013 notice the wrongly translated anchor fragment:\n+\n+        \u00ab\u00ab\u00ab\n+        [Body \u2013 Mehrere Parameter: Einfache Werte im Body](body-multiple-params.md#einzelne-werte-im-body){.internal-link target=_blank}.\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German) \u2013 you fix the anchor fragment:\n+\n+        \u00ab\u00ab\u00ab\n+        [Body \u2013 Mehrere Parameter: Einfache Werte im Body](body-multiple-params.md#singular-values-in-body){.internal-link target=_blank}.\n+        \u00bb\u00bb\u00bb\n+\n+5.2) Do not add anchor fragments at will, even if this makes sense. If the English source has no anchor, don't add one.\n+\n+Example:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        Create a [virtual environment](../virtual-environments.md){.internal-link target=_blank}\n+        \u00bb\u00bb\u00bb\n+\n+    Wrong translation (German) \u2013 Anchor added to the URL.\n+\n+        \u00ab\u00ab\u00ab\n+        Erstelle eine [virtuelle Umgebung](../virtual-environments.md#create-a-virtual-environment){.internal-link target=_blank}\n+        \u00bb\u00bb\u00bb\n+\n+    Good translation (German) \u2013 URL stays like in the English source.\n+\n+        \u00ab\u00ab\u00ab\n+        Erstelle eine [Virtuelle Umgebung](../virtual-environments.md){.internal-link target=_blank}\n+        \u00bb\u00bb\u00bb\n+\n+\n+### HTML abbr elements\n+\n+Translate HTML abbr elements as follows:\n+\n+1) If the title attribute gives the full phrase for an abbreviation, then keep the phrase, append a dash (\u00ab\u2013\u00bb), followed by the translation of the phrase.\n+\n+Examples:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        <abbr title=\"Internet of Things\">IoT</abbr>\n+        <abbr title=\"Central Processing Unit\">CPU</abbr>\n+        <abbr title=\"too long; didn't read\"><strong>TL;DR:</strong></abbr>\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German):\n+\n+        \u00ab\u00ab\u00ab\n+        <abbr title=\"Internet of Things \u2013 Internet der Dinge\">IoT</abbr>\n+        <abbr title=\"Central Processing Unit \u2013 Zentrale Verarbeitungseinheit\">CPU</abbr>\n+        <abbr title=\"too long; didn't read \u2013 zu lang; hab's nicht gelesen\"><strong>TL;DR:</strong></abbr>\n+        \u00bb\u00bb\u00bb\n+\n+Conversion scheme title attribute:\n+\n+    Source (English):\n+\n+        {full phrase}\n+\n+    Result (German):\n+\n+        {full phrase} \u2013 {translation of full phrase}\n+\n+1.1) If the translation of the phrase starts with the same letters, then just use the translation.\n+\n+Examples:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        <abbr title=\"JSON Web Tokens\">JWT</abbr>\n+        <abbr title=\"Enumeration\">`Enum`</abbr>\n+        <abbr title=\"Asynchronous Server Gateway Interface\">ASGI</abbr>\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German):\n+\n+        \u00ab\u00ab\u00ab\n+        <abbr title=\"JSON Web Tokens\">JWT</abbr>\n+        <abbr title=\"Enumeration\">`Enum`</abbr>\n+        <abbr title=\"Asynchrones Server-Gateway-Interface\">ASGI</abbr>\n+        \u00bb\u00bb\u00bb\n+\n+Conversion scheme title attribute:\n+\n+    Source (English):\n+\n+        {full phrase}\n+\n+    Result (German):\n+\n+        {translation of full phrase}\n+\n+2) If the title attribute explains something in its own words, then translate it, if possible.\n+\n+Examples:\n+\n+    Source (English):\n+\n+        \u00ab\u00ab\u00ab\n+        <abbr title=\"also known as: endpoints, routes\">path</abbr>\n+        <abbr title=\"A program that checks for code errors\">linter</abbr>\n+        <abbr title=\"converting the string that comes from an HTTP request into Python data\">\"parsing\"</abbr>\n+        <abbr title=\"before 2023-03\">0.95.0</abbr>\n+        <abbr title=\"2023-08-26\">at the time of writing this</abbr>\n+        \u00bb\u00bb\u00bb\n+\n+    Result (German):\n+\n+        \u00ab\u00ab\u00ab\n+        <abbr title=\"auch bekannt als: Endpunkte, Routen\">Pfad</abbr>\n+        <abbr title=\"Programm das auf Fehler im Code pr\u00fcft\">Linter</abbr>\n+        <abbr title=\"Konvertieren des Strings eines HTTP-Requests in Python-Daten\">\u201eParsen\u201c</abbr>\n+        <abbr title=\"vor 2023-03\">0.95.0</abbr>\n+        <abbr title=\"2023-08-26\">zum Zeitpunkt als das hier geschrieben wurde</abbr>\n+        \u00bb\u00bb\u00bb\n+\n+Conversion scheme title attribute:\n+\n+    Source (English):\n+\n+        {explanation}\n+\n+    Result (German):\n+\n+        {translation of explanation}\n+\n+3) If the title attribute gives the full phrase for an abbreviation, followed by a colon (\u00ab:\u00bb) or a comma (\u00ab,\u00bb), followed by an explanation, then keep the phrase, append a dash (\u00ab\u2013\u00bb), followed by the translation of the phrase, followed by a colon (\u00ab:\u00bb), followed by the translation of the explanation.",
      "comment": "Sometimes fails to follow this rule in Russian\r\n\r\n<img width=\"1367\" height=\"47\" alt=\"image\" src=\"https://github.com/user-attachments/assets/71f1ed21-bd66-4976-b21a-b8572297869e\" />\r\n",
      "comment_id": 2315463043,
      "user": "YuriiMotov",
      "created_at": "2025-09-02T09:19:17Z",
      "url": "https://github.com/fastapi/fastapi/pull/14015#discussion_r2315463043"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14015,
      "file_path": "scripts/translate.py",
      "line": 806,
      "side": "RIGHT",
      "diff_hunk": "@@ -182,39 +783,72 @@ def iter_all_en_paths() -> Iterable[Path]:\n \n \n def iter_en_paths_to_translate() -> Iterable[Path]:\n+    en_docs_root = Path(\"docs/en/docs/\")\n     for path in iter_all_en_paths():\n-        if str(path).replace(\"docs/en/docs/\", \"\").startswith(non_translated_sections):\n-            continue\n-        yield path\n+        relpath = path.relative_to(en_docs_root)\n+        if not str(relpath).startswith(non_translated_sections):\n+            yield path\n \n \n @app.command()\n-def translate_lang(language: Annotated[str, typer.Option(envvar=\"LANGUAGE\")]) -> None:\n-    paths_to_process = list(iter_en_paths_to_translate())\n-    print(\"Original paths:\")\n-    for p in paths_to_process:\n-        print(f\"  - {p}\")\n-    print(f\"Total original paths: {len(paths_to_process)}\")\n+def translate_lang(\n+    language: Annotated[\n+        str,\n+        typer.Option(envvar=\"LANGUAGE\", help=\"Target language, e.g. `es`, `fr`, `de`\"),\n+    ],\n+    mode: Annotated[\n+        str,\n+        typer.Option(\n+            help=\"Which files of the target language to translate, one of: `missing`, `existing`, `all`\"\n+        ),\n+    ] = \"missing\",\n+    verbose: Annotated[bool, typer.Option(help=\"Print all paths\")] = False,\n+    preview: Annotated[",
      "comment": "Not sure we need this `preview` parameter. We can always commit previous changes, then run script and discard changes if we don't like them.",
      "comment_id": 2315521909,
      "user": "YuriiMotov",
      "created_at": "2025-09-02T09:37:41Z",
      "url": "https://github.com/fastapi/fastapi/pull/14015#discussion_r2315521909"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14015,
      "file_path": "scripts/translate.py",
      "line": 804,
      "side": "RIGHT",
      "diff_hunk": "@@ -182,39 +783,72 @@ def iter_all_en_paths() -> Iterable[Path]:\n \n \n def iter_en_paths_to_translate() -> Iterable[Path]:\n+    en_docs_root = Path(\"docs/en/docs/\")\n     for path in iter_all_en_paths():\n-        if str(path).replace(\"docs/en/docs/\", \"\").startswith(non_translated_sections):\n-            continue\n-        yield path\n+        relpath = path.relative_to(en_docs_root)\n+        if not str(relpath).startswith(non_translated_sections):\n+            yield path\n \n \n @app.command()\n-def translate_lang(language: Annotated[str, typer.Option(envvar=\"LANGUAGE\")]) -> None:\n-    paths_to_process = list(iter_en_paths_to_translate())\n-    print(\"Original paths:\")\n-    for p in paths_to_process:\n-        print(f\"  - {p}\")\n-    print(f\"Total original paths: {len(paths_to_process)}\")\n+def translate_lang(\n+    language: Annotated[\n+        str,\n+        typer.Option(envvar=\"LANGUAGE\", help=\"Target language, e.g. `es`, `fr`, `de`\"),\n+    ],\n+    mode: Annotated[\n+        str,\n+        typer.Option(\n+            help=\"Which files of the target language to translate, one of: `missing`, `existing`, `all`\"\n+        ),\n+    ] = \"missing\",",
      "comment": "I think mode should be: `missing`, `updated`, `missing-and-updated`, `all`.\r\nAnd it should be `missing-and-updated` by default.\r\n`all` should include existing even if they were not updated.",
      "comment_id": 2315559758,
      "user": "YuriiMotov",
      "created_at": "2025-09-02T09:50:41Z",
      "url": "https://github.com/fastapi/fastapi/pull/14015#discussion_r2315559758"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14015,
      "file_path": "scripts/translate.py",
      "line": 698,
      "side": "RIGHT",
      "diff_hunk": "@@ -96,30 +685,42 @@ def generate_en_path(*, lang: str, path: Path) -> Path:\n @app.command()\n def translate_page(\n     *,\n-    language: Annotated[str, typer.Option(envvar=\"LANGUAGE\")],\n-    en_path: Annotated[Path, typer.Option(envvar=\"EN_PATH\")],\n+    language: Annotated[\n+        str,\n+        typer.Option(envvar=\"LANGUAGE\", help=\"Target language, e.g. `es`, `fr`, `de`\"),\n+    ],\n+    en_path: Annotated[\n+        Path,\n+        typer.Option(\n+            envvar=\"EN_PATH\",\n+            help=\"Path to the English source, relative to the FastAPI root directory. If not given, `docs/en/docs/_llm-test.md` is used.\",\n+        ),\n+    ] = Path(\"docs/en/docs/_llm-test.md\"),",
      "comment": "Yeah, this may result in running a translation unintended. Will remove.",
      "comment_id": 2316035102,
      "user": "nilslindemann",
      "created_at": "2025-09-02T13:05:33Z",
      "url": "https://github.com/fastapi/fastapi/pull/14015#discussion_r2316035102"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14015,
      "file_path": "scripts/translate.py",
      "line": 806,
      "side": "RIGHT",
      "diff_hunk": "@@ -182,39 +783,72 @@ def iter_all_en_paths() -> Iterable[Path]:\n \n \n def iter_en_paths_to_translate() -> Iterable[Path]:\n+    en_docs_root = Path(\"docs/en/docs/\")\n     for path in iter_all_en_paths():\n-        if str(path).replace(\"docs/en/docs/\", \"\").startswith(non_translated_sections):\n-            continue\n-        yield path\n+        relpath = path.relative_to(en_docs_root)\n+        if not str(relpath).startswith(non_translated_sections):\n+            yield path\n \n \n @app.command()\n-def translate_lang(language: Annotated[str, typer.Option(envvar=\"LANGUAGE\")]) -> None:\n-    paths_to_process = list(iter_en_paths_to_translate())\n-    print(\"Original paths:\")\n-    for p in paths_to_process:\n-        print(f\"  - {p}\")\n-    print(f\"Total original paths: {len(paths_to_process)}\")\n+def translate_lang(\n+    language: Annotated[\n+        str,\n+        typer.Option(envvar=\"LANGUAGE\", help=\"Target language, e.g. `es`, `fr`, `de`\"),\n+    ],\n+    mode: Annotated[\n+        str,\n+        typer.Option(\n+            help=\"Which files of the target language to translate, one of: `missing`, `existing`, `all`\"\n+        ),\n+    ] = \"missing\",\n+    verbose: Annotated[bool, typer.Option(help=\"Print all paths\")] = False,\n+    preview: Annotated[",
      "comment": "It is practical to be able to preview which files will be modified, before running the actual translations, which costs time and money. For example, to figure out if the `mode` parameter was set correctly. I am in favor of keeping it.",
      "comment_id": 2316051064,
      "user": "nilslindemann",
      "created_at": "2025-09-02T13:11:22Z",
      "url": "https://github.com/fastapi/fastapi/pull/14015#discussion_r2316051064"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14015,
      "file_path": "scripts/translate.py",
      "line": 806,
      "side": "RIGHT",
      "diff_hunk": "@@ -182,39 +783,72 @@ def iter_all_en_paths() -> Iterable[Path]:\n \n \n def iter_en_paths_to_translate() -> Iterable[Path]:\n+    en_docs_root = Path(\"docs/en/docs/\")\n     for path in iter_all_en_paths():\n-        if str(path).replace(\"docs/en/docs/\", \"\").startswith(non_translated_sections):\n-            continue\n-        yield path\n+        relpath = path.relative_to(en_docs_root)\n+        if not str(relpath).startswith(non_translated_sections):\n+            yield path\n \n \n @app.command()\n-def translate_lang(language: Annotated[str, typer.Option(envvar=\"LANGUAGE\")]) -> None:\n-    paths_to_process = list(iter_en_paths_to_translate())\n-    print(\"Original paths:\")\n-    for p in paths_to_process:\n-        print(f\"  - {p}\")\n-    print(f\"Total original paths: {len(paths_to_process)}\")\n+def translate_lang(\n+    language: Annotated[\n+        str,\n+        typer.Option(envvar=\"LANGUAGE\", help=\"Target language, e.g. `es`, `fr`, `de`\"),\n+    ],\n+    mode: Annotated[\n+        str,\n+        typer.Option(\n+            help=\"Which files of the target language to translate, one of: `missing`, `existing`, `all`\"\n+        ),\n+    ] = \"missing\",\n+    verbose: Annotated[bool, typer.Option(help=\"Print all paths\")] = False,\n+    preview: Annotated[",
      "comment": "Just realized that we also have `update_outdated`, `add_missing` and `update_and_add` commands. And also `list_outdated` and `list_missing`.\r\nI suppose we will mostly use those commands, not `translate_lang`.\r\nI would suggest we ask Sebastian whether we even need this command as it's duplication of functionality.",
      "comment_id": 2316246036,
      "user": "YuriiMotov",
      "created_at": "2025-09-02T14:19:06Z",
      "url": "https://github.com/fastapi/fastapi/pull/14015#discussion_r2316246036"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14015,
      "file_path": "scripts/translate.py",
      "line": 806,
      "side": "RIGHT",
      "diff_hunk": "@@ -182,39 +783,72 @@ def iter_all_en_paths() -> Iterable[Path]:\n \n \n def iter_en_paths_to_translate() -> Iterable[Path]:\n+    en_docs_root = Path(\"docs/en/docs/\")\n     for path in iter_all_en_paths():\n-        if str(path).replace(\"docs/en/docs/\", \"\").startswith(non_translated_sections):\n-            continue\n-        yield path\n+        relpath = path.relative_to(en_docs_root)\n+        if not str(relpath).startswith(non_translated_sections):\n+            yield path\n \n \n @app.command()\n-def translate_lang(language: Annotated[str, typer.Option(envvar=\"LANGUAGE\")]) -> None:\n-    paths_to_process = list(iter_en_paths_to_translate())\n-    print(\"Original paths:\")\n-    for p in paths_to_process:\n-        print(f\"  - {p}\")\n-    print(f\"Total original paths: {len(paths_to_process)}\")\n+def translate_lang(\n+    language: Annotated[\n+        str,\n+        typer.Option(envvar=\"LANGUAGE\", help=\"Target language, e.g. `es`, `fr`, `de`\"),\n+    ],\n+    mode: Annotated[\n+        str,\n+        typer.Option(\n+            help=\"Which files of the target language to translate, one of: `missing`, `existing`, `all`\"\n+        ),\n+    ] = \"missing\",\n+    verbose: Annotated[bool, typer.Option(help=\"Print all paths\")] = False,\n+    preview: Annotated[",
      "comment": "Okay, let's do that. Edit: to make it clear, I am also against duplication of functionality and in favor of deleting it.",
      "comment_id": 2316393300,
      "user": "nilslindemann",
      "created_at": "2025-09-02T15:10:47Z",
      "url": "https://github.com/fastapi/fastapi/pull/14015#discussion_r2316393300"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14015,
      "file_path": "scripts/translate.py",
      "line": 804,
      "side": "RIGHT",
      "diff_hunk": "@@ -182,39 +783,72 @@ def iter_all_en_paths() -> Iterable[Path]:\n \n \n def iter_en_paths_to_translate() -> Iterable[Path]:\n+    en_docs_root = Path(\"docs/en/docs/\")\n     for path in iter_all_en_paths():\n-        if str(path).replace(\"docs/en/docs/\", \"\").startswith(non_translated_sections):\n-            continue\n-        yield path\n+        relpath = path.relative_to(en_docs_root)\n+        if not str(relpath).startswith(non_translated_sections):\n+            yield path\n \n \n @app.command()\n-def translate_lang(language: Annotated[str, typer.Option(envvar=\"LANGUAGE\")]) -> None:\n-    paths_to_process = list(iter_en_paths_to_translate())\n-    print(\"Original paths:\")\n-    for p in paths_to_process:\n-        print(f\"  - {p}\")\n-    print(f\"Total original paths: {len(paths_to_process)}\")\n+def translate_lang(\n+    language: Annotated[\n+        str,\n+        typer.Option(envvar=\"LANGUAGE\", help=\"Target language, e.g. `es`, `fr`, `de`\"),\n+    ],\n+    mode: Annotated[\n+        str,\n+        typer.Option(\n+            help=\"Which files of the target language to translate, one of: `missing`, `existing`, `all`\"\n+        ),\n+    ] = \"missing\",",
      "comment": "(waiting for tiangolo's verdict regarding removal of this function)",
      "comment_id": 2316407757,
      "user": "nilslindemann",
      "created_at": "2025-09-02T15:15:58Z",
      "url": "https://github.com/fastapi/fastapi/pull/14015#discussion_r2316407757"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14015,
      "file_path": "scripts/translate.py",
      "line": 750,
      "side": "RIGHT",
      "diff_hunk": "@@ -128,16 +743,19 @@ def translate_page(\n     if old_translation:\n         prompt_segments.extend(\n             [\n-                \"There's an existing previous translation for this content that is probably outdated with old content or old instructions.\",\n+                \"There is an existing previous translation for the original English content, that may be outdated.\",\n                 \"Update the translation only where necessary:\",\n-                \"- If the original English content has changed, reflect that in the translation.\",\n+                \"- If the original English content has added parts, also add these parts to the translation.\",\n+                \"- If the original English content has removed parts, also remove them from the translation, unless you were instructed earlier to not do that in specific cases.\",\n+                \"- If parts of the original English content have changed, also change those parts in the translation.\",",
      "comment": "I think this is a tricky part.\r\nWe don't provide old version of En document.\r\nSo, LLM can't distinguish between two cases:\r\n* part of the sentence was removed from the original document\r\n* sentence in the original document remains unchanged, but translation contains additional parts added by human editor (and we instruct LLM to preserve such human edits)\r\n\r\nI'm afraid these instructions will not be followed. So, maybe leave the shorter version?\r\n",
      "comment_id": 2321482022,
      "user": "YuriiMotov",
      "created_at": "2025-09-04T09:52:43Z",
      "url": "https://github.com/fastapi/fastapi/pull/14015#discussion_r2321482022"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14015,
      "file_path": "scripts/translate.py",
      "line": 750,
      "side": "RIGHT",
      "diff_hunk": "@@ -128,16 +743,19 @@ def translate_page(\n     if old_translation:\n         prompt_segments.extend(\n             [\n-                \"There's an existing previous translation for this content that is probably outdated with old content or old instructions.\",\n+                \"There is an existing previous translation for the original English content, that may be outdated.\",\n                 \"Update the translation only where necessary:\",\n-                \"- If the original English content has changed, reflect that in the translation.\",\n+                \"- If the original English content has added parts, also add these parts to the translation.\",\n+                \"- If the original English content has removed parts, also remove them from the translation, unless you were instructed earlier to not do that in specific cases.\",\n+                \"- If parts of the original English content have changed, also change those parts in the translation.\",",
      "comment": "We can probably use some kind of markers to mark such human editor's additions.\r\n\r\nOriginal:\r\n```\r\nThis is original text of the sentence\r\n```\r\n\r\nTranslation:\r\n```\r\nThis is original text <!-- PRESERVE --> (modified a bit) <!-- END PRESERVE --> of the sentence\r\n```\r\nOr:\r\n```\r\nThis is original text <span class=\"human-edit\"> (modified a bit) </span> of the sentence\r\n```\r\n",
      "comment_id": 2321498403,
      "user": "YuriiMotov",
      "created_at": "2025-09-04T09:59:30Z",
      "url": "https://github.com/fastapi/fastapi/pull/14015#discussion_r2321498403"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14015,
      "file_path": "scripts/translate.py",
      "line": 750,
      "side": "RIGHT",
      "diff_hunk": "@@ -128,16 +743,19 @@ def translate_page(\n     if old_translation:\n         prompt_segments.extend(\n             [\n-                \"There's an existing previous translation for this content that is probably outdated with old content or old instructions.\",\n+                \"There is an existing previous translation for the original English content, that may be outdated.\",\n                 \"Update the translation only where necessary:\",\n-                \"- If the original English content has changed, reflect that in the translation.\",\n+                \"- If the original English content has added parts, also add these parts to the translation.\",\n+                \"- If the original English content has removed parts, also remove them from the translation, unless you were instructed earlier to not do that in specific cases.\",\n+                \"- If parts of the original English content have changed, also change those parts in the translation.\",",
      "comment": "But still, if the original text was modified, this addition may also become invalid",
      "comment_id": 2321500718,
      "user": "YuriiMotov",
      "created_at": "2025-09-04T10:00:31Z",
      "url": "https://github.com/fastapi/fastapi/pull/14015#discussion_r2321500718"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14015,
      "file_path": "scripts/translate.py",
      "line": 750,
      "side": "RIGHT",
      "diff_hunk": "@@ -128,16 +743,19 @@ def translate_page(\n     if old_translation:\n         prompt_segments.extend(\n             [\n-                \"There's an existing previous translation for this content that is probably outdated with old content or old instructions.\",\n+                \"There is an existing previous translation for the original English content, that may be outdated.\",\n                 \"Update the translation only where necessary:\",\n-                \"- If the original English content has changed, reflect that in the translation.\",\n+                \"- If the original English content has added parts, also add these parts to the translation.\",\n+                \"- If the original English content has removed parts, also remove them from the translation, unless you were instructed earlier to not do that in specific cases.\",\n+                \"- If parts of the original English content have changed, also change those parts in the translation.\",",
      "comment": "As I understand it ...\r\n\r\n```\r\nIf the original English content has added parts (...)\r\nIf the original English content has removed parts (...)\r\nIf parts of the original English content have changed (...)\r\n```\r\n\r\n... means _\"compared to the existing translation\"_ and not _\"compared to the previous version of the English document\"_. Do you agree? If so, then I do not see an issue, do you?\r\n\r\nNotice, the shorter version did not add a part to a sentence, in a situation when retranslating the test file ([this sentence](https://github.com/fastapi/fastapi/pull/14015/files#diff-a8f0312a235b9188421c47b1ff84a2692f65601a22b4da0c660f9b6968270ce2R9)). It was stubborn, even when I retranslated again. After I changed the prompt, it detected the addition.\r\n\r\nRegarding comment markers, I also thought about this one, and the problem you mentioned (when the addition may become invalid), and I found no good solution, which is why stuck to just [allow added `abbr`s](https://github.com/fastapi/fastapi/pull/14015/files#diff-83e241ff55d1dc272582b5e61fd0582a36e2c2bea760d6b028ffd63f8e0a50e6R666), which are removed when the sentence gets removed.\r\n\r\nBTW, I will make another complete retranslation before merging, to check if it works with the updated prompts.",
      "comment_id": 2323501046,
      "user": "nilslindemann",
      "created_at": "2025-09-04T20:38:21Z",
      "url": "https://github.com/fastapi/fastapi/pull/14015#discussion_r2323501046"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14015,
      "file_path": "scripts/translate.py",
      "line": 750,
      "side": "RIGHT",
      "diff_hunk": "@@ -128,16 +743,19 @@ def translate_page(\n     if old_translation:\n         prompt_segments.extend(\n             [\n-                \"There's an existing previous translation for this content that is probably outdated with old content or old instructions.\",\n+                \"There is an existing previous translation for the original English content, that may be outdated.\",\n                 \"Update the translation only where necessary:\",\n-                \"- If the original English content has changed, reflect that in the translation.\",\n+                \"- If the original English content has added parts, also add these parts to the translation.\",\n+                \"- If the original English content has removed parts, also remove them from the translation, unless you were instructed earlier to not do that in specific cases.\",\n+                \"- If parts of the original English content have changed, also change those parts in the translation.\",",
      "comment": "To clarify: The moment it detected the addition was when I added the [last sentence](https://github.com/fastapi/fastapi/pull/14015/files#diff-83e241ff55d1dc272582b5e61fd0582a36e2c2bea760d6b028ffd63f8e0a50e6R758). So it is possible that it also works well when just keeping that change and reverting the others. But I find that the rule is formulated more precise this way, as it mentions when not to remove things, So I am in favor of keeping it like this. If you insist, let's revert it, but keep the last sentence.",
      "comment_id": 2323523354,
      "user": "nilslindemann",
      "created_at": "2025-09-04T20:51:07Z",
      "url": "https://github.com/fastapi/fastapi/pull/14015#discussion_r2323523354"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14015,
      "file_path": "scripts/translate.py",
      "line": 750,
      "side": "RIGHT",
      "diff_hunk": "@@ -128,16 +743,19 @@ def translate_page(\n     if old_translation:\n         prompt_segments.extend(\n             [\n-                \"There's an existing previous translation for this content that is probably outdated with old content or old instructions.\",\n+                \"There is an existing previous translation for the original English content, that may be outdated.\",\n                 \"Update the translation only where necessary:\",\n-                \"- If the original English content has changed, reflect that in the translation.\",\n+                \"- If the original English content has added parts, also add these parts to the translation.\",\n+                \"- If the original English content has removed parts, also remove them from the translation, unless you were instructed earlier to not do that in specific cases.\",\n+                \"- If parts of the original English content have changed, also change those parts in the translation.\",",
      "comment": "BTW, I am sorry for not adding you as co-author in some commits, I just learned about this feature (the button in GitHub Desktop).",
      "comment_id": 2323838905,
      "user": "nilslindemann",
      "created_at": "2025-09-05T01:06:10Z",
      "url": "https://github.com/fastapi/fastapi/pull/14015#discussion_r2323838905"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14015,
      "file_path": "scripts/translate.py",
      "line": 750,
      "side": "RIGHT",
      "diff_hunk": "@@ -128,16 +743,19 @@ def translate_page(\n     if old_translation:\n         prompt_segments.extend(\n             [\n-                \"There's an existing previous translation for this content that is probably outdated with old content or old instructions.\",\n+                \"There is an existing previous translation for the original English content, that may be outdated.\",\n                 \"Update the translation only where necessary:\",\n-                \"- If the original English content has changed, reflect that in the translation.\",\n+                \"- If the original English content has added parts, also add these parts to the translation.\",\n+                \"- If the original English content has removed parts, also remove them from the translation, unless you were instructed earlier to not do that in specific cases.\",\n+                \"- If parts of the original English content have changed, also change those parts in the translation.\",",
      "comment": "When you refer to the last sentence, do you mean this?\r\n> UNLESS you were instructed earlier to behave different, there MUST NOT be whole sentences or partial sentences in the updated translation, which are not in the original English content, and there MUST NOT be whole sentences or partial sentences in the original English content, which are not in the updated translation. Remember: the updated translation shall be IN SYNC with the original English content.\r\n\r\nThe links you provided point to a big diff and I can't understand which sentences you are talking about..",
      "comment_id": 2324106397,
      "user": "YuriiMotov",
      "created_at": "2025-09-05T05:04:17Z",
      "url": "https://github.com/fastapi/fastapi/pull/14015#discussion_r2324106397"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14015,
      "file_path": "scripts/translate.py",
      "line": 750,
      "side": "RIGHT",
      "diff_hunk": "@@ -128,16 +743,19 @@ def translate_page(\n     if old_translation:\n         prompt_segments.extend(\n             [\n-                \"There's an existing previous translation for this content that is probably outdated with old content or old instructions.\",\n+                \"There is an existing previous translation for the original English content, that may be outdated.\",\n                 \"Update the translation only where necessary:\",\n-                \"- If the original English content has changed, reflect that in the translation.\",\n+                \"- If the original English content has added parts, also add these parts to the translation.\",\n+                \"- If the original English content has removed parts, also remove them from the translation, unless you were instructed earlier to not do that in specific cases.\",\n+                \"- If parts of the original English content have changed, also change those parts in the translation.\",",
      "comment": "But, it seems that I got it)\r\nWe only preserve `abbr` elements added by human editor.\r\nThen yes, it should work",
      "comment_id": 2324114367,
      "user": "YuriiMotov",
      "created_at": "2025-09-05T05:09:32Z",
      "url": "https://github.com/fastapi/fastapi/pull/14015#discussion_r2324114367"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14015,
      "file_path": "scripts/translate.py",
      "line": 750,
      "side": "RIGHT",
      "diff_hunk": "@@ -128,16 +743,19 @@ def translate_page(\n     if old_translation:\n         prompt_segments.extend(\n             [\n-                \"There's an existing previous translation for this content that is probably outdated with old content or old instructions.\",\n+                \"There is an existing previous translation for the original English content, that may be outdated.\",\n                 \"Update the translation only where necessary:\",\n-                \"- If the original English content has changed, reflect that in the translation.\",\n+                \"- If the original English content has added parts, also add these parts to the translation.\",\n+                \"- If the original English content has removed parts, also remove them from the translation, unless you were instructed earlier to not do that in specific cases.\",\n+                \"- If parts of the original English content have changed, also change those parts in the translation.\",",
      "comment": "Yes, I meant this sentence. It takes a while to load for such a link when the diff is big in the GitHub GUI.",
      "comment_id": 2324803331,
      "user": "nilslindemann",
      "created_at": "2025-09-05T11:12:56Z",
      "url": "https://github.com/fastapi/fastapi/pull/14015#discussion_r2324803331"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14015,
      "file_path": "scripts/translate.py",
      "line": 806,
      "side": "RIGHT",
      "diff_hunk": "@@ -182,39 +783,72 @@ def iter_all_en_paths() -> Iterable[Path]:\n \n \n def iter_en_paths_to_translate() -> Iterable[Path]:\n+    en_docs_root = Path(\"docs/en/docs/\")\n     for path in iter_all_en_paths():\n-        if str(path).replace(\"docs/en/docs/\", \"\").startswith(non_translated_sections):\n-            continue\n-        yield path\n+        relpath = path.relative_to(en_docs_root)\n+        if not str(relpath).startswith(non_translated_sections):\n+            yield path\n \n \n @app.command()\n-def translate_lang(language: Annotated[str, typer.Option(envvar=\"LANGUAGE\")]) -> None:\n-    paths_to_process = list(iter_en_paths_to_translate())\n-    print(\"Original paths:\")\n-    for p in paths_to_process:\n-        print(f\"  - {p}\")\n-    print(f\"Total original paths: {len(paths_to_process)}\")\n+def translate_lang(\n+    language: Annotated[\n+        str,\n+        typer.Option(envvar=\"LANGUAGE\", help=\"Target language, e.g. `es`, `fr`, `de`\"),\n+    ],\n+    mode: Annotated[\n+        str,\n+        typer.Option(\n+            help=\"Which files of the target language to translate, one of: `missing`, `existing`, `all`\"\n+        ),\n+    ] = \"missing\",\n+    verbose: Annotated[bool, typer.Option(help=\"Print all paths\")] = False,\n+    preview: Annotated[",
      "comment": "@YuriiMotov, is it okay for you if I do this and the below issue in a separate PR after this one and the PRs above are resolved? After all, this change does not remove any functionality, so nothing breaks for the moment.",
      "comment_id": 2324830540,
      "user": "nilslindemann",
      "created_at": "2025-09-05T11:25:53Z",
      "url": "https://github.com/fastapi/fastapi/pull/14015#discussion_r2324830540"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 12970,
      "file_path": "fastapi/encoders.py",
      "line": 243,
      "side": "RIGHT",
      "diff_hunk": "@@ -240,7 +240,7 @@ def jsonable_encoder(\n             custom_encoder=encoders,\n             sqlalchemy_safe=sqlalchemy_safe,\n         )\n-    if dataclasses.is_dataclass(obj):\n+    if dataclasses.is_dataclass(type(obj)):",
      "comment": "https://github.com/python/typeshed/blob/e1c74f08f12b8bec6afe266951f0756dc1b43ebe/stdlib/dataclasses.pyi#L217-L223",
      "comment_id": 1854356339,
      "user": "tamird",
      "created_at": "2024-11-22T17:30:12Z",
      "url": "https://github.com/fastapi/fastapi/pull/12970#discussion_r1854356339"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 12970,
      "file_path": "fastapi/encoders.py",
      "line": 243,
      "side": "RIGHT",
      "diff_hunk": "@@ -240,7 +240,7 @@ def jsonable_encoder(\n             custom_encoder=encoders,\n             sqlalchemy_safe=sqlalchemy_safe,\n         )\n-    if dataclasses.is_dataclass(obj):\n+    if dataclasses.is_dataclass(type(obj)):",
      "comment": "I have separated this change into a second commit so that you can see the failure in CI. Please have a look.",
      "comment_id": 1864265876,
      "user": "tamird",
      "created_at": "2024-11-30T14:11:12Z",
      "url": "https://github.com/fastapi/fastapi/pull/12970#discussion_r1864265876"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 9704,
      "file_path": "tests/test_response_model_default_factory.py",
      "line": 15,
      "side": "RIGHT",
      "diff_hunk": "@@ -0,0 +1,52 @@\n+import functools\n+import random\n+\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel, Field\n+\n+app = FastAPI()\n+\n+messages = [\"\u64cd\u4f5c\u6210\u529f.\", \"Successful operation.\"]\n+\n+\n+class ResponseModel(BaseModel):\n+    code: int = 200\n+    message: str = Field(default_factory=functools.partial(random.choice, messages))",
      "comment": "```suggestion\r\n    message: str = Field(default_factory=lambda: \"Successful operation.\")\r\n```",
      "comment_id": 2231038682,
      "user": "YuriiMotov",
      "created_at": "2025-07-25T13:05:43Z",
      "url": "https://github.com/fastapi/fastapi/pull/9704#discussion_r2231038682"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 9704,
      "file_path": "tests/test_response_model_default_factory.py",
      "line": 43,
      "side": "RIGHT",
      "diff_hunk": "@@ -0,0 +1,52 @@\n+import functools\n+import random\n+\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel, Field\n+\n+app = FastAPI()\n+\n+messages = [\"\u64cd\u4f5c\u6210\u529f.\", \"Successful operation.\"]\n+\n+\n+class ResponseModel(BaseModel):\n+    code: int = 200\n+    message: str = Field(default_factory=functools.partial(random.choice, messages))\n+\n+\n+@app.get(\n+    \"/response_model_has_default_factory_return_dict\",\n+    response_model=ResponseModel,\n+)\n+async def response_model_has_default_factory_return_dict():\n+    return {\"code\": 200}\n+\n+\n+@app.get(\n+    \"/response_model_has_default_factory_return_model\",\n+    response_model=ResponseModel,\n+)\n+async def response_model_has_default_factory_return_model():\n+    return ResponseModel()\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_response_model_has_default_factory_return_dict():\n+    response = client.get(\"/response_model_has_default_factory_return_dict\")\n+\n+    assert response.status_code == 200, response.text\n+\n+    assert response.json()[\"code\"] == 200\n+    assert response.json()[\"message\"] in messages",
      "comment": "```suggestion\r\n    assert response.json()[\"message\"] == \"Successful operation.\"\r\n```",
      "comment_id": 2231039999,
      "user": "YuriiMotov",
      "created_at": "2025-07-25T13:06:25Z",
      "url": "https://github.com/fastapi/fastapi/pull/9704#discussion_r2231039999"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 9704,
      "file_path": "tests/test_response_model_default_factory.py",
      "line": 52,
      "side": "RIGHT",
      "diff_hunk": "@@ -0,0 +1,52 @@\n+import functools\n+import random\n+\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel, Field\n+\n+app = FastAPI()\n+\n+messages = [\"\u64cd\u4f5c\u6210\u529f.\", \"Successful operation.\"]\n+\n+\n+class ResponseModel(BaseModel):\n+    code: int = 200\n+    message: str = Field(default_factory=functools.partial(random.choice, messages))\n+\n+\n+@app.get(\n+    \"/response_model_has_default_factory_return_dict\",\n+    response_model=ResponseModel,\n+)\n+async def response_model_has_default_factory_return_dict():\n+    return {\"code\": 200}\n+\n+\n+@app.get(\n+    \"/response_model_has_default_factory_return_model\",\n+    response_model=ResponseModel,\n+)\n+async def response_model_has_default_factory_return_model():\n+    return ResponseModel()\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_response_model_has_default_factory_return_dict():\n+    response = client.get(\"/response_model_has_default_factory_return_dict\")\n+\n+    assert response.status_code == 200, response.text\n+\n+    assert response.json()[\"code\"] == 200\n+    assert response.json()[\"message\"] in messages\n+\n+\n+def test_response_model_has_default_factory_return_model():\n+    response = client.get(\"/response_model_has_default_factory_return_model\")\n+\n+    assert response.status_code == 200, response.text\n+\n+    assert response.json()[\"code\"] == 200\n+    assert response.json()[\"message\"] in messages",
      "comment": "```suggestion\r\n    assert response.json()[\"message\"] == \"Successful operation.\"\r\n```",
      "comment_id": 2231040652,
      "user": "YuriiMotov",
      "created_at": "2025-07-25T13:06:44Z",
      "url": "https://github.com/fastapi/fastapi/pull/9704#discussion_r2231040652"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 9425,
      "file_path": "tests/test_return_none_future_annotations.py",
      "line": 26,
      "side": "RIGHT",
      "diff_hunk": "@@ -0,0 +1,26 @@\n+from __future__ import annotations\n+\n+import http\n+import logging\n+\n+from fastapi import APIRouter, FastAPI\n+from fastapi.testclient import TestClient\n+\n+router = APIRouter()\n+\n+app = FastAPI()\n+\n+\n+@router.get(\"/no-content\", status_code=http.HTTPStatus.NO_CONTENT)\n+def return_no_content() -> None:\n+    logging.info(\"endpoint called\")\n+\n+\n+app.include_router(router)\n+\n+client = TestClient(app)\n+\n+\n+def test_no_content():\n+    response = client.get(\"/no-content\")\n+    assert response.status_code == http.HTTPStatus.NO_CONTENT, response.text",
      "comment": "```suggestion\r\n    assert response.status_code == http.HTTPStatus.NO_CONTENT, response.text\r\n    assert not response.content\r\n```\r\nHow about adding this assertion?",
      "comment_id": 2162519671,
      "user": "YuriiMotov",
      "created_at": "2025-06-23T20:56:47Z",
      "url": "https://github.com/fastapi/fastapi/pull/9425#discussion_r2162519671"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 4972,
      "file_path": "fastapi/encoders.py",
      "line": 55,
      "side": "RIGHT",
      "diff_hunk": "@@ -52,7 +52,7 @@ def jsonable_encoder(\n     if isinstance(obj, BaseModel):\n         encoder = getattr(obj.__config__, \"json_encoders\", {})\n         if custom_encoder:\n-            encoder.update(custom_encoder)\n+            encoder = {**encoder, **custom_encoder}",
      "comment": "Can you explain, how does this fix the `jsonable_encoder` side effect?",
      "comment_id": 892478985,
      "user": "odiseo0",
      "created_at": "2022-06-08T14:45:23Z",
      "url": "https://github.com/fastapi/fastapi/pull/4972#discussion_r892478985"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 4972,
      "file_path": "fastapi/encoders.py",
      "line": 55,
      "side": "RIGHT",
      "diff_hunk": "@@ -52,7 +52,7 @@ def jsonable_encoder(\n     if isinstance(obj, BaseModel):\n         encoder = getattr(obj.__config__, \"json_encoders\", {})\n         if custom_encoder:\n-            encoder.update(custom_encoder)\n+            encoder = {**encoder, **custom_encoder}",
      "comment": "The following snippet from [slackner](https://github.com/slackner) illustrates the side effect in 2 cases:\r\n\r\n- With `print(c)` : side effect from `b = jsonable_encoder(creds, custom_encoder=ENCODERS)` when calling `jsonable_encoder` later on the same instance but with a different custom_encoder\r\n- With `print(d)` : side effect from `b = jsonable_encoder(creds, custom_encoder=ENCODERS)` when calling `jsonable_encoder` later on another instance\r\n\r\n```python\r\nfrom pydantic import BaseModel, SecretStr\r\nfrom fastapi.encoders import jsonable_encoder\r\n\r\n\r\nclass Credentials(BaseModel):\r\n    password: SecretStr\r\n\r\n\r\nENCODERS = {SecretStr: lambda v: v.get_secret_value() if v is not None else None}\r\n\r\ncreds = Credentials(password=\"helloworld\")\r\n\r\na = jsonable_encoder(creds)\r\nprint(a)  # {'password': '**********'}, as expected\r\nb = jsonable_encoder(creds, custom_encoder=ENCODERS)\r\nprint(b)  # {'password': 'helloworld'}, as expected\r\nc = jsonable_encoder(creds)\r\nprint(c)  # gives {'password': 'helloworld'}, but should be {'password': '**********'}?\r\n\r\n\r\ncreds = Credentials(password=\"123456789\")\r\n\r\nd = jsonable_encoder(creds)\r\nprint(d)  # gives {'password': '123456789'}, but should be {'password': '**********'}?\r\n```\r\n\r\nBefore this PR, calling jsonable_encoder with a custom_encoder updates the global \"json_encoders\" config of the model.\r\nAfter this PR, calling jsonable_encoder with a custom_encoer argument only affects the current call",
      "comment_id": 892603230,
      "user": "aboubacs",
      "created_at": "2022-06-08T16:34:14Z",
      "url": "https://github.com/fastapi/fastapi/pull/4972#discussion_r892603230"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13639,
      "file_path": "tests/test_openapi_schema_type.py",
      "line": 38,
      "side": "RIGHT",
      "diff_hunk": "@@ -0,0 +1,50 @@\n+import itertools\n+from typing import List\n+\n+import pytest\n+from fastapi.openapi.constants import TypeValue\n+from fastapi.openapi.models import Schema\n+\n+# Define all possible type values\n+TYPE_VALUES: List[TypeValue] = [\n+    \"array\",\n+    \"boolean\",\n+    \"integer\",\n+    \"null\",\n+    \"number\",\n+    \"object\",\n+    \"string\",\n+]\n+\n+# Generate all combinations of 2 or more types\n+TYPE_COMBINATIONS = [\n+    list(combo)\n+    for size in range(2, len(TYPE_VALUES) + 1)\n+    for combo in itertools.combinations(TYPE_VALUES, size)\n+]\n+\n+\n+@pytest.mark.parametrize(\"type_val\", TYPE_VALUES)\n+def test_schema_type_single_type_value(type_val: TypeValue) -> None:\n+    \"\"\"Test that Schema accepts single TypeValue for type field.\"\"\"\n+    schema = Schema(type=type_val)\n+    assert schema.type == type_val\n+\n+\n+@pytest.mark.parametrize(\"type_list\", TYPE_COMBINATIONS)\n+def test_schema_type_multiple_type_value(type_list: List[TypeValue]) -> None:\n+    \"\"\"Test all possible combinations of TypeValue for Schema type field.\"\"\"\n+    schema = Schema(type=type_list)\n+    assert schema.type == type_list",
      "comment": "```suggestion\r\ndef test_schema_type_multiple_type_value() -> None:\r\n    \"\"\"Test all possible values of TypeValue for Schema type field.\"\"\"\r\n    schema = Schema(type=TYPE_VALUES)\r\n    assert schema.type == TYPE_VALUES\r\n```\r\n\r\nI think now it's too much tests for such small feature. \ud83e\udd23\r\nLet's just test one combination of all possible values?",
      "comment_id": 2228756723,
      "user": "YuriiMotov",
      "created_at": "2025-07-24T14:51:40Z",
      "url": "https://github.com/fastapi/fastapi/pull/13639#discussion_r2228756723"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13639,
      "file_path": "tests/test_openapi_schema_type.py",
      "line": 24,
      "side": "RIGHT",
      "diff_hunk": "@@ -0,0 +1,27 @@\n+from typing import List, Optional, Union\n+\n+import pytest\n+from fastapi.openapi.constants import TypeValue\n+from fastapi.openapi.models import Schema\n+\n+\n+@pytest.mark.parametrize(\n+    \"type_value\",\n+    [\n+        \"array\",\n+        [\"string\", \"null\"],\n+        None,\n+    ],\n+)\n+def test_allowed_schema_type(\n+    type_value: Optional[Union[TypeValue, List[TypeValue]]],\n+) -> None:\n+    \"\"\"Test that Schema accepts TypeValue, List[TypeValue] and None for type field.\"\"\"\n+    schema = Schema(type=type_value)\n+    assert schema.type == type_value\n+\n+\n+def test_invlid_type_value() -> None:",
      "comment": "```suggestion\r\ndef test_invalid_type_value() -> None:\r\n```",
      "comment_id": 2229423740,
      "user": "YuriiMotov",
      "created_at": "2025-07-24T19:39:59Z",
      "url": "https://github.com/fastapi/fastapi/pull/13639#discussion_r2229423740"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13713,
      "file_path": "fastapi/applications.py",
      "line": 819,
      "side": "RIGHT",
      "diff_hunk": "@@ -810,6 +810,47 @@ class Item(BaseModel):\n                 \"\"\"\n             ),\n         ] = True,\n+        openapi_external_docs: Annotated[\n+            Optional[Dict[str, Any]],\n+            Doc(\n+                \"\"\"\n+                This field allows you to provide additional external documentation links\n+                for an API operation or component. It\u2019s an optional field and can be added\n+                to an operation or a tag. If provided, it must be a dictionary containing:",
      "comment": "```suggestion\r\n                This field allows you to provide additional external documentation links.\r\n                If provided, it must be a dictionary containing:\r\n```",
      "comment_id": 2210694116,
      "user": "YuriiMotov",
      "created_at": "2025-07-16T15:04:15Z",
      "url": "https://github.com/fastapi/fastapi/pull/13713#discussion_r2210694116"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13713,
      "file_path": "fastapi/applications.py",
      "line": 822,
      "side": "RIGHT",
      "diff_hunk": "@@ -810,6 +810,47 @@ class Item(BaseModel):\n                 \"\"\"\n             ),\n         ] = True,\n+        openapi_external_docs: Annotated[\n+            Optional[Dict[str, Any]],\n+            Doc(\n+                \"\"\"\n+                This field allows you to provide additional external documentation links\n+                for an API operation or component. It\u2019s an optional field and can be added\n+                to an operation or a tag. If provided, it must be a dictionary containing:\n+\n+                * `description`: A brief description of the external documentation, which may use\n+                [CommonMark syntax](https://commonmark.org/) for rich text formatting.",
      "comment": "I think we need to make sure it works (CommonMark syntax for rich text formatting)",
      "comment_id": 2210700949,
      "user": "YuriiMotov",
      "created_at": "2025-07-16T15:07:13Z",
      "url": "https://github.com/fastapi/fastapi/pull/13713#discussion_r2210700949"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13713,
      "file_path": "fastapi/applications.py",
      "line": 841,
      "side": "RIGHT",
      "diff_hunk": "@@ -810,6 +810,47 @@ class Item(BaseModel):\n                 \"\"\"\n             ),\n         ] = True,\n+        openapi_external_docs: Annotated[\n+            Optional[Dict[str, Any]],\n+            Doc(\n+                \"\"\"\n+                This field allows you to provide additional external documentation links\n+                for an API operation or component. It\u2019s an optional field and can be added\n+                to an operation or a tag. If provided, it must be a dictionary containing:\n+\n+                * `description`: A brief description of the external documentation, which may use\n+                [CommonMark syntax](https://commonmark.org/) for rich text formatting.\n+                * `url`: The URL pointing to the external documentation. The value **MUST**\n+                be a valid URL format.\n+\n+                **Example**:\n+\n+                ```python\n+                from fastapi import FastAPI\n+                from typing import Dict, Any\n+                from typing import Optional\n+                from fastapi.openapi.models import Doc\n+                from typing_extensions import Annotated\n+\n+                external_docs: Annotated[Optional[Dict[str, Any]], Doc()] = {\n+                    \"description\": \"Detailed API Reference\",\n+                    \"url\": \"https://example.com/api-docs\",\n+                }\n+\n+                app = FastAPI(openapi_external_docs=external_docs)\n+",
      "comment": "```suggestion\r\n                from fastapi import FastAPI\r\n\r\n                external_docs = {\r\n                    \"description\": \"Detailed API Reference\",\r\n                    \"url\": \"https://example.com/api-docs\",\r\n                }\r\n\r\n                app = FastAPI(openapi_external_docs=external_docs)\r\n```\r\nNo need to specify type explicitly here",
      "comment_id": 2210706514,
      "user": "YuriiMotov",
      "created_at": "2025-07-16T15:09:35Z",
      "url": "https://github.com/fastapi/fastapi/pull/13713#discussion_r2210706514"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13713,
      "file_path": "fastapi/applications.py",
      "line": 850,
      "side": "RIGHT",
      "diff_hunk": "@@ -810,6 +810,47 @@ class Item(BaseModel):\n                 \"\"\"\n             ),\n         ] = True,\n+        openapi_external_docs: Annotated[\n+            Optional[Dict[str, Any]],\n+            Doc(\n+                \"\"\"\n+                This field allows you to provide additional external documentation links\n+                for an API operation or component. It\u2019s an optional field and can be added\n+                to an operation or a tag. If provided, it must be a dictionary containing:\n+\n+                * `description`: A brief description of the external documentation, which may use\n+                [CommonMark syntax](https://commonmark.org/) for rich text formatting.\n+                * `url`: The URL pointing to the external documentation. The value **MUST**\n+                be a valid URL format.\n+\n+                **Example**:\n+\n+                ```python\n+                from fastapi import FastAPI\n+                from typing import Dict, Any\n+                from typing import Optional\n+                from fastapi.openapi.models import Doc\n+                from typing_extensions import Annotated\n+\n+                external_docs: Annotated[Optional[Dict[str, Any]], Doc()] = {\n+                    \"description\": \"Detailed API Reference\",\n+                    \"url\": \"https://example.com/api-docs\",\n+                }\n+\n+                app = FastAPI(openapi_external_docs=external_docs)\n+\n+                ```\n+\n+                ### Explanation:\n+                - `description`: Provides a short description explaining what this external documentation covers.\n+                - `url`: Points to the full external documentation.\n+\n+                **Notes**:\n+                - This field is **optional**; if not included, no external documentation will be linked.\n+                - You can use this feature to link to full API documentation, tutorials, or any other",
      "comment": "```suggestion\r\n```\r\nI think we don't need this. The above explanation should be enough",
      "comment_id": 2210711862,
      "user": "YuriiMotov",
      "created_at": "2025-07-16T15:11:10Z",
      "url": "https://github.com/fastapi/fastapi/pull/13713#discussion_r2210711862"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13713,
      "file_path": "tests/test_openapi_examples.py",
      "line": 13,
      "side": "RIGHT",
      "diff_hunk": "@@ -5,7 +5,12 @@\n from fastapi.testclient import TestClient\n from pydantic import BaseModel\n \n-app = FastAPI()\n+external_docs = {\n+    \"description\": \"External API documentation.\",\n+    \"url\": \"https://docs.example.com/api-general\",\n+}\n+\n+app = FastAPI(openapi_external_docs=external_docs)",
      "comment": "Not sure this is right place for this. Maybe add this to `tests/main.py` and test in `tests/test_application.py`?",
      "comment_id": 2210726845,
      "user": "YuriiMotov",
      "created_at": "2025-07-16T15:14:24Z",
      "url": "https://github.com/fastapi/fastapi/pull/13713#discussion_r2210726845"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13713,
      "file_path": "tests/test_openapi_examples.py",
      "line": 13,
      "side": "RIGHT",
      "diff_hunk": "@@ -5,7 +5,12 @@\n from fastapi.testclient import TestClient\n from pydantic import BaseModel\n \n-app = FastAPI()\n+external_docs = {\n+    \"description\": \"External API documentation.\",\n+    \"url\": \"https://docs.example.com/api-general\",\n+}\n+\n+app = FastAPI(openapi_external_docs=external_docs)",
      "comment": "Hi Yurii, thanks a lot for your comments\u2014I really appreciate you taking the time to review this!\r\n\r\nCould you help me understand a bit more why you think this might not be the right place for the example? It seemed like a good fit to include it here, since the file is already dedicated to OpenAPI scenarios and includes examples that demonstrate the various OpenAPI-related options and attributes.",
      "comment_id": 2214533550,
      "user": "cmtoro",
      "created_at": "2025-07-18T00:02:35Z",
      "url": "https://github.com/fastapi/fastapi/pull/13713#discussion_r2214533550"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13713,
      "file_path": "tests/test_openapi_examples.py",
      "line": 13,
      "side": "RIGHT",
      "diff_hunk": "@@ -5,7 +5,12 @@\n from fastapi.testclient import TestClient\n from pydantic import BaseModel\n \n-app = FastAPI()\n+external_docs = {\n+    \"description\": \"External API documentation.\",\n+    \"url\": \"https://docs.example.com/api-general\",\n+}\n+\n+app = FastAPI(openapi_external_docs=external_docs)",
      "comment": "Hi @cmtoro! You are welcome!\r\n\r\n`test_openapi_examples.py` is intended to test `examples` and `openapi_examples` parameters. Look at tests that are already there and you will see that all of them are about these parameters.\r\n\r\n`tests/main.py` includes a lot of different use-cases and `tests/test_application.py` tests openapi schema of app from `tests/main.py`.",
      "comment_id": 2215173315,
      "user": "YuriiMotov",
      "created_at": "2025-07-18T06:58:45Z",
      "url": "https://github.com/fastapi/fastapi/pull/13713#discussion_r2215173315"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14077,
      "file_path": "docs_src/handling_errors/tutorial005.py",
      "line": 15,
      "side": "RIGHT",
      "diff_hunk": "@@ -10,7 +10,9 @@\n @app.exception_handler(RequestValidationError)\n async def validation_exception_handler(request: Request, exc: RequestValidationError):\n     return JSONResponse(\n-        status_code=status.HTTP_422_UNPROCESSABLE_ENTITY,\n+        # 422 = fastapi.status.HTTP_422_UNPROCESSABLE_CONTENT (RFC 9110,\n+        # Starlette >=0.48), previously HTTP_422_UNPROCESSABLE_ENTITY\n+        status_code=422,",
      "comment": "We have to be carefull here, this script is referenced in the docs [here](https://fastapi.tiangolo.com/tutorial/handling-errors/#use-the-requestvalidationerror-body), and by adding more lines, the wrong line will be highlighted in the docs (used to be L14 which is now L16).\r\n\r\nAnyway, I don't think we need this comment here, or elsewhere where we're switching to 422. Let's just edit to `status_code=422` without the comments.",
      "comment_id": 2349101580,
      "user": "svlandeg",
      "created_at": "2025-09-15T13:58:01Z",
      "url": "https://github.com/fastapi/fastapi/pull/14077#discussion_r2349101580"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 14077,
      "file_path": "docs_src/handling_errors/tutorial005.py",
      "line": 15,
      "side": "RIGHT",
      "diff_hunk": "@@ -10,7 +10,9 @@\n @app.exception_handler(RequestValidationError)\n async def validation_exception_handler(request: Request, exc: RequestValidationError):\n     return JSONResponse(\n-        status_code=status.HTTP_422_UNPROCESSABLE_ENTITY,\n+        # 422 = fastapi.status.HTTP_422_UNPROCESSABLE_CONTENT (RFC 9110,\n+        # Starlette >=0.48), previously HTTP_422_UNPROCESSABLE_ENTITY\n+        status_code=422,",
      "comment": "> We have to be carefull here, this script is referenced in the docs [here](https://fastapi.tiangolo.com/tutorial/handling-errors/#use-the-requestvalidationerror-body), and by adding more lines, the wrong line will be highlighted in the docs (used to be L14 which is now L16).\r\n> \r\n> Anyway, I don't think we need this comment here, or elsewhere where we're switching to 422. Let's just edit to `status_code=422` without the comments.\r\n\r\nThanks. Your comment-removal commit looks good.",
      "comment_id": 2351646324,
      "user": "musicinmybrain",
      "created_at": "2025-09-16T09:21:29Z",
      "url": "https://github.com/fastapi/fastapi/pull/14077#discussion_r2351646324"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13259,
      "file_path": "docs_src/app_testing/tutorial003.py",
      "line": 24,
      "side": "RIGHT",
      "diff_hunk": "@@ -1,15 +1,27 @@\n+from contextlib import asynccontextmanager\n+\n from fastapi import FastAPI\n from fastapi.testclient import TestClient\n \n-app = FastAPI()\n-\n items = {}\n \n \n-@app.on_event(\"startup\")\n-async def startup_event():\n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n     items[\"foo\"] = {\"name\": \"Fighters\"}\n     items[\"bar\"] = {\"name\": \"Tenders\"}\n+    yield\n+    # clean up items or other work\n+    ...\n+\n+\n+app = FastAPI(lifespan=lifespan)\n+\n+# startup event and shutdown event are deprecated, you should use lifespan instead\n+# @app.on_event(\"startup\")\n+# async def startup_event():\n+#     items[\"foo\"] = {\"name\": \"Fighters\"}\n+#     items[\"bar\"] = {\"name\": \"Tenders\"}",
      "comment": "To ensure the code with startup\\shutdown is still tested, I would split this code example into two separate: first is for `lifespan`, second is for `startup` and `shutdown`.\r\nWe can add the warning that it's deprecated outside the code block.\r\nWhat do you think?",
      "comment_id": 2206838994,
      "user": "YuriiMotov",
      "created_at": "2025-07-15T08:34:15Z",
      "url": "https://github.com/fastapi/fastapi/pull/13259#discussion_r2206838994"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13259,
      "file_path": "docs_src/app_testing/tutorial003.py",
      "line": 24,
      "side": "RIGHT",
      "diff_hunk": "@@ -1,15 +1,27 @@\n+from contextlib import asynccontextmanager\n+\n from fastapi import FastAPI\n from fastapi.testclient import TestClient\n \n-app = FastAPI()\n-\n items = {}\n \n \n-@app.on_event(\"startup\")\n-async def startup_event():\n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n     items[\"foo\"] = {\"name\": \"Fighters\"}\n     items[\"bar\"] = {\"name\": \"Tenders\"}\n+    yield\n+    # clean up items or other work\n+    ...\n+\n+\n+app = FastAPI(lifespan=lifespan)\n+\n+# startup event and shutdown event are deprecated, you should use lifespan instead\n+# @app.on_event(\"startup\")\n+# async def startup_event():\n+#     items[\"foo\"] = {\"name\": \"Fighters\"}\n+#     items[\"bar\"] = {\"name\": \"Tenders\"}",
      "comment": "Look at the original code of `tests/test_tutorial/test_testing/test_tutorial003.py`:\r\n```python\r\ndef test_main():\r\n    with pytest.warns(DeprecationWarning):\r\n        from docs_src.app_testing.tutorial003 import test_read_items\r\n    test_read_items()\r\n```",
      "comment_id": 2207159264,
      "user": "YuriiMotov",
      "created_at": "2025-07-15T11:01:01Z",
      "url": "https://github.com/fastapi/fastapi/pull/13259#discussion_r2207159264"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13259,
      "file_path": "docs_src/app_testing/tutorial003.py",
      "line": 24,
      "side": "RIGHT",
      "diff_hunk": "@@ -1,15 +1,27 @@\n+from contextlib import asynccontextmanager\n+\n from fastapi import FastAPI\n from fastapi.testclient import TestClient\n \n-app = FastAPI()\n-\n items = {}\n \n \n-@app.on_event(\"startup\")\n-async def startup_event():\n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n     items[\"foo\"] = {\"name\": \"Fighters\"}\n     items[\"bar\"] = {\"name\": \"Tenders\"}\n+    yield\n+    # clean up items or other work\n+    ...\n+\n+\n+app = FastAPI(lifespan=lifespan)\n+\n+# startup event and shutdown event are deprecated, you should use lifespan instead\n+# @app.on_event(\"startup\")\n+# async def startup_event():\n+#     items[\"foo\"] = {\"name\": \"Fighters\"}\n+#     items[\"bar\"] = {\"name\": \"Tenders\"}",
      "comment": "oh! I missed this.\r\n\r\nSorry, I basically forgot the content of this PR...hh",
      "comment_id": 2207165455,
      "user": "z0z0r4",
      "created_at": "2025-07-15T11:04:39Z",
      "url": "https://github.com/fastapi/fastapi/pull/13259#discussion_r2207165455"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 11441,
      "file_path": "docs_src/advanced_middleware/tutorial002.py",
      "line": 9,
      "side": "RIGHT",
      "diff_hunk": "@@ -4,7 +4,9 @@\n app = FastAPI()\n \n app.add_middleware(\n-    TrustedHostMiddleware, allowed_hosts=[\"example.com\", \"*.example.com\"]\n+    TrustedHostMiddleware,\n+    allowed_hosts=[\"example.com\", \"*.example.com\"],\n+    www_redirect=True,",
      "comment": "```suggestion\r\n    TrustedHostMiddleware, allowed_hosts=[\"example.com\", \"*.example.com\"]\r\n```\r\nI think there is no need to pass default value here",
      "comment_id": 2222194867,
      "user": "YuriiMotov",
      "created_at": "2025-07-22T11:08:52Z",
      "url": "https://github.com/fastapi/fastapi/pull/11441#discussion_r2222194867"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13114,
      "file_path": "tests/test_tutorial/test_custom_request_and_route/test_tutorial002.py",
      "line": 31,
      "side": "RIGHT",
      "diff_hunk": "@@ -14,6 +14,21 @@ def test_endpoint_works():\n def test_exception_handler_body_access():\n     response = client.post(\"/\", json={\"numbers\": [1, 2, 3]})\n     assert response.json() == IsDict(\n+        # httpx 0.28.0 switches to compact JSON https://github.com/encode/httpx/issues/3363\n+        {\n+            \"detail\": {\n+                \"errors\": [\n+                    {\n+                        \"type\": \"list_type\",\n+                        \"loc\": [\"body\"],\n+                        \"msg\": \"Input should be a valid list\",\n+                        \"input\": {\"numbers\": [1, 2, 3]},\n+                    }\n+                ],\n+                \"body\": '{\"numbers\":[1,2,3]}',\n+            }\n+        }\n+    ) | IsDict(",
      "comment": "We can avoid duplicating this with the help of `dirty_equals.IsOneOf`:\r\n```python\r\n        {\r\n            \"detail\": {\r\n                \"errors\": [\r\n                    {\r\n                        \"type\": \"list_type\",\r\n                        \"loc\": [\"body\"],\r\n                        \"msg\": \"Input should be a valid list\",\r\n                        \"input\": {\"numbers\": [1, 2, 3]},\r\n                    }\r\n                ],\r\n                \"body\": IsOneOf('{\"numbers\": [1, 2, 3]}', '{\"numbers\":[1,2,3]}'),\r\n            }\r\n        }\r\n\r\n```",
      "comment_id": 2206602037,
      "user": "YuriiMotov",
      "created_at": "2025-07-15T07:08:50Z",
      "url": "https://github.com/fastapi/fastapi/pull/13114#discussion_r2206602037"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 11460,
      "file_path": "fastapi/security/oauth2.py",
      "line": 476,
      "side": "RIGHT",
      "diff_hunk": "@@ -457,11 +457,24 @@ def __init__(\n                 \"\"\"\n             ),\n         ] = True,\n+        refreshUrl: Annotated[\n+            Optional[str],\n+            Doc(\n+                \"\"\"\n+                The URL to refresh the token and obtain a new one.\n+                \"\"\"\n+            ),\n+        ] = None,\n     ):\n         if not scopes:\n             scopes = {}\n         flows = OAuthFlowsModel(\n-            password=cast(Any, {\"tokenUrl\": tokenUrl, \"scopes\": scopes})\n+            password=cast(\n+                Any,\n+                {\"tokenUrl\": tokenUrl, \"refreshUrl\": refreshUrl, \"scopes\": scopes}\n+                if refreshUrl\n+                else {\"tokenUrl\": tokenUrl, \"scopes\": scopes},",
      "comment": "```suggestion\r\n                {\r\n                    \"tokenUrl\": tokenUrl,\r\n                    \"refreshUrl\": refreshUrl,\r\n                    \"scopes\": scopes,\r\n                },\r\n```\r\n\r\nI think it would be better to remove duplication and keep this in line with the implementation of `OAuth2AuthorizationCodeBearer`.\r\n\r\nAlternatively,\r\n```python\r\n        schema = {\"tokenUrl\": tokenUrl, \"scopes\": scopes}\r\n        if refreshUrl:\r\n            schema[\"refreshUrl\"] = refreshUrl\r\n        flows = OAuthFlowsModel(password=cast(Any, schema))\r\n```",
      "comment_id": 2135787579,
      "user": "YuriiMotov",
      "created_at": "2025-06-09T14:03:48Z",
      "url": "https://github.com/fastapi/fastapi/pull/11460#discussion_r2135787579"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 12534,
      "file_path": "tests/utils.py",
      "line": 21,
      "side": "RIGHT",
      "diff_hunk": "@@ -2,10 +2,33 @@\n \n import pytest\n from fastapi._compat import PYDANTIC_V2\n+from inline_snapshot import Snapshot\n \n needs_py39 = pytest.mark.skipif(sys.version_info < (3, 9), reason=\"requires python3.9+\")\n needs_py310 = pytest.mark.skipif(\n     sys.version_info < (3, 10), reason=\"requires python3.10+\"\n )\n needs_pydanticv2 = pytest.mark.skipif(not PYDANTIC_V2, reason=\"requires Pydantic v2\")\n needs_pydanticv1 = pytest.mark.skipif(PYDANTIC_V2, reason=\"requires Pydantic v1\")\n+\n+\n+def pydantic_snapshot(\n+    *,\n+    v2: Snapshot,\n+    v1: Snapshot,\n+):\n+    \"\"\"\n+    this function should be used like:",
      "comment": "```suggestion\r\n    This function should be used like this:\r\n```",
      "comment_id": 2018991952,
      "user": "svlandeg",
      "created_at": "2025-03-28T16:33:41Z",
      "url": "https://github.com/fastapi/fastapi/pull/12534#discussion_r2018991952"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 12534,
      "file_path": "tests/utils.py",
      "line": 27,
      "side": "RIGHT",
      "diff_hunk": "@@ -2,10 +2,33 @@\n \n import pytest\n from fastapi._compat import PYDANTIC_V2\n+from inline_snapshot import Snapshot\n \n needs_py39 = pytest.mark.skipif(sys.version_info < (3, 9), reason=\"requires python3.9+\")\n needs_py310 = pytest.mark.skipif(\n     sys.version_info < (3, 10), reason=\"requires python3.10+\"\n )\n needs_pydanticv2 = pytest.mark.skipif(not PYDANTIC_V2, reason=\"requires Pydantic v2\")\n needs_pydanticv1 = pytest.mark.skipif(PYDANTIC_V2, reason=\"requires Pydantic v1\")\n+\n+\n+def pydantic_snapshot(\n+    *,\n+    v2: Snapshot,\n+    v1: Snapshot,\n+):\n+    \"\"\"\n+    this function should be used like:\n+\n+    >>> assert value == pydantic_snapshot(v2=snapshot(),v1=snapshot())\n+\n+    inline-snapshot will create the snapshots when pytest is executed for each versions of pydantic.\n+\n+    It is also possible to use the function inside snapshots for version specific values.",
      "comment": "```suggestion\r\n    It is also possible to use the function inside snapshots for version-specific values.\r\n```",
      "comment_id": 2018992835,
      "user": "svlandeg",
      "created_at": "2025-03-28T16:34:13Z",
      "url": "https://github.com/fastapi/fastapi/pull/12534#discussion_r2018992835"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 12534,
      "file_path": "tests/utils.py",
      "line": 31,
      "side": "RIGHT",
      "diff_hunk": "@@ -2,10 +2,33 @@\n \n import pytest\n from fastapi._compat import PYDANTIC_V2\n+from inline_snapshot import Snapshot\n \n needs_py39 = pytest.mark.skipif(sys.version_info < (3, 9), reason=\"requires python3.9+\")\n needs_py310 = pytest.mark.skipif(\n     sys.version_info < (3, 10), reason=\"requires python3.10+\"\n )\n needs_pydanticv2 = pytest.mark.skipif(not PYDANTIC_V2, reason=\"requires Pydantic v2\")\n needs_pydanticv1 = pytest.mark.skipif(PYDANTIC_V2, reason=\"requires Pydantic v1\")\n+\n+\n+def pydantic_snapshot(\n+    *,\n+    v2: Snapshot,\n+    v1: Snapshot,\n+):\n+    \"\"\"\n+    this function should be used like:\n+\n+    >>> assert value == pydantic_snapshot(v2=snapshot(),v1=snapshot())\n+\n+    inline-snapshot will create the snapshots when pytest is executed for each versions of pydantic.\n+\n+    It is also possible to use the function inside snapshots for version specific values.\n+\n+    >>> assert value == snapshot({\n+        \"data\": \"some data\",\n+        \"vesion_specific\": pydantic_snapshot(v2=snapshot(),v1=snapshot()),",
      "comment": "```suggestion\r\n        \"version_specific\": pydantic_snapshot(v2=snapshot(),v1=snapshot()),\r\n```",
      "comment_id": 2018993151,
      "user": "svlandeg",
      "created_at": "2025-03-28T16:34:28Z",
      "url": "https://github.com/fastapi/fastapi/pull/12534#discussion_r2018993151"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 12534,
      "file_path": "tests/test_tutorial/test_cookie_param_models/test_tutorial002.py",
      "line": 76,
      "side": "LEFT",
      "diff_hunk": "@@ -71,9 +77,8 @@ def test_cookie_param_model_invalid(client: TestClient):\n                     }\n                 ]\n             }\n-        )\n-        | IsDict(\n-            # TODO: remove when deprecating Pydantic v1",
      "comment": "Can we add it to the function? \r\n\r\n\"Remove v1 argument when deprecating Pydantic v1\"\r\n\r\nMaybe we can use [codecrumbs](https://15r10nk.github.io/codecrumbs/introduction/) in the future to clean things up. \r\n\r\nThere are a lot of refactorings missing which would be needed for this. But it would be a reason to continue this project :-) \r\n",
      "comment_id": 2019206861,
      "user": "15r10nk",
      "created_at": "2025-03-28T19:13:51Z",
      "url": "https://github.com/fastapi/fastapi/pull/12534#discussion_r2019206861"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 12534,
      "file_path": "tests/test_tutorial/test_sql_databases/test_tutorial002.py",
      "line": 120,
      "side": "RIGHT",
      "diff_hunk": "@@ -117,14 +117,14 @@ def test_crud_app(client: TestClient):\n         )\n         assert response.status_code == 200, response.text\n         assert response.json() == snapshot(\n-            {\"name\": \"Dog Pond\", \"age\": None, \"id\": hero_id}\n+            {\"name\": \"Dog Pond\", \"age\": None, \"id\": Is(hero_id)}",
      "comment": "inline-snapshot tries to manage everything within `snapshot()` and wants to [update](https://15r10nk.github.io/inline-snapshot/latest/categories/#update) the changes back to the code which it things is correct. \r\n\r\nThe user can take control back by using dirty-equals or Is(). \r\ninline-snapshot will also not fix `Is(hero_id)` in the future when the hero_id is not equal any more (tests fail for some reason). It preserves the changes made by the developer and does not revert them.\r\n\r\nIt makes things easier to implement, makes it easier to understand what happens in some cases and provides a distinction between code which is written by inline-snapshot and code which is written by the developer. ",
      "comment_id": 2019226192,
      "user": "15r10nk",
      "created_at": "2025-03-28T19:27:02Z",
      "url": "https://github.com/fastapi/fastapi/pull/12534#discussion_r2019226192"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 12534,
      "file_path": "tests/utils.py",
      "line": 18,
      "side": "RIGHT",
      "diff_hunk": "@@ -2,10 +2,33 @@\n \n import pytest\n from fastapi._compat import PYDANTIC_V2\n+from inline_snapshot import Snapshot\n \n needs_py39 = pytest.mark.skipif(sys.version_info < (3, 9), reason=\"requires python3.9+\")\n needs_py310 = pytest.mark.skipif(\n     sys.version_info < (3, 10), reason=\"requires python3.10+\"\n )\n needs_pydanticv2 = pytest.mark.skipif(not PYDANTIC_V2, reason=\"requires Pydantic v2\")\n needs_pydanticv1 = pytest.mark.skipif(PYDANTIC_V2, reason=\"requires Pydantic v1\")\n+\n+\n+def pydantic_snapshot(\n+    *,\n+    v2: Snapshot,\n+    v1: Snapshot,  # Remove v1 argument when deprecating Pydantic v1",
      "comment": "```suggestion\r\n    v1: Snapshot,  #TODO: remove v1 argument when deprecating Pydantic v1\r\n```\r\n(in same format as other TODO's to facilitate simple ctrl-F'ing \ud83d\ude09 )",
      "comment_id": 2049283068,
      "user": "svlandeg",
      "created_at": "2025-04-17T16:21:22Z",
      "url": "https://github.com/fastapi/fastapi/pull/12534#discussion_r2049283068"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 12534,
      "file_path": "tests/utils.py",
      "line": 18,
      "side": "RIGHT",
      "diff_hunk": "@@ -2,10 +2,33 @@\n \n import pytest\n from fastapi._compat import PYDANTIC_V2\n+from inline_snapshot import Snapshot\n \n needs_py39 = pytest.mark.skipif(sys.version_info < (3, 9), reason=\"requires python3.9+\")\n needs_py310 = pytest.mark.skipif(\n     sys.version_info < (3, 10), reason=\"requires python3.10+\"\n )\n needs_pydanticv2 = pytest.mark.skipif(not PYDANTIC_V2, reason=\"requires Pydantic v2\")\n needs_pydanticv1 = pytest.mark.skipif(PYDANTIC_V2, reason=\"requires Pydantic v1\")\n+\n+\n+def pydantic_snapshot(\n+    *,\n+    v2: Snapshot,\n+    v1: Snapshot,  #TODO: remove v1 argument when deprecating Pydantic v1",
      "comment": "```suggestion\r\n    v1: Snapshot,  # TODO: remove v1 argument when deprecating Pydantic v1\r\n```",
      "comment_id": 2049290915,
      "user": "svlandeg",
      "created_at": "2025-04-17T16:23:26Z",
      "url": "https://github.com/fastapi/fastapi/pull/12534#discussion_r2049290915"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 2939,
      "file_path": "tests/test_security_http_digest_optional.py",
      "line": 40,
      "side": "LEFT",
      "diff_hunk": "@@ -66,5 +66,5 @@ def test_security_http_digest_incorrect_scheme_credentials():\n     response = client.get(\n         \"/users/me\", headers={\"Authorization\": \"Other invalidauthorization\"}\n     )\n-    assert response.status_code == 403, response.text",
      "comment": "This is the \"optional\" test suite, the exception is tested here: https://github.com/arthurio/fastapi/blob/digest-except/tests/test_security_http_digest.py",
      "comment_id": 593533262,
      "user": "arthurio",
      "created_at": "2021-03-13T01:04:46Z",
      "url": "https://github.com/fastapi/fastapi/pull/2939#discussion_r593533262"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 2939,
      "file_path": "tests/test_security_http_digest_optional.py",
      "line": 40,
      "side": "LEFT",
      "diff_hunk": "@@ -66,5 +66,5 @@ def test_security_http_digest_incorrect_scheme_credentials():\n     response = client.get(\n         \"/users/me\", headers={\"Authorization\": \"Other invalidauthorization\"}\n     )\n-    assert response.status_code == 403, response.text",
      "comment": "@juntatalor Is there anything else you need to move forward?",
      "comment_id": 647126669,
      "user": "arthurio",
      "created_at": "2021-06-08T05:42:45Z",
      "url": "https://github.com/fastapi/fastapi/pull/2939#discussion_r647126669"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 2939,
      "file_path": "fastapi/security/http.py",
      "line": 421,
      "side": "RIGHT",
      "diff_hunk": "@@ -158,8 +158,11 @@ async def __call__(\n             else:\n                 return None\n         if scheme.lower() != \"digest\":\n-            raise HTTPException(\n-                status_code=HTTP_403_FORBIDDEN,\n-                detail=\"Invalid authentication credentials\",\n-            )\n+            if self.auto_error:\n+                raise HTTPException(\n+                    status_code=HTTP_403_FORBIDDEN,\n+                    detail=\"Invalid authentication credentials\",\n+                )\n+            else:",
      "comment": "Good point, I removed the extra statements in the rest of the file as well.",
      "comment_id": 780702414,
      "user": "arthurio",
      "created_at": "2022-01-08T19:40:59Z",
      "url": "https://github.com/fastapi/fastapi/pull/2939#discussion_r780702414"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 2939,
      "file_path": "fastapi/security/http.py",
      "line": 421,
      "side": "RIGHT",
      "diff_hunk": "@@ -158,8 +158,11 @@ async def __call__(\n             else:\n                 return None\n         if scheme.lower() != \"digest\":\n-            raise HTTPException(\n-                status_code=HTTP_403_FORBIDDEN,\n-                detail=\"Invalid authentication credentials\",\n-            )\n+            if self.auto_error:\n+                raise HTTPException(\n+                    status_code=HTTP_403_FORBIDDEN,\n+                    detail=\"Invalid authentication credentials\",\n+                )\n+            else:",
      "comment": "While I see the point, let's stick to the original code formatting throughout this file. Mostly this is a matter of personal preference: while the `else` is technically unnecessary, writing it out may provide more code clarity and robustness against future changes (image ever removing the `raise` statement from the `if` part). \r\n\r\nEither way, not making this additional change in this PR makes the contribution more minimal and easier to review \ud83d\ude4f ",
      "comment_id": 1971170455,
      "user": "svlandeg",
      "created_at": "2025-02-26T08:46:23Z",
      "url": "https://github.com/fastapi/fastapi/pull/2939#discussion_r1971170455"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13182,
      "file_path": "tests/test_tutorial/test_request_files/test_tutorial003.py",
      "line": 39,
      "side": "RIGHT",
      "diff_hunk": "@@ -1,11 +1,45 @@\n+import importlib\n+\n+import pytest\n+from fastapi import FastAPI\n from fastapi.testclient import TestClient\n \n-from docs_src.request_files.tutorial003 import app\n+from ...utils import needs_py39\n+\n+\n+@pytest.fixture(\n+    name=\"app\",\n+    params=[\n+        \"tutorial003\",\n+        \"tutorial003_an\",\n+        pytest.param(\"tutorial003_py39\", marks=needs_py39),\n+        pytest.param(\"tutorial003_an_py39\", marks=needs_py39),\n+    ],\n+)\n+def get_app(request: pytest.FixtureRequest):\n+    mod = importlib.import_module(f\"docs_src.request_files.{request.param}\")\n+\n+    return mod.app\n+\n+\n+@pytest.fixture(name=\"client\")\n+def get_client(app: FastAPI):\n+    client = TestClient(app)\n+    return client\n+\n \n-client = TestClient(app)\n+file_required = {\n+    \"detail\": [\n+        {\n+            \"loc\": [\"body\", \"files\"],\n+            \"msg\": \"field required\",\n+            \"type\": \"value_error.missing\",\n+        }\n+    ]\n+}",
      "comment": "```suggestion\r\n```\r\n\r\nIs this needed? :thinking: \r\n\r\nI suspect this was copy-pasted from the other file and it was no longer needed there either. :sweat_smile: \r\n\r\nBut in that case, we could remove it now. :fire: ",
      "comment_id": 1921483769,
      "user": "tiangolo",
      "created_at": "2025-01-19T06:41:22Z",
      "url": "https://github.com/fastapi/fastapi/pull/13182#discussion_r1921483769"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13183,
      "file_path": "tests/test_tutorial/test_request_form_models/test_tutorial001.py",
      "line": 7,
      "side": "RIGHT",
      "diff_hunk": "@@ -1,13 +1,24 @@\n+import importlib\n+\n import pytest\n from dirty_equals import IsDict\n from fastapi.testclient import TestClient\n \n+from tests.utils import needs_py39",
      "comment": "Shouldn't this be a relative import?\r\n(same comment in the other 2 files)",
      "comment_id": 1910427984,
      "user": "svlandeg",
      "created_at": "2025-01-10T14:10:32Z",
      "url": "https://github.com/fastapi/fastapi/pull/13183#discussion_r1910427984"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13183,
      "file_path": "tests/test_tutorial/test_request_form_models/test_tutorial002.py",
      "line": 6,
      "side": "RIGHT",
      "diff_hunk": "@@ -1,14 +1,23 @@\n+import importlib\n+\n import pytest\n from fastapi.testclient import TestClient\n \n-from tests.utils import needs_pydanticv2\n+from tests.utils import needs_py39, needs_pydanticv2",
      "comment": "```suggestion\r\nfrom ...utils import needs_py39, needs_pydanticv2\r\n```",
      "comment_id": 1913113718,
      "user": "svlandeg",
      "created_at": "2025-01-13T12:27:47Z",
      "url": "https://github.com/fastapi/fastapi/pull/13183#discussion_r1913113718"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13183,
      "file_path": "tests/test_tutorial/test_request_form_models/test_tutorial002_pv1.py",
      "line": 6,
      "side": "RIGHT",
      "diff_hunk": "@@ -1,24 +1,35 @@\n+import importlib\n+\n import pytest\n from fastapi.testclient import TestClient\n \n-from tests.utils import needs_pydanticv1\n+from tests.utils import needs_py39, needs_pydanticv1",
      "comment": "```suggestion\r\nfrom ...utils import needs_py39, needs_pydanticv1\r\n```",
      "comment_id": 1913114305,
      "user": "svlandeg",
      "created_at": "2025-01-13T12:28:02Z",
      "url": "https://github.com/fastapi/fastapi/pull/13183#discussion_r1913114305"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13179,
      "file_path": "tests/test_tutorial/test_header_params/test_tutorial003.py",
      "line": 33,
      "side": "RIGHT",
      "diff_hunk": "@@ -1,32 +1,45 @@\n+import importlib\n+\n import pytest\n from dirty_equals import IsDict\n from fastapi.testclient import TestClient\n \n-from docs_src.header_params.tutorial003 import app\n+from ...utils import needs_py39, needs_py310\n+\n+\n+@pytest.fixture(\n+    name=\"client\",\n+    params=[\n+        \"tutorial003\",\n+        pytest.param(\"tutorial003_py310\", marks=needs_py310),\n+        \"tutorial003_an\",\n+        pytest.param(\"tutorial003_an_py39\", marks=needs_py39),\n+        pytest.param(\"tutorial003_an_py310\", marks=needs_py310),\n+    ],\n+)\n+def get_client(request: pytest.FixtureRequest):\n+    mod = importlib.import_module(f\"docs_src.header_params.{request.param}\")\n \n-client = TestClient(app)\n+    client = TestClient(mod.app)\n+    return client\n \n \n @pytest.mark.parametrize(\n     \"path,headers,expected_status,expected_response\",\n     [\n         (\"/items\", None, 200, {\"X-Token values\": None}),\n         (\"/items\", {\"x-token\": \"foo\"}, 200, {\"X-Token values\": [\"foo\"]}),\n-        (\n-            \"/items\",\n-            [(\"x-token\", \"foo\"), (\"x-token\", \"bar\")],\n-            200,\n-            {\"X-Token values\": [\"foo\", \"bar\"]},\n-        ),\n+        # TODO: fix this, is it a bug?\n+        # (\"/items\", [(\"x-token\", \"foo\"), (\"x-token\", \"bar\")], 200, {\"X-Token values\": [\"foo\", \"bar\"]}),",
      "comment": "I updated the test to the latest version `test_tutorial003_an_py310.py`, which already included the comment, so I kept it",
      "comment_id": 1911442086,
      "user": "alejsdev",
      "created_at": "2025-01-10T21:32:01Z",
      "url": "https://github.com/fastapi/fastapi/pull/13179#discussion_r1911442086"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13174,
      "file_path": "tests/test_tutorial/test_dependencies/test_tutorial006.py",
      "line": 25,
      "side": "RIGHT",
      "diff_hunk": "@@ -1,12 +1,29 @@\n+import importlib\n+\n+import pytest\n from dirty_equals import IsDict\n from fastapi.testclient import TestClient\n \n-from docs_src.dependencies.tutorial006 import app\n+from ...utils import needs_py39\n+\n+\n+@pytest.fixture(\n+    name=\"client\",\n+    params=[\n+        \"tutorial006\",\n+        \"tutorial006_an\",\n+        pytest.param(\"tutorial006_an_py39\", marks=needs_py39),\n+    ],\n+)\n+def get_client(request: pytest.FixtureRequest):\n+    mod = importlib.import_module(f\"docs_src.dependencies.{request.param}\")\n \n-client = TestClient(app)\n+    client = TestClient(mod.app)\n+    return client\n \n \n-def test_get_no_headers():\n+@needs_py39",
      "comment": "I'm a little confused why we have additional `needs_py39` statements throughout the test file - this means that the whole file won't test on Python 3.8, right? But then the \"normal\" `tutorial006` also isn't being tested on Python 3.8?",
      "comment_id": 1910449044,
      "user": "svlandeg",
      "created_at": "2025-01-10T14:26:19Z",
      "url": "https://github.com/fastapi/fastapi/pull/13174#discussion_r1910449044"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13174,
      "file_path": "tests/test_tutorial/test_dependencies/test_tutorial006.py",
      "line": 25,
      "side": "RIGHT",
      "diff_hunk": "@@ -1,12 +1,29 @@\n+import importlib\n+\n+import pytest\n from dirty_equals import IsDict\n from fastapi.testclient import TestClient\n \n-from docs_src.dependencies.tutorial006 import app\n+from ...utils import needs_py39\n+\n+\n+@pytest.fixture(\n+    name=\"client\",\n+    params=[\n+        \"tutorial006\",\n+        \"tutorial006_an\",\n+        pytest.param(\"tutorial006_an_py39\", marks=needs_py39),\n+    ],\n+)\n+def get_client(request: pytest.FixtureRequest):\n+    mod = importlib.import_module(f\"docs_src.dependencies.{request.param}\")\n \n-client = TestClient(app)\n+    client = TestClient(mod.app)\n+    return client\n \n \n-def test_get_no_headers():\n+@needs_py39",
      "comment": "My bad, this is not necessary now with the refactor :sweat_smile: (same in #13182)\r\nI already fixed both, thank you!",
      "comment_id": 1911186362,
      "user": "alejsdev",
      "created_at": "2025-01-10T20:01:56Z",
      "url": "https://github.com/fastapi/fastapi/pull/13174#discussion_r1911186362"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 4488,
      "file_path": "fastapi/exceptions.py",
      "line": 5,
      "side": "RIGHT",
      "diff_hunk": "@@ -1,20 +1,8 @@\n-from typing import Any, Dict, Optional, Sequence, Type\n+from typing import Any, Sequence, Type\n \n from pydantic import BaseModel, ValidationError, create_model\n from pydantic.error_wrappers import ErrorList\n-from starlette.exceptions import HTTPException as StarletteHTTPException\n-\n-\n-class HTTPException(StarletteHTTPException):\n-    def __init__(\n-        self,\n-        status_code: int,\n-        detail: Any = None,\n-        headers: Optional[Dict[str, Any]] = None,\n-    ) -> None:\n-        super().__init__(status_code=status_code, detail=detail)\n-        self.headers = headers\n-\n+from starlette.exceptions import HTTPException as HTTPException  # noqa",
      "comment": "Is the renaming of import, i.e., `as HTTPException` needed at the last?",
      "comment_id": 800028772,
      "user": "rabinadk1",
      "created_at": "2022-02-05T07:10:02Z",
      "url": "https://github.com/fastapi/fastapi/pull/4488#discussion_r800028772"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 4488,
      "file_path": "tests/test_extra_routes.py",
      "line": 35,
      "side": "RIGHT",
      "diff_hunk": "@@ -32,12 +32,12 @@ def delete_item(item_id: str, item: Item):\n \n @app.head(\"/items/{item_id}\")\n def head_item(item_id: str):\n-    return JSONResponse(headers={\"x-fastapi-item-id\": item_id})\n+    return JSONResponse(None, headers={\"x-fastapi-item-id\": item_id})",
      "comment": "If there is no body, it shouldn't be a JSONResponse:\r\n\r\n```suggestion\r\n    return Response(headers={\"x-fastapi-item-id\": item_id})\r\n```",
      "comment_id": 818190708,
      "user": "paulo-raca",
      "created_at": "2022-03-02T23:31:52Z",
      "url": "https://github.com/fastapi/fastapi/pull/4488#discussion_r818190708"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 4488,
      "file_path": "fastapi/exceptions.py",
      "line": 5,
      "side": "RIGHT",
      "diff_hunk": "@@ -1,20 +1,8 @@\n-from typing import Any, Dict, Optional, Sequence, Type\n+from typing import Any, Sequence, Type\n \n from pydantic import BaseModel, ValidationError, create_model\n from pydantic.error_wrappers import ErrorList\n-from starlette.exceptions import HTTPException as StarletteHTTPException\n-\n-\n-class HTTPException(StarletteHTTPException):\n-    def __init__(\n-        self,\n-        status_code: int,\n-        detail: Any = None,\n-        headers: Optional[Dict[str, Any]] = None,\n-    ) -> None:\n-        super().__init__(status_code=status_code, detail=detail)\n-        self.headers = headers\n-\n+from starlette.exceptions import HTTPException as HTTPException  # noqa",
      "comment": "```suggestion\r\nfrom starlette.exceptions import HTTPException\r\n```\r\n\r\nI suppose there's not reason for `noqa` anymore.",
      "comment_id": 866818027,
      "user": "mdczaplicki",
      "created_at": "2022-05-06T13:15:47Z",
      "url": "https://github.com/fastapi/fastapi/pull/4488#discussion_r866818027"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 4488,
      "file_path": "fastapi/routing.py",
      "line": 129,
      "side": "RIGHT",
      "diff_hunk": "@@ -126,7 +126,7 @@ async def serialize_response(\n         if is_coroutine:\n             value, errors_ = field.validate(response_content, {}, loc=(\"response\",))\n         else:\n-            value, errors_ = await run_in_threadpool(\n+            value, errors_ = await run_in_threadpool(  # type: ignore[misc]",
      "comment": "How about adding proper type hints for these names?",
      "comment_id": 866818930,
      "user": "mdczaplicki",
      "created_at": "2022-05-06T13:16:46Z",
      "url": "https://github.com/fastapi/fastapi/pull/4488#discussion_r866818930"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 4488,
      "file_path": "fastapi/exceptions.py",
      "line": 12,
      "side": "LEFT",
      "diff_hunk": "@@ -1,20 +1,8 @@\n-from typing import Any, Dict, Optional, Sequence, Type\n+from typing import Any, Sequence, Type\n \n from pydantic import BaseModel, ValidationError, create_model\n from pydantic.error_wrappers import ErrorList\n-from starlette.exceptions import HTTPException as StarletteHTTPException\n-\n-\n-class HTTPException(StarletteHTTPException):\n-    def __init__(\n-        self,\n-        status_code: int,\n-        detail: Any = None,",
      "comment": "There are several examples and places in the code base that expect `detail` to be any JSON-able data, not only a string (as is with Starlette).\r\n\r\nSo, only for this little type hint we still need the custom `HTTPException` class in FastAPI.",
      "comment_id": 868241940,
      "user": "tiangolo",
      "created_at": "2022-05-09T17:20:47Z",
      "url": "https://github.com/fastapi/fastapi/pull/4488#discussion_r868241940"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 4488,
      "file_path": "fastapi/exceptions.py",
      "line": 12,
      "side": "LEFT",
      "diff_hunk": "@@ -1,20 +1,8 @@\n-from typing import Any, Dict, Optional, Sequence, Type\n+from typing import Any, Sequence, Type\n \n from pydantic import BaseModel, ValidationError, create_model\n from pydantic.error_wrappers import ErrorList\n-from starlette.exceptions import HTTPException as StarletteHTTPException\n-\n-\n-class HTTPException(StarletteHTTPException):\n-    def __init__(\n-        self,\n-        status_code: int,\n-        detail: Any = None,",
      "comment": "3 years later, I think this was a mistake.\r\n\r\nI know [it's documented](https://fastapi.tiangolo.com/tutorial/handling-errors/#fastapis-httpexception-vs-starlettes-httpexception), but it's confusing that it happens.",
      "comment_id": 1905555541,
      "user": "Kludex",
      "created_at": "2025-01-07T14:40:58Z",
      "url": "https://github.com/fastapi/fastapi/pull/4488#discussion_r1905555541"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13135,
      "file_path": "scripts/topic_repos.py",
      "line": 58,
      "side": "RIGHT",
      "diff_hunk": "@@ -0,0 +1,82 @@\n+import logging\n+import secrets\n+import subprocess\n+import sys\n+from pathlib import Path\n+\n+import yaml\n+from github import Github\n+from pydantic import BaseModel, SecretStr\n+from pydantic_settings import BaseSettings\n+\n+\n+class Settings(BaseSettings):\n+    github_repository: str\n+    github_token: SecretStr\n+\n+\n+class Repo(BaseModel):\n+    name: str\n+    html_url: str\n+    stars: int\n+    owner_login: str\n+    owner_html_url: str\n+\n+\n+def main() -> None:\n+    logging.basicConfig(level=logging.INFO)\n+    settings = Settings()\n+\n+    logging.info(f\"Using config: {settings.model_dump_json()}\")\n+    g = Github(settings.github_token.get_secret_value(), per_page=100)\n+    r = g.get_repo(settings.github_repository)\n+    repos = g.search_repositories(query=\"topic:fastapi\")\n+    repos_list = list(repos)\n+    final_repos: list[Repo] = []\n+    for repo in repos_list[:100]:\n+        if repo.full_name == settings.github_repository:\n+            continue\n+        final_repos.append(\n+            Repo(\n+                name=repo.name,\n+                html_url=repo.html_url,\n+                stars=repo.stargazers_count,\n+                owner_login=repo.owner.login,\n+                owner_html_url=repo.owner.html_url,\n+            )\n+        )\n+    data = [repo.model_dump() for repo in final_repos]\n+    logging.info(\"Finished\")\n+\n+    # Local development\n+    # repos_path = Path(\"../docs/en/data/topic_repos.yml\")\n+    repos_path = Path(\"./docs/en/data/topic_repos.yml\")\n+    repos_old_content = repos_path.read_text(encoding=\"utf-8\")\n+    new_repos_content = yaml.dump(data, sort_keys=False, width=200, allow_unicode=True)\n+    if repos_old_content == new_repos_content:\n+        logging.info(\"The data hasn't changed. Finishing.\")\n+        sys.exit(0)",
      "comment": "```suggestion\r\n        return\r\n```\r\n\r\nI see this was from a copy of the other scripts that were run with `if __name__ == \"__main__\"`, but as this is now in a function, we can just return to finish the execution here, we don't have to call `sys.exit(0)`",
      "comment_id": 1901238644,
      "user": "tiangolo",
      "created_at": "2025-01-02T20:32:24Z",
      "url": "https://github.com/fastapi/fastapi/pull/13135#discussion_r1901238644"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 13135,
      "file_path": "scripts/topic_repos.py",
      "line": 49,
      "side": "RIGHT",
      "diff_hunk": "@@ -0,0 +1,82 @@\n+import logging\n+import secrets\n+import subprocess\n+import sys\n+from pathlib import Path\n+\n+import yaml\n+from github import Github\n+from pydantic import BaseModel, SecretStr\n+from pydantic_settings import BaseSettings\n+\n+\n+class Settings(BaseSettings):\n+    github_repository: str\n+    github_token: SecretStr\n+\n+\n+class Repo(BaseModel):\n+    name: str\n+    html_url: str\n+    stars: int\n+    owner_login: str\n+    owner_html_url: str\n+\n+\n+def main() -> None:\n+    logging.basicConfig(level=logging.INFO)\n+    settings = Settings()\n+\n+    logging.info(f\"Using config: {settings.model_dump_json()}\")\n+    g = Github(settings.github_token.get_secret_value(), per_page=100)\n+    r = g.get_repo(settings.github_repository)\n+    repos = g.search_repositories(query=\"topic:fastapi\")\n+    repos_list = list(repos)\n+    final_repos: list[Repo] = []\n+    for repo in repos_list[:100]:\n+        if repo.full_name == settings.github_repository:\n+            continue\n+        final_repos.append(\n+            Repo(\n+                name=repo.name,\n+                html_url=repo.html_url,\n+                stars=repo.stargazers_count,\n+                owner_login=repo.owner.login,\n+                owner_html_url=repo.owner.html_url,\n+            )\n+        )\n+    data = [repo.model_dump() for repo in final_repos]\n+    logging.info(\"Finished\")",
      "comment": "```suggestion\r\n```\r\n\r\nThis is probably an old copy-paste log, by this point it's not finished yet. :sweat_smile:\r\n\r\nThere's already a log with \"Finished\" at the end so we can just remove this one.",
      "comment_id": 1901239554,
      "user": "tiangolo",
      "created_at": "2025-01-02T20:33:48Z",
      "url": "https://github.com/fastapi/fastapi/pull/13135#discussion_r1901239554"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 3144,
      "file_path": "fastapi/openapi/utils.py",
      "line": 94,
      "side": "RIGHT",
      "diff_hunk": "@@ -91,23 +91,24 @@ def get_openapi_operation_parameters(\n     for param in all_route_params:\n         field_info = param.field_info\n         field_info = cast(Param, field_info)\n-        parameter = {\n-            \"name\": param.alias,\n-            \"in\": field_info.in_.value,\n-            \"required\": param.required,\n-            \"schema\": field_schema(\n-                param, model_name_map=model_name_map, ref_prefix=REF_PREFIX\n-            )[0],\n-        }\n-        if field_info.description:\n-            parameter[\"description\"] = field_info.description\n-        if field_info.examples:\n-            parameter[\"examples\"] = jsonable_encoder(field_info.examples)\n-        elif field_info.example != Undefined:\n-            parameter[\"example\"] = jsonable_encoder(field_info.example)\n-        if field_info.deprecated:\n-            parameter[\"deprecated\"] = field_info.deprecated\n-        parameters.append(parameter)\n+        if field_info.include_in_schema:",
      "comment": "Maybe \r\n\r\n```python\r\nif not field_info.include_in_schema:\r\n    continue\r\n```\r\n\r\nThis will decrease 1 indent level to the rest of codes in loop.\r\nAlso people can skip finding the `else` block of this if while reading these codes",
      "comment_id": 720244175,
      "user": "tokikanno",
      "created_at": "2021-10-01T13:26:26Z",
      "url": "https://github.com/fastapi/fastapi/pull/3144#discussion_r720244175"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 3144,
      "file_path": "fastapi/params.py",
      "line": 99,
      "side": "RIGHT",
      "diff_hunk": "@@ -93,6 +96,7 @@ def __init__(\n             deprecated=deprecated,\n             example=example,\n             examples=examples,\n+            include_in_schema=include_in_schema,",
      "comment": "[discussion] don't think should/could hide path parameter, the path parameter already shown during route declaration. For example:\r\n\r\n\r\n```python\r\n@app.get('/user/{uid}')\r\ndef get_user_info(uid: str = Path(...)):\r\n    pass\r\n```\r\n\r\nThough you could hide the validation info of this path parameter, but people who have access to document already know there is a path parameter called `uid`.\r\n",
      "comment_id": 720254381,
      "user": "tokikanno",
      "created_at": "2021-10-01T13:37:32Z",
      "url": "https://github.com/fastapi/fastapi/pull/3144#discussion_r720254381"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 3144,
      "file_path": "fastapi/openapi/utils.py",
      "line": 94,
      "side": "RIGHT",
      "diff_hunk": "@@ -91,23 +91,24 @@ def get_openapi_operation_parameters(\n     for param in all_route_params:\n         field_info = param.field_info\n         field_info = cast(Param, field_info)\n-        parameter = {\n-            \"name\": param.alias,\n-            \"in\": field_info.in_.value,\n-            \"required\": param.required,\n-            \"schema\": field_schema(\n-                param, model_name_map=model_name_map, ref_prefix=REF_PREFIX\n-            )[0],\n-        }\n-        if field_info.description:\n-            parameter[\"description\"] = field_info.description\n-        if field_info.examples:\n-            parameter[\"examples\"] = jsonable_encoder(field_info.examples)\n-        elif field_info.example != Undefined:\n-            parameter[\"example\"] = jsonable_encoder(field_info.example)\n-        if field_info.deprecated:\n-            parameter[\"deprecated\"] = field_info.deprecated\n-        parameters.append(parameter)\n+        if field_info.include_in_schema:",
      "comment": "I personally prefer your suggestion but felt it was better to be consistent with the rest of the file, e.g.\r\n\r\nhttps://github.com/tiangolo/fastapi/blob/cf8b080cf9392babefd905c166c1b7aa8145f1b9/fastapi/openapi/utils.py#L182\r\n\r\nhttps://github.com/tiangolo/fastapi/blob/cf8b080cf9392babefd905c166c1b7aa8145f1b9/fastapi/openapi/utils.py#L320",
      "comment_id": 722859672,
      "user": "astraldawn",
      "created_at": "2021-10-06T03:35:44Z",
      "url": "https://github.com/fastapi/fastapi/pull/3144#discussion_r722859672"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 3144,
      "file_path": "fastapi/params.py",
      "line": 99,
      "side": "RIGHT",
      "diff_hunk": "@@ -93,6 +96,7 @@ def __init__(\n             deprecated=deprecated,\n             example=example,\n             examples=examples,\n+            include_in_schema=include_in_schema,",
      "comment": "I think this is ok as hiding any `Param` via `include_in_schema` is a user decision.\r\n\r\n@yezz123 any thoughts on this?",
      "comment_id": 722862720,
      "user": "astraldawn",
      "created_at": "2021-10-06T03:45:44Z",
      "url": "https://github.com/fastapi/fastapi/pull/3144#discussion_r722862720"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 3144,
      "file_path": "fastapi/params.py",
      "line": 99,
      "side": "RIGHT",
      "diff_hunk": "@@ -93,6 +96,7 @@ def __init__(\n             deprecated=deprecated,\n             example=example,\n             examples=examples,\n+            include_in_schema=include_in_schema,",
      "comment": "Agreed @astraldawn, it's fine to leave it as is. I don't see why someone would want to hide the path param, but at the same time if they can hide the others, they should be able to hide this as well.",
      "comment_id": 790293228,
      "user": "tiangolo",
      "created_at": "2022-01-23T15:35:58Z",
      "url": "https://github.com/fastapi/fastapi/pull/3144#discussion_r790293228"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 3144,
      "file_path": "fastapi/openapi/utils.py",
      "line": 94,
      "side": "RIGHT",
      "diff_hunk": "@@ -91,23 +91,24 @@ def get_openapi_operation_parameters(\n     for param in all_route_params:\n         field_info = param.field_info\n         field_info = cast(Param, field_info)\n-        parameter = {\n-            \"name\": param.alias,\n-            \"in\": field_info.in_.value,\n-            \"required\": param.required,\n-            \"schema\": field_schema(\n-                param, model_name_map=model_name_map, ref_prefix=REF_PREFIX\n-            )[0],\n-        }\n-        if field_info.description:\n-            parameter[\"description\"] = field_info.description\n-        if field_info.examples:\n-            parameter[\"examples\"] = jsonable_encoder(field_info.examples)\n-        elif field_info.example != Undefined:\n-            parameter[\"example\"] = jsonable_encoder(field_info.example)\n-        if field_info.deprecated:\n-            parameter[\"deprecated\"] = field_info.deprecated\n-        parameters.append(parameter)\n+        if field_info.include_in_schema:",
      "comment": "Thanks for the discussion! Yep, agreed it makes sense to switch it around. I just did in a commit on top. Thanks!",
      "comment_id": 790293246,
      "user": "tiangolo",
      "created_at": "2022-01-23T15:36:07Z",
      "url": "https://github.com/fastapi/fastapi/pull/3144#discussion_r790293246"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 5823,
      "file_path": "tests/test_exception_handlers.py",
      "line": 88,
      "side": "RIGHT",
      "diff_hunk": "@@ -65,3 +77,12 @@ def test_override_server_error_exception_response():\n     response = client.get(\"/server-error\")\n     assert response.status_code == 500\n     assert response.json() == {\"exception\": \"server-error\"}\n+\n+\n+def test_traceback_for_dependency_with_yield():\n+    client = TestClient(app, raise_server_exceptions=True)\n+    with pytest.raises(ValueError) as exc_info:\n+        client.get(\"/dependency-with-yield\")\n+    last_frame = exc_info.traceback[-1]\n+    assert str(last_frame.path) == __file__\n+    assert last_frame.lineno == raise_value_error.__code__.co_firstlineno",
      "comment": "If you revert the changes, you can verify that the dependency will not be the last frame (or in any frame, because it will not be present).",
      "comment_id": 1865463372,
      "user": "Kludex",
      "created_at": "2024-12-02T08:56:50Z",
      "url": "https://github.com/fastapi/fastapi/pull/5823#discussion_r1865463372"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 12199,
      "file_path": "docs_src/query_param_models/tutorial001.py",
      "line": 14,
      "side": "RIGHT",
      "diff_hunk": "@@ -0,0 +1,19 @@\n+from typing import List\n+\n+from fastapi import FastAPI, Query\n+from pydantic import BaseModel, Field\n+from typing_extensions import Literal\n+\n+app = FastAPI()\n+\n+\n+class FilterParams(BaseModel):\n+    limit: int = Field(100, gt=0, le=100)\n+    offset: int = Field(0, ge=0)\n+    order_by: Literal[\"created_at\", \"updated_at\"] = \"created_at\"\n+    tags: List[str] = []",
      "comment": "It's generally not a good idea to use mutables as defaults.\r\n\r\n```suggestion\r\n    tags: List[str] = Field(default_factory=list)\r\n```",
      "comment_id": 1761959430,
      "user": "tonnico",
      "created_at": "2024-09-16T21:00:47Z",
      "url": "https://github.com/fastapi/fastapi/pull/12199#discussion_r1761959430"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 12199,
      "file_path": "docs_src/query_param_models/tutorial001.py",
      "line": 13,
      "side": "RIGHT",
      "diff_hunk": "@@ -0,0 +1,19 @@\n+from typing import List\n+\n+from fastapi import FastAPI, Query\n+from pydantic import BaseModel, Field\n+from typing_extensions import Literal\n+\n+app = FastAPI()\n+\n+\n+class FilterParams(BaseModel):\n+    limit: int = Field(100, gt=0, le=100)\n+    offset: int = Field(0, ge=0)\n+    order_by: Literal[\"created_at\", \"updated_at\"] = \"created_at\"",
      "comment": "Should we probably add an alias for this tests?\r\n\r\n```suggestion\r\n    order_by: Literal[\"created_at\", \"updated_at\"] = Field(alias=\"orderBy\", default=\"created_at\")\r\n```\r\n\r\nWhat is about `Header` and `Cookie`?",
      "comment_id": 1761960933,
      "user": "tonnico",
      "created_at": "2024-09-16T21:02:11Z",
      "url": "https://github.com/fastapi/fastapi/pull/12199#discussion_r1761960933"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 12199,
      "file_path": "docs_src/query_param_models/tutorial001.py",
      "line": 13,
      "side": "RIGHT",
      "diff_hunk": "@@ -0,0 +1,19 @@\n+from typing import List\n+\n+from fastapi import FastAPI, Query\n+from pydantic import BaseModel, Field\n+from typing_extensions import Literal\n+\n+app = FastAPI()\n+\n+\n+class FilterParams(BaseModel):\n+    limit: int = Field(100, gt=0, le=100)\n+    offset: int = Field(0, ge=0)\n+    order_by: Literal[\"created_at\", \"updated_at\"] = \"created_at\"",
      "comment": "Why do you think so? :thinking: \r\n\r\nMaybe you can suggest it in a PR on top after this. :nerd_face: ",
      "comment_id": 1763618528,
      "user": "tiangolo",
      "created_at": "2024-09-17T17:25:48Z",
      "url": "https://github.com/fastapi/fastapi/pull/12199#discussion_r1763618528"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 12199,
      "file_path": "docs_src/query_param_models/tutorial001.py",
      "line": 13,
      "side": "RIGHT",
      "diff_hunk": "@@ -0,0 +1,19 @@\n+from typing import List\n+\n+from fastapi import FastAPI, Query\n+from pydantic import BaseModel, Field\n+from typing_extensions import Literal\n+\n+app = FastAPI()\n+\n+\n+class FilterParams(BaseModel):\n+    limit: int = Field(100, gt=0, le=100)\n+    offset: int = Field(0, ge=0)\n+    order_by: Literal[\"created_at\", \"updated_at\"] = \"created_at\"",
      "comment": "After some issues between 0.112.4 and 0.114.1 with the alias I thought it could be a good idea.\r\nI will make a suggestion.",
      "comment_id": 1763981888,
      "user": "tonnico",
      "created_at": "2024-09-17T20:32:30Z",
      "url": "https://github.com/fastapi/fastapi/pull/12199#discussion_r1763981888"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 12197,
      "file_path": "fastapi/_compat.py",
      "line": 319,
      "side": "RIGHT",
      "diff_hunk": "@@ -313,9 +312,11 @@ def get_model_fields(model: Type[BaseModel]) -> List[ModelField]:\n     from pydantic.fields import (  # type: ignore[no-redef,attr-defined]\n         ModelField as ModelField,  # noqa: F401\n     )\n-    from pydantic.fields import (  # type: ignore[no-redef,attr-defined]\n-        Required as Required,  # noqa: F401\n-    )\n+\n+    # from pydantic.fields import (  # type: ignore[no-redef,attr-defined]\n+    #     Required as Required,  # noqa: F401\n+    # )\n+    Required = Ellipsis",
      "comment": "not sure if we'd like to keep this or completely remove it",
      "comment_id": 1758821083,
      "user": "pachewise",
      "created_at": "2024-09-13T12:57:22Z",
      "url": "https://github.com/fastapi/fastapi/pull/12197#discussion_r1758821083"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 12197,
      "file_path": "docs_src/query_params_str_validations/tutorial006d_an_py39.py",
      "line": 9,
      "side": "RIGHT",
      "diff_hunk": "@@ -1,13 +1,12 @@\n from typing import Annotated\n \n from fastapi import FastAPI, Query\n-from pydantic import Required\n \n app = FastAPI()\n \n \n @app.get(\"/items/\")\n-async def read_items(q: Annotated[str, Query(min_length=3)] = Required):\n+async def read_items(q: Annotated[str, Query(min_length=3)] = ...):",
      "comment": "These examples seemed old, and I don't see them in the published docs. Guidance wanted on whether these need to be updated, deleted, or left untouched.",
      "comment_id": 1758823011,
      "user": "pachewise",
      "created_at": "2024-09-13T12:58:33Z",
      "url": "https://github.com/fastapi/fastapi/pull/12197#discussion_r1758823011"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 12197,
      "file_path": "docs_src/query_params_str_validations/tutorial006d_an_py39.py",
      "line": 9,
      "side": "RIGHT",
      "diff_hunk": "@@ -1,13 +1,12 @@\n from typing import Annotated\n \n from fastapi import FastAPI, Query\n-from pydantic import Required\n \n app = FastAPI()\n \n \n @app.get(\"/items/\")\n-async def read_items(q: Annotated[str, Query(min_length=3)] = Required):\n+async def read_items(q: Annotated[str, Query(min_length=3)] = ...):",
      "comment": "This has been deleted from the (English) docs in PR #10469, but the Russian documentation does in fact still reference it in `docs/ru/tutorial/query-params-str-validations.md`. Ideally, we probably should remove the reference from the Russian docs as well, and then remove this file altogether, but I would suggest to do that in a separate PR to avoid mixing up different issues - it's always easier to review atomic PRs.",
      "comment_id": 1761190778,
      "user": "svlandeg",
      "created_at": "2024-09-16T13:43:58Z",
      "url": "https://github.com/fastapi/fastapi/pull/12197#discussion_r1761190778"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 12197,
      "file_path": "fastapi/_compat.py",
      "line": 74,
      "side": "RIGHT",
      "diff_hunk": "@@ -71,8 +71,7 @@\n             general_plain_validator_function as with_info_plain_validator_function,  # noqa: F401\n         )\n \n-    Required = PydanticUndefined\n-    Undefined = PydanticUndefined\n+    RequiredParam = Undefined = PydanticUndefined",
      "comment": "```suggestion\r\n    RequiredParam = PydanticUndefined\r\n    Undefined = PydanticUndefined\r\n```\r\nThis might be a matter of personal preference, but I would use binary assignments instead of tertiary ones. I also think it makes maintenance of code easier on the long run, as you can change one of the assignments and only that particular line will show up in the diff, rather than doing a mix of things on one line.",
      "comment_id": 1761201903,
      "user": "svlandeg",
      "created_at": "2024-09-16T13:49:47Z",
      "url": "https://github.com/fastapi/fastapi/pull/12197#discussion_r1761201903"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 12117,
      "file_path": "fastapi/dependencies/utils.py",
      "line": 734,
      "side": "RIGHT",
      "diff_hunk": "@@ -704,21 +714,41 @@ def request_params_to_args(\n     return values, errors\n \n \n+def _should_embed_body_fields(fields: List[ModelField]) -> bool:\n+    if not fields:\n+        return False\n+    first_field = fields[0]\n+    body_param_names_set = {field.name for field in fields}\n+    embed = (\n+        # A top level field has to be a single field, not multiple\n+        len(body_param_names_set) > 1\n+        # If it explicitly specifies it is embedded, it's not top level\n+        or getattr(first_field.field_info, \"embed\", None)\n+        # If it's a Form (or File) field, it has to be a BaseModel to be top level\n+        # otherwise it has to be embedded, so that the key value pair can be extracted\n+        or (\n+            isinstance(first_field.field_info, params.Form)\n+            and not isinstance(first_field.type_, BaseModel)\n+        )\n+    )\n+    return embed",
      "comment": "NIT \ud83d\ude48\r\n\r\nno logic changes, just a small simplification\r\n\r\n```suggestion\r\ndef _should_embed_body_fields(fields: List[ModelField]) -> bool:\r\n    if not fields:\r\n        return False\r\n    \r\n    # A top level field has to be a single field, not multiple\r\n    if len(fields) > 1:\r\n        return True\r\n    \r\n    first_field = fields[0]\r\n    # If it explicitly specifies it is embedded, it's not top level\r\n    if getattr(first_field.field_info, \"embed\", None):\r\n        return True\r\n     \r\n    # If it's a Form (or File) field, it has to be a BaseModel to be top level\r\n    # otherwise it has to be embedded, so that the key value pair can be extracted\r\n    if isinstance(first_field.field_info, params.Form) and not isinstance(first_field.type_, BaseModel):\r\n        return True\r\n        \r\n     return False\r\n     \r\n```",
      "comment_id": 1741217679,
      "user": "includeamin",
      "created_at": "2024-09-02T19:36:23Z",
      "url": "https://github.com/fastapi/fastapi/pull/12117#discussion_r1741217679"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 12117,
      "file_path": "fastapi/dependencies/utils.py",
      "line": 734,
      "side": "RIGHT",
      "diff_hunk": "@@ -704,21 +714,41 @@ def request_params_to_args(\n     return values, errors\n \n \n+def _should_embed_body_fields(fields: List[ModelField]) -> bool:\n+    if not fields:\n+        return False\n+    first_field = fields[0]\n+    body_param_names_set = {field.name for field in fields}\n+    embed = (\n+        # A top level field has to be a single field, not multiple\n+        len(body_param_names_set) > 1\n+        # If it explicitly specifies it is embedded, it's not top level\n+        or getattr(first_field.field_info, \"embed\", None)\n+        # If it's a Form (or File) field, it has to be a BaseModel to be top level\n+        # otherwise it has to be embedded, so that the key value pair can be extracted\n+        or (\n+            isinstance(first_field.field_info, params.Form)\n+            and not isinstance(first_field.type_, BaseModel)\n+        )\n+    )\n+    return embed",
      "comment": "Oops, my bad! \ud83d\ude05 The PR was still a draft. Just ignore it \ud83d\ude48\r\n",
      "comment_id": 1741218086,
      "user": "includeamin",
      "created_at": "2024-09-02T19:37:39Z",
      "url": "https://github.com/fastapi/fastapi/pull/12117#discussion_r1741218086"
    },
    {
      "repo": "fastapi/fastapi",
      "pr_number": 9630,
      "file_path": "fastapi/routing.py",
      "line": 131,
      "side": "RIGHT",
      "diff_hunk": "@@ -119,6 +121,18 @@ def _prepare_response_content(\n     return res\n \n \n+def _merge_lifespan_context(\n+    original_context: Lifespan[Any], nested_context: Lifespan[Any]\n+) -> Lifespan[Any]:\n+    @asynccontextmanager\n+    async def merged_lifespan(app: AppType) -> AsyncIterator[Mapping[str, Any]]:\n+        async with original_context(app) as maybe_self_context:\n+            async with nested_context(app) as maybe_nested_context:\n+                yield {**(maybe_self_context or {}), **(maybe_nested_context or {})}",
      "comment": "The _yielded_ value is actually called `maybe_state` on Starlette's code. For consistency, let's keep the same name.\r\n \r\n```suggestion\r\n        async with original_context(app) as maybe_original_state:\r\n            async with nested_context(app) as maybe_nested_state:\r\n                yield {**(maybe_original_state or {}), **(maybe_nested_state or {})}\r\n```",
      "comment_id": 1707909970,
      "user": "Kludex",
      "created_at": "2024-08-07T21:05:55Z",
      "url": "https://github.com/fastapi/fastapi/pull/9630#discussion_r1707909970"
    }
  ]
}